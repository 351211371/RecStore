perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f1da628eee0>==========
Worker 0 pid=12523
Worker 1 pid=12524
Worker 2 pid=12525
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
Step99:rank3, time: 19.923, per_step: 0.199228
Step99:rank1, time: 21.396, per_step: 0.213957
Step99:rank2, time: 20.051, per_step: 0.200508
Step99:rank0, time: 19.989, per_step: 0.199894
Step199:rank1, time: 18.581, per_step: 0.183970
Step199:rank3, time: 18.602, per_step: 0.184182
Step199:rank2, time: 18.606, per_step: 0.184221
Step199:rank0, time: 18.578, per_step: 0.183939
Step299:rank1, time: 18.925, per_step: 0.187381
Step299:rank2, time: 18.900, per_step: 0.187129
Step299:rank3, time: 18.929, per_step: 0.187416
Step299:rank0, time: 18.947, per_step: 0.187591
Step399:rank1, time: 18.691, per_step: 0.185059
Step399:rank2, time: 18.690, per_step: 0.185051
Step399:rank3, time: 18.697, per_step: 0.185116
Step399:rank0, time: 18.688, per_step: 0.185032
Step499:rank3, time: 19.061, per_step: 0.188718
Step499:rank1, time: 19.085, per_step: 0.188958
Step499:rank2, time: 19.114, per_step: 0.189251
Step499:rank0, time: 19.096, per_step: 0.189072
Worker 3 pid=12526
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f3585ba8e50>==========
Worker 0 pid=30619
Worker 1 pid=30620
Worker 2 pid=30624
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<29:11,  1.75s/it]  0%|          | 1/1000 [00:01<30:11,  1.81s/it]  1%|          | 11/1000 [00:01<02:02,  8.05it/s]  0%|          | 1/1000 [00:01<31:19,  1.88s/it]  0%|          | 1/1000 [00:01<31:37,  1.90s/it]  1%|          | 10/1000 [00:01<02:19,  7.08it/s]  2%|▏         | 23/1000 [00:01<00:51, 18.86it/s]  1%|          | 8/1000 [00:01<03:02,  5.43it/s]  1%|          | 7/1000 [00:02<03:33,  4.64it/s]  2%|▎         | 25/1000 [00:02<00:47, 20.51it/s]  4%|▍         | 43/1000 [00:02<00:23, 40.67it/s]  3%|▎         | 26/1000 [00:02<00:45, 21.36it/s]  2%|▏         | 22/1000 [00:02<00:55, 17.68it/s]  6%|▋         | 63/1000 [00:02<00:14, 62.98it/s]  8%|▊         | 75/1000 [00:02<00:11, 81.67it/s]  6%|▋         | 65/1000 [00:02<00:14, 63.83it/s]Step99:rank3, time: 2.211, per_step: 0.022109
  5%|▌         | 51/1000 [00:02<00:19, 48.53it/s] 11%|█         | 107/1000 [00:02<00:07, 117.45it/s]Step99:rank0, time: 2.222, per_step: 0.022216
Step99:rank1, time: 2.272, per_step: 0.022715
 13%|█▎        | 127/1000 [00:02<00:05, 157.66it/s] 11%|█         | 110/1000 [00:02<00:07, 118.33it/s]  9%|▊         | 87/1000 [00:02<00:09, 91.72it/s] 15%|█▌        | 153/1000 [00:02<00:04, 175.61it/s]Step99:rank2, time: 2.364, per_step: 0.023638
 19%|█▉        | 193/1000 [00:02<00:03, 257.33it/s]Step199:rank0, time: 0.159, per_step: 0.001579
 16%|█▌        | 157/1000 [00:02<00:04, 176.66it/s] 12%|█▏        | 124/1000 [00:02<00:06, 137.50it/s] 19%|█▉        | 194/1000 [00:02<00:03, 213.73it/s]Step199:rank3, time: 0.250, per_step: 0.002473
 25%|██▌       | 253/1000 [00:02<00:02, 332.34it/s]Step199:rank1, time: 0.217, per_step: 0.002146
 20%|██        | 204/1000 [00:02<00:03, 232.78it/s] 16%|█▌        | 161/1000 [00:02<00:04, 181.47it/s] 24%|██▍       | 240/1000 [00:02<00:02, 263.25it/s]Step299:rank0, time: 0.186, per_step: 0.001843
 30%|███       | 302/1000 [00:02<00:01, 370.02it/s] 24%|██▍       | 243/1000 [00:02<00:02, 257.20it/s] 28%|██▊       | 284/1000 [00:02<00:02, 303.35it/s] 19%|█▉        | 192/1000 [00:02<00:04, 195.47it/s]Step199:rank2, time: 0.317, per_step: 0.003134
 35%|███▌      | 352/1000 [00:02<00:01, 402.78it/s]Step299:rank3, time: 0.228, per_step: 0.002254
 29%|██▉       | 290/1000 [00:02<00:02, 301.14it/s]Step299:rank1, time: 0.255, per_step: 0.002526
 33%|███▎      | 328/1000 [00:02<00:01, 336.93it/s] 24%|██▍       | 238/1000 [00:02<00:03, 253.52it/s]Step399:rank0, time: 0.207, per_step: 0.002048
 40%|████      | 401/1000 [00:02<00:01, 421.04it/s] 34%|███▎      | 336/1000 [00:02<00:01, 339.54it/s] 37%|███▋      | 374/1000 [00:02<00:01, 368.82it/s] 28%|██▊       | 278/1000 [00:02<00:02, 288.73it/s] 45%|████▌     | 450/1000 [00:02<00:01, 438.45it/s]Step399:rank3, time: 0.222, per_step: 0.002196
Step299:rank2, time: 0.235, per_step: 0.002327
 38%|███▊      | 380/1000 [00:02<00:01, 364.40it/s] 42%|████▏     | 420/1000 [00:02<00:01, 393.06it/s] 32%|███▏      | 317/1000 [00:02<00:02, 313.21it/s]Step399:rank1, time: 0.227, per_step: 0.002243
 50%|████▉     | 499/1000 [00:02<00:01, 450.41it/s]Step499:rank0, time: 0.208, per_step: 0.002058
 42%|████▎     | 425/1000 [00:03<00:01, 386.17it/s] 47%|████▋     | 466/1000 [00:03<00:01, 410.42it/s] 35%|███▌      | 354/1000 [00:03<00:01, 326.94it/s] 55%|█████▍    | 548/1000 [00:03<00:00, 453.68it/s] 47%|████▋     | 470/1000 [00:03<00:01, 403.81it/s]Step499:rank3, time: 0.227, per_step: 0.002243
 51%|█████     | 511/1000 [00:03<00:01, 414.61it/s] 39%|███▉      | 391/1000 [00:03<00:01, 327.05it/s]Step499:rank1, time: 0.220, per_step: 0.002175
 60%|█████▉    | 596/1000 [00:03<00:00, 454.81it/s]Step399:rank2, time: 0.291, per_step: 0.002877
Step599:rank0, time: 0.217, per_step: 0.002152
 52%|█████▏    | 516/1000 [00:03<00:01, 418.85it/s] 56%|█████▌    | 555/1000 [00:03<00:01, 412.87it/s] 43%|████▎     | 428/1000 [00:03<00:01, 337.27it/s] 65%|██████▍   | 646/1000 [00:03<00:00, 466.70it/s] 56%|█████▋    | 563/1000 [00:03<00:01, 432.68it/s]Step599:rank3, time: 0.229, per_step: 0.002271
 60%|██████    | 602/1000 [00:03<00:00, 426.78it/s] 46%|████▋     | 465/1000 [00:03<00:01, 344.27it/s] 70%|██████▉   | 696/1000 [00:03<00:00, 474.05it/s]Step599:rank1, time: 0.216, per_step: 0.002140
Step699:rank0, time: 0.202, per_step: 0.002002
 61%|██████    | 609/1000 [00:03<00:00, 440.08it/s] 65%|██████▍   | 648/1000 [00:03<00:00, 435.33it/s]Step499:rank2, time: 0.274, per_step: 0.002710
 50%|█████     | 502/1000 [00:03<00:01, 349.98it/s] 75%|███████▍  | 746/1000 [00:03<00:00, 479.95it/s] 66%|██████▌   | 655/1000 [00:03<00:00, 445.62it/s] 69%|██████▉   | 694/1000 [00:03<00:00, 441.75it/s]Step699:rank3, time: 0.219, per_step: 0.002171
 54%|█████▍    | 540/1000 [00:03<00:01, 357.10it/s]Step799:rank0, time: 0.182, per_step: 0.001799
 81%|████████  | 808/1000 [00:03<00:00, 519.19it/s]Step699:rank1, time: 0.218, per_step: 0.002157
 70%|███████   | 701/1000 [00:03<00:00, 449.54it/s] 74%|███████▍  | 740/1000 [00:03<00:00, 444.96it/s] 59%|█████▊    | 586/1000 [00:03<00:01, 385.76it/s] 87%|████████▋ | 874/1000 [00:03<00:00, 560.18it/s]Step599:rank2, time: 0.245, per_step: 0.002421
 75%|███████▍  | 748/1000 [00:03<00:00, 453.50it/s]Step899:rank0, time: 0.165, per_step: 0.001634
 78%|███████▊  | 785/1000 [00:03<00:00, 443.27it/s] 63%|██████▎   | 626/1000 [00:03<00:00, 381.57it/s]Step799:rank3, time: 0.223, per_step: 0.002209
 93%|█████████▎| 931/1000 [00:03<00:00, 539.79it/s] 80%|███████▉  | 795/1000 [00:03<00:00, 456.61it/s]Step799:rank1, time: 0.217, per_step: 0.002150
 83%|████████▎ | 830/1000 [00:03<00:00, 433.69it/s] 66%|██████▋   | 665/1000 [00:03<00:00, 362.62it/s] 84%|████████▍ | 841/1000 [00:03<00:00, 456.80it/s] 99%|█████████▊| 986/1000 [00:03<00:00, 484.43it/s]Step999:rank0, time: 0.233, per_step: 0.002309
100%|██████████| 1000/1000 [00:03<00:00, 251.56it/s]
 87%|████████▋ | 874/1000 [00:03<00:00, 413.10it/s]Step699:rank2, time: 0.296, per_step: 0.002929
 70%|███████   | 702/1000 [00:04<00:00, 355.84it/s] 89%|████████▊ | 887/1000 [00:04<00:00, 433.56it/s]Step899:rank3, time: 0.251, per_step: 0.002482
Step899:rank1, time: 0.237, per_step: 0.002344
 92%|█████████▏| 919/1000 [00:04<00:00, 422.39it/s] 93%|█████████▎| 933/1000 [00:04<00:00, 438.70it/s] 74%|███████▍  | 738/1000 [00:04<00:00, 332.22it/s] 97%|█████████▋| 966/1000 [00:04<00:00, 435.24it/s] 98%|█████████▊| 978/1000 [00:04<00:00, 440.11it/s] 77%|███████▋  | 772/1000 [00:04<00:00, 315.91it/s]Step999:rank3, time: 0.233, per_step: 0.002303
100%|██████████| 1000/1000 [00:04<00:00, 233.35it/s]
Step999:rank1, time: 0.236, per_step: 0.002336
100%|██████████| 1000/1000 [00:04<00:00, 232.18it/s]
Step799:rank2, time: 0.311, per_step: 0.003081
 86%|████████▌ | 857/1000 [00:04<00:00, 459.07it/s]Step899:rank2, time: 0.064, per_step: 0.000632
Step999:rank2, time: 0.050, per_step: 0.000495
100%|██████████| 1000/1000 [00:04<00:00, 225.28it/s]
Worker 3 pid=30625
Successfully xmh

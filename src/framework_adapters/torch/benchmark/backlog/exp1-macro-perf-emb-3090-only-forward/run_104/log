perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f752c6a0e50>==========
Worker 0 pid=746
Worker 1 pid=747
Worker 2 pid=748
Worker 3 pid=749
Worker 4 pid=750
Worker 5 pid=751
Worker 6 pid=752
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank5, time: 0.102, per_step: 0.001017
 10%|█         | 101/1000 [00:00<00:01, 879.27it/s]Step199:rank5, time: 0.108, per_step: 0.001065
 26%|██▌       | 257/1000 [00:00<00:00, 1254.15it/s]Step299:rank5, time: 0.051, per_step: 0.000505
Step399:rank5, time: 0.040, per_step: 0.000400
Step499:rank5, time: 0.041, per_step: 0.000402
 50%|█████     | 503/1000 [00:00<00:00, 1784.12it/s]Step599:rank5, time: 0.041, per_step: 0.000402
Step699:rank5, time: 0.040, per_step: 0.000399
 75%|███████▌  | 750/1000 [00:00<00:00, 2048.83it/s]Step799:rank5, time: 0.040, per_step: 0.000401
Step899:rank5, time: 0.040, per_step: 0.000395
Step999:rank5, time: 0.040, per_step: 0.000394
100%|██████████| 1000/1000 [00:00<00:00, 1940.24it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<02:52,  5.78it/s]  0%|          | 1/1000 [00:00<03:53,  4.28it/s]  0%|          | 1/1000 [00:00<05:11,  3.21it/s]  0%|          | 1/1000 [00:00<04:35,  3.63it/s]  0%|          | 1/1000 [00:00<03:55,  4.24it/s]  5%|▌         | 54/1000 [00:00<00:03, 239.68it/s]  0%|          | 1/1000 [00:00<03:46,  4.42it/s]  1%|▏         | 14/1000 [00:00<00:23, 41.93it/s]  0%|          | 1/1000 [00:00<04:07,  4.03it/s]  2%|▏         | 22/1000 [00:00<00:12, 76.12it/s]  2%|▏         | 20/1000 [00:00<00:13, 73.40it/s]  2%|▏         | 24/1000 [00:00<00:13, 72.93it/s] 10%|▉         | 97/1000 [00:00<00:02, 313.43it/s]  7%|▋         | 71/1000 [00:00<00:03, 273.30it/s]Step99:rank6, time: 0.390, per_step: 0.003898
  7%|▋         | 67/1000 [00:00<00:04, 190.16it/s]  7%|▋         | 67/1000 [00:00<00:03, 243.41it/s]Step99:rank3, time: 0.353, per_step: 0.003530
  8%|▊         | 77/1000 [00:00<00:03, 234.25it/s]  7%|▋         | 68/1000 [00:00<00:04, 214.51it/s]Step99:rank2, time: 0.373, per_step: 0.003732
Step99:rank7, time: 0.502, per_step: 0.005023
  7%|▋         | 73/1000 [00:00<00:04, 198.07it/s]Step99:rank1, time: 0.483, per_step: 0.004831
Step99:rank4, time: 0.540, per_step: 0.005397
Step99:rank0, time: 0.582, per_step: 0.005821
Step199:rank6, time: 0.074, per_step: 0.000735
Step199:rank3, time: 0.064, per_step: 0.000637
Step199:rank2, time: 0.058, per_step: 0.000571
Step199:rank7, time: 0.046, per_step: 0.000452
 25%|██▌       | 251/1000 [00:00<00:00, 750.97it/s] 25%|██▍       | 248/1000 [00:00<00:00, 804.67it/s]Step199:rank0, time: 0.049, per_step: 0.000485
 20%|██        | 200/1000 [00:00<00:01, 535.13it/s] 26%|██▌       | 259/1000 [00:00<00:00, 817.41it/s]Step199:rank1, time: 0.065, per_step: 0.000647
Step299:rank6, time: 0.045, per_step: 0.000445
Step199:rank4, time: 0.059, per_step: 0.000587
 28%|██▊       | 282/1000 [00:00<00:00, 819.91it/s]Step299:rank3, time: 0.040, per_step: 0.000398
 22%|██▏       | 220/1000 [00:00<00:01, 646.18it/s]Step299:rank7, time: 0.039, per_step: 0.000386
Step299:rank2, time: 0.040, per_step: 0.000400
 26%|██▋       | 263/1000 [00:00<00:01, 710.45it/s]Step299:rank0, time: 0.040, per_step: 0.000392
Step399:rank6, time: 0.039, per_step: 0.000386
Step299:rank4, time: 0.040, per_step: 0.000399
Step399:rank3, time: 0.039, per_step: 0.000389
Step399:rank7, time: 0.039, per_step: 0.000385
Step299:rank1, time: 0.053, per_step: 0.000529
Step399:rank2, time: 0.040, per_step: 0.000394
Step399:rank0, time: 0.039, per_step: 0.000386
Step499:rank6, time: 0.039, per_step: 0.000385
 50%|█████     | 503/1000 [00:00<00:00, 1348.33it/s]Step399:rank4, time: 0.039, per_step: 0.000390
Step499:rank3, time: 0.039, per_step: 0.000390
 50%|█████     | 502/1000 [00:00<00:00, 1387.22it/s]Step499:rank7, time: 0.039, per_step: 0.000383
Step499:rank2, time: 0.040, per_step: 0.000395
 46%|████▌     | 455/1000 [00:00<00:00, 1143.25it/s] 51%|█████     | 510/1000 [00:00<00:00, 1372.20it/s] 54%|█████▍    | 540/1000 [00:00<00:00, 1374.02it/s]Step399:rank1, time: 0.053, per_step: 0.000528
 41%|████      | 408/1000 [00:00<00:00, 1040.88it/s]Step499:rank0, time: 0.039, per_step: 0.000386
Step599:rank6, time: 0.039, per_step: 0.000386
Step499:rank4, time: 0.040, per_step: 0.000391
Step599:rank3, time: 0.039, per_step: 0.000391
Step599:rank7, time: 0.039, per_step: 0.000385
 52%|█████▏    | 516/1000 [00:00<00:00, 1257.02it/s]Step599:rank2, time: 0.040, per_step: 0.000397
Step599:rank0, time: 0.039, per_step: 0.000384
Step499:rank1, time: 0.053, per_step: 0.000529
Step699:rank6, time: 0.039, per_step: 0.000385
Step699:rank3, time: 0.039, per_step: 0.000390
Step599:rank4, time: 0.040, per_step: 0.000393
Step699:rank7, time: 0.039, per_step: 0.000384
Step699:rank2, time: 0.040, per_step: 0.000394
 76%|███████▌  | 760/1000 [00:00<00:00, 1745.38it/s] 76%|███████▌  | 756/1000 [00:00<00:00, 1760.58it/s]Step699:rank0, time: 0.039, per_step: 0.000384
 71%|███████▏  | 713/1000 [00:00<00:00, 1575.24it/s] 76%|███████▌  | 761/1000 [00:00<00:00, 1734.98it/s]Step799:rank6, time: 0.039, per_step: 0.000386
Step799:rank3, time: 0.039, per_step: 0.000391
Step699:rank4, time: 0.039, per_step: 0.000391
 80%|███████▉  | 798/1000 [00:00<00:00, 1747.92it/s]Step799:rank7, time: 0.039, per_step: 0.000385
 60%|█████▉    | 596/1000 [00:00<00:00, 1303.84it/s]Step799:rank2, time: 0.040, per_step: 0.000395
Step599:rank1, time: 0.053, per_step: 0.000528
Step799:rank0, time: 0.039, per_step: 0.000383
 77%|███████▋  | 770/1000 [00:00<00:00, 1640.48it/s]Step899:rank6, time: 0.039, per_step: 0.000384
Step899:rank3, time: 0.039, per_step: 0.000389
Step799:rank4, time: 0.040, per_step: 0.000393
Step899:rank7, time: 0.039, per_step: 0.000382
Step899:rank2, time: 0.040, per_step: 0.000393
Step699:rank1, time: 0.053, per_step: 0.000525
Step899:rank0, time: 0.039, per_step: 0.000386
Step999:rank6, time: 0.039, per_step: 0.000384
100%|██████████| 1000/1000 [00:00<00:00, 1298.97it/s]
Step999:rank3, time: 0.040, per_step: 0.000399
100%|██████████| 1000/1000 [00:00<00:00, 1380.01it/s]
Step899:rank4, time: 0.040, per_step: 0.000398
Step999:rank7, time: 0.040, per_step: 0.000394
100%|██████████| 1000/1000 [00:00<00:00, 1197.09it/s]
Step999:rank2, time: 0.041, per_step: 0.000405
100%|██████████| 1000/1000 [00:00<00:00, 1341.47it/s]
 96%|█████████▋| 965/1000 [00:00<00:00, 1857.50it/s]Step999:rank0, time: 0.043, per_step: 0.000421
100%|██████████| 1000/1000 [00:00<00:00, 1068.15it/s]
 78%|███████▊  | 781/1000 [00:00<00:00, 1471.84it/s]Step799:rank1, time: 0.055, per_step: 0.000549
Step999:rank4, time: 0.044, per_step: 0.000437
100%|██████████| 1000/1000 [00:00<00:00, 1100.38it/s]
Step899:rank1, time: 0.054, per_step: 0.000533
 97%|█████████▋| 967/1000 [00:00<00:00, 1588.74it/s]Step999:rank1, time: 0.057, per_step: 0.000562
100%|██████████| 1000/1000 [00:00<00:00, 1039.51it/s]
Worker 7 pid=753
Successfully xmh

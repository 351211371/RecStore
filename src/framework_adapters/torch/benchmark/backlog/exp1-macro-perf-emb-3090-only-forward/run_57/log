perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7ff2cf278e50>==========
Worker 0 pid=3494
Worker 1 pid=3495
Worker 2 pid=3496
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<29:13,  1.76s/it]  0%|          | 1/1000 [00:01<29:52,  1.79s/it]  0%|          | 1/1000 [00:01<30:20,  1.82s/it]  1%|          | 7/1000 [00:01<03:19,  4.98it/s]  0%|          | 1/1000 [00:01<31:25,  1.89s/it]  1%|          | 6/1000 [00:01<03:56,  4.20it/s]  1%|          | 6/1000 [00:01<04:01,  4.11it/s]  1%|▏         | 13/1000 [00:01<01:36, 10.21it/s]  1%|          | 12/1000 [00:02<01:44,  9.45it/s]  1%|          | 6/1000 [00:02<04:10,  3.96it/s]  1%|          | 12/1000 [00:02<01:46,  9.31it/s]  2%|▏         | 20/1000 [00:02<00:56, 17.23it/s]  1%|          | 11/1000 [00:02<02:02,  8.10it/s]  2%|▏         | 19/1000 [00:02<00:59, 16.46it/s]  2%|▏         | 19/1000 [00:02<01:00, 16.19it/s]  3%|▎         | 28/1000 [00:02<00:37, 26.05it/s]  2%|▏         | 18/1000 [00:02<01:05, 15.06it/s]  3%|▎         | 27/1000 [00:02<00:38, 25.19it/s]  3%|▎         | 27/1000 [00:02<00:39, 24.89it/s]  4%|▎         | 37/1000 [00:02<00:26, 36.66it/s]  2%|▎         | 25/1000 [00:02<00:43, 22.42it/s]  4%|▎         | 36/1000 [00:02<00:27, 35.66it/s]  4%|▎         | 36/1000 [00:02<00:27, 35.17it/s]  5%|▍         | 48/1000 [00:02<00:18, 50.15it/s]  3%|▎         | 32/1000 [00:02<00:32, 30.07it/s]  5%|▍         | 46/1000 [00:02<00:20, 47.66it/s]  5%|▍         | 46/1000 [00:02<00:20, 46.80it/s]  6%|▌         | 61/1000 [00:02<00:14, 66.30it/s]  4%|▍         | 40/1000 [00:02<00:24, 39.25it/s]  6%|▌         | 58/1000 [00:02<00:15, 62.70it/s]  6%|▌         | 57/1000 [00:02<00:15, 60.09it/s]  8%|▊         | 76/1000 [00:02<00:10, 85.13it/s]  5%|▌         | 51/1000 [00:02<00:17, 53.43it/s]  7%|▋         | 72/1000 [00:02<00:11, 80.39it/s]  7%|▋         | 70/1000 [00:02<00:12, 76.20it/s]  9%|▉         | 94/1000 [00:02<00:08, 107.71it/s]  6%|▋         | 64/1000 [00:02<00:13, 70.76it/s]  9%|▉         | 89/1000 [00:02<00:08, 102.01it/s]Step99:rank1, time: 2.763, per_step: 0.027628
  9%|▊         | 86/1000 [00:02<00:09, 96.05it/s]Step99:rank2, time: 2.813, per_step: 0.028126
 11%|█▏        | 114/1000 [00:02<00:06, 131.59it/s]  8%|▊         | 77/1000 [00:02<00:10, 84.90it/s] 11%|█         | 109/1000 [00:02<00:07, 126.83it/s]Step99:rank0, time: 2.871, per_step: 0.028706
 10%|█         | 105/1000 [00:02<00:07, 119.33it/s] 14%|█▍        | 138/1000 [00:02<00:05, 160.47it/s]  9%|▉         | 94/1000 [00:02<00:08, 106.27it/s] 13%|█▎        | 133/1000 [00:02<00:05, 156.13it/s]Step99:rank3, time: 2.994, per_step: 0.029937
 13%|█▎        | 127/1000 [00:02<00:05, 145.99it/s] 17%|█▋        | 166/1000 [00:03<00:04, 192.57it/s] 11%|█         | 112/1000 [00:03<00:07, 124.69it/s] 16%|█▌        | 161/1000 [00:03<00:04, 189.57it/s] 15%|█▌        | 153/1000 [00:03<00:04, 176.79it/s] 20%|█▉        | 196/1000 [00:03<00:03, 222.97it/s]Step199:rank1, time: 0.385, per_step: 0.003812
 14%|█▎        | 136/1000 [00:03<00:05, 156.29it/s] 19%|█▉        | 192/1000 [00:03<00:03, 223.13it/s]Step199:rank2, time: 0.377, per_step: 0.003730
 18%|█▊        | 182/1000 [00:03<00:03, 207.85it/s] 23%|██▎       | 228/1000 [00:03<00:03, 250.34it/s]Step199:rank0, time: 0.390, per_step: 0.003861
 16%|█▌        | 160/1000 [00:03<00:04, 178.79it/s] 22%|██▎       | 225/1000 [00:03<00:03, 251.80it/s] 21%|██▏       | 213/1000 [00:03<00:03, 236.34it/s] 26%|██▌       | 261/1000 [00:03<00:02, 273.38it/s] 19%|█▉        | 188/1000 [00:03<00:03, 207.30it/s] 26%|██▌       | 260/1000 [00:03<00:02, 278.61it/s]Step199:rank3, time: 0.407, per_step: 0.004028
 25%|██▍       | 246/1000 [00:03<00:02, 261.50it/s] 30%|██▉       | 295/1000 [00:03<00:02, 292.35it/s]Step299:rank1, time: 0.304, per_step: 0.003010
 22%|██▏       | 219/1000 [00:03<00:03, 235.97it/s] 30%|██▉       | 295/1000 [00:03<00:02, 299.26it/s]Step299:rank2, time: 0.293, per_step: 0.002897
 28%|██▊       | 279/1000 [00:03<00:02, 279.17it/s] 33%|███▎      | 329/1000 [00:03<00:02, 304.66it/s] 25%|██▍       | 249/1000 [00:03<00:02, 253.07it/s] 33%|███▎      | 330/1000 [00:03<00:02, 313.74it/s]Step299:rank0, time: 0.310, per_step: 0.003070
 31%|███▏      | 313/1000 [00:03<00:02, 295.30it/s] 36%|███▋      | 364/1000 [00:03<00:02, 315.45it/s] 28%|██▊       | 279/1000 [00:03<00:02, 266.06it/s] 36%|███▋      | 365/1000 [00:03<00:01, 323.88it/s] 35%|███▍      | 347/1000 [00:03<00:02, 307.98it/s]Step299:rank3, time: 0.324, per_step: 0.003205
 40%|███▉      | 399/1000 [00:03<00:01, 324.25it/s]Step399:rank1, time: 0.294, per_step: 0.002913
Step399:rank2, time: 0.285, per_step: 0.002824
 32%|███▏      | 317/1000 [00:03<00:02, 298.94it/s] 40%|████      | 401/1000 [00:03<00:01, 332.68it/s] 38%|███▊      | 381/1000 [00:03<00:01, 315.24it/s] 43%|████▎     | 434/1000 [00:03<00:01, 330.46it/s] 36%|███▌      | 355/1000 [00:03<00:02, 321.61it/s] 44%|████▎     | 435/1000 [00:03<00:01, 333.73it/s]Step399:rank0, time: 0.336, per_step: 0.003327
 41%|████▏     | 413/1000 [00:03<00:02, 283.85it/s] 39%|███▉      | 388/1000 [00:03<00:01, 313.92it/s] 47%|████▋     | 468/1000 [00:03<00:01, 281.69it/s]Step399:rank3, time: 0.288, per_step: 0.002853
 47%|████▋     | 469/1000 [00:04<00:01, 297.52it/s] 44%|████▍     | 445/1000 [00:04<00:01, 293.01it/s] 42%|████▏     | 423/1000 [00:04<00:01, 323.64it/s]Step499:rank2, time: 0.334, per_step: 0.003306
Step499:rank1, time: 0.361, per_step: 0.003577
 50%|█████     | 500/1000 [00:04<00:01, 290.40it/s] 50%|█████     | 503/1000 [00:04<00:01, 307.79it/s] 48%|████▊     | 478/1000 [00:04<00:01, 300.59it/s] 53%|█████▎    | 533/1000 [00:04<00:01, 300.22it/s] 54%|█████▍    | 539/1000 [00:04<00:01, 321.75it/s]Step499:rank0, time: 0.314, per_step: 0.003108
 46%|████▌     | 456/1000 [00:04<00:01, 278.38it/s] 51%|█████     | 512/1000 [00:04<00:01, 311.32it/s] 57%|█████▋    | 568/1000 [00:04<00:01, 312.85it/s] 58%|█████▊    | 576/1000 [00:04<00:01, 332.94it/s] 49%|████▉     | 493/1000 [00:04<00:01, 300.07it/s] 55%|█████▍    | 547/1000 [00:04<00:01, 320.51it/s]Step499:rank3, time: 0.354, per_step: 0.003502
Step599:rank2, time: 0.286, per_step: 0.002830
Step599:rank1, time: 0.294, per_step: 0.002914
 60%|██████    | 603/1000 [00:04<00:01, 322.91it/s] 61%|██████    | 612/1000 [00:04<00:01, 339.72it/s] 52%|█████▎    | 525/1000 [00:04<00:01, 301.19it/s] 58%|█████▊    | 582/1000 [00:04<00:01, 328.34it/s] 64%|██████▍   | 638/1000 [00:04<00:01, 330.39it/s]Step599:rank0, time: 0.296, per_step: 0.002932
 65%|██████▍   | 648/1000 [00:04<00:01, 345.28it/s] 56%|█████▌    | 556/1000 [00:04<00:01, 300.99it/s] 62%|██████▏   | 616/1000 [00:04<00:01, 328.39it/s] 67%|██████▋   | 672/1000 [00:04<00:01, 318.19it/s] 68%|██████▊   | 683/1000 [00:04<00:00, 333.19it/s] 59%|█████▉    | 593/1000 [00:04<00:01, 319.78it/s]Step599:rank3, time: 0.304, per_step: 0.003009
 65%|██████▍   | 649/1000 [00:04<00:01, 311.17it/s]Step699:rank2, time: 0.299, per_step: 0.002964
Step699:rank1, time: 0.311, per_step: 0.003078
 70%|███████   | 705/1000 [00:04<00:00, 320.27it/s] 72%|███████▏  | 718/1000 [00:04<00:00, 336.28it/s] 63%|██████▎   | 628/1000 [00:04<00:01, 325.94it/s] 68%|██████▊   | 683/1000 [00:04<00:00, 318.26it/s] 74%|███████▍  | 740/1000 [00:04<00:00, 328.59it/s]Step699:rank0, time: 0.317, per_step: 0.003135
 75%|███████▌  | 754/1000 [00:04<00:00, 341.49it/s] 66%|██████▌   | 661/1000 [00:04<00:01, 320.93it/s] 72%|███████▏  | 718/1000 [00:04<00:00, 325.45it/s] 78%|███████▊  | 775/1000 [00:04<00:00, 334.04it/s] 79%|███████▉  | 790/1000 [00:04<00:00, 346.81it/s] 69%|██████▉   | 694/1000 [00:04<00:00, 315.91it/s]Step799:rank2, time: 0.283, per_step: 0.002803
 75%|███████▌  | 753/1000 [00:04<00:00, 330.62it/s]Step699:rank3, time: 0.319, per_step: 0.003159
Step799:rank1, time: 0.291, per_step: 0.002879
 81%|████████  | 809/1000 [00:05<00:00, 335.77it/s] 82%|████████▎ | 825/1000 [00:05<00:00, 346.87it/s] 73%|███████▎  | 726/1000 [00:05<00:00, 313.90it/s] 79%|███████▉  | 788/1000 [00:05<00:00, 334.31it/s]Step799:rank0, time: 0.297, per_step: 0.002938
 86%|████████▌ | 860/1000 [00:05<00:00, 343.62it/s] 84%|████████▍ | 843/1000 [00:05<00:00, 311.24it/s] 76%|███████▌  | 758/1000 [00:05<00:00, 309.67it/s] 82%|████████▏ | 822/1000 [00:05<00:00, 305.90it/s] 79%|███████▉  | 790/1000 [00:05<00:00, 312.32it/s] 88%|████████▊ | 875/1000 [00:05<00:00, 291.54it/s]Step799:rank3, time: 0.317, per_step: 0.003136
 90%|████████▉ | 895/1000 [00:05<00:00, 289.17it/s]Step899:rank2, time: 0.356, per_step: 0.003524
 85%|████████▌ | 854/1000 [00:05<00:00, 289.42it/s]Step899:rank1, time: 0.354, per_step: 0.003504
 82%|████████▏ | 824/1000 [00:05<00:00, 300.51it/s] 90%|█████████ | 905/1000 [00:05<00:00, 278.11it/s] 93%|█████████▎| 928/1000 [00:05<00:00, 299.14it/s] 89%|████████▊ | 886/1000 [00:05<00:00, 297.05it/s]Step899:rank0, time: 0.364, per_step: 0.003605
 86%|████████▌ | 859/1000 [00:05<00:00, 314.09it/s] 94%|█████████▍| 940/1000 [00:05<00:00, 295.34it/s] 96%|█████████▋| 964/1000 [00:05<00:00, 313.40it/s] 92%|█████████▏| 917/1000 [00:05<00:00, 299.70it/s] 90%|████████▉ | 897/1000 [00:05<00:00, 332.43it/s] 97%|█████████▋| 973/1000 [00:05<00:00, 303.63it/s]100%|█████████▉| 997/1000 [00:05<00:00, 317.86it/s]Step899:rank3, time: 0.308, per_step: 0.003051
Step999:rank2, time: 0.297, per_step: 0.002941
100%|██████████| 1000/1000 [00:05<00:00, 178.23it/s]
 95%|█████████▌| 951/1000 [00:05<00:00, 310.74it/s]Step999:rank1, time: 0.312, per_step: 0.003087
100%|██████████| 1000/1000 [00:05<00:00, 176.76it/s]
 93%|█████████▎| 934/1000 [00:05<00:00, 341.61it/s]100%|█████████▉| 998/1000 [00:05<00:00, 354.27it/s]Step999:rank0, time: 0.261, per_step: 0.002582
100%|██████████| 1000/1000 [00:05<00:00, 174.12it/s]
Step999:rank3, time: 0.171, per_step: 0.001696
100%|██████████| 1000/1000 [00:05<00:00, 173.20it/s]
Worker 3 pid=3497
Successfully xmh

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 21:15:57.440749 26204 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_13', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [26204 sampler.py:454] Start PreSampling
WARNING [26204 sampler.py:532] Before construct renumbering_dict
WARNING [26204 sampler.py:555] PreSampling done
W20240129 21:34:44.667243 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 21:34:44.667455 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 21:34:44.667495 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 21:34:44.667526 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 21:34:44.667567 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 21:34:44.667603 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 21:34:44.667646 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 21:34:44.667692 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 21:34:44.667732 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 21:34:44.667778 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 21:34:44.667819 26204 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 21:34:44.667860 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 21:34:44.667886 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 21:34:44.668074 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 21:34:44.668110 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 21:34:44.668138 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 21:34:44.668179 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 21:34:44.668205 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 21:34:44.668236 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 21:34:44.668264 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 21:34:44.668298 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 21:34:44.668329 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 21:34:44.668362 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 21:34:44.668391 26204 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 21:34:44.668414 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 21:34:44.668438 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 21:34:44.668495 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 21:34:44.668527 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 21:34:44.668555 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 21:34:44.668586 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 21:34:44.668619 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 21:34:44.668659 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 21:34:44.668692 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 21:34:44.668727 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 21:34:44.668759 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 21:34:44.668788 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 21:34:44.668826 26204 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 21:34:44.668849 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 21:34:44.668875 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 21:34:44.668939 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 21:34:44.668970 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 21:34:44.668998 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 21:34:44.669034 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 21:34:44.669073 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 21:34:44.669106 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 21:34:44.669142 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 21:34:44.669169 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 21:34:44.669203 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 21:34:44.669234 26204 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 21:34:44.669267 26204 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 21:34:44.669289 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 21:34:44.669312 26204 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 21:34:45.146337 26204 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240129 21:34:45.146490 26204 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Rank2: cached key size 2151353
Rank3: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 8605412,  8605413,   138374,  ..., 62909057, 18718537,  4753990]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1635.023 seconds
[Rank1] pid = 27060
[Rank2] pid = 27154
INFO [27060 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [26204 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [27154 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [27223 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [27223 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [27154 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [26204 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [27060 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 21:43:17.726315 27224 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [8605415, 400]; dev=3; size=12.82 GB
W20240129 21:43:17.726430 27155 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [8605415, 400]; dev=2; size=12.82 GB
W20240129 21:43:17.727757 27288 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [8605415, 400]; dev=0; size=12.82 GB
W20240129 21:43:17.729266 27061 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [8605415, 400]; dev=1; size=12.82 GB
W20240129 21:43:17.816813 27061 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102037d02000 7.629 MB
W20240129 21:43:17.816807 27155 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10203755f000 7.629 MB
W20240129 21:43:17.816802 27288 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102036dbc000 7.629 MB
W20240129 21:43:17.816802 27224 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036619000 7.629 MB
W20240129 21:43:17.817183 27155 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020384a5000 7.629 MB
W20240129 21:43:17.817194 27288 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x102038c48000 7.629 MB
W20240129 21:43:17.817230 27224 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1020393eb000 7.629 MB
W20240129 21:43:17.817251 27288 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x102039b8e000 1.49 GB
W20240129 21:43:17.817276 27061 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102099171000 7.629 MB
W20240129 21:43:17.817287 27288 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x102099914000 1.49 GB
W20240129 21:43:17.817308 27155 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240129 21:43:17.817320 27224 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1021584da000 1.49 GB
W20240129 21:43:17.817368 27061 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1021b7abd000 1.49 GB
W20240129 21:43:17.817378 27288 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 21:43:17.817392 27224 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1022170a0000 1.49 GB
W20240129 21:43:17.817407 27155 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x102276683000 1.49 GB
W20240129 21:43:17.817426 27061 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1022d5c66000 1.49 GB
W20240129 21:43:17.817466 27224 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 21:43:17.817489 27155 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 21:43:17.817514 27061 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 21:43:17.824323 27288 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 21:43:17.824373 27224 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 21:43:17.824388 27155 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 21:43:17.824393 27061 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [27223 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [27060 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 27223
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 8605415), (8605415, 17210830), (17210830, 25816245), (25816245, 34421660)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [26204 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [27154 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 21:43:51.776582 27061 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240129 21:43:51.776688 27155 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 21:43:51.776821 27224 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 21:43:51.776955 27288 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240129 21:43:53.240592 27224 recstore.cc:66] init folly done
E20240129 21:43:53.240746 27288 recstore.cc:66] init folly done
E20240129 21:43:53.240747 27155 recstore.cc:66] init folly done
E20240129 21:43:53.240758 27061 recstore.cc:66] init folly done
I20240129 21:44:04.288389 27224 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240129 21:44:07.267292 27155 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 21:44:07.732965 27061 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 21:44:08.386299 27288 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 21.157 ms                 | 105.414 ms                |
| Forward                   | 4.892 ms                  | 622.440 ms                |
| Backward                  | 140.487 ms                | 1.564 s                   |
| Optimize                  | 38.389 ms                 | 63.559 ms                 |
| BarrierTimeBeforeRank0    | 81.558 us                 | 129.628 us                |
| BlockToStepN              | 18.175 us                 | 34.521 us                 |
| OneStep                   | 198.420 ms                | 2.276 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.479 ms                  | 105.414 ms                |
| Forward                   | 4.877 ms                  | 622.440 ms                |
| Backward                  | 135.878 ms                | 1.564 s                   |
| Optimize                  | 41.260 ms                 | 64.861 ms                 |
| BarrierTimeBeforeRank0    | 51.300 us                 | 129.628 us                |
| BlockToStepN              | 20.385 us                 | 15.347 ms                 |
| OneStep                   | 204.730 ms                | 2.276 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.572 ms                  | 100.588 ms                |
| Forward                   | 4.895 ms                  | 7.400 ms                  |
| Backward                  | 136.492 ms                | 187.105 ms                |
| Optimize                  | 40.489 ms                 | 77.454 ms                 |
| BarrierTimeBeforeRank0    | 47.231 us                 | 124.148 us                |
| BlockToStepN              | 20.416 us                 | 7.360 ms                  |
| OneStep                   | 198.420 ms                | 302.263 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.224 ms                  | 100.588 ms                |
| Forward                   | 4.941 ms                  | 7.400 ms                  |
| Backward                  | 137.303 ms                | 187.105 ms                |
| Optimize                  | 40.262 ms                 | 77.454 ms                 |
| BarrierTimeBeforeRank0    | 39.398 us                 | 124.148 us                |
| BlockToStepN              | 21.037 us                 | 15.347 ms                 |
| OneStep                   | 197.793 ms                | 302.263 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 23.794, sample: 1.347, forward: 1.121, backward: 10.656, update: 0.348
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 23.328, sample: 1.558, forward: 1.126, backward: 10.908, update: 0.397
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 26.773, sample: 1.471, forward: 1.081, backward: 10.658, update: 0.337
train_sampler.Prefill()
-------Step 0-------
tensor([ 1566772,   847680, 50377248,  2082372,   569493,   847719,   847767,
          274621,  1566788,  1566826]) tensor([ 9043739, 28963353,  1692809, 55061545, 59734786,  2049755, 73243347,
        78473665, 51446886, 82128065])
-------Step 1-------
tensor([ 1566772,   847680, 50377248,  2082372,   569493,   847719,   847767,
          274621,  1566788,  1566826]) tensor([30476911, 79579798, 73788138, 14336364, 63777209, 12432882, 84592042,
        72598519, 22448079, 37066512])
-------Step 2-------
tensor([  963448,  1579560, 77309327,  1579594,   963489,   963533,   963576,
        46454538,   963608,   963651]) tensor([35625358,  9025004, 55695963, 13981076, 19980328, 16143009, 63991170,
        13254282, 53703961, 32294310])
-------Step 3-------
tensor([  963448,  1579560, 77309327,  1579594,   963489,   963533,   963576,
        46454538,   963608,   963651]) tensor([  615811, 43545115,  1792714, 43610388, 18933956, 72881564, 76191327,
        66473828, 27092389, 81336576])
-------Step 4-------
tensor([1078021, 1593166, 1078059, 1078087, 1593207, 1078131, 1593250, 1078163,
        1593286, 1078194]) tensor([ 4267948, 44706964, 21044307,  1969545, 52709103, 49562475, 83404078,
        54147808, 51732543, 13291031])
-------Step 5-------
tensor([1078021, 1593166, 1078059, 1078087, 1593207, 1078131, 1593250, 1078163,
        1593286, 1078194]) tensor([39082306, 50274850, 83683100, 13464223, 36631233,   700690, 41857329,
        65273869, 85367130,  1907933])
-------Step 6-------
tensor([68337969,  1190014,  1190057,  1190097,  8609400,  1190141,  1190183,
         1190217,  1190250,   281165]) tensor([28046806, 41751099, 30885342, 23271670, 79847047, 51709446, 40967898,
        19275653, 72001444, 12735950])
-------Step 7-------
tensor([68337969,  1190014,  1190057,  1190097,  8609400,  1190141,  1190183,
         1190217,  1190250,   281165]) tensor([44291241, 79967639, 57550501, 75233301, 62334991,  2604358, 21305656,
        53469229, 25270248, 18608420])
-------Step 8-------
tensor([ 1300378,  1618190,  1300427, 39438663,  2096277,  1300471,  1300506,
         1300552,   283222,  2096286]) tensor([28987666, 52463962, 45511402, 80952692, 76294316, 58363259, 56251337,
        74726134, 14514014,  7781469])
-------Step 9-------
tensor([ 1300378,  1618190,  1300427, 39438663,  2096277,  1300471,  1300506,
         1300552,   283222,  2096286]) tensor([78223188, 58627120, 30069431, 41186503, 15371627,  1886734, 23866884,
        17761101, 83494763, 43352556])
before start barrier
start train
[proc 0] 100 steps, total: 22.675, sample: 1.470, forward: 1.108, backward: 15.709, update: 4.218
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.464 ms                  | 100.588 ms                |
| Forward                   | 4.888 ms                  | 7.400 ms                  |
| Backward                  | 140.487 ms                | 187.105 ms                |
| Optimize                  | 40.045 ms                 | 77.454 ms                 |
| BarrierTimeBeforeRank0    | 38.124 us                 | 124.148 us                |
| BlockToStepN              | 20.816 us                 | 15.347 ms                 |
| OneStep                   | 197.026 ms                | 302.263 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.499 ms                  | 100.588 ms                |
| Forward                   | 4.887 ms                  | 7.400 ms                  |
| Backward                  | 138.233 ms                | 187.105 ms                |
| Optimize                  | 39.686 ms                 | 77.454 ms                 |
| BarrierTimeBeforeRank0    | 37.948 us                 | 124.148 us                |
| BlockToStepN              | 20.655 us                 | 15.347 ms                 |
| OneStep                   | 193.882 ms                | 302.263 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.842 ms                  | 92.895 ms                 |
| Forward                   | 4.887 ms                  | 7.400 ms                  |
| Backward                  | 138.429 ms                | 187.105 ms                |
| Optimize                  | 38.513 ms                 | 64.861 ms                 |
| BarrierTimeBeforeRank0    | 37.867 us                 | 97.300 us                 |
| BlockToStepN              | 20.655 us                 | 13.016 ms                 |
| OneStep                   | 193.246 ms                | 287.718 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.637 ms                  | 92.895 ms                 |
| Forward                   | 4.892 ms                  | 21.430 ms                 |
| Backward                  | 138.429 ms                | 187.105 ms                |
| Optimize                  | 39.137 ms                 | 64.861 ms                 |
| BarrierTimeBeforeRank0    | 37.663 us                 | 97.300 us                 |
| BlockToStepN              | 20.816 us                 | 13.016 ms                 |
| OneStep                   | 191.970 ms                | 287.718 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 19.637, sample: 1.268, forward: 0.527, backward: 13.893, update: 3.866
[proc 1] 200 steps, total: 19.637, sample: 1.225, forward: 0.507, backward: 9.414, update: 0.367
[proc 3] 200 steps, total: 19.637, sample: 1.135, forward: 0.503, backward: 9.058, update: 0.332
[proc 2] 200 steps, total: 19.637, sample: 1.134, forward: 0.511, backward: 9.047, update: 0.349
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.770 ms                  | 93.876 ms                 |
| Forward                   | 4.873 ms                  | 21.430 ms                 |
| Backward                  | 137.193 ms                | 187.105 ms                |
| Optimize                  | 38.963 ms                 | 64.861 ms                 |
| BarrierTimeBeforeRank0    | 37.676 us                 | 97.300 us                 |
| BlockToStepN              | 20.967 us                 | 13.016 ms                 |
| OneStep                   | 190.879 ms                | 287.718 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.637 ms                  | 93.876 ms                 |
| Forward                   | 4.855 ms                  | 21.430 ms                 |
| Backward                  | 137.017 ms                | 187.105 ms                |
| Optimize                  | 38.733 ms                 | 64.861 ms                 |
| BarrierTimeBeforeRank0    | 37.538 us                 | 97.300 us                 |
| BlockToStepN              | 21.048 us                 | 15.347 ms                 |
| OneStep                   | 190.290 ms                | 287.718 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.221 ms                  | 92.895 ms                 |
| Forward                   | 4.892 ms                  | 8.144 ms                  |
| Backward                  | 137.076 ms                | 187.105 ms                |
| Optimize                  | 38.513 ms                 | 63.559 ms                 |
| BarrierTimeBeforeRank0    | 37.388 us                 | 96.947 us                 |
| BlockToStepN              | 21.131 us                 | 13.016 ms                 |
| OneStep                   | 189.875 ms                | 281.502 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.048 ms                  | 93.876 ms                 |
| Forward                   | 4.896 ms                  | 8.144 ms                  |
| Backward                  | 137.200 ms                | 187.105 ms                |
| Optimize                  | 38.351 ms                 | 63.559 ms                 |
| BarrierTimeBeforeRank0    | 37.168 us                 | 96.947 us                 |
| BlockToStepN              | 21.330 us                 | 13.016 ms                 |
| OneStep                   | 189.855 ms                | 287.718 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 19.325, sample: 1.020, forward: 0.526, backward: 9.080, update: 0.242
[proc 3] 300 steps, total: 19.325, sample: 1.012, forward: 0.518, backward: 8.795, update: 0.354
[proc 0] 300 steps, total: 19.325, sample: 1.022, forward: 0.490, backward: 13.948, update: 3.769
[proc 2] 300 steps, total: 19.325, sample: 1.025, forward: 0.519, backward: 8.808, update: 0.372
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.048 ms                  | 93.876 ms                 |
| Forward                   | 4.888 ms                  | 9.118 ms                  |
| Backward                  | 137.017 ms                | 187.105 ms                |
| Optimize                  | 38.211 ms                 | 63.559 ms                 |
| BarrierTimeBeforeRank0    | 37.138 us                 | 96.947 us                 |
| BlockToStepN              | 21.363 us                 | 13.016 ms                 |
| OneStep                   | 188.127 ms                | 287.718 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.110 ms                  | 93.876 ms                 |
| Forward                   | 4.888 ms                  | 9.118 ms                  |
| Backward                  | 136.597 ms                | 187.105 ms                |
| Optimize                  | 37.906 ms                 | 63.559 ms                 |
| BarrierTimeBeforeRank0    | 37.017 us                 | 96.947 us                 |
| BlockToStepN              | 21.287 us                 | 15.155 ms                 |
| OneStep                   | 187.588 ms                | 287.718 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.038 ms                  | 92.895 ms                 |
| Forward                   | 4.877 ms                  | 8.144 ms                  |
| Backward                  | 136.270 ms                | 181.213 ms                |
| Optimize                  | 37.889 ms                 | 63.559 ms                 |
| BarrierTimeBeforeRank0    | 36.900 us                 | 96.743 us                 |
| BlockToStepN              | 21.311 us                 | 13.016 ms                 |
| OneStep                   | 187.468 ms                | 281.502 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.928 ms                  | 92.895 ms                 |
| Forward                   | 4.887 ms                  | 8.144 ms                  |
| Backward                  | 135.878 ms                | 181.213 ms                |
| Optimize                  | 38.316 ms                 | 63.767 ms                 |
| BarrierTimeBeforeRank0    | 36.824 us                 | 96.743 us                 |
| BlockToStepN              | 21.178 us                 | 13.016 ms                 |
| OneStep                   | 186.963 ms                | 281.502 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 18.575, sample: 1.000, forward: 0.481, backward: 13.073, update: 3.870
[proc 3] 400 steps, total: 18.575, sample: 0.967, forward: 0.516, backward: 8.794, update: 0.405
[proc 1] 400 steps, total: 18.575, sample: 1.042, forward: 0.500, backward: 9.002, update: 0.245
[proc 2] 400 steps, total: 18.575, sample: 0.964, forward: 0.505, backward: 8.731, update: 0.362
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.934 ms                  | 93.876 ms                 |
| Forward                   | 4.854 ms                  | 8.144 ms                  |
| Backward                  | 135.468 ms                | 181.213 ms                |
| Optimize                  | 38.268 ms                 | 63.767 ms                 |
| BarrierTimeBeforeRank0    | 36.774 us                 | 96.743 us                 |
| BlockToStepN              | 21.072 us                 | 13.016 ms                 |
| OneStep                   | 186.072 ms                | 281.502 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.960 ms                  | 93.876 ms                 |
| Forward                   | 4.877 ms                  | 8.144 ms                  |
| Backward                  | 135.265 ms                | 181.213 ms                |
| Optimize                  | 38.078 ms                 | 63.767 ms                 |
| BarrierTimeBeforeRank0    | 36.668 us                 | 96.743 us                 |
| BlockToStepN              | 21.048 us                 | 14.831 ms                 |
| OneStep                   | 185.593 ms                | 281.502 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.871 ms                  | 92.895 ms                 |
| Forward                   | 4.884 ms                  | 7.400 ms                  |
| Backward                  | 135.174 ms                | 179.340 ms                |
| Optimize                  | 38.059 ms                 | 63.559 ms                 |
| BarrierTimeBeforeRank0    | 36.515 us                 | 95.715 us                 |
| BlockToStepN              | 21.108 us                 | 14.831 ms                 |
| OneStep                   | 185.144 ms                | 280.042 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.783 ms                  | 92.895 ms                 |
| Forward                   | 4.903 ms                  | 7.400 ms                  |
| Backward                  | 134.670 ms                | 179.340 ms                |
| Optimize                  | 37.835 ms                 | 63.767 ms                 |
| BarrierTimeBeforeRank0    | 36.236 us                 | 95.715 us                 |
| BlockToStepN              | 20.969 us                 | 15.155 ms                 |
| OneStep                   | 184.724 ms                | 280.042 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 500 steps, total: 18.381, sample: 0.961, forward: 0.491, backward: 13.057, update: 3.736
[proc 1] 500 steps, total: 18.381, sample: 0.963, forward: 0.533, backward: 9.138, update: 0.241
[proc 2] 500 steps, total: 18.381, sample: 0.981, forward: 0.530, backward: 8.755, update: 0.358
[proc 3] 500 steps, total: 18.381, sample: 0.939, forward: 0.553, backward: 8.919, update: 0.379
Successfully xmh. training takes 98.59467673301697 seconds
before call kg_cache_controller.StopThreads()
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads
INFO [26204 controller_process.py:421] call rank0 to StopThreads

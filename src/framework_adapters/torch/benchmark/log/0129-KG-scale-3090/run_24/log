WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 13:27:58.638377 11970 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_28', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [11970 sampler.py:454] Start PreSampling
WARNING [11970 sampler.py:532] Before construct renumbering_dict
WARNING [11970 sampler.py:555] PreSampling done
W20240129 13:28:03.675264 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 13:28:03.675441 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 13:28:03.675490 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 13:28:03.675534 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 13:28:03.675570 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 13:28:03.675612 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 13:28:03.675645 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 13:28:03.675693 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 13:28:03.675729 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 13:28:03.675779 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 13:28:03.675827 11970 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 13:28:03.675858 11970 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 13:28:03.675896 11970 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 13:28:03.676018 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 13:28:03.676075 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 13:28:03.676112 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 13:28:03.676174 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 13:28:03.676210 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 13:28:03.676262 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 13:28:03.676303 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 13:28:03.676342 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 13:28:03.676380 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 13:28:03.676420 11970 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 13:28:03.676453 11970 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 13:28:03.676482 11970 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 13:28:03.676510 11970 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 13:28:03.941195 11970 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000098ca000 22.81 MB
W20240129 13:28:03.941373 11970 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000af9c000 58.4 kB
{0: Graph(num_nodes=13804, num_edges=289155,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12626, num_edges=379866,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13804 N 289155 E
MertisPartition: part 1 has 12626 N 379866 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  770,   834,   960,  ...,  9194, 10011,  9528]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.405 seconds
INFO [11970 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [12568 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [11970 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [12568 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240129 13:28:05.586876 12569 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240129 13:28:05.587774 12632 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240129 13:28:05.612891 12569 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10000afae000 7.629 MB
W20240129 13:28:05.613050 12569 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10000b751000 7.629 MB
W20240129 13:28:05.613101 12569 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10000bef4000 1.49 GB
W20240129 13:28:05.613153 12569 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10006b4d7000 1.49 GB
W20240129 13:28:05.613224 12569 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 13:28:05.614985 12569 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 13:28:05.617939 12632 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000caac0000 7.629 MB
W20240129 13:28:05.618075 12632 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000cb263000 7.629 MB
W20240129 13:28:05.618158 12632 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000cba06000 1.49 GB
W20240129 13:28:05.618208 12632 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10012afe9000 1.49 GB
W20240129 13:28:05.618265 12632 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 13:28:05.621460 12632 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
[Rank1] pid = 12568
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
cudaHostRegister 0x1000098ca000
0: KnownLocalCachedEmbedding init done
WARNING [11970 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x1000098ca000
1: KnownLocalCachedEmbedding init done
WARNING [12568 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 13:28:06.879724 12632 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240129 13:28:06.880244 12569 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240129 13:28:06.882894 12569 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 13:28:06.883199 12569 grad_base.h:184] Init GradProcessingBase done
I20240129 13:28:06.894516 12569 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240129 13:28:06.894697 12569 kg_controller.h:78] after init GradAsyncProcessingV2
I20240129 13:28:06.894716 12569 kg_controller.h:84] Construct KGCacheController done
E20240129 13:28:07.114902 12569 recstore.cc:66] init folly done
E20240129 13:28:07.114899 12632 recstore.cc:66] init folly done
I20240129 13:28:07.115689 12569 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 13:28:07.283641 12976 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 13:28:07.284154 12976 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240129 13:28:07.347201 12569 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240129 13:28:07.355376 12632 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
E20240129 13:28:08.699991 12851 parallel_pq_v2.h:76] insert failed, size(hashtable)=3
W20240129 13:28:08.723618 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240129 13:28:08.758554 12976 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 13:28:09.699062 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=3115
W20240129 13:28:09.733670 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=17, pq.top=16
W20240129 13:28:09.762570 12976 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 13:28:10.699016 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=9049
W20240129 13:28:10.733031 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=34, pq.top=34
W20240129 13:28:10.798571 12976 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 13:28:11.699019 12569 parallel_pq_v2.h:76] insert failed, size(hashtable)=1419
W20240129 13:28:11.733026 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=51, pq.top=51
W20240129 13:28:11.802889 12976 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.839 ms                  | 31.095 ms                 |
| Forward                   | 5.035 ms                  | 10.838 ms                 |
| Backward                  | 4.696 ms                  | 10.747 ms                 |
| Optimize                  | 2.192 ms                  | 4.894 ms                  |
| BarrierTimeBeforeRank0    | 27.539 us                 | 13.687 ms                 |
| AfterBackward             | 12.533 ms                 | 24.835 ms                 |
| BlockToStepN              | 26.391 ms                 | 35.681 ms                 |
| OneStep                   | 56.733 ms                 | 110.588 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 915.277 us                | 65.522 ms                 |
| ProcessBack:UpdateCache   | 521.715 us                | 145.786 ms                |
| ProcessBack:UpsertPq      | 9.937 ms                  | 22.727 ms                 |
| ProcessOneStep            | 12.640 ms                 | 24.781 ms                 |
| BlockToStepN              | 26.066 ms                 | 35.477 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 13:28:12.699014 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=9577
W20240129 13:28:12.733137 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=68, pq.top=68
W20240129 13:28:12.804828 12976 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
E20240129 13:28:13.699015 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=6713
W20240129 13:28:13.733065 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=85, pq.top=85
W20240129 13:28:13.824537 12976 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.240, sample: 0.488, forward: 1.216, backward: 0.925, update: 0.227
train_sampler.Prefill()
-------Step 0-------
tensor([  257,  4691,  8414,  6491,  3165, 11155,  3350,  8429,  6076,  8098]) tensor([  996,  8089, 10109, 11289, 14598,  8118,  5226,   553,  7383, 10851])
-------Step 1-------
tensor([  257,  4691,  8414,  6491,  3165, 11155,  3350,  8429,  6076,  8098]) tensor([ 9553,  3317,   509,   386,  7362,  7659, 11121,  9165,  1753,  4319])
-------Step 2-------
tensor([ 4361,  8642,    89,  2928, 12383,  3082,  8851,   658,  1636,  9336]) tensor([ 3888,   458,  1510,  1703,  5673,  9006, 12627, 14761, 10453,  7707])
-------Step 3-------
tensor([ 4361,  8642,    89,  2928, 12383,  3082,  8851,   658,  1636,  9336]) tensor([ 2719,   452, 10872, 13233,  3504,   606, 11697, 11936,  2869,  4657])
-------Step 4-------
tensor([ 8950, 11680,   315,    50,  3137, 14443,  7699,  4170,  7879, 12570]) tensor([12438,  5004,  3415,  8697,  9254,  3651,  8949, 12910,   780, 10165])
-------Step 5-------
tensor([ 8950, 11680,   315,    50,  3137, 14443,  7699,  4170,  7879, 12570]) tensor([ 8624, 13465, 11940, 10770,  2401, 10314,  9214, 10098,  6001, 11511])
-------Step 6-------
tensor([  146,  9137,   356,   224,   799,  5899,  6814,  5782,   267, 14523]) tensor([ 7676,  3416,  3090,  3489,  8856,  9160, 11935, 11702, 10157,  3650])
-------Step 7-------
tensor([  146,  9137,   356,   224,   799,  5899,  6814,  5782,   267, 14523]) tensor([ 9843,   151,  2990, 13380,   900,  6560,  1036, 11130, 10204, 10921])
-------Step 8-------
tensor([11807,  8337,   152,   265,  4048,  3303,  7634,  7243,  1425, 13549]) tensor([  363,  4316,    47,  1851, 11400,  6156,  5240,  2111, 12014, 14730])
-------Step 9-------
tensor([11807,  8337,   152,   265,  4048,  3303,  7634,  7243,  1425, 13549]) tensor([12017, 10312,  4213,  3858,  3283, 12817,  8942,  6603,  6129, 14490])
before start barrier
start train
[proc 0] 100 steps, total: 7.248, sample: 0.534, forward: 1.267, backward: 0.705, update: 0.246
E20240129 13:28:14.699018 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=4567
W20240129 13:28:14.747007 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=103, pq.top=102
W20240129 13:28:14.846084 12976 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 13:28:15.699012 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=6593
W20240129 13:28:15.757835 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=120, pq.top=120
W20240129 13:28:15.865919 12976 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 13:28:16.700816 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=4791
W20240129 13:28:16.762357 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=136, pq.top=135
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.917 ms                  | 31.979 ms                 |
| Forward                   | 4.954 ms                  | 10.838 ms                 |
| Backward                  | 4.699 ms                  | 10.747 ms                 |
| Optimize                  | 2.217 ms                  | 5.001 ms                  |
| BarrierTimeBeforeRank0    | 52.688 us                 | 13.687 ms                 |
| AfterBackward             | 13.086 ms                 | 26.590 ms                 |
| BlockToStepN              | 26.016 ms                 | 35.760 ms                 |
| OneStep                   | 56.347 ms                 | 110.588 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:28:16.892937 12976 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 947.312 us                | 2.241 ms                  |
| ProcessBack:UpdateCache   | 496.388 us                | 5.122 ms                  |
| ProcessBack:UpsertPq      | 10.065 ms                 | 22.933 ms                 |
| ProcessOneStep            | 13.107 ms                 | 26.528 ms                 |
| BlockToStepN              | 25.769 ms                 | 35.703 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 13:28:17.726954 12569 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 13:28:17.790598 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=153, pq.top=152
W20240129 13:28:17.893297 12976 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 13:28:18.726009 12976 parallel_pq_v2.h:76] insert failed, size(hashtable)=75
W20240129 13:28:18.793749 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=170, pq.top=169
W20240129 13:28:18.934202 12976 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 13:28:19.726015 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=7537
W20240129 13:28:19.807664 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=188, pq.top=188
W20240129 13:28:19.956813 12976 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
[proc 1] 200 steps, total: 5.931, sample: 0.538, forward: 0.475, backward: 0.533, update: 0.225
[proc 0] 200 steps, total: 5.930, sample: 0.594, forward: 0.488, backward: 0.459, update: 0.225
E20240129 13:28:20.726012 12851 parallel_pq_v2.h:76] insert failed, size(hashtable)=571
W20240129 13:28:20.834091 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=206, pq.top=206
W20240129 13:28:20.960846 12976 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 13:28:21.726012 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=8977
W20240129 13:28:21.834102 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=224, pq.top=224
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.015 ms                  | 31.879 ms                 |
| Forward                   | 4.991 ms                  | 9.550 ms                  |
| Backward                  | 4.714 ms                  | 9.212 ms                  |
| Optimize                  | 2.231 ms                  | 5.113 ms                  |
| BarrierTimeBeforeRank0    | 34.384 us                 | 13.687 ms                 |
| AfterBackward             | 13.706 ms                 | 26.590 ms                 |
| BlockToStepN              | 24.974 ms                 | 42.770 ms                 |
| OneStep                   | 55.324 ms                 | 93.913 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 13:28:22.002050 12976 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 947.312 us                | 2.685 ms                  |
| ProcessBack:UpdateCache   | 494.101 us                | 1.285 ms                  |
| ProcessBack:UpsertPq      | 10.075 ms                 | 22.744 ms                 |
| ProcessOneStep            | 13.750 ms                 | 26.528 ms                 |
| BlockToStepN              | 24.708 ms                 | 42.710 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 13:28:22.726014 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=5439
W20240129 13:28:22.834537 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=242, pq.top=242
W20240129 13:28:23.002746 12976 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 13:28:23.727277 12976 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 13:28:23.849289 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=260, pq.top=260
W20240129 13:28:24.009145 12976 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 13:28:24.727008 12569 parallel_pq_v2.h:76] insert failed, size(hashtable)=2720
W20240129 13:28:24.849288 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=278, pq.top=278
W20240129 13:28:25.036537 12976 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 13:28:25.727016 12851 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 13:28:25.914660 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=296, pq.top=295
W20240129 13:28:26.053211 12976 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
[proc 0] 300 steps, total: 5.608, sample: 0.582, forward: 0.507, backward: 0.463, update: 0.243
[proc 1] 300 steps, total: 5.609, sample: 0.511, forward: 0.454, backward: 0.509, update: 0.228
E20240129 13:28:26.727775 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=5334
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.115 ms                  | 32.218 ms                 |
| Forward                   | 5.025 ms                  | 8.558 ms                  |
| Backward                  | 4.732 ms                  | 7.278 ms                  |
| Optimize                  | 2.275 ms                  | 5.148 ms                  |
| BarrierTimeBeforeRank0    | 30.064 us                 | 14.518 ms                 |
| AfterBackward             | 13.902 ms                 | 26.529 ms                 |
| BlockToStepN              | 24.023 ms                 | 42.025 ms                 |
| OneStep                   | 54.496 ms                 | 93.913 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 13:28:26.938993 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=315, pq.top=315
W20240129 13:28:27.067739 12976 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 950.265 us                | 2.640 ms                  |
| ProcessBack:UpdateCache   | 493.070 us                | 1.083 ms                  |
| ProcessBack:UpsertPq      | 10.107 ms                 | 22.727 ms                 |
| ProcessOneStep            | 13.853 ms                 | 26.504 ms                 |
| BlockToStepN              | 23.899 ms                 | 41.955 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 13:28:27.727011 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=9635
W20240129 13:28:27.954973 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=334, pq.top=334
W20240129 13:28:28.069976 12976 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
E20240129 13:28:28.727013 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=3747
W20240129 13:28:28.982621 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=353, pq.top=353
W20240129 13:28:29.095178 12976 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 13:28:29.727010 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=12572
W20240129 13:28:29.985749 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=371, pq.top=371
W20240129 13:28:30.119618 12976 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 13:28:30.727011 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=13487
W20240129 13:28:30.985407 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=387, pq.top=387
W20240129 13:28:31.133293 12976 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
E20240129 13:28:31.728120 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=13021
[proc 0] 400 steps, total: 5.635, sample: 0.558, forward: 0.536, backward: 0.476, update: 0.272
[proc 1] 400 steps, total: 5.635, sample: 0.624, forward: 0.585, backward: 0.483, update: 0.294
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.155 ms                  | 32.218 ms                 |
| Forward                   | 5.075 ms                  | 8.494 ms                  |
| Backward                  | 4.757 ms                  | 7.278 ms                  |
| Optimize                  | 2.310 ms                  | 5.148 ms                  |
| BarrierTimeBeforeRank0    | 35.125 us                 | 37.398 ms                 |
| AfterBackward             | 14.014 ms                 | 25.528 ms                 |
| BlockToStepN              | 23.097 ms                 | 42.025 ms                 |
| OneStep                   | 53.950 ms                 | 98.107 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 13:28:31.994313 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=403, pq.top=403
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 950.265 us                | 2.241 ms                  |
| ProcessBack:UpdateCache   | 492.178 us                | 831.008 us                |
| ProcessBack:UpsertPq      | 10.133 ms                 | 22.207 ms                 |
| ProcessOneStep            | 13.988 ms                 | 25.503 ms                 |
| BlockToStepN              | 22.987 ms                 | 41.955 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 13:28:32.151803 12976 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 13:28:32.728013 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=12260
W20240129 13:28:33.000173 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=419, pq.top=419
W20240129 13:28:33.164907 12976 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 13:28:33.728806 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=12982
W20240129 13:28:34.000422 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=435, pq.top=435
W20240129 13:28:34.183432 12976 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 13:28:34.728014 12975 parallel_pq_v2.h:76] insert failed, size(hashtable)=11676
W20240129 13:28:35.016676 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=452, pq.top=452
W20240129 13:28:35.191208 12976 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 13:28:35.728009 12569 parallel_pq_v2.h:76] insert failed, size(hashtable)=846
W20240129 13:28:36.038843 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=468, pq.top=467
W20240129 13:28:36.193696 12976 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 13:28:36.728010 12851 parallel_pq_v2.h:76] insert failed, size(hashtable)=397
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.216 ms                  | 31.979 ms                 |
| Forward                   | 5.102 ms                  | 8.119 ms                  |
| Backward                  | 4.785 ms                  | 7.278 ms                  |
| Optimize                  | 2.312 ms                  | 5.141 ms                  |
| BarrierTimeBeforeRank0    | 51.703 us                 | 42.741 ms                 |
| AfterBackward             | 14.146 ms                 | 24.835 ms                 |
| BlockToStepN              | 22.950 ms                 | 41.701 ms                 |
| OneStep                   | 54.342 ms                 | 99.416 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 13:28:37.038589 12569 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=485, pq.top=485
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 950.265 us                | 2.032 ms                  |
| ProcessBack:UpdateCache   | 491.188 us                | 809.726 us                |
| ProcessBack:UpsertPq      | 10.242 ms                 | 22.207 ms                 |
| ProcessOneStep            | 14.114 ms                 | 24.781 ms                 |
| BlockToStepN              | 22.850 ms                 | 41.561 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 13:28:37.206411 12976 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 13:28:37.728399 12976 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
[proc 1] 500 steps, total: 6.200, sample: 0.726, forward: 0.667, backward: 0.475, update: 0.301
[proc 0] 500 steps, total: 6.200, sample: 0.562, forward: 0.501, backward: 0.483, update: 0.235
Successfully xmh. training takes 30.62285614013672 seconds
before call kg_cache_controller.StopThreads()
W20240129 13:28:37.970116 12569 grad_async_v2.h:71] call StopThreads. PID = 11970
W20240129 13:28:37.970146 12569 grad_base.h:212] before processOneStepNegThread_.join();
W20240129 13:28:37.971019 12569 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 13:28:37.971035 12569 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240129 13:28:37.975795 12569 grad_async_v2.h:92] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f60fba24790>

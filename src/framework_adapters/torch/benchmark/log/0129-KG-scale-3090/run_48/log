WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 14:15:44.809156 50799 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_0', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Partitoning with metis
[14:34:57] /home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/src/graph/transform/metis_partition_hetero.cc:87: Partition a graph with 86054151 nodes and 421063214 edges into 4 parts and get 18842328 edge cuts
WARNING [50799 sampler.py:454] Start PreSampling
WARNING [50799 sampler.py:532] Before construct renumbering_dict
WARNING [50799 sampler.py:555] PreSampling done
W20240129 14:45:52.123973 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 14:45:52.124193 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 14:45:52.124234 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 14:45:52.124269 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 14:45:52.124307 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 14:45:52.124338 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 14:45:52.124372 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 14:45:52.124415 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 14:45:52.124447 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 14:45:52.124490 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 14:45:52.124524 50799 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 14:45:52.124552 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 14:45:52.124578 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 14:45:52.124738 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 14:45:52.124789 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 14:45:52.124821 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 14:45:52.124850 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 14:45:52.124881 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 14:45:52.124918 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 14:45:52.124953 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 14:45:52.124989 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 14:45:52.125036 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 14:45:52.125069 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 14:45:52.125101 50799 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 14:45:52.125124 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 14:45:52.125149 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 14:45:52.125206 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 14:45:52.125247 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 14:45:52.125283 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 14:45:52.125309 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 14:45:52.125339 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 14:45:52.125378 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 14:45:52.125407 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 14:45:52.125434 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 14:45:52.125475 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 14:45:52.125514 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 14:45:52.125541 50799 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 14:45:52.125564 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 14:45:52.125587 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 14:45:52.125640 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 14:45:52.125674 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 14:45:52.125702 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 14:45:52.125730 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 14:45:52.125759 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 14:45:52.125794 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 14:45:52.125824 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 14:45:52.125855 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 14:45:52.125890 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 14:45:52.125919 50799 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 14:45:52.125950 50799 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 14:45:52.125977 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 14:45:52.126005 50799 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 14:45:52.932861 50799 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240129 14:45:52.933009 50799 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
Convert a graph into a bidirected graph: 53.809 seconds, peak memory: 265.172 GB
Construct multi-constraint weights: 0.001 seconds, peak memory: 265.172 GB
Metis partitioning: 439.348 seconds, peak memory: 276.572 GB
Split the graph: 137.681 seconds
Construct subgraphs: 21.514 seconds
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302704,  4302707,   110006,  ..., 67385050, 15613253,  2579172]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2318.399 seconds
[Rank1] pid = 4666
[Rank2] pid = 4760
INFO [50799 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [4666 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [4760 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [4827 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [4827 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4760 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 14:54:28.623636  4828 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240129 14:54:28.623646  4761 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
INFO [50799 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4666 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 14:54:28.627449  4891 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240129 14:54:28.631209  4667 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240129 14:54:28.681963  4828 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036619000 7.629 MB
W20240129 14:54:28.681969  4761 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x102036dbc000 7.629 MB
W20240129 14:54:28.682018  4667 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10203755f000 7.629 MB
W20240129 14:54:28.682111  4891 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102037d02000 7.629 MB
W20240129 14:54:28.682168  4761 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020384a5000 7.629 MB
W20240129 14:54:28.682178  4828 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x102038c48000 7.629 MB
W20240129 14:54:28.682235  4667 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1020393eb000 7.629 MB
W20240129 14:54:28.682286  4828 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102039b8e000 1.49 GB
W20240129 14:54:28.682358  4828 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x102099171000 1.49 GB
W20240129 14:54:28.682396  4667 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1020f8754000 1.49 GB
W20240129 14:54:28.682404  4761 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x102157d37000 1.49 GB
W20240129 14:54:28.682435  4828 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 14:54:28.682477  4667 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1021b731a000 1.49 GB
W20240129 14:54:28.682502  4761 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1022168fd000 1.49 GB
W20240129 14:54:28.682514  4891 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x102275ee0000 7.629 MB
W20240129 14:54:28.682564  4761 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 14:54:28.682574  4667 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 14:54:28.682585  4891 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x102276683000 1.49 GB
W20240129 14:54:28.682619  4891 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1022d5c66000 1.49 GB
W20240129 14:54:28.682675  4891 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 14:54:28.688578  4891 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 14:54:28.688597  4761 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 14:54:28.688608  4828 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 14:54:28.688623  4667 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [4760 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [4666 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 4827
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [50799 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [4827 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 14:55:01.725375  4828 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240129 14:55:01.725734  4667 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 14:55:01.725911  4761 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 14:55:01.726045  4891 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240129 14:55:01.729005  4891 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 14:55:01.729293  4891 grad_base.h:184] Init GradProcessingBase done
I20240129 14:55:13.896644  4891 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240129 14:55:13.896831  4891 kg_controller.h:78] after init GradAsyncProcessingV2
I20240129 14:55:13.896852  4891 kg_controller.h:84] Construct KGCacheController done
E20240129 14:55:14.336846  4761 recstore.cc:66] init folly done
E20240129 14:55:14.336879  4828 recstore.cc:66] init folly done
E20240129 14:55:14.336890  4667 recstore.cc:66] init folly done
E20240129 14:55:14.336884  4891 recstore.cc:66] init folly done
I20240129 14:55:14.337937  4891 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 14:55:26.865370  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 14:55:26.865849  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 14:55:30.425706  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 14:55:30.425830  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 14:55:32.490070  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 14:55:32.500694  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240129 14:55:32.701990  4828 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
W20240129 14:55:33.679147  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 14:55:33.679258  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 14:55:36.957825  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 14:55:36.958012  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 14:55:43.201506  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 14:55:43.235306  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240129 14:55:43.721659  4891 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240129 14:55:45.616855  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 14:55:45.635730  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240129 14:55:45.804870  4667 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240129 14:55:49.385737  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 14:55:49.404022  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240129 14:55:49.451118  4761 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240129 14:55:51.345705  4891 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240129 14:55:51.414814  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240129 14:55:51.441330  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 61.597 ms                 | 64.081 ms                 |
| Forward                   | 9.692 ms                  | 805.712 ms                |
| Backward                  | 5.562 ms                  | 290.730 ms                |
| Optimize                  | 1.930 ms                  | 2.468 ms                  |
| BarrierTimeBeforeRank0    | 48.647 us                 | 51.783 us                 |
| AfterBackward             | 81.202 ms                 | 801.657 ms                |
| BlockToStepN              | 22.563 ms                 | 28.916 ms                 |
| OneStep                   | 185.827 ms                | 1.986 s                   |
+---------------------------+---------------------------+---------------------------+
E20240129 14:55:52.345016  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240129 14:55:52.445188  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
W20240129 14:55:52.577597  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=9, pq.top=9
E20240129 14:55:53.352723  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=9
W20240129 14:55:53.457203  5223 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end9
W20240129 14:55:53.645478  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=21, pq.top=21
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.467 ms                  | 197.172 ms                |
| ProcessBack:UpdateCache   | 2.315 ms                  | 381.213 ms                |
| ProcessBack:UpsertPq      | 10.899 ms                 | 68.242 ms                 |
| ProcessOneStep            | 32.887 ms                 | 801.153 ms                |
| BlockToStepN              | 1.873 ms                  | 54.518 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 14:55:54.352010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=9432
W20240129 14:55:54.536733  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end9
W20240129 14:55:54.645246  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=31, pq.top=31
E20240129 14:55:55.352010  4891 parallel_pq_v2.h:76] insert failed, size(hashtable)=120
W20240129 14:55:55.652814  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=42, pq.top=42
W20240129 14:55:55.681367  5223 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end3
E20240129 14:55:56.352008  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=310
W20240129 14:55:56.652067  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=52, pq.top=52
W20240129 14:55:56.692219  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 13.008 ms                 | 146.738 ms                |
| Forward                   | 4.952 ms                  | 9.692 ms                  |
| Backward                  | 8.340 ms                  | 8.719 ms                  |
| Optimize                  | 2.068 ms                  | 4.531 ms                  |
| BarrierTimeBeforeRank0    | 35.332 us                 | 10.881 ms                 |
| AfterBackward             | 32.267 ms                 | 237.207 ms                |
| BlockToStepN              | 8.859 ms                  | 54.488 ms                 |
| OneStep                   | 87.979 ms                 | 256.902 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:55:57.352206  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=10681
W20240129 14:55:57.652091  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=61, pq.top=61
W20240129 14:55:57.763785  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end3
E20240129 14:55:58.352010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=67
W20240129 14:55:58.727962  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=72, pq.top=72
W20240129 14:55:58.916579  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.494 ms                  | 23.112 ms                 |
| ProcessBack:UpdateCache   | 2.361 ms                  | 19.137 ms                 |
| ProcessBack:UpsertPq      | 13.705 ms                 | 63.507 ms                 |
| ProcessOneStep            | 32.236 ms                 | 237.164 ms                |
| BlockToStepN              | 15.657 ms                 | 62.243 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 14:55:59.352008  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=22146
W20240129 14:55:59.727128  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=83, pq.top=83
W20240129 14:56:00.053146  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end6
E20240129 14:56:00.352010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=94
W20240129 14:56:00.741155  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=89, pq.top=89
W20240129 14:56:01.063418  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end3
E20240129 14:56:01.352010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=3214
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 12.274, sample: 1.359, forward: 1.332, backward: 0.779, update: 0.230
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 15.920, sample: 1.835, forward: 1.354, backward: 0.687, update: 0.218
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 29.023, sample: 2.018, forward: 1.410, backward: 0.853, update: 0.238
train_sampler.Prefill()
-------Step 0-------
tensor([   75351,   704957, 39573189,   789907,   481070,   704992,   705022,
          226629,    75390,    75431]) tensor([ 5003762, 31241723, 23531998, 50393098, 60894545, 32574378, 72760543,
        78540361, 54058132, 84016702])
-------Step 1-------
tensor([   75351,   704957, 39573189,   789907,   481070,   704992,   705022,
          226629,    75390,    75431]) tensor([25745376, 76265749, 68091373, 11158439, 50961780,  9354392, 84625008,
        81930619, 16241395, 37942300])
-------Step 2-------
tensor([  805086,    87983, 78719971,    88012,   805114,   805139,   805184,
        48982923,   805216,   805252]) tensor([31887652,  4988361, 57907740, 10956745, 17125845, 11170344, 62161973,
         8802200, 48968332, 34798666])
-------Step 3-------
tensor([  805086,    87983, 78719971,    88012,   805114,   805139,   805184,
        48982923,   805216,   805252]) tensor([16620303, 39688141, 77417007, 33017950, 13224346, 71530619, 75268209,
        67000389, 20293960, 67201402])
-------Step 4-------
tensor([906335, 101005, 906375, 906415, 101033, 906448, 101070, 906469, 101099,
        906514]) tensor([57957582, 40740128, 18747068, 13805051, 61356483, 49892064, 70849303,
        42444667, 56689375,  8482316])
-------Step 5-------
tensor([906335, 101005, 906375, 906415, 101033, 906448, 101070, 906469, 101099,
        906514]) tensor([38572288, 50674601, 83556185, 10063720, 32887766, 31448080, 40615365,
        69554876, 85676015,   504950])
-------Step 6-------
tensor([79717660,   975371,   975397,   975416,  4309055,   975435,   975453,
          975479,   975493,   232332]) tensor([23819356, 37206024, 23048552, 17439627, 80698899, 56660095, 37205398,
        13509016, 64752178,  7820747])
-------Step 7-------
tensor([79717660,   975371,   975397,   975416,  4309055,   975435,   975453,
          975479,   975493,   232332]) tensor([34160132, 85279735, 45572987, 71308025, 58332426,  1729849, 19031581,
        57018871, 21773062, 13997131])
-------Step 8-------
tensor([ 1018678,   127821,  1018692, 29420694,   830414,  1018707,  1018722,
         1018734,   233970,   830440]) tensor([28469735, 47825385, 51888619, 76697526, 83216415, 70122567, 51569980,
        69064178, 11380354,  3240398])
-------Step 9-------
tensor([ 1018678,   127821,  1018692, 29420694,   830414,  1018707,  1018722,
         1018734,   233970,   830440]) tensor([74554587, 65147971, 26857771, 46067273, 10849716,   938879, 20424850,
        15536935, 71001504, 43897177])
before start barrier
start train
[proc 0] 100 steps, total: 18.004, sample: 2.285, forward: 1.309, backward: 0.890, update: 0.266
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.067 ms                  | 146.738 ms                |
| Forward                   | 5.084 ms                  | 9.692 ms                  |
| Backward                  | 5.037 ms                  | 8.719 ms                  |
| Optimize                  | 2.122 ms                  | 17.864 ms                 |
| BarrierTimeBeforeRank0    | 53.304 us                 | 32.131 ms                 |
| AfterBackward             | 31.808 ms                 | 448.958 ms                |
| BlockToStepN              | 19.358 ms                 | 77.078 ms                 |
| OneStep                   | 98.575 ms                 | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:01.807611  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=101, pq.top=101
W20240129 14:56:02.207229  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end4
E20240129 14:56:02.352010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=24689
W20240129 14:56:02.892691  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=111, pq.top=111
W20240129 14:56:03.332960  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end6
E20240129 14:56:03.352005  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240129 14:56:04.065454  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=121, pq.top=121
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.520 ms                  | 38.699 ms                 |
| ProcessBack:UpdateCache   | 2.369 ms                  | 19.137 ms                 |
| ProcessBack:UpsertPq      | 13.634 ms                 | 63.507 ms                 |
| ProcessOneStep            | 32.481 ms                 | 448.911 ms                |
| BlockToStepN              | 20.843 ms                 | 94.556 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:04.352006  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=3988
W20240129 14:56:04.387212  5223 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end2
W20240129 14:56:05.065140  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=128, pq.top=128
E20240129 14:56:05.352010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=15205
W20240129 14:56:05.434556  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end2
W20240129 14:56:06.065024  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=137, pq.top=137
E20240129 14:56:06.352572  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240129 14:56:06.471962  5223 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.581 ms                  | 146.738 ms                |
| Forward                   | 5.155 ms                  | 22.655 ms                 |
| Backward                  | 4.883 ms                  | 8.719 ms                  |
| Optimize                  | 2.182 ms                  | 17.864 ms                 |
| BarrierTimeBeforeRank0    | 75.382 us                 | 37.664 ms                 |
| AfterBackward             | 32.820 ms                 | 448.958 ms                |
| BlockToStepN              | 24.241 ms                 | 100.938 ms                |
| OneStep                   | 98.868 ms                 | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:07.065210  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=147, pq.top=147
E20240129 14:56:07.352013  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=6161
W20240129 14:56:07.621706  5223 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end1
W20240129 14:56:08.230157  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=153, pq.top=153
E20240129 14:56:08.352011  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=10604
W20240129 14:56:08.712970  5223 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end8
W20240129 14:56:09.262939  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=164, pq.top=164
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.581 ms                  | 23.112 ms                 |
| ProcessBack:UpdateCache   | 2.489 ms                  | 4.045 ms                  |
| ProcessBack:UpsertPq      | 14.668 ms                 | 63.507 ms                 |
| ProcessOneStep            | 32.716 ms                 | 448.911 ms                |
| BlockToStepN              | 26.164 ms                 | 100.843 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:09.352008  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=11020
W20240129 14:56:09.900863  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end0
W20240129 14:56:10.262184  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=173, pq.top=173
E20240129 14:56:10.352011  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=6646
W20240129 14:56:10.992426  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
W20240129 14:56:11.262337  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=181, pq.top=181
E20240129 14:56:11.352013  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=32127
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.993 ms                  | 136.805 ms                |
| Forward                   | 5.202 ms                  | 9.692 ms                  |
| Backward                  | 4.967 ms                  | 8.719 ms                  |
| Optimize                  | 2.203 ms                  | 5.050 ms                  |
| BarrierTimeBeforeRank0    | 55.198 us                 | 32.131 ms                 |
| AfterBackward             | 32.429 ms                 | 448.958 ms                |
| BlockToStepN              | 26.412 ms                 | 100.938 ms                |
| OneStep                   | 99.272 ms                 | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:12.048892  5223 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end9
W20240129 14:56:12.315874  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=191, pq.top=191
E20240129 14:56:12.352005  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=9534
W20240129 14:56:13.090588  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end7
E20240129 14:56:13.352008  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=3863
W20240129 14:56:13.368736  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=199, pq.top=199
[proc 3] 200 steps, total: 11.780, sample: 1.333, forward: 0.491, backward: 0.571, update: 0.216
[proc 1] 200 steps, total: 11.780, sample: 1.243, forward: 0.513, backward: 0.509, update: 0.217
[proc 2] 200 steps, total: 11.780, sample: 1.725, forward: 0.499, backward: 0.514, update: 0.213
[proc 0] 200 steps, total: 11.779, sample: 1.821, forward: 0.536, backward: 0.482, update: 0.232
W20240129 14:56:14.162751  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.647 ms                  | 17.030 ms                 |
| ProcessBack:UpdateCache   | 2.541 ms                  | 3.851 ms                  |
| ProcessBack:UpsertPq      | 14.275 ms                 | 62.760 ms                 |
| ProcessOneStep            | 32.120 ms                 | 448.911 ms                |
| BlockToStepN              | 28.837 ms                 | 119.702 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:14.352007  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=53301
W20240129 14:56:14.368387  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=209, pq.top=209
W20240129 14:56:15.270148  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end6
E20240129 14:56:15.352015  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=15129
W20240129 14:56:15.368409  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=217, pq.top=217
E20240129 14:56:16.352012  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1231
W20240129 14:56:16.376698  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=227, pq.top=226
W20240129 14:56:16.388264  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.067 ms                  | 136.805 ms                |
| Forward                   | 5.275 ms                  | 9.692 ms                  |
| Backward                  | 5.043 ms                  | 9.577 ms                  |
| Optimize                  | 2.209 ms                  | 5.050 ms                  |
| BarrierTimeBeforeRank0    | 36.451 us                 | 37.863 ms                 |
| AfterBackward             | 32.267 ms                 | 448.958 ms                |
| BlockToStepN              | 31.774 ms                 | 127.560 ms                |
| OneStep                   | 100.254 ms                | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:17.352008  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=2029
W20240129 14:56:17.376147  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=237, pq.top=237
W20240129 14:56:17.435011  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end7
E20240129 14:56:18.352006  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=35076
W20240129 14:56:18.379711  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=242, pq.top=241
W20240129 14:56:18.492899  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.703 ms                  | 23.112 ms                 |
| ProcessBack:UpdateCache   | 2.591 ms                  | 4.471 ms                  |
| ProcessBack:UpsertPq      | 14.065 ms                 | 63.507 ms                 |
| ProcessOneStep            | 32.236 ms                 | 448.911 ms                |
| BlockToStepN              | 31.471 ms                 | 132.359 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:19.352011  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1233
W20240129 14:56:19.383445  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=251, pq.top=251
W20240129 14:56:19.552134  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end3
E20240129 14:56:20.352012  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=58019
W20240129 14:56:20.549914  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=263, pq.top=263
W20240129 14:56:20.656554  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end3
E20240129 14:56:21.352010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=12856
W20240129 14:56:21.549461  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=273, pq.top=273
W20240129 14:56:21.672116  5223 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.285 ms                  | 130.942 ms                |
| Forward                   | 5.323 ms                  | 9.692 ms                  |
| Backward                  | 5.129 ms                  | 8.719 ms                  |
| Optimize                  | 2.213 ms                  | 4.998 ms                  |
| BarrierTimeBeforeRank0    | 34.214 us                 | 38.760 ms                 |
| AfterBackward             | 32.429 ms                 | 416.352 ms                |
| BlockToStepN              | 31.537 ms                 | 127.560 ms                |
| OneStep                   | 103.379 ms                | 434.224 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:22.352012  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1364
W20240129 14:56:22.557164  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=282, pq.top=282
W20240129 14:56:22.897684  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end6
E20240129 14:56:23.352070  4996 parallel_pq_v2.h:76] insert failed, size(hashtable)=4304
W20240129 14:56:23.557662  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=292, pq.top=292
W20240129 14:56:24.021806  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end4
E20240129 14:56:24.356490  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=472
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.701 ms                  | 17.030 ms                 |
| ProcessBack:UpdateCache   | 2.576 ms                  | 4.221 ms                  |
| ProcessBack:UpsertPq      | 14.293 ms                 | 66.145 ms                 |
| ProcessOneStep            | 32.464 ms                 | 448.911 ms                |
| BlockToStepN              | 29.819 ms                 | 127.448 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:24.663596  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=297, pq.top=297
[proc 1] 300 steps, total: 11.377, sample: 1.196, forward: 0.542, backward: 0.473, update: 0.216
[proc 0] 300 steps, total: 11.377, sample: 1.674, forward: 0.559, backward: 0.528, update: 0.230
[proc 2] 300 steps, total: 11.377, sample: 1.407, forward: 0.512, backward: 0.598, update: 0.215
[proc 3] 300 steps, total: 11.377, sample: 1.083, forward: 0.520, backward: 0.551, update: 0.220
W20240129 14:56:25.032927  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end2
E20240129 14:56:25.356017  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=28026
W20240129 14:56:25.746099  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=307, pq.top=307
W20240129 14:56:26.116431  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end9
E20240129 14:56:26.356016  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=2371
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.581 ms                  | 136.805 ms                |
| Forward                   | 5.357 ms                  | 9.971 ms                  |
| Backward                  | 5.131 ms                  | 8.719 ms                  |
| Optimize                  | 2.225 ms                  | 4.998 ms                  |
| BarrierTimeBeforeRank0    | 33.275 us                 | 38.760 ms                 |
| AfterBackward             | 32.750 ms                 | 448.958 ms                |
| BlockToStepN              | 28.916 ms                 | 195.996 ms                |
| OneStep                   | 103.441 ms                | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:26.787503  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=314, pq.top=314
W20240129 14:56:27.140064  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end7
E20240129 14:56:27.356009  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=28858
W20240129 14:56:27.838426  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=325, pq.top=325
E20240129 14:56:28.356010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=25190
W20240129 14:56:28.359306  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end7
W20240129 14:56:28.916009  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=333, pq.top=333
E20240129 14:56:29.356011  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=81860
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.712 ms                  | 16.584 ms                 |
| ProcessBack:UpdateCache   | 2.576 ms                  | 4.087 ms                  |
| ProcessBack:UpsertPq      | 14.293 ms                 | 66.145 ms                 |
| ProcessOneStep            | 32.655 ms                 | 448.911 ms                |
| BlockToStepN              | 29.633 ms                 | 195.875 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:29.597210  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
W20240129 14:56:29.975459  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=341, pq.top=340
E20240129 14:56:30.356015  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=38826
W20240129 14:56:30.668443  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end7
W20240129 14:56:30.975800  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=350, pq.top=350
E20240129 14:56:31.356010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=7255
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.746 ms                  | 130.942 ms                |
| Forward                   | 5.368 ms                  | 9.692 ms                  |
| Backward                  | 5.136 ms                  | 8.709 ms                  |
| Optimize                  | 2.218 ms                  | 4.833 ms                  |
| BarrierTimeBeforeRank0    | 32.007 us                 | 37.863 ms                 |
| AfterBackward             | 32.686 ms                 | 416.352 ms                |
| BlockToStepN              | 30.140 ms                 | 207.412 ms                |
| OneStep                   | 103.482 ms                | 434.224 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:31.768731  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end7
W20240129 14:56:32.032714  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=359, pq.top=359
E20240129 14:56:32.356011  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=10080
W20240129 14:56:32.893505  5223 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end5
W20240129 14:56:33.073906  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=367, pq.top=367
E20240129 14:56:33.356076  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=29084
W20240129 14:56:33.895406  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end5
W20240129 14:56:34.073572  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=375, pq.top=375
E20240129 14:56:34.356009  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=27151
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.713 ms                  | 16.101 ms                 |
| ProcessBack:UpdateCache   | 2.571 ms                  | 4.045 ms                  |
| ProcessBack:UpsertPq      | 13.889 ms                 | 67.260 ms                 |
| ProcessOneStep            | 32.788 ms                 | 416.296 ms                |
| BlockToStepN              | 30.482 ms                 | 207.279 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:34.903193  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end3
W20240129 14:56:35.162318  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=387, pq.top=387
E20240129 14:56:35.356011  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=154645
W20240129 14:56:36.115921  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
W20240129 14:56:36.305567  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=392, pq.top=392
E20240129 14:56:36.356016  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=25551
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.285 ms                  | 130.942 ms                |
| Forward                   | 5.362 ms                  | 9.692 ms                  |
| Backward                  | 5.152 ms                  | 8.709 ms                  |
| Optimize                  | 2.219 ms                  | 4.833 ms                  |
| BarrierTimeBeforeRank0    | 31.341 us                 | 37.863 ms                 |
| AfterBackward             | 32.820 ms                 | 416.352 ms                |
| BlockToStepN              | 31.136 ms                 | 214.415 ms                |
| OneStep                   | 103.935 ms                | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:37.131446  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
[proc 3] 400 steps, total: 12.375, sample: 1.067, forward: 0.505, backward: 0.543, update: 0.222
[proc 1] 400 steps, total: 12.375, sample: 1.107, forward: 0.546, backward: 0.519, update: 0.246
[proc 2] 400 steps, total: 12.375, sample: 1.120, forward: 0.492, backward: 0.545, update: 0.225
[proc 0] 400 steps, total: 12.375, sample: 1.731, forward: 0.538, backward: 0.510, update: 0.215
W20240129 14:56:37.313843  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=401, pq.top=401
E20240129 14:56:37.356014  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=76562
W20240129 14:56:38.135309  5223 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
E20240129 14:56:38.359932  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 14:56:38.382633  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=408, pq.top=408
W20240129 14:56:39.172109  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.712 ms                  | 16.584 ms                 |
| ProcessBack:UpdateCache   | 2.566 ms                  | 4.045 ms                  |
| ProcessBack:UpsertPq      | 13.792 ms                 | 68.414 ms                 |
| ProcessOneStep            | 32.832 ms                 | 416.296 ms                |
| BlockToStepN              | 31.471 ms                 | 217.881 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:39.359007  4891 parallel_pq_v2.h:76] insert failed, size(hashtable)=2108
W20240129 14:56:39.385890  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=417, pq.top=417
W20240129 14:56:40.267575  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end4
E20240129 14:56:40.359009  5222 parallel_pq_v2.h:76] insert failed, size(hashtable)=57318
W20240129 14:56:40.385797  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=425, pq.top=425
W20240129 14:56:41.335202  5223 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end4
E20240129 14:56:41.359010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=16039
W20240129 14:56:41.385181  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=434, pq.top=434
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.067 ms                  | 130.942 ms                |
| Forward                   | 5.351 ms                  | 9.692 ms                  |
| Backward                  | 5.157 ms                  | 8.709 ms                  |
| Optimize                  | 2.220 ms                  | 4.998 ms                  |
| BarrierTimeBeforeRank0    | 31.778 us                 | 37.863 ms                 |
| AfterBackward             | 32.901 ms                 | 416.352 ms                |
| BlockToStepN              | 31.964 ms                 | 263.381 ms                |
| OneStep                   | 105.264 ms                | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:42.365520  4891 parallel_pq_v2.h:76] insert failed, size(hashtable)=238
W20240129 14:56:42.396488  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=441, pq.top=441
W20240129 14:56:42.416983  5223 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end1
E20240129 14:56:43.365013  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=6415
W20240129 14:56:43.556237  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end8
W20240129 14:56:43.905217  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=449, pq.top=449
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.697 ms                  | 16.101 ms                 |
| ProcessBack:UpdateCache   | 2.563 ms                  | 4.010 ms                  |
| ProcessBack:UpsertPq      | 13.752 ms                 | 68.414 ms                 |
| ProcessOneStep            | 32.871 ms                 | 416.296 ms                |
| BlockToStepN              | 31.875 ms                 | 217.881 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:44.365031  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=14
W20240129 14:56:44.707522  5223 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end5
W20240129 14:56:44.949411  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=457, pq.top=457
E20240129 14:56:45.365010  4891 parallel_pq_v2.h:76] insert failed, size(hashtable)=9556
W20240129 14:56:45.804559  5223 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end7
W20240129 14:56:45.949714  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=467, pq.top=467
E20240129 14:56:46.365011  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=5847
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.322 ms                  | 122.762 ms                |
| Forward                   | 5.334 ms                  | 8.254 ms                  |
| Backward                  | 5.165 ms                  | 8.692 ms                  |
| Optimize                  | 2.216 ms                  | 4.887 ms                  |
| BarrierTimeBeforeRank0    | 31.800 us                 | 37.863 ms                 |
| AfterBackward             | 32.901 ms                 | 416.352 ms                |
| BlockToStepN              | 32.115 ms                 | 247.517 ms                |
| OneStep                   | 105.264 ms                | 474.341 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 14:56:46.948555  5223 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end4
E20240129 14:56:47.365016  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=9102
W20240129 14:56:47.429749  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=475, pq.top=475
W20240129 14:56:48.160583  5223 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end2
E20240129 14:56:48.365011  4891 parallel_pq_v2.h:76] insert failed, size(hashtable)=625
W20240129 14:56:48.646345  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=487, pq.top=487
W20240129 14:56:49.178923  5223 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.682 ms                  | 8.370 ms                  |
| ProcessBack:UpdateCache   | 2.566 ms                  | 3.914 ms                  |
| ProcessBack:UpsertPq      | 14.065 ms                 | 68.242 ms                 |
| ProcessOneStep            | 33.016 ms                 | 448.911 ms                |
| BlockToStepN              | 30.482 ms                 | 247.386 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 14:56:49.365010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=5377
W20240129 14:56:50.079025  4891 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=493, pq.top=493
W20240129 14:56:50.210739  5223 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end5
E20240129 14:56:50.365010  5223 parallel_pq_v2.h:76] insert failed, size(hashtable)=10387
[proc 2] 500 steps, total: 13.436, sample: 1.252, forward: 0.522, backward: 0.549, update: 0.226
[proc 0] 500 steps, total: 13.436, sample: 1.751, forward: 0.510, backward: 0.517, update: 0.232
[proc 3] 500 steps, total: 13.436, sample: 1.151, forward: 0.498, backward: 0.587, update: 0.227
[proc 1] 500 steps, total: 13.436, sample: 1.295, forward: 0.580, backward: 0.806, update: 0.242
Successfully xmh. training takes 66.97185611724854 seconds
before call kg_cache_controller.StopThreads()
W20240129 14:56:50.693481  4891 grad_async_v2.h:71] call StopThreads. PID = 50799
W20240129 14:56:50.693519  4891 grad_base.h:212] before processOneStepNegThread_.join();
W20240129 14:56:50.693908  4891 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 14:56:50.693918  4891 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240129 14:56:50.920799  4891 grad_async_v2.h:92] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.334 ms                  | 122.762 ms                |
| Forward                   | 5.334 ms                  | 8.254 ms                  |
| Backward                  | 5.176 ms                  | 8.692 ms                  |
| Optimize                  | 2.216 ms                  | 4.887 ms                  |
| BarrierTimeBeforeRank0    | 31.642 us                 | 37.863 ms                 |
| AfterBackward             | 33.060 ms                 | 490.518 ms                |
| BlockToStepN              | 30.032 ms                 | 247.517 ms                |
| OneStep                   | 103.441 ms                | 591.446 ms                |
+---------------------------+---------------------------+---------------------------+

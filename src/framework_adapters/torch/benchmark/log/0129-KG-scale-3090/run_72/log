WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240130 03:01:33.176779 19634 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_24', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Partitoning with metis
[03:20:22] /home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/src/graph/transform/metis_partition_hetero.cc:87: Partition a graph with 86054151 nodes and 421063214 edges into 2 parts and get 5664460 edge cuts
WARNING [19634 sampler.py:454] Start PreSampling
WARNING [19634 sampler.py:532] Before construct renumbering_dict
WARNING [19634 sampler.py:555] PreSampling done
W20240130 03:31:59.824191 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240130 03:31:59.824396 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240130 03:31:59.824432 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240130 03:31:59.824465 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240130 03:31:59.824501 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240130 03:31:59.824532 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240130 03:31:59.824566 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240130 03:31:59.824618 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240130 03:31:59.824651 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240130 03:31:59.824678 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240130 03:31:59.824731 19634 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240130 03:31:59.824762 19634 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240130 03:31:59.824796 19634 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240130 03:31:59.824954 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240130 03:31:59.825006 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240130 03:31:59.825037 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240130 03:31:59.825066 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240130 03:31:59.825104 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240130 03:31:59.825142 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240130 03:31:59.825178 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240130 03:31:59.825212 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240130 03:31:59.825243 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240130 03:31:59.825284 19634 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240130 03:31:59.825320 19634 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240130 03:31:59.825342 19634 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240130 03:31:59.825366 19634 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240130 03:32:00.507580 19634 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x1000098ca000 128.2 GB
W20240130 03:32:00.507742 19634 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102018502000 328.3 MB
Convert a graph into a bidirected graph: 53.507 seconds, peak memory: 265.173 GB
Construct multi-constraint weights: 0.001 seconds, peak memory: 265.173 GB
Metis partitioning: 417.450 seconds, peak memory: 274.696 GB
Split the graph: 225.026 seconds
Construct subgraphs: 15.729 seconds
MertisPartition: part 0 has 43196088 N 182879791 E
MertisPartition: part 1 has 47371617 N 163853044 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 24862891, 27748820, 20932263]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4302779,  4302819,   516177,  ..., 21816940, 30952958, 78155368]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2341.602 seconds
INFO [19634 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [19634 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [20838 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [20838 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240130 03:40:36.763651 20841 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240130 03:40:36.765383 20904 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240130 03:40:36.787374 20841 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10202cd4b000 7.629 MB
W20240130 03:40:36.787554 20841 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10202d4ee000 7.629 MB
W20240130 03:40:36.787626 20841 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10202dc91000 1.49 GB
W20240130 03:40:36.787659 20841 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10208d274000 1.49 GB
W20240130 03:40:36.787746 20841 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240130 03:40:36.789382 20841 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240130 03:40:36.798058 20904 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1020ec85d000 7.629 MB
W20240130 03:40:36.798169 20904 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1020ed000000 7.629 MB
W20240130 03:40:36.798210 20904 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1020ed7a3000 1.49 GB
W20240130 03:40:36.798264 20904 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10214cd86000 1.49 GB
W20240130 03:40:36.798329 20904 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240130 03:40:36.799963 20904 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x1000098ca000
1: KnownLocalCachedEmbedding init done
WARNING [20838 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank1] pid = 20838
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414)]
cudaHostRegister 0x1000098ca000
0: KnownLocalCachedEmbedding init done
WARNING [19634 DistTensor.py:56] The tensor name already exists in the kvstore
I20240130 03:40:59.141808 20841 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240130 03:40:59.141997 20904 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240130 03:40:59.143133 20841 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240130 03:40:59.143245 20841 grad_base.h:184] Init GradProcessingBase done
I20240130 03:41:12.109090 20841 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240130 03:41:12.109259 20841 kg_controller.h:78] after init GradAsyncProcessingV2
I20240130 03:41:12.109272 20841 kg_controller.h:84] Construct KGCacheController done
E20240130 03:41:12.319643 20904 recstore.cc:66] init folly done
E20240130 03:41:12.319660 20841 recstore.cc:66] init folly done
I20240130 03:41:12.320434 20841 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240130 03:41:30.690825 21153 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240130 03:41:30.691200 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240130 03:41:38.120689 21153 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240130 03:41:38.120797 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240130 03:41:47.867954 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240130 03:41:47.891119 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240130 03:41:48.012459 20904 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
W20240130 03:41:51.352535 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240130 03:41:51.377921 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240130 03:41:51.426007 20841 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
E20240130 03:41:52.640328 20841 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240130 03:41:52.732229 20841 grad_async_v2.h:237] pq is empty
W20240130 03:41:52.738039 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
W20240130 03:41:52.763375 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=2, pq.top=2
E20240130 03:41:53.641330 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=8932
W20240130 03:41:53.797705 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=19, pq.top=19
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.290 ms                  | 128.399 ms                |
| Forward                   | 4.952 ms                  | 705.410 ms                |
| Backward                  | 5.443 ms                  | 176.725 ms                |
| Optimize                  | 2.299 ms                  | 4.874 ms                  |
| BarrierTimeBeforeRank0    | 48.752 us                 | 142.910 ms                |
| AfterBackward             | 10.508 ms                 | 267.894 ms                |
| BlockToStepN              | 715.116 us                | 37.632 ms                 |
| OneStep                   | 72.107 ms                 | 1.306 s                   |
+---------------------------+---------------------------+---------------------------+
W20240130 03:41:54.195444 21153 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240130 03:41:54.642045 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240130 03:41:54.824013 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=29, pq.top=29
W20240130 03:41:55.233433 21153 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end6
E20240130 03:41:55.642015 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=7795
W20240130 03:41:55.839990 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=46, pq.top=46
W20240130 03:41:56.259879 21153 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end2
E20240130 03:41:56.642011 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=177
W20240130 03:41:56.839092 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=61, pq.top=61
W20240130 03:41:57.309573 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 847.807 us                | 47.697 ms                 |
| ProcessBack:UpdateCache   | 692.013 us                | 90.436 ms                 |
| ProcessBack:UpsertPq      | 8.387 ms                  | 30.404 ms                 |
| ProcessOneStep            | 16.620 ms                 | 266.601 ms                |
| BlockToStepN              | 9.449 ms                  | 45.489 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 03:41:57.642016 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=7273
W20240130 03:41:57.968662 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=77, pq.top=76
W20240130 03:41:58.562570 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end6
E20240130 03:41:58.642019 20841 parallel_pq_v2.h:76] insert failed, size(hashtable)=88
W20240130 03:41:59.006700 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=93, pq.top=93
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.389 ms                  | 128.399 ms                |
| Forward                   | 4.835 ms                  | 7.065 ms                  |
| Backward                  | 5.300 ms                  | 5.854 ms                  |
| Optimize                  | 2.243 ms                  | 5.252 ms                  |
| BarrierTimeBeforeRank0    | 23.186 us                 | 47.871 ms                 |
| AfterBackward             | 18.094 ms                 | 267.894 ms                |
| BlockToStepN              | 9.502 ms                  | 53.880 ms                 |
| OneStep                   | 54.949 ms                 | 415.269 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 11.569, sample: 1.342, forward: 1.200, backward: 0.665, update: 0.211
train_sampler.Prefill()
-------Step 0-------
tensor([1185095, 1185115, 1185149, 1191809, 1185178, 1185203, 1185226,   13349,
        1185253, 1185279]) tensor([  246668,  4687023, 18701868, 54924327, 34203659, 17296930, 63971377,
         8959603, 50488175, 57134795])
-------Step 1-------
tensor([1185095, 1185115, 1185149, 1191809, 1185178, 1185203, 1185226,   13349,
        1185253, 1185279]) tensor([64601699, 72284664, 58885191, 48069391, 37129543,   226797, 28125989,
        57414606, 65484985, 81350961])
-------Step 2-------
tensor([1273448, 1273473, 1273510, 1273531, 1273555, 1273578, 1273615, 1273646,
        1198811, 1273667]) tensor([19946469, 14581208, 37312956, 78527869, 42628439,  1553262, 42601725,
        54914106, 60185175, 14039397])
-------Step 3-------
tensor([1273448, 1273473, 1273510, 1273531, 1273555, 1273578, 1273615, 1273646,
        1198811, 1273667]) tensor([41533823, 83162306,  2348520, 24064949, 46838098, 46906051, 39323490,
        44773428, 48081076, 20777286])
-------Step 4-------
tensor([ 1356945,  1356984,   207597,  1357012,   207628, 59414635,   858749,
         1357046,  1357074,  1357094]) tensor([ 1021553, 67894131, 23410227, 40035577, 73641969, 62290710, 45041138,
        28801172, 24560994, 35922403])
-------Step 5-------
tensor([ 1356945,  1356984,   207597,  1357012,   207628, 59414635,   858749,
         1357046,  1357074,  1357094]) tensor([44545569, 43667016, 62184849, 14904699, 20606024, 59764320, 63562082,
        11768373, 52627314, 68436917])
-------Step 6-------
tensor([ 1441082,  1441109,  1441136,   359635,  1441161,  1441185,  1441209,
        16911809,  1441236,  4332429]) tensor([14196283, 38476014,  6446208,  1261444, 15099977, 17885502,  2950236,
         1859884, 70549890, 19436115])
-------Step 7-------
tensor([ 1441082,  1441109,  1441136,   359635,  1441161,  1441185,  1441209,
        16911809,  1441236,  4332429]) tensor([76875469, 76344716, 54912262,  1960985,  8883430, 46207673, 58114040,
        76546684, 54820530,  9611683])
-------Step 8-------
tensor([1523137, 1523159, 1523188,  361883, 1523212, 1523244, 1523277,  209557,
        1523296, 1523327]) tensor([70789338, 67684293,   390983,  4356436, 37702100, 32956833, 60217187,
        80579979, 42061050, 21835271])
-------Step 9-------
tensor([1523137, 1523159, 1523188,  361883, 1523212, 1523244, 1523277,  209557,
        1523296, 1523327]) tensor([  574894, 46128387, 22452936, 79518836, 37356448,  1951931, 21879965,
        37225237, 33629077, 75983826])
before start barrier
start train
[proc 0] 100 steps, total: 8.155, sample: 1.458, forward: 1.188, backward: 0.699, update: 0.237
E20240130 03:41:59.642010 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=7680
W20240130 03:41:59.787576 21153 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end2
W20240130 03:42:00.065338 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=105, pq.top=105
E20240130 03:42:00.651052 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240130 03:42:00.861696 21153 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end7
W20240130 03:42:01.122959 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=119, pq.top=119
E20240130 03:42:01.651024 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=8621
W20240130 03:42:01.961393 21153 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end3
W20240130 03:42:02.124469 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=135, pq.top=134
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 847.807 us                | 17.285 ms                 |
| ProcessBack:UpdateCache   | 692.435 us                | 4.421 ms                  |
| ProcessBack:UpsertPq      | 8.890 ms                  | 44.440 ms                 |
| ProcessOneStep            | 16.879 ms                 | 267.531 ms                |
| BlockToStepN              | 9.875 ms                  | 57.178 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 03:42:02.651008 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=6920
W20240130 03:42:03.029955 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end0
W20240130 03:42:03.152681 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=151, pq.top=151
E20240130 03:42:03.651008 20841 parallel_pq_v2.h:76] insert failed, size(hashtable)=849
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.831 ms                  | 126.839 ms                |
| Forward                   | 4.883 ms                  | 7.644 ms                  |
| Backward                  | 5.304 ms                  | 10.133 ms                 |
| Optimize                  | 2.233 ms                  | 4.892 ms                  |
| BarrierTimeBeforeRank0    | 24.371 us                 | 2.983 ms                  |
| AfterBackward             | 16.013 ms                 | 267.557 ms                |
| BlockToStepN              | 10.346 ms                 | 60.186 ms                 |
| OneStep                   | 58.734 ms                 | 287.941 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 03:42:04.219107 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=167, pq.top=167
W20240130 03:42:04.234313 21153 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end7
E20240130 03:42:04.651012 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=74
W20240130 03:42:05.219187 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=183, pq.top=183
W20240130 03:42:05.407017 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end6
E20240130 03:42:05.651011 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=9366
W20240130 03:42:06.219338 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=197, pq.top=197
W20240130 03:42:06.407749 21153 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end9
[proc 1] 200 steps, total: 7.000, sample: 1.327, forward: 0.461, backward: 0.472, update: 0.211
[proc 0] 200 steps, total: 6.999, sample: 1.856, forward: 0.496, backward: 0.526, update: 0.222
E20240130 03:42:06.651010 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=12782
W20240130 03:42:07.219337 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=213, pq.top=213
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 817.098 us                | 2.493 ms                  |
| ProcessBack:UpdateCache   | 684.114 us                | 1.583 ms                  |
| ProcessBack:UpsertPq      | 6.796 ms                  | 40.363 ms                 |
| ProcessOneStep            | 15.942 ms                 | 266.601 ms                |
| BlockToStepN              | 10.956 ms                 | 75.153 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 03:42:07.651008 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=4323
W20240130 03:42:07.746495 21153 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end9
W20240130 03:42:08.242312 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=223, pq.top=223
E20240130 03:42:08.651016 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=1211
W20240130 03:42:08.855563 21153 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.512 ms                  | 126.839 ms                |
| Forward                   | 4.899 ms                  | 7.644 ms                  |
| Backward                  | 5.266 ms                  | 10.133 ms                 |
| Optimize                  | 2.195 ms                  | 4.892 ms                  |
| BarrierTimeBeforeRank0    | 25.274 us                 | 47.427 ms                 |
| AfterBackward             | 16.013 ms                 | 267.557 ms                |
| BlockToStepN              | 11.151 ms                 | 75.218 ms                 |
| OneStep                   | 61.655 ms                 | 287.941 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 03:42:09.242386 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=237, pq.top=237
E20240130 03:42:09.651010 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=15027
W20240130 03:42:10.078794 21153 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end9
W20240130 03:42:10.242153 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=251, pq.top=251
E20240130 03:42:10.651007 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=1473
W20240130 03:42:11.181259 21153 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
W20240130 03:42:11.279166 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=265, pq.top=265
E20240130 03:42:11.651013 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=6
W20240130 03:42:12.279455 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=279, pq.top=279
W20240130 03:42:12.290506 21153 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 832.612 us                | 3.027 ms                  |
| ProcessBack:UpdateCache   | 682.570 us                | 966.540 us                |
| ProcessBack:UpsertPq      | 7.142 ms                  | 36.596 ms                 |
| ProcessOneStep            | 15.987 ms                 | 251.655 ms                |
| BlockToStepN              | 11.589 ms                 | 71.806 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 03:42:12.651016 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=23449
W20240130 03:42:13.304010 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=293, pq.top=293
W20240130 03:42:13.373070 21153 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end4
E20240130 03:42:13.651849 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=1073
[proc 1] 300 steps, total: 7.243, sample: 1.392, forward: 0.451, backward: 0.528, update: 0.202
[proc 0] 300 steps, total: 7.243, sample: 1.392, forward: 0.481, backward: 0.540, update: 0.200
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.597 ms                  | 115.418 ms                |
| Forward                   | 4.856 ms                  | 7.644 ms                  |
| Backward                  | 5.224 ms                  | 10.133 ms                 |
| Optimize                  | 2.128 ms                  | 4.878 ms                  |
| BarrierTimeBeforeRank0    | 25.237 us                 | 37.530 ms                 |
| AfterBackward             | 15.929 ms                 | 251.702 ms                |
| BlockToStepN              | 11.989 ms                 | 81.833 ms                 |
| OneStep                   | 65.199 ms                 | 272.669 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 03:42:14.314486 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=307, pq.top=307
W20240130 03:42:14.606341 21153 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end1
E20240130 03:42:14.651007 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=8590
W20240130 03:42:15.415578 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=321, pq.top=321
E20240130 03:42:15.651011 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=10177
W20240130 03:42:15.906545 21153 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end6
W20240130 03:42:16.548494 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=333, pq.top=333
E20240130 03:42:16.658843 20841 parallel_pq_v2.h:76] insert failed, size(hashtable)=42
W20240130 03:42:16.952592 21153 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 835.100 us                | 5.648 ms                  |
| ProcessBack:UpdateCache   | 684.864 us                | 933.211 us                |
| ProcessBack:UpsertPq      | 7.359 ms                  | 46.597 ms                 |
| ProcessOneStep            | 16.387 ms                 | 251.655 ms                |
| BlockToStepN              | 11.589 ms                 | 81.768 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 03:42:17.658015 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=418
W20240130 03:42:17.900116 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=347, pq.top=347
W20240130 03:42:18.023952 21153 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end9
E20240130 03:42:18.658008 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=1941
W20240130 03:42:18.995375 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=359, pq.top=359
W20240130 03:42:19.063148 21153 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.797 ms                  | 124.722 ms                |
| Forward                   | 4.858 ms                  | 9.658 ms                  |
| Backward                  | 5.202 ms                  | 10.133 ms                 |
| Optimize                  | 2.115 ms                  | 6.871 ms                  |
| BarrierTimeBeforeRank0    | 28.181 us                 | 37.530 ms                 |
| AfterBackward             | 16.691 ms                 | 251.587 ms                |
| BlockToStepN              | 11.469 ms                 | 80.458 ms                 |
| OneStep                   | 66.440 ms                 | 272.669 ms                |
+---------------------------+---------------------------+---------------------------+
E20240130 03:42:19.658012 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=10766
W20240130 03:42:20.083559 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=373, pq.top=373
W20240130 03:42:20.091955 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end3
E20240130 03:42:20.658011 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=15180
W20240130 03:42:21.161865 21153 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end5
W20240130 03:42:21.185520 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=385, pq.top=385
E20240130 03:42:21.658010 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=2017
W20240130 03:42:22.175789 21153 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
W20240130 03:42:22.245960 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=397, pq.top=397
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 837.153 us                | 5.648 ms                  |
| ProcessBack:UpdateCache   | 685.584 us                | 975.843 us                |
| ProcessBack:UpsertPq      | 7.672 ms                  | 46.597 ms                 |
| ProcessOneStep            | 16.668 ms                 | 251.523 ms                |
| BlockToStepN              | 11.589 ms                 | 80.379 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 8.614, sample: 2.116, forward: 0.663, backward: 0.538, update: 0.320
[proc 1] 400 steps, total: 8.614, sample: 1.718, forward: 0.440, backward: 0.498, update: 0.201
E20240130 03:42:22.658007 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=21103
W20240130 03:42:23.175520 21153 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end0
W20240130 03:42:23.245357 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=411, pq.top=411
E20240130 03:42:23.658011 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=25307
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.408 ms                  | 128.399 ms                |
| Forward                   | 4.884 ms                  | 10.149 ms                 |
| Backward                  | 5.160 ms                  | 10.133 ms                 |
| Optimize                  | 2.142 ms                  | 7.521 ms                  |
| BarrierTimeBeforeRank0    | 30.572 us                 | 37.530 ms                 |
| AfterBackward             | 16.744 ms                 | 251.587 ms                |
| BlockToStepN              | 13.223 ms                 | 81.833 ms                 |
| OneStep                   | 67.336 ms                 | 272.669 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 03:42:24.195870 21153 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end4
W20240130 03:42:24.289036 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=425, pq.top=425
E20240130 03:42:24.658015 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=34082
W20240130 03:42:25.222352 21153 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end9
W20240130 03:42:25.312595 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=440, pq.top=440
E20240130 03:42:25.658013 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=9802
W20240130 03:42:26.371043 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=455, pq.top=455
W20240130 03:42:26.396225 21153 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end5
E20240130 03:42:26.658010 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=17973
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 838.716 us                | 5.475 ms                  |
| ProcessBack:UpdateCache   | 689.312 us                | 972.150 us                |
| ProcessBack:UpsertPq      | 7.672 ms                  | 44.969 ms                 |
| ProcessOneStep            | 16.779 ms                 | 235.649 ms                |
| BlockToStepN              | 13.212 ms                 | 81.768 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240130 03:42:27.371735 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=470, pq.top=470
W20240130 03:42:27.505664 21153 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end0
E20240130 03:42:27.658011 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=7154
W20240130 03:42:28.410585 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=481, pq.top=481
W20240130 03:42:28.576251 21153 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end4
E20240130 03:42:28.658013 21152 parallel_pq_v2.h:76] insert failed, size(hashtable)=68962
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.408 ms                  | 126.839 ms                |
| Forward                   | 4.884 ms                  | 9.863 ms                  |
| Backward                  | 5.115 ms                  | 10.133 ms                 |
| Optimize                  | 2.128 ms                  | 7.309 ms                  |
| BarrierTimeBeforeRank0    | 28.939 us                 | 37.530 ms                 |
| AfterBackward             | 16.804 ms                 | 235.680 ms                |
| BlockToStepN              | 14.138 ms                 | 87.838 ms                 |
| OneStep                   | 69.074 ms                 | 267.001 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 03:42:29.490218 20841 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=495, pq.top=494
W20240130 03:42:29.629302 21153 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end7
E20240130 03:42:29.658003 21153 parallel_pq_v2.h:76] insert failed, size(hashtable)=9973
[proc 0] 500 steps, total: 7.534, sample: 1.551, forward: 0.482, backward: 0.501, update: 0.212
[proc 1] 500 steps, total: 7.534, sample: 1.190, forward: 0.488, backward: 0.550, update: 0.206
Successfully xmh. training takes 38.545839071273804 seconds
before call kg_cache_controller.StopThreads()
W20240130 03:42:29.972036 20841 grad_async_v2.h:71] call StopThreads. PID = 19634
W20240130 03:42:29.972086 20841 grad_base.h:212] before processOneStepNegThread_.join();
W20240130 03:42:29.972503 20841 grad_base.h:214] after processOneStepNegThread_.join();
W20240130 03:42:29.972515 20841 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240130 03:42:30.082748 20841 grad_async_v2.h:92] StopThreads done.

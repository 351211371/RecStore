WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 12:54:12.462540 16364 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_10', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [16364 sampler.py:454] Start PreSampling
WARNING [16364 sampler.py:532] Before construct renumbering_dict
WARNING [16364 sampler.py:555] PreSampling done
W20240129 12:54:18.109439 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 12:54:18.109683 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 12:54:18.109743 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 12:54:18.109792 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 12:54:18.109840 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 12:54:18.109891 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 12:54:18.109928 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 12:54:18.110006 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 12:54:18.110051 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 12:54:18.110101 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 12:54:18.110160 16364 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 12:54:18.110198 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 12:54:18.110229 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 12:54:18.110365 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 12:54:18.110419 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 12:54:18.110455 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 12:54:18.110512 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 12:54:18.110556 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 12:54:18.110592 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 12:54:18.110637 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 12:54:18.110682 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 12:54:18.110724 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 12:54:18.110774 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 12:54:18.110819 16364 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 12:54:18.110850 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 12:54:18.110881 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 12:54:18.110957 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 12:54:18.110996 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 12:54:18.111032 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 12:54:18.111066 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 12:54:18.111128 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 12:54:18.111171 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 12:54:18.111217 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 12:54:18.111263 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 12:54:18.111320 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 12:54:18.111358 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 12:54:18.111399 16364 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 12:54:18.111430 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 12:54:18.111461 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 12:54:18.111529 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 12:54:18.111598 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 12:54:18.111635 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 12:54:18.111675 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 12:54:18.111718 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 12:54:18.111754 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 12:54:18.111800 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 12:54:18.111840 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 12:54:18.111876 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 12:54:18.111925 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 12:54:18.111974 16364 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 12:54:18.112006 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 12:54:18.112044 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 12:54:18.112133 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240129 12:54:18.112177 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240129 12:54:18.112217 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240129 12:54:18.112258 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240129 12:54:18.112305 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240129 12:54:18.112345 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240129 12:54:18.112398 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240129 12:54:18.112443 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240129 12:54:18.112496 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240129 12:54:18.112533 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240129 12:54:18.112568 16364 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240129 12:54:18.112601 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240129 12:54:18.112637 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240129 12:54:18.112704 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240129 12:54:18.112749 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240129 12:54:18.112793 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240129 12:54:18.112831 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240129 12:54:18.112872 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240129 12:54:18.112916 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240129 12:54:18.112957 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240129 12:54:18.112993 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240129 12:54:18.113041 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240129 12:54:18.113078 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240129 12:54:18.113114 16364 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240129 12:54:18.113145 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240129 12:54:18.113181 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240129 12:54:18.113253 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x10001ca5a000 7.629 MB
W20240129 12:54:18.113304 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x10001d1fd000 7.629 MB
W20240129 12:54:18.113348 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_2 [1000000]0x10001d9a0000 7.629 MB
W20240129 12:54:18.113399 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_3 [1000000]0x10001e143000 7.629 MB
W20240129 12:54:18.113440 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_4 [1000000]0x10001e8e6000 7.629 MB
W20240129 12:54:18.113489 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_5 [1000000]0x10001f089000 7.629 MB
W20240129 12:54:18.113534 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_6 [1000000]0x10001f82c000 7.629 MB
W20240129 12:54:18.113579 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_7 [1000000]0x10001ffcf000 7.629 MB
W20240129 12:54:18.113621 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_8 [1000000]0x100020772000 7.629 MB
W20240129 12:54:18.113675 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_9 [1000000]0x100020f15000 7.629 MB
W20240129 12:54:18.113718 16364 IPCTensor.h:369] NewIPCTensor: step_r6 [10]0x1000216b8000 80 B 
W20240129 12:54:18.113749 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x1000216ba000 8 B 
W20240129 12:54:18.113785 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x1000216bc000 8 B 
W20240129 12:54:18.113864 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_0 [1000000]0x1000216be000 7.629 MB
W20240129 12:54:18.113904 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_1 [1000000]0x100021e61000 7.629 MB
W20240129 12:54:18.113941 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_2 [1000000]0x100022604000 7.629 MB
W20240129 12:54:18.113984 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_3 [1000000]0x100022da7000 7.629 MB
W20240129 12:54:18.114051 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_4 [1000000]0x10002354a000 7.629 MB
W20240129 12:54:18.114095 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_5 [1000000]0x100023ced000 7.629 MB
W20240129 12:54:18.114141 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_6 [1000000]0x100024490000 7.629 MB
W20240129 12:54:18.114185 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_7 [1000000]0x100024c33000 7.629 MB
W20240129 12:54:18.114238 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_8 [1000000]0x1000253d6000 7.629 MB
W20240129 12:54:18.114282 16364 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_9 [1000000]0x100025b79000 7.629 MB
W20240129 12:54:18.114327 16364 IPCTensor.h:369] NewIPCTensor: step_r7 [10]0x10002631c000 80 B 
W20240129 12:54:18.114359 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r7 [1]0x10002631e000 8 B 
W20240129 12:54:18.114396 16364 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100026320000 8 B 
W20240129 12:54:18.370124 16364 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100026322000 22.81 MB
W20240129 12:54:18.370292 16364 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000279f4000 58.4 kB
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([ 753, 1201, 1793,  ..., 8355, 9761, 7006]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 6.011 seconds
[Rank1] pid = 16951
[Rank2] pid = 17015
[Rank3] pid = 17016
[Rank4] pid = 17083
[Rank5] pid = 17084
[Rank6] pid = 17210
INFO [16364 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [16951 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [17015 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [17016 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [17083 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [17084 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [17212 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [17210 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [17016 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [17084 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [17212 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [17083 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [17210 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [16364 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [16951 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [17015 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240129 12:54:20.100775 17342 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_7 [747, 400]; dev=7; size=1.14 MB
W20240129 12:54:20.100801 17211 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240129 12:54:20.100924 17017 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240129 12:54:20.100937 17339 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_6 [747, 400]; dev=6; size=1.14 MB
W20240129 12:54:20.100998 17085 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
W20240129 12:54:20.101179 17214 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240129 12:54:20.102941 17082 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240129 12:54:20.102970 16952 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240129 12:54:20.141621 17342 IPCTensor.h:369] NewIPCTensor: input_keys_7 [1000000]0x100027a14000 7.629 MB
W20240129 12:54:20.141642 17211 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x1000281b7000 7.629 MB
W20240129 12:54:20.141650 17339 IPCTensor.h:369] NewIPCTensor: input_keys_6 [1000000]0x10002895a000 7.629 MB
W20240129 12:54:20.141683 16952 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000290fd000 7.629 MB
W20240129 12:54:20.141700 17214 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000298a0000 7.629 MB
W20240129 12:54:20.141723 17017 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x10002a043000 7.629 MB
W20240129 12:54:20.141729 17085 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x10002a7e6000 7.629 MB
W20240129 12:54:20.141763 17082 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10002af89000 7.629 MB
W20240129 12:54:20.141820 17214 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10002b72c000 7.629 MB
W20240129 12:54:20.141865 17339 IPCTensor.h:369] NewIPCTensor: input_keys_neg_6 [1000000]0x10002becf000 7.629 MB
W20240129 12:54:20.141884 17214 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10002ce15000 1.49 GB
W20240129 12:54:20.141882 16952 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x10002c672000 7.629 MB
W20240129 12:54:20.141916 17017 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x10008c3f8000 7.629 MB
W20240129 12:54:20.141935 17082 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10008cb9b000 7.629 MB
W20240129 12:54:20.141938 17214 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10008d33e000 1.49 GB
W20240129 12:54:20.141980 17339 IPCTensor.h:369] NewIPCTensor: backward_grads_6 [1000000, 400]0x1000ec921000 1.49 GB
W20240129 12:54:20.141985 17214 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 12:54:20.141988 17211 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x10014bf04000 7.629 MB
W20240129 12:54:20.141995 16952 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10014c6a7000 1.49 GB
W20240129 12:54:20.142036 17082 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1001abc8a000 1.49 GB
W20240129 12:54:20.142045 17017 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x10020b26d000 1.49 GB
W20240129 12:54:20.142071 17339 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_6 [1000000, 400]0x10026a850000 1.49 GB
W20240129 12:54:20.142081 17085 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x1002c9e33000 7.629 MB
W20240129 12:54:20.142103 16952 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1002ca5d6000 1.49 GB
W20240129 12:54:20.142123 17211 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x100329bb9000 1.49 GB
W20240129 12:54:20.142131 17082 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x10038919c000 1.49 GB
W20240129 12:54:20.142140 17342 IPCTensor.h:369] NewIPCTensor: input_keys_neg_7 [1000000]0x1003e877f000 7.629 MB
W20240129 12:54:20.142148 17017 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1003e8f22000 1.49 GB
W20240129 12:54:20.142159 17339 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240129 12:54:20.142184 16952 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 12:54:20.142200 17211 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x100448505000 1.49 GB
W20240129 12:54:20.142208 17085 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x1004a7ae8000 1.49 GB
W20240129 12:54:20.142221 17082 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 12:54:20.142236 17017 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 12:54:20.142253 17342 IPCTensor.h:369] NewIPCTensor: backward_grads_7 [1000000, 400]0x1005070cb000 1.49 GB
W20240129 12:54:20.142263 17211 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240129 12:54:20.142284 17085 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x1005666ae000 1.49 GB
W20240129 12:54:20.142328 17342 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_7 [1000000, 400]0x1005c5c91000 1.49 GB
W20240129 12:54:20.142338 17085 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240129 12:54:20.142372 17342 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240129 12:54:20.156056 17214 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 12:54:20.156090 17339 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240129 12:54:20.156105 17211 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240129 12:54:20.156105 16952 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 12:54:20.156107 17082 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 12:54:20.156126 17085 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240129 12:54:20.156122 17342 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240129 12:54:20.156121 17017 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
cudaHostRegister 0x100026322000
1: KnownLocalCachedEmbedding init done
WARNING [16951 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
2: KnownLocalCachedEmbedding init done
WARNING [17015 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
3: KnownLocalCachedEmbedding init done
WARNING [17016 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
6: KnownLocalCachedEmbedding init done
WARNING [17210 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
7: KnownLocalCachedEmbedding init done
WARNING [17212 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
4: KnownLocalCachedEmbedding init done
WARNING [17083 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
5: KnownLocalCachedEmbedding init done
WARNING [17084 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank7] pid = 17212
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
cudaHostRegister 0x100026322000
0: KnownLocalCachedEmbedding init done
WARNING [16364 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 12:54:21.844856 17214 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240129 12:54:21.845247 17082 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240129 12:54:21.845367 17211 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240129 12:54:21.845484 16952 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240129 12:54:21.845609 17342 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240129 12:54:21.845805 17085 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240129 12:54:21.845969 17017 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240129 12:54:21.846072 17339 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240129 12:54:21.851060 17214 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 12:54:21.851351 17214 grad_base.h:184] Init GradProcessingBase done
I20240129 12:54:21.863092 17214 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240129 12:54:21.863304 17214 kg_controller.h:78] after init GradAsyncProcessingV2
I20240129 12:54:21.863322 17214 kg_controller.h:84] Construct KGCacheController done
E20240129 12:54:22.644910 17342 recstore.cc:66] init folly done
E20240129 12:54:22.644920 17017 recstore.cc:66] init folly done
E20240129 12:54:22.644958 17085 recstore.cc:66] init folly done
E20240129 12:54:22.645514 17214 recstore.cc:66] init folly done
E20240129 12:54:22.646445 17211 recstore.cc:66] init folly done
E20240129 12:54:22.646600 17082 recstore.cc:66] init folly done
E20240129 12:54:22.646709 16952 recstore.cc:66] init folly done
E20240129 12:54:22.646731 17339 recstore.cc:66] init folly done
I20240129 12:54:22.647857 17214 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 12:54:23.435695 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 12:54:23.436184 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240129 12:54:23.462543 16952 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240129 12:54:23.467059 17085 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240129 12:54:23.470613 17211 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240129 12:54:23.471911 17342 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240129 12:54:23.472110 17339 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240129 12:54:23.477913 17082 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240129 12:54:23.484344 17214 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240129 12:54:23.485466 17017 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240129 12:54:26.659569 17779 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240129 12:54:26.683413 18292 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.220 ms                  | 7.328 ms                  |
| Forward                   | 6.681 ms                  | 797.687 ms                |
| Backward                  | 5.025 ms                  | 250.727 ms                |
| Optimize                  | 1.961 ms                  | 3.381 ms                  |
| BarrierTimeBeforeRank0    | 844.891 us                | 404.931 ms                |
| AfterBackward             | 58.371 ms                 | 1.733 s                   |
| BlockToStepN              | 54.509 us                 | 574.085 us                |
| OneStep                   | 86.751 ms                 | 3.194 s                   |
+---------------------------+---------------------------+---------------------------+
W20240129 12:54:27.236428 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=10, pq.top=10
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.443 ms                  | 387.024 ms                |
| ProcessBack:UpdateCache   | 9.185 ms                  | 987.668 ms                |
| ProcessBack:UpsertPq      | 13.786 ms                 | 20.286 ms                 |
| ProcessOneStep            | 33.487 ms                 | 1.732 s                   |
| BlockToStepN              | 12.167 us                 | 47.344 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 12:54:27.659046 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=139
W20240129 12:54:27.685045 18292 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end4
W20240129 12:54:28.236019 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=19, pq.top=19
E20240129 12:54:28.659117 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=3282
W20240129 12:54:28.692142 18292 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end5
W20240129 12:54:29.240600 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=31, pq.top=31
E20240129 12:54:29.659008 17779 parallel_pq_v2.h:76] insert failed, size(hashtable)=2082
W20240129 12:54:29.693697 18292 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end7
W20240129 12:54:30.275748 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=44, pq.top=44
E20240129 12:54:30.659008 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=2130
W20240129 12:54:30.699422 18292 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end9
W20240129 12:54:31.314107 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=56, pq.top=56
E20240129 12:54:31.659009 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=2414
W20240129 12:54:31.707006 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.465 ms                  | 28.376 ms                 |
| Forward                   | 4.909 ms                  | 10.510 ms                 |
| Backward                  | 4.393 ms                  | 9.533 ms                  |
| Optimize                  | 1.888 ms                  | 3.491 ms                  |
| BarrierTimeBeforeRank0    | 2.579 ms                  | 13.275 ms                 |
| AfterBackward             | 38.999 ms                 | 63.275 ms                 |
| BlockToStepN              | 21.067 ms                 | 67.685 ms                 |
| OneStep                   | 85.566 ms                 | 232.628 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:54:32.361184 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=67, pq.top=67
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.057 ms                  | 353.029 ms                |
| ProcessBack:UpdateCache   | 9.736 ms                  | 987.621 ms                |
| ProcessBack:UpsertPq      | 18.368 ms                 | 33.164 ms                 |
| ProcessOneStep            | 39.216 ms                 | 63.222 ms                 |
| BlockToStepN              | 23.467 ms                 | 67.620 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 12:54:32.659010 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=1873
W20240129 12:54:32.710498 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 12:54:33.361101 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=77, pq.top=77
E20240129 12:54:33.659037 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=6174
W20240129 12:54:33.721192 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 12:54:34.550583 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=88, pq.top=88
E20240129 12:54:34.659046 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2522
W20240129 12:54:34.727649 18292 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
W20240129 12:54:35.601980 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=98, pq.top=98
E20240129 12:54:35.659530 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=5784
W20240129 12:54:35.760991 18292 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 12.393, sample: 0.374, forward: 1.101, backward: 0.682, update: 0.191
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 12.399, sample: 0.343, forward: 1.277, backward: 0.750, update: 0.177
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 12.400, sample: 0.388, forward: 1.288, backward: 0.718, update: 0.193
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 12.399, sample: 0.362, forward: 1.273, backward: 0.725, update: 0.177
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 12.386, sample: 0.376, forward: 1.592, backward: 0.882, update: 0.178
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 12.409, sample: 0.367, forward: 1.279, backward: 0.696, update: 0.186
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 12.404, sample: 0.424, forward: 1.276, backward: 0.849, update: 0.194
train_sampler.Prefill()
-------Step 0-------
tensor([ 1866,    68,  3627,  2885, 11182, 12691,  1042,   445, 14152, 11566]) tensor([ 1793,  9156,  5293, 11369, 12469,  1071,   573,  4609,   500, 12092])
-------Step 1-------
tensor([ 1866,    68,  3627,  2885, 11182, 12691,  1042,   445, 14152, 11566]) tensor([ 4107,  9274, 14759,  1477,  1011,  8009, 14760,  9002,  5819, 12296])
-------Step 2-------
tensor([ 6851, 10861,  4883,  4338, 10952,  9363,  9903,    86, 10599,   910]) tensor([ 4048,  5395,  3533,  7875,  5543,  8020, 12434, 10498, 14349, 10468])
-------Step 3-------
tensor([ 6851, 10861,  4883,  4338, 10952,  9363,  9903,    86, 10599,   910]) tensor([ 9204,  6366,  7314, 10833,  6320,   705,  5901,  2244, 13645,  2280])
-------Step 4-------
tensor([   68, 13871, 10169,  5024,  6534,  3607,    51,  6766,  6734,   972]) tensor([ 619, 1190, 3732, 2876, 2777, 2570,  445, 7082, 5073, 1956])
-------Step 5-------
tensor([   68, 13871, 10169,  5024,  6534,  3607,    51,  6766,  6734,   972]) tensor([10762,  4859,  5385,  1621,  3464,   811,   826,  1293,  5441,  5847])
-------Step 6-------
tensor([ 1781,  7675,    30,    85,  9209,  3115,  7578, 10979, 13231, 12094]) tensor([10861,  3356,  7878,  4030,  9017,  9337,  4073,  7793,  9505, 11129])
-------Step 7-------
tensor([ 1781,  7675,    30,    85,  9209,  3115,  7578, 10979, 13231, 12094]) tensor([14055, 11863,  4028,  6259,  1299,  8604,  6507,  4080,   131, 12850])
-------Step 8-------
tensor([ 3270,  7037,  5013, 13702,    44,    60,  8738, 12606,    59,  2217]) tensor([ 5334,  6029,  4159,  7672,  2882, 14512,  9533,  1367, 10822,  3614])
-------Step 9-------
tensor([ 3270,  7037,  5013, 13702,    44,    60,  8738, 12606,    59,  2217]) tensor([11301,  3600, 14113,  8436, 14940, 12899, 12879,  9002,   655, 11945])
before start barrier
start train
[proc 0] 100 steps, total: 12.387, sample: 0.446, forward: 1.332, backward: 0.732, update: 0.205
W20240129 12:54:36.601032 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=107, pq.top=107
E20240129 12:54:36.659008 17779 parallel_pq_v2.h:76] insert failed, size(hashtable)=461
W20240129 12:54:36.765167 18292 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.510 ms                  | 29.812 ms                 |
| Forward                   | 4.908 ms                  | 12.936 ms                 |
| Backward                  | 4.554 ms                  | 9.533 ms                  |
| Optimize                  | 1.896 ms                  | 3.631 ms                  |
| BarrierTimeBeforeRank0    | 2.121 ms                  | 13.275 ms                 |
| AfterBackward             | 39.246 ms                 | 63.500 ms                 |
| BlockToStepN              | 29.757 ms                 | 88.364 ms                 |
| OneStep                   | 93.322 ms                 | 232.628 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:54:37.644608 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=117, pq.top=117
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.112 ms                  | 14.125 ms                 |
| ProcessBack:UpdateCache   | 10.191 ms                 | 17.450 ms                 |
| ProcessBack:UpsertPq      | 18.800 ms                 | 34.364 ms                 |
| ProcessOneStep            | 39.496 ms                 | 63.456 ms                 |
| BlockToStepN              | 30.831 ms                 | 88.255 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 12:54:37.659009 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=3000
W20240129 12:54:37.772411 18292 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
W20240129 12:54:38.651755 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=126, pq.top=126
E20240129 12:54:38.659056 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2360
W20240129 12:54:38.774369 18292 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
W20240129 12:54:39.654003 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=134, pq.top=134
E20240129 12:54:39.659039 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2647
W20240129 12:54:39.802795 18292 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 12:54:40.659781 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=51
W20240129 12:54:40.707988 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=143, pq.top=143
W20240129 12:54:40.848623 18292 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 12:54:41.659080 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2078
W20240129 12:54:41.707126 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=151, pq.top=151
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.825 ms                  | 29.354 ms                 |
| Forward                   | 4.954 ms                  | 12.936 ms                 |
| Backward                  | 4.685 ms                  | 10.306 ms                 |
| Optimize                  | 1.888 ms                  | 3.551 ms                  |
| BarrierTimeBeforeRank0    | 2.504 ms                  | 16.453 ms                 |
| AfterBackward             | 41.987 ms                 | 66.541 ms                 |
| BlockToStepN              | 31.733 ms                 | 87.688 ms                 |
| OneStep                   | 98.844 ms                 | 170.929 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:54:41.858702 18292 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.161 ms                  | 12.666 ms                 |
| ProcessBack:UpdateCache   | 10.191 ms                 | 17.410 ms                 |
| ProcessBack:UpsertPq      | 19.425 ms                 | 38.398 ms                 |
| ProcessOneStep            | 41.368 ms                 | 66.503 ms                 |
| BlockToStepN              | 31.755 ms                 | 87.616 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 12:54:42.659018 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2576
W20240129 12:54:42.707191 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=160, pq.top=160
W20240129 12:54:42.867413 18292 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 12:54:43.659013 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2706
W20240129 12:54:43.741847 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=170, pq.top=170
W20240129 12:54:43.912945 18292 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 12:54:44.659009 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=17
W20240129 12:54:44.741176 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=179, pq.top=179
W20240129 12:54:44.920763 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 12:54:45.659006 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 12:54:45.741262 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=187, pq.top=187
W20240129 12:54:45.928084 18292 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 12:54:46.659010 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=1074
W20240129 12:54:46.783025 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=196, pq.top=196
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.761 ms                  | 29.354 ms                 |
| Forward                   | 4.909 ms                  | 12.936 ms                 |
| Backward                  | 4.685 ms                  | 10.441 ms                 |
| Optimize                  | 1.905 ms                  | 4.148 ms                  |
| BarrierTimeBeforeRank0    | 2.872 ms                  | 29.961 ms                 |
| AfterBackward             | 47.046 ms                 | 66.541 ms                 |
| BlockToStepN              | 32.790 ms                 | 88.364 ms                 |
| OneStep                   | 101.699 ms                | 177.295 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:54:46.930359 18292 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
[proc 1] 200 steps, total: 11.395, sample: 0.396, forward: 0.510, backward: 0.567, update: 0.181
[proc 2] 200 steps, total: 11.395, sample: 0.398, forward: 0.498, backward: 0.495, update: 0.177
[proc 7] 200 steps, total: 11.395, sample: 0.415, forward: 0.494, backward: 0.473, update: 0.173
[proc 5] 200 steps, total: 11.395, sample: 0.385, forward: 0.477, backward: 0.553, update: 0.188
[proc 3] 200 steps, total: 11.395, sample: 0.455, forward: 0.535, backward: 0.493, update: 0.191
[proc 4] 200 steps, total: 11.395, sample: 0.440, forward: 0.501, backward: 0.514, update: 0.177
[proc 0] 200 steps, total: 11.395, sample: 0.508, forward: 0.520, backward: 0.545, update: 0.186
[proc 6] 200 steps, total: 11.395, sample: 0.411, forward: 0.513, backward: 0.496, update: 0.192
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.265 ms                  | 14.125 ms                 |
| ProcessBack:UpdateCache   | 10.546 ms                 | 17.410 ms                 |
| ProcessBack:UpsertPq      | 20.532 ms                 | 37.949 ms                 |
| ProcessOneStep            | 47.039 ms                 | 66.503 ms                 |
| BlockToStepN              | 32.965 ms                 | 88.255 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 12:54:47.659010 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=3966
W20240129 12:54:47.830778 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=205, pq.top=205
W20240129 12:54:47.937461 18292 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 12:54:48.659566 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2431
W20240129 12:54:48.864485 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=214, pq.top=214
W20240129 12:54:48.945242 18292 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 12:54:49.659013 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=5728
W20240129 12:54:49.864105 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=222, pq.top=222
W20240129 12:54:49.951910 18292 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 12:54:50.667770 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2490
W20240129 12:54:50.877733 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=231, pq.top=231
W20240129 12:54:50.956444 18292 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 12:54:51.667889 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2402
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.743 ms                  | 29.679 ms                 |
| Forward                   | 4.882 ms                  | 12.936 ms                 |
| Backward                  | 4.554 ms                  | 10.441 ms                 |
| Optimize                  | 1.896 ms                  | 4.148 ms                  |
| BarrierTimeBeforeRank0    | 3.299 ms                  | 30.535 ms                 |
| AfterBackward             | 44.254 ms                 | 66.541 ms                 |
| BlockToStepN              | 34.496 ms                 | 107.673 ms                |
| OneStep                   | 103.122 ms                | 185.463 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:54:51.877411 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=239, pq.top=239
W20240129 12:54:51.960845 18292 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.278 ms                  | 14.125 ms                 |
| ProcessBack:UpdateCache   | 10.572 ms                 | 17.384 ms                 |
| ProcessBack:UpsertPq      | 20.427 ms                 | 37.949 ms                 |
| ProcessOneStep            | 43.125 ms                 | 67.447 ms                 |
| BlockToStepN              | 34.865 ms                 | 107.558 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 12:54:52.667009 17779 parallel_pq_v2.h:76] insert failed, size(hashtable)=852
W20240129 12:54:52.904868 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=248, pq.top=248
W20240129 12:54:52.967386 18292 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 12:54:53.667068 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=3138
W20240129 12:54:53.904307 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=257, pq.top=257
W20240129 12:54:53.974053 18292 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 12:54:54.670603 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=37
W20240129 12:54:54.961575 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=266, pq.top=266
W20240129 12:54:54.978740 18292 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
E20240129 12:54:55.670008 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=2023
W20240129 12:54:55.984356 18292 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
W20240129 12:54:55.997874 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=276, pq.top=276
E20240129 12:54:56.670032 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=7185
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.731 ms                  | 29.529 ms                 |
| Forward                   | 4.875 ms                  | 11.982 ms                 |
| Backward                  | 4.505 ms                  | 10.306 ms                 |
| Optimize                  | 1.888 ms                  | 4.148 ms                  |
| BarrierTimeBeforeRank0    | 3.476 ms                  | 30.535 ms                 |
| AfterBackward             | 42.532 ms                 | 66.541 ms                 |
| BlockToStepN              | 34.945 ms                 | 97.038 ms                 |
| OneStep                   | 103.803 ms                | 177.295 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:54:56.994047 18292 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
W20240129 12:54:57.028687 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=286, pq.top=286
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.291 ms                  | 13.723 ms                 |
| ProcessBack:UpdateCache   | 10.594 ms                 | 17.354 ms                 |
| ProcessBack:UpsertPq      | 20.740 ms                 | 37.811 ms                 |
| ProcessOneStep            | 42.275 ms                 | 66.503 ms                 |
| BlockToStepN              | 34.882 ms                 | 106.774 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 12:54:57.670008 17779 parallel_pq_v2.h:76] insert failed, size(hashtable)=1843
W20240129 12:54:58.033768 18292 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end5
W20240129 12:54:58.035456 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=295, pq.top=295
E20240129 12:54:58.670009 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=954
[proc 5] 300 steps, total: 11.434, sample: 0.364, forward: 0.468, backward: 0.539, update: 0.187
[proc 0] 300 steps, total: 11.434, sample: 0.403, forward: 0.494, backward: 0.434, update: 0.200
[proc 1] 300 steps, total: 11.434, sample: 0.352, forward: 0.463, backward: 0.496, update: 0.189
[proc 3] 300 steps, total: 11.434, sample: 0.399, forward: 0.491, backward: 0.499, update: 0.177
[proc 2] 300 steps, total: 11.434, sample: 0.346, forward: 0.459, backward: 0.519, update: 0.168
[proc 6] 300 steps, total: 11.434, sample: 0.340, forward: 0.460, backward: 0.516, update: 0.169
[proc 4] 300 steps, total: 11.434, sample: 0.370, forward: 0.477, backward: 0.510, update: 0.178
[proc 7] 300 steps, total: 11.434, sample: 0.390, forward: 0.490, backward: 0.482, update: 0.172
W20240129 12:54:59.035348 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=303, pq.top=303
W20240129 12:54:59.056298 18292 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 12:54:59.670010 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=563
W20240129 12:55:00.035082 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=312, pq.top=312
W20240129 12:55:00.063594 18292 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 12:55:00.670336 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=26
W20240129 12:55:01.067734 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 12:55:01.081636 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=321, pq.top=321
E20240129 12:55:01.670012 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=3422
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.778 ms                  | 29.529 ms                 |
| Forward                   | 4.835 ms                  | 11.982 ms                 |
| Backward                  | 4.462 ms                  | 10.306 ms                 |
| Optimize                  | 1.885 ms                  | 4.148 ms                  |
| BarrierTimeBeforeRank0    | 3.728 ms                  | 30.535 ms                 |
| AfterBackward             | 44.254 ms                 | 71.205 ms                 |
| BlockToStepN              | 34.945 ms                 | 107.673 ms                |
| OneStep                   | 105.264 ms                | 177.295 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:55:02.079025 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 12:55:02.118777 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=331, pq.top=331
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.344 ms                  | 14.125 ms                 |
| ProcessBack:UpdateCache   | 10.659 ms                 | 17.321 ms                 |
| ProcessBack:UpsertPq      | 21.243 ms                 | 40.295 ms                 |
| ProcessOneStep            | 45.019 ms                 | 71.156 ms                 |
| BlockToStepN              | 34.404 ms                 | 107.558 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 12:55:02.670011 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=4036
W20240129 12:55:03.095396 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 12:55:03.157299 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=341, pq.top=341
E20240129 12:55:03.670022 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=5074
W20240129 12:55:04.097355 18292 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
W20240129 12:55:04.167212 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=352, pq.top=352
E20240129 12:55:04.670011 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=4599
W20240129 12:55:05.098716 18292 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
W20240129 12:55:05.234956 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=364, pq.top=364
E20240129 12:55:05.670013 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2870
W20240129 12:55:06.101912 18292 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
W20240129 12:55:06.259577 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=375, pq.top=375
E20240129 12:55:06.670292 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=3570
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.808 ms                  | 29.354 ms                 |
| Forward                   | 4.790 ms                  | 10.510 ms                 |
| Backward                  | 4.393 ms                  | 9.861 ms                  |
| Optimize                  | 1.888 ms                  | 3.983 ms                  |
| BarrierTimeBeforeRank0    | 3.824 ms                  | 30.535 ms                 |
| AfterBackward             | 47.755 ms                 | 69.185 ms                 |
| BlockToStepN              | 32.323 ms                 | 106.853 ms                |
| OneStep                   | 102.486 ms                | 175.394 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:55:07.106760 18292 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
W20240129 12:55:07.259852 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=385, pq.top=385
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.369 ms                  | 14.125 ms                 |
| ProcessBack:UpdateCache   | 10.659 ms                 | 17.354 ms                 |
| ProcessBack:UpsertPq      | 21.634 ms                 | 39.831 ms                 |
| ProcessOneStep            | 47.787 ms                 | 69.151 ms                 |
| BlockToStepN              | 31.739 ms                 | 106.774 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 12:55:07.670877 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2014
W20240129 12:55:08.112088 18292 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
W20240129 12:55:08.285279 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=395, pq.top=395
E20240129 12:55:08.670008 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=1548
[proc 4] 400 steps, total: 10.129, sample: 0.376, forward: 0.452, backward: 0.504, update: 0.169
[proc 0] 400 steps, total: 10.129, sample: 0.432, forward: 0.454, backward: 0.441, update: 0.183
[proc 2] 400 steps, total: 10.129, sample: 0.354, forward: 0.451, backward: 0.457, update: 0.171
[proc 5] 400 steps, total: 10.129, sample: 0.397, forward: 0.467, backward: 0.490, update: 0.176
[proc 7] 400 steps, total: 10.129, sample: 0.332, forward: 0.462, backward: 0.478, update: 0.168
[proc 1] 400 steps, total: 10.129, sample: 0.349, forward: 0.451, backward: 0.476, update: 0.170
[proc 3] 400 steps, total: 10.129, sample: 0.351, forward: 0.471, backward: 0.482, update: 0.185
[proc 6] 400 steps, total: 10.129, sample: 0.398, forward: 0.469, backward: 0.492, update: 0.180
W20240129 12:55:09.128417 18292 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
W20240129 12:55:09.285522 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=405, pq.top=405
E20240129 12:55:09.670010 17779 parallel_pq_v2.h:76] insert failed, size(hashtable)=647
W20240129 12:55:10.133219 18292 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
W20240129 12:55:10.285241 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=414, pq.top=414
E20240129 12:55:10.670007 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=1766
W20240129 12:55:11.175582 18292 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
W20240129 12:55:11.285672 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=423, pq.top=423
E20240129 12:55:11.670018 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=5117
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.815 ms                  | 29.354 ms                 |
| Forward                   | 4.771 ms                  | 10.510 ms                 |
| Backward                  | 4.374 ms                  | 9.861 ms                  |
| Optimize                  | 1.895 ms                  | 3.983 ms                  |
| BarrierTimeBeforeRank0    | 3.803 ms                  | 30.535 ms                 |
| AfterBackward             | 48.010 ms                 | 69.185 ms                 |
| BlockToStepN              | 31.843 ms                 | 106.853 ms                |
| OneStep                   | 102.742 ms                | 175.394 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:55:12.176914 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 12:55:12.290874 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=432, pq.top=432
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.359 ms                  | 14.125 ms                 |
| ProcessBack:UpdateCache   | 10.808 ms                 | 17.321 ms                 |
| ProcessBack:UpsertPq      | 21.534 ms                 | 39.712 ms                 |
| ProcessOneStep            | 47.951 ms                 | 69.151 ms                 |
| BlockToStepN              | 31.755 ms                 | 106.774 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 12:55:12.670029 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=1853
W20240129 12:55:13.214644 18292 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 12:55:13.290380 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=441, pq.top=441
E20240129 12:55:13.670008 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=4160
W20240129 12:55:14.216094 18292 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
W20240129 12:55:14.290906 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=450, pq.top=450
E20240129 12:55:14.670011 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=4089
W20240129 12:55:15.218670 18292 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
W20240129 12:55:15.290324 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=459, pq.top=459
E20240129 12:55:15.670174 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=2233
W20240129 12:55:16.290370 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=467, pq.top=467
W20240129 12:55:16.309618 18292 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 12:55:16.670127 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=38
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.803 ms                  | 29.287 ms                 |
| Forward                   | 4.781 ms                  | 10.412 ms                 |
| Backward                  | 4.342 ms                  | 9.662 ms                  |
| Optimize                  | 1.888 ms                  | 3.836 ms                  |
| BarrierTimeBeforeRank0    | 3.752 ms                  | 30.403 ms                 |
| AfterBackward             | 47.344 ms                 | 68.948 ms                 |
| BlockToStepN              | 33.327 ms                 | 97.038 ms                 |
| OneStep                   | 103.317 ms                | 173.269 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 12:55:17.318812 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=476, pq.top=476
W20240129 12:55:17.346809 18292 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 8.293 ms                  | 14.125 ms                 |
| ProcessBack:UpdateCache   | 10.866 ms                 | 17.264 ms                 |
| ProcessBack:UpsertPq      | 21.148 ms                 | 39.188 ms                 |
| ProcessOneStep            | 47.186 ms                 | 68.906 ms                 |
| BlockToStepN              | 33.458 ms                 | 106.774 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 12:55:17.670058 18291 parallel_pq_v2.h:76] insert failed, size(hashtable)=5044
W20240129 12:55:18.340313 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=484, pq.top=484
W20240129 12:55:18.378904 18292 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 12:55:18.670008 17214 parallel_pq_v2.h:76] insert failed, size(hashtable)=207
W20240129 12:55:19.340692 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=491, pq.top=491
W20240129 12:55:19.379045 18292 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 12:55:19.671242 18292 parallel_pq_v2.h:76] insert failed, size(hashtable)=11
W20240129 12:55:20.340482 17214 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=499, pq.top=499
W20240129 12:55:20.381157 18292 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
[proc 6] 500 steps, total: 11.648, sample: 0.352, forward: 0.477, backward: 0.515, update: 0.175
[proc 1] 500 steps, total: 11.648, sample: 0.334, forward: 0.452, backward: 0.491, update: 0.170
[proc 5] 500 steps, total: 11.648, sample: 0.329, forward: 0.460, backward: 0.510, update: 0.171
[proc 4] 500 steps, total: 11.648, sample: 0.345, forward: 0.460, backward: 0.528, update: 0.177
[proc 0] 500 steps, total: 11.648, sample: 0.413, forward: 0.472, backward: 0.445, update: 0.182
[proc 7] 500 steps, total: 11.648, sample: 0.374, forward: 0.482, backward: 0.483, update: 0.164
Successfully xmh. training takes 56.993539333343506 seconds
[proc 3] 500 steps, total: 11.648, sample: 0.368, forward: 0.476, backward: 0.481, update: 0.174
before call kg_cache_controller.StopThreads()
[proc 2] 500 steps, total: 11.648, sample: 0.386, forward: 0.463, backward: 0.486, update: 0.170
W20240129 12:55:20.477869 17214 grad_async_v2.h:71] call StopThreads. PID = 16364
W20240129 12:55:20.477905 17214 grad_base.h:212] before processOneStepNegThread_.join();
W20240129 12:55:20.478201 17214 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 12:55:20.478219 17214 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240129 12:55:20.490190 17214 grad_async_v2.h:92] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f75e8804450>

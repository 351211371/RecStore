WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 13:37:43.938607 28488 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_34', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [28488 sampler.py:454] Start PreSampling
WARNING [28488 sampler.py:532] Before construct renumbering_dict
WARNING [28488 sampler.py:555] PreSampling done
W20240129 13:37:48.518150 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 13:37:48.518321 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 13:37:48.518363 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 13:37:48.518401 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 13:37:48.518430 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 13:37:48.518464 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 13:37:48.518508 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 13:37:48.518555 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 13:37:48.518597 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 13:37:48.518635 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 13:37:48.518677 28488 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 13:37:48.518707 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 13:37:48.518733 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 13:37:48.518843 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 13:37:48.518885 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 13:37:48.518926 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 13:37:48.518970 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 13:37:48.519001 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 13:37:48.519038 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 13:37:48.519074 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 13:37:48.519111 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 13:37:48.519160 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 13:37:48.519201 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 13:37:48.519238 28488 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 13:37:48.519265 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 13:37:48.519300 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 13:37:48.519358 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 13:37:48.519397 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 13:37:48.519431 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 13:37:48.519469 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 13:37:48.519501 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 13:37:48.519536 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 13:37:48.519575 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 13:37:48.519614 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 13:37:48.519649 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 13:37:48.519680 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 13:37:48.519711 28488 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 13:37:48.519737 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 13:37:48.519762 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 13:37:48.519819 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 13:37:48.519867 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 13:37:48.519898 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 13:37:48.519939 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 13:37:48.519973 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 13:37:48.520004 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 13:37:48.520042 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 13:37:48.520081 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 13:37:48.520120 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 13:37:48.520161 28488 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 13:37:48.520195 28488 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 13:37:48.520220 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 13:37:48.520246 28488 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 13:37:48.764596 28488 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240129 13:37:48.764755 28488 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=9703, num_edges=161860,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11374, num_edges=168961,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=10715, num_edges=190828,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=11184, num_edges=240046,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9703 N 161860 E
MertisPartition: part 1 has 11374 N 168961 E
MertisPartition: part 2 has 10715 N 190828 E
MertisPartition: part 3 has 11184 N 240046 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([   6,   10,   11,  ..., 5824, 6189, 2559]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 929, 1016, 1041,  ..., 5833, 4331, 8234]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 4.928 seconds
[Rank1] pid = 28910
[Rank2] pid = 28941
INFO [28488 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [28488 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [28941 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [28976 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [28910 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [28910 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [28941 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [28976 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 13:37:50.715080 28993 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240129 13:37:50.717075 28911 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240129 13:37:50.717139 29102 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240129 13:37:50.717146 28975 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240129 13:37:50.750679 28993 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10001487c000 7.629 MB
W20240129 13:37:50.750692 29102 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x10001501f000 7.629 MB
W20240129 13:37:50.750696 28975 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1000157c2000 7.629 MB
W20240129 13:37:50.750703 28911 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x100015f65000 7.629 MB
W20240129 13:37:50.750986 28975 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x100016708000 7.629 MB
W20240129 13:37:50.751020 28911 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100016eab000 7.629 MB
W20240129 13:37:50.751034 28993 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10001764e000 7.629 MB
W20240129 13:37:50.751052 29102 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x100017df1000 7.629 MB
W20240129 13:37:50.751083 28975 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x100018594000 1.49 GB
W20240129 13:37:50.751103 28993 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x100077b77000 1.49 GB
W20240129 13:37:50.751130 28911 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000d715a000 1.49 GB
W20240129 13:37:50.751150 29102 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x10013673d000 1.49 GB
W20240129 13:37:50.751158 28975 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x100195d20000 1.49 GB
W20240129 13:37:50.751161 28993 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1001f5303000 1.49 GB
W20240129 13:37:50.751205 28911 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1002548e6000 1.49 GB
W20240129 13:37:50.751224 29102 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1002b3ec9000 1.49 GB
W20240129 13:37:50.751231 28993 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 13:37:50.751245 28975 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 13:37:50.751267 29102 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 13:37:50.751269 28911 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 13:37:50.758076 28993 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 13:37:50.758095 28975 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 13:37:50.758108 29102 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 13:37:50.758136 28911 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [28976 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [28910 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [28941 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 28976
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [28488 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 13:37:53.324468 28993 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240129 13:37:53.324936 28975 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 13:37:53.325091 28911 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 13:37:53.325862 29102 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240129 13:37:53.328498 28993 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 13:37:53.328639 28993 grad_base.h:184] Init GradProcessingBase done
I20240129 13:37:53.333032 28993 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240129 13:37:53.333134 28993 kg_controller.h:78] after init GradAsyncProcessingV2
I20240129 13:37:53.333142 28993 kg_controller.h:84] Construct KGCacheController done
E20240129 13:37:53.780723 28993 recstore.cc:66] init folly done
E20240129 13:37:53.781205 28911 recstore.cc:66] init folly done
E20240129 13:37:53.781334 29102 recstore.cc:66] init folly done
E20240129 13:37:53.781538 28975 recstore.cc:66] init folly done
I20240129 13:37:53.782521 28993 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 13:37:54.159778 29896 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 13:37:54.160120 29896 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240129 13:37:54.209061 28993 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240129 13:37:54.211612 28911 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 13:37:54.229468 28975 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 13:37:54.267573 29102 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240129 13:37:56.189289 29558 parallel_pq_v2.h:76] insert failed, size(hashtable)=3
W20240129 13:37:56.211067 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=1, pq.top=0
W20240129 13:37:56.242231 29896 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 13:37:57.189021 29896 parallel_pq_v2.h:76] insert failed, size(hashtable)=1739
W20240129 13:37:57.215672 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=18, pq.top=18
W20240129 13:37:57.251266 29896 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end9
E20240129 13:37:58.189209 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=5900
W20240129 13:37:58.217036 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=32, pq.top=32
W20240129 13:37:58.295255 29896 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.458 ms                  | 35.884 ms                 |
| Forward                   | 6.239 ms                  | 788.919 ms                |
| Backward                  | 4.896 ms                  | 246.806 ms                |
| Optimize                  | 2.415 ms                  | 5.544 ms                  |
| BarrierTimeBeforeRank0    | 56.279 us                 | 137.028 ms                |
| AfterBackward             | 24.589 ms                 | 764.476 ms                |
| BlockToStepN              | 9.378 ms                  | 111.280 ms                |
| OneStep                   | 54.912 ms                 | 1.973 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.734 ms                  | 164.290 ms                |
| ProcessBack:UpdateCache   | 3.042 ms                  | 431.630 ms                |
| ProcessBack:UpsertPq      | 17.967 ms                 | 22.555 ms                 |
| ProcessOneStep            | 24.621 ms                 | 764.002 ms                |
| BlockToStepN              | 11.414 ms                 | 111.114 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 13:37:59.189019 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=4601
W20240129 13:37:59.232582 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=47, pq.top=47
W20240129 13:37:59.306577 29896 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end8
E20240129 13:38:00.189006 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=3633
W20240129 13:38:00.260766 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=62, pq.top=62
W20240129 13:38:00.341743 29896 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end4
E20240129 13:38:01.189015 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=6703
W20240129 13:38:01.260448 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=77, pq.top=77
W20240129 13:38:01.349823 29896 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end9
E20240129 13:38:02.189013 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=8143
W20240129 13:38:02.279304 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=91, pq.top=91
W20240129 13:38:02.359031 29896 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 8.623, sample: 0.582, forward: 1.329, backward: 0.692, update: 0.270
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 8.605, sample: 0.526, forward: 1.194, backward: 0.779, update: 0.241
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 8.567, sample: 0.503, forward: 1.532, backward: 0.710, update: 0.244
train_sampler.Prefill()
-------Step 0-------
tensor([ 5919,  7952, 13274,  5331,   157,  5532,  7305,   164,  5609, 11815]) tensor([ 1041, 10691,  2639, 14048,  2538,  7940,  3900,  6412,  3390, 14062])
-------Step 1-------
tensor([ 5919,  7952, 13274,  5331,   157,  5532,  7305,   164,  5609, 11815]) tensor([ 2230, 13327,  6888,  5385, 13305,  8174,   970,  9640,   836,  8734])
-------Step 2-------
tensor([ 9535,    93,  1673,   136,  7355,  2969, 14824,   851, 13335,  3600]) tensor([ 6367,  5216,  5866,  6938,  6128,  6235,  9871, 13895,  6770, 10480])
-------Step 3-------
tensor([ 9535,    93,  1673,   136,  7355,  2969, 14824,   851, 13335,  3600]) tensor([11190,  9451, 10482,  7057,   740,  8595,  8372,  4017,  3199, 11948])
-------Step 4-------
tensor([    4,  5637, 13098, 12443,  9388,  7943,  7977,  1684, 12133,  2748]) tensor([10276,  1045,  1854,  1240,  7510, 13083,   819,  1335,  6127,  6575])
-------Step 5-------
tensor([    4,  5637, 13098, 12443,  9388,  7943,  7977,  1684, 12133,  2748]) tensor([ 1270, 13427,  1178,  2600,  5751,   118, 14627,  3851,  3629, 10622])
-------Step 6-------
tensor([10976, 13087,  9848,    95,   972, 13534,    52,  9842,  9450,   153]) tensor([ 7949, 14758,   757,  2683,  1895,  2592,  1043,  2060,  3596, 13672])
-------Step 7-------
tensor([10976, 13087,  9848,    95,   972, 13534,    52,  9842,  9450,   153]) tensor([11013,  6724, 14081,  6694,  8021,  1404, 11407,  6706,  3717,  9271])
-------Step 8-------
tensor([ 6333,  6130,  4964, 12512,  2458,  9820, 11727, 14319,    54, 10146]) tensor([ 2236,  9015,  7306,   540,  6135, 13489,  5842,  7849,  7657, 12678])
-------Step 9-------
tensor([ 6333,  6130,  4964, 12512,  2458,  9820, 11727, 14319,    54, 10146]) tensor([ 2580,   504,  8351,  6079,  2234,  2391, 12963,  5948,   427, 14278])
before start barrier
start train
[proc 0] 100 steps, total: 8.625, sample: 0.528, forward: 1.390, backward: 0.735, update: 0.269
E20240129 13:38:03.189054 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=3809
W20240129 13:38:03.291419 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=106, pq.top=106
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.468 ms                  | 34.676 ms                 |
| Forward                   | 5.893 ms                  | 11.341 ms                 |
| Backward                  | 4.829 ms                  | 9.428 ms                  |
| Optimize                  | 2.461 ms                  | 5.544 ms                  |
| BarrierTimeBeforeRank0    | 1.195 ms                  | 18.972 ms                 |
| AfterBackward             | 25.005 ms                 | 56.486 ms                 |
| BlockToStepN              | 14.441 ms                 | 83.013 ms                 |
| OneStep                   | 61.013 ms                 | 159.642 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:03.364553 29896 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.714 ms                  | 4.118 ms                  |
| ProcessBack:UpdateCache   | 2.995 ms                  | 4.027 ms                  |
| ProcessBack:UpsertPq      | 18.663 ms                 | 25.706 ms                 |
| ProcessOneStep            | 24.975 ms                 | 56.451 ms                 |
| BlockToStepN              | 14.847 ms                 | 82.945 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 13:38:04.189006 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=6650
W20240129 13:38:04.301544 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=120, pq.top=120
W20240129 13:38:04.390771 29896 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end2
E20240129 13:38:05.189008 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=3546
W20240129 13:38:05.326716 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=134, pq.top=134
W20240129 13:38:05.398772 29896 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 13:38:06.189039 29896 parallel_pq_v2.h:76] insert failed, size(hashtable)=17
W20240129 13:38:06.363636 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=146, pq.top=146
W20240129 13:38:06.403635 29896 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
E20240129 13:38:07.189011 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=6052
W20240129 13:38:07.363312 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=157, pq.top=157
W20240129 13:38:07.404234 29896 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 13:38:08.189006 28993 parallel_pq_v2.h:76] insert failed, size(hashtable)=2871
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.527 ms                  | 35.884 ms                 |
| Forward                   | 5.799 ms                  | 11.341 ms                 |
| Backward                  | 4.868 ms                  | 9.379 ms                  |
| Optimize                  | 2.514 ms                  | 5.544 ms                  |
| BarrierTimeBeforeRank0    | 979.279 us                | 32.795 ms                 |
| AfterBackward             | 25.138 ms                 | 41.246 ms                 |
| BlockToStepN              | 15.482 ms                 | 111.532 ms                |
| OneStep                   | 65.714 ms                 | 208.506 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:08.385329 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=171, pq.top=171
W20240129 13:38:08.416164 29896 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.706 ms                  | 4.118 ms                  |
| ProcessBack:UpdateCache   | 2.975 ms                  | 4.027 ms                  |
| ProcessBack:UpsertPq      | 18.854 ms                 | 33.854 ms                 |
| ProcessOneStep            | 25.032 ms                 | 41.218 ms                 |
| BlockToStepN              | 15.792 ms                 | 111.451 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 13:38:09.189033 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=2330
W20240129 13:38:09.386593 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=182, pq.top=182
W20240129 13:38:09.422917 29896 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 13:38:10.189006 28993 parallel_pq_v2.h:76] insert failed, size(hashtable)=1544
W20240129 13:38:10.415167 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=196, pq.top=196
W20240129 13:38:10.429114 29896 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end6
[proc 2] 200 steps, total: 7.874, sample: 0.585, forward: 0.600, backward: 0.488, update: 0.256
[proc 0] 200 steps, total: 7.874, sample: 0.568, forward: 0.571, backward: 0.507, update: 0.275
[proc 3] 200 steps, total: 7.874, sample: 0.518, forward: 0.519, backward: 0.515, update: 0.231
[proc 1] 200 steps, total: 7.875, sample: 0.498, forward: 0.529, backward: 0.615, update: 0.231
E20240129 13:38:11.189018 29558 parallel_pq_v2.h:76] insert failed, size(hashtable)=1031
W20240129 13:38:11.430590 29896 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end9
W20240129 13:38:11.456318 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=209, pq.top=209
E20240129 13:38:12.189023 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=4465
W20240129 13:38:12.460541 29896 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end3
W20240129 13:38:12.476244 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=223, pq.top=223
E20240129 13:38:13.189395 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=8053
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.594 ms                  | 35.884 ms                 |
| Forward                   | 5.730 ms                  | 11.341 ms                 |
| Backward                  | 4.885 ms                  | 9.393 ms                  |
| Optimize                  | 2.528 ms                  | 5.854 ms                  |
| BarrierTimeBeforeRank0    | 1.354 ms                  | 40.384 ms                 |
| AfterBackward             | 25.188 ms                 | 41.246 ms                 |
| BlockToStepN              | 16.635 ms                 | 124.195 ms                |
| OneStep                   | 66.777 ms                 | 208.506 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:13.462635 29896 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
W20240129 13:38:13.492821 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=232, pq.top=232
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.704 ms                  | 4.118 ms                  |
| ProcessBack:UpdateCache   | 2.911 ms                  | 3.996 ms                  |
| ProcessBack:UpsertPq      | 18.914 ms                 | 33.446 ms                 |
| ProcessOneStep            | 25.215 ms                 | 41.218 ms                 |
| BlockToStepN              | 16.585 ms                 | 124.104 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 13:38:14.189006 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=4614
W20240129 13:38:14.492261 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=246, pq.top=246
W20240129 13:38:14.624037 29896 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end7
E20240129 13:38:15.204068 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=3587
W20240129 13:38:15.532778 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=248, pq.top=248
W20240129 13:38:15.646622 29896 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 13:38:16.204010 29896 parallel_pq_v2.h:76] insert failed, size(hashtable)=107
W20240129 13:38:16.594981 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=262, pq.top=262
W20240129 13:38:16.717576 29896 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end3
E20240129 13:38:17.204022 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=8893
W20240129 13:38:17.594347 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=276, pq.top=276
W20240129 13:38:17.785787 29896 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end8
E20240129 13:38:18.204007 28993 parallel_pq_v2.h:76] insert failed, size(hashtable)=299
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.678 ms                  | 35.861 ms                 |
| Forward                   | 5.710 ms                  | 11.341 ms                 |
| Backward                  | 4.868 ms                  | 9.393 ms                  |
| Optimize                  | 2.534 ms                  | 5.924 ms                  |
| BarrierTimeBeforeRank0    | 1.292 ms                  | 39.717 ms                 |
| AfterBackward             | 25.548 ms                 | 40.926 ms                 |
| BlockToStepN              | 16.575 ms                 | 124.195 ms                |
| OneStep                   | 66.882 ms                 | 208.506 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:18.638157 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=290, pq.top=290
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.711 ms                  | 4.037 ms                  |
| ProcessBack:UpdateCache   | 2.856 ms                  | 3.836 ms                  |
| ProcessBack:UpsertPq      | 19.214 ms                 | 33.436 ms                 |
| ProcessOneStep            | 25.523 ms                 | 40.899 ms                 |
| BlockToStepN              | 16.386 ms                 | 124.104 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:18.823400 29896 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end3
E20240129 13:38:19.204006 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=6807
[proc 1] 300 steps, total: 8.713, sample: 0.484, forward: 0.514, backward: 0.497, update: 0.245
[proc 3] 300 steps, total: 8.714, sample: 0.597, forward: 0.578, backward: 0.449, update: 0.272
[proc 0] 300 steps, total: 8.714, sample: 0.549, forward: 0.566, backward: 0.484, update: 0.284
[proc 2] 300 steps, total: 8.714, sample: 0.478, forward: 0.526, backward: 0.495, update: 0.226
W20240129 13:38:19.642882 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=303, pq.top=303
W20240129 13:38:19.838728 29896 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 13:38:20.204006 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=7344
W20240129 13:38:20.644661 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=316, pq.top=316
W20240129 13:38:20.850581 29896 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 13:38:21.204008 29558 parallel_pq_v2.h:76] insert failed, size(hashtable)=504
W20240129 13:38:21.657482 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=329, pq.top=329
W20240129 13:38:21.873891 29896 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end2
E20240129 13:38:22.204007 29558 parallel_pq_v2.h:76] insert failed, size(hashtable)=268
W20240129 13:38:22.682585 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=342, pq.top=342
W20240129 13:38:22.879940 29896 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 13:38:23.204005 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=8512
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.790 ms                  | 35.884 ms                 |
| Forward                   | 5.703 ms                  | 10.973 ms                 |
| Backward                  | 4.896 ms                  | 9.393 ms                  |
| Optimize                  | 2.544 ms                  | 5.854 ms                  |
| BarrierTimeBeforeRank0    | 1.297 ms                  | 39.652 ms                 |
| AfterBackward             | 26.121 ms                 | 43.526 ms                 |
| BlockToStepN              | 17.061 ms                 | 124.195 ms                |
| OneStep                   | 68.010 ms                 | 208.506 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:23.733445 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=357, pq.top=357
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.722 ms                  | 4.259 ms                  |
| ProcessBack:UpdateCache   | 2.817 ms                  | 3.836 ms                  |
| ProcessBack:UpsertPq      | 19.731 ms                 | 34.880 ms                 |
| ProcessOneStep            | 26.225 ms                 | 43.212 ms                 |
| BlockToStepN              | 16.899 ms                 | 122.358 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:23.889727 29896 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 13:38:24.204017 28993 parallel_pq_v2.h:76] insert failed, size(hashtable)=1317
W20240129 13:38:24.769665 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=371, pq.top=371
W20240129 13:38:24.933074 29896 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 13:38:25.204017 29896 parallel_pq_v2.h:76] insert failed, size(hashtable)=10
W20240129 13:38:25.810084 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=384, pq.top=384
W20240129 13:38:25.945684 29896 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 13:38:26.204007 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=3040
W20240129 13:38:26.810112 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=397, pq.top=397
W20240129 13:38:26.958973 29896 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end0
[proc 3] 400 steps, total: 7.586, sample: 0.589, forward: 0.602, backward: 0.485, update: 0.293
[proc 2] 400 steps, total: 7.586, sample: 0.504, forward: 0.567, backward: 0.491, update: 0.229
[proc 1] 400 steps, total: 7.586, sample: 0.466, forward: 0.472, backward: 0.491, update: 0.225
[proc 0] 400 steps, total: 7.586, sample: 0.586, forward: 0.582, backward: 0.513, update: 0.278
E20240129 13:38:27.204007 29558 parallel_pq_v2.h:76] insert failed, size(hashtable)=2983
W20240129 13:38:27.810338 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=409, pq.top=409
W20240129 13:38:27.963780 29896 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end1
E20240129 13:38:28.204007 28993 parallel_pq_v2.h:76] insert failed, size(hashtable)=341
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.842 ms                  | 37.267 ms                 |
| Forward                   | 5.710 ms                  | 11.453 ms                 |
| Backward                  | 4.894 ms                  | 9.393 ms                  |
| Optimize                  | 2.528 ms                  | 5.854 ms                  |
| BarrierTimeBeforeRank0    | 1.142 ms                  | 39.652 ms                 |
| AfterBackward             | 26.787 ms                 | 43.242 ms                 |
| BlockToStepN              | 17.741 ms                 | 122.448 ms                |
| OneStep                   | 68.290 ms                 | 204.727 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.719 ms                  | 4.250 ms                  |
| ProcessBack:UpdateCache   | 2.791 ms                  | 3.796 ms                  |
| ProcessBack:UpsertPq      | 20.086 ms                 | 34.861 ms                 |
| ProcessOneStep            | 26.796 ms                 | 43.212 ms                 |
| BlockToStepN              | 17.743 ms                 | 122.358 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:28.874800 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=423, pq.top=423
W20240129 13:38:28.971014 29896 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end4
E20240129 13:38:29.204030 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=4669
W20240129 13:38:29.874858 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=436, pq.top=436
W20240129 13:38:29.990607 29896 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 13:38:30.204007 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=11027
W20240129 13:38:30.874334 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=449, pq.top=449
W20240129 13:38:30.996433 29896 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 13:38:31.204007 28993 parallel_pq_v2.h:76] insert failed, size(hashtable)=430
W20240129 13:38:31.917152 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=462, pq.top=462
W20240129 13:38:32.007768 29896 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 13:38:32.204116 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=4743
W20240129 13:38:32.917589 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=472, pq.top=472
W20240129 13:38:33.012945 29896 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 13:38:33.204011 29558 parallel_pq_v2.h:76] insert failed, size(hashtable)=2500
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.858 ms                  | 38.209 ms                 |
| Forward                   | 5.710 ms                  | 11.341 ms                 |
| Backward                  | 4.886 ms                  | 9.379 ms                  |
| Optimize                  | 2.521 ms                  | 5.795 ms                  |
| BarrierTimeBeforeRank0    | 1.005 ms                  | 39.649 ms                 |
| AfterBackward             | 26.865 ms                 | 43.193 ms                 |
| BlockToStepN              | 18.719 ms                 | 122.448 ms                |
| OneStep                   | 68.311 ms                 | 204.727 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.716 ms                  | 4.188 ms                  |
| ProcessBack:UpdateCache   | 2.762 ms                  | 3.751 ms                  |
| ProcessBack:UpsertPq      | 20.213 ms                 | 34.656 ms                 |
| ProcessOneStep            | 26.808 ms                 | 43.162 ms                 |
| BlockToStepN              | 18.887 ms                 | 122.358 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:38:33.917549 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=486, pq.top=486
W20240129 13:38:34.017899 29896 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
E20240129 13:38:34.204018 29895 parallel_pq_v2.h:76] insert failed, size(hashtable)=3458
W20240129 13:38:34.917512 28993 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=497, pq.top=497
W20240129 13:38:35.020504 29896 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
[proc 3] 500 steps, total: 8.177, sample: 0.475, forward: 0.506, backward: 0.472, update: 0.226
[proc 2] 500 steps, total: 8.177, sample: 0.548, forward: 0.563, backward: 0.479, update: 0.223
[proc 1] 500 steps, total: 8.177, sample: 0.485, forward: 0.514, backward: 0.620, update: 0.224
[proc 0] 500 steps, total: 8.177, sample: 0.590, forward: 0.586, backward: 0.481, update: 0.291
Successfully xmh. training takes 40.9765841960907 seconds
before call kg_cache_controller.StopThreads()
W20240129 13:38:35.185653 28993 grad_async_v2.h:71] call StopThreads. PID = 28488
W20240129 13:38:35.185685 28993 grad_base.h:212] before processOneStepNegThread_.join();
W20240129 13:38:35.186029 28993 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 13:38:35.186043 28993 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240129 13:38:35.205765 28993 grad_async_v2.h:92] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fca3a4db0d0>

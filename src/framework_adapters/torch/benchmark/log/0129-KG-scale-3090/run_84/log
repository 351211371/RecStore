WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240130 13:50:42.205541  5944 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_40', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [5944 sampler.py:454] Start PreSampling
WARNING [5944 sampler.py:532] Before construct renumbering_dict
WARNING [5944 sampler.py:555] PreSampling done
W20240130 14:10:15.370147  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240130 14:10:15.370345  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240130 14:10:15.370389  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240130 14:10:15.370430  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240130 14:10:15.370471  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240130 14:10:15.370509  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240130 14:10:15.370539  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240130 14:10:15.370581  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240130 14:10:15.370618  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240130 14:10:15.370657  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240130 14:10:15.370700  5944 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240130 14:10:15.370733  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240130 14:10:15.370764  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240130 14:10:15.370929  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240130 14:10:15.370970  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240130 14:10:15.371006  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240130 14:10:15.371047  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240130 14:10:15.371078  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240130 14:10:15.371106  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240130 14:10:15.371138  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240130 14:10:15.371174  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240130 14:10:15.371205  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240130 14:10:15.371244  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240130 14:10:15.371280  5944 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240130 14:10:15.371309  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240130 14:10:15.371335  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240130 14:10:15.371402  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240130 14:10:15.371434  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240130 14:10:15.371472  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240130 14:10:15.371506  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240130 14:10:15.371542  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240130 14:10:15.371575  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240130 14:10:15.371615  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240130 14:10:15.371647  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240130 14:10:15.371680  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240130 14:10:15.371713  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240130 14:10:15.371743  5944 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240130 14:10:15.371769  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240130 14:10:15.371801  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240130 14:10:15.371876  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240130 14:10:15.371914  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240130 14:10:15.371944  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240130 14:10:15.371976  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240130 14:10:15.372006  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240130 14:10:15.372056  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240130 14:10:15.372112  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240130 14:10:15.372146  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240130 14:10:15.372179  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240130 14:10:15.372217  5944 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240130 14:10:15.372251  5944 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240130 14:10:15.372278  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240130 14:10:15.372306  5944 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240130 14:10:15.782328  5944 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240130 14:10:15.782483  5944 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302731,  4302753,   121425,  ..., 68773887, 15311296,  2582973]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1690.570 seconds
[Rank1] pid = 30229
[Rank2] pid = 30389
INFO [5944 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [30229 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [30389 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [30552 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [30389 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [30552 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240130 14:18:58.640825 30616 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240130 14:18:58.640830 30390 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
INFO [30229 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [5944 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240130 14:18:58.644080 30553 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240130 14:18:58.644443 30230 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240130 14:18:58.694334 30616 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036619000 7.629 MB
W20240130 14:18:58.694343 30230 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102036dbc000 7.629 MB
W20240130 14:18:58.694346 30390 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10203755f000 7.629 MB
W20240130 14:18:58.694367 30553 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102037d02000 7.629 MB
W20240130 14:18:58.694497 30616 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1020384a5000 7.629 MB
W20240130 14:18:58.694502 30230 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102038c48000 7.629 MB
W20240130 14:18:58.694505 30553 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1020393eb000 7.629 MB
W20240130 14:18:58.694525 30390 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x102039b8e000 7.629 MB
W20240130 14:18:58.694576 30553 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10203a331000 1.49 GB
W20240130 14:18:58.694598 30616 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102099914000 1.49 GB
W20240130 14:18:58.694604 30230 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240130 14:18:58.694620 30390 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1021584da000 1.49 GB
W20240130 14:18:58.694643 30553 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1021b7abd000 1.49 GB
W20240130 14:18:58.694679 30230 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1022170a0000 1.49 GB
W20240130 14:18:58.694685 30616 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x102276683000 1.49 GB
W20240130 14:18:58.694702 30390 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1022d5c66000 1.49 GB
W20240130 14:18:58.694722 30553 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240130 14:18:58.694746 30230 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240130 14:18:58.694746 30616 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240130 14:18:58.694749 30390 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240130 14:18:58.701206 30230 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240130 14:18:58.701206 30553 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240130 14:18:58.701215 30616 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240130 14:18:58.701246 30390 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [30229 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [30552 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 30552
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [5944 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [30389 DistTensor.py:56] The tensor name already exists in the kvstore
I20240130 14:19:31.040264 30390 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240130 14:19:31.040434 30616 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240130 14:19:31.040503 30553 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240130 14:19:31.040561 30230 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240130 14:19:31.041695 30553 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240130 14:19:31.041841 30553 grad_base.h:184] Init GradProcessingBase done
I20240130 14:19:43.950166 30553 grad_async_v2.h:43] Use main thread to update emb.
W20240130 14:19:43.950426 30553 kg_controller.h:78] after init GradAsyncProcessingV2
I20240130 14:19:43.950436 30553 kg_controller.h:84] Construct KGCacheController done
E20240130 14:19:45.408746 30390 recstore.cc:66] init folly done
E20240130 14:19:45.408758 30230 recstore.cc:66] init folly done
E20240130 14:19:45.408975 30616 recstore.cc:66] init folly done
E20240130 14:19:45.409384 30553 recstore.cc:66] init folly done
I20240130 14:19:45.410367 30553 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240130 14:19:57.712328 31966 grad_async_v2.h:139] Detect new sample comes, old_end0, new_end1
E20240130 14:19:57.712617 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240130 14:19:59.243033 31966 grad_async_v2.h:139] Detect new sample comes, old_end0, new_end1
E20240130 14:19:59.243144 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 121.050 us                | 295.565 us                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:03.773099 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end2
E20240130 14:20:03.788455 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240130 14:20:03.881296 30616 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 125.044 us                | 267.056 us                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:06.656679 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end2
E20240130 14:20:06.671849 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240130 14:20:06.716590 30553 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240130 14:20:06.784447 30230 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240130 14:20:07.215826 30390 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240130 14:20:08.699836 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240130 14:20:08.746870 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240130 14:20:08.751996 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end2
E20240130 14:20:09.699007 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=663
W20240130 14:20:09.757906 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=11, pq.top=11
W20240130 14:20:09.954725 31966 grad_async_v2.h:139] Detect new sample comes, old_end6, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 245.553 us                | 1.969 ms                  |
| ProcessBack:Shuffle       | 2.598 ms                  | 203.573 ms                |
| ProcessBack:UpdateCache   | 3.000 ms                  | 309.808 ms                |
| ProcessBack:UpsertPq      | 17.902 ms                 | 73.631 ms                 |
| ProcessOneStep            | 62.626 ms                 | 630.756 ms                |
| BlockToStepN              | 529.469 us                | 3.775 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240130 14:20:10.699527 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240130 14:20:10.901964 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=19, pq.top=19
W20240130 14:20:10.974254 31966 grad_async_v2.h:139] Detect new sample comes, old_end9, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.188 ms                  | 132.468 ms                |
| Forward                   | 5.223 ms                  | 689.000 ms                |
| Backward                  | 5.205 ms                  | 195.357 ms                |
| Optimize                  | 2.182 ms                  | 4.904 ms                  |
| BarrierTimeBeforeRank0    | 1.088 ms                  | 21.549 ms                 |
| AfterBackward             | 62.657 ms                 | 631.117 ms                |
| BlockToStepN              | 667.619 us                | 9.487 ms                  |
| OneStep                   | 88.023 ms                 | 1.532 s                   |
+---------------------------+---------------------------+---------------------------+
E20240130 14:20:11.699008 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1699
W20240130 14:20:11.914717 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=32, pq.top=32
W20240130 14:20:12.169137 31966 grad_async_v2.h:139] Detect new sample comes, old_end5, new_end6
E20240130 14:20:12.699009 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=308
W20240130 14:20:13.040119 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=41, pq.top=41
W20240130 14:20:13.232386 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end4
E20240130 14:20:13.699018 32097 parallel_pq_v2.h:76] insert failed, size(hashtable)=9670
W20240130 14:20:14.068408 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=53, pq.top=53
W20240130 14:20:14.464191 31966 grad_async_v2.h:139] Detect new sample comes, old_end5, new_end6
E20240130 14:20:14.699018 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=4069
W20240130 14:20:14.715191 30553 grad_async_v2.h:256] pq is empty
W20240130 14:20:15.201699 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=63, pq.top=63
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 354.569 us                | 6.731 ms                  |
| ProcessBack:Shuffle       | 2.429 ms                  | 163.791 ms                |
| ProcessBack:UpdateCache   | 2.671 ms                  | 308.955 ms                |
| ProcessBack:UpsertPq      | 25.848 ms                 | 78.879 ms                 |
| ProcessOneStep            | 52.183 ms                 | 505.484 ms                |
| BlockToStepN              | 472.233 us                | 9.398 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:15.626686 31966 grad_async_v2.h:139] Detect new sample comes, old_end6, new_end7
E20240130 14:20:15.699020 31553 parallel_pq_v2.h:76] insert failed, size(hashtable)=8298
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.279 ms                  | 109.405 ms                |
| Forward                   | 4.868 ms                  | 9.350 ms                  |
| Backward                  | 5.092 ms                  | 6.261 ms                  |
| Optimize                  | 2.091 ms                  | 4.792 ms                  |
| BarrierTimeBeforeRank0    | 55.013 us                 | 21.549 ms                 |
| AfterBackward             | 51.476 ms                 | 505.528 ms                |
| BlockToStepN              | 531.571 us                | 9.487 ms                  |
| OneStep                   | 85.016 ms                 | 536.396 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:16.241017 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=72, pq.top=72
W20240130 14:20:16.683200 31966 grad_async_v2.h:139] Detect new sample comes, old_end7, new_end8
E20240130 14:20:16.699002 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=2991
W20240130 14:20:17.349949 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=85, pq.top=85
E20240130 14:20:17.699018 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=3412
W20240130 14:20:17.942987 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end0
E20240130 14:20:18.699012 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1216
W20240130 14:20:18.864063 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=95, pq.top=95
W20240130 14:20:19.015148 31966 grad_async_v2.h:139] Detect new sample comes, old_end6, new_end8
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 12.399, sample: 1.360, forward: 1.071, backward: 0.626, update: 0.214
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 11.967, sample: 1.464, forward: 1.123, backward: 0.691, update: 0.228
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 15.302, sample: 1.717, forward: 1.170, backward: 0.652, update: 0.238
train_sampler.Prefill()
-------Step 0-------
tensor([   68432,   775042, 51465961,   957459,   403765,   775068,   775093,
          248533,    68473,    68500]) tensor([ 4815627, 31300681, 20097261, 60621615, 49486579, 25037748, 80955858,
        65687340, 65152361, 76050325])
-------Step 1-------
tensor([   68432,   775042, 51465961,   957459,   403765,   775068,   775093,
          248533,    68473,    68500]) tensor([33072247, 69681001, 81009296,  9525535, 68259681,  7913701, 84068796,
        74242543, 18956277, 29847798])
-------Step 2-------
tensor([  837736,    83014, 69825271,    83047,   837759,   837782,   837803,
        37593580,   837830,   837852]) tensor([34091199,  4964335, 48136396,  9487744, 14268114, 13434333, 66603010,
        10261464, 48429064, 29450981])
-------Step 3-------
tensor([  837736,    83014, 69825271,    83047,   837759,   837782,   837803,
        37593580,   837830,   837852]) tensor([20484948, 41266791, 82893692, 37088716, 15880831, 76378977, 68326038,
        55135955, 24268611, 80897883])
-------Step 4-------
tensor([895719,  98236, 895742, 895766,  98274, 895786,  98334, 895804,  98391,
        895829]) tensor([75499315, 37059732, 15481005, 15351405, 55480190, 45726712, 82644706,
        51790537, 48954651,  9820434])
-------Step 5-------
tensor([895719,  98236, 895742, 895766,  98274, 895786,  98334, 895804,  98391,
        895829]) tensor([33468733, 46586054, 83377454,  8708595, 34995452, 26728156, 41791674,
        56913018, 85234932,   337931])
-------Step 6-------
tensor([70832418,   948753,   948772,   948793,  4308097,   948808,   948823,
          948837,   948851,   253227]) tensor([22883300, 37430269, 25696588, 18508394, 73228251, 48933830, 38944264,
        16271980, 55762852,  8660168])
-------Step 7-------
tensor([70832418,   948753,   948772,   948793,  4308097,   948808,   948823,
          948837,   948851,   253227]) tensor([40136183, 81375552, 60561904, 65866636, 56802156,  1532618, 15707678,
        44317921, 18408074, 13876501])
-------Step 8-------
tensor([ 1003279,   130987,  1003302, 33758046,   987434,  1003324,  1003346,
         1003367,   254579,   987460]) tensor([21411471, 53940296, 46946111, 83845718, 72496588, 60593759, 57422395,
        81367931,  9692376,  3241443])
-------Step 9-------
tensor([ 1003279,   130987,  1003302, 33758046,   987434,  1003324,  1003346,
         1003367,   254579,   987460]) tensor([68502523, 57207307, 23849077, 38061308, 11002399,  1059373, 23038717,
        12784978, 82709832, 53123957])
before start barrier
start train
[proc 0] 100 steps, total: 12.466, sample: 1.794, forward: 1.193, backward: 0.704, update: 0.249
E20240130 14:20:19.699008 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=40
W20240130 14:20:19.887975 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=108, pq.top=108
W20240130 14:20:20.152896 31966 grad_async_v2.h:139] Detect new sample comes, old_end3, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 385.910 us                | 4.282 ms                  |
| ProcessBack:Shuffle       | 2.513 ms                  | 6.245 ms                  |
| ProcessBack:UpdateCache   | 2.740 ms                  | 13.714 ms                 |
| ProcessBack:UpsertPq      | 20.806 ms                 | 74.246 ms                 |
| ProcessOneStep            | 47.588 ms                 | 585.559 ms                |
| BlockToStepN              | 758.359 us                | 9.398 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240130 14:20:20.699024 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=448
W20240130 14:20:20.982079 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=120, pq.top=120
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.279 ms                  | 132.468 ms                |
| Forward                   | 4.906 ms                  | 9.350 ms                  |
| Backward                  | 5.162 ms                  | 29.604 ms                 |
| Optimize                  | 2.206 ms                  | 5.143 ms                  |
| BarrierTimeBeforeRank0    | 314.709 us                | 45.132 ms                 |
| AfterBackward             | 47.620 ms                 | 585.603 ms                |
| BlockToStepN              | 891.461 us                | 15.510 ms                 |
| OneStep                   | 86.550 ms                 | 613.290 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:21.222466 31966 grad_async_v2.h:139] Detect new sample comes, old_end5, new_end4
E20240130 14:20:21.699008 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=157
W20240130 14:20:22.038230 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=133, pq.top=133
W20240130 14:20:22.271070 31966 grad_async_v2.h:139] Detect new sample comes, old_end6, new_end5
E20240130 14:20:22.699084 31965 parallel_pq_v2.h:76] insert failed, size(hashtable)=16835
W20240130 14:20:23.066916 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=145, pq.top=145
W20240130 14:20:23.457204 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end6
E20240130 14:20:23.699014 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=18754
W20240130 14:20:24.507447 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=157, pq.top=157
W20240130 14:20:24.529647 31966 grad_async_v2.h:139] Detect new sample comes, old_end2, new_end8
E20240130 14:20:24.699016 32084 parallel_pq_v2.h:76] insert failed, size(hashtable)=2503
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 407.478 us                | 7.931 ms                  |
| ProcessBack:Shuffle       | 2.594 ms                  | 6.237 ms                  |
| ProcessBack:UpdateCache   | 2.874 ms                  | 13.078 ms                 |
| ProcessBack:UpsertPq      | 16.191 ms                 | 74.246 ms                 |
| ProcessOneStep            | 47.588 ms                 | 526.128 ms                |
| BlockToStepN              | 788.429 us                | 11.379 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:25.536069 31966 grad_async_v2.h:139] Detect new sample comes, old_end5, new_end2
E20240130 14:20:25.699012 31553 parallel_pq_v2.h:76] insert failed, size(hashtable)=49560
W20240130 14:20:25.726897 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=175, pq.top=175
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.542 ms                  | 109.405 ms                |
| Forward                   | 5.114 ms                  | 9.206 ms                  |
| Backward                  | 5.077 ms                  | 7.802 ms                  |
| Optimize                  | 2.328 ms                  | 5.291 ms                  |
| BarrierTimeBeforeRank0    | 641.050 us                | 36.989 ms                 |
| AfterBackward             | 46.348 ms                 | 526.176 ms                |
| BlockToStepN              | 888.642 us                | 29.641 ms                 |
| OneStep                   | 81.769 ms                 | 546.900 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:26.587944 31966 grad_async_v2.h:139] Detect new sample comes, old_end0, new_end3
E20240130 14:20:26.699007 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=10016
W20240130 14:20:26.730690 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=183, pq.top=183
W20240130 14:20:27.620138 31966 grad_async_v2.h:139] Detect new sample comes, old_end0, new_end3
E20240130 14:20:27.699014 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=101
W20240130 14:20:28.004601 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=197, pq.top=197
[proc 0] 200 steps, total: 9.095, sample: 1.348, forward: 0.563, backward: 0.533, update: 0.280
[proc 2] 200 steps, total: 9.095, sample: 1.299, forward: 0.487, backward: 0.461, update: 0.220
[proc 1] 200 steps, total: 9.095, sample: 1.389, forward: 0.492, backward: 0.467, update: 0.220
[proc 3] 200 steps, total: 9.095, sample: 1.358, forward: 0.629, backward: 0.544, update: 0.263
E20240130 14:20:28.699013 32102 parallel_pq_v2.h:76] insert failed, size(hashtable)=30984
W20240130 14:20:28.900398 31966 grad_async_v2.h:139] Detect new sample comes, old_end8, new_end9
W20240130 14:20:29.491559 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=211, pq.top=211
E20240130 14:20:29.699014 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1057
W20240130 14:20:29.903020 31966 grad_async_v2.h:139] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 300.878 us                | 5.277 ms                  |
| ProcessBack:Shuffle       | 2.624 ms                  | 6.525 ms                  |
| ProcessBack:UpdateCache   | 2.999 ms                  | 5.813 ms                  |
| ProcessBack:UpsertPq      | 16.066 ms                 | 87.961 ms                 |
| ProcessOneStep            | 45.971 ms                 | 526.128 ms                |
| BlockToStepN              | 1.007 ms                  | 36.708 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:30.568828 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=225, pq.top=224
E20240130 14:20:30.699009 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=17739
W20240130 14:20:30.910200 31966 grad_async_v2.h:139] Detect new sample comes, old_end7, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.292 ms                  | 109.405 ms                |
| Forward                   | 5.115 ms                  | 10.198 ms                 |
| Backward                  | 5.030 ms                  | 7.802 ms                  |
| Optimize                  | 2.348 ms                  | 6.061 ms                  |
| BarrierTimeBeforeRank0    | 378.588 us                | 43.560 ms                 |
| AfterBackward             | 45.953 ms                 | 526.176 ms                |
| BlockToStepN              | 1.072 ms                  | 38.359 ms                 |
| OneStep                   | 81.769 ms                 | 546.900 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:31.639464 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=237, pq.top=237
E20240130 14:20:31.703482 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240130 14:20:31.918457 31966 grad_async_v2.h:139] Detect new sample comes, old_end9, new_end1
W20240130 14:20:32.675294 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=249, pq.top=249
E20240130 14:20:32.703007 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=346
W20240130 14:20:32.942307 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end4
W20240130 14:20:33.690099 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=263, pq.top=263
E20240130 14:20:33.703007 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=26076
W20240130 14:20:33.943742 31966 grad_async_v2.h:139] Detect new sample comes, old_end4, new_end7
E20240130 14:20:34.703009 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=7389
W20240130 14:20:34.735922 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=277, pq.top=277
W20240130 14:20:34.950642 31966 grad_async_v2.h:139] Detect new sample comes, old_end4, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 388.532 us                | 13.387 ms                 |
| ProcessBack:Shuffle       | 2.626 ms                  | 6.525 ms                  |
| ProcessBack:UpdateCache   | 3.067 ms                  | 4.406 ms                  |
| ProcessBack:UpsertPq      | 14.551 ms                 | 89.419 ms                 |
| ProcessOneStep            | 45.574 ms                 | 505.484 ms                |
| BlockToStepN              | 1.229 ms                  | 36.708 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 14:20:35.703009 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1964
W20240130 14:20:36.015890 31966 grad_async_v2.h:139] Detect new sample comes, old_end5, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.880 ms                  | 107.882 ms                |
| Forward                   | 5.192 ms                  | 10.198 ms                 |
| Backward                  | 5.062 ms                  | 9.500 ms                  |
| Optimize                  | 2.353 ms                  | 6.471 ms                  |
| BarrierTimeBeforeRank0    | 75.788 us                 | 43.844 ms                 |
| AfterBackward             | 45.601 ms                 | 505.528 ms                |
| BlockToStepN              | 1.326 ms                  | 36.776 ms                 |
| OneStep                   | 82.812 ms                 | 536.396 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:36.404842 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=293, pq.top=293
E20240130 14:20:36.703012 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=30445
[proc 3] 300 steps, total: 8.765, sample: 0.840, forward: 0.511, backward: 0.613, update: 0.223
[proc 0] 300 steps, total: 8.765, sample: 1.060, forward: 0.533, backward: 0.587, update: 0.268
[proc 1] 300 steps, total: 8.765, sample: 0.835, forward: 0.532, backward: 0.512, update: 0.240
[proc 2] 300 steps, total: 8.765, sample: 1.007, forward: 0.503, backward: 0.526, update: 0.212
W20240130 14:20:37.099603 31966 grad_async_v2.h:139] Detect new sample comes, old_end5, new_end1
W20240130 14:20:37.408288 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=305, pq.top=305
E20240130 14:20:37.703404 32108 parallel_pq_v2.h:76] insert failed, size(hashtable)=96985
W20240130 14:20:38.136421 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end2
W20240130 14:20:38.446604 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=316, pq.top=316
E20240130 14:20:38.709820 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240130 14:20:39.326920 31966 grad_async_v2.h:139] Detect new sample comes, old_end7, new_end6
W20240130 14:20:39.446704 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=326, pq.top=326
E20240130 14:20:39.709375 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=235
W20240130 14:20:40.331290 31966 grad_async_v2.h:139] Detect new sample comes, old_end7, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 414.858 us                | 19.255 ms                 |
| ProcessBack:Shuffle       | 2.630 ms                  | 6.909 ms                  |
| ProcessBack:UpdateCache   | 3.025 ms                  | 4.426 ms                  |
| ProcessBack:UpsertPq      | 14.297 ms                 | 91.364 ms                 |
| ProcessOneStep            | 45.574 ms                 | 505.484 ms                |
| BlockToStepN              | 1.422 ms                  | 61.888 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 14:20:40.709400 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240130 14:20:40.883749 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=337, pq.top=337
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.374 ms                  | 107.882 ms                |
| Forward                   | 5.193 ms                  | 12.769 ms                 |
| Backward                  | 5.102 ms                  | 9.535 ms                  |
| Optimize                  | 2.377 ms                  | 7.423 ms                  |
| BarrierTimeBeforeRank0    | 72.714 us                 | 43.844 ms                 |
| AfterBackward             | 45.953 ms                 | 505.528 ms                |
| BlockToStepN              | 1.497 ms                  | 61.981 ms                 |
| OneStep                   | 82.302 ms                 | 538.900 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:41.403503 31966 grad_async_v2.h:139] Detect new sample comes, old_end0, new_end3
E20240130 14:20:41.709009 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=25954
W20240130 14:20:41.923364 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=350, pq.top=350
W20240130 14:20:42.533690 31966 grad_async_v2.h:139] Detect new sample comes, old_end0, new_end7
E20240130 14:20:42.709015 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=11
W20240130 14:20:42.933764 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=358, pq.top=358
W20240130 14:20:43.558096 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end5
E20240130 14:20:43.709267 32082 parallel_pq_v2.h:76] insert failed, size(hashtable)=88754
W20240130 14:20:44.321277 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=375, pq.top=375
E20240130 14:20:44.709043 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=32822
W20240130 14:20:44.770155 31966 grad_async_v2.h:139] Detect new sample comes, old_end9, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 353.669 us                | 6.436 ms                  |
| ProcessBack:Shuffle       | 2.635 ms                  | 7.147 ms                  |
| ProcessBack:UpdateCache   | 2.959 ms                  | 4.406 ms                  |
| ProcessBack:UpsertPq      | 14.133 ms                 | 91.364 ms                 |
| ProcessOneStep            | 45.915 ms                 | 505.484 ms                |
| BlockToStepN              | 1.480 ms                  | 61.888 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:45.574717 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=383, pq.top=382
E20240130 14:20:45.709012 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=124
W20240130 14:20:45.777077 31966 grad_async_v2.h:139] Detect new sample comes, old_end4, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.782 ms                  | 107.882 ms                |
| Forward                   | 5.228 ms                  | 10.765 ms                 |
| Backward                  | 5.032 ms                  | 9.500 ms                  |
| Optimize                  | 2.433 ms                  | 7.247 ms                  |
| BarrierTimeBeforeRank0    | 106.941 us                | 43.560 ms                 |
| AfterBackward             | 46.002 ms                 | 515.219 ms                |
| BlockToStepN              | 1.566 ms                  | 68.799 ms                 |
| OneStep                   | 81.769 ms                 | 546.900 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:46.651962 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=397, pq.top=397
E20240130 14:20:46.709008 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=60942
W20240130 14:20:46.786099 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end0
[proc 0] 400 steps, total: 9.765, sample: 1.116, forward: 0.621, backward: 0.534, update: 0.281
[proc 3] 400 steps, total: 9.765, sample: 1.289, forward: 0.472, backward: 0.415, update: 0.211
[proc 1] 400 steps, total: 9.765, sample: 1.254, forward: 0.472, backward: 0.494, update: 0.219
[proc 2] 400 steps, total: 9.765, sample: 1.277, forward: 0.480, backward: 0.559, update: 0.216
E20240130 14:20:47.709013 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=155
W20240130 14:20:47.798758 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=411, pq.top=411
W20240130 14:20:47.940006 31966 grad_async_v2.h:139] Detect new sample comes, old_end3, new_end4
E20240130 14:20:48.709018 32081 parallel_pq_v2.h:76] insert failed, size(hashtable)=21919
W20240130 14:20:48.966922 31966 grad_async_v2.h:139] Detect new sample comes, old_end4, new_end5
E20240130 14:20:49.709009 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=367
W20240130 14:20:49.873948 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=437, pq.top=437
W20240130 14:20:50.065065 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 426.095 us                | 18.917 ms                 |
| ProcessBack:Shuffle       | 2.634 ms                  | 7.677 ms                  |
| ProcessBack:UpdateCache   | 2.950 ms                  | 4.406 ms                  |
| ProcessBack:UpsertPq      | 14.689 ms                 | 89.419 ms                 |
| ProcessOneStep            | 45.915 ms                 | 515.168 ms                |
| BlockToStepN              | 1.517 ms                  | 73.405 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240130 14:20:50.709017 31553 parallel_pq_v2.h:76] insert failed, size(hashtable)=82
W20240130 14:20:50.874045 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=442, pq.top=442
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.751 ms                  | 107.882 ms                |
| Forward                   | 5.246 ms                  | 10.765 ms                 |
| Backward                  | 4.950 ms                  | 9.500 ms                  |
| Optimize                  | 2.385 ms                  | 7.247 ms                  |
| BarrierTimeBeforeRank0    | 295.092 us                | 43.560 ms                 |
| AfterBackward             | 45.601 ms                 | 515.219 ms                |
| BlockToStepN              | 1.621 ms                  | 73.503 ms                 |
| OneStep                   | 80.934 ms                 | 546.900 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:51.073779 31966 grad_async_v2.h:139] Detect new sample comes, old_end1, new_end5
E20240130 14:20:51.709010 31553 parallel_pq_v2.h:76] insert failed, size(hashtable)=82992
W20240130 14:20:52.261757 31966 grad_async_v2.h:139] Detect new sample comes, old_end4, new_end5
W20240130 14:20:52.413161 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=455, pq.top=455
E20240130 14:20:52.709012 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=38435
W20240130 14:20:53.325817 31966 grad_async_v2.h:139] Detect new sample comes, old_end0, new_end5
W20240130 14:20:53.466936 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=466, pq.top=466
E20240130 14:20:53.709008 30553 parallel_pq_v2.h:76] insert failed, size(hashtable)=85
W20240130 14:20:54.370180 31966 grad_async_v2.h:139] Detect new sample comes, old_end5, new_end4
W20240130 14:20:54.476732 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=475, pq.top=475
E20240130 14:20:54.709012 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=13799
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 463.291 us                | 11.774 ms                 |
| ProcessBack:Shuffle       | 2.637 ms                  | 8.501 ms                  |
| ProcessBack:UpdateCache   | 2.937 ms                  | 4.389 ms                  |
| ProcessBack:UpsertPq      | 15.009 ms                 | 94.835 ms                 |
| ProcessOneStep            | 45.915 ms                 | 515.168 ms                |
| BlockToStepN              | 1.577 ms                  | 73.405 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:55.438719 31966 grad_async_v2.h:139] Detect new sample comes, old_end2, new_end3
W20240130 14:20:55.677151 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=485, pq.top=485
E20240130 14:20:55.709017 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=24078
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.751 ms                  | 107.002 ms                |
| Forward                   | 5.280 ms                  | 10.198 ms                 |
| Backward                  | 4.927 ms                  | 9.629 ms                  |
| Optimize                  | 2.388 ms                  | 7.210 ms                  |
| BarrierTimeBeforeRank0    | 384.741 us                | 42.803 ms                 |
| AfterBackward             | 46.002 ms                 | 526.176 ms                |
| BlockToStepN              | 1.671 ms                  | 73.503 ms                 |
| OneStep                   | 81.052 ms                 | 557.966 ms                |
+---------------------------+---------------------------+---------------------------+
W20240130 14:20:56.457264 31966 grad_async_v2.h:139] Detect new sample comes, old_end9, new_end4
E20240130 14:20:56.709010 31966 parallel_pq_v2.h:76] insert failed, size(hashtable)=27663
W20240130 14:20:56.751736 30553 grad_async_v2.h:269] Sleep in <BlockToStepN>, step_no=498, pq.top=498
[proc 0] 500 steps, total: 10.057, sample: 1.245, forward: 0.531, backward: 0.501, update: 0.261
[proc 3] 500 steps, total: 10.057, sample: 0.871, forward: 0.526, backward: 0.515, update: 0.250
[proc 1] 500 steps, total: 10.057, sample: 1.012, forward: 0.504, backward: 0.482, update: 0.234
[proc 2] 500 steps, total: 10.057, sample: 0.999, forward: 0.513, backward: 0.691, update: 0.223
Successfully xmh. training takes 50.14882016181946 seconds
before call kg_cache_controller.StopThreads()
W20240130 14:20:56.865407 30553 grad_async_v2.h:89] call StopThreads. PID = 5944
W20240130 14:20:56.865442 30553 grad_base.h:212] before processOneStepNegThread_.join();
W20240130 14:20:56.865839 30553 grad_base.h:214] after processOneStepNegThread_.join();
W20240130 14:20:56.865852 30553 grad_async_v2.h:91] call GradProcessingBase::StopThreads.
W20240130 14:20:57.470420 30553 grad_async_v2.h:110] StopThreads done.

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 13:30:34.972838 17449 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_30', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [17449 sampler.py:454] Start PreSampling
WARNING [17449 sampler.py:532] Before construct renumbering_dict
WARNING [17449 sampler.py:555] PreSampling done
W20240129 13:30:40.081594 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 13:30:40.081784 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 13:30:40.081836 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 13:30:40.081878 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 13:30:40.081934 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 13:30:40.081974 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 13:30:40.082027 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 13:30:40.082080 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 13:30:40.082118 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 13:30:40.082162 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 13:30:40.082209 17449 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 13:30:40.082250 17449 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 13:30:40.082288 17449 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 13:30:40.082420 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 13:30:40.082468 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 13:30:40.082520 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 13:30:40.082579 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 13:30:40.082630 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 13:30:40.082674 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 13:30:40.082720 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 13:30:40.082764 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 13:30:40.082818 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 13:30:40.082865 17449 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 13:30:40.082912 17449 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 13:30:40.082945 17449 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 13:30:40.082978 17449 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 13:30:40.348057 17449 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000098ca000 22.81 MB
W20240129 13:30:40.348268 17449 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000af9c000 58.4 kB
{0: Graph(num_nodes=13804, num_edges=289155,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12626, num_edges=379866,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13804 N 289155 E
MertisPartition: part 1 has 12626 N 379866 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  753,   819,   937,  ..., 11236, 11841, 11720]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.470 seconds
INFO [17877 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [17449 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [17449 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [17877 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240129 13:30:42.019398 17878 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240129 13:30:42.020095 17941 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240129 13:30:42.044911 17878 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10000afae000 7.629 MB
W20240129 13:30:42.045058 17878 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10000b751000 7.629 MB
W20240129 13:30:42.045109 17878 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10000bef4000 1.49 GB
W20240129 13:30:42.045163 17878 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10006b4d7000 1.49 GB
W20240129 13:30:42.045230 17878 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 13:30:42.047029 17878 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 13:30:42.047206 17941 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000caabe000 7.629 MB
W20240129 13:30:42.047318 17941 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000cb261000 7.629 MB
W20240129 13:30:42.047372 17941 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000cba04000 1.49 GB
W20240129 13:30:42.047418 17941 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10012afe7000 1.49 GB
W20240129 13:30:42.047451 17941 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 13:30:42.050247 17941 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
[Rank1] pid = 17877
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
cudaHostRegister 0x1000098ca000
0: KnownLocalCachedEmbedding init done
WARNING [17449 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x1000098ca000
1: KnownLocalCachedEmbedding init done
WARNING [17877 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 13:30:44.852934 17878 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240129 13:30:44.853078 17941 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240129 13:30:44.855293 17878 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 13:30:44.855711 17878 grad_base.h:184] Init GradProcessingBase done
I20240129 13:30:44.862540 17878 grad_async_v1.h:199] Use main thread to update emb.
W20240129 13:30:44.862605 17878 kg_controller.h:75] after init GradAsyncProcessing
I20240129 13:30:44.862633 17878 kg_controller.h:84] Construct KGCacheController done
E20240129 13:30:45.124202 17878 recstore.cc:66] init folly done
E20240129 13:30:45.124219 17941 recstore.cc:66] init folly done
I20240129 13:30:45.124890 17878 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 13:30:45.287233 18253 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
I20240129 13:30:45.339238 17878 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240129 13:30:45.348438 17941 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
W20240129 13:30:46.353792 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240129 13:30:46.456914 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:30:47.353016 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=14, pq.top=14
W20240129 13:30:47.466079 18253 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
W20240129 13:30:48.353015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=24, pq.top=24
W20240129 13:30:48.550304 18253 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
W20240129 13:30:49.353019 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=32, pq.top=32
W20240129 13:30:49.662133 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.422 ms                  | 33.215 ms                 |
| Forward                   | 4.938 ms                  | 566.644 ms                |
| Backward                  | 9.748 ms                  | 206.040 ms                |
| Optimize                  | 2.266 ms                  | 5.467 ms                  |
| BarrierTimeBeforeRank0    | 25.844 us                 | 5.321 ms                  |
| AfterBackward             | 6.572 ms                  | 225.451 ms                |
| BlockToStepN              | 77.768 ms                 | 111.267 ms                |
| OneStep                   | 103.922 ms                | 1.107 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 766.327 us                | 61.616 ms                 |
| ProcessBack:UpdateCache   | 626.241 us                | 111.854 ms                |
| ProcessBack:UpsertPq      | 4.581 ms                  | 10.055 ms                 |
| ProcessOneStep            | 6.484 ms                  | 225.216 ms                |
| BlockToStepN              | 78.921 ms                 | 122.271 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:30:50.353011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=39, pq.top=39
W20240129 13:30:50.699632 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:30:51.363612 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=46, pq.top=46
W20240129 13:30:51.812849 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:30:52.363016 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=52, pq.top=52
W20240129 13:30:52.881064 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:30:53.363015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=57, pq.top=57
W20240129 13:30:54.005492 18253 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 13:30:54.363011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=62, pq.top=62
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.684 ms                  | 28.825 ms                 |
| Forward                   | 4.992 ms                  | 9.812 ms                  |
| Backward                  | 9.673 ms                  | 11.655 ms                 |
| Optimize                  | 2.199 ms                  | 4.673 ms                  |
| BarrierTimeBeforeRank0    | 24.630 us                 | 3.898 ms                  |
| AfterBackward             | 6.499 ms                  | 11.626 ms                 |
| BlockToStepN              | 101.828 ms                | 169.076 ms                |
| OneStep                   | 135.029 ms                | 204.581 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:30:55.122848 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 777.970 us                | 61.616 ms                 |
| ProcessBack:UpdateCache   | 626.143 us                | 111.854 ms                |
| ProcessBack:UpsertPq      | 4.595 ms                  | 10.055 ms                 |
| ProcessOneStep            | 6.475 ms                  | 11.593 ms                 |
| BlockToStepN              | 102.119 ms                | 169.021 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:30:55.363008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=68, pq.top=68
W20240129 13:30:56.263473 18253 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 13:30:56.363010 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=73, pq.top=73
W20240129 13:30:57.363019 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=78, pq.top=78
W20240129 13:30:57.420537 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:30:58.363016 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=83, pq.top=83
W20240129 13:30:58.567998 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:30:59.363014 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=88, pq.top=88
W20240129 13:30:59.597461 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.761 ms                  | 28.825 ms                 |
| Forward                   | 4.995 ms                  | 9.812 ms                  |
| Backward                  | 9.661 ms                  | 11.655 ms                 |
| Optimize                  | 2.196 ms                  | 4.673 ms                  |
| BarrierTimeBeforeRank0    | 22.566 us                 | 3.898 ms                  |
| AfterBackward             | 6.465 ms                  | 11.626 ms                 |
| BlockToStepN              | 132.381 ms                | 200.828 ms                |
| OneStep                   | 160.791 ms                | 227.594 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 779.746 us                | 3.001 ms                  |
| ProcessBack:UpdateCache   | 624.848 us                | 872.766 us                |
| ProcessBack:UpsertPq      | 4.558 ms                  | 9.430 ms                  |
| ProcessOneStep            | 6.430 ms                  | 11.593 ms                 |
| BlockToStepN              | 134.069 ms                | 202.001 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:00.363016 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=93, pq.top=93
W20240129 13:31:00.718261 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:01.363015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=98, pq.top=98
W20240129 13:31:01.748757 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 16.622, sample: 0.390, forward: 0.922, backward: 1.075, update: 0.219
train_sampler.Prefill()
-------Step 0-------
tensor([  317,  5292,  9856,  7813,  2742, 13841,  3936,  7439,  7186,  6872]) tensor([  966,  9618, 11778,  9997, 14765,  7212,  6384,   573,  6285, 10926])
-------Step 1-------
tensor([  317,  5292,  9856,  7813,  2742, 13841,  3936,  7439,  7186,  6872]) tensor([11755,  2135,   522,   394,  9468,  8942, 12716, 10518,  1904,  3760])
-------Step 2-------
tensor([ 5107,  7482,   105,  3418, 11123,  2776, 10817,   622,  1464, 11021]) tensor([ 3399,   449,  1403,  1837,  3519,  7328, 14222, 14887, 12081,  6765])
-------Step 3-------
tensor([ 5107,  7482,   105,  3418, 11123,  2776, 10817,   622,  1464, 11021]) tensor([ 2221,   447,  9597, 12285,  3071,   530, 13289, 10050,  2422,  5267])
-------Step 4-------
tensor([10643, 12940,   310,    34,  2631, 14585,  6823,  4860,  6216, 10228]) tensor([10130,  4454,  4073,  7367,  8195,  4283,  7812, 11891,   805,  6233])
-------Step 5-------
tensor([10643, 12940,   310,    34,  2631, 14585,  6823,  4860,  6216, 10228]) tensor([10332, 12592,  9620, 12370,  2112,  9045, 11320, 12467,  7337, 10148])
-------Step 6-------
tensor([   87, 11212,   250,   128,   776,  7182,  7706,  6701,   177, 13202]) tensor([ 9161,  4094,  3617,  4092,  7491,  9375,  9687, 13366, 11959,  4230])
-------Step 7-------
tensor([   87, 11212,   250,   128,   776,  7182,  7706,  6701,   177, 13202]) tensor([ 8802,    66,  3555, 12797,   950,  5767,  1004, 12862,  8202,  9787])
-------Step 8-------
tensor([10451,  7147,   155,   261,  4743,  2975,  6235,  6370,  1587, 12174]) tensor([  354,  5141,    40,  2044, 11338,  7441,  4571,  2411, 14637, 14939])
-------Step 9-------
tensor([10451,  7147,   155,   261,  4743,  2975,  6235,  6370,  1587, 12174]) tensor([10742, 12292,  5151,  4799,  2119, 10400,  7083,  7679,  5393, 13148])
before start barrier
start train
[proc 0] 100 steps, total: 16.631, sample: 0.477, forward: 1.056, backward: 1.158, update: 0.247
W20240129 13:31:02.363019 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=102, pq.top=102
W20240129 13:31:02.835559 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:03.363013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=107, pq.top=107
W20240129 13:31:03.858693 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:04.363004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=112, pq.top=112
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.832 ms                  | 28.825 ms                 |
| Forward                   | 5.040 ms                  | 9.812 ms                  |
| Backward                  | 9.661 ms                  | 11.655 ms                 |
| Optimize                  | 2.200 ms                  | 4.673 ms                  |
| BarrierTimeBeforeRank0    | 22.566 us                 | 3.898 ms                  |
| AfterBackward             | 6.437 ms                  | 11.626 ms                 |
| BlockToStepN              | 151.104 ms                | 202.634 ms                |
| OneStep                   | 180.238 ms                | 241.914 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:04.944799 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 780.439 us                | 3.001 ms                  |
| ProcessBack:UpdateCache   | 624.832 us                | 872.766 us                |
| ProcessBack:UpsertPq      | 4.558 ms                  | 9.430 ms                  |
| ProcessOneStep            | 6.412 ms                  | 11.593 ms                 |
| BlockToStepN              | 151.053 ms                | 202.540 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:05.363008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=116, pq.top=116
W20240129 13:31:06.058553 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:06.363011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=121, pq.top=121
W20240129 13:31:07.123159 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:07.363009 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=126, pq.top=126
W20240129 13:31:08.190822 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:08.363011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=130, pq.top=130
W20240129 13:31:09.260860 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:09.363004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=135, pq.top=135
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.861 ms                  | 28.825 ms                 |
| Forward                   | 4.992 ms                  | 9.812 ms                  |
| Backward                  | 9.657 ms                  | 11.724 ms                 |
| Optimize                  | 2.227 ms                  | 4.673 ms                  |
| BarrierTimeBeforeRank0    | 22.019 us                 | 3.898 ms                  |
| AfterBackward             | 6.437 ms                  | 11.626 ms                 |
| BlockToStepN              | 158.249 ms                | 207.321 ms                |
| OneStep                   | 188.966 ms                | 241.914 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 783.297 us                | 2.909 ms                  |
| ProcessBack:UpdateCache   | 615.849 us                | 844.063 us                |
| ProcessBack:UpsertPq      | 4.577 ms                  | 8.893 ms                  |
| ProcessOneStep            | 6.412 ms                  | 11.593 ms                 |
| BlockToStepN              | 159.022 ms                | 207.281 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:10.326731 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:10.363008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240129 13:31:11.363018 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=144, pq.top=144
W20240129 13:31:11.416772 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:12.363018 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=149, pq.top=149
W20240129 13:31:12.506386 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:13.363004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=153, pq.top=153
W20240129 13:31:13.676134 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:14.363015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=157, pq.top=157
W20240129 13:31:14.816673 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.866 ms                  | 27.863 ms                 |
| Forward                   | 4.938 ms                  | 8.124 ms                  |
| Backward                  | 9.648 ms                  | 11.655 ms                 |
| Optimize                  | 2.226 ms                  | 4.632 ms                  |
| BarrierTimeBeforeRank0    | 22.096 us                 | 2.334 ms                  |
| AfterBackward             | 6.465 ms                  | 11.229 ms                 |
| BlockToStepN              | 167.100 ms                | 215.418 ms                |
| OneStep                   | 197.707 ms                | 248.958 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 787.233 us                | 2.909 ms                  |
| ProcessBack:UpdateCache   | 613.015 us                | 844.063 us                |
| ProcessBack:UpsertPq      | 4.574 ms                  | 9.430 ms                  |
| ProcessOneStep            | 6.437 ms                  | 11.178 ms                 |
| BlockToStepN              | 167.008 ms                | 215.302 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:15.363015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=162, pq.top=162
W20240129 13:31:15.906342 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:16.404994 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=167, pq.top=167
W20240129 13:31:17.027299 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:17.404004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=171, pq.top=171
W20240129 13:31:18.186447 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:18.404009 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=175, pq.top=175
W20240129 13:31:19.350278 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:19.404008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=180, pq.top=180
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.889 ms                  | 28.007 ms                 |
| Forward                   | 4.938 ms                  | 8.124 ms                  |
| Backward                  | 9.646 ms                  | 11.655 ms                 |
| Optimize                  | 2.204 ms                  | 4.632 ms                  |
| BarrierTimeBeforeRank0    | 22.032 us                 | 2.334 ms                  |
| AfterBackward             | 6.488 ms                  | 11.229 ms                 |
| BlockToStepN              | 174.172 ms                | 219.155 ms                |
| OneStep                   | 202.695 ms                | 259.271 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 788.076 us                | 1.309 ms                  |
| ProcessBack:UpdateCache   | 609.636 us                | 825.750 us                |
| ProcessBack:UpsertPq      | 4.574 ms                  | 8.989 ms                  |
| ProcessOneStep            | 6.466 ms                  | 11.178 ms                 |
| BlockToStepN              | 174.113 ms                | 219.098 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:20.404011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=184, pq.top=184
W20240129 13:31:20.465149 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:21.404016 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=188, pq.top=188
W20240129 13:31:21.629276 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:22.404006 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=193, pq.top=193
W20240129 13:31:22.851233 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:23.404007 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=197, pq.top=197
W20240129 13:31:24.062135 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
[proc 0] 200 steps, total: 22.278, sample: 0.533, forward: 0.482, backward: 0.953, update: 0.243
[proc 1] 200 steps, total: 22.278, sample: 0.409, forward: 0.392, backward: 0.921, update: 0.209
W20240129 13:31:24.404011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=201, pq.top=201
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.927 ms                  | 28.007 ms                 |
| Forward                   | 4.992 ms                  | 8.124 ms                  |
| Backward                  | 9.648 ms                  | 11.655 ms                 |
| Optimize                  | 2.200 ms                  | 4.632 ms                  |
| BarrierTimeBeforeRank0    | 22.019 us                 | 2.334 ms                  |
| AfterBackward             | 6.515 ms                  | 11.229 ms                 |
| BlockToStepN              | 175.938 ms                | 228.352 ms                |
| OneStep                   | 204.445 ms                | 260.926 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 798.004 us                | 1.309 ms                  |
| ProcessBack:UpdateCache   | 610.656 us                | 825.750 us                |
| ProcessBack:UpsertPq      | 4.574 ms                  | 8.989 ms                  |
| ProcessOneStep            | 6.479 ms                  | 11.178 ms                 |
| BlockToStepN              | 176.021 ms                | 228.220 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:25.138078 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:25.404008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=206, pq.top=206
W20240129 13:31:26.268456 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:26.404009 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=210, pq.top=210
W20240129 13:31:27.404017 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=214, pq.top=214
W20240129 13:31:27.473822 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 13:31:28.404012 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=218, pq.top=218
W20240129 13:31:28.641716 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:29.404004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=223, pq.top=223
W20240129 13:31:29.820290 18253 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.006 ms                  | 28.007 ms                 |
| Forward                   | 5.010 ms                  | 8.124 ms                  |
| Backward                  | 9.646 ms                  | 11.655 ms                 |
| Optimize                  | 2.199 ms                  | 4.632 ms                  |
| BarrierTimeBeforeRank0    | 22.032 us                 | 2.334 ms                  |
| AfterBackward             | 6.519 ms                  | 11.229 ms                 |
| BlockToStepN              | 179.480 ms                | 234.807 ms                |
| OneStep                   | 207.904 ms                | 261.874 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 798.600 us                | 1.300 ms                  |
| ProcessBack:UpdateCache   | 604.948 us                | 798.266 us                |
| ProcessBack:UpsertPq      | 4.595 ms                  | 8.893 ms                  |
| ProcessOneStep            | 6.486 ms                  | 11.178 ms                 |
| BlockToStepN              | 180.248 ms                | 234.706 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:30.404011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=227, pq.top=227
W20240129 13:31:31.003021 18253 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 13:31:31.404007 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=231, pq.top=231
W20240129 13:31:32.008787 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:32.404011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=235, pq.top=235
W20240129 13:31:33.173324 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:31:33.429899 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=240, pq.top=240
W20240129 13:31:34.337977 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:34.429009 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=244, pq.top=244
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.011 ms                  | 28.007 ms                 |
| Forward                   | 5.010 ms                  | 8.124 ms                  |
| Backward                  | 9.648 ms                  | 11.655 ms                 |
| Optimize                  | 2.200 ms                  | 4.632 ms                  |
| BarrierTimeBeforeRank0    | 22.032 us                 | 2.960 ms                  |
| AfterBackward             | 6.530 ms                  | 11.229 ms                 |
| BlockToStepN              | 182.546 ms                | 235.711 ms                |
| OneStep                   | 211.528 ms                | 262.992 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 800.146 us                | 1.309 ms                  |
| ProcessBack:UpdateCache   | 605.339 us                | 798.266 us                |
| ProcessBack:UpsertPq      | 4.581 ms                  | 8.893 ms                  |
| ProcessOneStep            | 6.513 ms                  | 11.178 ms                 |
| BlockToStepN              | 182.444 ms                | 235.612 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:35.429011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=248, pq.top=248
W20240129 13:31:35.483496 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:31:36.442727 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=253, pq.top=253
W20240129 13:31:36.661015 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:37.442005 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=257, pq.top=257
W20240129 13:31:37.808876 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:31:38.442010 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=261, pq.top=261
W20240129 13:31:38.992578 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:39.442013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=266, pq.top=266
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.011 ms                  | 27.863 ms                 |
| Forward                   | 4.992 ms                  | 7.085 ms                  |
| Backward                  | 9.646 ms                  | 11.441 ms                 |
| Optimize                  | 2.199 ms                  | 4.387 ms                  |
| BarrierTimeBeforeRank0    | 22.019 us                 | 2.334 ms                  |
| AfterBackward             | 6.543 ms                  | 10.969 ms                 |
| BlockToStepN              | 184.517 ms                | 234.807 ms                |
| OneStep                   | 213.530 ms                | 261.874 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:40.018508 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 802.418 us                | 1.309 ms                  |
| ProcessBack:UpdateCache   | 604.769 us                | 798.266 us                |
| ProcessBack:UpsertPq      | 4.595 ms                  | 8.893 ms                  |
| ProcessOneStep            | 6.519 ms                  | 10.903 ms                 |
| BlockToStepN              | 184.355 ms                | 234.706 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:40.442008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=270, pq.top=270
W20240129 13:31:41.068166 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:41.442010 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=275, pq.top=275
W20240129 13:31:42.247243 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:31:42.442008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=279, pq.top=279
W20240129 13:31:43.401587 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:43.442008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=284, pq.top=284
W20240129 13:31:44.442018 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=288, pq.top=288
W20240129 13:31:44.597853 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.023 ms                  | 28.825 ms                 |
| Forward                   | 5.010 ms                  | 7.085 ms                  |
| Backward                  | 9.644 ms                  | 11.441 ms                 |
| Optimize                  | 2.193 ms                  | 4.387 ms                  |
| BarrierTimeBeforeRank0    | 22.032 us                 | 2.334 ms                  |
| AfterBackward             | 6.565 ms                  | 10.969 ms                 |
| BlockToStepN              | 185.077 ms                | 235.711 ms                |
| OneStep                   | 215.332 ms                | 262.992 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 803.223 us                | 1.300 ms                  |
| ProcessBack:UpdateCache   | 603.106 us                | 793.300 us                |
| ProcessBack:UpsertPq      | 4.604 ms                  | 8.989 ms                  |
| ProcessOneStep            | 6.539 ms                  | 10.903 ms                 |
| BlockToStepN              | 185.026 ms                | 235.870 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:45.442004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=292, pq.top=292
W20240129 13:31:45.795406 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:46.442011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=296, pq.top=296
W20240129 13:31:46.960323 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
[proc 1] 300 steps, total: 23.153, sample: 0.361, forward: 0.395, backward: 0.914, update: 0.203
[proc 0] 300 steps, total: 23.153, sample: 0.522, forward: 0.495, backward: 0.953, update: 0.234
W20240129 13:31:47.443343 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=301, pq.top=301
W20240129 13:31:48.083962 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:48.443008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=305, pq.top=305
W20240129 13:31:49.188603 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:31:49.443013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=310, pq.top=310
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.041 ms                  | 28.825 ms                 |
| Forward                   | 5.010 ms                  | 7.085 ms                  |
| Backward                  | 9.643 ms                  | 11.441 ms                 |
| Optimize                  | 2.191 ms                  | 4.387 ms                  |
| BarrierTimeBeforeRank0    | 22.088 us                 | 2.960 ms                  |
| AfterBackward             | 6.572 ms                  | 10.969 ms                 |
| BlockToStepN              | 186.199 ms                | 236.374 ms                |
| OneStep                   | 216.279 ms                | 265.142 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 805.347 us                | 1.309 ms                  |
| ProcessBack:UpdateCache   | 599.513 us                | 798.266 us                |
| ProcessBack:UpsertPq      | 4.624 ms                  | 9.247 ms                  |
| ProcessOneStep            | 6.542 ms                  | 10.903 ms                 |
| BlockToStepN              | 186.111 ms                | 236.252 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:50.332924 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:50.443009 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=314, pq.top=314
W20240129 13:31:51.443010 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=318, pq.top=318
W20240129 13:31:51.448791 18253 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 13:31:52.443015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=323, pq.top=323
W20240129 13:31:52.622035 18253 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 13:31:53.443014 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=327, pq.top=327
W20240129 13:31:53.640753 18253 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 13:31:54.443013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=331, pq.top=331
W20240129 13:31:54.797161 18253 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.034 ms                  | 28.825 ms                 |
| Forward                   | 5.007 ms                  | 7.085 ms                  |
| Backward                  | 9.641 ms                  | 11.655 ms                 |
| Optimize                  | 2.191 ms                  | 4.387 ms                  |
| BarrierTimeBeforeRank0    | 22.088 us                 | 2.960 ms                  |
| AfterBackward             | 6.581 ms                  | 11.229 ms                 |
| BlockToStepN              | 188.588 ms                | 236.374 ms                |
| OneStep                   | 218.729 ms                | 265.142 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 805.910 us                | 1.300 ms                  |
| ProcessBack:UpdateCache   | 596.131 us                | 813.505 us                |
| ProcessBack:UpsertPq      | 4.610 ms                  | 9.247 ms                  |
| ProcessOneStep            | 6.547 ms                  | 11.178 ms                 |
| BlockToStepN              | 188.582 ms                | 236.252 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:31:55.443004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=335, pq.top=335
W20240129 13:31:55.937655 18253 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 13:31:56.443011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=340, pq.top=340
W20240129 13:31:57.113380 18253 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 13:31:57.443009 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=344, pq.top=344
W20240129 13:31:58.204404 18253 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 13:31:58.453091 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=349, pq.top=349
W20240129 13:31:59.376348 18253 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 13:31:59.453007 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=353, pq.top=353
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.034 ms                  | 28.007 ms                 |
| Forward                   | 4.992 ms                  | 6.616 ms                  |
| Backward                  | 9.635 ms                  | 11.655 ms                 |
| Optimize                  | 2.183 ms                  | 4.342 ms                  |
| BarrierTimeBeforeRank0    | 22.127 us                 | 2.334 ms                  |
| AfterBackward             | 6.581 ms                  | 11.229 ms                 |
| BlockToStepN              | 189.768 ms                | 236.374 ms                |
| OneStep                   | 219.755 ms                | 265.142 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 807.541 us                | 1.309 ms                  |
| ProcessBack:UpdateCache   | 594.997 us                | 825.750 us                |
| ProcessBack:UpsertPq      | 4.647 ms                  | 9.394 ms                  |
| ProcessOneStep            | 6.549 ms                  | 11.178 ms                 |
| BlockToStepN              | 189.795 ms                | 236.252 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:00.453013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=357, pq.top=357
W20240129 13:32:00.502554 18253 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 13:32:01.472018 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=362, pq.top=362
W20240129 13:32:01.686462 18253 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 13:32:02.472018 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=366, pq.top=366
W20240129 13:32:02.792469 18253 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 13:32:03.472013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=370, pq.top=370
W20240129 13:32:03.901608 18253 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 13:32:04.472005 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=375, pq.top=375
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.034 ms                  | 28.007 ms                 |
| Forward                   | 4.980 ms                  | 6.616 ms                  |
| Backward                  | 9.634 ms                  | 11.655 ms                 |
| Optimize                  | 2.185 ms                  | 4.342 ms                  |
| BarrierTimeBeforeRank0    | 22.127 us                 | 3.793 ms                  |
| AfterBackward             | 6.581 ms                  | 11.626 ms                 |
| BlockToStepN              | 190.401 ms                | 236.374 ms                |
| OneStep                   | 220.134 ms                | 265.142 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:04.901366 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 808.084 us                | 1.300 ms                  |
| ProcessBack:UpdateCache   | 591.749 us                | 824.451 us                |
| ProcessBack:UpsertPq      | 4.612 ms                  | 9.394 ms                  |
| ProcessOneStep            | 6.549 ms                  | 11.593 ms                 |
| BlockToStepN              | 190.161 ms                | 236.252 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:05.472008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=379, pq.top=379
W20240129 13:32:06.059329 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:06.472013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=383, pq.top=383
W20240129 13:32:07.237646 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:07.479696 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=388, pq.top=388
W20240129 13:32:08.375627 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:08.479007 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=392, pq.top=392
W20240129 13:32:09.479018 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=396, pq.top=396
W20240129 13:32:09.489058 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.025 ms                  | 28.007 ms                 |
| Forward                   | 4.975 ms                  | 6.616 ms                  |
| Backward                  | 9.631 ms                  | 11.655 ms                 |
| Optimize                  | 2.186 ms                  | 4.342 ms                  |
| BarrierTimeBeforeRank0    | 22.150 us                 | 5.321 ms                  |
| AfterBackward             | 6.587 ms                  | 11.626 ms                 |
| BlockToStepN              | 190.573 ms                | 236.374 ms                |
| OneStep                   | 220.665 ms                | 265.142 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 808.084 us                | 1.309 ms                  |
| ProcessBack:UpdateCache   | 589.141 us                | 824.451 us                |
| ProcessBack:UpsertPq      | 4.622 ms                  | 9.430 ms                  |
| ProcessOneStep            | 6.564 ms                  | 11.593 ms                 |
| BlockToStepN              | 190.505 ms                | 236.252 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 400 steps, total: 22.992, sample: 0.375, forward: 0.399, backward: 0.923, update: 0.206
[proc 0] 400 steps, total: 22.992, sample: 0.489, forward: 0.477, backward: 0.953, update: 0.228
W20240129 13:32:10.479012 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=401, pq.top=401
W20240129 13:32:10.628906 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:11.479020 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=405, pq.top=405
W20240129 13:32:11.763403 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:12.479014 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=410, pq.top=410
W20240129 13:32:12.900384 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:13.479008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=414, pq.top=414
W20240129 13:32:14.019977 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:14.511914 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=419, pq.top=419
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.031 ms                  | 28.007 ms                 |
| Forward                   | 4.954 ms                  | 6.616 ms                  |
| Backward                  | 9.628 ms                  | 11.724 ms                 |
| Optimize                  | 2.190 ms                  | 4.342 ms                  |
| BarrierTimeBeforeRank0    | 22.175 us                 | 20.832 ms                 |
| AfterBackward             | 6.598 ms                  | 12.230 ms                 |
| BlockToStepN              | 190.635 ms                | 236.374 ms                |
| OneStep                   | 221.468 ms                | 265.142 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:15.146059 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 808.708 us                | 1.472 ms                  |
| ProcessBack:UpdateCache   | 588.883 us                | 825.750 us                |
| ProcessBack:UpsertPq      | 4.610 ms                  | 9.973 ms                  |
| ProcessOneStep            | 6.565 ms                  | 12.202 ms                 |
| BlockToStepN              | 190.516 ms                | 236.252 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:15.511009 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=423, pq.top=423
W20240129 13:32:16.281199 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:16.525765 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=428, pq.top=428
W20240129 13:32:17.494643 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:17.525008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=432, pq.top=432
W20240129 13:32:18.525012 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=436, pq.top=436
W20240129 13:32:18.647099 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:19.525015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=440, pq.top=440
W20240129 13:32:19.784241 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.031 ms                  | 28.007 ms                 |
| Forward                   | 4.940 ms                  | 6.616 ms                  |
| Backward                  | 9.624 ms                  | 11.724 ms                 |
| Optimize                  | 2.186 ms                  | 4.342 ms                  |
| BarrierTimeBeforeRank0    | 22.161 us                 | 21.112 ms                 |
| AfterBackward             | 6.598 ms                  | 12.279 ms                 |
| BlockToStepN              | 190.838 ms                | 236.374 ms                |
| OneStep                   | 222.344 ms                | 265.142 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 808.359 us                | 1.315 ms                  |
| ProcessBack:UpdateCache   | 587.763 us                | 824.451 us                |
| ProcessBack:UpsertPq      | 4.621 ms                  | 9.973 ms                  |
| ProcessOneStep            | 6.568 ms                  | 12.257 ms                 |
| BlockToStepN              | 190.724 ms                | 236.252 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:20.525013 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=445, pq.top=445
W20240129 13:32:20.855945 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:21.525012 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=449, pq.top=449
W20240129 13:32:22.008085 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:22.525004 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=454, pq.top=454
W20240129 13:32:23.175186 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:23.525008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=458, pq.top=458
W20240129 13:32:24.296154 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:24.541492 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=463, pq.top=463
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.031 ms                  | 27.937 ms                 |
| Forward                   | 4.938 ms                  | 6.595 ms                  |
| Backward                  | 9.628 ms                  | 11.655 ms                 |
| Optimize                  | 2.192 ms                  | 4.342 ms                  |
| BarrierTimeBeforeRank0    | 22.112 us                 | 20.832 ms                 |
| AfterBackward             | 6.602 ms                  | 12.279 ms                 |
| BlockToStepN              | 191.079 ms                | 235.935 ms                |
| OneStep                   | 222.397 ms                | 263.850 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 809.052 us                | 1.445 ms                  |
| ProcessBack:UpdateCache   | 583.664 us                | 824.451 us                |
| ProcessBack:UpsertPq      | 4.612 ms                  | 10.059 ms                 |
| ProcessOneStep            | 6.568 ms                  | 12.257 ms                 |
| BlockToStepN              | 190.754 ms                | 235.870 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:25.437564 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:25.541007 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=467, pq.top=467
W20240129 13:32:26.541015 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=471, pq.top=471
W20240129 13:32:26.571822 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:27.557430 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=476, pq.top=476
W20240129 13:32:27.754937 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:28.557008 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=480, pq.top=480
W20240129 13:32:28.884157 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:29.557011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=485, pq.top=485
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.025 ms                  | 27.937 ms                 |
| Forward                   | 4.926 ms                  | 6.595 ms                  |
| Backward                  | 9.627 ms                  | 11.724 ms                 |
| Optimize                  | 2.193 ms                  | 4.342 ms                  |
| BarrierTimeBeforeRank0    | 22.127 us                 | 21.112 ms                 |
| AfterBackward             | 6.602 ms                  | 12.279 ms                 |
| BlockToStepN              | 191.810 ms                | 235.935 ms                |
| OneStep                   | 222.607 ms                | 264.569 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:29.947832 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 809.946 us                | 1.315 ms                  |
| ProcessBack:UpdateCache   | 580.807 us                | 824.451 us                |
| ProcessBack:UpsertPq      | 4.610 ms                  | 10.055 ms                 |
| ProcessOneStep            | 6.569 ms                  | 12.257 ms                 |
| BlockToStepN              | 191.185 ms                | 235.870 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 13:32:30.557011 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=489, pq.top=489
W20240129 13:32:31.080811 18253 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 13:32:31.558344 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=494, pq.top=494
W20240129 13:32:32.167315 18253 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 13:32:32.558007 17878 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=498, pq.top=498
[proc 1] 500 steps, total: 22.687, sample: 0.409, forward: 0.399, backward: 0.914, update: 0.204
[proc 0] 500 steps, total: 22.687, sample: 0.489, forward: 0.470, backward: 0.956, update: 0.247
Successfully xmh. training takes 107.74206733703613 seconds
before call kg_cache_controller.StopThreads()
W20240129 13:32:33.081336 17878 grad_async_v1.h:230] call StopThreads. PID = 17449
W20240129 13:32:33.081362 17878 grad_base.h:212] before processOneStepNegThread_.join();
W20240129 13:32:33.085520 17878 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 13:32:33.085557 17878 grad_async_v1.h:232] call GradProcessingBase::StopThreads.
W20240129 13:32:33.096802 17878 grad_async_v1.h:251] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f7cddf78dd0>
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 810.229 us                | 1.445 ms                  |
| ProcessBack:UpdateCache   | 579.892 us                | 825.750 us                |
| ProcessBack:UpsertPq      | 4.609 ms                  | 10.059 ms                 |
| ProcessOneStep            | 6.568 ms                  | 13.418 ms                 |
| BlockToStepN              | 191.093 ms                | 235.870 ms                |
+---------------------------+---------------------------+---------------------------+

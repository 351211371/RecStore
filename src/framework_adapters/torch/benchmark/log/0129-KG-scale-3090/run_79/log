WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240130 09:38:27.922860 33459 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_33', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [33459 sampler.py:454] Start PreSampling
WARNING [33459 sampler.py:532] Before construct renumbering_dict
WARNING [33459 sampler.py:555] PreSampling done
W20240130 09:57:28.711160 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240130 09:57:28.711357 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240130 09:57:28.711395 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240130 09:57:28.711433 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240130 09:57:28.711467 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240130 09:57:28.711504 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240130 09:57:28.711541 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240130 09:57:28.711591 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240130 09:57:28.711632 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240130 09:57:28.711658 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240130 09:57:28.711695 33459 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240130 09:57:28.711726 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240130 09:57:28.711755 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240130 09:57:28.711915 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240130 09:57:28.711962 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240130 09:57:28.711990 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240130 09:57:28.712038 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240130 09:57:28.712080 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240130 09:57:28.712107 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240130 09:57:28.712138 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240130 09:57:28.712167 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240130 09:57:28.712193 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240130 09:57:28.712226 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240130 09:57:28.712257 33459 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240130 09:57:28.712280 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240130 09:57:28.712302 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240130 09:57:28.712361 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240130 09:57:28.712392 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240130 09:57:28.712419 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240130 09:57:28.712443 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240130 09:57:28.712472 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240130 09:57:28.712512 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240130 09:57:28.712545 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240130 09:57:28.712575 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240130 09:57:28.712604 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240130 09:57:28.712631 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240130 09:57:28.712663 33459 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240130 09:57:28.712687 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240130 09:57:28.712713 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240130 09:57:28.712779 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240130 09:57:28.712808 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240130 09:57:28.712841 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240130 09:57:28.712885 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240130 09:57:28.712913 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240130 09:57:28.712941 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240130 09:57:28.712970 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240130 09:57:28.713002 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240130 09:57:28.713033 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240130 09:57:28.713066 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240130 09:57:28.713096 33459 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240130 09:57:28.713119 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240130 09:57:28.713145 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240130 09:57:28.713205 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240130 09:57:28.713243 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240130 09:57:28.713274 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240130 09:57:28.713301 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240130 09:57:28.713335 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240130 09:57:28.713361 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240130 09:57:28.713389 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240130 09:57:28.713424 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240130 09:57:28.713460 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240130 09:57:28.713497 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240130 09:57:28.713524 33459 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240130 09:57:28.713546 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240130 09:57:28.713569 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240130 09:57:28.713629 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240130 09:57:28.713666 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240130 09:57:28.713693 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240130 09:57:28.713732 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240130 09:57:28.713758 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240130 09:57:28.713793 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240130 09:57:28.713829 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240130 09:57:28.713860 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240130 09:57:28.713886 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240130 09:57:28.713924 33459 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240130 09:57:28.713950 33459 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240130 09:57:28.713973 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240130 09:57:28.714002 33459 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240130 09:57:29.116787 33459 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10001ca5a000 128.2 GB
W20240130 09:57:29.116936 33459 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10202b692000 328.3 MB
{0: Graph(num_nodes=16391033, num_edges=60554486,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22850318, num_edges=74912573,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16459669, num_edges=67428404,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17554345, num_edges=53272616,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=17824082, num_edges=71836124,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=18730250, num_edges=46391216,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16391033 N 60554486 E
MertisPartition: part 1 has 22850318 N 74912573 E
MertisPartition: part 2 has 16459669 N 67428404 E
MertisPartition: part 3 has 17554345 N 53272616 E
MertisPartition: part 4 has 17824082 N 71836124 E
MertisPartition: part 5 has 18730250 N 46391216 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,       14,  ..., 12367661, 70093925, 61280605]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 4302804,  4302842,   384786,  ..., 55242621,  9139600, 77187577]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1650.142 seconds
[Rank1] pid = 34335
[Rank2] pid = 34463
[Rank3] pid = 34531
[Rank4] pid = 34598
INFO [33459 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [34335 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [34463 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [34463 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [33459 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [34531 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [34598 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [34666 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [34531 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [34666 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [34598 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [34335 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
W20240130 10:06:06.652820 34670 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240130 10:06:06.653753 34667 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [4302707, 400]; dev=5; size=6.412 GB
W20240130 10:06:06.653774 34464 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240130 10:06:06.653822 34532 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240130 10:06:06.653858 34599 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [4302707, 400]; dev=4; size=6.412 GB
W20240130 10:06:06.656157 34336 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240130 10:06:06.726524 34336 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10203fee1000 7.629 MB
W20240130 10:06:06.726619 34464 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1020415ca000 7.629 MB
W20240130 10:06:06.726614 34532 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102040684000 7.629 MB
W20240130 10:06:06.726616 34667 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x102040e27000 7.629 MB
W20240130 10:06:06.726704 34336 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102041d6d000 7.629 MB
W20240130 10:06:06.726785 34336 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x102042510000 1.49 GB
W20240130 10:06:06.726814 34464 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020a1af3000 7.629 MB
W20240130 10:06:06.726830 34336 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1020a2296000 1.49 GB
W20240130 10:06:06.726847 34667 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x102101879000 7.629 MB
W20240130 10:06:06.726853 34532 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x10210201c000 7.629 MB
W20240130 10:06:06.726891 34464 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1021027bf000 1.49 GB
W20240130 10:06:06.726913 34336 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240130 10:06:06.726928 34667 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x102161da2000 1.49 GB
W20240130 10:06:06.726935 34464 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1021c1385000 1.49 GB
W20240130 10:06:06.726943 34532 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102220968000 1.49 GB
W20240130 10:06:06.726981 34667 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x10227ff4b000 1.49 GB
W20240130 10:06:06.726998 34532 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1022df52e000 1.49 GB
W20240130 10:06:06.727025 34464 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240130 10:06:06.727041 34667 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240130 10:06:06.727058 34532 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240130 10:06:06.750200 34599 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x10233eb13000 7.629 MB
W20240130 10:06:06.750326 34599 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x10233f2b6000 7.629 MB
W20240130 10:06:06.750382 34599 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x10233fa59000 1.49 GB
W20240130 10:06:06.750422 34599 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x10239f03c000 1.49 GB
W20240130 10:06:06.750496 34599 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240130 10:06:06.750649 34464 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240130 10:06:06.750660 34667 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240130 10:06:06.750675 34336 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240130 10:06:06.750681 34670 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1023fe627000 7.629 MB
W20240130 10:06:06.750835 34670 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1023fedca000 7.629 MB
W20240130 10:06:06.750901 34670 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1023ff56d000 1.49 GB
W20240130 10:06:06.750972 34670 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10245eb50000 1.49 GB
W20240130 10:06:06.751024 34670 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240130 10:06:06.752112 34532 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240130 10:06:06.760443 34599 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240130 10:06:06.760505 34670 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x10001ca5a000
5: KnownLocalCachedEmbedding init done
WARNING [34666 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x10001ca5a000
4: KnownLocalCachedEmbedding init done
WARNING [34598 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x10001ca5a000
1: KnownLocalCachedEmbedding init done
WARNING [34335 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank5] pid = 34666
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242)]
cudaHostRegister 0x10001ca5a000
0: KnownLocalCachedEmbedding init done
WARNING [33459 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x10001ca5a000
3: KnownLocalCachedEmbedding init done
cudaHostRegister 0x10001ca5a000
2: KnownLocalCachedEmbedding init done
WARNING [34531 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [34463 DistTensor.py:56] The tensor name already exists in the kvstore
I20240130 10:06:47.333297 34464 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240130 10:06:47.333477 34667 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240130 10:06:47.333565 34670 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240130 10:06:47.333655 34599 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240130 10:06:47.334368 34532 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240130 10:06:47.334417 34336 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
E20240130 10:06:48.895849 34667 recstore.cc:66] init folly done
E20240130 10:06:48.895931 34336 recstore.cc:66] init folly done
E20240130 10:06:48.895987 34532 recstore.cc:66] init folly done
E20240130 10:06:48.896251 34599 recstore.cc:66] init folly done
E20240130 10:06:48.896256 34464 recstore.cc:66] init folly done
E20240130 10:06:48.896263 34670 recstore.cc:66] init folly done
I20240130 10:06:56.525439 34667 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240130 10:06:57.360317 34532 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240130 10:06:58.279903 34670 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240130 10:06:59.119635 34464 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240130 10:06:59.608610 34599 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240130 10:07:00.561262 34336 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 30.912 ms                 | 30.912 ms                 |
| Forward                   | 533.720 ms                | 533.720 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 15.157 ms                 | 202.421 ms                |
| Forward                   | 4.888 ms                  | 533.720 ms                |
| Backward                  | 241.650 ms                | 2.349 s                   |
| Optimize                  | 56.886 ms                 | 109.722 ms                |
| BarrierTimeBeforeRank0    | 54.976 us                 | 250.135 us                |
| BlockToStepN              | 38.274 us                 | 538.672 us                |
| OneStep                   | 346.039 ms                | 3.012 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 10.748 ms                 | 202.421 ms                |
| Forward                   | 4.888 ms                  | 533.720 ms                |
| Backward                  | 239.268 ms                | 2.349 s                   |
| Optimize                  | 75.484 ms                 | 109.722 ms                |
| BarrierTimeBeforeRank0    | 43.029 us                 | 250.135 us                |
| BlockToStepN              | 38.821 us                 | 12.388 ms                 |
| OneStep                   | 349.004 ms                | 3.012 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.048 ms                  | 202.421 ms                |
| Forward                   | 4.872 ms                  | 533.720 ms                |
| Backward                  | 235.668 ms                | 2.349 s                   |
| Optimize                  | 82.320 ms                 | 123.940 ms                |
| BarrierTimeBeforeRank0    | 40.686 us                 | 250.135 us                |
| BlockToStepN              | 39.171 us                 | 14.892 ms                 |
| OneStep                   | 346.039 ms                | 3.012 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.604 ms                  | 185.947 ms                |
| Forward                   | 4.872 ms                  | 7.568 ms                  |
| Backward                  | 232.413 ms                | 297.059 ms                |
| Optimize                  | 87.123 ms                 | 122.843 ms                |
| BarrierTimeBeforeRank0    | 39.218 us                 | 88.668 us                 |
| BlockToStepN              | 43.142 us                 | 12.524 ms                 |
| OneStep                   | 329.427 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.967 ms                  | 185.947 ms                |
| Forward                   | 4.894 ms                  | 7.568 ms                  |
| Backward                  | 225.876 ms                | 297.059 ms                |
| Optimize                  | 90.100 ms                 | 122.843 ms                |
| BarrierTimeBeforeRank0    | 38.061 us                 | 88.668 us                 |
| BlockToStepN              | 43.376 us                 | 12.524 ms                 |
| OneStep                   | 324.166 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.967 ms                  | 185.947 ms                |
| Forward                   | 4.894 ms                  | 7.568 ms                  |
| Backward                  | 219.717 ms                | 297.059 ms                |
| Optimize                  | 88.749 ms                 | 122.843 ms                |
| BarrierTimeBeforeRank0    | 37.049 us                 | 88.668 us                 |
| BlockToStepN              | 40.022 us                 | 12.524 ms                 |
| OneStep                   | 323.847 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 36.432, sample: 1.771, forward: 1.033, backward: 15.031, update: 0.318
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 40.468, sample: 1.458, forward: 1.054, backward: 14.918, update: 0.311
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 39.633, sample: 1.277, forward: 1.046, backward: 15.041, update: 0.256
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 37.874, sample: 1.495, forward: 1.006, backward: 15.050, update: 0.293
train_sampler.Prefill()
-------Step 0-------
tensor([22245690,   544147,   451647,   544166,   544198,   544222,  4953546,
          544245,   544272,   312521]) tensor([  158719, 40331268, 41325412,  5208616, 76570643, 25671277, 39748990,
        18945351, 79364181,  3779510])
-------Step 1-------
tensor([22245690,   544147,   451647,   544166,   544198,   544222,  4953546,
          544245,   544272,   312521]) tensor([68762946, 76507535,  4567146,  1245373, 69335015, 54599740, 31386620,
        69873028, 57276123, 36155945])
-------Step 2-------
tensor([   15686,    15719,    15742,    23775, 31386290,    15766, 34895150,
           15800, 22245690, 83250580]) tensor([10093954, 45601259, 23531565, 54455780, 50844699, 39576428, 49828363,
        42561692,  6605734, 24548713])
-------Step 3-------
tensor([   15686,    15719,    15742,    23775, 31386290,    15766, 34895150,
           15800, 22245690, 83250580]) tensor([22404378, 26596627,  9062130, 66229177,  9433688, 11762915, 13523776,
        86044526, 84583204, 74287260])
-------Step 4-------
tensor([ 622051,   36797,   79123, 9199948,   79145,  316824,   79166, 4459020,
          79194,  622075]) tensor([47868344, 73133800, 13073608, 34092317, 48756270, 66292671, 76948854,
        29933527, 33087230, 71800574])
-------Step 5-------
tensor([ 622051,   36797,   79123, 9199948,   79145,  316824,   79166, 4459020,
          79194,  622075]) tensor([ 4246870,   147065,  7217873, 80101808, 80393227, 47916082, 56345978,
        43118261, 60628060, 19921844])
-------Step 6-------
tensor([  140881,   140913, 22245690,   140944,    28762,   140969,   459198,
          459244, 43638582,  4450582]) tensor([32115680, 46023594, 39637408, 84316497, 56528916,  1138693, 12824327,
         4745029, 42355714, 17601023])
-------Step 7-------
tensor([  140881,   140913, 22245690,   140944,    28762,   140969,   459198,
          459244, 43638582,  4450582]) tensor([23135674, 24742089, 39460370, 61085115, 72881942, 15466790,  2021419,
        59860744, 53756292, 20576628])
-------Step 8-------
tensor([  217264,   200885,   200912,  5382623,  4310239,    68176,    69711,
           69747,   200937, 34775588]) tensor([69323402, 22529660, 61181527, 65369935,  6673383, 15209837, 21426160,
        25502553, 80831924, 26377517])
-------Step 9-------
tensor([  217264,   200885,   200912,  5382623,  4310239,    68176,    69711,
           69747,   200937, 34775588]) tensor([  430905, 35349972, 70302121, 38952073, 78164042, 62255960, 60720181,
        26360711, 60710965, 10733344])
before start barrier
start train
[proc 0] 100 steps, total: 38.714, sample: 2.043, forward: 1.023, backward: 24.641, update: 8.562
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 37.385, sample: 1.198, forward: 1.066, backward: 14.857, update: 0.290
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.701 ms                  | 185.947 ms                |
| Forward                   | 4.920 ms                  | 7.568 ms                  |
| Backward                  | 219.844 ms                | 297.059 ms                |
| Optimize                  | 88.972 ms                 | 122.843 ms                |
| BarrierTimeBeforeRank0    | 37.004 us                 | 88.668 us                 |
| BlockToStepN              | 40.859 us                 | 12.524 ms                 |
| OneStep                   | 323.847 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.642 ms                  | 185.947 ms                |
| Forward                   | 4.928 ms                  | 14.140 ms                 |
| Backward                  | 220.896 ms                | 297.059 ms                |
| Optimize                  | 88.294 ms                 | 122.843 ms                |
| BarrierTimeBeforeRank0    | 35.650 us                 | 88.668 us                 |
| BlockToStepN              | 42.059 us                 | 14.892 ms                 |
| OneStep                   | 322.844 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.701 ms                  | 196.580 ms                |
| Forward                   | 4.936 ms                  | 14.140 ms                 |
| Backward                  | 222.830 ms                | 297.059 ms                |
| Optimize                  | 88.669 ms                 | 122.843 ms                |
| BarrierTimeBeforeRank0    | 35.650 us                 | 128.894 us                |
| BlockToStepN              | 40.899 us                 | 20.310 ms                 |
| OneStep                   | 324.284 ms                | 594.049 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.013 ms                  | 196.580 ms                |
| Forward                   | 4.957 ms                  | 14.140 ms                 |
| Backward                  | 221.568 ms                | 297.656 ms                |
| Optimize                  | 88.669 ms                 | 122.843 ms                |
| BarrierTimeBeforeRank0    | 35.253 us                 | 128.894 us                |
| BlockToStepN              | 40.022 us                 | 20.310 ms                 |
| OneStep                   | 324.040 ms                | 594.049 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.642 ms                  | 185.947 ms                |
| Forward                   | 4.967 ms                  | 7.568 ms                  |
| Backward                  | 221.085 ms                | 297.059 ms                |
| Optimize                  | 88.972 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.664 us                 | 100.718 us                |
| BlockToStepN              | 40.022 us                 | 14.892 ms                 |
| OneStep                   | 324.040 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.478 ms                  | 185.947 ms                |
| Forward                   | 4.984 ms                  | 7.568 ms                  |
| Backward                  | 221.085 ms                | 297.059 ms                |
| Optimize                  | 89.475 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.380 us                 | 100.718 us                |
| BlockToStepN              | 40.427 us                 | 14.892 ms                 |
| OneStep                   | 323.847 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.538 ms                  | 185.947 ms                |
| Forward                   | 4.987 ms                  | 10.196 ms                 |
| Backward                  | 220.768 ms                | 297.059 ms                |
| Optimize                  | 89.475 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.551 us                 | 100.718 us                |
| BlockToStepN              | 40.774 us                 | 14.892 ms                 |
| OneStep                   | 322.042 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 33.482, sample: 1.873, forward: 0.509, backward: 22.223, update: 8.718
[proc 4] 200 steps, total: 33.482, sample: 1.332, forward: 0.512, backward: 13.064, update: 0.284
[proc 2] 200 steps, total: 33.482, sample: 1.474, forward: 0.474, backward: 13.262, update: 0.284
[proc 5] 200 steps, total: 33.482, sample: 1.772, forward: 0.479, backward: 12.980, update: 0.292
[proc 1] 200 steps, total: 33.482, sample: 2.517, forward: 0.470, backward: 12.677, update: 0.317
[proc 3] 200 steps, total: 33.482, sample: 1.792, forward: 0.486, backward: 12.882, update: 0.264
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.478 ms                  | 185.947 ms                |
| Forward                   | 4.994 ms                  | 10.196 ms                 |
| Backward                  | 218.519 ms                | 297.059 ms                |
| Optimize                  | 90.228 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.431 us                 | 100.718 us                |
| BlockToStepN              | 40.002 us                 | 14.892 ms                 |
| OneStep                   | 320.864 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.380 ms                  | 185.947 ms                |
| Forward                   | 5.003 ms                  | 10.196 ms                 |
| Backward                  | 218.519 ms                | 297.059 ms                |
| Optimize                  | 90.401 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.431 us                 | 100.718 us                |
| BlockToStepN              | 40.022 us                 | 14.892 ms                 |
| OneStep                   | 321.031 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.241 ms                  | 185.947 ms                |
| Forward                   | 5.003 ms                  | 10.196 ms                 |
| Backward                  | 218.519 ms                | 297.059 ms                |
| Optimize                  | 90.529 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.380 us                 | 100.718 us                |
| BlockToStepN              | 40.427 us                 | 18.442 ms                 |
| OneStep                   | 321.775 ms                | 561.338 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.286 ms                  | 175.136 ms                |
| Forward                   | 5.010 ms                  | 7.568 ms                  |
| Backward                  | 217.980 ms                | 296.311 ms                |
| Optimize                  | 90.529 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 34.309 us                 | 88.668 us                 |
| BlockToStepN              | 40.712 us                 | 14.892 ms                 |
| OneStep                   | 319.912 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.321 ms                  | 175.136 ms                |
| Forward                   | 5.024 ms                  | 7.568 ms                  |
| Backward                  | 216.362 ms                | 296.311 ms                |
| Optimize                  | 90.535 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 34.120 us                 | 88.668 us                 |
| BlockToStepN              | 39.951 us                 | 18.442 ms                 |
| OneStep                   | 318.573 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.313 ms                  | 175.136 ms                |
| Forward                   | 5.025 ms                  | 7.568 ms                  |
| Backward                  | 216.119 ms                | 296.311 ms                |
| Optimize                  | 90.529 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.185 us                 | 88.668 us                 |
| BlockToStepN              | 40.158 us                 | 18.442 ms                 |
| OneStep                   | 318.443 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.152 ms                  | 175.136 ms                |
| Forward                   | 5.042 ms                  | 7.568 ms                  |
| Backward                  | 215.903 ms                | 296.311 ms                |
| Optimize                  | 90.401 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.269 us                 | 88.668 us                 |
| BlockToStepN              | 40.675 us                 | 20.310 ms                 |
| OneStep                   | 317.935 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 300 steps, total: 32.498, sample: 1.143, forward: 0.478, backward: 12.434, update: 0.282
[proc 1] 300 steps, total: 32.498, sample: 1.837, forward: 0.482, backward: 12.543, update: 0.322
[proc 2] 300 steps, total: 32.498, sample: 1.195, forward: 0.504, backward: 12.739, update: 0.287
[proc 3] 300 steps, total: 32.498, sample: 1.213, forward: 0.533, backward: 12.682, update: 0.282
[proc 5] 300 steps, total: 32.498, sample: 1.160, forward: 0.476, backward: 12.807, update: 0.288
[proc 0] 300 steps, total: 32.498, sample: 1.450, forward: 0.504, backward: 21.542, update: 8.799
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.150 ms                  | 175.136 ms                |
| Forward                   | 5.030 ms                  | 7.568 ms                  |
| Backward                  | 215.761 ms                | 296.311 ms                |
| Optimize                  | 90.529 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 34.120 us                 | 88.668 us                 |
| BlockToStepN              | 40.774 us                 | 20.310 ms                 |
| OneStep                   | 317.406 ms                | 536.380 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.150 ms                  | 175.136 ms                |
| Forward                   | 5.047 ms                  | 7.568 ms                  |
| Backward                  | 215.217 ms                | 296.311 ms                |
| Optimize                  | 90.475 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 33.899 us                 | 88.668 us                 |
| BlockToStepN              | 40.374 us                 | 20.310 ms                 |
| OneStep                   | 316.537 ms                | 536.380 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.060 ms                  | 175.136 ms                |
| Forward                   | 5.059 ms                  | 7.568 ms                  |
| Backward                  | 214.975 ms                | 296.311 ms                |
| Optimize                  | 90.228 ms                 | 117.633 ms                |
| BarrierTimeBeforeRank0    | 33.864 us                 | 88.668 us                 |
| BlockToStepN              | 39.951 us                 | 20.310 ms                 |
| OneStep                   | 316.120 ms                | 536.380 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.954 ms                  | 165.324 ms                |
| Forward                   | 5.061 ms                  | 7.315 ms                  |
| Backward                  | 214.725 ms                | 294.306 ms                |
| Optimize                  | 89.999 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 33.797 us                 | 84.833 us                 |
| BlockToStepN              | 40.002 us                 | 18.442 ms                 |
| OneStep                   | 316.092 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.906 ms                  | 165.324 ms                |
| Forward                   | 5.059 ms                  | 7.315 ms                  |
| Backward                  | 214.601 ms                | 294.306 ms                |
| Optimize                  | 89.048 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 33.758 us                 | 84.833 us                 |
| BlockToStepN              | 40.022 us                 | 18.442 ms                 |
| OneStep                   | 315.577 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.912 ms                  | 165.324 ms                |
| Forward                   | 5.060 ms                  | 7.315 ms                  |
| Backward                  | 214.097 ms                | 294.306 ms                |
| Optimize                  | 88.669 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 33.721 us                 | 84.833 us                 |
| BlockToStepN              | 39.171 us                 | 18.442 ms                 |
| OneStep                   | 314.323 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 31.009, sample: 1.160, forward: 0.509, backward: 12.354, update: 0.293
[proc 2] 400 steps, total: 31.009, sample: 1.185, forward: 0.495, backward: 12.466, update: 0.327
[proc 1] 400 steps, total: 31.009, sample: 1.696, forward: 0.478, backward: 12.164, update: 0.285
[proc 5] 400 steps, total: 31.009, sample: 1.146, forward: 0.478, backward: 12.466, update: 0.309
[proc 4] 400 steps, total: 31.009, sample: 1.148, forward: 0.467, backward: 12.229, update: 0.296
[proc 0] 400 steps, total: 31.009, sample: 1.414, forward: 0.506, backward: 20.881, update: 8.073
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.837 ms                  | 165.324 ms                |
| Forward                   | 5.069 ms                  | 7.315 ms                  |
| Backward                  | 213.512 ms                | 294.306 ms                |
| Optimize                  | 88.189 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 33.667 us                 | 84.833 us                 |
| BlockToStepN              | 39.151 us                 | 19.603 ms                 |
| OneStep                   | 313.368 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.714 ms                  | 165.324 ms                |
| Forward                   | 5.078 ms                  | 7.315 ms                  |
| Backward                  | 213.051 ms                | 294.306 ms                |
| Optimize                  | 88.189 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 33.641 us                 | 84.833 us                 |
| BlockToStepN              | 39.171 us                 | 20.310 ms                 |
| OneStep                   | 312.853 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.629 ms                  | 165.324 ms                |
| Forward                   | 5.076 ms                  | 7.315 ms                  |
| Backward                  | 212.402 ms                | 294.306 ms                |
| Optimize                  | 88.329 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 33.399 us                 | 84.833 us                 |
| BlockToStepN              | 39.904 us                 | 20.310 ms                 |
| OneStep                   | 312.017 ms                | 526.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.636 ms                  | 165.193 ms                |
| Forward                   | 5.081 ms                  | 7.226 ms                  |
| Backward                  | 211.811 ms                | 289.882 ms                |
| Optimize                  | 88.749 ms                 | 114.401 ms                |
| BarrierTimeBeforeRank0    | 33.321 us                 | 83.970 us                 |
| BlockToStepN              | 38.821 us                 | 19.603 ms                 |
| OneStep                   | 311.149 ms                | 509.742 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.448 ms                  | 165.193 ms                |
| Forward                   | 5.103 ms                  | 7.226 ms                  |
| Backward                  | 211.135 ms                | 289.882 ms                |
| Optimize                  | 88.856 ms                 | 114.401 ms                |
| BarrierTimeBeforeRank0    | 33.325 us                 | 83.970 us                 |
| BlockToStepN              | 38.695 us                 | 19.603 ms                 |
| OneStep                   | 309.619 ms                | 509.742 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.370 ms                  | 165.193 ms                |
| Forward                   | 5.110 ms                  | 7.226 ms                  |
| Backward                  | 210.680 ms                | 289.882 ms                |
| Optimize                  | 88.898 ms                 | 115.644 ms                |
| BarrierTimeBeforeRank0    | 33.283 us                 | 83.970 us                 |
| BlockToStepN              | 38.821 us                 | 19.603 ms                 |
| OneStep                   | 309.187 ms                | 509.742 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 28.867, sample: 1.351, forward: 0.505, backward: 11.566, update: 0.336
[proc 3] 500 steps, total: 28.867, sample: 1.021, forward: 0.529, backward: 11.817, update: 0.369
[proc 0] 500 steps, total: 28.867, sample: 1.148, forward: 0.530, backward: 18.221, update: 8.832
[proc 5] 500 steps, total: 28.867, sample: 1.071, forward: 0.471, backward: 11.790, update: 0.410
[proc 2] 500 steps, total: 28.867, sample: 1.139, forward: 0.511, backward: 11.762, update: 0.379
[proc 4] 500 steps, total: 28.867, sample: 1.068, forward: 0.465, backward: 11.736, update: 0.384
Successfully xmh. training takes 164.5703296661377 seconds
before call kg_cache_controller.StopThreads()
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads
INFO [33459 controller_process.py:421] call rank0 to StopThreads

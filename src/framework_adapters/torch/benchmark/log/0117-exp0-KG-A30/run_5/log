WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240118 18:49:58.530193 883135 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='DistMult', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/DistMult_FB15k_12', no_save_emb=True, max_step=500, batch_size=4800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [883135 sampler.py:454] Start PreSampling
WARNING [883135 sampler.py:532] Before construct renumbering_dict
WARNING [883135 sampler.py:555] PreSampling done
W20240118 18:50:00.195161 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240118 18:50:00.195256 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240118 18:50:00.195274 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240118 18:50:00.195291 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240118 18:50:00.195307 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240118 18:50:00.195322 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240118 18:50:00.195338 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240118 18:50:00.195354 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240118 18:50:00.195369 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240118 18:50:00.195384 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240118 18:50:00.195405 883135 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240118 18:50:00.195425 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240118 18:50:00.195439 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240118 18:50:00.195516 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240118 18:50:00.195534 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240118 18:50:00.195549 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240118 18:50:00.195564 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240118 18:50:00.195577 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240118 18:50:00.195605 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240118 18:50:00.195619 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240118 18:50:00.195634 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240118 18:50:00.195648 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240118 18:50:00.195662 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240118 18:50:00.195675 883135 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240118 18:50:00.195688 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240118 18:50:00.195698 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240118 18:50:00.195727 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240118 18:50:00.195744 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240118 18:50:00.195757 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240118 18:50:00.195771 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240118 18:50:00.195796 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240118 18:50:00.195811 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240118 18:50:00.195824 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240118 18:50:00.195838 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240118 18:50:00.195852 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240118 18:50:00.195869 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240118 18:50:00.195883 883135 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240118 18:50:00.195894 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240118 18:50:00.195905 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240118 18:50:00.195933 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240118 18:50:00.195950 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240118 18:50:00.195963 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240118 18:50:00.195976 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240118 18:50:00.195989 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240118 18:50:00.196004 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240118 18:50:00.196020 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240118 18:50:00.196034 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240118 18:50:00.196048 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240118 18:50:00.196070 883135 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240118 18:50:00.196084 883135 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240118 18:50:00.196096 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240118 18:50:00.196107 883135 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240118 18:50:00.308331 883135 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100001ee2000
W20240118 18:50:00.308444 883135 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000035b4000
{0: Graph(num_nodes=9480, num_edges=154759,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11158, num_edges=169559,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=11355, num_edges=241153,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10394, num_edges=202691,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9480 N 154759 E
MertisPartition: part 1 has 11158 N 169559 E
MertisPartition: part 2 has 11355 N 241153 E
MertisPartition: part 3 has 10394 N 202691 E
Rank0: cached key size 373
Rank1: cached key size 373
Rank2: cached key size 373
Rank3: cached key size 373
Before renumbering graph:  {'_ID': tensor([    6,    10,    11,  ...,  2559,  7188, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 3])}
After renumbering graph:  {'_ID': tensor([1684, 1813, 1845,  ..., 7841, 6502, 7799]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 3])}
part_g: DGLGraph(num_nodes=9480, num_edges=154759,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9480, num_edges=154759,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1.809 seconds
[Rank1] pid = 883368
[Rank2] pid = 883432
INFO [883135 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [883368 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [883433 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [883432 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [883432 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [883433 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [883135 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [883368 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240118 18:50:02.459055 883435 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_2 [1495, 400]; dev=2; size=2.281 MB
W20240118 18:50:02.459056 883486 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_3 [1495, 400]; dev=3; size=2.281 MB
W20240118 18:50:02.459267 883448 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_0 [1495, 400]; dev=0; size=2.281 MB
W20240118 18:50:02.459378 883369 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_1 [1495, 400]; dev=1; size=2.281 MB
W20240118 18:50:02.459621 883435 IPCTensor.h:367] NewIPCTensor: input_keys_2 [100000]0x1000035c8000
W20240118 18:50:02.459656 883486 IPCTensor.h:367] NewIPCTensor: input_keys_3 [100000]0x10000368d000
W20240118 18:50:02.459729 883435 IPCTensor.h:367] NewIPCTensor: input_keys_neg_2 [100000]0x100003754000
W20240118 18:50:02.459750 883486 IPCTensor.h:367] NewIPCTensor: input_keys_neg_3 [100000]0x100003819000
W20240118 18:50:02.459771 883435 IPCTensor.h:367] NewIPCTensor: backward_grads_2 [100000, 400]0x1000038de000
W20240118 18:50:02.459915 883369 IPCTensor.h:367] NewIPCTensor: input_keys_1 [100000]0x10000d176000
W20240118 18:50:02.460017 883369 IPCTensor.h:367] NewIPCTensor: input_keys_neg_1 [100000]0x10000d23d000
W20240118 18:50:02.460021 883448 IPCTensor.h:367] NewIPCTensor: input_keys_0 [100000]0x10000d302000
W20240118 18:50:02.460053 883369 IPCTensor.h:367] NewIPCTensor: backward_grads_1 [100000, 400]0x10000d3c7000
W20240118 18:50:02.460078 883369 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x100016c5f000
W20240118 18:50:02.460090 883448 IPCTensor.h:367] NewIPCTensor: input_keys_neg_0 [100000]0x1000204f7000
W20240118 18:50:02.460108 883369 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240118 18:50:02.460122 883448 IPCTensor.h:367] NewIPCTensor: backward_grads_0 [100000, 400]0x1000205bc000
W20240118 18:50:02.460152 883448 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x100029e54000
W20240118 18:50:02.460181 883448 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240118 18:50:02.460696 883369 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240118 18:50:02.460718 883448 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240118 18:50:02.461759 883486 IPCTensor.h:367] NewIPCTensor: backward_grads_3 [100000, 400]0x1000336f4000
W20240118 18:50:02.461824 883435 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x10003cf8c000
W20240118 18:50:02.461856 883486 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x100046824000
W20240118 18:50:02.461870 883435 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240118 18:50:02.461889 883486 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240118 18:50:02.463433 883435 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240118 18:50:02.463729 883486 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
cudaHostRegister 0x100001ee2000
1: KnownLocalCachedEmbedding init done
WARNING [883368 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
3: KnownLocalCachedEmbedding init done
WARNING [883433 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
2: KnownLocalCachedEmbedding init done
WARNING [883432 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 883433
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 1495), (1495, 2990), (2990, 4485), (4485, 5980)]
cudaHostRegister 0x100001ee2000
0: KnownLocalCachedEmbedding init done
WARNING [883135 DistTensor.py:56] The tensor name already exists in the kvstore
I20240118 18:50:02.586658 883448 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240118 18:50:02.586697 883435 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240118 18:50:02.586723 883486 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240118 18:50:02.586841 883369 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240118 18:50:02.587538 883448 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.1
        }
W20240118 18:50:02.587628 883448 grad_base.h:172] Init GradProcessingBase done
I20240118 18:50:02.591612 883448 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240118 18:50:02.591711 883448 kg_controller.h:78] after init GradAsyncProcessingV2
I20240118 18:50:02.591717 883448 kg_controller.h:84] Construct KGCacheController done
I20240118 18:50:02.943691 883448 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240118 18:50:03.660426 884033 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240118 18:50:03.660897 884033 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240118 18:50:03.667279 884032 HazptrDomain.h:770] 10 request backlog for hazptr asynchronous reclamation executor
I20240118 18:50:03.698539 883448 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240118 18:50:03.738602 883369 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240118 18:50:03.741271 883486 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240118 18:50:03.744949 883435 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240118 18:50:05.838829 883698 parallel_pq_v2.h:76] insert failed, size(hashtable)=8
W20240118 18:50:05.887409 884033 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240118 18:50:05.963574 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=2, pq.top=2
E20240118 18:50:06.838009 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=6287
W20240118 18:50:06.963027 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=14, pq.top=14
W20240118 18:50:07.053059 884033 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.604 ms                  | 35.796 ms                 |
| Forward                   | 7.228 ms                  | 665.744 ms                |
| Backward                  | 7.626 ms                  | 209.856 ms                |
| Optimize                  | 2.854 ms                  | 61.836 ms                 |
| BarrierTimeBeforeRank0    | 25.092 us                 | 702.432 ms                |
| AfterBackward             | 37.335 ms                 | 498.211 ms                |
| BlockToStepN              | 646.817 us                | 114.444 ms                |
| OneStep                   | 61.738 ms                 | 2.141 s                   |
+---------------------------+---------------------------+---------------------------+
E20240118 18:50:07.838021 884033 parallel_pq_v2.h:76] insert failed, size(hashtable)=1119
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.953 ms                  | 164.236 ms                |
| ProcessBack:UpdateCache   | 2.759 ms                  | 239.684 ms                |
| ProcessBack:UpsertPq      | 30.537 ms                 | 45.508 ms                 |
| ProcessOneStep            | 37.306 ms                 | 497.505 ms                |
| BlockToStepN              | 599.367 us                | 114.367 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:08.147394 884033 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240118 18:50:08.213004 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=23, pq.top=23
E20240118 18:50:08.838014 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=4448
W20240118 18:50:09.149673 884033 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end5
W20240118 18:50:09.212033 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=35, pq.top=35
E20240118 18:50:09.838011 883448 parallel_pq_v2.h:76] insert failed, size(hashtable)=13
W20240118 18:50:10.212042 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=46, pq.top=46
W20240118 18:50:10.253253 884033 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end7
E20240118 18:50:10.838053 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=7844
W20240118 18:50:11.212026 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=53, pq.top=53
W20240118 18:50:11.285785 884033 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end4
E20240118 18:50:11.838027 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=6884
W20240118 18:50:12.212074 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=64, pq.top=64
W20240118 18:50:12.289610 884033 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.715 ms                  | 37.847 ms                 |
| Forward                   | 7.058 ms                  | 12.257 ms                 |
| Backward                  | 7.577 ms                  | 8.539 ms                  |
| Optimize                  | 2.863 ms                  | 23.552 ms                 |
| BarrierTimeBeforeRank0    | 24.086 us                 | 13.183 ms                 |
| AfterBackward             | 32.934 ms                 | 498.211 ms                |
| BlockToStepN              | 12.500 ms                 | 212.591 ms                |
| OneStep                   | 75.259 ms                 | 637.347 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:50:12.838022 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2516
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.876 ms                  | 162.489 ms                |
| ProcessBack:UpdateCache   | 2.025 ms                  | 237.610 ms                |
| ProcessBack:UpsertPq      | 25.710 ms                 | 43.136 ms                 |
| ProcessOneStep            | 33.016 ms                 | 497.505 ms                |
| BlockToStepN              | 12.676 ms                 | 212.437 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:13.242410 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=74, pq.top=74
W20240118 18:50:13.318735 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:50:13.838325 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=6605
W20240118 18:50:14.291007 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=84, pq.top=84
W20240118 18:50:14.337740 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:50:14.838019 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2244
W20240118 18:50:15.290055 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=93, pq.top=93
W20240118 18:50:15.341580 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240118 18:50:15.838011 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2663
[proc 1] 100 steps, total: 12.325, sample: 0.462, forward: 1.221, backward: 0.687, update: 0.348
[proc 3] 100 steps, total: 12.322, sample: 0.494, forward: 1.258, backward: 0.635, update: 0.366
[proc 2] 100 steps, total: 12.318, sample: 0.498, forward: 1.862, backward: 0.703, update: 0.361
-------Step 0-------
tensor([ 9519, 12757, 14102, 11813,  5766,  6174,   191,  2006,  3472, 11620]) tensor([ 1845,   261,  7466, 12959, 12596,   129, 10256,  4120, 12260,  9335])
-------Step 1-------
tensor([ 9519, 12757, 14102, 11813,  5766,  6174,   191,  2006,  3472, 11620]) tensor([ 8573, 13125,  3743, 13609,  2669,  3495,  8732,  2241, 14855,  9112])
-------Step 2-------
tensor([    2, 12897,  7213,   377,   875,  8926,  3139,   126, 10765,   200]) tensor([ 9400, 11423,  7712,  7558,  3154,  6717,  7242,  5025, 10722, 11654])
-------Step 3-------
tensor([    2, 12897,  7213,   377,   875,  8926,  3139,   126, 10765,   200]) tensor([11395,  6003, 14923, 13569, 11826, 11317, 13343,  3930, 10493,  5214])
-------Step 4-------
tensor([13885,  5717,  6890,  5765,  1779,  5501,  1067, 12384, 12458,    27]) tensor([ 6094,  3871,  9154, 11246,  8775,  5951,   111, 14936,  6872,  5725])
-------Step 5-------
tensor([13885,  5717,  6890,  5765,  1779,  5501,  1067, 12384, 12458,    27]) tensor([ 5215, 11380,  4684,  8515, 12017,  5699, 11870,  4824,  9379,   261])
-------Step 6-------
tensor([ 2359,    25,  3456,   166, 12761,   164, 10524,  4409, 10743,  3856]) tensor([  512, 12806,  6682,   190,  1795,  2417, 13116, 14936,  9670,  6041])
-------Step 7-------
tensor([ 2359,    25,  3456,   166, 12761,   164, 10524,  4409, 10743,  3856]) tensor([ 7076,  6073, 13051,  5239,  6280,  2164,  1878, 12361,  6601,  7743])
-------Step 8-------
tensor([   81,  2117,  1489,  7175,  3565,  6824,  2427,    98, 12392, 13477]) tensor([ 5739,  2238,   117, 12170,  3753,  9611,  3721,  5088,    55,  8786])
-------Step 9-------
tensor([   81,  2117,  1489,  7175,  3565,  6824,  2427,    98, 12392, 13477]) tensor([  293,  1316,  6539,  7896,   115,  1378,  9503, 11776,  9535,  1141])
[proc 0] 100 steps, total: 12.365, sample: 0.611, forward: 1.313, backward: 0.952, update: 0.409
W20240118 18:50:16.373819 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=103, pq.top=103
W20240118 18:50:16.379698 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240118 18:50:16.838019 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=5584
W20240118 18:50:17.373064 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=112, pq.top=112
W20240118 18:50:17.379130 884033 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.824 ms                  | 39.453 ms                 |
| Forward                   | 7.164 ms                  | 19.952 ms                 |
| Backward                  | 7.520 ms                  | 9.188 ms                  |
| Optimize                  | 2.968 ms                  | 23.552 ms                 |
| BarrierTimeBeforeRank0    | 24.097 us                 | 31.208 ms                 |
| AfterBackward             | 35.052 ms                 | 498.211 ms                |
| BlockToStepN              | 27.648 ms                 | 212.591 ms                |
| OneStep                   | 100.575 ms                | 637.347 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:50:17.838014 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=4937
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.829 ms                  | 7.211 ms                  |
| ProcessBack:UpdateCache   | 1.890 ms                  | 3.513 ms                  |
| ProcessBack:UpsertPq      | 26.601 ms                 | 41.828 ms                 |
| ProcessOneStep            | 35.019 ms                 | 497.505 ms                |
| BlockToStepN              | 27.835 ms                 | 212.437 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:18.373129 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=121, pq.top=121
W20240118 18:50:18.412479 884033 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:50:18.838196 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2809
W20240118 18:50:19.373214 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=130, pq.top=130
W20240118 18:50:19.413424 884033 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240118 18:50:19.838052 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2896
W20240118 18:50:20.373041 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=139, pq.top=139
W20240118 18:50:20.420720 884033 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:50:20.838052 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2804
W20240118 18:50:21.373136 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=152, pq.top=152
W20240118 18:50:21.534550 884033 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end2
E20240118 18:50:21.838037 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=5579
W20240118 18:50:22.373176 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=157, pq.top=157
W20240118 18:50:22.565757 884033 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.911 ms                  | 40.286 ms                 |
| Forward                   | 7.170 ms                  | 16.375 ms                 |
| Backward                  | 7.509 ms                  | 8.539 ms                  |
| Optimize                  | 3.074 ms                  | 9.242 ms                  |
| BarrierTimeBeforeRank0    | 24.097 us                 | 31.208 ms                 |
| AfterBackward             | 33.562 ms                 | 47.782 ms                 |
| BlockToStepN              | 29.679 ms                 | 212.591 ms                |
| OneStep                   | 103.888 ms                | 369.222 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:50:22.838038 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2352
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.819 ms                  | 7.121 ms                  |
| ProcessBack:UpdateCache   | 1.680 ms                  | 3.456 ms                  |
| ProcessBack:UpsertPq      | 25.754 ms                 | 41.718 ms                 |
| ProcessOneStep            | 33.706 ms                 | 47.754 ms                 |
| BlockToStepN              | 31.228 ms                 | 212.437 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:23.379878 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=164, pq.top=164
W20240118 18:50:23.587934 884033 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240118 18:50:23.838021 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=4192
W20240118 18:50:24.425016 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=172, pq.top=172
W20240118 18:50:24.599305 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240118 18:50:24.838011 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=4845
W20240118 18:50:25.425182 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=180, pq.top=180
W20240118 18:50:25.614670 884033 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:50:25.838016 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=4822
W20240118 18:50:26.425174 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=188, pq.top=188
W20240118 18:50:26.657907 884033 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:50:26.838282 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1849
W20240118 18:50:27.425311 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=198, pq.top=198
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.912 ms                  | 43.871 ms                 |
| Forward                   | 7.305 ms                  | 16.375 ms                 |
| Backward                  | 7.497 ms                  | 8.539 ms                  |
| Optimize                  | 3.169 ms                  | 9.242 ms                  |
| BarrierTimeBeforeRank0    | 24.399 us                 | 31.834 ms                 |
| AfterBackward             | 34.542 ms                 | 49.259 ms                 |
| BlockToStepN              | 37.078 ms                 | 212.591 ms                |
| OneStep                   | 106.931 ms                | 369.222 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:27.706305 884033 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end0
E20240118 18:50:27.838070 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=3873
[proc 1] 200 steps, total: 11.807, sample: 0.494, forward: 0.570, backward: 0.466, update: 0.314
[proc 3] 200 steps, total: 11.807, sample: 0.510, forward: 0.583, backward: 0.478, update: 0.329
[proc 2] 200 steps, total: 11.806, sample: 0.522, forward: 0.569, backward: 0.480, update: 0.336
[proc 0] 200 steps, total: 11.806, sample: 0.716, forward: 0.696, backward: 0.744, update: 0.436
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.824 ms                  | 4.297 ms                  |
| ProcessBack:UpdateCache   | 1.755 ms                  | 3.178 ms                  |
| ProcessBack:UpsertPq      | 26.986 ms                 | 41.718 ms                 |
| ProcessOneStep            | 34.479 ms                 | 49.213 ms                 |
| BlockToStepN              | 37.002 ms                 | 235.706 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:28.425201 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=204, pq.top=204
W20240118 18:50:28.735076 884033 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:50:28.838057 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1441
W20240118 18:50:29.474164 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=212, pq.top=212
W20240118 18:50:29.746853 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240118 18:50:29.839488 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=6879
W20240118 18:50:30.513571 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=220, pq.top=220
W20240118 18:50:30.753917 884033 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
E20240118 18:50:30.839015 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=4995
W20240118 18:50:31.513041 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=228, pq.top=228
W20240118 18:50:31.768064 884033 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:50:31.839033 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=3084
W20240118 18:50:32.513192 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=235, pq.top=235
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.007 ms                  | 43.871 ms                 |
| Forward                   | 7.329 ms                  | 16.375 ms                 |
| Backward                  | 7.480 ms                  | 8.539 ms                  |
| Optimize                  | 3.089 ms                  | 9.242 ms                  |
| BarrierTimeBeforeRank0    | 23.643 us                 | 31.834 ms                 |
| AfterBackward             | 34.914 ms                 | 49.259 ms                 |
| BlockToStepN              | 43.581 ms                 | 235.797 ms                |
| OneStep                   | 108.766 ms                | 369.222 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:32.798884 884033 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240118 18:50:32.839007 883448 parallel_pq_v2.h:76] insert failed, size(hashtable)=1846
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.850 ms                  | 4.204 ms                  |
| ProcessBack:UpdateCache   | 1.818 ms                  | 3.192 ms                  |
| ProcessBack:UpsertPq      | 27.721 ms                 | 40.693 ms                 |
| ProcessOneStep            | 34.884 ms                 | 49.213 ms                 |
| BlockToStepN              | 44.086 ms                 | 235.706 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:33.513404 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=243, pq.top=243
W20240118 18:50:33.799386 884033 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240118 18:50:33.839006 883448 parallel_pq_v2.h:76] insert failed, size(hashtable)=2231
W20240118 18:50:34.559830 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=252, pq.top=252
W20240118 18:50:34.827212 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end6
E20240118 18:50:34.839030 883698 parallel_pq_v2.h:76] insert failed, size(hashtable)=4049
W20240118 18:50:35.559072 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=264, pq.top=264
E20240118 18:50:35.839015 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=7568
W20240118 18:50:35.843196 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end5
W20240118 18:50:36.606045 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=270, pq.top=270
E20240118 18:50:36.839046 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1446
W20240118 18:50:36.847409 884033 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.943 ms                  | 44.420 ms                 |
| Forward                   | 7.325 ms                  | 13.433 ms                 |
| Backward                  | 7.477 ms                  | 8.504 ms                  |
| Optimize                  | 3.093 ms                  | 9.015 ms                  |
| BarrierTimeBeforeRank0    | 24.097 us                 | 31.834 ms                 |
| AfterBackward             | 34.713 ms                 | 47.782 ms                 |
| BlockToStepN              | 43.196 ms                 | 236.478 ms                |
| OneStep                   | 109.441 ms                | 369.222 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:37.606101 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=276, pq.top=276
E20240118 18:50:37.839035 883698 parallel_pq_v2.h:76] insert failed, size(hashtable)=1959
W20240118 18:50:37.865468 884033 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.845 ms                  | 4.187 ms                  |
| ProcessBack:UpdateCache   | 1.830 ms                  | 3.178 ms                  |
| ProcessBack:UpsertPq      | 27.500 ms                 | 40.505 ms                 |
| ProcessOneStep            | 34.604 ms                 | 47.754 ms                 |
| BlockToStepN              | 41.887 ms                 | 236.377 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:38.606426 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=283, pq.top=283
E20240118 18:50:38.839010 883698 parallel_pq_v2.h:76] insert failed, size(hashtable)=3430
W20240118 18:50:38.890945 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end6
W20240118 18:50:39.648074 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=295, pq.top=295
E20240118 18:50:39.839102 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1759
W20240118 18:50:39.967290 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end6
[proc 3] 300 steps, total: 12.538, sample: 0.538, forward: 0.554, backward: 0.476, update: 0.313
[proc 2] 300 steps, total: 12.538, sample: 0.483, forward: 0.537, backward: 0.448, update: 0.320
[proc 0] 300 steps, total: 12.538, sample: 0.670, forward: 0.675, backward: 0.740, update: 0.471
[proc 1] 300 steps, total: 12.538, sample: 0.432, forward: 0.534, backward: 0.459, update: 0.277
W20240118 18:50:40.696059 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=304, pq.top=304
E20240118 18:50:40.839010 883698 parallel_pq_v2.h:76] insert failed, size(hashtable)=3764
W20240118 18:50:41.018069 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end8
W20240118 18:50:41.696105 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=312, pq.top=312
E20240118 18:50:41.839033 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=5813
W20240118 18:50:42.053113 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.912 ms                  | 44.660 ms                 |
| Forward                   | 7.340 ms                  | 13.433 ms                 |
| Backward                  | 7.464 ms                  | 8.504 ms                  |
| Optimize                  | 3.089 ms                  | 9.015 ms                  |
| BarrierTimeBeforeRank0    | 23.169 us                 | 31.834 ms                 |
| AfterBackward             | 34.213 ms                 | 47.782 ms                 |
| BlockToStepN              | 38.952 ms                 | 285.206 ms                |
| OneStep                   | 108.290 ms                | 389.685 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:42.731877 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=317, pq.top=317
E20240118 18:50:42.839139 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2878
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.842 ms                  | 4.204 ms                  |
| ProcessBack:UpdateCache   | 1.840 ms                  | 3.178 ms                  |
| ProcessBack:UpsertPq      | 27.236 ms                 | 40.505 ms                 |
| ProcessOneStep            | 34.188 ms                 | 47.754 ms                 |
| BlockToStepN              | 39.541 ms                 | 285.080 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:43.064396 884033 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240118 18:50:43.731060 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=322, pq.top=322
E20240118 18:50:43.839035 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=865
W20240118 18:50:44.113726 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:50:44.731333 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=328, pq.top=328
E20240118 18:50:44.839016 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1549
W20240118 18:50:45.113559 884033 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:50:45.731338 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=335, pq.top=335
E20240118 18:50:45.839854 883448 parallel_pq_v2.h:76] insert failed, size(hashtable)=1483
W20240118 18:50:46.117580 884033 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:50:46.775810 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=342, pq.top=342
E20240118 18:50:46.839041 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=6022
W20240118 18:50:47.122898 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.981 ms                  | 44.736 ms                 |
| Forward                   | 7.321 ms                  | 13.433 ms                 |
| Backward                  | 7.466 ms                  | 8.504 ms                  |
| Optimize                  | 3.112 ms                  | 9.015 ms                  |
| BarrierTimeBeforeRank0    | 23.643 us                 | 31.834 ms                 |
| AfterBackward             | 34.630 ms                 | 48.008 ms                 |
| BlockToStepN              | 44.260 ms                 | 285.206 ms                |
| OneStep                   | 111.936 ms                | 389.685 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:47.800240 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=350, pq.top=350
E20240118 18:50:47.839010 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2612
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.850 ms                  | 4.187 ms                  |
| ProcessBack:UpdateCache   | 1.890 ms                  | 3.169 ms                  |
| ProcessBack:UpsertPq      | 27.736 ms                 | 40.505 ms                 |
| ProcessOneStep            | 34.707 ms                 | 47.754 ms                 |
| BlockToStepN              | 44.243 ms                 | 285.080 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:48.125489 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:50:48.810106 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=358, pq.top=358
E20240118 18:50:48.839031 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1928
W20240118 18:50:49.130107 884033 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:50:49.832495 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=370, pq.top=370
E20240118 18:50:49.839012 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1306
W20240118 18:50:50.134390 884033 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:50:50.832604 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=377, pq.top=377
E20240118 18:50:50.839010 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1379
W20240118 18:50:51.145902 884033 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240118 18:50:51.839016 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=3490
W20240118 18:50:51.877640 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=389, pq.top=389
W20240118 18:50:52.180619 884033 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.967 ms                  | 44.803 ms                 |
| Forward                   | 7.297 ms                  | 12.826 ms                 |
| Backward                  | 7.470 ms                  | 8.471 ms                  |
| Optimize                  | 3.089 ms                  | 8.544 ms                  |
| BarrierTimeBeforeRank0    | 22.978 us                 | 31.208 ms                 |
| AfterBackward             | 34.863 ms                 | 47.782 ms                 |
| BlockToStepN              | 38.910 ms                 | 285.206 ms                |
| OneStep                   | 109.278 ms                | 389.685 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:50:52.839012 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1033
W20240118 18:50:52.928561 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=400, pq.top=400
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.855 ms                  | 4.160 ms                  |
| ProcessBack:UpdateCache   | 1.947 ms                  | 3.078 ms                  |
| ProcessBack:UpsertPq      | 27.565 ms                 | 39.447 ms                 |
| ProcessOneStep            | 34.749 ms                 | 47.754 ms                 |
| BlockToStepN              | 38.871 ms                 | 285.080 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 12.554, sample: 0.467, forward: 0.567, backward: 0.455, update: 0.328
[proc 1] 400 steps, total: 12.554, sample: 0.502, forward: 0.549, backward: 0.469, update: 0.290
[proc 2] 400 steps, total: 12.554, sample: 0.546, forward: 0.565, backward: 0.466, update: 0.308
[proc 0] 400 steps, total: 12.554, sample: 0.703, forward: 0.659, backward: 0.745, update: 0.358
W20240118 18:50:53.188272 884033 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240118 18:50:53.839632 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1413
W20240118 18:50:53.928746 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=410, pq.top=410
W20240118 18:50:54.198549 884033 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240118 18:50:54.839013 883698 parallel_pq_v2.h:76] insert failed, size(hashtable)=2769
W20240118 18:50:54.928305 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=419, pq.top=419
W20240118 18:50:55.211184 884033 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:50:55.839011 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1007
W20240118 18:50:55.932945 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=428, pq.top=428
W20240118 18:50:56.215534 884033 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240118 18:50:56.839023 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=3462
W20240118 18:50:56.975422 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=437, pq.top=437
W20240118 18:50:57.216542 884033 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.890 ms                  | 45.263 ms                 |
| Forward                   | 7.329 ms                  | 12.826 ms                 |
| Backward                  | 7.482 ms                  | 8.471 ms                  |
| Optimize                  | 3.077 ms                  | 8.544 ms                  |
| BarrierTimeBeforeRank0    | 22.593 us                 | 31.208 ms                 |
| AfterBackward             | 34.213 ms                 | 47.782 ms                 |
| BlockToStepN              | 41.844 ms                 | 285.206 ms                |
| OneStep                   | 108.691 ms                | 389.685 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:50:57.840350 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=3470
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.839 ms                  | 4.160 ms                  |
| ProcessBack:UpdateCache   | 1.925 ms                  | 3.061 ms                  |
| ProcessBack:UpsertPq      | 27.096 ms                 | 38.859 ms                 |
| ProcessOneStep            | 34.082 ms                 | 47.754 ms                 |
| BlockToStepN              | 41.776 ms                 | 285.080 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:50:57.975111 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=445, pq.top=445
W20240118 18:50:58.216171 884033 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:50:58.840011 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2435
W20240118 18:50:59.010592 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=453, pq.top=453
W20240118 18:50:59.229308 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:50:59.840284 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=1229
W20240118 18:51:00.034282 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=461, pq.top=461
W20240118 18:51:00.263589 884033 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240118 18:51:00.840019 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=2952
W20240118 18:51:01.034750 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=468, pq.top=468
W20240118 18:51:01.264859 884033 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:51:01.840328 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=3678
W20240118 18:51:02.034162 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=475, pq.top=475
W20240118 18:51:02.274402 884033 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.860 ms                  | 45.078 ms                 |
| Forward                   | 7.340 ms                  | 12.789 ms                 |
| Backward                  | 7.482 ms                  | 8.388 ms                  |
| Optimize                  | 3.072 ms                  | 8.402 ms                  |
| BarrierTimeBeforeRank0    | 22.059 us                 | 31.208 ms                 |
| AfterBackward             | 33.540 ms                 | 47.372 ms                 |
| BlockToStepN              | 44.610 ms                 | 244.157 ms                |
| OneStep                   | 109.490 ms                | 386.972 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:51:02.840034 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=793
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.827 ms                  | 4.125 ms                  |
| ProcessBack:UpdateCache   | 1.925 ms                  | 3.060 ms                  |
| ProcessBack:UpsertPq      | 26.826 ms                 | 38.551 ms                 |
| ProcessOneStep            | 33.497 ms                 | 47.333 ms                 |
| BlockToStepN              | 44.786 ms                 | 244.043 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:51:03.063472 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=483, pq.top=483
W20240118 18:51:03.324587 884033 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:51:03.840010 883448 parallel_pq_v2.h:76] insert failed, size(hashtable)=456
W20240118 18:51:04.063573 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=489, pq.top=489
W20240118 18:51:04.344085 884033 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:51:04.840117 884032 parallel_pq_v2.h:76] insert failed, size(hashtable)=326
W20240118 18:51:05.091459 883448 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=497, pq.top=497
W20240118 18:51:05.351119 884033 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
[proc 0] 500 steps, total: 12.659, sample: 0.686, forward: 0.674, backward: 0.744, update: 0.382
[proc 1] 500 steps, total: 12.659, sample: 0.509, forward: 0.552, backward: 0.502, update: 0.273
[proc 3] 500 steps, total: 12.659, sample: 0.521, forward: 0.564, backward: 0.472, update: 0.343
[proc 2] 500 steps, total: 12.659, sample: 0.537, forward: 0.589, backward: 0.471, update: 0.312
before call kg_cache_controller.StopThreads()
W20240118 18:51:05.621719 883448 grad_async_v2.h:71] call StopThreads. PID = 883135
W20240118 18:51:05.621754 883448 grad_base.h:210] before processOneStepNegThread_.join();
W20240118 18:51:05.622004 883448 grad_base.h:212] after processOneStepNegThread_.join();
W20240118 18:51:05.622013 883448 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240118 18:51:05.742794 883448 grad_async_v2.h:91] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f7a58a5e0d0>
Successfully xmh. training takes 62.04436707496643 seconds
W20240118 18:51:08.519938 883135 HazptrDomain.h:148] Tagged objects remain. This may indicate a higher-level leak of object(s) that use hazptr_obj_cohort.

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240118 18:39:34.634573 865600 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_2', no_save_emb=True, max_step=500, batch_size=4800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [865600 sampler.py:454] Start PreSampling
WARNING [865600 sampler.py:532] Before construct renumbering_dict
WARNING [865600 sampler.py:555] PreSampling done
W20240118 18:39:36.290052 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240118 18:39:36.290140 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240118 18:39:36.290158 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240118 18:39:36.290174 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240118 18:39:36.290189 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240118 18:39:36.290205 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240118 18:39:36.290218 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240118 18:39:36.290241 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240118 18:39:36.290256 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240118 18:39:36.290270 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240118 18:39:36.290285 865600 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240118 18:39:36.290298 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240118 18:39:36.290313 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240118 18:39:36.290388 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240118 18:39:36.290406 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240118 18:39:36.290422 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240118 18:39:36.290436 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240118 18:39:36.290450 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240118 18:39:36.290478 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240118 18:39:36.290493 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240118 18:39:36.290505 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240118 18:39:36.290519 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240118 18:39:36.290532 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240118 18:39:36.290546 865600 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240118 18:39:36.290557 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240118 18:39:36.290570 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240118 18:39:36.290599 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240118 18:39:36.290616 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240118 18:39:36.290630 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240118 18:39:36.290644 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240118 18:39:36.290658 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240118 18:39:36.290673 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240118 18:39:36.290688 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240118 18:39:36.290700 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240118 18:39:36.290714 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240118 18:39:36.290728 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240118 18:39:36.290742 865600 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240118 18:39:36.290753 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240118 18:39:36.290766 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240118 18:39:36.290792 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240118 18:39:36.290807 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240118 18:39:36.290822 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240118 18:39:36.290834 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240118 18:39:36.290848 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240118 18:39:36.290863 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240118 18:39:36.290875 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240118 18:39:36.290890 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240118 18:39:36.290906 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240118 18:39:36.290920 865600 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240118 18:39:36.290935 865600 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240118 18:39:36.290946 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240118 18:39:36.290956 865600 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240118 18:39:36.394790 865600 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100001ee2000
W20240118 18:39:36.394896 865600 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000035b4000
{0: Graph(num_nodes=9480, num_edges=154759,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11158, num_edges=169559,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=11355, num_edges=241153,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10394, num_edges=202691,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9480 N 154759 E
MertisPartition: part 1 has 11158 N 169559 E
MertisPartition: part 2 has 11355 N 241153 E
MertisPartition: part 3 has 10394 N 202691 E
Rank0: cached key size 373
Rank1: cached key size 373
Rank2: cached key size 373
Rank3: cached key size 373
Before renumbering graph:  {'_ID': tensor([    6,    10,    11,  ...,  2559,  7188, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 3])}
After renumbering graph:  {'_ID': tensor([1685, 1818, 1848,  ..., 7857, 6455, 7327]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 3])}
part_g: DGLGraph(num_nodes=9480, num_edges=154759,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9480, num_edges=154759,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1.792 seconds
[Rank1] pid = 865938
[Rank2] pid = 866003
INFO [865600 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [865938 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [866003 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [866009 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [866003 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [865600 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [866009 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240118 18:39:38.736817 866060 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_0 [1495, 400]; dev=0; size=2.281 MB
W20240118 18:39:38.737207 866060 IPCTensor.h:367] NewIPCTensor: input_keys_0 [100000]0x1000035c6000
W20240118 18:39:38.737286 866060 IPCTensor.h:367] NewIPCTensor: input_keys_neg_0 [100000]0x10000368b000
W20240118 18:39:38.737321 866060 IPCTensor.h:367] NewIPCTensor: backward_grads_0 [100000, 400]0x100003750000
W20240118 18:39:38.737350 866060 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x10000cfe8000
W20240118 18:39:38.737372 866060 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240118 18:39:38.737568 866010 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_2 [1495, 400]; dev=2; size=2.281 MB
W20240118 18:39:38.737818 866060 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240118 18:39:38.738166 866089 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_3 [1495, 400]; dev=3; size=2.281 MB
W20240118 18:39:38.738306 866010 IPCTensor.h:367] NewIPCTensor: input_keys_2 [100000]0x100016886000
W20240118 18:39:38.738485 866010 IPCTensor.h:367] NewIPCTensor: input_keys_neg_2 [100000]0x10001694b000
W20240118 18:39:38.738559 866010 IPCTensor.h:367] NewIPCTensor: backward_grads_2 [100000, 400]0x100016a10000
W20240118 18:39:38.738611 866010 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x1000202a8000
W20240118 18:39:38.738667 866010 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240118 18:39:38.738870 866089 IPCTensor.h:367] NewIPCTensor: input_keys_3 [100000]0x100029b42000
W20240118 18:39:38.739087 866089 IPCTensor.h:367] NewIPCTensor: input_keys_neg_3 [100000]0x100029c07000
W20240118 18:39:38.739197 866089 IPCTensor.h:367] NewIPCTensor: backward_grads_3 [100000, 400]0x100029ccc000
W20240118 18:39:38.739303 866089 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x100033564000
W20240118 18:39:38.739384 866089 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240118 18:39:38.740629 866010 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240118 18:39:38.740788 866089 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
INFO [865938 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240118 18:39:38.745795 865939 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_1 [1495, 400]; dev=1; size=2.281 MB
W20240118 18:39:38.746102 865939 IPCTensor.h:367] NewIPCTensor: input_keys_1 [100000]0x10003ce06000
W20240118 18:39:38.746176 865939 IPCTensor.h:367] NewIPCTensor: input_keys_neg_1 [100000]0x10003cecb000
W20240118 18:39:38.746217 865939 IPCTensor.h:367] NewIPCTensor: backward_grads_1 [100000, 400]0x10003cf90000
W20240118 18:39:38.746248 865939 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x100046828000
W20240118 18:39:38.746279 865939 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240118 18:39:38.746675 865939 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
cudaHostRegister 0x100001ee2000
1: KnownLocalCachedEmbedding init done
WARNING [865938 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 866009
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 1495), (1495, 2990), (2990, 4485), (4485, 5980)]
cudaHostRegister 0x100001ee2000
0: KnownLocalCachedEmbedding init done
WARNING [865600 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
2: KnownLocalCachedEmbedding init done
WARNING [866003 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
3: KnownLocalCachedEmbedding init done
WARNING [866009 DistTensor.py:56] The tensor name already exists in the kvstore
I20240118 18:39:38.884974 866089 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240118 18:39:38.885007 866010 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240118 18:39:38.885037 865939 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240118 18:39:38.885092 866060 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240118 18:39:38.885967 866060 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.1
        }
W20240118 18:39:38.886137 866060 grad_base.h:172] Init GradProcessingBase done
I20240118 18:39:38.890767 866060 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240118 18:39:38.890873 866060 kg_controller.h:78] after init GradAsyncProcessingV2
I20240118 18:39:38.890882 866060 kg_controller.h:84] Construct KGCacheController done
I20240118 18:39:39.228232 866060 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240118 18:39:39.907166 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240118 18:39:39.907598 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240118 18:39:39.935868 866479 HazptrDomain.h:770] 10 request backlog for hazptr asynchronous reclamation executor
I20240118 18:39:39.956251 866010 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240118 18:39:39.974541 865939 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240118 18:39:39.974882 866089 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240118 18:39:40.026819 866060 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240118 18:39:42.286173 866252 parallel_pq_v2.h:76] insert failed, size(hashtable)=5
W20240118 18:39:42.312664 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=0
W20240118 18:39:42.316545 866480 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:39:43.286015 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3785
W20240118 18:39:43.312008 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=14, pq.top=14
W20240118 18:39:43.339584 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.582 ms                  | 47.223 ms                 |
| Forward                   | 8.178 ms                  | 843.724 ms                |
| Backward                  | 8.732 ms                  | 245.389 ms                |
| Optimize                  | 3.218 ms                  | 8.590 ms                  |
| BarrierTimeBeforeRank0    | 28.456 us                 | 215.291 ms                |
| AfterBackward             | 26.824 ms                 | 971.141 ms                |
| BlockToStepN              | 1.277 ms                  | 159.787 ms                |
| OneStep                   | 70.798 ms                 | 2.288 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.735 ms                  | 439.244 ms                |
| ProcessBack:UpdateCache   | 1.955 ms                  | 399.374 ms                |
| ProcessBack:UpsertPq      | 20.165 ms                 | 26.991 ms                 |
| ProcessOneStep            | 27.181 ms                 | 970.829 ms                |
| BlockToStepN              | 997.473 us                | 159.626 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:39:44.286015 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=263
W20240118 18:39:44.339339 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:39:44.402745 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=28, pq.top=28
E20240118 18:39:45.286007 866060 parallel_pq_v2.h:76] insert failed, size(hashtable)=2809
W20240118 18:39:45.348975 866480 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:39:45.434294 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=41, pq.top=41
E20240118 18:39:46.286017 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3965
W20240118 18:39:46.380280 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:39:46.434031 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=51, pq.top=51
E20240118 18:39:47.286008 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4602
W20240118 18:39:47.390615 866480 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:39:47.438767 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=60, pq.top=60
E20240118 18:39:48.286020 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2878
W20240118 18:39:48.401213 866480 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240118 18:39:48.502475 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=73, pq.top=73
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.466 ms                  | 41.527 ms                 |
| Forward                   | 8.123 ms                  | 30.775 ms                 |
| Backward                  | 8.878 ms                  | 10.463 ms                 |
| Optimize                  | 3.177 ms                  | 8.226 ms                  |
| BarrierTimeBeforeRank0    | 24.635 us                 | 25.434 ms                 |
| AfterBackward             | 26.770 ms                 | 52.202 ms                 |
| BlockToStepN              | 24.974 ms                 | 79.721 ms                 |
| OneStep                   | 86.791 ms                 | 211.698 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.716 ms                  | 6.420 ms                  |
| ProcessBack:UpdateCache   | 1.944 ms                  | 4.667 ms                  |
| ProcessBack:UpsertPq      | 19.594 ms                 | 25.874 ms                 |
| ProcessOneStep            | 26.602 ms                 | 52.169 ms                 |
| BlockToStepN              | 24.915 ms                 | 79.639 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240118 18:39:49.287460 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=47
W20240118 18:39:49.409605 866480 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240118 18:39:49.506289 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=84, pq.top=84
E20240118 18:39:50.287037 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3956
W20240118 18:39:50.464615 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:39:50.533200 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=94, pq.top=94
[proc 3] 100 steps, total: 11.308, sample: 0.416, forward: 1.465, backward: 0.950, update: 0.339
[proc 2] 100 steps, total: 11.327, sample: 0.474, forward: 1.449, backward: 0.796, update: 0.353
[proc 1] 100 steps, total: 11.309, sample: 0.509, forward: 1.530, backward: 0.889, update: 0.311
-------Step 0-------
tensor([ 9081, 13417, 14646, 12120,  5431,  6117,   218,  2059,  3430, 12053]) tensor([ 1848,   236,  7255, 12503, 11317,    85, 10764,  3996, 12267,  9171])
-------Step 1-------
tensor([ 9081, 13417, 14646, 12120,  5431,  6117,   218,  2059,  3430, 12053]) tensor([ 8811, 12853,  3816, 12920,  2637,  3334,  8280,  2297, 14868, 10736])
-------Step 2-------
tensor([    2, 12085,  7557,   407,   843,  9204,  3378,    66, 11042,   344]) tensor([ 9844, 11199,  7127,  7612,  3281,  7085,  7402,  5210, 12122, 12673])
-------Step 3-------
tensor([    2, 12085,  7557,   407,   843,  9204,  3378,    66, 11042,   344]) tensor([10521,  5682, 14928, 10926, 12055, 13449, 13995,  3694, 10279,  5287])
-------Step 4-------
tensor([14482,  5941,  6557,  5605,  1797,  4493,  1079, 11780, 12228,   199]) tensor([ 6425,  3641, 10778, 11547,  8505,  6183,    21, 14942,  6646,  5881])
-------Step 5-------
tensor([14482,  5941,  6557,  5605,  1797,  4493,  1079, 11780, 12228,   199]) tensor([ 5674, 11691,  4582,  8773, 11021,  5595, 11878,  5435, 11059,   236])
-------Step 6-------
tensor([ 2492,    11,  3593,   111, 12139,   160,  9967,  4874, 10569,  3549]) tensor([  523, 11700,  6948,   141,  1813,  2482, 10534, 14942, 10013,  5826])
-------Step 7-------
tensor([ 2492,    11,  3593,   111, 12139,   160,  9967,  4874, 10569,  3549]) tensor([ 6494,  6302, 13455,  5440,  7233,  2020,  1822, 12982,  6387,  7542])
-------Step 8-------
tensor([   43,  2086,  1475,  6599,  3680,  6609,  2465,   108, 12155, 12787]) tensor([ 5910,  2245,    20, 13209,  4078,  9459,  3626,  5300,   370,  8577])
-------Step 9-------
tensor([   43,  2086,  1475,  6599,  3680,  6609,  2465,   108, 12155, 12787]) tensor([  270,  1301,  6225,  8098,   107,  1415,  8891, 11466, 10741,  1120])
[proc 0] 100 steps, total: 11.256, sample: 0.600, forward: 1.583, backward: 1.122, update: 0.372
E20240118 18:39:51.287014 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2666
W20240118 18:39:51.469887 866480 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240118 18:39:51.606266 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=103, pq.top=103
E20240118 18:39:52.287036 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=387
W20240118 18:39:52.484210 866480 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:39:52.643700 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=111, pq.top=111
E20240118 18:39:53.287012 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3247
W20240118 18:39:53.488999 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:39:53.643155 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=118, pq.top=118
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.486 ms                  | 42.060 ms                 |
| Forward                   | 8.123 ms                  | 30.775 ms                 |
| Backward                  | 8.822 ms                  | 10.821 ms                 |
| Optimize                  | 3.150 ms                  | 8.424 ms                  |
| BarrierTimeBeforeRank0    | 23.932 us                 | 29.437 ms                 |
| AfterBackward             | 25.887 ms                 | 52.202 ms                 |
| BlockToStepN              | 39.350 ms                 | 113.465 ms                |
| OneStep                   | 97.968 ms                 | 211.698 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.692 ms                  | 6.420 ms                  |
| ProcessBack:UpdateCache   | 1.917 ms                  | 4.667 ms                  |
| ProcessBack:UpsertPq      | 19.362 ms                 | 25.874 ms                 |
| ProcessOneStep            | 25.862 ms                 | 52.169 ms                 |
| BlockToStepN              | 39.447 ms                 | 118.509 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:39:54.287017 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2234
W20240118 18:39:54.512969 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:39:54.643025 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=125, pq.top=125
E20240118 18:39:55.287259 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1673
W20240118 18:39:55.534715 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:39:55.662317 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=132, pq.top=132
E20240118 18:39:56.287251 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=395
W20240118 18:39:56.535423 866480 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:39:56.724979 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=139, pq.top=139
E20240118 18:39:57.287007 866252 parallel_pq_v2.h:76] insert failed, size(hashtable)=2628
W20240118 18:39:57.620635 866480 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:39:57.724190 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=145, pq.top=145
E20240118 18:39:58.287137 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=318
W20240118 18:39:58.639811 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:39:58.792022 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=152, pq.top=152
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.518 ms                  | 41.924 ms                 |
| Forward                   | 8.135 ms                  | 13.397 ms                 |
| Backward                  | 8.833 ms                  | 10.551 ms                 |
| Optimize                  | 3.122 ms                  | 8.226 ms                  |
| BarrierTimeBeforeRank0    | 23.777 us                 | 28.872 ms                 |
| AfterBackward             | 25.912 ms                 | 33.115 ms                 |
| BlockToStepN              | 48.517 ms                 | 142.212 ms                |
| OneStep                   | 104.763 ms                | 194.534 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.689 ms                  | 3.460 ms                  |
| ProcessBack:UpdateCache   | 1.922 ms                  | 3.115 ms                  |
| ProcessBack:UpsertPq      | 19.660 ms                 | 27.671 ms                 |
| ProcessOneStep            | 25.883 ms                 | 33.091 ms                 |
| BlockToStepN              | 48.585 ms                 | 142.128 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:39:59.287117 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1357
W20240118 18:39:59.642871 866480 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:39:59.842767 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=159, pq.top=159
E20240118 18:40:00.287425 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4616
W20240118 18:40:00.655927 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:40:00.842242 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=165, pq.top=165
E20240118 18:40:01.287828 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=347
W20240118 18:40:01.663635 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:40:01.847468 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=172, pq.top=172
E20240118 18:40:02.287016 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4059
W20240118 18:40:02.705027 866480 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:40:02.847062 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=178, pq.top=178
E20240118 18:40:03.287278 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1754
W20240118 18:40:03.713943 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:40:03.847288 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=185, pq.top=185
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.564 ms                  | 42.332 ms                 |
| Forward                   | 8.116 ms                  | 14.130 ms                 |
| Backward                  | 8.845 ms                  | 10.551 ms                 |
| Optimize                  | 3.132 ms                  | 8.424 ms                  |
| BarrierTimeBeforeRank0    | 23.777 us                 | 29.437 ms                 |
| AfterBackward             | 25.887 ms                 | 33.115 ms                 |
| BlockToStepN              | 56.260 ms                 | 142.212 ms                |
| OneStep                   | 117.019 ms                | 194.534 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.680 ms                  | 3.456 ms                  |
| ProcessBack:UpdateCache   | 1.912 ms                  | 3.042 ms                  |
| ProcessBack:UpsertPq      | 19.631 ms                 | 27.585 ms                 |
| ProcessOneStep            | 25.856 ms                 | 33.091 ms                 |
| BlockToStepN              | 56.382 ms                 | 147.659 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:04.287160 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=355
W20240118 18:40:04.736912 866480 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:40:04.847215 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=190, pq.top=190
E20240118 18:40:05.287032 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2225
W20240118 18:40:05.759516 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:40:05.847195 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=197, pq.top=197
[proc 0] 200 steps, total: 14.948, sample: 0.705, forward: 0.709, backward: 0.880, update: 0.351
[proc 2] 200 steps, total: 14.948, sample: 0.440, forward: 0.556, backward: 0.514, update: 0.354
[proc 1] 200 steps, total: 14.948, sample: 0.388, forward: 0.547, backward: 0.542, update: 0.294
[proc 3] 200 steps, total: 14.948, sample: 0.480, forward: 0.531, backward: 0.581, update: 0.280
E20240118 18:40:06.287009 866252 parallel_pq_v2.h:76] insert failed, size(hashtable)=731
W20240118 18:40:06.782259 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:40:06.847096 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=204, pq.top=204
E20240118 18:40:07.287084 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=282
W20240118 18:40:07.804260 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:40:07.847333 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=211, pq.top=211
E20240118 18:40:08.287019 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4167
W20240118 18:40:08.807808 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:40:08.847126 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=217, pq.top=217
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.607 ms                  | 42.332 ms                 |
| Forward                   | 8.112 ms                  | 14.130 ms                 |
| Backward                  | 8.878 ms                  | 10.551 ms                 |
| Optimize                  | 3.144 ms                  | 8.424 ms                  |
| BarrierTimeBeforeRank0    | 23.918 us                 | 31.084 ms                 |
| AfterBackward             | 25.908 ms                 | 33.115 ms                 |
| BlockToStepN              | 63.582 ms                 | 147.737 ms                |
| OneStep                   | 128.451 ms                | 211.698 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.678 ms                  | 3.456 ms                  |
| ProcessBack:UpdateCache   | 1.907 ms                  | 3.042 ms                  |
| ProcessBack:UpsertPq      | 19.638 ms                 | 27.585 ms                 |
| ProcessOneStep            | 25.875 ms                 | 33.091 ms                 |
| BlockToStepN              | 63.766 ms                 | 147.659 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:09.287012 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1428
W20240118 18:40:09.823299 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:40:09.873075 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=224, pq.top=224
E20240118 18:40:10.287395 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=12
W20240118 18:40:10.843286 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:40:10.927016 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=231, pq.top=231
E20240118 18:40:11.287015 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=5322
W20240118 18:40:11.853549 866480 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:40:11.927071 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=238, pq.top=238
E20240118 18:40:12.290908 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1651
W20240118 18:40:12.874156 866480 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:40:12.927542 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=245, pq.top=245
E20240118 18:40:13.290058 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1161
W20240118 18:40:13.882982 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.605 ms                  | 42.787 ms                 |
| Forward                   | 8.119 ms                  | 13.440 ms                 |
| Backward                  | 8.890 ms                  | 10.463 ms                 |
| Optimize                  | 3.136 ms                  | 8.226 ms                  |
| BarrierTimeBeforeRank0    | 23.918 us                 | 31.084 ms                 |
| AfterBackward             | 25.885 ms                 | 32.962 ms                 |
| BlockToStepN              | 69.873 ms                 | 147.737 ms                |
| OneStep                   | 134.458 ms                | 211.698 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:40:13.927037 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=251, pq.top=251
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.677 ms                  | 3.456 ms                  |
| ProcessBack:UpdateCache   | 1.890 ms                  | 2.983 ms                  |
| ProcessBack:UpsertPq      | 19.458 ms                 | 27.536 ms                 |
| ProcessOneStep            | 25.846 ms                 | 32.933 ms                 |
| BlockToStepN              | 69.896 ms                 | 142.794 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:14.290349 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=162
W20240118 18:40:14.927137 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=258, pq.top=258
W20240118 18:40:14.953569 866480 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240118 18:40:15.290153 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3277
W20240118 18:40:15.951241 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=265, pq.top=265
W20240118 18:40:15.968920 866480 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:40:16.290129 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1574
W20240118 18:40:16.969559 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=272, pq.top=272
W20240118 18:40:16.975950 866480 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:40:17.290027 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1418
W20240118 18:40:17.969271 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=278, pq.top=278
W20240118 18:40:18.026142 866480 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240118 18:40:18.294194 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1498
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.569 ms                  | 44.916 ms                 |
| Forward                   | 8.131 ms                  | 13.440 ms                 |
| Backward                  | 8.897 ms                  | 10.463 ms                 |
| Optimize                  | 3.147 ms                  | 8.226 ms                  |
| BarrierTimeBeforeRank0    | 24.456 us                 | 31.084 ms                 |
| AfterBackward             | 25.639 ms                 | 32.962 ms                 |
| BlockToStepN              | 76.462 ms                 | 146.024 ms                |
| OneStep                   | 137.670 ms                | 210.931 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:40:19.010366 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=285, pq.top=285
W20240118 18:40:19.038192 866480 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.664 ms                  | 3.440 ms                  |
| ProcessBack:UpdateCache   | 1.871 ms                  | 2.976 ms                  |
| ProcessBack:UpsertPq      | 18.721 ms                 | 27.448 ms                 |
| ProcessOneStep            | 25.608 ms                 | 32.933 ms                 |
| BlockToStepN              | 76.582 ms                 | 145.920 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:19.294015 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2137
W20240118 18:40:20.010493 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=291, pq.top=291
W20240118 18:40:20.080237 866480 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:40:20.294010 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1212
W20240118 18:40:21.028539 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=298, pq.top=298
W20240118 18:40:21.118582 866480 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240118 18:40:21.294009 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=5112
[proc 0] 300 steps, total: 15.218, sample: 0.652, forward: 0.739, backward: 0.888, update: 0.418
[proc 2] 300 steps, total: 15.218, sample: 0.537, forward: 0.604, backward: 0.515, update: 0.360
[proc 3] 300 steps, total: 15.218, sample: 0.571, forward: 0.577, backward: 0.564, update: 0.359
[proc 1] 300 steps, total: 15.218, sample: 0.544, forward: 0.587, backward: 0.505, update: 0.339
W20240118 18:40:22.029709 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=305, pq.top=305
W20240118 18:40:22.142621 866480 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240118 18:40:22.294687 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=5494
W20240118 18:40:23.029521 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=312, pq.top=312
W20240118 18:40:23.151157 866480 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end5
E20240118 18:40:23.294008 866252 parallel_pq_v2.h:76] insert failed, size(hashtable)=1561
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.558 ms                  | 46.625 ms                 |
| Forward                   | 8.150 ms                  | 13.440 ms                 |
| Backward                  | 8.905 ms                  | 10.463 ms                 |
| Optimize                  | 3.144 ms                  | 8.226 ms                  |
| BarrierTimeBeforeRank0    | 24.651 us                 | 31.084 ms                 |
| AfterBackward             | 25.368 ms                 | 32.962 ms                 |
| BlockToStepN              | 75.586 ms                 | 147.737 ms                |
| OneStep                   | 138.244 ms                | 211.698 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:40:24.029510 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=325, pq.top=325
W20240118 18:40:24.202765 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.656 ms                  | 3.440 ms                  |
| ProcessBack:UpdateCache   | 1.843 ms                  | 2.366 ms                  |
| ProcessBack:UpsertPq      | 18.365 ms                 | 27.433 ms                 |
| ProcessOneStep            | 25.298 ms                 | 32.933 ms                 |
| BlockToStepN              | 75.497 ms                 | 159.626 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:24.294298 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=119
W20240118 18:40:25.029292 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=326, pq.top=326
E20240118 18:40:25.294445 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2295
W20240118 18:40:26.029357 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=326, pq.top=326
E20240118 18:40:26.294670 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3928
W20240118 18:40:27.029496 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=326, pq.top=326
E20240118 18:40:27.295383 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=5289
W20240118 18:40:28.029546 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=326, pq.top=326
W20240118 18:40:28.108948 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:40:28.295091 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=972
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.562 ms                  | 46.625 ms                 |
| Forward                   | 8.154 ms                  | 13.440 ms                 |
| Backward                  | 8.905 ms                  | 10.463 ms                 |
| Optimize                  | 3.137 ms                  | 8.226 ms                  |
| BarrierTimeBeforeRank0    | 24.635 us                 | 31.084 ms                 |
| AfterBackward             | 25.297 ms                 | 32.962 ms                 |
| BlockToStepN              | 76.434 ms                 | 173.351 ms                |
| OneStep                   | 138.244 ms                | 225.246 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:40:29.029598 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=332, pq.top=332
W20240118 18:40:29.128834 866480 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.653 ms                  | 3.440 ms                  |
| ProcessBack:UpdateCache   | 1.837 ms                  | 2.366 ms                  |
| ProcessBack:UpsertPq      | 18.297 ms                 | 27.433 ms                 |
| ProcessOneStep            | 25.262 ms                 | 32.933 ms                 |
| BlockToStepN              | 76.382 ms                 | 173.245 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:29.295007 866252 parallel_pq_v2.h:76] insert failed, size(hashtable)=3240
W20240118 18:40:30.069651 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=339, pq.top=339
W20240118 18:40:30.154767 866480 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:40:30.295013 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4491
W20240118 18:40:31.099323 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=351, pq.top=351
E20240118 18:40:31.295059 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=513
W20240118 18:40:31.313352 866480 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end4
W20240118 18:40:32.099664 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=357, pq.top=357
E20240118 18:40:32.297051 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1760
W20240118 18:40:32.986891 866480 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:40:33.157318 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=359, pq.top=359
E20240118 18:40:33.297194 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1314
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.566 ms                  | 45.348 ms                 |
| Forward                   | 8.169 ms                  | 13.397 ms                 |
| Backward                  | 8.901 ms                  | 10.463 ms                 |
| Optimize                  | 3.136 ms                  | 8.207 ms                  |
| BarrierTimeBeforeRank0    | 24.651 us                 | 30.901 ms                 |
| AfterBackward             | 25.061 ms                 | 32.778 ms                 |
| BlockToStepN              | 74.666 ms                 | 175.906 ms                |
| OneStep                   | 137.328 ms                | 262.996 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:40:34.008826 866480 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240118 18:40:34.159709 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=363, pq.top=363
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.649 ms                  | 3.456 ms                  |
| ProcessBack:UpdateCache   | 1.812 ms                  | 2.366 ms                  |
| ProcessBack:UpsertPq      | 18.101 ms                 | 27.433 ms                 |
| ProcessOneStep            | 25.031 ms                 | 32.750 ms                 |
| BlockToStepN              | 74.880 ms                 | 177.979 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:34.297114 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2301
W20240118 18:40:35.074309 866480 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240118 18:40:35.159729 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=369, pq.top=369
E20240118 18:40:35.297848 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1365
W20240118 18:40:36.098160 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:40:36.198812 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=378, pq.top=378
E20240118 18:40:36.297012 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3128
W20240118 18:40:37.120360 866480 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:40:37.208948 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=386, pq.top=386
E20240118 18:40:37.297006 866060 parallel_pq_v2.h:76] insert failed, size(hashtable)=3668
W20240118 18:40:38.150594 866480 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:40:38.208611 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=395, pq.top=395
E20240118 18:40:38.297045 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4530
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.572 ms                  | 46.625 ms                 |
| Forward                   | 8.178 ms                  | 13.397 ms                 |
| Backward                  | 8.906 ms                  | 10.463 ms                 |
| Optimize                  | 3.133 ms                  | 8.207 ms                  |
| BarrierTimeBeforeRank0    | 24.133 us                 | 30.901 ms                 |
| AfterBackward             | 24.876 ms                 | 32.778 ms                 |
| BlockToStepN              | 76.680 ms                 | 178.077 ms                |
| OneStep                   | 136.538 ms                | 262.996 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 17.472, sample: 0.563, forward: 0.577, backward: 0.574, update: 0.321
[proc 2] 400 steps, total: 17.472, sample: 0.497, forward: 0.566, backward: 0.497, update: 0.298
[proc 1] 400 steps, total: 17.472, sample: 0.568, forward: 0.583, backward: 0.513, update: 0.362
[proc 0] 400 steps, total: 17.472, sample: 0.679, forward: 0.731, backward: 0.886, update: 0.360
W20240118 18:40:39.175524 866480 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240118 18:40:39.220446 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=403, pq.top=403
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.642 ms                  | 3.440 ms                  |
| ProcessBack:UpdateCache   | 1.745 ms                  | 2.363 ms                  |
| ProcessBack:UpsertPq      | 17.975 ms                 | 27.283 ms                 |
| ProcessOneStep            | 24.792 ms                 | 32.750 ms                 |
| BlockToStepN              | 76.582 ms                 | 177.979 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:39.297029 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4039
W20240118 18:40:40.194149 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:40:40.288591 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=412, pq.top=412
E20240118 18:40:40.301072 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=841
W20240118 18:40:41.236532 866480 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:40:41.288538 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=420, pq.top=420
E20240118 18:40:41.301036 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1227
W20240118 18:40:42.242458 866480 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:40:42.288220 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=428, pq.top=428
E20240118 18:40:42.301003 866480 parallel_pq_v2.h:76] insert failed, size(hashtable)=1090
W20240118 18:40:43.260555 866480 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:40:43.288156 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=435, pq.top=435
E20240118 18:40:43.301067 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=2223
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.578 ms                  | 47.223 ms                 |
| Forward                   | 8.212 ms                  | 13.397 ms                 |
| Backward                  | 8.901 ms                  | 10.463 ms                 |
| Optimize                  | 3.121 ms                  | 8.207 ms                  |
| BarrierTimeBeforeRank0    | 23.932 us                 | 30.901 ms                 |
| AfterBackward             | 24.646 ms                 | 32.778 ms                 |
| BlockToStepN              | 76.680 ms                 | 178.077 ms                |
| OneStep                   | 134.099 ms                | 262.996 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.641 ms                  | 3.440 ms                  |
| ProcessBack:UpdateCache   | 1.699 ms                  | 2.353 ms                  |
| ProcessBack:UpsertPq      | 17.925 ms                 | 27.181 ms                 |
| ProcessOneStep            | 24.620 ms                 | 32.750 ms                 |
| BlockToStepN              | 76.582 ms                 | 177.979 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:40:44.273512 866480 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240118 18:40:44.291443 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=443, pq.top=443
E20240118 18:40:44.301018 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=719
W20240118 18:40:45.289602 866480 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:40:45.291057 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=451, pq.top=451
E20240118 18:40:45.301009 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1123
E20240118 18:40:46.301959 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=4554
W20240118 18:40:46.315466 866480 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240118 18:40:46.359386 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=459, pq.top=459
E20240118 18:40:47.301019 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1759
W20240118 18:40:47.358543 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:40:47.405153 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=467, pq.top=467
E20240118 18:40:48.301461 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=3187
W20240118 18:40:48.380784 866480 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240118 18:40:48.405602 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=474, pq.top=474
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.605 ms                  | 47.004 ms                 |
| Forward                   | 8.169 ms                  | 13.199 ms                 |
| Backward                  | 8.911 ms                  | 10.042 ms                 |
| Optimize                  | 3.104 ms                  | 8.160 ms                  |
| BarrierTimeBeforeRank0    | 23.442 us                 | 30.573 ms                 |
| AfterBackward             | 24.876 ms                 | 32.445 ms                 |
| BlockToStepN              | 77.490 ms                 | 175.906 ms                |
| OneStep                   | 132.712 ms                | 225.246 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.642 ms                  | 3.625 ms                  |
| ProcessBack:UpdateCache   | 1.637 ms                  | 2.343 ms                  |
| ProcessBack:UpsertPq      | 17.926 ms                 | 26.991 ms                 |
| ProcessOneStep            | 24.850 ms                 | 32.421 ms                 |
| BlockToStepN              | 76.813 ms                 | 175.806 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:40:49.301023 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1066
W20240118 18:40:49.399818 866480 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240118 18:40:49.405040 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=482, pq.top=482
E20240118 18:40:50.301023 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1034
W20240118 18:40:50.403610 866480 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:40:50.424276 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=490, pq.top=490
E20240118 18:40:51.301450 866479 parallel_pq_v2.h:76] insert failed, size(hashtable)=1292
W20240118 18:40:51.404686 866480 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:40:51.424216 866060 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=497, pq.top=497
[proc 3] 500 steps, total: 12.993, sample: 0.538, forward: 0.567, backward: 0.591, update: 0.307
[proc 0] 500 steps, total: 12.993, sample: 0.613, forward: 0.691, backward: 0.884, update: 0.327
[proc 2] 500 steps, total: 12.993, sample: 0.545, forward: 0.554, backward: 0.501, update: 0.283
[proc 1] 500 steps, total: 12.993, sample: 0.563, forward: 0.571, backward: 0.530, update: 0.309
before call kg_cache_controller.StopThreads()
W20240118 18:40:51.914425 866060 grad_async_v2.h:71] call StopThreads. PID = 865600
W20240118 18:40:51.914458 866060 grad_base.h:210] before processOneStepNegThread_.join();
W20240118 18:40:51.914695 866060 grad_base.h:212] after processOneStepNegThread_.join();
W20240118 18:40:51.914701 866060 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240118 18:40:51.927403 866060 grad_async_v2.h:91] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fcfe8f9b750>
Successfully xmh. training takes 71.90066266059875 seconds

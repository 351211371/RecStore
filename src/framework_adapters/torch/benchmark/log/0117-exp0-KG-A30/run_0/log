WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240118 18:37:00.814330 859083 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE_l1', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_l1_FB15k_393', no_save_emb=True, max_step=500, batch_size=4800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [859083 sampler.py:454] Start PreSampling
WARNING [859083 sampler.py:532] Before construct renumbering_dict
WARNING [859083 sampler.py:555] PreSampling done
W20240118 18:37:02.466166 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240118 18:37:02.466262 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240118 18:37:02.466280 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240118 18:37:02.466297 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240118 18:37:02.466312 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240118 18:37:02.466328 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240118 18:37:02.466343 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240118 18:37:02.466361 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240118 18:37:02.466377 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240118 18:37:02.466390 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240118 18:37:02.466408 859083 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240118 18:37:02.466421 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240118 18:37:02.466434 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240118 18:37:02.466511 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240118 18:37:02.466526 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240118 18:37:02.466540 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240118 18:37:02.466554 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240118 18:37:02.466568 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240118 18:37:02.466596 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240118 18:37:02.466610 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240118 18:37:02.466624 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240118 18:37:02.466639 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240118 18:37:02.466652 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240118 18:37:02.466666 859083 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240118 18:37:02.466677 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240118 18:37:02.466688 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240118 18:37:02.466718 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240118 18:37:02.466734 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240118 18:37:02.466748 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240118 18:37:02.466761 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240118 18:37:02.466778 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240118 18:37:02.466792 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240118 18:37:02.466806 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240118 18:37:02.466820 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240118 18:37:02.466832 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240118 18:37:02.466846 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240118 18:37:02.466861 859083 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240118 18:37:02.466871 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240118 18:37:02.466882 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240118 18:37:02.466909 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240118 18:37:02.466925 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240118 18:37:02.466939 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240118 18:37:02.466953 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240118 18:37:02.466969 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240118 18:37:02.466982 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240118 18:37:02.466997 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240118 18:37:02.467011 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240118 18:37:02.467025 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240118 18:37:02.467039 859083 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240118 18:37:02.467053 859083 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240118 18:37:02.467064 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240118 18:37:02.467075 859083 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240118 18:37:02.570777 859083 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100001ee2000
W20240118 18:37:02.570887 859083 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000035b4000
{0: Graph(num_nodes=9480, num_edges=154759,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11158, num_edges=169559,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=11355, num_edges=241153,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10394, num_edges=202691,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9480 N 154759 E
MertisPartition: part 1 has 11158 N 169559 E
MertisPartition: part 2 has 11355 N 241153 E
MertisPartition: part 3 has 10394 N 202691 E
Rank0: cached key size 373
Rank1: cached key size 373
Rank2: cached key size 373
Rank3: cached key size 373
Before renumbering graph:  {'_ID': tensor([    6,    10,    11,  ...,  2559,  7188, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 3])}
After renumbering graph:  {'_ID': tensor([1654, 1769, 1803,  ..., 8706, 7263, 6613]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 3])}
part_g: DGLGraph(num_nodes=9480, num_edges=154759,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9480, num_edges=154759,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1.787 seconds
[Rank1] pid = 859327
[Rank2] pid = 859393
INFO [859083 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [859327 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [859395 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [859393 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [859395 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [859327 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [859393 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [859083 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240118 18:37:05.001921 859492 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_3 [1495, 400]; dev=3; size=2.281 MB
W20240118 18:37:05.001952 859328 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_1 [1495, 400]; dev=1; size=2.281 MB
W20240118 18:37:05.002593 859492 IPCTensor.h:367] NewIPCTensor: input_keys_3 [100000]0x1000035c8000
W20240118 18:37:05.002619 859328 IPCTensor.h:367] NewIPCTensor: input_keys_1 [100000]0x10000368d000
W20240118 18:37:05.002605 859401 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_2 [1495, 400]; dev=2; size=2.281 MB
W20240118 18:37:05.002713 859410 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_0 [1495, 400]; dev=0; size=2.281 MB
W20240118 18:37:05.002758 859492 IPCTensor.h:367] NewIPCTensor: input_keys_neg_3 [100000]0x100003752000
W20240118 18:37:05.002777 859328 IPCTensor.h:367] NewIPCTensor: input_keys_neg_1 [100000]0x100003817000
W20240118 18:37:05.002841 859492 IPCTensor.h:367] NewIPCTensor: backward_grads_3 [100000, 400]0x1000038dc000
W20240118 18:37:05.002859 859328 IPCTensor.h:367] NewIPCTensor: backward_grads_1 [100000, 400]0x10000d174000
W20240118 18:37:05.002902 859328 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x100016a0c000
W20240118 18:37:05.002920 859492 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x1000202a4000
W20240118 18:37:05.002946 859328 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240118 18:37:05.002956 859492 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240118 18:37:05.004709 859328 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240118 18:37:05.004717 859492 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240118 18:37:05.004855 859401 IPCTensor.h:367] NewIPCTensor: input_keys_2 [100000]0x100029b42000
W20240118 18:37:05.005082 859401 IPCTensor.h:367] NewIPCTensor: input_keys_neg_2 [100000]0x100029c07000
W20240118 18:37:05.005183 859401 IPCTensor.h:367] NewIPCTensor: backward_grads_2 [100000, 400]0x100029ccc000
W20240118 18:37:05.005297 859401 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x100033564000
W20240118 18:37:05.005365 859401 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240118 18:37:05.006042 859410 IPCTensor.h:367] NewIPCTensor: input_keys_0 [100000]0x10003cdfe000
W20240118 18:37:05.006204 859410 IPCTensor.h:367] NewIPCTensor: input_keys_neg_0 [100000]0x10003cec3000
W20240118 18:37:05.006299 859410 IPCTensor.h:367] NewIPCTensor: backward_grads_0 [100000, 400]0x10003cf88000
W20240118 18:37:05.006371 859410 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x100046820000
W20240118 18:37:05.006445 859410 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240118 18:37:05.007387 859401 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240118 18:37:05.007470 859410 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
cudaHostRegister 0x100001ee2000
3: KnownLocalCachedEmbedding init done
WARNING [859395 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
1: KnownLocalCachedEmbedding init done
WARNING [859327 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 859395
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 1495), (1495, 2990), (2990, 4485), (4485, 5980)]
cudaHostRegister 0x100001ee2000
0: KnownLocalCachedEmbedding init done
WARNING [859083 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
2: KnownLocalCachedEmbedding init done
WARNING [859393 DistTensor.py:56] The tensor name already exists in the kvstore
I20240118 18:37:05.166584 859401 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240118 18:37:05.166620 859410 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240118 18:37:05.166644 859328 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240118 18:37:05.166764 859492 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240118 18:37:05.167907 859410 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.1
        }
W20240118 18:37:05.167995 859410 grad_base.h:172] Init GradProcessingBase done
I20240118 18:37:05.170984 859410 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240118 18:37:05.171061 859410 kg_controller.h:78] after init GradAsyncProcessingV2
I20240118 18:37:05.171066 859410 kg_controller.h:84] Construct KGCacheController done
I20240118 18:37:05.504511 859410 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240118 18:37:06.291822 859972 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240118 18:37:06.292073 859972 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240118 18:37:06.308259 859971 HazptrDomain.h:770] 10 request backlog for hazptr asynchronous reclamation executor
I20240118 18:37:06.322517 859328 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240118 18:37:06.325876 859492 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240118 18:37:06.328290 859401 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240118 18:37:06.400840 859410 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240118 18:37:08.475332 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=20
W20240118 18:37:08.503206 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=0
W20240118 18:37:08.526818 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:37:09.475011 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=5762
W20240118 18:37:09.541430 859972 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.778 ms                  | 33.945 ms                 |
| Forward                   | 34.787 ms                 | 1.242 s                   |
| Backward                  | 45.173 ms                 | 213.694 ms                |
| Optimize                  | 3.812 ms                  | 62.303 ms                 |
| BarrierTimeBeforeRank0    | 40.928 us                 | 75.402 us                 |
| AfterBackward             | 34.804 ms                 | 581.803 ms                |
| BlockToStepN              | 62.964 us                 | 21.627 ms                 |
| OneStep                   | 132.329 ms                | 2.125 s                   |
+---------------------------+---------------------------+---------------------------+
E20240118 18:37:10.475020 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 3.019 ms                  | 183.341 ms                |
| ProcessBack:UpdateCache   | 1.600 ms                  | 237.195 ms                |
| ProcessBack:UpsertPq      | 27.581 ms                 | 43.421 ms                 |
| ProcessOneStep            | 35.215 ms                 | 581.223 ms                |
| BlockToStepN              | 13.611 us                 | 20.947 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:10.543020 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:37:11.475014 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=7449
W20240118 18:37:11.579066 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=24, pq.top=24
W20240118 18:37:11.581126 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:37:12.475065 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=8776
W20240118 18:37:12.586277 859972 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240118 18:37:13.128669 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=37, pq.top=37
E20240118 18:37:13.475029 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=12156
W20240118 18:37:13.603808 859972 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:37:14.229101 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=46, pq.top=46
E20240118 18:37:14.475044 859972 parallel_pq_v2.h:76] insert failed, size(hashtable)=89
W20240118 18:37:14.615355 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.580 ms                  | 36.379 ms                 |
| Forward                   | 34.575 ms                 | 49.282 ms                 |
| Backward                  | 45.166 ms                 | 51.279 ms                 |
| Optimize                  | 3.609 ms                  | 8.391 ms                  |
| BarrierTimeBeforeRank0    | 24.476 us                 | 51.029 us                 |
| AfterBackward             | 31.419 ms                 | 50.012 ms                 |
| BlockToStepN              | 109.551 us                | 26.101 ms                 |
| OneStep                   | 119.824 ms                | 163.999 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:15.331140 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=55, pq.top=55
E20240118 18:37:15.475374 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=121
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.721 ms                  | 168.194 ms                |
| ProcessBack:UpdateCache   | 1.532 ms                  | 236.580 ms                |
| ProcessBack:UpsertPq      | 24.479 ms                 | 42.568 ms                 |
| ProcessOneStep            | 30.711 ms                 | 49.984 ms                 |
| BlockToStepN              | 57.578 us                 | 26.042 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:15.638589 859972 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240118 18:37:16.423059 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=64, pq.top=64
E20240118 18:37:16.475015 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=7346
W20240118 18:37:16.668882 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:37:17.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=4790
W20240118 18:37:17.572933 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=73, pq.top=73
W20240118 18:37:17.696136 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:37:18.475021 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=9752
W20240118 18:37:18.641768 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=82, pq.top=82
W20240118 18:37:18.706009 859972 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240118 18:37:19.475010 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=2997
W20240118 18:37:19.730720 859972 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:37:19.829169 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=91, pq.top=91
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.486 ms                  | 37.303 ms                 |
| Forward                   | 34.519 ms                 | 49.282 ms                 |
| Backward                  | 45.152 ms                 | 51.279 ms                 |
| Optimize                  | 3.594 ms                  | 8.391 ms                  |
| BarrierTimeBeforeRank0    | 23.998 us                 | 53.645 us                 |
| AfterBackward             | 31.072 ms                 | 50.012 ms                 |
| BlockToStepN              | 225.860 us                | 29.711 ms                 |
| OneStep                   | 119.824 ms                | 165.147 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:37:20.475010 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=8127
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.683 ms                  | 3.926 ms                  |
| ProcessBack:UpdateCache   | 1.477 ms                  | 4.373 ms                  |
| ProcessBack:UpsertPq      | 24.185 ms                 | 41.653 ms                 |
| ProcessOneStep            | 31.036 ms                 | 49.984 ms                 |
| BlockToStepN              | 154.372 us                | 29.633 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:20.750728 859972 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
[proc 2] 100 steps, total: 14.584, sample: 0.488, forward: 1.254, backward: 1.907, update: 0.397
[proc 1] 100 steps, total: 14.589, sample: 0.517, forward: 1.271, backward: 1.627, update: 0.378
[proc 3] 100 steps, total: 14.586, sample: 0.445, forward: 1.245, backward: 1.918, update: 0.337
-------Step 0-------
tensor([ 8434, 13976, 13567, 11048,  4926,  6931,    88,  2119,  3796, 10473]) tensor([ 1803,   183,  6562, 12003, 10652,   162, 11593,  4606, 13831,  8116])
-------Step 1-------
tensor([ 8434, 13976, 13567, 11048,  4926,  6931,    88,  2119,  3796, 10473]) tensor([ 7721, 11496,  4151, 11473,  2894,  3088,  7461,  2432, 14869,  9825])
-------Step 2-------
tensor([    2, 10791,  8224,   395,   844, 10663,  3511,   144, 10020,   229]) tensor([10504, 10071,  6967,  8668,  3001,  7619,  8301,  6014, 13229, 11821])
-------Step 3-------
tensor([    2, 10791,  8224,   395,   844, 10663,  3511,   144, 10020,   229]) tensor([10229,  5319, 14929, 10675, 13219, 12356, 14274,  3426,  9234,  6029])
-------Step 4-------
tensor([13350,  6287,  5997,  5065,  1896,  4490,  1064, 10994, 10993,   164]) tensor([ 6985,  3408,  9856, 12816,  8033,  6760,    87, 14943,  7795,  5358])
-------Step 5-------
tensor([13350,  6287,  5997,  5065,  1896,  4490,  1064, 10994, 10993,   164]) tensor([ 5341, 10659,  4875, 10131, 10779,  5942, 13570,  4980, 10158,   183])
-------Step 6-------
tensor([ 2329,    17,  3833,   170, 13874,   140,  8932,  5317, 11316,  3496]) tensor([  522, 11454,  6055,   187,  1739,  2641, 10317, 14943,  8720,  6793])
-------Step 7-------
tensor([ 2329,    17,  3833,   170, 13874,   140,  8932,  5317, 11316,  3496]) tensor([ 6372,  7269, 14582,  4945,  6601,  1984,  1797, 13490,  5944,  7136])
-------Step 8-------
tensor([   26,  2021,  1413,  6468,  4172,  5971,  2624,    12, 10925, 11383]) tensor([ 6515,  2359,   101, 12311,  3870,  8793,  3495,  4810,   348,  7716])
-------Step 9-------
tensor([   26,  2021,  1413,  6468,  4172,  5971,  2624,    12, 10925, 11383]) tensor([  360,  1269,  5596,  9332,    83,  1472,  7834, 10299, 11787,  1122])
[proc 0] 100 steps, total: 14.511, sample: 0.546, forward: 1.886, backward: 4.679, update: 0.477
E20240118 18:37:21.475009 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=3559
W20240118 18:37:21.566802 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=105, pq.top=105
W20240118 18:37:21.765750 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:37:22.475016 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10641
W20240118 18:37:22.786600 859972 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240118 18:37:22.997695 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=117, pq.top=117
E20240118 18:37:23.475011 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=2755
W20240118 18:37:23.805968 859972 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240118 18:37:24.128129 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=125, pq.top=125
E20240118 18:37:24.475010 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10820
W20240118 18:37:24.822795 859972 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.501 ms                  | 40.494 ms                 |
| Forward                   | 34.572 ms                 | 49.282 ms                 |
| Backward                  | 45.166 ms                 | 51.279 ms                 |
| Optimize                  | 3.597 ms                  | 9.461 ms                  |
| BarrierTimeBeforeRank0    | 23.897 us                 | 73.994 us                 |
| AfterBackward             | 31.995 ms                 | 50.012 ms                 |
| BlockToStepN              | 270.230 us                | 29.711 ms                 |
| OneStep                   | 120.663 ms                | 171.888 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:37:25.475026 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=13214
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.726 ms                  | 3.838 ms                  |
| ProcessBack:UpdateCache   | 1.469 ms                  | 4.358 ms                  |
| ProcessBack:UpsertPq      | 25.195 ms                 | 42.568 ms                 |
| ProcessOneStep            | 32.012 ms                 | 49.984 ms                 |
| BlockToStepN              | 194.315 us                | 29.633 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:25.853278 859972 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240118 18:37:26.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=11439
W20240118 18:37:26.853403 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:37:27.475011 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=1385
W20240118 18:37:27.860702 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240118 18:37:27.953984 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=152, pq.top=152
E20240118 18:37:28.475010 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=1164
W20240118 18:37:28.890195 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:37:29.475014 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=8657
W20240118 18:37:29.899504 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.517 ms                  | 39.883 ms                 |
| Forward                   | 34.582 ms                 | 39.313 ms                 |
| Backward                  | 45.191 ms                 | 46.294 ms                 |
| Optimize                  | 3.797 ms                  | 9.461 ms                  |
| BarrierTimeBeforeRank0    | 24.224 us                 | 67.250 us                 |
| AfterBackward             | 33.024 ms                 | 50.012 ms                 |
| BlockToStepN              | 465.394 us                | 28.159 ms                 |
| OneStep                   | 125.286 ms                | 174.143 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:37:30.475018 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=7875
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.764 ms                  | 3.873 ms                  |
| ProcessBack:UpdateCache   | 1.488 ms                  | 4.358 ms                  |
| ProcessBack:UpsertPq      | 26.986 ms                 | 43.105 ms                 |
| ProcessOneStep            | 33.049 ms                 | 49.984 ms                 |
| BlockToStepN              | 406.081 us                | 28.084 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:30.902725 859972 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240118 18:37:31.475014 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=1022
W20240118 18:37:31.624861 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=179, pq.top=179
W20240118 18:37:31.918781 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:37:32.475072 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10923
W20240118 18:37:32.775410 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=187, pq.top=187
W20240118 18:37:32.927071 859972 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240118 18:37:33.475031 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=5237
W20240118 18:37:33.858331 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=195, pq.top=195
W20240118 18:37:34.002233 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:37:34.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=6929
[proc 0] 200 steps, total: 13.679, sample: 0.686, forward: 0.677, backward: 4.514, update: 0.506
[proc 3] 200 steps, total: 13.679, sample: 0.540, forward: 0.535, backward: 1.641, update: 0.330
[proc 2] 200 steps, total: 13.679, sample: 0.511, forward: 0.538, backward: 1.625, update: 0.304
[proc 1] 200 steps, total: 13.679, sample: 0.501, forward: 0.604, backward: 1.433, update: 0.377
W20240118 18:37:34.862869 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=202, pq.top=202
W20240118 18:37:35.015770 859972 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.524 ms                  | 40.750 ms                 |
| Forward                   | 34.639 ms                 | 40.048 ms                 |
| Backward                  | 45.217 ms                 | 46.294 ms                 |
| Optimize                  | 3.866 ms                  | 9.461 ms                  |
| BarrierTimeBeforeRank0    | 23.710 us                 | 67.250 us                 |
| AfterBackward             | 35.246 ms                 | 50.012 ms                 |
| BlockToStepN              | 487.133 us                | 28.159 ms                 |
| OneStep                   | 131.884 ms                | 175.736 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:37:35.475010 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.763 ms                  | 3.860 ms                  |
| ProcessBack:UpdateCache   | 1.509 ms                  | 2.893 ms                  |
| ProcessBack:UpsertPq      | 29.213 ms                 | 43.105 ms                 |
| ProcessOneStep            | 35.254 ms                 | 49.984 ms                 |
| BlockToStepN              | 417.319 us                | 28.084 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:35.890858 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=210, pq.top=210
W20240118 18:37:36.021750 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:37:36.475016 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=9108
W20240118 18:37:37.027706 859972 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240118 18:37:37.120112 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=219, pq.top=219
E20240118 18:37:37.475010 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=705
W20240118 18:37:38.030005 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:37:38.138684 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=227, pq.top=227
E20240118 18:37:38.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=9367
W20240118 18:37:39.100693 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:37:39.352811 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=236, pq.top=236
E20240118 18:37:39.475008 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=1634
W20240118 18:37:40.141945 859972 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.486 ms                  | 40.750 ms                 |
| Forward                   | 34.708 ms                 | 40.048 ms                 |
| Backward                  | 45.234 ms                 | 46.294 ms                 |
| Optimize                  | 3.804 ms                  | 9.461 ms                  |
| BarrierTimeBeforeRank0    | 23.524 us                 | 67.250 us                 |
| AfterBackward             | 39.922 ms                 | 50.012 ms                 |
| BlockToStepN              | 505.651 us                | 28.159 ms                 |
| OneStep                   | 130.994 ms                | 175.736 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:40.393626 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=244, pq.top=244
E20240118 18:37:40.475016 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=11275
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.743 ms                  | 3.860 ms                  |
| ProcessBack:UpdateCache   | 1.570 ms                  | 2.809 ms                  |
| ProcessBack:UpsertPq      | 34.194 ms                 | 42.755 ms                 |
| ProcessOneStep            | 40.037 ms                 | 49.984 ms                 |
| BlockToStepN              | 448.145 us                | 28.084 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:41.144620 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:37:41.475257 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=11185
W20240118 18:37:42.196465 859972 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240118 18:37:42.475010 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=3414
W20240118 18:37:42.593964 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=260, pq.top=260
W20240118 18:37:43.198040 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:37:43.475008 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=3286
W20240118 18:37:43.737788 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=268, pq.top=268
W20240118 18:37:44.198891 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:37:44.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=7127
W20240118 18:37:44.835166 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=276, pq.top=276
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.516 ms                  | 40.494 ms                 |
| Forward                   | 34.637 ms                 | 39.313 ms                 |
| Backward                  | 45.253 ms                 | 46.218 ms                 |
| Optimize                  | 3.845 ms                  | 9.377 ms                  |
| BarrierTimeBeforeRank0    | 23.567 us                 | 64.072 us                 |
| AfterBackward             | 40.882 ms                 | 50.012 ms                 |
| BlockToStepN              | 542.232 us                | 26.101 ms                 |
| OneStep                   | 131.861 ms                | 174.143 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:45.284586 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:37:45.475018 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=4466
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.743 ms                  | 3.926 ms                  |
| ProcessBack:UpdateCache   | 1.546 ms                  | 2.735 ms                  |
| ProcessBack:UpsertPq      | 34.704 ms                 | 43.087 ms                 |
| ProcessOneStep            | 40.870 ms                 | 49.984 ms                 |
| BlockToStepN              | 479.053 us                | 26.042 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:46.290917 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:37:46.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=9879
W20240118 18:37:46.540041 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=288, pq.top=288
W20240118 18:37:47.351075 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:37:47.475009 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=109
[proc 1] 300 steps, total: 13.625, sample: 0.476, forward: 0.551, backward: 1.427, update: 0.346
[proc 3] 300 steps, total: 13.625, sample: 0.476, forward: 0.540, backward: 1.611, update: 0.293
[proc 0] 300 steps, total: 13.625, sample: 0.605, forward: 0.666, backward: 4.525, update: 0.466
[proc 2] 300 steps, total: 13.625, sample: 0.497, forward: 0.530, backward: 1.614, update: 0.281
W20240118 18:37:48.355559 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:37:48.475018 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=2560
W20240118 18:37:49.411363 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:37:49.475020 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=8968
W20240118 18:37:49.712476 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=311, pq.top=311
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.576 ms                  | 40.750 ms                 |
| Forward                   | 34.587 ms                 | 39.313 ms                 |
| Backward                  | 45.272 ms                 | 46.218 ms                 |
| Optimize                  | 3.883 ms                  | 9.377 ms                  |
| BarrierTimeBeforeRank0    | 23.567 us                 | 64.072 us                 |
| AfterBackward             | 41.569 ms                 | 50.366 ms                 |
| BlockToStepN              | 571.198 us                | 27.155 ms                 |
| OneStep                   | 132.329 ms                | 175.736 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:50.449041 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240118 18:37:50.475023 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=4858
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.744 ms                  | 4.035 ms                  |
| ProcessBack:UpdateCache   | 1.531 ms                  | 2.735 ms                  |
| ProcessBack:UpsertPq      | 34.847 ms                 | 43.421 ms                 |
| ProcessOneStep            | 41.596 ms                 | 50.330 ms                 |
| BlockToStepN              | 506.675 us                | 27.063 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240118 18:37:51.475018 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10333
W20240118 18:37:51.518828 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240118 18:37:51.970160 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=327, pq.top=327
E20240118 18:37:52.475804 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=6557
W20240118 18:37:52.573172 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:37:53.475009 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10100
W20240118 18:37:53.574438 859972 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240118 18:37:53.660984 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=339, pq.top=339
E20240118 18:37:54.475019 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=6800
W20240118 18:37:54.586560 859972 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.629 ms                  | 40.750 ms                 |
| Forward                   | 34.605 ms                 | 39.313 ms                 |
| Backward                  | 45.283 ms                 | 46.218 ms                 |
| Optimize                  | 3.886 ms                  | 9.377 ms                  |
| BarrierTimeBeforeRank0    | 23.753 us                 | 64.072 us                 |
| AfterBackward             | 43.393 ms                 | 51.011 ms                 |
| BlockToStepN              | 582.782 us                | 27.155 ms                 |
| OneStep                   | 132.814 ms                | 185.525 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:37:55.475008 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=2129
W20240118 18:37:55.499464 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=352, pq.top=352
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.744 ms                  | 4.190 ms                  |
| ProcessBack:UpdateCache   | 1.498 ms                  | 2.709 ms                  |
| ProcessBack:UpsertPq      | 34.871 ms                 | 43.667 ms                 |
| ProcessOneStep            | 43.412 ms                 | 50.432 ms                 |
| BlockToStepN              | 522.480 us                | 26.042 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:37:55.633908 859972 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240118 18:37:56.475045 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=1719
W20240118 18:37:56.673168 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=360, pq.top=360
W20240118 18:37:56.676396 859972 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240118 18:37:57.475009 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=3682
W20240118 18:37:57.718636 859972 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240118 18:37:58.475010 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=423
W20240118 18:37:58.680617 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=375, pq.top=375
W20240118 18:37:58.725121 859972 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240118 18:37:59.475051 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=9842
W20240118 18:37:59.749400 859972 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240118 18:37:59.800837 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=383, pq.top=383
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.690 ms                  | 40.889 ms                 |
| Forward                   | 34.584 ms                 | 38.701 ms                 |
| Backward                  | 45.288 ms                 | 46.169 ms                 |
| Optimize                  | 3.871 ms                  | 9.341 ms                  |
| BarrierTimeBeforeRank0    | 23.621 us                 | 61.324 us                 |
| AfterBackward             | 44.377 ms                 | 50.710 ms                 |
| BlockToStepN              | 597.308 us                | 26.101 ms                 |
| OneStep                   | 132.722 ms                | 189.948 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:38:00.475401 859972 parallel_pq_v2.h:76] insert failed, size(hashtable)=4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.744 ms                  | 4.376 ms                  |
| ProcessBack:UpdateCache   | 1.485 ms                  | 2.632 ms                  |
| ProcessBack:UpsertPq      | 34.900 ms                 | 44.491 ms                 |
| ProcessOneStep            | 44.363 ms                 | 50.664 ms                 |
| BlockToStepN              | 537.760 us                | 26.042 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:38:00.767388 859972 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240118 18:38:00.900846 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=391, pq.top=391
E20240118 18:38:01.475047 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=1996
W20240118 18:38:01.781210 859972 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
[proc 1] 400 steps, total: 13.898, sample: 0.469, forward: 0.547, backward: 1.407, update: 0.296
[proc 2] 400 steps, total: 13.898, sample: 0.531, forward: 0.542, backward: 1.607, update: 0.274
[proc 3] 400 steps, total: 13.898, sample: 0.517, forward: 0.555, backward: 1.610, update: 0.321
[proc 0] 400 steps, total: 13.898, sample: 0.644, forward: 0.621, backward: 4.528, update: 0.426
W20240118 18:38:02.385066 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=402, pq.top=402
E20240118 18:38:02.475028 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10892
W20240118 18:38:02.791610 859972 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240118 18:38:03.475011 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=4037
W20240118 18:38:03.589574 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=410, pq.top=410
W20240118 18:38:03.802479 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:38:04.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10299
W20240118 18:38:04.822141 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:38:04.927464 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=420, pq.top=420
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.703 ms                  | 40.889 ms                 |
| Forward                   | 34.582 ms                 | 38.701 ms                 |
| Backward                  | 45.301 ms                 | 46.169 ms                 |
| Optimize                  | 3.866 ms                  | 9.341 ms                  |
| BarrierTimeBeforeRank0    | 23.652 us                 | 61.324 us                 |
| AfterBackward             | 44.509 ms                 | 50.710 ms                 |
| BlockToStepN              | 615.346 us                | 28.159 ms                 |
| OneStep                   | 132.868 ms                | 194.625 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:38:05.475018 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=11893
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.745 ms                  | 4.460 ms                  |
| ProcessBack:UpdateCache   | 1.481 ms                  | 2.632 ms                  |
| ProcessBack:UpsertPq      | 34.945 ms                 | 44.529 ms                 |
| ProcessOneStep            | 44.571 ms                 | 50.664 ms                 |
| BlockToStepN              | 551.387 us                | 28.084 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:38:05.838914 859972 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240118 18:38:06.360371 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=430, pq.top=430
E20240118 18:38:06.475009 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=1508
W20240118 18:38:06.852830 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240118 18:38:07.475024 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=11816
W20240118 18:38:07.506003 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=439, pq.top=439
W20240118 18:38:07.877161 859972 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240118 18:38:08.475013 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=6775
W20240118 18:38:08.678782 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=448, pq.top=448
W20240118 18:38:08.886636 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240118 18:38:09.475011 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=7310
W20240118 18:38:09.793861 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=456, pq.top=456
W20240118 18:38:09.919277 859972 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.703 ms                  | 41.516 ms                 |
| Forward                   | 34.605 ms                 | 38.480 ms                 |
| Backward                  | 45.309 ms                 | 46.010 ms                 |
| Optimize                  | 3.861 ms                  | 9.187 ms                  |
| BarrierTimeBeforeRank0    | 23.710 us                 | 57.607 us                 |
| AfterBackward             | 44.067 ms                 | 50.583 ms                 |
| BlockToStepN              | 633.355 us                | 28.159 ms                 |
| OneStep                   | 132.679 ms                | 194.625 ms                |
+---------------------------+---------------------------+---------------------------+
E20240118 18:38:10.475025 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=8603
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.745 ms                  | 4.509 ms                  |
| ProcessBack:UpdateCache   | 1.464 ms                  | 2.629 ms                  |
| ProcessBack:UpsertPq      | 34.586 ms                 | 44.491 ms                 |
| ProcessOneStep            | 43.924 ms                 | 50.542 ms                 |
| BlockToStepN              | 567.745 us                | 28.084 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240118 18:38:10.958773 859972 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240118 18:38:11.475010 859410 parallel_pq_v2.h:76] insert failed, size(hashtable)=1618
W20240118 18:38:11.813438 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=471, pq.top=471
W20240118 18:38:12.001426 859972 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240118 18:38:12.475011 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=10075
W20240118 18:38:13.019400 859972 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240118 18:38:13.329349 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=482, pq.top=482
E20240118 18:38:13.475011 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=3797
W20240118 18:38:14.021728 859972 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240118 18:38:14.475008 859971 parallel_pq_v2.h:76] insert failed, size(hashtable)=5825
W20240118 18:38:15.039273 859972 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.711 ms                  | 41.516 ms                 |
| Forward                   | 34.605 ms                 | 38.480 ms                 |
| Backward                  | 45.318 ms                 | 46.109 ms                 |
| Optimize                  | 3.866 ms                  | 9.187 ms                  |
| BarrierTimeBeforeRank0    | 23.710 us                 | 61.324 us                 |
| AfterBackward             | 44.178 ms                 | 51.011 ms                 |
| BlockToStepN              | 651.834 us                | 28.159 ms                 |
| OneStep                   | 132.680 ms                | 194.625 ms                |
+---------------------------+---------------------------+---------------------------+
W20240118 18:38:15.216732 859410 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=496, pq.top=496
E20240118 18:38:15.475011 859746 parallel_pq_v2.h:76] insert failed, size(hashtable)=873
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.746 ms                  | 4.530 ms                  |
| ProcessBack:UpdateCache   | 1.459 ms                  | 2.608 ms                  |
| ProcessBack:UpsertPq      | 34.621 ms                 | 44.532 ms                 |
| ProcessOneStep            | 43.924 ms                 | 50.951 ms                 |
| BlockToStepN              | 585.839 us                | 28.084 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 13.620, sample: 0.529, forward: 0.537, backward: 1.604, update: 0.305
[proc 1] 500 steps, total: 13.620, sample: 0.485, forward: 0.540, backward: 1.397, update: 0.293
[proc 3] 500 steps, total: 13.620, sample: 0.547, forward: 0.553, backward: 1.617, update: 0.330
[proc 0] 500 steps, total: 13.620, sample: 0.662, forward: 0.615, backward: 4.529, update: 0.396
before call kg_cache_controller.StopThreads()
W20240118 18:38:15.734197 859410 grad_async_v2.h:71] call StopThreads. PID = 859083
W20240118 18:38:15.734230 859410 grad_base.h:210] before processOneStepNegThread_.join();
W20240118 18:38:15.734510 859410 grad_base.h:212] after processOneStepNegThread_.join();
W20240118 18:38:15.734519 859410 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240118 18:38:15.738556 859410 grad_async_v2.h:91] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f46ce447c10>
Successfully xmh. training takes 69.33780193328857 seconds
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

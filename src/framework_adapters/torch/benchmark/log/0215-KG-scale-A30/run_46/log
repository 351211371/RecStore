WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240218 07:44:14.748457 1759137 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_21', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1759137 sampler.py:454] Start PreSampling
WARNING [1759137 sampler.py:532] Before construct renumbering_dict
WARNING [1759137 sampler.py:555] PreSampling done
W20240218 07:44:17.068737 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240218 07:44:17.068872 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240218 07:44:17.068898 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240218 07:44:17.068918 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240218 07:44:17.068936 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240218 07:44:17.068951 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240218 07:44:17.068969 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240218 07:44:17.068989 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240218 07:44:17.069011 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240218 07:44:17.069029 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240218 07:44:17.069057 1759137 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240218 07:44:17.069077 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240218 07:44:17.069095 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240218 07:44:17.069175 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240218 07:44:17.069197 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240218 07:44:17.069213 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240218 07:44:17.069239 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240218 07:44:17.069257 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240218 07:44:17.069272 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240218 07:44:17.069285 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240218 07:44:17.069304 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240218 07:44:17.069321 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240218 07:44:17.069337 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240218 07:44:17.069355 1759137 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240218 07:44:17.069368 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240218 07:44:17.069383 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240218 07:44:17.069414 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240218 07:44:17.069432 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240218 07:44:17.069449 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240218 07:44:17.069465 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240218 07:44:17.069483 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240218 07:44:17.069504 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240218 07:44:17.069518 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240218 07:44:17.069537 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240218 07:44:17.069556 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240218 07:44:17.069571 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240218 07:44:17.069586 1759137 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240218 07:44:17.069599 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240218 07:44:17.069612 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240218 07:44:17.069643 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240218 07:44:17.069662 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240218 07:44:17.069676 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240218 07:44:17.069690 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240218 07:44:17.069710 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240218 07:44:17.069726 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240218 07:44:17.069741 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240218 07:44:17.069766 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240218 07:44:17.069788 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240218 07:44:17.069810 1759137 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240218 07:44:17.069825 1759137 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240218 07:44:17.069839 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240218 07:44:17.069854 1759137 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240218 07:44:17.199348 1759137 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240218 07:44:17.230173 1759137 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10022, num_edges=153684,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11359, num_edges=176198,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=11844, num_edges=177602,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10231, num_edges=261634,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10022 N 153684 E
MertisPartition: part 1 has 11359 N 176198 E
MertisPartition: part 2 has 11844 N 177602 E
MertisPartition: part 3 has 10231 N 261634 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    6,    10,    11,  ...,  3593, 10253,  2942]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 1, 1])}
After renumbering graph:  {'_ID': tensor([  941,  1066,  1110,  ...,  9064, 13873,  4355]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 1, 1])}
part_g: DGLGraph(num_nodes=10022, num_edges=153684,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10022, num_edges=153684,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.503 seconds
[Rank1] pid = 1759465
[Rank2] pid = 1759529
INFO [1759137 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [1759465 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [1759594 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [1759594 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1759529 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [1759529 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240218 07:44:21.589555 1759631 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240218 07:44:21.589879 1759531 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240218 07:44:21.596243 1759631 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100014876000 7.629 MB
W20240218 07:44:21.596400 1759631 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x10001501b000 7.629 MB
W20240218 07:44:21.596469 1759631 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000157be000 1.49 GB
W20240218 07:44:21.596511 1759531 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x100074da1000 7.629 MB
W20240218 07:44:21.596539 1759631 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x100075544000 1.49 GB
W20240218 07:44:21.596594 1759631 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240218 07:44:21.596662 1759531 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1000d4b27000 7.629 MB
W20240218 07:44:21.596719 1759531 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1000d52ca000 1.49 GB
W20240218 07:44:21.596757 1759531 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1001348ad000 1.49 GB
W20240218 07:44:21.596791 1759531 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
INFO [1759465 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1759137 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240218 07:44:21.598753 1759466 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240218 07:44:21.599084 1759596 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240218 07:44:21.602010 1759531 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240218 07:44:21.602226 1759466 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x100193e94000 7.629 MB
W20240218 07:44:21.602356 1759466 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100194637000 7.629 MB
W20240218 07:44:21.602416 1759466 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x100194dda000 1.49 GB
W20240218 07:44:21.602461 1759466 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001f43bd000 1.49 GB
W20240218 07:44:21.602506 1759466 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240218 07:44:21.604130 1759596 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1002539a2000 7.629 MB
W20240218 07:44:21.604293 1759596 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100254145000 7.629 MB
W20240218 07:44:21.604382 1759596 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1002548e8000 1.49 GB
W20240218 07:44:21.604440 1759596 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1002b3ecb000 1.49 GB
W20240218 07:44:21.604538 1759596 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240218 07:44:21.615840 1759466 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240218 07:44:21.615936 1759596 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240218 07:44:21.615973 1759631 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [1759594 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 1759594
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [1759137 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [1759529 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [1759465 DistTensor.py:59] The tensor name already exists in the kvstore
I20240218 07:44:22.812371 1759466 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240218 07:44:22.812407 1759531 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240218 07:44:22.812441 1759631 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240218 07:44:22.812479 1759596 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240218 07:44:23.183032 1759631 recstore.cc:67] init folly done
E20240218 07:44:23.183071 1759596 recstore.cc:67] init folly done
E20240218 07:44:23.183179 1759466 recstore.cc:67] init folly done
E20240218 07:44:23.183349 1759531 recstore.cc:67] init folly done
I20240218 07:44:23.226486 1759631 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240218 07:44:23.258677 1759531 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240218 07:44:23.261600 1759596 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240218 07:44:23.261776 1759466 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 787.556 us                | 787.556 us                |
| Forward                   | 780.994 ms                | 780.994 ms                |
| back: bucket keys         | 22.739 ms                 | 22.739 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.838 ms                  | 26.048 ms                 |
| Forward                   | 6.996 ms                  | 780.994 ms                |
| back: bucket keys         | 183.582 us                | 246.286 us                |
| back: a2a                 | 2.850 ms                  | 4.701 ms                  |
| back: cache               | 1.539 ms                  | 1.771 ms                  |
| back: aggr dram keys      | 23.742 ms                 | 29.827 ms                 |
| back: set dram grad       | 952.959 us                | 3.288 ms                  |
| Backward                  | 61.564 ms                 | 5.543 s                   |
| Optimize                  | 15.028 ms                 | 54.414 ms                 |
| BarrierTimeBeforeRank0    | 67.722 us                 | 148.149 us                |
| BlockToStepN              | 19.035 us                 | 29.295 us                 |
| OneStep                   | 87.409 ms                 | 6.381 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.842 ms                  | 26.048 ms                 |
| Forward                   | 7.011 ms                  | 11.673 ms                 |
| back: bucket keys         | 185.251 us                | 247.955 us                |
| back: a2a                 | 2.803 ms                  | 4.701 ms                  |
| back: cache               | 1.480 ms                  | 1.870 ms                  |
| back: aggr dram keys      | 22.969 ms                 | 27.737 ms                 |
| back: set dram grad       | 941.753 us                | 3.350 ms                  |
| Backward                  | 59.892 ms                 | 76.419 ms                 |
| Optimize                  | 15.160 ms                 | 34.945 ms                 |
| BarrierTimeBeforeRank0    | 62.458 us                 | 118.651 us                |
| BlockToStepN              | 22.758 us                 | 35.750 us                 |
| OneStep                   | 85.743 ms                 | 109.832 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
-------Step 0-------
tensor([2377, 1980, 4171,  842,    1, 9102, 1826, 1012,  180, 8123]) tensor([1110, 9575, 1622, 3782, 4472, 8709, 4423,  966,  912, 9268])
-------Step 1-------
tensor([2377, 1980, 4171,  842,    1, 9102, 1826, 1012,  180, 8123]) tensor([ 7250,   369,  9853,  9734,  7274, 12762,  6184,  3281, 12993, 14221])
-------Step 2-------
tensor([ 5580,    12,    27,   115, 14891, 13675,     7,    60,   144,   756]) tensor([ 4565,  6925, 13870, 11321, 11558,  8374,  4917, 13438, 13179,  9003])
-------Step 3-------
tensor([ 5580,    12,    27,   115, 14891, 13675,     7,    60,   144,   756]) tensor([ 2640,  7211, 12588,  2418,  4883,  6305, 10251, 11940,  7110, 14050])
-------Step 4-------
tensor([ 3841,  4000, 13788,  4830, 10311,    89, 13474,  6738, 12823,  1036]) tensor([ 6317,  6010, 13550,  6728, 10365,  3231,  8752,  4248,  3935,  1719])
-------Step 5-------
tensor([ 3841,  4000, 13788,  4830, 10311,    89, 13474,  6738, 12823,  1036]) tensor([ 1186,  5197,  3381, 13699,  6987, 14336,  9791,  9559,  4265,   572])
-------Step 6-------
tensor([14126,     3,  5183,  4943,  2416,  5806,    41,  3957,   742,  5484]) tensor([ 4259,  6279, 11581,  7713,  2732,  7578, 14013,  6587,   512,  4156])
-------Step 7-------
tensor([14126,     3,  5183,  4943,  2416,  5806,    41,  3957,   742,  5484]) tensor([ 5137,  7058,  1005,  5928,  5714,  3997,   861, 13617,  8387,  8058])
-------Step 8-------
tensor([ 4968,  1647,     2,   166,   115, 13106,  1511,  1980, 10428,  8767]) tensor([14698, 10103,  9972,  8019,  9850, 14832,  7748, 12673,  6126, 12903])
-------Step 9-------
tensor([ 4968,  1647,     2,   166,   115, 13106,  1511,  1980, 10428,  8767]) tensor([ 4679, 12169,   373,  2220, 13746,  8805,    87,  3281,  4354,    99])
before start barrier
start train
[proc 0] 100 steps, total: 14.931, sample: 0.448, forward: 1.438, backward: 11.240, update: 1.675
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 14.966, sample: 0.164, forward: 1.020, backward: 11.117, update: 0.141
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 14.934, sample: 0.356, forward: 1.275, backward: 10.346, update: 0.232
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 14.930, sample: 0.378, forward: 1.296, backward: 10.441, update: 0.219
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.845 ms                  | 26.352 ms                 |
| Forward                   | 7.033 ms                  | 10.785 ms                 |
| back: bucket keys         | 185.251 us                | 246.286 us                |
| back: a2a                 | 2.798 ms                  | 4.701 ms                  |
| back: cache               | 1.516 ms                  | 1.895 ms                  |
| back: aggr dram keys      | 21.884 ms                 | 27.737 ms                 |
| back: set dram grad       | 936.031 us                | 3.366 ms                  |
| Backward                  | 57.339 ms                 | 69.192 ms                 |
| Optimize                  | 15.154 ms                 | 29.594 ms                 |
| BarrierTimeBeforeRank0    | 62.428 us                 | 114.343 us                |
| BlockToStepN              | 23.915 us                 | 41.815 us                 |
| OneStep                   | 84.390 ms                 | 109.832 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 8.519, sample: 0.512, forward: 0.674, backward: 5.585, update: 1.603
[proc 2] 200 steps, total: 8.519, sample: 0.472, forward: 0.593, backward: 4.869, update: 0.215
[proc 3] 200 steps, total: 8.519, sample: 0.459, forward: 0.580, backward: 4.859, update: 0.202
[proc 1] 200 steps, total: 8.519, sample: 0.462, forward: 0.586, backward: 4.882, update: 0.200
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.847 ms                  | 26.390 ms                 |
| Forward                   | 7.067 ms                  | 11.038 ms                 |
| back: bucket keys         | 185.966 us                | 246.286 us                |
| back: a2a                 | 2.803 ms                  | 4.591 ms                  |
| back: cache               | 1.516 ms                  | 1.950 ms                  |
| back: aggr dram keys      | 21.134 ms                 | 27.359 ms                 |
| back: set dram grad       | 940.323 us                | 3.366 ms                  |
| Backward                  | 56.214 ms                 | 69.192 ms                 |
| Optimize                  | 15.142 ms                 | 29.594 ms                 |
| BarrierTimeBeforeRank0    | 62.704 us                 | 114.343 us                |
| BlockToStepN              | 25.380 us                 | 46.200 us                 |
| OneStep                   | 83.776 ms                 | 109.832 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.847 ms                  | 28.491 ms                 |
| Forward                   | 7.068 ms                  | 10.793 ms                 |
| back: bucket keys         | 187.874 us                | 243.664 us                |
| back: a2a                 | 2.803 ms                  | 4.486 ms                  |
| back: cache               | 1.513 ms                  | 1.895 ms                  |
| back: aggr dram keys      | 20.880 ms                 | 27.359 ms                 |
| back: set dram grad       | 946.999 us                | 4.202 ms                  |
| Backward                  | 55.969 ms                 | 69.192 ms                 |
| Optimize                  | 15.141 ms                 | 29.260 ms                 |
| BarrierTimeBeforeRank0    | 62.704 us                 | 110.933 us                |
| BlockToStepN              | 25.457 us                 | 46.935 us                 |
| OneStep                   | 83.402 ms                 | 116.451 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 8.604, sample: 0.445, forward: 0.580, backward: 4.971, update: 0.205
[proc 2] 300 steps, total: 8.604, sample: 0.419, forward: 0.586, backward: 4.961, update: 0.212
[proc 0] 300 steps, total: 8.605, sample: 0.481, forward: 0.672, backward: 5.711, update: 1.597
[proc 3] 300 steps, total: 8.605, sample: 0.422, forward: 0.571, backward: 4.990, update: 0.199
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.847 ms                  | 28.491 ms                 |
| Forward                   | 7.067 ms                  | 10.848 ms                 |
| back: bucket keys         | 185.728 us                | 243.664 us                |
| back: a2a                 | 2.810 ms                  | 19.719 ms                 |
| back: cache               | 1.513 ms                  | 1.934 ms                  |
| back: aggr dram keys      | 20.919 ms                 | 27.732 ms                 |
| back: set dram grad       | 940.800 us                | 3.532 ms                  |
| Backward                  | 56.148 ms                 | 78.471 ms                 |
| Optimize                  | 15.131 ms                 | 29.594 ms                 |
| BarrierTimeBeforeRank0    | 62.625 us                 | 110.933 us                |
| BlockToStepN              | 25.700 us                 | 46.935 us                 |
| OneStep                   | 83.496 ms                 | 116.565 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.848 ms                  | 26.637 ms                 |
| Forward                   | 7.067 ms                  | 10.793 ms                 |
| back: bucket keys         | 184.298 us                | 241.756 us                |
| back: a2a                 | 2.830 ms                  | 24.238 ms                 |
| back: cache               | 1.489 ms                  | 1.895 ms                  |
| back: aggr dram keys      | 21.680 ms                 | 29.325 ms                 |
| back: set dram grad       | 939.608 us                | 3.487 ms                  |
| Backward                  | 57.339 ms                 | 85.751 ms                 |
| Optimize                  | 15.128 ms                 | 29.594 ms                 |
| BarrierTimeBeforeRank0    | 62.852 us                 | 108.599 us                |
| BlockToStepN              | 25.865 us                 | 57.520 us                 |
| OneStep                   | 84.745 ms                 | 116.814 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 9.417, sample: 0.463, forward: 0.669, backward: 6.582, update: 1.560
[proc 2] 400 steps, total: 9.417, sample: 0.434, forward: 0.549, backward: 5.525, update: 0.195
[proc 1] 400 steps, total: 9.417, sample: 0.427, forward: 0.585, backward: 5.894, update: 0.193
[proc 3] 400 steps, total: 9.417, sample: 0.416, forward: 0.570, backward: 5.608, update: 0.192
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.848 ms                  | 28.491 ms                 |
| Forward                   | 7.067 ms                  | 10.793 ms                 |
| back: bucket keys         | 183.821 us                | 241.041 us                |
| back: a2a                 | 2.842 ms                  | 24.650 ms                 |
| back: cache               | 1.482 ms                  | 1.963 ms                  |
| back: aggr dram keys      | 21.985 ms                 | 29.325 ms                 |
| back: set dram grad       | 936.747 us                | 3.427 ms                  |
| Backward                  | 58.863 ms                 | 86.749 ms                 |
| Optimize                  | 15.122 ms                 | 29.893 ms                 |
| BarrierTimeBeforeRank0    | 62.870 us                 | 108.599 us                |
| BlockToStepN              | 25.980 us                 | 59.197 us                 |
| OneStep                   | 85.463 ms                 | 117.013 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.849 ms                  | 26.637 ms                 |
| Forward                   | 7.067 ms                  | 10.785 ms                 |
| back: bucket keys         | 183.344 us                | 240.564 us                |
| back: a2a                 | 2.835 ms                  | 24.751 ms                 |
| back: cache               | 1.480 ms                  | 1.966 ms                  |
| back: aggr dram keys      | 21.705 ms                 | 29.325 ms                 |
| back: set dram grad       | 935.555 us                | 3.446 ms                  |
| Backward                  | 58.168 ms                 | 86.939 ms                 |
| Optimize                  | 15.125 ms                 | 30.039 ms                 |
| BarrierTimeBeforeRank0    | 62.870 us                 | 105.811 us                |
| BlockToStepN              | 25.981 us                 | 59.197 us                 |
| OneStep                   | 85.286 ms                 | 117.013 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 500 steps, total: 8.968, sample: 0.441, forward: 0.667, backward: 6.087, update: 1.631
Successfully xmh. training takes 50.44001317024231 seconds
before call kg_cache_controller.StopThreads()
[proc 2] 500 steps, total: 8.968, sample: 0.420, forward: 0.570, backward: 5.257, update: 0.202
[proc 3] 500 steps, total: 8.968, sample: 0.428, forward: 0.549, backward: 5.345, update: 0.189
[proc 1] 500 steps, total: 8.968, sample: 0.418, forward: 0.571, backward: 5.330, update: 0.196
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
INFO [1759137 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

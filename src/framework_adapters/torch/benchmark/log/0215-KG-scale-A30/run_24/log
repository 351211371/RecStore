WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240218 02:24:21.095865 1433371 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_24', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1433371 sampler.py:454] Start PreSampling
WARNING [1433371 sampler.py:532] Before construct renumbering_dict
WARNING [1433371 sampler.py:555] PreSampling done
W20240218 02:24:23.363281 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240218 02:24:23.363408 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240218 02:24:23.363432 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240218 02:24:23.363447 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240218 02:24:23.363467 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240218 02:24:23.363482 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240218 02:24:23.363497 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240218 02:24:23.363517 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240218 02:24:23.363533 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240218 02:24:23.363550 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240218 02:24:23.363574 1433371 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240218 02:24:23.363592 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240218 02:24:23.363605 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240218 02:24:23.363678 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240218 02:24:23.363698 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240218 02:24:23.363713 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240218 02:24:23.363749 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240218 02:24:23.363765 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240218 02:24:23.363782 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240218 02:24:23.363796 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240218 02:24:23.363813 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240218 02:24:23.363837 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240218 02:24:23.363858 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240218 02:24:23.363879 1433371 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240218 02:24:23.363893 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240218 02:24:23.363905 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240218 02:24:23.363940 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240218 02:24:23.363960 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240218 02:24:23.363976 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240218 02:24:23.363996 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240218 02:24:23.364010 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240218 02:24:23.364030 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240218 02:24:23.364051 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240218 02:24:23.364066 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240218 02:24:23.364079 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240218 02:24:23.364096 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240218 02:24:23.364113 1433371 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240218 02:24:23.364126 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240218 02:24:23.364138 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240218 02:24:23.364167 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240218 02:24:23.364189 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240218 02:24:23.364204 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240218 02:24:23.364223 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240218 02:24:23.364236 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240218 02:24:23.364256 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240218 02:24:23.364270 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240218 02:24:23.364292 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240218 02:24:23.364307 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240218 02:24:23.364321 1433371 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240218 02:24:23.364339 1433371 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240218 02:24:23.364351 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240218 02:24:23.364368 1433371 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240218 02:24:23.492250 1433371 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240218 02:24:23.519338 1433371 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10022, num_edges=153684,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11359, num_edges=176198,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=11844, num_edges=177602,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10231, num_edges=261634,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10022 N 153684 E
MertisPartition: part 1 has 11359 N 176198 E
MertisPartition: part 2 has 11844 N 177602 E
MertisPartition: part 3 has 10231 N 261634 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    6,    10,    11,  ...,  3593, 10253,  2942]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 1, 1])}
After renumbering graph:  {'_ID': tensor([  907,  1011,  1038,  ...,  9889, 12989,  4499]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 1, 1])}
part_g: DGLGraph(num_nodes=10022, num_edges=153684,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10022, num_edges=153684,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.453 seconds
[Rank1] pid = 1433705
[Rank2] pid = 1433769
INFO [1433371 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [1433705 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [1433770 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [1433770 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1433769 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [1433371 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1433769 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1433705 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [1433705 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [1433770 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [1433371 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [1433769 DistTensor.py:59] The tensor name already exists in the kvstore
I20240218 02:24:31.980094 1433829 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240218 02:24:31.980182 1433828 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240218 02:24:31.980229 1433771 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240218 02:24:31.980340 1433706 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240218 02:24:32.352612 1433771 recstore.cc:67] init folly done
E20240218 02:24:32.352632 1433706 recstore.cc:67] init folly done
E20240218 02:24:32.352625 1433829 recstore.cc:67] init folly done
E20240218 02:24:32.352633 1433828 recstore.cc:67] init folly done
I20240218 02:24:32.396136 1433771 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240218 02:24:32.412359 1433706 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240218 02:24:32.417944 1433829 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240218 02:24:32.429952 1433828 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 536.509 us                | 536.509 us                |
| bucket keys               | 906.229 us                | 127.423 ms                |
| forward: a2a keys         | 15.917 ms                 | 3.564 s                   |
| forward: search cache     | 162.601 us                | 20.703 ms                 |
| forward: a2a values       | 1.150 ms                  | 12.761 ms                 |
| forward: software         | 405.550 us                | 673.056 us                |
| forward: join             | 1.876 ms                  | 2.426 ms                  |
| Forward                   | 4.375 s                   | 4.375 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.782 ms                  | 26.095 ms                 |
| bucket keys               | 2.390 ms                  | 127.423 ms                |
| forward: a2a keys         | 2.328 ms                  | 3.564 s                   |
| forward: search cache     | 513.315 us                | 20.703 ms                 |
| forward: a2a values       | 2.467 ms                  | 12.761 ms                 |
| forward: software         | 768.661 us                | 821.352 us                |
| forward: join             | 2.732 ms                  | 3.030 ms                  |
| Forward                   | 28.596 ms                 | 4.375 s                   |
| back: aggr dram keys      | 23.734 ms                 | 2.864 s                   |
| back: set dram grad       | 1.604 ms                  | 3.389 ms                  |
| back: a2a grad            | 2.822 ms                  | 4.403 ms                  |
| back: grad sum & grad cache  | 1.128 ms                  | 1.771 ms                  |
| Backward                  | 60.552 ms                 | 3.260 s                   |
| Optimize                  | 13.316 ms                 | 18.749 ms                 |
| BarrierTimeBeforeRank0    | 69.186 us                 | 99.619 us                 |
| BlockToStepN              | 26.110 us                 | 60.865 us                 |
| OneStep                   | 105.248 ms                | 7.651 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.824 ms                  | 26.282 ms                 |
| bucket keys               | 2.393 ms                  | 2.700 ms                  |
| forward: a2a keys         | 2.183 ms                  | 15.917 ms                 |
| forward: search cache     | 513.315 us                | 565.529 us                |
| forward: a2a values       | 2.609 ms                  | 3.019 ms                  |
| forward: software         | 784.874 us                | 853.539 us                |
| forward: join             | 2.756 ms                  | 3.052 ms                  |
| Forward                   | 28.392 ms                 | 30.471 ms                 |
| back: aggr dram keys      | 23.698 ms                 | 78.499 ms                 |
| back: set dram grad       | 1.567 ms                  | 3.295 ms                  |
| back: a2a grad            | 2.841 ms                  | 3.382 ms                  |
| back: grad sum & grad cache  | 1.128 ms                  | 1.708 ms                  |
| Backward                  | 60.552 ms                 | 121.685 ms                |
| Optimize                  | 13.421 ms                 | 21.880 ms                 |
| BarrierTimeBeforeRank0    | 61.390 us                 | 99.619 us                 |
| BlockToStepN              | 26.190 us                 | 50.416 us                 |
| OneStep                   | 105.966 ms                | 152.079 ms                |
+---------------------------+---------------------------+---------------------------+
[Rank3] pid = 1433770
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
train_sampler.Prefill()
-------Step 0-------
tensor([2459, 2140, 3929,  865,    1, 9677, 1763, 1049,   83, 8826]) tensor([ 1038, 10147,  1484,  3874,  4307,  8209,  5263,   948,   953, 10120])
-------Step 1-------
tensor([2459, 2140, 3929,  865,    1, 9677, 1763, 1049,   83, 8826]) tensor([ 7382,   363, 10264,  9559,  7722, 13498,  6010,  3154, 14019, 13750])
-------Step 2-------
tensor([ 5403,     8,   123,   180, 14949, 11452,    41,    50,   126,   752]) tensor([ 4808,  6072, 13632, 10406, 11686,  8904,  4774, 11138, 14791,  9671])
-------Step 3-------
tensor([ 5403,     8,   123,   180, 14949, 11452,    41,    50,   126,   752]) tensor([ 2741,  6878, 13980,  2452,  5845,  6073, 10730, 12335,  7304, 13810])
-------Step 4-------
tensor([ 4030,  4253, 13323,  5061,  9753,     7, 14407,  6802, 12994,  1043]) tensor([ 4843,  6191, 14759,  6739, 11415,  2993,  8635,  4410,  3589,  1699])
-------Step 5-------
tensor([ 4030,  4253, 13323,  5061,  9753,     7, 14407,  6802, 12994,  1043]) tensor([ 1136,  5333,  3643, 13173,  6660, 14379,  9621, 10766,  4027,   561])
-------Step 6-------
tensor([12135,     3,  4876,  4513,  2728,  5874,   152,  3060,   743,  6015]) tensor([ 4524,  5932, 10795,  7963,  2455,  8076, 14613,  6643,   526,  4015])
-------Step 7-------
tensor([12135,     3,  4876,  4513,  2728,  5874,   152,  3060,   743,  6015]) tensor([ 5248,  7482,  1027,  6306,  6142,  4073,   836, 13437,  8279,  8861])
-------Step 8-------
tensor([ 5085,  1558,     2,   111,   180, 13614,  1534,  2140,  9389,  8270]) tensor([14873, 10188,  9599,  8823,  9448, 12781,  7269, 13640,  7430, 13066])
-------Step 9-------
tensor([ 5085,  1558,     2,   111,   180, 13614,  1534,  2140,  9389,  8270]) tensor([ 4782, 12818,   386,  2438, 13432,  8878,   142,  3154,  4549,    73])
before start barrier
start train
[proc 0] 100 steps, total: 18.488, sample: 0.465, forward: 7.145, backward: 9.361, update: 1.351
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 18.472, sample: 0.473, forward: 7.166, backward: 9.291, update: 0.216
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 18.454, sample: 0.459, forward: 7.108, backward: 9.340, update: 0.211
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 18.466, sample: 0.471, forward: 7.115, backward: 9.318, update: 0.209
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.825 ms                  | 26.339 ms                 |
| bucket keys               | 2.392 ms                  | 2.691 ms                  |
| forward: a2a keys         | 2.173 ms                  | 11.250 ms                 |
| forward: search cache     | 511.169 us                | 566.959 us                |
| forward: a2a values       | 2.625 ms                  | 3.221 ms                  |
| forward: software         | 785.828 us                | 848.532 us                |
| forward: join             | 2.747 ms                  | 3.048 ms                  |
| Forward                   | 28.296 ms                 | 32.051 ms                 |
| back: aggr dram keys      | 23.734 ms                 | 29.355 ms                 |
| back: set dram grad       | 1.550 ms                  | 3.284 ms                  |
| back: a2a grad            | 2.839 ms                  | 3.382 ms                  |
| back: grad sum & grad cache  | 1.564 ms                  | 1.744 ms                  |
| Backward                  | 60.527 ms                 | 121.685 ms                |
| Optimize                  | 13.375 ms                 | 21.880 ms                 |
| BarrierTimeBeforeRank0    | 60.145 us                 | 99.619 us                 |
| BlockToStepN              | 26.190 us                 | 50.416 us                 |
| OneStep                   | 105.158 ms                | 152.079 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.822 ms                  | 26.341 ms                 |
| bucket keys               | 2.392 ms                  | 2.700 ms                  |
| forward: a2a keys         | 2.192 ms                  | 9.575 ms                  |
| forward: search cache     | 511.885 us                | 565.529 us                |
| forward: a2a values       | 2.637 ms                  | 3.019 ms                  |
| forward: software         | 789.165 us                | 853.539 us                |
| forward: join             | 2.747 ms                  | 3.078 ms                  |
| Forward                   | 28.358 ms                 | 32.370 ms                 |
| back: aggr dram keys      | 23.867 ms                 | 28.759 ms                 |
| back: set dram grad       | 1.554 ms                  | 3.284 ms                  |
| back: a2a grad            | 2.823 ms                  | 3.270 ms                  |
| back: grad sum & grad cache  | 1.564 ms                  | 1.744 ms                  |
| Backward                  | 60.569 ms                 | 66.757 ms                 |
| Optimize                  | 13.387 ms                 | 21.950 ms                 |
| BarrierTimeBeforeRank0    | 59.868 us                 | 97.690 us                 |
| BlockToStepN              | 26.463 us                 | 60.865 us                 |
| OneStep                   | 105.532 ms                | 134.233 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 10.928, sample: 0.501, forward: 2.798, backward: 6.188, update: 1.305
[proc 1] 200 steps, total: 10.928, sample: 0.505, forward: 2.786, backward: 6.153, update: 0.212
[proc 2] 200 steps, total: 10.928, sample: 0.503, forward: 2.773, backward: 6.154, update: 0.208
[proc 3] 200 steps, total: 10.928, sample: 0.517, forward: 2.764, backward: 6.133, update: 0.211
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.820 ms                  | 26.373 ms                 |
| bucket keys               | 2.392 ms                  | 2.697 ms                  |
| forward: a2a keys         | 2.213 ms                  | 7.019 ms                  |
| forward: search cache     | 512.362 us                | 566.959 us                |
| forward: a2a values       | 2.630 ms                  | 3.006 ms                  |
| forward: software         | 787.497 us                | 853.539 us                |
| forward: join             | 2.751 ms                  | 3.097 ms                  |
| Forward                   | 28.416 ms                 | 32.370 ms                 |
| back: aggr dram keys      | 23.942 ms                 | 29.324 ms                 |
| back: set dram grad       | 1.552 ms                  | 3.318 ms                  |
| back: a2a grad            | 2.822 ms                  | 3.247 ms                  |
| back: grad sum & grad cache  | 1.580 ms                  | 1.907 ms                  |
| Backward                  | 60.938 ms                 | 73.373 ms                 |
| Optimize                  | 13.394 ms                 | 21.950 ms                 |
| BarrierTimeBeforeRank0    | 59.513 us                 | 99.710 us                 |
| BlockToStepN              | 26.624 us                 | 62.065 us                 |
| OneStep                   | 105.793 ms                | 134.233 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.822 ms                  | 26.416 ms                 |
| bucket keys               | 2.392 ms                  | 2.697 ms                  |
| forward: a2a keys         | 2.183 ms                  | 7.019 ms                  |
| forward: search cache     | 512.123 us                | 566.721 us                |
| forward: a2a values       | 2.628 ms                  | 3.043 ms                  |
| forward: software         | 790.358 us                | 857.830 us                |
| forward: join             | 2.756 ms                  | 3.111 ms                  |
| Forward                   | 28.354 ms                 | 33.617 ms                 |
| back: aggr dram keys      | 24.010 ms                 | 29.324 ms                 |
| back: set dram grad       | 1.552 ms                  | 3.386 ms                  |
| back: a2a grad            | 2.829 ms                  | 3.489 ms                  |
| back: grad sum & grad cache  | 1.585 ms                  | 1.950 ms                  |
| Backward                  | 61.435 ms                 | 73.373 ms                 |
| Optimize                  | 13.387 ms                 | 22.702 ms                 |
| BarrierTimeBeforeRank0    | 59.868 us                 | 99.710 us                 |
| BlockToStepN              | 26.624 us                 | 79.206 us                 |
| OneStep                   | 106.181 ms                | 147.715 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.820 ms                  | 27.175 ms                 |
| bucket keys               | 2.392 ms                  | 2.697 ms                  |
| forward: a2a keys         | 2.174 ms                  | 11.250 ms                 |
| forward: search cache     | 511.408 us                | 566.959 us                |
| forward: a2a values       | 2.621 ms                  | 3.221 ms                  |
| forward: software         | 789.881 us                | 857.830 us                |
| forward: join             | 2.754 ms                  | 3.097 ms                  |
| Forward                   | 28.344 ms                 | 52.328 ms                 |
| back: aggr dram keys      | 24.029 ms                 | 29.055 ms                 |
| back: set dram grad       | 1.560 ms                  | 3.389 ms                  |
| back: a2a grad            | 2.828 ms                  | 3.489 ms                  |
| back: grad sum & grad cache  | 1.583 ms                  | 1.947 ms                  |
| Backward                  | 61.589 ms                 | 72.741 ms                 |
| Optimize                  | 13.394 ms                 | 22.702 ms                 |
| BarrierTimeBeforeRank0    | 59.845 us                 | 99.710 us                 |
| BlockToStepN              | 26.686 us                 | 95.447 us                 |
| OneStep                   | 106.492 ms                | 137.287 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 300 steps, total: 11.290, sample: 0.479, forward: 2.953, backward: 6.330, update: 1.390
[proc 2] 300 steps, total: 11.290, sample: 0.466, forward: 2.952, backward: 6.273, update: 0.210
[proc 3] 300 steps, total: 11.290, sample: 0.430, forward: 2.954, backward: 6.301, update: 0.209
[proc 1] 300 steps, total: 11.290, sample: 0.488, forward: 2.905, backward: 6.313, update: 0.207
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.816 ms                  | 27.175 ms                 |
| bucket keys               | 2.392 ms                  | 2.691 ms                  |
| forward: a2a keys         | 2.173 ms                  | 25.648 ms                 |
| forward: search cache     | 510.931 us                | 566.721 us                |
| forward: a2a values       | 2.609 ms                  | 3.114 ms                  |
| forward: software         | 787.973 us                | 853.539 us                |
| forward: join             | 2.750 ms                  | 3.097 ms                  |
| Forward                   | 28.339 ms                 | 52.328 ms                 |
| back: aggr dram keys      | 24.089 ms                 | 28.759 ms                 |
| back: set dram grad       | 1.567 ms                  | 3.413 ms                  |
| back: a2a grad            | 2.825 ms                  | 3.431 ms                  |
| back: grad sum & grad cache  | 1.583 ms                  | 1.943 ms                  |
| Backward                  | 61.905 ms                 | 72.741 ms                 |
| Optimize                  | 13.399 ms                 | 22.702 ms                 |
| BarrierTimeBeforeRank0    | 59.990 us                 | 113.692 us                |
| BlockToStepN              | 26.703 us                 | 95.447 us                 |
| OneStep                   | 107.125 ms                | 137.891 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.817 ms                  | 26.647 ms                 |
| bucket keys               | 2.392 ms                  | 3.357 ms                  |
| forward: a2a keys         | 2.185 ms                  | 25.631 ms                 |
| forward: search cache     | 510.454 us                | 568.628 us                |
| forward: a2a values       | 2.610 ms                  | 3.355 ms                  |
| forward: software         | 787.973 us                | 873.327 us                |
| forward: join             | 2.753 ms                  | 3.129 ms                  |
| Forward                   | 28.369 ms                 | 53.774 ms                 |
| back: aggr dram keys      | 24.091 ms                 | 28.723 ms                 |
| back: set dram grad       | 1.570 ms                  | 3.426 ms                  |
| back: a2a grad            | 2.839 ms                  | 3.414 ms                  |
| back: grad sum & grad cache  | 1.585 ms                  | 1.947 ms                  |
| Backward                  | 62.031 ms                 | 72.561 ms                 |
| Optimize                  | 13.411 ms                 | 22.536 ms                 |
| BarrierTimeBeforeRank0    | 59.845 us                 | 111.391 us                |
| BlockToStepN              | 26.829 us                 | 79.206 us                 |
| OneStep                   | 107.667 ms                | 137.287 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 11.708, sample: 0.471, forward: 3.355, backward: 6.349, update: 1.396
[proc 1] 400 steps, total: 11.708, sample: 0.462, forward: 3.343, backward: 6.330, update: 0.191
[proc 2] 400 steps, total: 11.708, sample: 0.498, forward: 3.308, backward: 6.316, update: 0.206
[proc 3] 400 steps, total: 11.708, sample: 0.461, forward: 3.334, backward: 6.310, update: 0.208
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.818 ms                  | 26.647 ms                 |
| bucket keys               | 2.392 ms                  | 3.357 ms                  |
| forward: a2a keys         | 2.179 ms                  | 25.900 ms                 |
| forward: search cache     | 510.216 us                | 568.628 us                |
| forward: a2a values       | 2.600 ms                  | 3.355 ms                  |
| forward: software         | 788.450 us                | 873.327 us                |
| forward: join             | 2.753 ms                  | 3.241 ms                  |
| Forward                   | 28.388 ms                 | 53.774 ms                 |
| back: aggr dram keys      | 24.095 ms                 | 28.759 ms                 |
| back: set dram grad       | 1.570 ms                  | 3.449 ms                  |
| back: a2a grad            | 2.842 ms                  | 3.431 ms                  |
| back: grad sum & grad cache  | 1.585 ms                  | 1.947 ms                  |
| Backward                  | 62.084 ms                 | 72.561 ms                 |
| Optimize                  | 13.429 ms                 | 22.536 ms                 |
| BarrierTimeBeforeRank0    | 59.790 us                 | 114.454 us                |
| BlockToStepN              | 26.730 us                 | 79.206 us                 |
| OneStep                   | 107.949 ms                | 137.287 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.817 ms                  | 26.574 ms                 |
| bucket keys               | 2.392 ms                  | 3.080 ms                  |
| forward: a2a keys         | 2.178 ms                  | 26.209 ms                 |
| forward: search cache     | 509.739 us                | 567.675 us                |
| forward: a2a values       | 2.591 ms                  | 3.355 ms                  |
| forward: software         | 787.973 us                | 873.327 us                |
| forward: join             | 2.753 ms                  | 3.241 ms                  |
| Forward                   | 28.365 ms                 | 53.774 ms                 |
| back: aggr dram keys      | 24.097 ms                 | 28.759 ms                 |
| back: set dram grad       | 1.571 ms                  | 3.435 ms                  |
| back: a2a grad            | 2.842 ms                  | 3.431 ms                  |
| back: grad sum & grad cache  | 1.586 ms                  | 1.947 ms                  |
| Backward                  | 62.033 ms                 | 69.606 ms                 |
| Optimize                  | 13.428 ms                 | 22.536 ms                 |
| BarrierTimeBeforeRank0    | 59.627 us                 | 113.692 us                |
| BlockToStepN              | 26.634 us                 | 79.206 us                 |
| OneStep                   | 108.041 ms                | 136.584 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 11.464, sample: 0.462, forward: 3.258, backward: 6.195, update: 0.203
[proc 1] 500 steps, total: 11.464, sample: 0.471, forward: 3.267, backward: 6.189, update: 0.207
[proc 0] 500 steps, total: 11.464, sample: 0.464, forward: 3.297, backward: 6.202, update: 1.365
[proc 3] 500 steps, total: 11.464, sample: 0.486, forward: 3.233, backward: 6.170, update: 0.197
Successfully xmh. training takes 63.87892460823059 seconds
before call kg_cache_controller.StopThreads()
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
INFO [1433371 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.816 ms                  | 26.574 ms                 |
| bucket keys               | 2.392 ms                  | 2.854 ms                  |
| forward: a2a keys         | 2.174 ms                  | 26.302 ms                 |
| forward: search cache     | 509.262 us                | 568.628 us                |
| forward: a2a values       | 2.587 ms                  | 3.275 ms                  |
| forward: software         | 788.450 us                | 868.082 us                |
| forward: join             | 2.754 ms                  | 3.136 ms                  |
| Forward                   | 28.342 ms                 | 53.774 ms                 |
| back: aggr dram keys      | 24.102 ms                 | 28.803 ms                 |
| back: set dram grad       | 1.569 ms                  | 3.435 ms                  |
| back: a2a grad            | 2.844 ms                  | 3.414 ms                  |
| back: grad sum & grad cache  | 1.586 ms                  | 1.943 ms                  |
| Backward                  | 62.033 ms                 | 69.606 ms                 |
| Optimize                  | 13.431 ms                 | 22.702 ms                 |
| BarrierTimeBeforeRank0    | 59.264 us                 | 113.692 us                |
| BlockToStepN              | 26.500 us                 | 79.206 us                 |
| OneStep                   | 108.084 ms                | 137.287 ms                |
+---------------------------+---------------------------+---------------------------+

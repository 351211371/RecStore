WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240131 23:47:15.247376 3239129 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_76', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [3239129 sampler.py:454] Start PreSampling
WARNING [3239129 sampler.py:532] Before construct renumbering_dict
WARNING [3239129 sampler.py:555] PreSampling done
W20240131 23:47:17.817561 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240131 23:47:17.817710 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240131 23:47:17.817739 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240131 23:47:17.817759 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240131 23:47:17.817780 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240131 23:47:17.817803 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240131 23:47:17.817829 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240131 23:47:17.817852 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240131 23:47:17.817870 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240131 23:47:17.817889 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240131 23:47:17.817909 3239129 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240131 23:47:17.817929 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240131 23:47:17.817951 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240131 23:47:17.818058 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240131 23:47:17.818087 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240131 23:47:17.818111 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240131 23:47:17.818147 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240131 23:47:17.818166 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240131 23:47:17.818182 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240131 23:47:17.818199 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240131 23:47:17.818217 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240131 23:47:17.818239 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240131 23:47:17.818257 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240131 23:47:17.818275 3239129 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240131 23:47:17.818290 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240131 23:47:17.818307 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240131 23:47:17.818351 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240131 23:47:17.818372 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240131 23:47:17.818390 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240131 23:47:17.818410 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240131 23:47:17.818429 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240131 23:47:17.818451 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240131 23:47:17.818476 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240131 23:47:17.818496 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240131 23:47:17.818513 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240131 23:47:17.818532 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240131 23:47:17.818550 3239129 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240131 23:47:17.818565 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240131 23:47:17.818579 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240131 23:47:17.818615 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240131 23:47:17.818645 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240131 23:47:17.818667 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240131 23:47:17.818686 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240131 23:47:17.818706 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240131 23:47:17.818724 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240131 23:47:17.818746 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240131 23:47:17.818766 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240131 23:47:17.818785 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240131 23:47:17.818804 3239129 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240131 23:47:17.818820 3239129 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240131 23:47:17.818835 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240131 23:47:17.818858 3239129 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240131 23:47:17.951299 3239129 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240131 23:47:17.978335 3239129 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 839, 1015, 1075,  ..., 1705, 6203, 7477]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.761 seconds
[Rank1] pid = 3239341
[Rank2] pid = 3239405
INFO [3239405 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [3239129 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3239341 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3239341 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3239470 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [3239470 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240131 23:47:20.371033 3239342 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240131 23:47:20.372395 3239472 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240131 23:47:20.373081 3239472 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100014878000 7.629 MB
W20240131 23:47:20.373309 3239472 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x10001501b000 7.629 MB
W20240131 23:47:20.373416 3239472 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000157be000 1.49 GB
W20240131 23:47:20.373489 3239472 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x100074da1000 1.49 GB
W20240131 23:47:20.373593 3239472 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240131 23:47:20.375663 3239342 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000d4384000 7.629 MB
W20240131 23:47:20.376111 3239342 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000d4b27000 7.629 MB
W20240131 23:47:20.376255 3239342 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000d52ca000 1.49 GB
W20240131 23:47:20.376363 3239342 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001348ad000 1.49 GB
W20240131 23:47:20.376456 3239342 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
INFO [3239129 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3239405 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240131 23:47:20.381136 3239472 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240131 23:47:20.381171 3239342 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240131 23:47:20.382066 3239471 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240131 23:47:20.383113 3239407 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240131 23:47:20.389000 3239471 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x100193e9c000 7.629 MB
W20240131 23:47:20.389245 3239471 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100194de2000 7.629 MB
W20240131 23:47:20.389228 3239407 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10019463f000 7.629 MB
W20240131 23:47:20.389334 3239471 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x100195585000 1.49 GB
W20240131 23:47:20.389408 3239471 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1001f4b68000 1.49 GB
W20240131 23:47:20.389497 3239471 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240131 23:47:20.389557 3239407 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10025414b000 7.629 MB
W20240131 23:47:20.389693 3239407 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1002548ee000 1.49 GB
W20240131 23:47:20.389787 3239407 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1002b3ed1000 1.49 GB
W20240131 23:47:20.389891 3239407 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240131 23:47:20.402498 3239471 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240131 23:47:20.402637 3239407 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [3239341 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [3239405 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [3239470 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 3239470
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [3239129 DistTensor.py:59] The tensor name already exists in the kvstore
I20240131 23:47:21.487964 3239471 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240131 23:47:21.488101 3239407 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240131 23:47:21.488243 3239342 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240131 23:47:21.488292 3239472 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240131 23:47:21.489818 3239471 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240131 23:47:21.489935 3239471 grad_base.h:184] Init GradProcessingBase done
I20240131 23:47:21.492065 3239471 grad_async_v1.h:203] Use main thread to update emb.
W20240131 23:47:21.492096 3239471 kg_controller.h:75] after init GradAsyncProcessing
I20240131 23:47:21.492102 3239471 kg_controller.h:84] Construct KGCacheController done
E20240131 23:47:22.875216 3239472 recstore.cc:66] init folly done
E20240131 23:47:22.875319 3239471 recstore.cc:66] init folly done
E20240131 23:47:22.875363 3239407 recstore.cc:66] init folly done
E20240131 23:47:22.875541 3239342 recstore.cc:66] init folly done
I20240131 23:47:22.876848 3239471 grad_base.h:60] GraphEnv RegTensorsPerProcess
I20240131 23:47:23.596693 3239471 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240131 23:47:23.634114 3239472 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240131 23:47:23.640142 3239407 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240131 23:47:23.650377 3239342 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240131 23:47:25.879419 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=1, pq.top=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 739.768 us                | 9.316 ms                  |
| Forward                   | 2.909 ms                  | 767.199 ms                |
| Backward                  | 5.151 ms                  | 294.770 ms                |
| Optimize                  | 1.061 ms                  | 39.743 ms                 |
| BarrierTimeBeforeRank0    | 495.287 us                | 8.500 ms                  |
| AfterBackward             | 6.468 ms                  | 1.117 s                   |
| BlockToStepN              | 13.974 ms                 | 21.821 ms                 |
| OneStep                   | 35.015 ms                 | 2.252 s                   |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:26.893288 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=28, pq.top=28
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.672 ms                  | 111.162 ms                |
| ProcessBack:UpdateCache   | 1.225 ms                  | 191.199 ms                |
| ProcessBack:UpsertPq      | 3.478 ms                  | 6.296 ms                  |
| ProcessOneStep            | 7.038 ms                  | 1.117 s                   |
| BlockToStepN              | 24.985 ms                 | 41.662 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:27.902598 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=46, pq.top=46
W20240131 23:47:28.902005 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=61, pq.top=61
W20240131 23:47:29.915575 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=76, pq.top=76
W20240131 23:47:30.915006 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=89, pq.top=89
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 959.053 us                | 9.972 ms                  |
| Forward                   | 2.962 ms                  | 4.523 ms                  |
| Backward                  | 5.538 ms                  | 5.855 ms                  |
| Optimize                  | 1.007 ms                  | 2.047 ms                  |
| BarrierTimeBeforeRank0    | 19.266 us                 | 5.342 ms                  |
| AfterBackward             | 7.373 ms                  | 10.629 ms                 |
| BlockToStepN              | 41.696 ms                 | 59.819 ms                 |
| OneStep                   | 62.299 ms                 | 81.702 ms                 |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 8.084, sample: 0.153, forward: 0.989, backward: 0.844, update: 0.128
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 8.094, sample: 0.159, forward: 0.999, backward: 0.788, update: 0.137
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 8.100, sample: 0.145, forward: 0.947, backward: 0.747, update: 0.146
train_sampler.Prefill()
-------Step 0-------
tensor([ 7067,  3638,  9094,  7895,  8008,  3632,   705,  4737, 11700,  9647]) tensor([ 1075,  7795,  9157,   669,  7868,  6685, 13836,  6954,  8165,  7548])
-------Step 1-------
tensor([ 7067,  3638,  9094,  7895,  8008,  3632,   705,  4737, 11700,  9647]) tensor([ 8914, 11089, 12488, 14498,  7357,  8578,  7314,  1585,  2069,  8034])
-------Step 2-------
tensor([ 8431,  2133,  3328,   141, 11604,  9223,  4677, 10361, 10687,  8534]) tensor([10719,  4187,  3373, 12205,  1571,  2142, 11457,  5732, 11735,  5796])
-------Step 3-------
tensor([ 8431,  2133,  3328,   141, 11604,  9223,  4677, 10361, 10687,  8534]) tensor([ 4686, 12238,  6709, 13123,  2261,  6939,  1724, 12140,  5383,    54])
-------Step 4-------
tensor([   94, 13757, 11458, 11104,  4906,  5912, 14453,  6606,  3649,  1436]) tensor([14054,  5203, 10549, 10980,  3487,  9075,  5645,   547,  9304, 13481])
-------Step 5-------
tensor([   94, 13757, 11458, 11104,  4906,  5912, 14453,  6606,  3649,  1436]) tensor([ 6458,  6592,  7958, 13668,  9311, 11848,  1802, 14135,  7688,  5747])
-------Step 6-------
tensor([12471,  4234,   395,   102, 11826, 11462, 13979, 11458,  7775,  6694]) tensor([ 2955,  8242,  6449, 10977,  9070, 11721,  1294,  2412, 12051, 13297])
-------Step 7-------
tensor([12471,  4234,   395,   102, 11826, 11462, 13979, 11458,  7775,  6694]) tensor([ 4784, 13687,  9857,  7339,  5350,   455,  4385,  7337, 10923, 13664])
-------Step 8-------
tensor([ 9466,  9720, 14869,  9307,  4650,  6887,  1027,  5244,  4753, 10184]) tensor([  395, 10824, 13627,  1032, 11272, 11122,  1654,  9888,  7474,  8227])
-------Step 9-------
tensor([ 9466,  9720, 14869,  9307,  4650,  6887,  1027,  5244,  4753, 10184]) tensor([10516, 11755,   964,  3411,  1726, 11094,  6705,  2387,  2069, 13608])
before start barrier
start train
[proc 0] 100 steps, total: 8.137, sample: 0.196, forward: 1.052, backward: 0.818, update: 0.142
W20240131 23:47:31.915009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=103, pq.top=103
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.659 ms                  | 4.264 ms                  |
| ProcessBack:UpdateCache   | 1.186 ms                  | 1.940 ms                  |
| ProcessBack:UpsertPq      | 3.608 ms                  | 5.631 ms                  |
| ProcessOneStep            | 7.319 ms                  | 10.604 ms                 |
| BlockToStepN              | 46.508 ms                 | 62.954 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:32.915009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=116, pq.top=116
W20240131 23:47:33.915005 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=128, pq.top=128
W20240131 23:47:34.915009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240131 23:47:35.923075 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=153, pq.top=152
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 959.053 us                | 9.787 ms                  |
| Forward                   | 2.871 ms                  | 3.509 ms                  |
| Backward                  | 5.541 ms                  | 5.826 ms                  |
| Optimize                  | 968.952 us                | 2.011 ms                  |
| BarrierTimeBeforeRank0    | 18.585 us                 | 2.515 ms                  |
| AfterBackward             | 7.032 ms                  | 9.460 ms                  |
| BlockToStepN              | 52.267 ms                 | 70.454 ms                 |
| OneStep                   | 71.577 ms                 | 91.299 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:36.923008 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=165, pq.top=165
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.591 ms                  | 2.824 ms                  |
| ProcessBack:UpdateCache   | 1.181 ms                  | 1.754 ms                  |
| ProcessBack:UpsertPq      | 3.638 ms                  | 5.579 ms                  |
| ProcessOneStep            | 6.978 ms                  | 9.438 ms                  |
| BlockToStepN              | 54.054 ms                 | 71.082 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:37.923435 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=177, pq.top=176
W20240131 23:47:38.923010 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=188, pq.top=188
W20240131 23:47:39.927376 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=200, pq.top=199
[proc 0] 200 steps, total: 8.259, sample: 0.197, forward: 0.264, backward: 0.548, update: 0.085
[proc 3] 200 steps, total: 8.259, sample: 0.156, forward: 0.232, backward: 0.523, update: 0.094
[proc 2] 200 steps, total: 8.259, sample: 0.153, forward: 0.231, backward: 0.535, update: 0.093
[proc 1] 200 steps, total: 8.259, sample: 0.155, forward: 0.237, backward: 0.537, update: 0.084
W20240131 23:47:40.927006 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=211, pq.top=211
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 981.709 us                | 9.787 ms                  |
| Forward                   | 2.802 ms                  | 3.509 ms                  |
| Backward                  | 5.543 ms                  | 5.855 ms                  |
| Optimize                  | 925.218 us                | 2.011 ms                  |
| BarrierTimeBeforeRank0    | 18.438 us                 | 2.515 ms                  |
| AfterBackward             | 6.947 ms                  | 9.460 ms                  |
| BlockToStepN              | 58.070 ms                 | 77.555 ms                 |
| OneStep                   | 76.894 ms                 | 96.422 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:41.927008 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=223, pq.top=223
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.564 ms                  | 2.037 ms                  |
| ProcessBack:UpdateCache   | 1.176 ms                  | 1.543 ms                  |
| ProcessBack:UpsertPq      | 3.654 ms                  | 5.560 ms                  |
| ProcessOneStep            | 6.922 ms                  | 9.438 ms                  |
| BlockToStepN              | 59.541 ms                 | 77.814 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:42.927008 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=234, pq.top=234
W20240131 23:47:43.927006 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=245, pq.top=245
W20240131 23:47:44.930835 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=257, pq.top=256
W20240131 23:47:45.930011 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=268, pq.top=268
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.024 ms                  | 9.972 ms                  |
| Forward                   | 2.783 ms                  | 3.461 ms                  |
| Backward                  | 5.546 ms                  | 5.848 ms                  |
| Optimize                  | 913.927 us                | 1.964 ms                  |
| BarrierTimeBeforeRank0    | 18.405 us                 | 5.624 ms                  |
| AfterBackward             | 6.941 ms                  | 9.371 ms                  |
| BlockToStepN              | 61.039 ms                 | 78.587 ms                 |
| OneStep                   | 79.433 ms                 | 98.369 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:46.930006 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=279, pq.top=279
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.559 ms                  | 1.991 ms                  |
| ProcessBack:UpdateCache   | 1.175 ms                  | 1.493 ms                  |
| ProcessBack:UpsertPq      | 3.700 ms                  | 5.560 ms                  |
| ProcessOneStep            | 6.920 ms                  | 9.330 ms                  |
| BlockToStepN              | 61.590 ms                 | 79.571 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:47.930009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=291, pq.top=291
[proc 3] 300 steps, total: 8.794, sample: 0.148, forward: 0.229, backward: 0.520, update: 0.096
[proc 2] 300 steps, total: 8.794, sample: 0.150, forward: 0.234, backward: 0.524, update: 0.094
[proc 0] 300 steps, total: 8.794, sample: 0.203, forward: 0.265, backward: 0.541, update: 0.087
[proc 1] 300 steps, total: 8.794, sample: 0.141, forward: 0.242, backward: 0.513, update: 0.086
W20240131 23:47:48.930011 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=302, pq.top=302
W20240131 23:47:49.930006 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=313, pq.top=313
W20240131 23:47:50.930009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=325, pq.top=325
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.034 ms                  | 9.989 ms                  |
| Forward                   | 2.747 ms                  | 3.461 ms                  |
| Backward                  | 5.546 ms                  | 5.857 ms                  |
| Optimize                  | 911.417 us                | 1.964 ms                  |
| BarrierTimeBeforeRank0    | 18.509 us                 | 7.202 ms                  |
| AfterBackward             | 6.936 ms                  | 9.371 ms                  |
| BlockToStepN              | 62.984 ms                 | 79.642 ms                 |
| OneStep                   | 81.946 ms                 | 99.200 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:51.930011 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=336, pq.top=336
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.554 ms                  | 1.991 ms                  |
| ProcessBack:UpdateCache   | 1.176 ms                  | 1.398 ms                  |
| ProcessBack:UpsertPq      | 3.733 ms                  | 5.579 ms                  |
| ProcessOneStep            | 6.919 ms                  | 9.330 ms                  |
| BlockToStepN              | 63.293 ms                 | 82.787 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:52.930006 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=347, pq.top=347
W20240131 23:47:53.938920 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=359, pq.top=358
W20240131 23:47:54.938011 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=370, pq.top=370
W20240131 23:47:55.938009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=381, pq.top=381
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.039 ms                  | 9.978 ms                  |
| Forward                   | 2.719 ms                  | 3.446 ms                  |
| Backward                  | 5.548 ms                  | 5.876 ms                  |
| Optimize                  | 911.202 us                | 1.938 ms                  |
| BarrierTimeBeforeRank0    | 18.413 us                 | 7.773 ms                  |
| AfterBackward             | 6.926 ms                  | 9.371 ms                  |
| BlockToStepN              | 64.161 ms                 | 80.563 ms                 |
| OneStep                   | 83.491 ms                 | 100.063 ms                |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:56.938004 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=393, pq.top=393
[proc 2] 400 steps, total: 8.843, sample: 0.139, forward: 0.226, backward: 0.527, update: 0.094
[proc 0] 400 steps, total: 8.843, sample: 0.195, forward: 0.259, backward: 0.551, update: 0.088
[proc 1] 400 steps, total: 8.843, sample: 0.160, forward: 0.243, backward: 0.535, update: 0.086
[proc 3] 400 steps, total: 8.843, sample: 0.145, forward: 0.233, backward: 0.526, update: 0.095
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.552 ms                  | 1.940 ms                  |
| ProcessBack:UpdateCache   | 1.175 ms                  | 1.445 ms                  |
| ProcessBack:UpsertPq      | 3.754 ms                  | 5.623 ms                  |
| ProcessOneStep            | 6.905 ms                  | 9.330 ms                  |
| BlockToStepN              | 64.296 ms                 | 80.527 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:47:57.938010 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=404, pq.top=404
W20240131 23:47:58.938009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=415, pq.top=415
W20240131 23:47:59.938006 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=426, pq.top=426
W20240131 23:48:00.938009 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=437, pq.top=437
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.054 ms                  | 9.978 ms                  |
| Forward                   | 2.709 ms                  | 3.446 ms                  |
| Backward                  | 5.550 ms                  | 6.044 ms                  |
| Optimize                  | 913.927 us                | 1.938 ms                  |
| BarrierTimeBeforeRank0    | 18.438 us                 | 7.868 ms                  |
| AfterBackward             | 6.928 ms                  | 9.720 ms                  |
| BlockToStepN              | 65.074 ms                 | 82.882 ms                 |
| OneStep                   | 84.166 ms                 | 101.762 ms                |
+---------------------------+---------------------------+---------------------------+
W20240131 23:48:01.938010 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=448, pq.top=448
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.550 ms                  | 1.911 ms                  |
| ProcessBack:UpdateCache   | 1.176 ms                  | 1.398 ms                  |
| ProcessBack:UpsertPq      | 3.758 ms                  | 5.674 ms                  |
| ProcessOneStep            | 6.919 ms                  | 9.438 ms                  |
| BlockToStepN              | 65.233 ms                 | 82.787 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240131 23:48:02.938004 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=459, pq.top=459
W20240131 23:48:03.938010 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=470, pq.top=470
W20240131 23:48:04.948261 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=481, pq.top=480
W20240131 23:48:05.964583 3239471 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=492, pq.top=491
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.070 ms                  | 9.972 ms                  |
| Forward                   | 2.699 ms                  | 3.442 ms                  |
| Backward                  | 5.551 ms                  | 6.044 ms                  |
| Optimize                  | 910.446 us                | 1.916 ms                  |
| BarrierTimeBeforeRank0    | 18.485 us                 | 8.000 ms                  |
| AfterBackward             | 6.937 ms                  | 9.720 ms                  |
| BlockToStepN              | 65.732 ms                 | 83.540 ms                 |
| OneStep                   | 85.344 ms                 | 102.800 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 500 steps, total: 9.106, sample: 0.144, forward: 0.232, backward: 0.525, update: 0.088
[proc 0] 500 steps, total: 9.106, sample: 0.199, forward: 0.256, backward: 0.548, update: 0.087
[proc 2] 500 steps, total: 9.106, sample: 0.162, forward: 0.232, backward: 0.464, update: 0.098
[proc 1] 500 steps, total: 9.106, sample: 0.148, forward: 0.246, backward: 0.530, update: 0.087
Successfully xmh. training takes 43.13893795013428 seconds
before call kg_cache_controller.StopThreads()
W20240131 23:48:06.735662 3239471 grad_async_v1.h:243] call StopThreads. PID = 3239129
W20240131 23:48:06.735684 3239471 grad_base.h:212] before processOneStepNegThread_.join();
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240131 23:48:06.740775 3239471 grad_base.h:214] after processOneStepNegThread_.join();
W20240131 23:48:06.740809 3239471 grad_async_v1.h:245] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240131 23:48:06.757797 3239471 grad_async_v1.h:264] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.551 ms                  | 1.877 ms                  |
| ProcessBack:UpdateCache   | 1.178 ms                  | 1.380 ms                  |
| ProcessBack:UpsertPq      | 3.758 ms                  | 6.030 ms                  |
| ProcessOneStep            | 6.922 ms                  | 9.702 ms                  |
| BlockToStepN              | 65.735 ms                 | 83.499 ms                 |
+---------------------------+---------------------------+---------------------------+
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f27ec3d4710>

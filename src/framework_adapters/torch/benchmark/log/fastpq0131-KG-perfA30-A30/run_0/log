WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240131 23:28:12.456745 3208448 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_188', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [3208448 sampler.py:454] Start PreSampling
WARNING [3208448 sampler.py:532] Before construct renumbering_dict
WARNING [3208448 sampler.py:555] PreSampling done
W20240131 23:28:15.014853 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240131 23:28:15.015026 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240131 23:28:15.015056 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240131 23:28:15.015092 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240131 23:28:15.015118 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240131 23:28:15.015141 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240131 23:28:15.015163 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240131 23:28:15.015185 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240131 23:28:15.015210 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240131 23:28:15.015235 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240131 23:28:15.015256 3208448 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240131 23:28:15.015276 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240131 23:28:15.015292 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240131 23:28:15.015391 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240131 23:28:15.015414 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240131 23:28:15.015444 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240131 23:28:15.015480 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240131 23:28:15.015497 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240131 23:28:15.015517 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240131 23:28:15.015547 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240131 23:28:15.015569 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240131 23:28:15.015587 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240131 23:28:15.015609 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240131 23:28:15.015631 3208448 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240131 23:28:15.015647 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240131 23:28:15.015662 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240131 23:28:15.015703 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240131 23:28:15.015724 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240131 23:28:15.015741 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240131 23:28:15.015767 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240131 23:28:15.015787 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240131 23:28:15.015810 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240131 23:28:15.015827 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240131 23:28:15.015849 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240131 23:28:15.015866 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240131 23:28:15.015892 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240131 23:28:15.015913 3208448 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240131 23:28:15.015928 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240131 23:28:15.015942 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240131 23:28:15.015983 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240131 23:28:15.016005 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240131 23:28:15.016021 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240131 23:28:15.016042 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240131 23:28:15.016062 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240131 23:28:15.016081 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240131 23:28:15.016104 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240131 23:28:15.016124 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240131 23:28:15.016146 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240131 23:28:15.016167 3208448 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240131 23:28:15.016185 3208448 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240131 23:28:15.016201 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240131 23:28:15.016225 3208448 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240131 23:28:15.143427 3208448 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240131 23:28:15.170430 3208448 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 895, 1194, 1281,  ..., 1668, 5589, 7904]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.737 seconds
[Rank1] pid = 3209455
[Rank2] pid = 3209520
INFO [3208448 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3209455 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3209520 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [3209455 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3209520 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3209584 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [3208448 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3209584 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240131 23:28:17.684203 3209521 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240131 23:28:17.684213 3209456 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240131 23:28:17.684403 3209585 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240131 23:28:17.684957 3209586 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240131 23:28:17.685014 3209521 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x100014878000 7.629 MB
W20240131 23:28:17.685140 3209456 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10001501d000 7.629 MB
W20240131 23:28:17.685186 3209585 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000157c0000 7.629 MB
W20240131 23:28:17.685211 3209521 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x100015f63000 7.629 MB
W20240131 23:28:17.685302 3209521 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x100016706000 1.49 GB
W20240131 23:28:17.685345 3209521 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x100075ce9000 1.49 GB
W20240131 23:28:17.685356 3209456 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000d52cc000 7.629 MB
W20240131 23:28:17.685367 3209585 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1000d5a6f000 7.629 MB
W20240131 23:28:17.685420 3209521 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240131 23:28:17.685473 3209456 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000d6214000 1.49 GB
W20240131 23:28:17.685477 3209585 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1001357f7000 1.49 GB
W20240131 23:28:17.685532 3209585 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100194dda000 1.49 GB
W20240131 23:28:17.685565 3209456 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001f43bd000 1.49 GB
W20240131 23:28:17.685597 3209585 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240131 23:28:17.685626 3209586 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x1002539a0000 7.629 MB
W20240131 23:28:17.685662 3209456 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240131 23:28:17.685751 3209586 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x100254143000 7.629 MB
W20240131 23:28:17.685806 3209586 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1002548e6000 1.49 GB
W20240131 23:28:17.685845 3209586 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1002b3ec9000 1.49 GB
W20240131 23:28:17.685883 3209586 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240131 23:28:17.695446 3209585 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240131 23:28:17.695564 3209456 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240131 23:28:17.699505 3209586 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240131 23:28:17.699575 3209521 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [3209584 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 3209584
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [3208448 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [3209520 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [3209455 DistTensor.py:59] The tensor name already exists in the kvstore
I20240131 23:28:19.351555 3209456 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240131 23:28:19.351706 3209585 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240131 23:28:19.351796 3209586 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240131 23:28:19.351871 3209521 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240131 23:28:19.352799 3209585 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240131 23:28:19.352902 3209585 grad_base.h:184] Init GradProcessingBase done
I20240131 23:28:19.357108 3209585 grad_async_v2.h:42] Use main thread to update emb.
W20240131 23:28:19.357139 3209585 kg_controller.h:78] after init GradAsyncProcessingV2
I20240131 23:28:19.357146 3209585 kg_controller.h:84] Construct KGCacheController done
E20240131 23:28:20.706945 3209585 recstore.cc:66] init folly done
E20240131 23:28:20.707011 3209456 recstore.cc:66] init folly done
E20240131 23:28:20.707152 3209521 recstore.cc:66] init folly done
E20240131 23:28:20.707345 3209586 recstore.cc:66] init folly done
I20240131 23:28:20.708251 3209585 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240131 23:28:21.432498 3210319 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240131 23:28:21.432842 3210319 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
I20240131 23:28:21.457537 3209585 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240131 23:28:21.474891 3209456 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240131 23:28:21.483381 3209586 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240131 23:28:21.487533 3209521 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240131 23:28:23.850322 3210010 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240131 23:28:23.865111 3210319 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240131 23:28:23.879421 3210010 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=1, sample_step_cpp_seen_[rank]=0
W20240131 23:28:23.893806 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=2, pq.top=2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 911.203 us                | 16.331 ms                 |
| Forward                   | 3.293 ms                  | 934.833 ms                |
| Backward                  | 6.361 ms                  | 291.002 ms                |
| Optimize                  | 1.233 ms                  | 2.643 ms                  |
| BarrierTimeBeforeRank0    | 24.977 us                 | 36.155 ms                 |
| AfterBackward             | 12.466 ms                 | 1.110 s                   |
| BlockToStepN              | 244.337 us                | 2.564 ms                  |
| OneStep                   | 25.490 ms                 | 2.376 s                   |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:24.850011 3210342 parallel_pq_v2.h:79] insert failed, size(hashtable)=3900
W20240131 23:28:24.873201 3210319 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end4
W20240131 23:28:24.900168 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=35, pq.top=35
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 222.976 us                | 2.373 ms                  |
| ProcessBack:Shuffle       | 1.944 ms                  | 146.385 ms                |
| ProcessBack:UpdateCache   | 1.615 ms                  | 191.362 ms                |
| ProcessBack:UpsertPq      | 9.080 ms                  | 18.208 ms                 |
| ProcessOneStep            | 14.162 ms                 | 133.457 ms                |
| BlockToStepN              | 290.881 us                | 1.925 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:25.850045 3210319 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240131 23:28:25.898558 3210319 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
W20240131 23:28:25.950887 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=67, pq.top=67
E20240131 23:28:26.850013 3210010 parallel_pq_v2.h:79] insert failed, size(hashtable)=687
W20240131 23:28:26.917812 3210319 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 5.447, sample: 0.196, forward: 1.213, backward: 0.567, update: 0.100
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 5.451, sample: 0.202, forward: 1.217, backward: 0.566, update: 0.100
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 5.460, sample: 0.243, forward: 1.261, backward: 0.683, update: 0.105
train_sampler.Prefill()
-------Step 0-------
tensor([10187,  3675,  8881,  6993,  8594,  5167,   701,  4439, 12243,  8590]) tensor([ 1281,  7971,  8960,   671,  7065,  9624, 13501, 10026,  8662,  7597])
-------Step 1-------
tensor([10187,  3675,  8881,  6993,  8594,  5167,   701,  4439, 12243,  8590]) tensor([ 7504, 11698, 11400, 14489,  6913,  8691,  6136,  1650,  1915,  8199])
-------Step 2-------
tensor([ 9262,  2270,  3344,   158,  9841,  8164,  4311, 10729, 10873,  8257]) tensor([ 9655,  3565,  3073, 12176,  1577,  2024, 11776,  5838, 12614,  8299])
-------Step 3-------
tensor([ 9262,  2270,  3344,   158,  9841,  8164,  4311, 10729, 10873,  8257]) tensor([ 4690, 11681,  6000, 12055,  2294, 10928,  1710, 11856,  5072,   102])
-------Step 4-------
tensor([  106, 14454, 11173, 10583,  5029,  5275, 12964,  6711,  3652,  1308]) tensor([13468,  4961, 10078,  9910,  3231,  9219,  5524,   540,  9636, 12091])
-------Step 5-------
tensor([  106, 14454, 11173, 10583,  5029,  5275, 12964,  6711,  3652,  1308]) tensor([ 7051,  6244,  8063, 14258,  8793, 11006,  2694, 12991,  6929,  6280])
-------Step 6-------
tensor([12443,  4359,   403,   156, 10630, 10627, 14547, 11173, 11287,  6438]) tensor([ 2660,  7364,  5810, 11345,  9183, 12060,  1234,  2081, 11202, 13618])
-------Step 7-------
tensor([12443,  4359,   403,   156, 10630, 10627, 14547, 11173, 11287,  6438]) tensor([ 4180, 14321,  8612,  7768,  5035,   461,  6847,  6702,  9869, 12441])
-------Step 8-------
tensor([ 9794,  9232, 14206, 10220,  4768,  6630,  1003,  4799,  4465, 14618]) tensor([  403,  9718, 13927,   986, 10746, 11905,  1522,  8647,  7437,  7829])
-------Step 9-------
tensor([ 9794,  9232, 14206, 10220,  4768,  6630,  1003,  4799,  4465, 14618]) tensor([ 9218, 10638,   983,  3075,  1798, 12254,  6384,  2543,  1915, 14149])
before start barrier
start train
[proc 0] 100 steps, total: 5.477, sample: 0.257, forward: 1.258, backward: 0.688, update: 0.131
W20240131 23:28:26.957859 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=101, pq.top=101
E20240131 23:28:27.850011 3209585 parallel_pq_v2.h:79] insert failed, size(hashtable)=96
W20240131 23:28:27.921439 3210319 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end2
W20240131 23:28:27.959914 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=133, pq.top=133
E20240131 23:28:28.850036 3210319 parallel_pq_v2.h:79] insert failed, size(hashtable)=224
W20240131 23:28:28.952657 3210319 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end4
W20240131 23:28:28.982035 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=165, pq.top=165
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.130 ms                  | 15.040 ms                 |
| Forward                   | 3.305 ms                  | 4.475 ms                  |
| Backward                  | 2.949 ms                  | 7.172 ms                  |
| Optimize                  | 1.303 ms                  | 2.398 ms                  |
| BarrierTimeBeforeRank0    | 19.827 us                 | 3.730 ms                  |
| AfterBackward             | 16.140 ms                 | 134.677 ms                |
| BlockToStepN              | 594.977 us                | 2.483 ms                  |
| OneStep                   | 27.252 ms                 | 146.291 ms                |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:29.674597 3210010 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=188, sample_step_cpp_seen_[rank]=187
E20240131 23:28:29.850011 3209585 parallel_pq_v2.h:79] insert failed, size(hashtable)=330
W20240131 23:28:29.965401 3210319 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end5
W20240131 23:28:30.003072 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=196, pq.top=196
[proc 3] 200 steps, total: 3.210, sample: 0.238, forward: 0.270, backward: 0.236, update: 0.098
[proc 1] 200 steps, total: 3.210, sample: 0.248, forward: 0.312, backward: 0.257, update: 0.096
[proc 0] 200 steps, total: 3.210, sample: 0.314, forward: 0.324, backward: 0.280, update: 0.119
[proc 2] 200 steps, total: 3.210, sample: 0.193, forward: 0.256, backward: 0.245, update: 0.097
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 267.419 us                | 1.759 ms                  |
| ProcessBack:Shuffle       | 2.021 ms                  | 2.674 ms                  |
| ProcessBack:UpdateCache   | 1.645 ms                  | 2.854 ms                  |
| ProcessBack:UpsertPq      | 11.098 ms                 | 18.208 ms                 |
| ProcessOneStep            | 16.519 ms                 | 134.648 ms                |
| BlockToStepN              | 612.445 us                | 2.460 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:30.850008 3209585 parallel_pq_v2.h:79] insert failed, size(hashtable)=52
W20240131 23:28:30.976442 3210319 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end8
W20240131 23:28:31.025739 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=229, pq.top=229
E20240131 23:28:31.850008 3210319 parallel_pq_v2.h:79] insert failed, size(hashtable)=5
W20240131 23:28:31.982918 3210319 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
W20240131 23:28:32.050485 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=259, pq.top=259
E20240131 23:28:32.850039 3210010 parallel_pq_v2.h:79] insert failed, size(hashtable)=167
W20240131 23:28:32.986806 3210319 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240131 23:28:33.087895 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=287, pq.top=287
[proc 1] 300 steps, total: 3.444, sample: 0.228, forward: 0.309, backward: 0.256, update: 0.095
[proc 3] 300 steps, total: 3.444, sample: 0.234, forward: 0.264, backward: 0.231, update: 0.092
[proc 0] 300 steps, total: 3.444, sample: 0.307, forward: 0.315, backward: 0.251, update: 0.116
[proc 2] 300 steps, total: 3.444, sample: 0.167, forward: 0.247, backward: 0.251, update: 0.094
E20240131 23:28:33.850010 3210010 parallel_pq_v2.h:79] insert failed, size(hashtable)=340
W20240131 23:28:34.003371 3210319 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240131 23:28:34.113008 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=314, pq.top=314
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.302 ms                  | 16.331 ms                 |
| Forward                   | 3.295 ms                  | 4.475 ms                  |
| Backward                  | 2.719 ms                  | 7.171 ms                  |
| Optimize                  | 1.290 ms                  | 2.391 ms                  |
| BarrierTimeBeforeRank0    | 19.612 us                 | 10.840 ms                 |
| AfterBackward             | 18.127 ms                 | 133.479 ms                |
| BlockToStepN              | 894.432 us                | 3.637 ms                  |
| OneStep                   | 29.357 ms                 | 144.298 ms                |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:34.850015 3209585 parallel_pq_v2.h:79] insert failed, size(hashtable)=323
W20240131 23:28:35.007043 3210319 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
W20240131 23:28:35.118744 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=341, pq.top=341
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 306.860 us                | 2.729 ms                  |
| ProcessBack:Shuffle       | 2.064 ms                  | 2.661 ms                  |
| ProcessBack:UpdateCache   | 1.712 ms                  | 2.606 ms                  |
| ProcessBack:UpsertPq      | 13.140 ms                 | 19.857 ms                 |
| ProcessOneStep            | 18.704 ms                 | 128.605 ms                |
| BlockToStepN              | 948.825 us                | 3.769 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:35.850008 3209585 parallel_pq_v2.h:79] insert failed, size(hashtable)=1758
W20240131 23:28:36.011168 3210319 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240131 23:28:36.140532 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=368, pq.top=368
E20240131 23:28:36.850036 3209585 parallel_pq_v2.h:79] insert failed, size(hashtable)=367
W20240131 23:28:37.016161 3210319 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240131 23:28:37.175189 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=395, pq.top=395
[proc 1] 400 steps, total: 3.790, sample: 0.246, forward: 0.306, backward: 0.254, update: 0.097
[proc 0] 400 steps, total: 3.790, sample: 0.334, forward: 0.317, backward: 0.252, update: 0.119
[proc 2] 400 steps, total: 3.790, sample: 0.154, forward: 0.248, backward: 0.370, update: 0.094
[proc 3] 400 steps, total: 3.790, sample: 0.179, forward: 0.252, backward: 0.227, update: 0.100
E20240131 23:28:37.850047 3210319 parallel_pq_v2.h:79] insert failed, size(hashtable)=69
W20240131 23:28:38.027237 3210319 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
W20240131 23:28:38.178795 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=421, pq.top=421
E20240131 23:28:38.850072 3210319 parallel_pq_v2.h:79] insert failed, size(hashtable)=12
W20240131 23:28:39.038770 3210319 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240131 23:28:39.201406 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=447, pq.top=447
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.484 ms                  | 16.076 ms                 |
| Forward                   | 3.271 ms                  | 4.429 ms                  |
| Backward                  | 2.677 ms                  | 7.160 ms                  |
| Optimize                  | 1.278 ms                  | 2.327 ms                  |
| BarrierTimeBeforeRank0    | 19.892 us                 | 10.840 ms                 |
| AfterBackward             | 20.162 ms                 | 124.020 ms                |
| BlockToStepN              | 1.323 ms                  | 4.370 ms                  |
| OneStep                   | 33.822 ms                 | 134.726 ms                |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:39.850157 3210322 parallel_pq_v2.h:79] insert failed, size(hashtable)=10041
W20240131 23:28:40.041879 3210319 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
W20240131 23:28:40.222995 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=473, pq.top=473
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 371.972 us                | 3.678 ms                  |
| ProcessBack:Shuffle       | 2.082 ms                  | 2.577 ms                  |
| ProcessBack:UpdateCache   | 1.773 ms                  | 2.615 ms                  |
| ProcessBack:UpsertPq      | 15.383 ms                 | 20.516 ms                 |
| ProcessOneStep            | 20.702 ms                 | 123.994 ms                |
| BlockToStepN              | 1.600 ms                  | 4.462 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240131 23:28:40.850008 3209585 parallel_pq_v2.h:79] insert failed, size(hashtable)=264
W20240131 23:28:41.047552 3210319 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240131 23:28:41.255096 3209585 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=499, pq.top=499
[proc 1] 500 steps, total: 3.925, sample: 0.225, forward: 0.305, backward: 0.257, update: 0.095
[proc 0] 500 steps, total: 3.925, sample: 0.339, forward: 0.308, backward: 0.255, update: 0.115
[proc 3] 500 steps, total: 3.925, sample: 0.231, forward: 0.270, backward: 0.229, update: 0.098
[proc 2] 500 steps, total: 3.925, sample: 0.197, forward: 0.257, backward: 0.244, update: 0.100
Successfully xmh. training takes 19.846785306930542 seconds
before call kg_cache_controller.StopThreads()
W20240131 23:28:41.304373 3209585 grad_async_v2.h:84] call StopThreads. PID = 3208448
W20240131 23:28:41.304404 3209585 grad_base.h:212] before processOneStepNegThread_.join();
W20240131 23:28:41.304831 3209585 grad_base.h:214] after processOneStepNegThread_.join();
W20240131 23:28:41.304843 3209585 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240131 23:28:41.307839 3209585 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f76c789d850>

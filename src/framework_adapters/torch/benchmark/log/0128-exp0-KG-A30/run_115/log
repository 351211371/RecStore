WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240128 14:14:05.143560 244321 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='DistMult', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/DistMult_FB15k_55', no_save_emb=True, max_step=500, batch_size=2400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [244321 sampler.py:454] Start PreSampling
WARNING [244321 sampler.py:532] Before construct renumbering_dict
WARNING [244321 sampler.py:555] PreSampling done
W20240128 14:14:07.113778 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240128 14:14:07.113948 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240128 14:14:07.113976 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240128 14:14:07.114004 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240128 14:14:07.114032 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240128 14:14:07.114049 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240128 14:14:07.114068 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240128 14:14:07.114096 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240128 14:14:07.114126 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240128 14:14:07.114145 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240128 14:14:07.114163 244321 IPCTensor.h:368] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240128 14:14:07.114181 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240128 14:14:07.114200 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240128 14:14:07.114287 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240128 14:14:07.114310 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240128 14:14:07.114324 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240128 14:14:07.114353 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240128 14:14:07.114367 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240128 14:14:07.114382 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240128 14:14:07.114398 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240128 14:14:07.114418 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240128 14:14:07.114445 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240128 14:14:07.114464 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240128 14:14:07.114490 244321 IPCTensor.h:368] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240128 14:14:07.114503 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240128 14:14:07.114519 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240128 14:14:07.114553 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240128 14:14:07.114570 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240128 14:14:07.114585 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240128 14:14:07.114599 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240128 14:14:07.114619 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240128 14:14:07.114641 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240128 14:14:07.114657 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240128 14:14:07.114674 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240128 14:14:07.114693 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240128 14:14:07.114713 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240128 14:14:07.114732 244321 IPCTensor.h:368] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240128 14:14:07.114744 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240128 14:14:07.114759 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240128 14:14:07.114789 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240128 14:14:07.114809 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240128 14:14:07.114823 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240128 14:14:07.114837 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240128 14:14:07.114859 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240128 14:14:07.114878 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240128 14:14:07.114895 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240128 14:14:07.114915 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240128 14:14:07.114931 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240128 14:14:07.114945 244321 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240128 14:14:07.114960 244321 IPCTensor.h:368] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240128 14:14:07.114974 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240128 14:14:07.114984 244321 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240128 14:14:07.273641 244321 IPCTensor.h:368] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240128 14:14:07.273766 244321 IPCTensor.h:368] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 373
Rank1: cached key size 373
Rank2: cached key size 373
Rank3: cached key size 373
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([1646, 1907, 1979,  ..., 2289, 6003, 6774]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.155 seconds
[Rank1] pid = 244533
[Rank2] pid = 244598
INFO [244321 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [244598 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [244598 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [244533 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [244321 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [244662 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [244533 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [244662 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240128 14:14:10.400362 244663 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_0 [1495, 400]; dev=0; size=2.281 MB
W20240128 14:14:10.401019 244663 IPCTensor.h:368] NewIPCTensor: input_keys_0 [1000000]0x100014876000 7.629 MB
W20240128 14:14:10.401206 244663 IPCTensor.h:368] NewIPCTensor: input_keys_neg_0 [1000000]0x100015019000 7.629 MB
W20240128 14:14:10.401321 244663 IPCTensor.h:368] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000157bc000 1.49 GB
W20240128 14:14:10.401422 244663 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100074d9f000 1.49 GB
W20240128 14:14:10.401505 244663 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240128 14:14:10.401702 244534 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_1 [1495, 400]; dev=1; size=2.281 MB
W20240128 14:14:10.401715 244664 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_3 [1495, 400]; dev=3; size=2.281 MB
W20240128 14:14:10.401731 244599 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_2 [1495, 400]; dev=2; size=2.281 MB
W20240128 14:14:10.406922 244663 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240128 14:14:10.407043 244664 IPCTensor.h:368] NewIPCTensor: input_keys_3 [1000000]0x1000d4388000 7.629 MB
W20240128 14:14:10.407174 244534 IPCTensor.h:368] NewIPCTensor: input_keys_1 [1000000]0x1000d4b2b000 7.629 MB
W20240128 14:14:10.407279 244664 IPCTensor.h:368] NewIPCTensor: input_keys_neg_3 [1000000]0x1000d52ce000 7.629 MB
W20240128 14:14:10.407370 244664 IPCTensor.h:368] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000d5a71000 1.49 GB
W20240128 14:14:10.407423 244534 IPCTensor.h:368] NewIPCTensor: input_keys_neg_1 [1000000]0x100135054000 7.629 MB
W20240128 14:14:10.407474 244664 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1001357f7000 1.49 GB
W20240128 14:14:10.407526 244534 IPCTensor.h:368] NewIPCTensor: backward_grads_1 [1000000, 400]0x100194dda000 1.49 GB
W20240128 14:14:10.407565 244664 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240128 14:14:10.407646 244534 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001f43bd000 1.49 GB
W20240128 14:14:10.407727 244534 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240128 14:14:10.420397 244664 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240128 14:14:10.420460 244599 IPCTensor.h:368] NewIPCTensor: input_keys_2 [1000000]0x1002539a8000 7.629 MB
W20240128 14:14:10.420571 244534 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240128 14:14:10.420708 244599 IPCTensor.h:368] NewIPCTensor: input_keys_neg_2 [1000000]0x10025414b000 7.629 MB
W20240128 14:14:10.420858 244599 IPCTensor.h:368] NewIPCTensor: backward_grads_2 [1000000, 400]0x1002548ee000 1.49 GB
W20240128 14:14:10.420944 244599 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1002b3ed1000 1.49 GB
W20240128 14:14:10.421052 244599 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240128 14:14:10.437763 244599 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
[Rank3] pid = 244662
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 1495), (1495, 2990), (2990, 4485), (4485, 5980)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [244321 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [244533 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [244598 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [244662 DistTensor.py:56] The tensor name already exists in the kvstore
I20240128 14:14:11.505146 244664 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240128 14:14:11.505195 244599 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 14:14:11.505239 244534 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 14:14:11.505277 244663 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240128 14:14:11.506567 244663 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.1,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240128 14:14:11.506743 244663 grad_base.h:184] Init GradProcessingBase done
I20240128 14:14:11.510071 244663 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240128 14:14:11.510154 244663 kg_controller.h:78] after init GradAsyncProcessingV2
I20240128 14:14:11.510159 244663 kg_controller.h:84] Construct KGCacheController done
I20240128 14:14:11.851164 244663 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240128 14:14:12.570273 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240128 14:14:12.570621 245072 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240128 14:14:12.601984 244664 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240128 14:14:12.624744 244663 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 14:14:12.629462 244599 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 14:14:12.635859 244534 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240128 14:14:14.897271 244663 parallel_pq_v2.h:76] insert failed, size(hashtable)=4
W20240128 14:14:14.911237 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=0
W20240128 14:14:14.923719 245072 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240128 14:14:15.897006 244663 parallel_pq_v2.h:76] insert failed, size(hashtable)=621
W20240128 14:14:15.932355 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=22, pq.top=22
W20240128 14:14:15.937407 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.075 ms                  | 21.182 ms                 |
| Forward                   | 3.501 ms                  | 1.411 s                   |
| Backward                  | 2.550 ms                  | 235.997 ms                |
| Optimize                  | 1.968 ms                  | 51.646 ms                 |
| BarrierTimeBeforeRank0    | 37.741 us                 | 5.139 ms                  |
| AfterBackward             | 18.187 ms                 | 570.429 ms                |
| BlockToStepN              | 10.783 ms                 | 81.059 ms                 |
| OneStep                   | 43.527 ms                 | 2.287 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.131 ms                  | 72.774 ms                 |
| ProcessBack:UpdateCache   | 1.456 ms                  | 223.542 ms                |
| ProcessBack:UpsertPq      | 12.992 ms                 | 17.363 ms                 |
| ProcessOneStep            | 18.548 ms                 | 570.183 ms                |
| BlockToStepN              | 10.897 ms                 | 81.002 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 14:14:16.897109 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=4900
W20240128 14:14:16.932020 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=42, pq.top=42
W20240128 14:14:16.941007 245072 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240128 14:14:17.897012 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=4040
W20240128 14:14:17.949004 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=61, pq.top=61
W20240128 14:14:17.965986 245072 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end1
E20240128 14:14:18.897029 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2401
W20240128 14:14:18.962430 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=79, pq.top=79
W20240128 14:14:19.000636 245072 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end9
E20240128 14:14:19.897188 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2787
W20240128 14:14:19.962091 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=93, pq.top=93
W20240128 14:14:20.027429 245072 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 7.816, sample: 0.221, forward: 0.957, backward: 0.465, update: 0.227
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 7.789, sample: 0.312, forward: 1.059, backward: 0.585, update: 0.259
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.782, sample: 0.310, forward: 1.189, backward: 0.529, update: 0.218
train_sampler.Prefill()
-------Step 0-------
tensor([11121,   372,  9081,  6912,  8405,  5881, 11430,  4681, 13048,   111]) tensor([ 1979,  8744,  9140,  1136,  7339, 10607, 12468, 10972,  7321,  1162])
-------Step 1-------
tensor([11121,   372,  9081,  6912,  8405,  5881, 11430,  4681, 13048,   111]) tensor([ 2741,   750,  5763,  5380, 12550,    21,   692,  5467,  6284,  7423])
-------Step 2-------
tensor([ 3941, 14895, 10514,  9998,  5739,  6757, 13683,  6920,  4209,  2150]) tensor([14826,  1047,  9974, 11154,  4321,   609,  6155,   901, 11145, 13210])
-------Step 3-------
tensor([ 3941, 14895, 10514,  9998,  5739,  6757, 13683,  6920,  4209,  2150]) tensor([ 9981, 13926,  6518,  7185,  4569,  7027, 13153,  7043,  6536, 12973])
-------Step 4-------
tensor([11304,  9260, 13889, 10075,  4836,  6732,  1755,  5772,  4724, 14852]) tensor([  766, 10912, 14228,  1763, 11603,  9727,  2413,  9650,  7427,  7992])
-------Step 5-------
tensor([11304,  9260, 13889, 10075,  4836,  6732,  1755,  5772,  4724, 14852]) tensor([ 4353, 13338,  4442,  9102,  6414, 11074,  1035,  1606, 14545,  2159])
-------Step 6-------
tensor([ 5836,   581, 13120, 10695,  3925, 12904,  8083,   138,  5136, 11071]) tensor([14481, 12528, 12402,   910, 11899,  8904,  8285,  2476,  7995,  9071])
-------Step 7-------
tensor([ 5836,   581, 13120, 10695,  3925, 12904,  8083,   138,  5136, 11071]) tensor([ 5629,  6040,  8925, 12815,  6694,  9090,  8202,   599, 12625,  6767])
-------Step 8-------
tensor([ 8481, 13458,  6517,  6277,  2655,  7909,  4010,  3120,   605,  6501]) tensor([ 7567, 13326, 11289, 13786,  6864, 10021,  6357,  2228,  2695,  8541])
-------Step 9-------
tensor([ 8481, 13458,  6517,  6277,  2655,  7909,  4010,  3120,   605,  6501]) tensor([ 2623, 14067,  3784, 12499,  2935,   577,  3599,  1756, 14711, 14418])
before start barrier
start train
[proc 0] 100 steps, total: 7.793, sample: 0.364, forward: 1.794, backward: 0.481, update: 0.277
E20240128 14:14:20.897023 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=1630
W20240128 14:14:20.974936 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=109, pq.top=109
W20240128 14:14:21.034174 245072 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.209 ms                  | 22.218 ms                 |
| Forward                   | 3.566 ms                  | 8.881 ms                  |
| Backward                  | 2.498 ms                  | 4.717 ms                  |
| Optimize                  | 1.940 ms                  | 4.415 ms                  |
| BarrierTimeBeforeRank0    | 308.310 us                | 17.372 ms                 |
| AfterBackward             | 17.602 ms                 | 22.205 ms                 |
| BlockToStepN              | 23.167 ms                 | 76.204 ms                 |
| OneStep                   | 57.518 ms                 | 116.409 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.133 ms                  | 2.526 ms                  |
| ProcessBack:UpdateCache   | 1.423 ms                  | 1.922 ms                  |
| ProcessBack:UpsertPq      | 12.697 ms                 | 17.841 ms                 |
| ProcessOneStep            | 17.570 ms                 | 22.185 ms                 |
| BlockToStepN              | 23.258 ms                 | 76.145 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 14:14:21.897053 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2307
W20240128 14:14:21.974071 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=124, pq.top=124
W20240128 14:14:22.040617 245072 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240128 14:14:22.897009 245072 parallel_pq_v2.h:76] insert failed, size(hashtable)=95
W20240128 14:14:22.974056 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240128 14:14:23.048594 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240128 14:14:23.897017 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=4875
W20240128 14:14:23.974181 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=155, pq.top=155
W20240128 14:14:24.050307 245072 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240128 14:14:24.897023 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=3465
W20240128 14:14:25.016907 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=170, pq.top=170
W20240128 14:14:25.057214 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240128 14:14:25.897028 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2138
W20240128 14:14:26.020112 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=185, pq.top=185
W20240128 14:14:26.063603 245072 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.236 ms                  | 23.580 ms                 |
| Forward                   | 3.619 ms                  | 6.567 ms                  |
| Backward                  | 2.477 ms                  | 4.260 ms                  |
| Optimize                  | 1.899 ms                  | 4.132 ms                  |
| BarrierTimeBeforeRank0    | 429.405 us                | 21.198 ms                 |
| AfterBackward             | 17.585 ms                 | 21.998 ms                 |
| BlockToStepN              | 29.242 ms                 | 67.556 ms                 |
| OneStep                   | 62.473 ms                 | 116.060 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.156 ms                  | 2.525 ms                  |
| ProcessBack:UpdateCache   | 1.421 ms                  | 1.874 ms                  |
| ProcessBack:UpsertPq      | 12.741 ms                 | 17.258 ms                 |
| ProcessOneStep            | 17.570 ms                 | 21.977 ms                 |
| BlockToStepN              | 29.191 ms                 | 67.469 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 14:14:26.898470 245072 parallel_pq_v2.h:76] insert failed, size(hashtable)=60
W20240128 14:14:27.031728 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=200, pq.top=200
[proc 3] 200 steps, total: 6.644, sample: 0.340, forward: 0.356, backward: 0.242, update: 0.185
[proc 1] 200 steps, total: 6.644, sample: 0.284, forward: 0.341, backward: 0.317, update: 0.170
[proc 0] 200 steps, total: 6.644, sample: 0.408, forward: 0.373, backward: 0.239, update: 0.204
[proc 2] 200 steps, total: 6.644, sample: 0.353, forward: 0.360, backward: 0.283, update: 0.185
W20240128 14:14:27.077405 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240128 14:14:27.898133 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2358
W20240128 14:14:28.031304 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=214, pq.top=214
W20240128 14:14:28.089248 245072 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240128 14:14:28.898010 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=4891
W20240128 14:14:29.031296 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=228, pq.top=228
W20240128 14:14:29.104784 245072 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240128 14:14:29.898031 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=6126
W20240128 14:14:30.058324 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=243, pq.top=243
W20240128 14:14:30.108811 245072 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240128 14:14:30.898007 244663 parallel_pq_v2.h:76] insert failed, size(hashtable)=2613
W20240128 14:14:31.074221 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=258, pq.top=258
W20240128 14:14:31.122597 245072 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.264 ms                  | 23.962 ms                 |
| Forward                   | 3.649 ms                  | 8.881 ms                  |
| Backward                  | 2.469 ms                  | 3.194 ms                  |
| Optimize                  | 1.912 ms                  | 4.238 ms                  |
| BarrierTimeBeforeRank0    | 395.727 us                | 20.973 ms                 |
| AfterBackward             | 17.710 ms                 | 31.681 ms                 |
| BlockToStepN              | 29.987 ms                 | 59.071 ms                 |
| OneStep                   | 64.033 ms                 | 106.643 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.175 ms                  | 2.937 ms                  |
| ProcessBack:UpdateCache   | 1.437 ms                  | 2.726 ms                  |
| ProcessBack:UpsertPq      | 12.993 ms                 | 25.769 ms                 |
| ProcessOneStep            | 17.706 ms                 | 32.097 ms                 |
| BlockToStepN              | 29.713 ms                 | 59.007 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 14:14:31.898043 244848 parallel_pq_v2.h:76] insert failed, size(hashtable)=2712
W20240128 14:14:32.102916 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=273, pq.top=273
W20240128 14:14:32.122867 245072 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240128 14:14:32.898016 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2536
W20240128 14:14:33.102497 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=287, pq.top=287
W20240128 14:14:33.122596 245072 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240128 14:14:33.898010 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=3262
[proc 3] 300 steps, total: 7.001, sample: 0.349, forward: 0.353, backward: 0.241, update: 0.183
[proc 1] 300 steps, total: 7.001, sample: 0.346, forward: 0.373, backward: 0.278, update: 0.177
[proc 2] 300 steps, total: 7.001, sample: 0.340, forward: 0.362, backward: 0.234, update: 0.183
[proc 0] 300 steps, total: 7.001, sample: 0.468, forward: 0.417, backward: 0.244, update: 0.216
W20240128 14:14:34.106848 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=301, pq.top=301
W20240128 14:14:34.147004 245072 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240128 14:14:34.899693 245072 parallel_pq_v2.h:76] insert failed, size(hashtable)=6
W20240128 14:14:35.155153 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=315, pq.top=315
W20240128 14:14:35.172526 245072 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240128 14:14:35.899019 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=3366
W20240128 14:14:36.166697 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=329, pq.top=329
W20240128 14:14:36.195660 245072 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.307 ms                  | 27.285 ms                 |
| Forward                   | 3.695 ms                  | 8.881 ms                  |
| Backward                  | 2.498 ms                  | 3.194 ms                  |
| Optimize                  | 1.855 ms                  | 4.238 ms                  |
| BarrierTimeBeforeRank0    | 356.161 us                | 21.198 ms                 |
| AfterBackward             | 18.003 ms                 | 32.652 ms                 |
| BlockToStepN              | 28.520 ms                 | 59.071 ms                 |
| OneStep                   | 65.725 ms                 | 106.643 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.197 ms                  | 3.039 ms                  |
| ProcessBack:UpdateCache   | 1.462 ms                  | 2.894 ms                  |
| ProcessBack:UpsertPq      | 13.598 ms                 | 26.490 ms                 |
| ProcessOneStep            | 18.019 ms                 | 32.626 ms                 |
| BlockToStepN              | 28.864 ms                 | 59.007 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 14:14:36.899013 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=5814
W20240128 14:14:37.191730 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=343, pq.top=343
W20240128 14:14:37.199637 245072 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240128 14:14:37.899546 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=3474
W20240128 14:14:38.191040 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=357, pq.top=357
W20240128 14:14:38.204967 245072 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240128 14:14:38.899448 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=1314
W20240128 14:14:39.205808 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240128 14:14:39.229198 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=371, pq.top=371
E20240128 14:14:39.899008 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=3631
W20240128 14:14:40.212906 245072 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240128 14:14:40.232276 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=385, pq.top=385
E20240128 14:14:40.899020 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2005
W20240128 14:14:41.214157 245072 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240128 14:14:41.249370 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=399, pq.top=399
[proc 2] 400 steps, total: 7.292, sample: 0.344, forward: 0.382, backward: 0.244, update: 0.171
[proc 3] 400 steps, total: 7.292, sample: 0.331, forward: 0.380, backward: 0.249, update: 0.164
[proc 0] 400 steps, total: 7.292, sample: 0.420, forward: 0.385, backward: 0.251, update: 0.201
[proc 1] 400 steps, total: 7.292, sample: 0.387, forward: 0.388, backward: 0.276, update: 0.161
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.372 ms                  | 28.036 ms                 |
| Forward                   | 3.720 ms                  | 6.891 ms                  |
| Backward                  | 2.509 ms                  | 3.029 ms                  |
| Optimize                  | 1.831 ms                  | 4.259 ms                  |
| BarrierTimeBeforeRank0    | 343.347 us                | 21.276 ms                 |
| AfterBackward             | 18.284 ms                 | 32.552 ms                 |
| BlockToStepN              | 28.559 ms                 | 59.071 ms                 |
| OneStep                   | 66.969 ms                 | 102.708 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.216 ms                  | 3.043 ms                  |
| ProcessBack:UpdateCache   | 1.460 ms                  | 2.847 ms                  |
| ProcessBack:UpsertPq      | 14.077 ms                 | 26.463 ms                 |
| ProcessOneStep            | 18.273 ms                 | 32.395 ms                 |
| BlockToStepN              | 28.478 ms                 | 59.007 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 14:14:41.899017 244848 parallel_pq_v2.h:76] insert failed, size(hashtable)=2398
W20240128 14:14:42.214066 245072 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240128 14:14:42.251498 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=413, pq.top=413
E20240128 14:14:42.899019 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=6318
W20240128 14:14:43.219777 245072 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240128 14:14:43.252429 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=426, pq.top=426
E20240128 14:14:43.899011 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=2453
W20240128 14:14:44.224709 245072 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240128 14:14:44.252092 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=439, pq.top=439
E20240128 14:14:44.899070 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=1866
W20240128 14:14:45.231977 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240128 14:14:45.252144 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=451, pq.top=451
E20240128 14:14:45.899015 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=5194
W20240128 14:14:46.253063 245072 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240128 14:14:46.288295 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=465, pq.top=465
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.439 ms                  | 28.952 ms                 |
| Forward                   | 3.770 ms                  | 6.567 ms                  |
| Backward                  | 2.509 ms                  | 2.924 ms                  |
| Optimize                  | 1.829 ms                  | 4.271 ms                  |
| BarrierTimeBeforeRank0    | 297.424 us                | 21.276 ms                 |
| AfterBackward             | 19.264 ms                 | 32.294 ms                 |
| BlockToStepN              | 29.126 ms                 | 67.556 ms                 |
| OneStep                   | 67.837 ms                 | 106.643 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.256 ms                  | 3.089 ms                  |
| ProcessBack:UpdateCache   | 1.466 ms                  | 2.846 ms                  |
| ProcessBack:UpsertPq      | 14.571 ms                 | 26.395 ms                 |
| ProcessOneStep            | 19.432 ms                 | 32.269 ms                 |
| BlockToStepN              | 29.127 ms                 | 67.469 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 14:14:46.899019 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=5265
W20240128 14:14:47.257853 245072 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240128 14:14:47.302692 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=479, pq.top=479
E20240128 14:14:47.899029 244848 parallel_pq_v2.h:76] insert failed, size(hashtable)=506
W20240128 14:14:48.270450 245072 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240128 14:14:48.302938 244663 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=491, pq.top=491
E20240128 14:14:48.899014 245071 parallel_pq_v2.h:76] insert failed, size(hashtable)=5959
[proc 3] 500 steps, total: 7.609, sample: 0.356, forward: 0.372, backward: 0.254, update: 0.169
[proc 1] 500 steps, total: 7.609, sample: 0.354, forward: 0.388, backward: 0.274, update: 0.176
[proc 2] 500 steps, total: 7.609, sample: 0.248, forward: 0.354, backward: 0.241, update: 0.171
[proc 0] 500 steps, total: 7.609, sample: 0.524, forward: 0.396, backward: 0.246, update: 0.187
Successfully xmh. training takes 36.34024000167847 seconds
before call kg_cache_controller.StopThreads()
W20240128 14:14:48.965036 244663 grad_async_v2.h:71] call StopThreads. PID = 244321
W20240128 14:14:48.965070 244663 grad_base.h:212] before processOneStepNegThread_.join();
W20240128 14:14:48.965332 244663 grad_base.h:214] after processOneStepNegThread_.join();
W20240128 14:14:48.965340 244663 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240128 14:14:48.975401 244663 grad_async_v2.h:91] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f2fbea4dfd0>

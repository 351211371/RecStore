WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240128 16:32:39.626596 495931 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='ComplEx', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/ComplEx_FB15k_34', no_save_emb=True, max_step=500, batch_size=1800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [495931 sampler.py:454] Start PreSampling
WARNING [495931 sampler.py:532] Before construct renumbering_dict
WARNING [495931 sampler.py:555] PreSampling done
W20240128 16:32:41.922346 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240128 16:32:41.922497 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240128 16:32:41.922526 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240128 16:32:41.922547 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240128 16:32:41.922572 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240128 16:32:41.922595 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240128 16:32:41.922618 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240128 16:32:41.922649 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240128 16:32:41.922669 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240128 16:32:41.922689 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240128 16:32:41.922713 495931 IPCTensor.h:368] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240128 16:32:41.922731 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240128 16:32:41.922748 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240128 16:32:41.922837 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240128 16:32:41.922863 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240128 16:32:41.922881 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240128 16:32:41.922920 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240128 16:32:41.922943 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240128 16:32:41.922966 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240128 16:32:41.922984 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240128 16:32:41.923005 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240128 16:32:41.923027 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240128 16:32:41.923048 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240128 16:32:41.923067 495931 IPCTensor.h:368] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240128 16:32:41.923084 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240128 16:32:41.923099 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240128 16:32:41.923135 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240128 16:32:41.923163 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240128 16:32:41.923180 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240128 16:32:41.923203 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240128 16:32:41.923223 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240128 16:32:41.923247 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240128 16:32:41.923266 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240128 16:32:41.923285 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240128 16:32:41.923306 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240128 16:32:41.923331 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240128 16:32:41.923348 495931 IPCTensor.h:368] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240128 16:32:41.923364 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240128 16:32:41.923379 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240128 16:32:41.923413 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240128 16:32:41.923437 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240128 16:32:41.923454 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240128 16:32:41.923475 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240128 16:32:41.923496 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240128 16:32:41.923513 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240128 16:32:41.923538 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240128 16:32:41.923559 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240128 16:32:41.923579 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240128 16:32:41.923597 495931 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240128 16:32:41.923614 495931 IPCTensor.h:368] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240128 16:32:41.923629 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240128 16:32:41.923648 495931 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240128 16:32:42.053228 495931 IPCTensor.h:368] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240128 16:32:42.053351 495931 IPCTensor.h:368] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 846, 1054, 1129,  ..., 1756, 6831, 7318]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.452 seconds
[Rank1] pid = 496188
[Rank2] pid = 496252
INFO [495931 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [496252 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [496252 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [496253 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [496253 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [496188 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [496188 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [495931 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [496253 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [496252 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [496188 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [495931 DistTensor.py:56] The tensor name already exists in the kvstore
I20240128 16:32:45.230466 496254 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240128 16:32:45.230547 496318 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 16:32:45.230633 496317 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 16:32:45.230726 496189 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240128 16:32:46.615057 496318 recstore.cc:66] init folly done
E20240128 16:32:46.615084 496189 recstore.cc:66] init folly done
E20240128 16:32:46.615089 496317 recstore.cc:66] init folly done
E20240128 16:32:46.615178 496254 recstore.cc:66] init folly done
I20240128 16:32:46.675063 496189 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240128 16:32:46.694200 496318 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 16:32:46.700928 496254 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 16:32:46.702953 496317 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 631.314 us                | 631.314 us                |
| bucket keys               | 793.671 us                | 159.357 ms                |
| forward: a2a keys         | 8.715 ms                  | 1.914 s                   |
| forward: search cache     | 117.189 us                | 24.937 ms                 |
| forward: a2a values       | 2.350 ms                  | 3.881 ms                  |
| forward: join             | 1.377 ms                  | 3.168 ms                  |
| Forward                   | 2.640 s                   | 2.640 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.682 ms                  | 29.819 ms                 |
| bucket keys               | 1.891 ms                  | 2.256 ms                  |
| forward: a2a keys         | 2.341 ms                  | 9.117 ms                  |
| forward: search cache     | 307.986 us                | 380.144 us                |
| forward: a2a values       | 2.674 ms                  | 3.690 ms                  |
| forward: join             | 2.460 ms                  | 2.905 ms                  |
| Forward                   | 27.914 ms                 | 2.640 s                   |
| back: aggr dram keys      | 23.452 ms                 | 29.236 ms                 |
| back: set dram grad       | 2.002 ms                  | 4.360 ms                  |
| back: a2a grad            | 3.179 ms                  | 4.698 ms                  |
| back: grad sum & grad cache  | 1.349 ms                  | 1.996 ms                  |
| Backward                  | 62.795 ms                 | 2.578 s                   |
| Optimize                  | 15.428 ms                 | 53.466 ms                 |
| BarrierTimeBeforeRank0    | 59.470 us                 | 96.740 us                 |
| BlockToStepN              | 23.439 us                 | 182.133 us                |
| OneStep                   | 109.947 ms                | 5.273 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.824 ms                  | 30.283 ms                 |
| bucket keys               | 1.961 ms                  | 2.527 ms                  |
| forward: a2a keys         | 2.148 ms                  | 21.755 ms                 |
| forward: search cache     | 319.254 us                | 394.864 us                |
| forward: a2a values       | 2.717 ms                  | 3.881 ms                  |
| forward: join             | 2.668 ms                  | 4.181 ms                  |
| Forward                   | 28.522 ms                 | 41.855 ms                 |
| back: aggr dram keys      | 23.621 ms                 | 29.236 ms                 |
| back: set dram grad       | 2.003 ms                  | 4.507 ms                  |
| back: a2a grad            | 3.152 ms                  | 4.698 ms                  |
| back: grad sum & grad cache  | 1.563 ms                  | 2.206 ms                  |
| Backward                  | 63.191 ms                 | 70.045 ms                 |
| Optimize                  | 15.771 ms                 | 26.073 ms                 |
| BarrierTimeBeforeRank0    | 59.590 us                 | 96.740 us                 |
| BlockToStepN              | 24.245 us                 | 167.152 us                |
| OneStep                   | 111.007 ms                | 145.861 ms                |
+---------------------------+---------------------------+---------------------------+
[Rank3] pid = 496253
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 7255,  4134, 10616,  7664,  8912,  3697,   644,  3842, 12060,  9823]) tensor([ 1129,  8041, 10696,   680,  8751,  6865, 11318,  7146,  7954,  7112])
-------Step 1-------
tensor([ 7255,  4134, 10616,  7664,  8912,  3697,   644,  3842, 12060,  9823]) tensor([ 9661, 11476,   976,  3570,  1872, 11443,  5455,  2513,  1993, 14779])
-------Step 2-------
tensor([11393,  6329,  6361,  6346,  1494,  5987,  6429,  2392, 11468,   169]) tensor([ 8792,  4531,  3319, 11274,  7646,   684,  3453, 13186, 10986,  3184])
-------Step 3-------
tensor([11393,  6329,  6361,  6346,  1494,  5987,  6429,  2392, 11468,   169]) tensor([ 9533,   274,  4117,   185, 12545,  9486, 13189, 10754, 14703,  5645])
-------Step 4-------
tensor([12515,  4451,   543,    48, 12730, 11695, 14480,  9054,  7984,  6135]) tensor([ 2882,  8422,  6547,  9967,  8539, 12636,  1300,  2314, 12277, 13545])
-------Step 5-------
tensor([12515,  4451,   543,    48, 12730, 11695, 14480,  9054,  7984,  6135]) tensor([12151,  9197, 11582,   561,  1416,  8191,  5572, 13446, 12800, 14304])
-------Step 6-------
tensor([  123,     4,  3208, 11488, 12799,    96,  7928,   115,  2388,   173]) tensor([ 5757, 13399,  8689, 12950,  6212,  1479,  9875, 12491, 12249, 12909])
-------Step 7-------
tensor([  123,     4,  3208, 11488, 12799,    96,  7928,   115,  2388,   173]) tensor([11577, 12990,  7383, 11572,  8187, 13168, 12089, 14523, 14836,  9903])
-------Step 8-------
tensor([ 4977,  6971, 11505, 11226,  3458, 12952,  8388, 11265,  5311,  6329]) tensor([ 8776, 11525, 14437,   415, 11840, 10238,  5314,  1882,  6330, 10001])
-------Step 9-------
tensor([ 4977,  6971, 11505, 11226,  3458, 12952,  8388, 11265,  5311,  6329]) tensor([ 8043, 12726,  5473,  6186,  4304,  6214, 14064,  8243,  6908, 13581])
before start barrier
start train
[proc 0] 100 steps, total: 16.576, sample: 0.454, forward: 5.500, backward: 8.856, update: 1.634
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 16.574, sample: 0.354, forward: 5.500, backward: 8.881, update: 0.239
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 16.602, sample: 0.530, forward: 5.452, backward: 8.740, update: 0.301
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 16.583, sample: 0.530, forward: 5.454, backward: 8.723, update: 0.295
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.735 ms                  | 30.283 ms                 |
| bucket keys               | 1.948 ms                  | 2.470 ms                  |
| forward: a2a keys         | 2.289 ms                  | 18.153 ms                 |
| forward: search cache     | 313.416 us                | 393.661 us                |
| forward: a2a values       | 2.703 ms                  | 3.690 ms                  |
| forward: join             | 2.562 ms                  | 4.084 ms                  |
| Forward                   | 28.413 ms                 | 41.855 ms                 |
| back: aggr dram keys      | 23.742 ms                 | 29.632 ms                 |
| back: set dram grad       | 2.052 ms                  | 4.507 ms                  |
| back: a2a grad            | 3.106 ms                  | 4.149 ms                  |
| back: grad sum & grad cache  | 1.677 ms                  | 2.389 ms                  |
| Backward                  | 63.197 ms                 | 71.861 ms                 |
| Optimize                  | 15.635 ms                 | 27.801 ms                 |
| BarrierTimeBeforeRank0    | 57.360 us                 | 96.740 us                 |
| BlockToStepN              | 25.580 us                 | 167.152 us                |
| OneStep                   | 110.560 ms                | 147.102 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.731 ms                  | 30.251 ms                 |
| bucket keys               | 1.946 ms                  | 2.470 ms                  |
| forward: a2a keys         | 2.232 ms                  | 21.755 ms                 |
| forward: search cache     | 312.207 us                | 394.864 us                |
| forward: a2a values       | 2.624 ms                  | 3.690 ms                  |
| forward: join             | 2.532 ms                  | 4.195 ms                  |
| Forward                   | 28.413 ms                 | 54.189 ms                 |
| back: aggr dram keys      | 23.488 ms                 | 29.236 ms                 |
| back: set dram grad       | 2.002 ms                  | 4.399 ms                  |
| back: a2a grad            | 3.060 ms                  | 4.149 ms                  |
| back: grad sum & grad cache  | 1.756 ms                  | 2.358 ms                  |
| Backward                  | 63.064 ms                 | 70.736 ms                 |
| Optimize                  | 15.540 ms                 | 27.801 ms                 |
| BarrierTimeBeforeRank0    | 57.360 us                 | 91.997 us                 |
| BlockToStepN              | 25.607 us                 | 218.726 us                |
| OneStep                   | 110.682 ms                | 145.861 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 11.818, sample: 0.508, forward: 3.093, backward: 6.318, update: 1.765
[proc 2] 200 steps, total: 11.818, sample: 0.466, forward: 3.039, backward: 6.335, update: 0.209
[proc 1] 200 steps, total: 11.818, sample: 0.542, forward: 3.045, backward: 6.241, update: 0.231
[proc 3] 200 steps, total: 11.818, sample: 0.515, forward: 3.091, backward: 6.199, update: 0.278
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.732 ms                  | 30.283 ms                 |
| bucket keys               | 1.939 ms                  | 2.470 ms                  |
| forward: a2a keys         | 2.165 ms                  | 30.591 ms                 |
| forward: search cache     | 308.295 us                | 394.864 us                |
| forward: a2a values       | 2.565 ms                  | 3.596 ms                  |
| forward: join             | 2.500 ms                  | 4.253 ms                  |
| Forward                   | 28.717 ms                 | 54.593 ms                 |
| back: aggr dram keys      | 23.454 ms                 | 29.236 ms                 |
| back: set dram grad       | 2.020 ms                  | 4.395 ms                  |
| back: a2a grad            | 3.061 ms                  | 4.149 ms                  |
| back: grad sum & grad cache  | 1.756 ms                  | 2.390 ms                  |
| Backward                  | 63.197 ms                 | 71.139 ms                 |
| Optimize                  | 15.782 ms                 | 31.501 ms                 |
| BarrierTimeBeforeRank0    | 56.211 us                 | 91.997 us                 |
| BlockToStepN              | 25.434 us                 | 218.726 us                |
| OneStep                   | 112.070 ms                | 148.753 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.709 ms                  | 30.283 ms                 |
| bucket keys               | 1.799 ms                  | 2.461 ms                  |
| forward: a2a keys         | 2.280 ms                  | 30.759 ms                 |
| forward: search cache     | 284.355 us                | 393.661 us                |
| forward: a2a values       | 2.554 ms                  | 3.596 ms                  |
| forward: join             | 2.447 ms                  | 4.195 ms                  |
| Forward                   | 28.522 ms                 | 54.693 ms                 |
| back: aggr dram keys      | 23.559 ms                 | 29.236 ms                 |
| back: set dram grad       | 2.020 ms                  | 4.395 ms                  |
| back: a2a grad            | 3.061 ms                  | 3.963 ms                  |
| back: grad sum & grad cache  | 1.756 ms                  | 2.479 ms                  |
| Backward                  | 63.488 ms                 | 71.183 ms                 |
| Optimize                  | 15.705 ms                 | 31.744 ms                 |
| BarrierTimeBeforeRank0    | 55.357 us                 | 91.997 us                 |
| BlockToStepN              | 25.381 us                 | 218.726 us                |
| OneStep                   | 112.342 ms                | 148.753 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.675 ms                  | 30.283 ms                 |
| bucket keys               | 1.770 ms                  | 2.454 ms                  |
| forward: a2a keys         | 2.405 ms                  | 31.555 ms                 |
| forward: search cache     | 276.729 us                | 390.975 us                |
| forward: a2a values       | 2.550 ms                  | 3.575 ms                  |
| forward: join             | 2.403 ms                  | 4.181 ms                  |
| Forward                   | 28.411 ms                 | 54.957 ms                 |
| back: aggr dram keys      | 23.621 ms                 | 29.236 ms                 |
| back: set dram grad       | 2.039 ms                  | 5.050 ms                  |
| back: a2a grad            | 3.085 ms                  | 3.982 ms                  |
| back: grad sum & grad cache  | 1.756 ms                  | 2.479 ms                  |
| Backward                  | 63.686 ms                 | 71.183 ms                 |
| Optimize                  | 15.491 ms                 | 31.501 ms                 |
| BarrierTimeBeforeRank0    | 54.908 us                 | 91.997 us                 |
| BlockToStepN              | 25.220 us                 | 192.327 us                |
| OneStep                   | 112.497 ms                | 147.102 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 11.962, sample: 0.519, forward: 3.343, backward: 6.350, update: 0.242
[proc 0] 300 steps, total: 11.962, sample: 0.440, forward: 3.373, backward: 6.495, update: 1.532
[proc 2] 300 steps, total: 11.962, sample: 0.419, forward: 3.386, backward: 6.420, update: 0.231
[proc 3] 300 steps, total: 11.962, sample: 0.546, forward: 3.310, backward: 6.333, update: 0.260
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.673 ms                  | 30.366 ms                 |
| bucket keys               | 1.763 ms                  | 2.440 ms                  |
| forward: a2a keys         | 2.405 ms                  | 31.407 ms                 |
| forward: search cache     | 270.606 us                | 393.661 us                |
| forward: a2a values       | 2.538 ms                  | 3.573 ms                  |
| forward: join             | 2.380 ms                  | 4.181 ms                  |
| Forward                   | 28.522 ms                 | 56.139 ms                 |
| back: aggr dram keys      | 23.621 ms                 | 29.295 ms                 |
| back: set dram grad       | 2.112 ms                  | 5.102 ms                  |
| back: a2a grad            | 3.098 ms                  | 3.963 ms                  |
| back: grad sum & grad cache  | 1.800 ms                  | 2.591 ms                  |
| Backward                  | 63.900 ms                 | 71.861 ms                 |
| Optimize                  | 15.483 ms                 | 31.501 ms                 |
| BarrierTimeBeforeRank0    | 54.805 us                 | 91.997 us                 |
| BlockToStepN              | 25.131 us                 | 240.496 us                |
| OneStep                   | 113.406 ms                | 147.102 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.660 ms                  | 30.366 ms                 |
| bucket keys               | 1.754 ms                  | 2.440 ms                  |
| forward: a2a keys         | 2.432 ms                  | 31.555 ms                 |
| forward: search cache     | 267.713 us                | 394.864 us                |
| forward: a2a values       | 2.536 ms                  | 3.573 ms                  |
| forward: join             | 2.364 ms                  | 4.181 ms                  |
| Forward                   | 28.413 ms                 | 55.103 ms                 |
| back: aggr dram keys      | 23.585 ms                 | 29.295 ms                 |
| back: set dram grad       | 2.147 ms                  | 5.117 ms                  |
| back: a2a grad            | 3.125 ms                  | 3.982 ms                  |
| back: grad sum & grad cache  | 1.800 ms                  | 2.591 ms                  |
| Backward                  | 64.076 ms                 | 71.997 ms                 |
| Optimize                  | 15.332 ms                 | 29.847 ms                 |
| BarrierTimeBeforeRank0    | 54.465 us                 | 91.634 us                 |
| BlockToStepN              | 25.100 us                 | 218.726 us                |
| OneStep                   | 113.845 ms                | 146.708 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 12.081, sample: 0.253, forward: 3.474, backward: 6.621, update: 0.158
[proc 0] 400 steps, total: 12.081, sample: 0.518, forward: 3.360, backward: 6.569, update: 1.510
[proc 3] 400 steps, total: 12.081, sample: 0.553, forward: 3.359, backward: 6.412, update: 0.257
[proc 1] 400 steps, total: 12.081, sample: 0.516, forward: 3.400, backward: 6.426, update: 0.235
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.638 ms                  | 31.009 ms                 |
| bucket keys               | 1.751 ms                  | 2.440 ms                  |
| forward: a2a keys         | 2.462 ms                  | 32.087 ms                 |
| forward: search cache     | 266.044 us                | 399.314 us                |
| forward: a2a values       | 2.541 ms                  | 3.575 ms                  |
| forward: join             | 2.358 ms                  | 4.139 ms                  |
| Forward                   | 28.411 ms                 | 55.420 ms                 |
| back: aggr dram keys      | 23.559 ms                 | 29.632 ms                 |
| back: set dram grad       | 2.180 ms                  | 5.110 ms                  |
| back: a2a grad            | 3.136 ms                  | 3.982 ms                  |
| back: grad sum & grad cache  | 1.821 ms                  | 2.611 ms                  |
| Backward                  | 64.287 ms                 | 72.428 ms                 |
| Optimize                  | 15.230 ms                 | 29.847 ms                 |
| BarrierTimeBeforeRank0    | 54.105 us                 | 91.634 us                 |
| BlockToStepN              | 25.031 us                 | 240.496 us                |
| OneStep                   | 113.845 ms                | 146.708 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.643 ms                  | 31.009 ms                 |
| bucket keys               | 1.754 ms                  | 2.436 ms                  |
| forward: a2a keys         | 2.473 ms                  | 31.627 ms                 |
| forward: search cache     | 268.862 us                | 394.864 us                |
| forward: a2a values       | 2.550 ms                  | 3.573 ms                  |
| forward: join             | 2.376 ms                  | 4.139 ms                  |
| Forward                   | 28.391 ms                 | 55.130 ms                 |
| back: aggr dram keys      | 23.559 ms                 | 29.295 ms                 |
| back: set dram grad       | 2.195 ms                  | 5.110 ms                  |
| back: a2a grad            | 3.139 ms                  | 3.982 ms                  |
| back: grad sum & grad cache  | 1.821 ms                  | 2.610 ms                  |
| Backward                  | 64.422 ms                 | 72.354 ms                 |
| Optimize                  | 15.125 ms                 | 28.936 ms                 |
| BarrierTimeBeforeRank0    | 54.183 us                 | 89.630 us                 |
| BlockToStepN              | 25.095 us                 | 240.496 us                |
| OneStep                   | 113.602 ms                | 146.442 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.634 ms                  | 31.298 ms                 |
| bucket keys               | 1.758 ms                  | 2.434 ms                  |
| forward: a2a keys         | 2.501 ms                  | 31.555 ms                 |
| forward: search cache     | 269.424 us                | 393.661 us                |
| forward: a2a values       | 2.556 ms                  | 3.575 ms                  |
| forward: join             | 2.364 ms                  | 4.118 ms                  |
| Forward                   | 28.462 ms                 | 55.209 ms                 |
| back: aggr dram keys      | 23.552 ms                 | 29.295 ms                 |
| back: set dram grad       | 2.201 ms                  | 5.117 ms                  |
| back: a2a grad            | 3.152 ms                  | 3.963 ms                  |
| back: grad sum & grad cache  | 1.821 ms                  | 2.611 ms                  |
| Backward                  | 64.589 ms                 | 72.660 ms                 |
| Optimize                  | 14.905 ms                 | 29.847 ms                 |
| BarrierTimeBeforeRank0    | 54.183 us                 | 90.267 us                 |
| BlockToStepN              | 25.131 us                 | 240.496 us                |
| OneStep                   | 113.596 ms                | 146.442 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 11.888, sample: 0.203, forward: 3.244, backward: 6.644, update: 0.146
[proc 0] 500 steps, total: 11.888, sample: 0.480, forward: 3.173, backward: 6.540, update: 1.566
[proc 1] 500 steps, total: 11.888, sample: 0.520, forward: 3.156, backward: 6.413, update: 0.236
Successfully xmh. training takes 64.32605767250061 seconds
before call kg_cache_controller.StopThreads()
[proc 3] 500 steps, total: 11.888, sample: 0.538, forward: 3.150, backward: 6.376, update: 0.267
INFO [495931 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
INFO [495931 controller_process.py:421] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.647 ms                  | 31.298 ms                 |
| bucket keys               | 1.763 ms                  | 2.434 ms                  |
| forward: a2a keys         | 2.501 ms                  | 31.555 ms                 |
| forward: search cache     | 270.096 us                | 393.661 us                |
| forward: a2a values       | 2.557 ms                  | 3.575 ms                  |
| forward: join             | 2.379 ms                  | 4.118 ms                  |
| Forward                   | 28.497 ms                 | 55.209 ms                 |
| back: aggr dram keys      | 23.552 ms                 | 29.632 ms                 |
| back: set dram grad       | 2.204 ms                  | 5.117 ms                  |
| back: a2a grad            | 3.155 ms                  | 3.963 ms                  |
| back: grad sum & grad cache  | 1.821 ms                  | 2.656 ms                  |
| Backward                  | 64.604 ms                 | 72.660 ms                 |
| Optimize                  | 14.905 ms                 | 29.847 ms                 |
| BarrierTimeBeforeRank0    | 54.280 us                 | 90.267 us                 |
| BlockToStepN              | 25.240 us                 | 240.496 us                |
| OneStep                   | 113.607 ms                | 146.442 ms                |
+---------------------------+---------------------------+---------------------------+

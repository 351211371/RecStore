WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240128 12:58:12.278228 126409 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='DistMult', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/DistMult_FB15k_15', no_save_emb=True, max_step=500, batch_size=2400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.01, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [126409 sampler.py:454] Start PreSampling
WARNING [126409 sampler.py:532] Before construct renumbering_dict
WARNING [126409 sampler.py:555] PreSampling done
W20240128 12:58:14.897823 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240128 12:58:14.898036 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240128 12:58:14.898059 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240128 12:58:14.898092 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240128 12:58:14.898118 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240128 12:58:14.898137 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240128 12:58:14.898165 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240128 12:58:14.898207 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240128 12:58:14.898222 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240128 12:58:14.898242 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240128 12:58:14.898281 126409 IPCTensor.h:368] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240128 12:58:14.898298 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240128 12:58:14.898325 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240128 12:58:14.898453 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240128 12:58:14.898488 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240128 12:58:14.898520 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240128 12:58:14.898563 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240128 12:58:14.898598 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240128 12:58:14.898617 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240128 12:58:14.898655 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240128 12:58:14.898686 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240128 12:58:14.898713 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240128 12:58:14.898748 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240128 12:58:14.898762 126409 IPCTensor.h:368] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240128 12:58:14.898774 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240128 12:58:14.898797 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240128 12:58:14.898849 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240128 12:58:14.898877 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240128 12:58:14.898891 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240128 12:58:14.898903 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240128 12:58:14.898918 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240128 12:58:14.898950 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240128 12:58:14.898981 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240128 12:58:14.899000 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240128 12:58:14.899015 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240128 12:58:14.899034 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240128 12:58:14.899062 126409 IPCTensor.h:368] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240128 12:58:14.899075 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240128 12:58:14.899085 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240128 12:58:14.899128 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240128 12:58:14.899158 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240128 12:58:14.899171 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240128 12:58:14.899204 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240128 12:58:14.899224 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240128 12:58:14.899245 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240128 12:58:14.899258 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240128 12:58:14.899271 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240128 12:58:14.899295 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240128 12:58:14.899322 126409 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240128 12:58:14.899336 126409 IPCTensor.h:368] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240128 12:58:14.899348 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240128 12:58:14.899366 126409 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240128 12:58:15.107664 126409 IPCTensor.h:368] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240128 12:58:15.107800 126409 IPCTensor.h:368] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 37
Rank1: cached key size 37
Rank2: cached key size 37
Rank3: cached key size 37
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 267,  459,  538,  ..., 1350, 7859, 7903]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.862 seconds
[Rank1] pid = 126728
[Rank2] pid = 126793
INFO [126409 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [126728 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [126857 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [126857 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [126793 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [126793 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240128 12:58:18.239699 126794 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_2 [149, 400]; dev=2; size=232.8 kB
W20240128 12:58:18.240128 126794 IPCTensor.h:368] NewIPCTensor: input_keys_2 [1000000]0x100014876000 7.629 MB
W20240128 12:58:18.240242 126794 IPCTensor.h:368] NewIPCTensor: input_keys_neg_2 [1000000]0x100015019000 7.629 MB
W20240128 12:58:18.240286 126794 IPCTensor.h:368] NewIPCTensor: backward_grads_2 [1000000, 400]0x1000157bc000 1.49 GB
W20240128 12:58:18.240317 126794 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x100074d9f000 1.49 GB
W20240128 12:58:18.240347 126794 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240128 12:58:18.242152 126794 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240128 12:58:18.243422 126859 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_3 [149, 400]; dev=3; size=232.8 kB
W20240128 12:58:18.244732 126859 IPCTensor.h:368] NewIPCTensor: input_keys_3 [1000000]0x1000d4388000 7.629 MB
W20240128 12:58:18.245069 126859 IPCTensor.h:368] NewIPCTensor: input_keys_neg_3 [1000000]0x1000d4b2b000 7.629 MB
W20240128 12:58:18.245257 126859 IPCTensor.h:368] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000d52ce000 1.49 GB
W20240128 12:58:18.245357 126859 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1001348b1000 1.49 GB
W20240128 12:58:18.245445 126859 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
INFO [126728 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240128 12:58:18.247316 126729 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_1 [149, 400]; dev=1; size=232.8 kB
INFO [126409 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240128 12:58:18.248497 126858 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_0 [149, 400]; dev=0; size=232.8 kB
W20240128 12:58:18.251781 126729 IPCTensor.h:368] NewIPCTensor: input_keys_1 [1000000]0x100193e9a000 7.629 MB
W20240128 12:58:18.251801 126859 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240128 12:58:18.251859 126729 IPCTensor.h:368] NewIPCTensor: input_keys_neg_1 [1000000]0x100194de0000 7.629 MB
W20240128 12:58:18.251844 126858 IPCTensor.h:368] NewIPCTensor: input_keys_0 [1000000]0x10019463d000 7.629 MB
W20240128 12:58:18.251895 126729 IPCTensor.h:368] NewIPCTensor: backward_grads_1 [1000000, 400]0x100195583000 1.49 GB
W20240128 12:58:18.251915 126729 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001f4b66000 1.49 GB
W20240128 12:58:18.251937 126729 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240128 12:58:18.252007 126858 IPCTensor.h:368] NewIPCTensor: input_keys_neg_0 [1000000]0x100254149000 7.629 MB
W20240128 12:58:18.252090 126858 IPCTensor.h:368] NewIPCTensor: backward_grads_0 [1000000, 400]0x1002548ec000 1.49 GB
W20240128 12:58:18.252193 126858 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1002b3ecf000 1.49 GB
W20240128 12:58:18.252266 126858 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240128 12:58:18.261399 126729 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240128 12:58:18.261422 126858 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [126728 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [126857 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [126793 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 126857
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 149), (149, 298), (298, 447), (447, 596)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [126409 DistTensor.py:56] The tensor name already exists in the kvstore
I20240128 12:58:19.227164 126858 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240128 12:58:19.227227 126859 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 12:58:19.227273 126729 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 12:58:19.227340 126794 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240128 12:58:19.228585 126858 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.01,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240128 12:58:19.228678 126858 grad_base.h:184] Init GradProcessingBase done
I20240128 12:58:19.232766 126858 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240128 12:58:19.232872 126858 kg_controller.h:78] after init GradAsyncProcessingV2
I20240128 12:58:19.232877 126858 kg_controller.h:84] Construct KGCacheController done
I20240128 12:58:20.579412 126858 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240128 12:58:21.266511 127380 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240128 12:58:21.266886 127380 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240128 12:58:21.290977 126858 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240128 12:58:21.318866 126729 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 12:58:21.370625 126794 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 12:58:21.370721 126859 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240128 12:58:23.763199 126858 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240128 12:58:23.788352 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=0
W20240128 12:58:23.801344 127380 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.264 ms                  | 23.064 ms                 |
| Forward                   | 3.970 ms                  | 623.545 ms                |
| Backward                  | 2.617 ms                  | 285.988 ms                |
| Optimize                  | 1.741 ms                  | 43.124 ms                 |
| BarrierTimeBeforeRank0    | 717.295 us                | 536.619 ms                |
| AfterBackward             | 22.287 ms                 | 926.874 ms                |
| BlockToStepN              | 60.738 us                 | 32.112 ms                 |
| OneStep                   | 49.172 ms                 | 2.429 s                   |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:24.763011 127380 parallel_pq_v2.h:76] insert failed, size(hashtable)=95
W20240128 12:58:24.809780 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=23, pq.top=23
W20240128 12:58:24.856740 127380 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.073 ms                  | 72.926 ms                 |
| ProcessBack:UpdateCache   | 1.433 ms                  | 276.612 ms                |
| ProcessBack:UpsertPq      | 18.532 ms                 | 24.598 ms                 |
| ProcessOneStep            | 23.275 ms                 | 926.475 ms                |
| BlockToStepN              | 10.511 ms                 | 34.403 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:25.763100 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=4876
W20240128 12:58:25.809020 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=41, pq.top=41
W20240128 12:58:25.869931 127380 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
E20240128 12:58:26.763207 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2343
W20240128 12:58:26.832422 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=57, pq.top=57
W20240128 12:58:26.915782 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240128 12:58:27.763031 126858 parallel_pq_v2.h:76] insert failed, size(hashtable)=2467
W20240128 12:58:27.832062 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=73, pq.top=73
W20240128 12:58:27.917053 127380 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240128 12:58:28.763092 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1887
W20240128 12:58:28.832027 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=90, pq.top=90
W20240128 12:58:28.923847 127380 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.414 ms                  | 24.649 ms                 |
| Forward                   | 3.690 ms                  | 7.183 ms                  |
| Backward                  | 2.436 ms                  | 4.072 ms                  |
| Optimize                  | 1.686 ms                  | 4.555 ms                  |
| BarrierTimeBeforeRank0    | 419.522 us                | 9.368 ms                  |
| AfterBackward             | 23.140 ms                 | 35.640 ms                 |
| BlockToStepN              | 18.210 ms                 | 82.473 ms                 |
| OneStep                   | 53.852 ms                 | 126.441 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 8.081, sample: 0.312, forward: 1.414, backward: 0.648, update: 0.235
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 8.081, sample: 0.342, forward: 1.050, backward: 0.463, update: 0.265
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 8.133, sample: 0.231, forward: 1.324, backward: 0.585, update: 0.238
train_sampler.Prefill()
-------Step 0-------
tensor([ 6636,  1785,  8344,  6350,  9133,  3274, 11364,  4620, 10957, 10610]) tensor([  538,  7507,  8405,  3815,  9694,  6281, 13976,  6542,  8551,  6798])
-------Step 1-------
tensor([ 6636,  1785,  8344,  6350,  9133,  3274, 11364,  4620, 10957, 10610]) tensor([  839,   232,  6006,  3547, 11163,    34, 14219,  5815,  6092,  8320])
-------Step 2-------
tensor([ 1917,  7693, 11582,    23,  4572,  6141, 12823,  3284,  1656,  1015]) tensor([14633,  5636, 11418, 11546,  3641, 10650,  6860,    77, 10313,  6415])
-------Step 3-------
tensor([ 1917,  7693, 11582,    23,  4572,  6141, 12823,  3284,  1656,  1015]) tensor([ 7772, 13869,  3025,  7915,  4237,  7231,     4,  8111,  7374, 13380])
-------Step 4-------
tensor([10447, 10648, 14062,  6562,  5730,  7377,   450,  5989,  5040,  8825]) tensor([ 7884, 11747, 14727,   550, 11676, 11284,  1262,  4490,  8521,  9278])
-------Step 5-------
tensor([10447, 10648, 14062,  6562,  5730,  7377,   450,  5989,  5040,  8825]) tensor([ 4228, 10144,  3590, 10673,  7489, 10243,  3752,   271, 14082,   982])
-------Step 6-------
tensor([ 5487,  6390,  6780, 11299,     3, 12175,  8794, 12108,  5627,  8473]) tensor([11237, 12325, 14849,    93, 12917,  8567,  4852,  1363,  6016, 10451])
-------Step 7-------
tensor([ 5487,  6390,  6780, 11299,     3, 12175,  8794, 12108,  5627,  8473]) tensor([ 4710,  6381, 10433,  6186,  6293,  8575,  6069, 13491, 13992,  7237])
-------Step 8-------
tensor([11027, 13543,    12,  6723,   747,  3434,  2674,  2838,  2491,  5932]) tensor([ 8233,  6042, 14106, 14477,  8154,  7791,  6709,  1343,   807,  9608])
-------Step 9-------
tensor([11027, 13543,    12,  6723,   747,  3434,  2674,  2838,  2491,  5932]) tensor([  730, 13483,    37, 14003,  1709,  5422,  2907,   292,  8570, 14072])
before start barrier
start train
[proc 0] 100 steps, total: 8.160, sample: 0.373, forward: 0.999, backward: 0.532, update: 0.233
E20240128 12:58:29.763012 126858 parallel_pq_v2.h:76] insert failed, size(hashtable)=2500
W20240128 12:58:29.838591 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=106, pq.top=106
W20240128 12:58:29.941309 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.208 ms                  | 2.654 ms                  |
| ProcessBack:UpdateCache   | 1.711 ms                  | 8.095 ms                  |
| ProcessBack:UpsertPq      | 18.379 ms                 | 24.899 ms                 |
| ProcessOneStep            | 23.151 ms                 | 35.615 ms                 |
| BlockToStepN              | 20.120 ms                 | 82.399 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:30.763027 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2115
W20240128 12:58:30.838052 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=121, pq.top=121
W20240128 12:58:30.942838 127380 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240128 12:58:31.763051 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1396
W20240128 12:58:31.838083 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=136, pq.top=136
W20240128 12:58:31.942960 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240128 12:58:32.763053 127154 parallel_pq_v2.h:76] insert failed, size(hashtable)=1408
W20240128 12:58:32.854503 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=150, pq.top=150
W20240128 12:58:32.971626 127380 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240128 12:58:33.763017 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=3483
W20240128 12:58:33.871716 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=163, pq.top=163
W20240128 12:58:33.978801 127380 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.399 ms                  | 26.110 ms                 |
| Forward                   | 3.980 ms                  | 7.183 ms                  |
| Backward                  | 2.473 ms                  | 3.762 ms                  |
| Optimize                  | 1.741 ms                  | 4.304 ms                  |
| BarrierTimeBeforeRank0    | 207.400 us                | 19.517 ms                 |
| AfterBackward             | 22.210 ms                 | 31.682 ms                 |
| BlockToStepN              | 24.592 ms                 | 68.282 ms                 |
| OneStep                   | 62.529 ms                 | 119.108 ms                |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:34.763025 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1527
W20240128 12:58:34.871150 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=176, pq.top=176
W20240128 12:58:34.979146 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.206 ms                  | 2.654 ms                  |
| ProcessBack:UpdateCache   | 1.700 ms                  | 4.346 ms                  |
| ProcessBack:UpsertPq      | 16.533 ms                 | 24.672 ms                 |
| ProcessOneStep            | 21.732 ms                 | 31.649 ms                 |
| BlockToStepN              | 25.164 ms                 | 68.237 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:35.763017 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2711
W20240128 12:58:35.900482 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=189, pq.top=189
W20240128 12:58:35.995049 127380 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240128 12:58:36.763018 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1763
[proc 3] 200 steps, total: 7.344, sample: 0.364, forward: 0.367, backward: 0.240, update: 0.168
[proc 2] 200 steps, total: 7.344, sample: 0.293, forward: 0.312, backward: 0.263, update: 0.174
[proc 0] 200 steps, total: 7.344, sample: 0.448, forward: 0.421, backward: 0.259, update: 0.208
[proc 1] 200 steps, total: 7.344, sample: 0.266, forward: 0.322, backward: 0.245, update: 0.188
W20240128 12:58:36.903159 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=202, pq.top=202
W20240128 12:58:36.996125 127380 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240128 12:58:37.763011 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1106
W20240128 12:58:37.927423 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=215, pq.top=215
W20240128 12:58:37.998728 127380 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240128 12:58:38.763068 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=4582
W20240128 12:58:38.960028 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=228, pq.top=228
W20240128 12:58:39.000011 127380 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.386 ms                  | 26.423 ms                 |
| Forward                   | 3.974 ms                  | 7.595 ms                  |
| Backward                  | 2.555 ms                  | 4.820 ms                  |
| Optimize                  | 1.754 ms                  | 4.555 ms                  |
| BarrierTimeBeforeRank0    | 41.624 us                 | 19.517 ms                 |
| AfterBackward             | 21.189 ms                 | 31.682 ms                 |
| BlockToStepN              | 28.841 ms                 | 68.370 ms                 |
| OneStep                   | 65.492 ms                 | 119.108 ms                |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:39.763008 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1680
W20240128 12:58:39.980810 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=242, pq.top=242
W20240128 12:58:40.006510 127380 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.235 ms                  | 3.937 ms                  |
| ProcessBack:UpdateCache   | 1.747 ms                  | 4.263 ms                  |
| ProcessBack:UpsertPq      | 16.158 ms                 | 24.660 ms                 |
| ProcessOneStep            | 21.061 ms                 | 31.649 ms                 |
| BlockToStepN              | 29.746 ms                 | 69.703 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:40.763017 127154 parallel_pq_v2.h:76] insert failed, size(hashtable)=742
W20240128 12:58:40.985736 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=255, pq.top=255
W20240128 12:58:41.055872 127380 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240128 12:58:41.763250 127380 parallel_pq_v2.h:76] insert failed, size(hashtable)=105
W20240128 12:58:41.985441 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=267, pq.top=267
W20240128 12:58:42.067911 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240128 12:58:42.763010 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=3547
W20240128 12:58:42.985373 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=279, pq.top=279
W20240128 12:58:43.068416 127380 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240128 12:58:43.763012 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=3087
W20240128 12:58:43.992311 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=291, pq.top=291
W20240128 12:58:44.091624 127380 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.380 ms                  | 27.683 ms                 |
| Forward                   | 3.998 ms                  | 7.183 ms                  |
| Backward                  | 2.722 ms                  | 4.977 ms                  |
| Optimize                  | 1.777 ms                  | 4.428 ms                  |
| BarrierTimeBeforeRank0    | 41.931 us                 | 21.729 ms                 |
| AfterBackward             | 21.036 ms                 | 30.672 ms                 |
| BlockToStepN              | 31.252 ms                 | 69.780 ms                 |
| OneStep                   | 70.333 ms                 | 115.751 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 7.943, sample: 0.264, forward: 0.321, backward: 0.244, update: 0.174
[proc 2] 300 steps, total: 7.943, sample: 0.275, forward: 0.307, backward: 0.315, update: 0.184
[proc 3] 300 steps, total: 7.943, sample: 0.386, forward: 0.351, backward: 0.244, update: 0.156
[proc 0] 300 steps, total: 7.943, sample: 0.459, forward: 0.417, backward: 0.298, update: 0.220
E20240128 12:58:44.763012 126858 parallel_pq_v2.h:76] insert failed, size(hashtable)=701
W20240128 12:58:44.992465 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=303, pq.top=303
W20240128 12:58:45.096951 127380 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.247 ms                  | 3.139 ms                  |
| ProcessBack:UpdateCache   | 1.761 ms                  | 2.611 ms                  |
| ProcessBack:UpsertPq      | 16.079 ms                 | 24.598 ms                 |
| ProcessOneStep            | 20.944 ms                 | 30.649 ms                 |
| BlockToStepN              | 31.919 ms                 | 69.708 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:45.763010 126858 parallel_pq_v2.h:76] insert failed, size(hashtable)=900
W20240128 12:58:46.008802 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=316, pq.top=316
W20240128 12:58:46.121608 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240128 12:58:46.763010 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=4901
W20240128 12:58:47.008116 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=329, pq.top=329
W20240128 12:58:47.122829 127380 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240128 12:58:47.763025 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2327
W20240128 12:58:48.036036 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=342, pq.top=342
W20240128 12:58:48.122666 127380 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240128 12:58:48.763132 127380 parallel_pq_v2.h:76] insert failed, size(hashtable)=94
W20240128 12:58:49.091524 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=355, pq.top=355
W20240128 12:58:49.131548 127380 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.386 ms                  | 26.941 ms                 |
| Forward                   | 4.006 ms                  | 6.956 ms                  |
| Backward                  | 2.730 ms                  | 4.977 ms                  |
| Optimize                  | 1.778 ms                  | 4.419 ms                  |
| BarrierTimeBeforeRank0    | 40.802 us                 | 21.729 ms                 |
| AfterBackward             | 20.793 ms                 | 29.951 ms                 |
| BlockToStepN              | 32.904 ms                 | 69.802 ms                 |
| OneStep                   | 72.551 ms                 | 115.516 ms                |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:49.767565 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2187
W20240128 12:58:50.091620 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=367, pq.top=367
W20240128 12:58:50.156296 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.241 ms                  | 3.056 ms                  |
| ProcessBack:UpdateCache   | 1.742 ms                  | 2.605 ms                  |
| ProcessBack:UpsertPq      | 15.942 ms                 | 24.535 ms                 |
| ProcessOneStep            | 20.823 ms                 | 29.927 ms                 |
| BlockToStepN              | 33.165 ms                 | 71.756 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:50.767064 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=5183
W20240128 12:58:51.116578 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=379, pq.top=379
W20240128 12:58:51.173857 127380 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240128 12:58:51.767009 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=5350
W20240128 12:58:52.120874 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=391, pq.top=391
W20240128 12:58:52.186039 127380 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240128 12:58:52.767009 126858 parallel_pq_v2.h:76] insert failed, size(hashtable)=928
[proc 1] 400 steps, total: 8.146, sample: 0.363, forward: 0.369, backward: 0.233, update: 0.222
[proc 3] 400 steps, total: 8.146, sample: 0.293, forward: 0.347, backward: 0.243, update: 0.152
[proc 2] 400 steps, total: 8.146, sample: 0.242, forward: 0.297, backward: 0.270, update: 0.178
[proc 0] 400 steps, total: 8.146, sample: 0.447, forward: 0.410, backward: 0.268, update: 0.223
W20240128 12:58:53.120484 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=403, pq.top=403
W20240128 12:58:53.197615 127380 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240128 12:58:53.768002 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=4962
W20240128 12:58:54.120771 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=416, pq.top=416
W20240128 12:58:54.199162 127380 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.397 ms                  | 27.206 ms                 |
| Forward                   | 3.998 ms                  | 6.956 ms                  |
| Backward                  | 2.753 ms                  | 4.977 ms                  |
| Optimize                  | 1.776 ms                  | 4.419 ms                  |
| BarrierTimeBeforeRank0    | 40.435 us                 | 21.729 ms                 |
| AfterBackward             | 20.692 ms                 | 29.951 ms                 |
| BlockToStepN              | 34.062 ms                 | 80.426 ms                 |
| OneStep                   | 74.135 ms                 | 115.751 ms                |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:54.767009 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=3377
W20240128 12:58:55.162567 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=428, pq.top=428
W20240128 12:58:55.200524 127380 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.238 ms                  | 2.654 ms                  |
| ProcessBack:UpdateCache   | 1.693 ms                  | 2.563 ms                  |
| ProcessBack:UpsertPq      | 15.819 ms                 | 24.433 ms                 |
| ProcessOneStep            | 20.627 ms                 | 29.927 ms                 |
| BlockToStepN              | 34.257 ms                 | 80.340 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:58:55.767028 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2349
W20240128 12:58:56.203627 127380 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240128 12:58:56.218266 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=441, pq.top=441
E20240128 12:58:56.767015 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1750
W20240128 12:58:57.206985 127380 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240128 12:58:57.238299 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=454, pq.top=454
E20240128 12:58:57.767024 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2087
W20240128 12:58:58.208214 127380 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240128 12:58:58.238564 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=466, pq.top=466
E20240128 12:58:58.767021 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=2140
W20240128 12:58:59.214155 127380 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.405 ms                  | 28.353 ms                 |
| Forward                   | 4.006 ms                  | 6.356 ms                  |
| Backward                  | 2.757 ms                  | 4.955 ms                  |
| Optimize                  | 1.784 ms                  | 4.406 ms                  |
| BarrierTimeBeforeRank0    | 39.915 us                 | 21.729 ms                 |
| AfterBackward             | 20.531 ms                 | 29.798 ms                 |
| BlockToStepN              | 34.893 ms                 | 76.982 ms                 |
| OneStep                   | 75.157 ms                 | 115.751 ms                |
+---------------------------+---------------------------+---------------------------+
W20240128 12:58:59.250357 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=478, pq.top=478
E20240128 12:58:59.767050 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1814
W20240128 12:59:00.219074 127380 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240128 12:59:00.276022 126858 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=490, pq.top=490
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.238 ms                  | 3.056 ms                  |
| ProcessBack:UpdateCache   | 1.647 ms                  | 2.560 ms                  |
| ProcessBack:UpsertPq      | 15.698 ms                 | 23.965 ms                 |
| ProcessOneStep            | 20.488 ms                 | 29.774 ms                 |
| BlockToStepN              | 35.302 ms                 | 76.897 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240128 12:59:00.767267 127379 parallel_pq_v2.h:76] insert failed, size(hashtable)=1775
[proc 3] 500 steps, total: 8.208, sample: 0.364, forward: 0.368, backward: 0.243, update: 0.171
[proc 2] 500 steps, total: 8.208, sample: 0.268, forward: 0.300, backward: 0.264, update: 0.181
[proc 1] 500 steps, total: 8.209, sample: 0.317, forward: 0.354, backward: 0.241, update: 0.183
[proc 0] 500 steps, total: 8.208, sample: 0.492, forward: 0.421, backward: 0.270, update: 0.225
Successfully xmh. training takes 39.80317974090576 seconds
before call kg_cache_controller.StopThreads()
W20240128 12:59:01.094215 126858 grad_async_v2.h:71] call StopThreads. PID = 126409
W20240128 12:59:01.094251 126858 grad_base.h:212] before processOneStepNegThread_.join();
W20240128 12:59:01.094445 126858 grad_base.h:214] after processOneStepNegThread_.join();
W20240128 12:59:01.094455 126858 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240128 12:59:01.103621 126858 grad_async_v2.h:91] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fa27f85a2d0>

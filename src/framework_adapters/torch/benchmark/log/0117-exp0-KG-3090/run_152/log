WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240124 22:41:33.211035 52929 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='DistMult', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/DistMult_Freebase_7', no_save_emb=True, max_step=500, batch_size=800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [52929 sampler.py:454] Start PreSampling
WARNING [52929 sampler.py:532] Before construct renumbering_dict
WARNING [52929 sampler.py:555] PreSampling done
W20240124 22:53:51.594095 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240124 22:53:51.594341 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240124 22:53:51.594372 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240124 22:53:51.594399 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240124 22:53:51.594420 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240124 22:53:51.594452 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240124 22:53:51.594478 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240124 22:53:51.594508 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240124 22:53:51.594537 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240124 22:53:51.594559 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240124 22:53:51.594585 52929 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240124 22:53:51.594604 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240124 22:53:51.594621 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240124 22:53:51.594764 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240124 22:53:51.594797 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240124 22:53:51.594825 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240124 22:53:51.594861 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240124 22:53:51.594887 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240124 22:53:51.594918 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240124 22:53:51.594935 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240124 22:53:51.594960 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240124 22:53:51.594982 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240124 22:53:51.595007 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240124 22:53:51.595026 52929 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240124 22:53:51.595041 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240124 22:53:51.595057 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240124 22:53:51.595099 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240124 22:53:51.595129 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240124 22:53:51.595155 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240124 22:53:51.595181 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240124 22:53:51.595209 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240124 22:53:51.595235 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240124 22:53:51.595259 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240124 22:53:51.595276 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240124 22:53:51.595296 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240124 22:53:51.595312 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240124 22:53:51.595331 52929 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240124 22:53:51.595346 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240124 22:53:51.595360 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240124 22:53:51.595396 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240124 22:53:51.595415 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240124 22:53:51.595432 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240124 22:53:51.595451 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240124 22:53:51.595469 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240124 22:53:51.595489 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240124 22:53:51.595510 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240124 22:53:51.595526 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240124 22:53:51.595542 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240124 22:53:51.595561 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240124 22:53:51.595577 52929 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240124 22:53:51.595590 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240124 22:53:51.595609 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240124 22:53:51.595639 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000 781.2 kB
W20240124 22:53:51.595664 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000 781.2 kB
W20240124 22:53:51.595683 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000 781.2 kB
W20240124 22:53:51.595702 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000 781.2 kB
W20240124 22:53:51.595719 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000 781.2 kB
W20240124 22:53:51.595736 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000 781.2 kB
W20240124 22:53:51.595757 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000 781.2 kB
W20240124 22:53:51.595778 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000 781.2 kB
W20240124 22:53:51.595798 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000 781.2 kB
W20240124 22:53:51.595821 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000 781.2 kB
W20240124 22:53:51.595840 52929 IPCTensor.h:365] NewIPCTensor: step_r4 [10]0x100002694000 80 B 
W20240124 22:53:51.595854 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000 8 B 
W20240124 22:53:51.595872 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000 8 B 
W20240124 22:53:51.595911 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000 781.2 kB
W20240124 22:53:51.595935 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000 781.2 kB
W20240124 22:53:51.595952 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000 781.2 kB
W20240124 22:53:51.595975 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000 781.2 kB
W20240124 22:53:51.595994 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000 781.2 kB
W20240124 22:53:51.596020 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000 781.2 kB
W20240124 22:53:51.596047 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000 781.2 kB
W20240124 22:53:51.596063 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000 781.2 kB
W20240124 22:53:51.596091 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000 781.2 kB
W20240124 22:53:51.596117 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000 781.2 kB
W20240124 22:53:51.596141 52929 IPCTensor.h:365] NewIPCTensor: step_r5 [10]0x100002e4c000 80 B 
W20240124 22:53:51.596154 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000 8 B 
W20240124 22:53:51.596171 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000 8 B 
W20240124 22:53:51.596202 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_0 [100000]0x100002e52000 781.2 kB
W20240124 22:53:51.596223 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_1 [100000]0x100002f17000 781.2 kB
W20240124 22:53:51.596247 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_2 [100000]0x100002fdc000 781.2 kB
W20240124 22:53:51.596272 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_3 [100000]0x1000030a1000 781.2 kB
W20240124 22:53:51.596297 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_4 [100000]0x100003166000 781.2 kB
W20240124 22:53:51.596314 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_5 [100000]0x10000322b000 781.2 kB
W20240124 22:53:51.596338 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_6 [100000]0x1000032f0000 781.2 kB
W20240124 22:53:51.596362 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_7 [100000]0x1000033b5000 781.2 kB
W20240124 22:53:51.596380 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_8 [100000]0x10000347a000 781.2 kB
W20240124 22:53:51.596400 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_9 [100000]0x10000353f000 781.2 kB
W20240124 22:53:51.596423 52929 IPCTensor.h:365] NewIPCTensor: step_r6 [10]0x100003604000 80 B 
W20240124 22:53:51.596442 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r6 [1]0x100003606000 8 B 
W20240124 22:53:51.596463 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x100003608000 8 B 
W20240124 22:53:51.596500 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_0 [100000]0x10000360a000 781.2 kB
W20240124 22:53:51.596524 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_1 [100000]0x1000036cf000 781.2 kB
W20240124 22:53:51.596545 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_2 [100000]0x100003794000 781.2 kB
W20240124 22:53:51.596563 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_3 [100000]0x100003859000 781.2 kB
W20240124 22:53:51.596580 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_4 [100000]0x10000391e000 781.2 kB
W20240124 22:53:51.596606 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_5 [100000]0x1000039e3000 781.2 kB
W20240124 22:53:51.596632 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_6 [100000]0x100003aa8000 781.2 kB
W20240124 22:53:51.596652 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_7 [100000]0x100003b6d000 781.2 kB
W20240124 22:53:51.596673 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_8 [100000]0x100003c32000 781.2 kB
W20240124 22:53:51.596697 52929 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_9 [100000]0x100003cf7000 781.2 kB
W20240124 22:53:51.596714 52929 IPCTensor.h:365] NewIPCTensor: step_r7 [10]0x100003dbc000 80 B 
W20240124 22:53:51.596729 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r7 [1]0x100003dbe000 8 B 
W20240124 22:53:51.596743 52929 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100003dc0000 8 B 
W20240124 22:53:51.958271 52929 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100003dc2000 128.2 GB
W20240124 22:53:51.958462 52929 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x1020129fa000 328.3 MB
{0: Graph(num_nodes=18933917, num_edges=55424977,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=13553612, num_edges=52144637,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=12534799, num_edges=46200271,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=12686041, num_edges=52326269,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=15590560, num_edges=56579771,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=14580085, num_edges=37397287,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=12323776, num_edges=47000589,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=13847704, num_edges=34618513,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 18933917 N 55424977 E
MertisPartition: part 1 has 13553612 N 52144637 E
MertisPartition: part 2 has 12534799 N 46200271 E
MertisPartition: part 3 has 12686041 N 52326269 E
MertisPartition: part 4 has 15590560 N 56579771 E
MertisPartition: part 5 has 14580085 N 37397287 E
MertisPartition: part 6 has 12323776 N 47000589 E
MertisPartition: part 7 has 13847704 N 34618513 E
Rank0: cached key size 537838
Rank1: cached key size 537838
Rank2: cached key size 537838
Rank3: cached key size 537838
Rank4: cached key size 537838
Rank5: cached key size 537838
Rank6: cached key size 537838
Rank7: cached key size 537838
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 20485189,  3195844, 27748820]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 4, 6, 4])}
After renumbering graph:  {'_ID': tensor([ 4302743,  4302769,    55727,  ..., 61200550, 22442000, 28532398]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 4, 6, 4])}
part_g: DGLGraph(num_nodes=18933917, num_edges=55424977,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=18933917, num_edges=55424977,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 920.747 seconds
[Rank1] pid = 950
[Rank2] pid = 1055
[Rank3] pid = 1157
[Rank4] pid = 1248
[Rank5] pid = 1329
[Rank6] pid = 1408
INFO [52929 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [950 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [1055 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [1157 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [1408 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [1248 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [1329 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [1329 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [1495 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [1495 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
WARNING [1329 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [1495 DistTensor.py:56] The tensor name already exists in the kvstore
INFO [52929 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
WARNING [52929 DistTensor.py:56] The tensor name already exists in the kvstore
INFO [1055 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [950 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [1408 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [1157 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [1248 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
WARNING [1055 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [1408 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [950 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [1157 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [1248 DistTensor.py:56] The tensor name already exists in the kvstore
I20240124 22:57:02.214344  1567 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240124 22:57:02.214769  1249 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 22:57:02.214946  1057 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 22:57:02.215096  1409 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 22:57:02.215242  1330 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 22:57:02.215378  1160 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 22:57:02.215503   951 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 22:57:02.215621  1496 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 22:57:08.076845  1330 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240124 22:57:08.383195  1567 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 22:57:09.824404  1057 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 22:57:09.900701  1409 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 22:57:10.227216   951 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 22:57:10.656956  1160 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 22:57:11.327872  1249 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 22:57:11.430204  1496 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.913 ms                  | 10.630 ms                 |
| Forward                   | 5.259 ms                  | 314.277 ms                |
| Backward                  | 57.061 ms                 | 171.911 ms                |
| Optimize                  | 1.308 ms                  | 38.997 ms                 |
| BarrierTimeBeforeRank0    | 5.819 ms                  | 171.677 ms                |
| BlockToStepN              | 20.804 us                 | 35.451 us                 |
| OneStep                   | 72.814 ms                 | 712.122 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.929 ms                  | 38.145 ms                 |
| Forward                   | 5.060 ms                  | 7.568 ms                  |
| Backward                  | 50.577 ms                 | 73.046 ms                 |
| Optimize                  | 1.432 ms                  | 3.097 ms                  |
| BarrierTimeBeforeRank0    | 13.583 ms                 | 96.221 ms                 |
| BlockToStepN              | 27.009 us                 | 23.342 ms                 |
| OneStep                   | 82.295 ms                 | 189.837 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 10.625, sample: 1.148, forward: 1.424, backward: 4.864, update: 0.217
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 10.298, sample: 0.586, forward: 1.320, backward: 5.447, update: 0.185
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 9.869, sample: 1.163, forward: 1.339, backward: 5.021, update: 0.205
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 9.197, sample: 1.060, forward: 1.393, backward: 4.915, update: 0.175
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 12.449, sample: 0.874, forward: 1.428, backward: 4.774, update: 0.207
[Rank7] pid = 1495
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242), (25816242, 30118949), (30118949, 34421656)]
train_sampler.Prefill()
-------Step 0-------
tensor([201777, 312998, 190525, 313033, 313060, 313086, 201785, 313125, 313158,
        313194]) tensor([ 4739414, 11852700, 59910126, 60054543, 21660763,    90537, 17429572,
        63516344, 45765812, 53179915])
-------Step 1-------
tensor([201777, 312998, 190525, 313033, 313060, 313086, 201785, 313125, 313158,
        313194]) tensor([21756009, 32054729, 56374289,  5489102, 68396754,  7521694,  4836542,
        14800249, 60119096,  5145129])
-------Step 2-------
tensor([  130222,   348666, 21566052,   348705,   130258,   201922,   348732,
          348784,   348824, 57732138]) tensor([72764438, 74296785, 48229807, 10570600, 33478208, 63828898, 41293442,
        34223157, 20214216, 85620268])
-------Step 3-------
tensor([  130222,   348666, 21566052,   348705,   130258,   201922,   348732,
          348784,   348824, 57732138]) tensor([54099647, 36079871, 44015055, 20649087,   471012, 19816614, 67081573,
        33884594, 47132032, 46055391])
-------Step 4-------
tensor([   12615,   385197, 58021604,    22846,   385226,   385259,   385279,
          385302,   385343,   385387]) tensor([56138384, 28623647,  1406720, 27631953, 21021211, 21727925,  8681628,
        54764294, 73621674, 28870416])
-------Step 5-------
tensor([   12615,   385197, 58021604,    22846,   385226,   385259,   385279,
          385302,   385343,   385387]) tensor([71402977, 39782847, 61304210,  5989652, 64663380, 38823420,  5750806,
        73795653, 61833261, 58990761])
-------Step 6-------
tensor([  417776,   417809,   417852,   417875, 49737098,   417915,   417941,
          107452,   417979,   205078]) tensor([57835200, 79485598, 69337545,  1559184, 72323649, 73989196, 62275807,
        25381267, 68716279, 85005401])
-------Step 7-------
tensor([  417776,   417809,   417852,   417875, 49737098,   417915,   417941,
          107452,   417979,   205078]) tensor([51793262, 42298579, 39149564, 40768884, 78373026,   404463, 73815576,
        71489824, 83087354, 66005685])
-------Step 8-------
tensor([39305638,   450319,   450354,   450384,   450416,   450445,   450475,
          450503,   450529, 21792730]) tensor([78070377, 51692881, 69180367, 35095153,    74552,  4354332, 24799989,
        45818849, 60912761, 11111864])
-------Step 9-------
tensor([39305638,   450319,   450354,   450384,   450416,   450445,   450475,
          450503,   450529, 21792730]) tensor([79576215, 26657711,  8725186, 37989402, 49774927, 25921052, 85644916,
        72521010, 82387321, 38757457])
before start barrier
start train
[proc 0] 100 steps, total: 9.095, sample: 0.780, forward: 0.810, backward: 5.085, update: 0.173
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 10.701, sample: 1.164, forward: 1.389, backward: 4.919, update: 0.178
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 12.142, sample: 0.627, forward: 1.355, backward: 5.007, update: 0.182
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.093 ms                  | 42.778 ms                 |
| Forward                   | 4.946 ms                  | 20.689 ms                 |
| Backward                  | 47.620 ms                 | 78.007 ms                 |
| Optimize                  | 1.436 ms                  | 3.097 ms                  |
| BarrierTimeBeforeRank0    | 13.583 ms                 | 96.221 ms                 |
| BlockToStepN              | 28.775 us                 | 23.342 ms                 |
| OneStep                   | 76.616 ms                 | 189.837 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.016 ms                  | 40.258 ms                 |
| Forward                   | 5.030 ms                  | 8.517 ms                  |
| Backward                  | 46.910 ms                 | 75.897 ms                 |
| Optimize                  | 1.402 ms                  | 2.551 ms                  |
| BarrierTimeBeforeRank0    | 15.476 ms                 | 69.740 ms                 |
| BlockToStepN              | 26.843 us                 | 13.656 ms                 |
| OneStep                   | 80.461 ms                 | 178.151 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 6] 200 steps, total: 9.035, sample: 0.563, forward: 0.919, backward: 5.052, update: 0.166
[proc 1] 200 steps, total: 9.035, sample: 0.585, forward: 0.929, backward: 5.599, update: 0.150
[proc 7] 200 steps, total: 9.035, sample: 0.432, forward: 0.829, backward: 4.916, update: 0.142
[proc 3] 200 steps, total: 9.035, sample: 0.491, forward: 0.913, backward: 4.515, update: 0.134
[proc 2] 200 steps, total: 9.035, sample: 0.460, forward: 0.964, backward: 4.864, update: 0.141
[proc 5] 200 steps, total: 9.035, sample: 0.643, forward: 1.027, backward: 6.286, update: 0.144
[proc 0] 200 steps, total: 9.035, sample: 0.593, forward: 0.548, backward: 4.826, update: 0.136
[proc 4] 200 steps, total: 9.035, sample: 0.536, forward: 0.892, backward: 5.009, update: 0.119
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.800 ms                  | 40.258 ms                 |
| Forward                   | 5.049 ms                  | 19.362 ms                 |
| Backward                  | 47.229 ms                 | 78.007 ms                 |
| Optimize                  | 1.402 ms                  | 2.551 ms                  |
| BarrierTimeBeforeRank0    | 21.250 ms                 | 248.712 ms                |
| BlockToStepN              | 26.025 us                 | 13.656 ms                 |
| OneStep                   | 84.581 ms                 | 308.172 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.429 ms                  | 38.145 ms                 |
| Forward                   | 5.060 ms                  | 18.351 ms                 |
| Backward                  | 48.003 ms                 | 75.897 ms                 |
| Optimize                  | 1.408 ms                  | 2.551 ms                  |
| BarrierTimeBeforeRank0    | 22.532 ms                 | 171.677 ms                |
| BlockToStepN              | 24.920 us                 | 13.656 ms                 |
| OneStep                   | 85.676 ms                 | 300.195 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 6] 300 steps, total: 10.135, sample: 0.419, forward: 0.808, backward: 4.987, update: 0.131
[proc 4] 300 steps, total: 10.134, sample: 0.462, forward: 0.869, backward: 5.401, update: 0.135
[proc 2] 300 steps, total: 10.135, sample: 0.436, forward: 0.891, backward: 4.762, update: 0.135
[proc 1] 300 steps, total: 10.135, sample: 0.327, forward: 0.762, backward: 5.109, update: 0.135
[proc 0] 300 steps, total: 10.135, sample: 0.443, forward: 0.513, backward: 5.487, update: 0.144
[proc 7] 300 steps, total: 10.135, sample: 0.521, forward: 0.743, backward: 5.445, update: 0.137
[proc 3] 300 steps, total: 10.135, sample: 0.428, forward: 0.899, backward: 4.746, update: 0.146
[proc 5] 300 steps, total: 10.135, sample: 0.654, forward: 1.117, backward: 7.175, update: 0.158
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.492 ms                  | 38.145 ms                 |
| Forward                   | 5.035 ms                  | 18.351 ms                 |
| Backward                  | 49.333 ms                 | 75.897 ms                 |
| Optimize                  | 1.396 ms                  | 3.097 ms                  |
| BarrierTimeBeforeRank0    | 24.173 ms                 | 171.677 ms                |
| BlockToStepN              | 23.731 us                 | 23.342 ms                 |
| OneStep                   | 86.459 ms                 | 300.195 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.249 ms                  | 37.402 ms                 |
| Forward                   | 5.054 ms                  | 8.517 ms                  |
| Backward                  | 49.333 ms                 | 73.367 ms                 |
| Optimize                  | 1.381 ms                  | 2.839 ms                  |
| BarrierTimeBeforeRank0    | 25.945 ms                 | 171.677 ms                |
| BlockToStepN              | 22.951 us                 | 17.688 ms                 |
| OneStep                   | 87.830 ms                 | 300.195 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 5] 400 steps, total: 9.796, sample: 0.619, forward: 1.106, backward: 7.671, update: 0.154
[proc 7] 400 steps, total: 9.796, sample: 0.356, forward: 0.710, backward: 4.724, update: 0.123
[proc 2] 400 steps, total: 9.796, sample: 0.436, forward: 0.830, backward: 4.380, update: 0.125
[proc 4] 400 steps, total: 9.796, sample: 0.455, forward: 0.787, backward: 5.014, update: 0.124
[proc 1] 400 steps, total: 9.796, sample: 0.422, forward: 0.739, backward: 5.190, update: 0.135
[proc 3] 400 steps, total: 9.796, sample: 0.416, forward: 0.852, backward: 4.597, update: 0.125
[proc 0] 400 steps, total: 9.796, sample: 0.468, forward: 0.508, backward: 5.114, update: 0.136
[proc 6] 400 steps, total: 9.796, sample: 0.446, forward: 0.792, backward: 4.889, update: 0.132
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.999 ms                  | 37.402 ms                 |
| Forward                   | 5.072 ms                  | 8.517 ms                  |
| Backward                  | 50.759 ms                 | 75.897 ms                 |
| Optimize                  | 1.386 ms                  | 2.839 ms                  |
| BarrierTimeBeforeRank0    | 26.158 ms                 | 171.677 ms                |
| BlockToStepN              | 22.795 us                 | 17.688 ms                 |
| OneStep                   | 88.602 ms                 | 300.195 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.897 ms                  | 36.678 ms                 |
| Forward                   | 5.080 ms                  | 7.885 ms                  |
| Backward                  | 50.192 ms                 | 73.367 ms                 |
| Optimize                  | 1.377 ms                  | 2.812 ms                  |
| BarrierTimeBeforeRank0    | 27.254 ms                 | 154.715 ms                |
| BlockToStepN              | 23.190 us                 | 14.569 ms                 |
| OneStep                   | 88.729 ms                 | 222.360 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 500 steps, total: 9.838, sample: 0.445, forward: 0.781, backward: 5.095, update: 0.149
[proc 2] 500 steps, total: 9.838, sample: 0.363, forward: 0.874, backward: 4.302, update: 0.127
[proc 6] 500 steps, total: 9.838, sample: 0.499, forward: 0.783, backward: 4.926, update: 0.125
[proc 0] 500 steps, total: 9.838, sample: 0.427, forward: 0.501, backward: 5.133, update: 0.136
[proc 3] 500 steps, total: 9.838, sample: 0.503, forward: 0.877, backward: 4.523, update: 0.125
[proc 1] 500 steps, total: 9.838, sample: 0.344, forward: 0.729, backward: 5.200, update: 0.134
[proc 5] 500 steps, total: 9.838, sample: 0.639, forward: 1.079, backward: 7.559, update: 0.161
[proc 7] 500 steps, total: 9.838, sample: 0.373, forward: 0.759, backward: 4.595, update: 0.117
Successfully xmh. training takes 47.899168968200684 seconds
before call kg_cache_controller.StopThreads()
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
INFO [52929 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240124 14:02:22.915982  1565 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_72', no_save_emb=True, max_step=500, batch_size=400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1565 sampler.py:454] Start PreSampling
WARNING [1565 sampler.py:532] Before construct renumbering_dict
WARNING [1565 sampler.py:555] PreSampling done
W20240124 14:14:43.158861  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240124 14:14:43.159073  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240124 14:14:43.159102  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240124 14:14:43.159130  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240124 14:14:43.159154  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240124 14:14:43.159179  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240124 14:14:43.159214  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240124 14:14:43.159245  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240124 14:14:43.159268  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240124 14:14:43.159297  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240124 14:14:43.159327  1565 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240124 14:14:43.159349  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240124 14:14:43.159374  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240124 14:14:43.159518  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240124 14:14:43.159546  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240124 14:14:43.159569  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240124 14:14:43.159608  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240124 14:14:43.159632  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240124 14:14:43.159655  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240124 14:14:43.159682  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240124 14:14:43.159720  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240124 14:14:43.159740  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240124 14:14:43.159760  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240124 14:14:43.159780  1565 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240124 14:14:43.159797  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240124 14:14:43.159817  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240124 14:14:43.159860  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240124 14:14:43.159886  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240124 14:14:43.159912  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240124 14:14:43.159931  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240124 14:14:43.159957  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240124 14:14:43.159979  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240124 14:14:43.160003  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240124 14:14:43.160025  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240124 14:14:43.160044  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240124 14:14:43.160069  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240124 14:14:43.160094  1565 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240124 14:14:43.160109  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240124 14:14:43.160125  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240124 14:14:43.160166  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240124 14:14:43.160188  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240124 14:14:43.160209  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240124 14:14:43.160231  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240124 14:14:43.160257  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240124 14:14:43.160279  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240124 14:14:43.160297  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240124 14:14:43.160323  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240124 14:14:43.160347  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240124 14:14:43.160372  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240124 14:14:43.160393  1565 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240124 14:14:43.160410  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240124 14:14:43.160431  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240124 14:14:43.160470  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000 781.2 kB
W20240124 14:14:43.160501  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000 781.2 kB
W20240124 14:14:43.160521  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000 781.2 kB
W20240124 14:14:43.160545  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000 781.2 kB
W20240124 14:14:43.160571  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000 781.2 kB
W20240124 14:14:43.160598  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000 781.2 kB
W20240124 14:14:43.160617  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000 781.2 kB
W20240124 14:14:43.160642  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000 781.2 kB
W20240124 14:14:43.160671  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000 781.2 kB
W20240124 14:14:43.160703  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000 781.2 kB
W20240124 14:14:43.160723  1565 IPCTensor.h:365] NewIPCTensor: step_r4 [10]0x100002694000 80 B 
W20240124 14:14:43.160740  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000 8 B 
W20240124 14:14:43.160756  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000 8 B 
W20240124 14:14:43.160809  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000 781.2 kB
W20240124 14:14:43.160841  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000 781.2 kB
W20240124 14:14:43.160864  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000 781.2 kB
W20240124 14:14:43.160892  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000 781.2 kB
W20240124 14:14:43.160919  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000 781.2 kB
W20240124 14:14:43.160948  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000 781.2 kB
W20240124 14:14:43.160972  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000 781.2 kB
W20240124 14:14:43.160993  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000 781.2 kB
W20240124 14:14:43.161013  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000 781.2 kB
W20240124 14:14:43.161033  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000 781.2 kB
W20240124 14:14:43.161059  1565 IPCTensor.h:365] NewIPCTensor: step_r5 [10]0x100002e4c000 80 B 
W20240124 14:14:43.161077  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000 8 B 
W20240124 14:14:43.161092  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000 8 B 
W20240124 14:14:43.161135  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_0 [100000]0x100002e52000 781.2 kB
W20240124 14:14:43.161157  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_1 [100000]0x100002f17000 781.2 kB
W20240124 14:14:43.161180  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_2 [100000]0x100002fdc000 781.2 kB
W20240124 14:14:43.161199  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_3 [100000]0x1000030a1000 781.2 kB
W20240124 14:14:43.161226  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_4 [100000]0x100003166000 781.2 kB
W20240124 14:14:43.161247  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_5 [100000]0x10000322b000 781.2 kB
W20240124 14:14:43.161268  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_6 [100000]0x1000032f0000 781.2 kB
W20240124 14:14:43.161290  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_7 [100000]0x1000033b5000 781.2 kB
W20240124 14:14:43.161312  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_8 [100000]0x10000347a000 781.2 kB
W20240124 14:14:43.161341  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_9 [100000]0x10000353f000 781.2 kB
W20240124 14:14:43.161365  1565 IPCTensor.h:365] NewIPCTensor: step_r6 [10]0x100003604000 80 B 
W20240124 14:14:43.161386  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r6 [1]0x100003606000 8 B 
W20240124 14:14:43.161401  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x100003608000 8 B 
W20240124 14:14:43.161446  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_0 [100000]0x10000360a000 781.2 kB
W20240124 14:14:43.161469  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_1 [100000]0x1000036cf000 781.2 kB
W20240124 14:14:43.161490  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_2 [100000]0x100003794000 781.2 kB
W20240124 14:14:43.161510  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_3 [100000]0x100003859000 781.2 kB
W20240124 14:14:43.161533  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_4 [100000]0x10000391e000 781.2 kB
W20240124 14:14:43.161559  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_5 [100000]0x1000039e3000 781.2 kB
W20240124 14:14:43.161579  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_6 [100000]0x100003aa8000 781.2 kB
W20240124 14:14:43.161607  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_7 [100000]0x100003b6d000 781.2 kB
W20240124 14:14:43.161626  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_8 [100000]0x100003c32000 781.2 kB
W20240124 14:14:43.161646  1565 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_9 [100000]0x100003cf7000 781.2 kB
W20240124 14:14:43.161670  1565 IPCTensor.h:365] NewIPCTensor: step_r7 [10]0x100003dbc000 80 B 
W20240124 14:14:43.161688  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r7 [1]0x100003dbe000 8 B 
W20240124 14:14:43.161705  1565 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100003dc0000 8 B 
W20240124 14:14:43.517479  1565 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100003dc2000 128.2 GB
W20240124 14:14:43.517645  1565 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x1020129fa000 328.3 MB
{0: Graph(num_nodes=18933917, num_edges=55424977,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=13553612, num_edges=52144637,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=12534799, num_edges=46200271,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=12686041, num_edges=52326269,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=15590560, num_edges=56579771,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=14580085, num_edges=37397287,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=12323776, num_edges=47000589,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=13847704, num_edges=34618513,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 18933917 N 55424977 E
MertisPartition: part 1 has 13553612 N 52144637 E
MertisPartition: part 2 has 12534799 N 46200271 E
MertisPartition: part 3 has 12686041 N 52326269 E
MertisPartition: part 4 has 15590560 N 56579771 E
MertisPartition: part 5 has 14580085 N 37397287 E
MertisPartition: part 6 has 12323776 N 47000589 E
MertisPartition: part 7 has 13847704 N 34618513 E
Rank0: cached key size 537838
Rank1: cached key size 537838
Rank2: cached key size 537838
Rank3: cached key size 537838
Rank4: cached key size 537838
Rank5: cached key size 537838
Rank6: cached key size 537838
Rank7: cached key size 537838
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 20485189,  3195844, 27748820]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 4, 6, 4])}
After renumbering graph:  {'_ID': tensor([ 4302706,  4302714,    64576,  ..., 47242983, 16653765, 26120849]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 4, 6, 4])}
part_g: DGLGraph(num_nodes=18933917, num_edges=55424977,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=18933917, num_edges=55424977,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 917.715 seconds
[Rank1] pid = 25114
[Rank2] pid = 25215
[Rank3] pid = 25299
[Rank4] pid = 25383
[Rank5] pid = 25453
[Rank6] pid = 25534
INFO [1565 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [25114 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [25215 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [25299 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [25383 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [25453 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [25679 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [25534 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [25534 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [25679 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [25453 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [25299 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [25383 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [25215 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [1565 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [25114 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240124 14:17:49.081102 25535 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_6 [4302707, 400]; dev=6; size=6.412 GB
W20240124 14:17:49.084476 25680 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_7 [4302707, 400]; dev=7; size=6.412 GB
W20240124 14:17:49.084405 25384 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_4 [4302707, 400]; dev=4; size=6.412 GB
W20240124 14:17:49.084771 25454 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_5 [4302707, 400]; dev=5; size=6.412 GB
W20240124 14:17:49.084771 25216 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240124 14:17:49.084769 25300 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240124 14:17:49.084481 25115 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240124 14:17:49.112545 25743 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240124 14:17:49.250995 25535 IPCTensor.h:365] NewIPCTensor: input_keys_6 [100000]0x10202724d000 781.2 kB
W20240124 14:17:49.251433 25115 IPCTensor.h:365] NewIPCTensor: input_keys_1 [100000]0x102027314000 781.2 kB
W20240124 14:17:49.251507 25216 IPCTensor.h:365] NewIPCTensor: input_keys_2 [100000]0x1020273d9000 781.2 kB
W20240124 14:17:49.251518 25454 IPCTensor.h:365] NewIPCTensor: input_keys_5 [100000]0x10202749e000 781.2 kB
W20240124 14:17:49.251538 25384 IPCTensor.h:365] NewIPCTensor: input_keys_4 [100000]0x102027563000 781.2 kB
W20240124 14:17:49.251549 25680 IPCTensor.h:365] NewIPCTensor: input_keys_7 [100000]0x102027628000 781.2 kB
W20240124 14:17:49.251557 25300 IPCTensor.h:365] NewIPCTensor: input_keys_3 [100000]0x1020276ed000 781.2 kB
W20240124 14:17:49.251812 25535 IPCTensor.h:365] NewIPCTensor: input_keys_neg_6 [100000]0x1020277b2000 781.2 kB
W20240124 14:17:49.251849 25454 IPCTensor.h:365] NewIPCTensor: input_keys_neg_5 [100000]0x102027877000 781.2 kB
W20240124 14:17:49.251945 25216 IPCTensor.h:365] NewIPCTensor: input_keys_neg_2 [100000]0x10202793c000 781.2 kB
W20240124 14:17:49.252023 25300 IPCTensor.h:365] NewIPCTensor: input_keys_neg_3 [100000]0x102027a01000 781.2 kB
W20240124 14:17:49.252028 25680 IPCTensor.h:365] NewIPCTensor: input_keys_neg_7 [100000]0x102027ac6000 781.2 kB
W20240124 14:17:49.252053 25384 IPCTensor.h:365] NewIPCTensor: input_keys_neg_4 [100000]0x102027b8b000 781.2 kB
W20240124 14:17:49.252082 25115 IPCTensor.h:365] NewIPCTensor: input_keys_neg_1 [100000]0x102027c50000 781.2 kB
W20240124 14:17:49.252278 25115 IPCTensor.h:365] NewIPCTensor: backward_grads_1 [100000, 400]0x102027d15000 152.6 MB
W20240124 14:17:49.252312 25384 IPCTensor.h:365] NewIPCTensor: backward_grads_4 [100000, 400]0x1020315ad000 152.6 MB
W20240124 14:17:49.252337 25300 IPCTensor.h:365] NewIPCTensor: backward_grads_3 [100000, 400]0x10203ae45000 152.6 MB
W20240124 14:17:49.252350 25680 IPCTensor.h:365] NewIPCTensor: backward_grads_7 [100000, 400]0x1020446dd000 152.6 MB
W20240124 14:17:49.252363 25216 IPCTensor.h:365] NewIPCTensor: backward_grads_2 [100000, 400]0x10204df75000 152.6 MB
W20240124 14:17:49.252374 25454 IPCTensor.h:365] NewIPCTensor: backward_grads_5 [100000, 400]0x10205780d000 152.6 MB
W20240124 14:17:49.252418 25115 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x1020610a5000 152.6 MB
W20240124 14:17:49.252431 25535 IPCTensor.h:365] NewIPCTensor: backward_grads_6 [100000, 400]0x10206a93d000 152.6 MB
W20240124 14:17:49.252593 25115 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240124 14:17:49.252723 25535 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_6 [100000, 400]0x1020741d5000 152.6 MB
W20240124 14:17:49.252733 25454 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_5 [100000, 400]0x10207da6d000 152.6 MB
W20240124 14:17:49.252748 25216 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x102087305000 152.6 MB
W20240124 14:17:49.252775 25300 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x102090b9d000 152.6 MB
W20240124 14:17:49.252786 25680 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_7 [100000, 400]0x10209a435000 152.6 MB
W20240124 14:17:49.252825 25384 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_4 [100000, 400]0x1020a3ccd000 152.6 MB
W20240124 14:17:49.253015 25454 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240124 14:17:49.253319 25216 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240124 14:17:49.253393 25535 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_6_gpu [100000, 400]; dev=6; size=152.6 MB
W20240124 14:17:49.253496 25680 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_7_gpu [100000, 400]; dev=7; size=152.6 MB
W20240124 14:17:49.253497 25384 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240124 14:17:49.253515 25300 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240124 14:17:49.257671 25743 IPCTensor.h:365] NewIPCTensor: input_keys_0 [100000]0x1020ad567000 781.2 kB
W20240124 14:17:49.257920 25743 IPCTensor.h:365] NewIPCTensor: input_keys_neg_0 [100000]0x1020ad62c000 781.2 kB
W20240124 14:17:49.258040 25743 IPCTensor.h:365] NewIPCTensor: backward_grads_0 [100000, 400]0x1020ad6f1000 152.6 MB
W20240124 14:17:49.258131 25743 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x1020b6f89000 152.6 MB
W20240124 14:17:49.258232 25743 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240124 14:17:49.273653 25115 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240124 14:17:49.273810 25454 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240124 14:17:49.273867 25216 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240124 14:17:49.273972 25680 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_7_gpu [100000, 400]; dev=7; size=152.6 MB
W20240124 14:17:49.273970 25535 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_6_gpu [100000, 400]; dev=6; size=152.6 MB
W20240124 14:17:49.274097 25384 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240124 14:17:49.274119 25300 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240124 14:17:49.281389 25743 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
cudaHostRegister 0x100003dc2000
6: KnownLocalCachedEmbedding init done
WARNING [25534 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
2: KnownLocalCachedEmbedding init done
WARNING [25215 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
5: KnownLocalCachedEmbedding init done
WARNING [25453 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
7: KnownLocalCachedEmbedding init done
WARNING [25679 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
3: KnownLocalCachedEmbedding init done
WARNING [25299 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
1: KnownLocalCachedEmbedding init done
WARNING [25114 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank7] pid = 25679
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242), (25816242, 30118949), (30118949, 34421656)]
cudaHostRegister 0x100003dc2000
0: KnownLocalCachedEmbedding init done
WARNING [1565 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
4: KnownLocalCachedEmbedding init done
WARNING [25383 DistTensor.py:56] The tensor name already exists in the kvstore
I20240124 14:18:37.714649 25384 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240124 14:18:37.715139 25680 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 14:18:37.715189 25300 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 14:18:37.715230 25535 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 14:18:37.715266 25454 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 14:18:37.715309 25743 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 14:18:37.715337 25216 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 14:18:37.715373 25115 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240124 14:18:37.716899 25743 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240124 14:18:37.717005 25743 grad_base.h:172] Init GradProcessingBase done
I20240124 14:18:46.990849 25743 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240124 14:18:46.991109 25743 kg_controller.h:78] after init GradAsyncProcessingV2
I20240124 14:18:46.991115 25743 kg_controller.h:84] Construct KGCacheController done
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
I20240124 14:18:48.733673 25743 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240124 14:19:04.946511 28029 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240124 14:19:04.946828 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240124 14:19:06.558208 28029 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240124 14:19:06.558318 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240124 14:19:07.491387 25680 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
W20240124 14:19:08.423485 28029 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240124 14:19:08.423592 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
E20240124 14:19:09.423015 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240124 14:19:09.431411 28029 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
I20240124 14:19:09.466228 25535 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
W20240124 14:19:10.892490 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240124 14:19:10.895148 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240124 14:19:10.910092 25454 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
W20240124 14:19:14.241242 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240124 14:19:14.244899 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240124 14:19:14.310151 25216 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
W20240124 14:19:15.800956 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240124 14:19:15.804824 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240124 14:19:15.868639 25300 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 14:19:15.994571 25115 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 14:19:16.385411 25743 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
W20240124 14:19:16.889365 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240124 14:19:16.893110 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240124 14:19:16.905208 25384 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 10.092 ms                 | 10.092 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 360.712 ms                | 362.914 ms                |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:19.154047 25743 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240124 14:19:19.181476 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240124 14:19:19.197062 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240124 14:19:19.235859 25743 grad_async_v2.h:236] pq is empty
W20240124 14:19:19.470599 25743 grad_async_v2.h:236] pq is empty
W20240124 14:19:19.727779 25743 grad_async_v2.h:236] pq is empty
W20240124 14:19:19.850775 25743 grad_async_v2.h:236] pq is empty
E20240124 14:19:20.154013 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=702
W20240124 14:19:20.184998 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=16, pq.top=16
W20240124 14:19:20.202167 28029 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240124 14:19:21.154011 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=12
W20240124 14:19:21.215227 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=33, pq.top=33
W20240124 14:19:21.229867 28029 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240124 14:19:22.154011 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=17
W20240124 14:19:22.215066 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=51, pq.top=51
W20240124 14:19:22.230181 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.982 ms                  | 26.199 ms                 |
| Forward                   | 3.289 ms                  | 4.556 ms                  |
| Backward                  | 2.850 ms                  | 5.758 ms                  |
| Optimize                  | 856.701 us                | 1.496 ms                  |
| BarrierTimeBeforeRank0    | 4.849 ms                  | 61.756 ms                 |
| AfterBackward             | 25.810 ms                 | 44.558 ms                 |
| BlockToStepN              | 987.869 us                | 18.697 ms                 |
| OneStep                   | 66.563 ms                 | 148.236 ms                |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:23.154009 25743 parallel_pq_v2.h:76] insert failed, size(hashtable)=1240
W20240124 14:19:23.237845 28029 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240124 14:19:23.295030 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=71, pq.top=71
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 5.736 ms                  | 7.553 ms                  |
| ProcessBack:UpdateCache   | 9.112 ms                  | 11.755 ms                 |
| ProcessBack:UpsertPq      | 6.103 ms                  | 27.269 ms                 |
| ProcessOneStep            | 25.775 ms                 | 44.524 ms                 |
| BlockToStepN              | 940.206 us                | 21.575 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:24.154008 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=29
W20240124 14:19:24.241452 28029 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240124 14:19:24.351186 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=87, pq.top=87
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 9.243, sample: 0.408, forward: 1.164, backward: 0.618, update: 0.091
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 10.801, sample: 0.591, forward: 1.149, backward: 0.542, update: 0.083
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 15.646, sample: 0.770, forward: 1.175, backward: 0.553, update: 0.082
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 14.201, sample: 0.382, forward: 1.168, backward: 0.553, update: 0.087
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 9.117, sample: 0.668, forward: 1.201, backward: 0.581, update: 0.082
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 17.620, sample: 0.870, forward: 1.195, backward: 0.521, update: 0.078
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 8.206, sample: 0.587, forward: 1.117, backward: 0.543, update: 0.082
train_sampler.Prefill()
-------Step 0-------
tensor([ 58945,  58973, 129941,  58996,  59019,  59041, 129988,  59065,  59085,
         59105]) tensor([ 5340852, 10263194, 58514037, 53822765, 16489611,   521305, 21620508,
        64371087, 45232766, 54803271])
-------Step 1-------
tensor([ 58945,  58973, 129941,  58996,  59019,  59041, 129988,  59065,  59085,
         59105]) tensor([74708749, 45254150, 68150893, 29899187,   506632,  4343924, 27077204,
        43722800, 77311225,  9397998])
-------Step 2-------
tensor([   71981,    72007, 29376461,    72022, 70784488,   132488,    72049,
           72069,    72094,    72107]) tensor([77544139, 50692253,   326886,   664322, 49428917, 68969759, 27306406,
        75824796, 25786677,  7013284])
-------Step 3-------
tensor([   71981,    72007, 29376461,    72022, 70784488,   132488,    72049,
           72069,    72094,    72107]) tensor([73195589, 47914548, 30286702, 77727060,  7237004, 27312164, 35485329,
        38325342,  5238809, 13859523])
-------Step 4-------
tensor([520808,  85588,  85609,  85625, 520818, 130358,  85660,  85680,  85700,
         85722]) tensor([67797689, 82753152, 37421771,  8786422, 42660342, 77277149, 35730984,
        33645979, 27261394, 72029106])
-------Step 5-------
tensor([520808,  85588,  85609,  85625, 520818, 130358,  85660,  85680,  85700,
         85722]) tensor([32410222, 27062713, 67501620, 47082208, 10869814, 16348342, 37025203,
        11987836, 65504835, 84373399])
-------Step 6-------
tensor([ 98781,  98809,    536,  98832,  98858, 136524,  98879, 521076,  98900,
         98913]) tensor([45100253, 13993959, 40508773,   912061, 43602077, 15648305, 19230479,
        40188358, 80796763, 24793099])
-------Step 7-------
tensor([ 98781,  98809,    536,  98832,  98858, 136524,  98879, 521076,  98900,
         98913]) tensor([ 7965948,  9700450, 36798364, 58989125, 80557640, 44394195, 43491755,
        71924436, 53831460, 75976474])
-------Step 8-------
tensor([10845903,   111554,    40831,    40872,   111574,   111593,   111616,
          111641,   111670,   111690]) tensor([57556482, 36726808,  1286129, 23314080, 26920355, 27619306,  6966187,
        54299672, 70845847, 35023446])
-------Step 9-------
tensor([10845903,   111554,    40831,    40872,   111574,   111593,   111616,
          111641,   111670,   111690]) tensor([37086194,   429014, 42183368, 20111150, 25050544, 40713934, 20135930,
          237215, 64022079, 49195855])
before start barrier
start train
[proc 0] 100 steps, total: 8.726, sample: 0.479, forward: 1.221, backward: 0.504, update: 0.087
E20240124 14:19:25.154011 25743 parallel_pq_v2.h:76] insert failed, size(hashtable)=2559
W20240124 14:19:25.243124 28029 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240124 14:19:25.361140 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=104, pq.top=104
E20240124 14:19:26.154027 25743 parallel_pq_v2.h:76] insert failed, size(hashtable)=37
W20240124 14:19:26.245354 28029 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240124 14:19:26.385493 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=121, pq.top=121
E20240124 14:19:27.154008 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=955
W20240124 14:19:27.249053 28029 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240124 14:19:27.393289 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=138, pq.top=138
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.588 ms                  | 26.199 ms                 |
| Forward                   | 3.311 ms                  | 22.418 ms                 |
| Backward                  | 2.868 ms                  | 14.103 ms                 |
| Optimize                  | 880.130 us                | 1.496 ms                  |
| BarrierTimeBeforeRank0    | 2.851 ms                  | 61.756 ms                 |
| AfterBackward             | 25.810 ms                 | 96.137 ms                 |
| BlockToStepN              | 9.077 ms                  | 37.529 ms                 |
| OneStep                   | 65.353 ms                 | 148.236 ms                |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:28.154034 28028 parallel_pq_v2.h:76] insert failed, size(hashtable)=5869
W20240124 14:19:28.252665 28029 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240124 14:19:28.417907 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=156, pq.top=156
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 5.762 ms                  | 7.502 ms                  |
| ProcessBack:UpdateCache   | 9.142 ms                  | 11.618 ms                 |
| ProcessBack:UpsertPq      | 6.050 ms                  | 33.837 ms                 |
| ProcessOneStep            | 31.534 ms                 | 52.829 ms                 |
| BlockToStepN              | 9.032 ms                  | 30.331 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:29.154011 28028 parallel_pq_v2.h:76] insert failed, size(hashtable)=1654
W20240124 14:19:29.253327 28029 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240124 14:19:29.443046 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=171, pq.top=171
W20240124 14:19:29.497097 25743 grad_async_v2.h:236] pq is empty
E20240124 14:19:30.154011 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=7041
W20240124 14:19:30.256609 28029 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240124 14:19:30.443251 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=185, pq.top=185
E20240124 14:19:31.154007 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=139
W20240124 14:19:31.260224 28029 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240124 14:19:31.495888 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=200, pq.top=200
[proc 7] 200 steps, total: 6.386, sample: 0.548, forward: 0.432, backward: 0.310, update: 0.087
[proc 2] 200 steps, total: 6.386, sample: 0.490, forward: 0.337, backward: 0.374, update: 0.089
[proc 3] 200 steps, total: 6.386, sample: 0.352, forward: 0.318, backward: 0.396, update: 0.082
[proc 6] 200 steps, total: 6.386, sample: 0.491, forward: 0.345, backward: 0.384, update: 0.084
[proc 4] 200 steps, total: 6.386, sample: 0.513, forward: 0.333, backward: 0.361, update: 0.089
[proc 1] 200 steps, total: 6.386, sample: 0.363, forward: 0.341, backward: 0.394, update: 0.084
[proc 5] 200 steps, total: 6.386, sample: 0.411, forward: 0.347, backward: 0.340, update: 0.090
[proc 0] 200 steps, total: 6.386, sample: 0.511, forward: 0.382, backward: 0.306, update: 0.108
E20240124 14:19:32.154012 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=14
W20240124 14:19:32.264681 28029 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240124 14:19:32.495227 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=215, pq.top=215
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.701 ms                  | 26.978 ms                 |
| Forward                   | 3.433 ms                  | 19.219 ms                 |
| Backward                  | 2.932 ms                  | 9.593 ms                  |
| Optimize                  | 918.999 us                | 2.248 ms                  |
| BarrierTimeBeforeRank0    | 1.558 ms                  | 51.059 ms                 |
| AfterBackward             | 31.256 ms                 | 61.638 ms                 |
| BlockToStepN              | 8.266 ms                  | 37.529 ms                 |
| OneStep                   | 66.035 ms                 | 160.259 ms                |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:33.154016 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=3814
W20240124 14:19:33.264811 28029 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240124 14:19:33.519809 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=233, pq.top=233
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 5.780 ms                  | 7.502 ms                  |
| ProcessBack:UpdateCache   | 9.112 ms                  | 11.999 ms                 |
| ProcessBack:UpsertPq      | 6.206 ms                  | 37.663 ms                 |
| ProcessOneStep            | 26.628 ms                 | 61.592 ms                 |
| BlockToStepN              | 8.193 ms                  | 37.424 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:34.154011 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=304
W20240124 14:19:34.265765 28029 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240124 14:19:34.531241 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=250, pq.top=250
E20240124 14:19:35.154007 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=5939
W20240124 14:19:35.302495 28029 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240124 14:19:35.531565 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=269, pq.top=269
E20240124 14:19:36.154009 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=3676
W20240124 14:19:36.306906 28029 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240124 14:19:36.541700 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=288, pq.top=288
E20240124 14:19:37.154011 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=493
[proc 3] 300 steps, total: 5.771, sample: 0.580, forward: 0.300, backward: 0.341, update: 0.081
[proc 1] 300 steps, total: 5.771, sample: 0.329, forward: 0.395, backward: 0.338, update: 0.094
[proc 6] 300 steps, total: 5.771, sample: 0.421, forward: 0.342, backward: 0.343, update: 0.089
[proc 4] 300 steps, total: 5.771, sample: 0.422, forward: 0.323, backward: 0.342, update: 0.084
[proc 0] 300 steps, total: 5.771, sample: 0.607, forward: 0.364, backward: 0.345, update: 0.110
[proc 2] 300 steps, total: 5.771, sample: 0.366, forward: 0.344, backward: 0.352, update: 0.086
[proc 5] 300 steps, total: 5.771, sample: 0.388, forward: 0.398, backward: 0.355, update: 0.088
[proc 7] 300 steps, total: 5.771, sample: 0.436, forward: 0.332, backward: 0.364, update: 0.087
W20240124 14:19:37.307512 28029 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240124 14:19:37.579495 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=305, pq.top=305
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.733 ms                  | 26.968 ms                 |
| Forward                   | 3.484 ms                  | 13.068 ms                 |
| Backward                  | 3.048 ms                  | 6.089 ms                  |
| Optimize                  | 941.763 us                | 2.030 ms                  |
| BarrierTimeBeforeRank0    | 1.002 ms                  | 51.059 ms                 |
| AfterBackward             | 25.096 ms                 | 60.849 ms                 |
| BlockToStepN              | 8.266 ms                  | 37.351 ms                 |
| OneStep                   | 61.505 ms                 | 148.236 ms                |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:38.154073 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=15143
W20240124 14:19:38.307281 28029 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240124 14:19:38.601284 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=322, pq.top=322
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 5.786 ms                  | 7.925 ms                  |
| ProcessBack:UpdateCache   | 9.063 ms                  | 11.755 ms                 |
| ProcessBack:UpsertPq      | 5.060 ms                  | 35.953 ms                 |
| ProcessOneStep            | 24.966 ms                 | 60.804 ms                 |
| BlockToStepN              | 8.193 ms                  | 37.267 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240124 14:19:39.155498 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240124 14:19:39.311921 28029 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240124 14:19:39.612879 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=340, pq.top=340
E20240124 14:19:40.155009 28028 parallel_pq_v2.h:76] insert failed, size(hashtable)=10791
W20240124 14:19:40.327334 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240124 14:19:40.672688 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=357, pq.top=357
E20240124 14:19:41.170754 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240124 14:19:41.330467 28029 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240124 14:19:41.810815 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=375, pq.top=375
E20240124 14:19:42.170010 28028 parallel_pq_v2.h:76] insert failed, size(hashtable)=10403
W20240124 14:19:42.331283 28029 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.648 ms                  | 26.768 ms                 |
| Forward                   | 3.526 ms                  | 7.791 ms                  |
| Backward                  | 3.213 ms                  | 8.833 ms                  |
| Optimize                  | 952.509 us                | 2.248 ms                  |
| BarrierTimeBeforeRank0    | 1.211 ms                  | 43.543 ms                 |
| AfterBackward             | 25.006 ms                 | 61.638 ms                 |
| BlockToStepN              | 8.386 ms                  | 37.529 ms                 |
| OneStep                   | 61.614 ms                 | 148.236 ms                |
+---------------------------+---------------------------+---------------------------+
W20240124 14:19:42.856352 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=391, pq.top=391
E20240124 14:19:43.170045 28028 parallel_pq_v2.h:76] insert failed, size(hashtable)=14980
W20240124 14:19:43.334486 28029 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
[proc 1] 400 steps, total: 6.159, sample: 0.292, forward: 0.310, backward: 0.361, update: 0.080
[proc 7] 400 steps, total: 6.159, sample: 0.352, forward: 0.339, backward: 0.340, update: 0.083
[proc 2] 400 steps, total: 6.159, sample: 0.484, forward: 0.387, backward: 0.339, update: 0.085
[proc 0] 400 steps, total: 6.159, sample: 0.428, forward: 0.360, backward: 0.376, update: 0.116
[proc 4] 400 steps, total: 6.159, sample: 0.608, forward: 0.327, backward: 0.328, update: 0.083
[proc 3] 400 steps, total: 6.159, sample: 0.531, forward: 0.322, backward: 0.407, update: 0.082
[proc 6] 400 steps, total: 6.159, sample: 0.406, forward: 0.332, backward: 0.373, update: 0.088
[proc 5] 400 steps, total: 6.159, sample: 0.730, forward: 0.336, backward: 0.368, update: 0.086
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 5.807 ms                  | 8.095 ms                  |
| ProcessBack:UpdateCache   | 9.050 ms                  | 11.988 ms                 |
| ProcessBack:UpsertPq      | 4.975 ms                  | 37.663 ms                 |
| ProcessOneStep            | 24.966 ms                 | 65.702 ms                 |
| BlockToStepN              | 8.254 ms                  | 37.424 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240124 14:19:43.856951 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=407, pq.top=407
E20240124 14:19:44.170011 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=6462
W20240124 14:19:44.338538 28029 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240124 14:19:44.874624 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=424, pq.top=424
E20240124 14:19:45.171510 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240124 14:19:45.338327 28029 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240124 14:19:45.874850 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=441, pq.top=441
E20240124 14:19:46.171006 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=5742
W20240124 14:19:46.349484 28029 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240124 14:19:46.874830 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=455, pq.top=455
E20240124 14:19:47.171010 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=33356
W20240124 14:19:47.351826 28029 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.582 ms                  | 26.199 ms                 |
| Forward                   | 3.554 ms                  | 6.824 ms                  |
| Backward                  | 3.267 ms                  | 7.823 ms                  |
| Optimize                  | 975.762 us                | 2.077 ms                  |
| BarrierTimeBeforeRank0    | 1.314 ms                  | 44.130 ms                 |
| AfterBackward             | 25.096 ms                 | 65.759 ms                 |
| BlockToStepN              | 8.386 ms                  | 41.637 ms                 |
| OneStep                   | 62.568 ms                 | 148.236 ms                |
+---------------------------+---------------------------+---------------------------+
W20240124 14:19:47.941383 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=471, pq.top=471
E20240124 14:19:48.171008 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=3653
W20240124 14:19:48.354735 28029 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 5.830 ms                  | 9.008 ms                  |
| ProcessBack:UpdateCache   | 9.048 ms                  | 11.988 ms                 |
| ProcessBack:UpsertPq      | 5.025 ms                  | 37.663 ms                 |
| ProcessOneStep            | 25.036 ms                 | 65.702 ms                 |
| BlockToStepN              | 8.995 ms                  | 41.508 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240124 14:19:49.016713 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=487, pq.top=487
E20240124 14:19:49.171010 28029 parallel_pq_v2.h:76] insert failed, size(hashtable)=2643
W20240124 14:19:49.373978 28029 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240124 14:19:50.019280 25743 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=499, pq.top=499
[proc 3] 500 steps, total: 6.670, sample: 0.407, forward: 0.383, backward: 0.378, update: 0.091
[proc 7] 500 steps, total: 6.670, sample: 0.350, forward: 0.343, backward: 0.381, update: 0.087
[proc 4] 500 steps, total: 6.670, sample: 0.474, forward: 0.324, backward: 0.345, update: 0.086
[proc 5] 500 steps, total: 6.670, sample: 0.444, forward: 0.348, backward: 0.350, update: 0.094
[proc 2] 500 steps, total: 6.670, sample: 0.433, forward: 0.332, backward: 0.342, update: 0.086
[proc 1] 500 steps, total: 6.670, sample: 0.664, forward: 0.348, backward: 0.354, update: 0.080
[proc 6] 500 steps, total: 6.670, sample: 0.348, forward: 0.332, backward: 0.357, update: 0.088
[proc 0] 500 steps, total: 6.670, sample: 0.814, forward: 0.386, backward: 0.361, update: 0.105
Successfully xmh. training takes 33.71222734451294 seconds
before call kg_cache_controller.StopThreads()
W20240124 14:19:50.097661 25743 grad_async_v2.h:71] call StopThreads. PID = 1565
W20240124 14:19:50.097700 25743 grad_base.h:210] before processOneStepNegThread_.join();
W20240124 14:19:50.099258 25743 grad_base.h:212] after processOneStepNegThread_.join();
W20240124 14:19:50.099287 25743 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240124 14:19:50.114954 25743 grad_async_v2.h:91] StopThreads done.

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240124 12:26:35.064663 26726 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='ComplEx', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/ComplEx_FB15k_12', no_save_emb=True, max_step=500, batch_size=600, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [26726 sampler.py:454] Start PreSampling
WARNING [26726 sampler.py:532] Before construct renumbering_dict
WARNING [26726 sampler.py:555] PreSampling done
W20240124 12:26:39.371774 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240124 12:26:39.372263 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240124 12:26:39.372339 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240124 12:26:39.372411 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240124 12:26:39.372473 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240124 12:26:39.372514 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240124 12:26:39.372556 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240124 12:26:39.372606 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240124 12:26:39.372645 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240124 12:26:39.372685 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240124 12:26:39.372769 26726 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240124 12:26:39.372820 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240124 12:26:39.372859 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240124 12:26:39.373064 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240124 12:26:39.373135 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240124 12:26:39.373189 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240124 12:26:39.373230 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240124 12:26:39.373317 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240124 12:26:39.373361 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240124 12:26:39.373425 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240124 12:26:39.373490 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240124 12:26:39.373526 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240124 12:26:39.373589 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240124 12:26:39.373625 26726 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240124 12:26:39.373653 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240124 12:26:39.373699 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240124 12:26:39.373808 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240124 12:26:39.373857 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240124 12:26:39.373898 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240124 12:26:39.373976 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240124 12:26:39.374017 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240124 12:26:39.374068 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240124 12:26:39.374126 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240124 12:26:39.374174 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240124 12:26:39.374212 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240124 12:26:39.374274 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240124 12:26:39.374308 26726 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240124 12:26:39.374337 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240124 12:26:39.374377 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240124 12:26:39.374450 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240124 12:26:39.374500 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240124 12:26:39.374537 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240124 12:26:39.374578 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240124 12:26:39.374665 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240124 12:26:39.374706 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240124 12:26:39.374747 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240124 12:26:39.374781 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240124 12:26:39.374845 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240124 12:26:39.374908 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240124 12:26:39.374970 26726 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240124 12:26:39.375000 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240124 12:26:39.375032 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240124 12:26:39.375105 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000 781.2 kB
W20240124 12:26:39.375159 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000 781.2 kB
W20240124 12:26:39.375195 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000 781.2 kB
W20240124 12:26:39.375234 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000 781.2 kB
W20240124 12:26:39.375285 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000 781.2 kB
W20240124 12:26:39.375329 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000 781.2 kB
W20240124 12:26:39.375373 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000 781.2 kB
W20240124 12:26:39.375413 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000 781.2 kB
W20240124 12:26:39.375452 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000 781.2 kB
W20240124 12:26:39.375494 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000 781.2 kB
W20240124 12:26:39.375535 26726 IPCTensor.h:365] NewIPCTensor: step_r4 [10]0x100002694000 80 B 
W20240124 12:26:39.375581 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000 8 B 
W20240124 12:26:39.375643 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000 8 B 
W20240124 12:26:39.375730 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000 781.2 kB
W20240124 12:26:39.375769 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000 781.2 kB
W20240124 12:26:39.375833 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000 781.2 kB
W20240124 12:26:39.375880 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000 781.2 kB
W20240124 12:26:39.375946 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000 781.2 kB
W20240124 12:26:39.375982 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000 781.2 kB
W20240124 12:26:39.376034 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000 781.2 kB
W20240124 12:26:39.376091 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000 781.2 kB
W20240124 12:26:39.376163 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000 781.2 kB
W20240124 12:26:39.376206 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000 781.2 kB
W20240124 12:26:39.376273 26726 IPCTensor.h:365] NewIPCTensor: step_r5 [10]0x100002e4c000 80 B 
W20240124 12:26:39.376303 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000 8 B 
W20240124 12:26:39.376349 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000 8 B 
W20240124 12:26:39.376420 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_0 [100000]0x100002e52000 781.2 kB
W20240124 12:26:39.376462 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_1 [100000]0x100002f17000 781.2 kB
W20240124 12:26:39.376504 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_2 [100000]0x100002fdc000 781.2 kB
W20240124 12:26:39.376539 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_3 [100000]0x1000030a1000 781.2 kB
W20240124 12:26:39.376580 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_4 [100000]0x100003166000 781.2 kB
W20240124 12:26:39.376616 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_5 [100000]0x10000322b000 781.2 kB
W20240124 12:26:39.376662 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_6 [100000]0x1000032f0000 781.2 kB
W20240124 12:26:39.376699 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_7 [100000]0x1000033b5000 781.2 kB
W20240124 12:26:39.376735 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_8 [100000]0x10000347a000 781.2 kB
W20240124 12:26:39.376775 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r6_9 [100000]0x10000353f000 781.2 kB
W20240124 12:26:39.376824 26726 IPCTensor.h:365] NewIPCTensor: step_r6 [10]0x100003604000 80 B 
W20240124 12:26:39.376865 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r6 [1]0x100003606000 8 B 
W20240124 12:26:39.376895 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x100003608000 8 B 
W20240124 12:26:39.376968 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_0 [100000]0x10000360a000 781.2 kB
W20240124 12:26:39.377007 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_1 [100000]0x1000036cf000 781.2 kB
W20240124 12:26:39.377043 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_2 [100000]0x100003794000 781.2 kB
W20240124 12:26:39.377077 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_3 [100000]0x100003859000 781.2 kB
W20240124 12:26:39.377121 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_4 [100000]0x10000391e000 781.2 kB
W20240124 12:26:39.377162 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_5 [100000]0x1000039e3000 781.2 kB
W20240124 12:26:39.377198 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_6 [100000]0x100003aa8000 781.2 kB
W20240124 12:26:39.377240 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_7 [100000]0x100003b6d000 781.2 kB
W20240124 12:26:39.377279 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_8 [100000]0x100003c32000 781.2 kB
W20240124 12:26:39.377315 26726 IPCTensor.h:365] NewIPCTensor: cached_sampler_r7_9 [100000]0x100003cf7000 781.2 kB
W20240124 12:26:39.377357 26726 IPCTensor.h:365] NewIPCTensor: step_r7 [10]0x100003dbc000 80 B 
W20240124 12:26:39.377385 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r7 [1]0x100003dbe000 8 B 
W20240124 12:26:39.377414 26726 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100003dc0000 8 B 
W20240124 12:26:39.615168 26726 IPCTensor.h:365] NewIPCTensor: full_emb [14951, 400]0x100003dc2000 22.81 MB
W20240124 12:26:39.615399 26726 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100005494000 58.4 kB
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Rank4: cached key size 186
Rank5: cached key size 186
Rank6: cached key size 186
Rank7: cached key size 186
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([ 1499,  2041,  2794,  ...,  4664, 11485,  9326]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 4.590 seconds
[Rank1] pid = 27215
[Rank2] pid = 27269
[Rank3] pid = 27347
[Rank4] pid = 27348
[Rank5] pid = 27353
[Rank6] pid = 27479
INFO [26726 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [27215 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [27269 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [27347 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [27348 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [27353 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [27480 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [27479 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [27353 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [27479 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [27269 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [27480 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [27347 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [27215 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [27348 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [26726 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
WARNING [27353 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [27480 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [27269 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [27215 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [27348 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [27347 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [27479 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [26726 DistTensor.py:56] The tensor name already exists in the kvstore
I20240124 12:26:43.233265 27482 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240124 12:26:43.233398 27283 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 12:26:43.233891 27481 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 12:26:43.234050 27483 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 12:26:43.234172 27352 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 12:26:43.234284 27478 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 12:26:43.234401 27216 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 12:26:43.234520 27351 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240124 12:26:44.074072 27483 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240124 12:26:44.074834 27216 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 12:26:44.076704 27351 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 12:26:44.076807 27478 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 12:26:44.077075 27481 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 12:26:44.077366 27482 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 12:26:44.077947 27283 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240124 12:26:44.078737 27352 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.656 ms                  | 20.972 ms                 |
| Forward                   | 6.121 ms                  | 17.077 ms                 |
| Backward                  | 40.502 ms                 | 61.056 ms                 |
| Optimize                  | 1.483 ms                  | 7.110 ms                  |
| BarrierTimeBeforeRank0    | 2.142 ms                  | 25.191 ms                 |
| BlockToStepN              | 35.296 us                 | 328.683 us                |
| OneStep                   | 59.390 ms                 | 87.383 ms                 |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 6.641, sample: 0.165, forward: 0.824, backward: 3.022, update: 0.132
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 6.642, sample: 0.303, forward: 1.039, backward: 4.588, update: 0.186
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 6.642, sample: 0.178, forward: 0.847, backward: 3.440, update: 0.132
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 6.641, sample: 0.321, forward: 1.044, backward: 3.838, update: 0.192
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 6.640, sample: 0.262, forward: 0.929, backward: 3.933, update: 0.178
[Rank7] pid = 27480
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 1495), (1495, 2990), (2990, 4485), (4485, 5980), (5980, 7475), (7475, 8970), (8970, 10465), (10465, 11960)]
train_sampler.Prefill()
-------Step 0-------
tensor([   85,   158,  5446,  5246, 10448, 13639,  2058,  9890,  6323, 10194]) tensor([ 2794, 11730,  3435,  5588,   128,  1972,  1123,  5698,   978, 13793])
-------Step 1-------
tensor([   85,   158,  5446,  5246, 10448, 13639,  2058,  9890,  6323, 10194]) tensor([ 8564,  3430,  7274,  7834,  4444, 14587,  8927,  2550, 10689,  5542])
-------Step 2-------
tensor([ 5953,  5183,     7,  9397,  3946, 12095, 14763,   353,  4331,  1788]) tensor([ 2675, 14869, 13461, 12257,  4328, 12863,  4847, 13648,  1449, 14866])
-------Step 3-------
tensor([ 5953,  5183,     7,  9397,  3946, 12095, 14763,   353,  4331,  1788]) tensor([11861,  2892,  2939,  8780,  3759,    73, 11787,  5666,  8285,  5882])
-------Step 4-------
tensor([ 4138,  9752,  8055,  2699, 12310,  4492, 12371,  7410, 12378,  1766]) tensor([ 5438,  7782,  2749,  4517,  8429,  8446, 11360,  4893, 14247, 11962])
-------Step 5-------
tensor([ 4138,  9752,  8055,  2699, 12310,  4492, 12371,  7410, 12378,  1766]) tensor([ 9406, 13458,  6302,  3452,  3180,  5937,  9794,  2521,  5766,  6889])
-------Step 6-------
tensor([10681,   903,  3394,  5338,  7690,  9635,  9711, 14426,  4396, 14585]) tensor([ 4850, 12936, 10288, 10837,  5933,  8608,  9596,  4295,  7126,   502])
-------Step 7-------
tensor([10681,   903,  3394,  5338,  7690,  9635,  9711, 14426,  4396, 14585]) tensor([ 8047, 12239,  1636,  4134,  2238,  2885, 11909, 10327, 14756,  6968])
-------Step 8-------
tensor([  158, 12426, 12563,  6252,  7860,  4056,     6,  9505,   145,  1941]) tensor([1233, 1669,  612, 5256, 2415, 3353, 9890, 7333, 8334, 3271])
-------Step 9-------
tensor([  158, 12426, 12563,  6252,  7860,  4056,     6,  9505,   145,  1941]) tensor([12626,    42, 11575, 10910,  8114, 12246,  4069,  8595,  1529,  5412])
before start barrier
start train
[proc 0] 100 steps, total: 6.641, sample: 0.283, forward: 1.002, backward: 3.902, update: 0.197
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 6.644, sample: 0.235, forward: 0.816, backward: 3.539, update: 0.175
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 6.644, sample: 0.239, forward: 0.903, backward: 3.568, update: 0.194
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.401 ms                  | 20.972 ms                 |
| Forward                   | 5.285 ms                  | 17.077 ms                 |
| Backward                  | 33.389 ms                 | 63.922 ms                 |
| Optimize                  | 1.462 ms                  | 7.110 ms                  |
| BarrierTimeBeforeRank0    | 14.244 ms                 | 27.759 ms                 |
| BlockToStepN              | 27.116 us                 | 328.683 us                |
| OneStep                   | 57.819 ms                 | 87.383 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 7] 200 steps, total: 5.280, sample: 0.265, forward: 0.500, backward: 3.492, update: 0.127
[proc 2] 200 steps, total: 5.280, sample: 0.191, forward: 0.438, backward: 2.875, update: 0.109
[proc 0] 200 steps, total: 5.280, sample: 0.359, forward: 0.656, backward: 3.277, update: 0.174
[proc 3] 200 steps, total: 5.280, sample: 0.277, forward: 0.511, backward: 3.548, update: 0.126
[proc 5] 200 steps, total: 5.280, sample: 0.330, forward: 0.619, backward: 3.685, update: 0.150
[proc 4] 200 steps, total: 5.280, sample: 0.318, forward: 0.581, backward: 3.458, update: 0.150
[proc 6] 200 steps, total: 5.280, sample: 0.352, forward: 0.652, backward: 3.559, update: 0.158
[proc 1] 200 steps, total: 5.280, sample: 0.292, forward: 0.553, backward: 3.214, update: 0.153
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.757 ms                  | 20.972 ms                 |
| Forward                   | 6.374 ms                  | 17.077 ms                 |
| Backward                  | 32.684 ms                 | 61.056 ms                 |
| Optimize                  | 1.734 ms                  | 7.158 ms                  |
| BarrierTimeBeforeRank0    | 5.299 ms                  | 27.252 ms                 |
| BlockToStepN              | 26.954 us                 | 328.683 us                |
| OneStep                   | 55.091 ms                 | 83.985 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 5.020, sample: 0.249, forward: 0.518, backward: 2.988, update: 0.142
[proc 3] 300 steps, total: 5.020, sample: 0.208, forward: 0.469, backward: 3.546, update: 0.120
[proc 2] 300 steps, total: 5.020, sample: 0.273, forward: 0.541, backward: 3.238, update: 0.143
[proc 4] 300 steps, total: 5.020, sample: 0.310, forward: 0.628, backward: 3.425, update: 0.153
[proc 6] 300 steps, total: 5.020, sample: 0.306, forward: 0.637, backward: 3.448, update: 0.149
[proc 7] 300 steps, total: 5.020, sample: 0.251, forward: 0.534, backward: 3.510, update: 0.130
[proc 5] 300 steps, total: 5.020, sample: 0.301, forward: 0.606, backward: 3.177, update: 0.155
[proc 0] 300 steps, total: 5.020, sample: 0.359, forward: 0.726, backward: 3.307, update: 0.174
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.746 ms                  | 20.355 ms                 |
| Forward                   | 6.482 ms                  | 17.077 ms                 |
| Backward                  | 32.265 ms                 | 58.444 ms                 |
| Optimize                  | 1.709 ms                  | 7.110 ms                  |
| BarrierTimeBeforeRank0    | 4.946 ms                  | 27.252 ms                 |
| BlockToStepN              | 26.877 us                 | 328.683 us                |
| OneStep                   | 52.631 ms                 | 79.958 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.683 ms                  | 19.844 ms                 |
| Forward                   | 5.746 ms                  | 14.710 ms                 |
| Backward                  | 31.872 ms                 | 58.444 ms                 |
| Optimize                  | 1.652 ms                  | 5.588 ms                  |
| BarrierTimeBeforeRank0    | 6.601 ms                  | 29.269 ms                 |
| BlockToStepN              | 27.059 us                 | 327.169 us                |
| OneStep                   | 52.184 ms                 | 83.985 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 7] 400 steps, total: 7.662, sample: 0.274, forward: 0.593, backward: 4.457, update: 0.148
[proc 5] 400 steps, total: 7.662, sample: 0.316, forward: 0.574, backward: 4.435, update: 0.150
[proc 6] 400 steps, total: 7.662, sample: 0.158, forward: 0.428, backward: 4.233, update: 0.100
[proc 2] 400 steps, total: 7.662, sample: 0.294, forward: 0.536, backward: 3.662, update: 0.143
[proc 3] 400 steps, total: 7.662, sample: 0.307, forward: 0.585, backward: 4.170, update: 0.149
[proc 4] 400 steps, total: 7.662, sample: 0.330, forward: 0.584, backward: 4.026, update: 0.149
[proc 0] 400 steps, total: 7.662, sample: 0.196, forward: 0.471, backward: 4.042, update: 0.115
[proc 1] 400 steps, total: 7.662, sample: 0.282, forward: 0.481, backward: 3.223, update: 0.146
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.548 ms                  | 18.490 ms                 |
| Forward                   | 5.039 ms                  | 12.554 ms                 |
| Backward                  | 30.923 ms                 | 55.980 ms                 |
| Optimize                  | 1.422 ms                  | 4.543 ms                  |
| BarrierTimeBeforeRank0    | 9.418 ms                  | 32.475 ms                 |
| BlockToStepN              | 26.959 us                 | 296.391 us                |
| OneStep                   | 52.817 ms                 | 83.985 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 4] 500 steps, total: 5.243, sample: 0.277, forward: 0.561, backward: 3.401, update: 0.143
[proc 0] 500 steps, total: 5.243, sample: 0.163, forward: 0.419, backward: 2.867, update: 0.099
[proc 5] 500 steps, total: 5.243, sample: 0.293, forward: 0.535, backward: 3.191, update: 0.138
[proc 7] 500 steps, total: 5.243, sample: 0.220, forward: 0.448, backward: 3.060, update: 0.116
[proc 3] 500 steps, total: 5.243, sample: 0.325, forward: 0.590, backward: 3.505, update: 0.151
[proc 1] 500 steps, total: 5.243, sample: 0.265, forward: 0.524, backward: 3.272, update: 0.145
Successfully xmh. training takes 29.84691572189331 seconds
before call kg_cache_controller.StopThreads()
[proc 2] 500 steps, total: 5.243, sample: 0.270, forward: 0.519, backward: 3.246, update: 0.142
[proc 6] 500 steps, total: 5.243, sample: 0.313, forward: 0.586, backward: 3.405, update: 0.148
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
INFO [26726 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240221 09:03:33.765492 936466 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_41', no_save_emb=True, max_step=500, batch_size=800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [936466 sampler.py:454] Start PreSampling
WARNING [936466 sampler.py:532] Before construct renumbering_dict
WARNING [936466 sampler.py:555] PreSampling done
W20240221 09:03:36.443616 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240221 09:03:36.443742 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240221 09:03:36.443763 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240221 09:03:36.443786 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240221 09:03:36.443804 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240221 09:03:36.443821 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240221 09:03:36.443845 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240221 09:03:36.443867 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240221 09:03:36.443886 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240221 09:03:36.443900 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240221 09:03:36.443920 936466 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240221 09:03:36.443938 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240221 09:03:36.443951 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240221 09:03:36.444028 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240221 09:03:36.444051 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240221 09:03:36.444065 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240221 09:03:36.444099 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240221 09:03:36.444114 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240221 09:03:36.444136 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240221 09:03:36.444150 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240221 09:03:36.444168 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240221 09:03:36.444185 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240221 09:03:36.444198 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240221 09:03:36.444216 936466 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240221 09:03:36.444229 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240221 09:03:36.444242 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240221 09:03:36.444276 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240221 09:03:36.444298 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240221 09:03:36.444312 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240221 09:03:36.444331 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240221 09:03:36.444346 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240221 09:03:36.444360 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240221 09:03:36.444380 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240221 09:03:36.444397 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240221 09:03:36.444412 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240221 09:03:36.444432 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240221 09:03:36.444449 936466 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240221 09:03:36.444463 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240221 09:03:36.444474 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240221 09:03:36.444512 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240221 09:03:36.444530 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240221 09:03:36.444545 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240221 09:03:36.444559 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240221 09:03:36.444573 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240221 09:03:36.444587 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240221 09:03:36.444602 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240221 09:03:36.444619 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240221 09:03:36.444640 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240221 09:03:36.444654 936466 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240221 09:03:36.444670 936466 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240221 09:03:36.444684 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240221 09:03:36.444695 936466 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240221 09:03:36.568742 936466 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240221 09:03:36.595947 936466 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10022, num_edges=153684,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11359, num_edges=176198,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=11844, num_edges=177602,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10231, num_edges=261634,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10022 N 153684 E
MertisPartition: part 1 has 11359 N 176198 E
MertisPartition: part 2 has 11844 N 177602 E
MertisPartition: part 3 has 10231 N 261634 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    6,    10,    11,  ...,  3593, 10253,  2942]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 1, 1])}
After renumbering graph:  {'_ID': tensor([  923,  1077,  1101,  ...,  8276, 12057,  4762]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 1, 1])}
part_g: DGLGraph(num_nodes=10022, num_edges=153684,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10022, num_edges=153684,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.859 seconds
[Rank1] pid = 936691
[Rank2] pid = 936755
INFO [936466 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [936691 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [936756 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [936755 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [936756 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [936755 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240221 09:03:44.197309 936821 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240221 09:03:44.197379 936820 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240221 09:03:44.198357 936821 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100014878000 7.629 MB
W20240221 09:03:44.198381 936820 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10001501b000 7.629 MB
W20240221 09:03:44.198601 936821 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1000157be000 7.629 MB
W20240221 09:03:44.198623 936820 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x100015f61000 7.629 MB
W20240221 09:03:44.198740 936821 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x100016704000 1.49 GB
W20240221 09:03:44.198778 936820 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x100075ce7000 1.49 GB
W20240221 09:03:44.198843 936821 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1000d52ca000 1.49 GB
W20240221 09:03:44.198880 936820 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1001348ad000 1.49 GB
W20240221 09:03:44.198959 936821 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240221 09:03:44.198968 936820 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
INFO [936691 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [936466 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240221 09:03:44.201099 936692 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240221 09:03:44.201771 936757 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240221 09:03:44.209933 936692 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x100193e98000 7.629 MB
W20240221 09:03:44.209923 936821 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240221 09:03:44.209991 936820 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240221 09:03:44.210002 936757 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10019463b000 7.629 MB
W20240221 09:03:44.210041 936692 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100194dde000 7.629 MB
W20240221 09:03:44.210094 936692 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x100195581000 1.49 GB
W20240221 09:03:44.210122 936692 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001f4b64000 1.49 GB
W20240221 09:03:44.210146 936692 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240221 09:03:44.210156 936757 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100254147000 7.629 MB
W20240221 09:03:44.210268 936757 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1002548ea000 1.49 GB
W20240221 09:03:44.210337 936757 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1002b3ecd000 1.49 GB
W20240221 09:03:44.210399 936757 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240221 09:03:44.225834 936692 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240221 09:03:44.225905 936757 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [936756 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 936756
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [936466 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [936755 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [936691 DistTensor.py:59] The tensor name already exists in the kvstore
I20240221 09:03:45.467442 936692 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240221 09:03:45.467494 936757 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240221 09:03:45.467556 936821 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240221 09:03:45.467638 936820 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240221 09:03:45.852339 936820 recstore.cc:67] init folly done
E20240221 09:03:45.852509 936692 recstore.cc:67] init folly done
E20240221 09:03:45.852550 936821 recstore.cc:67] init folly done
E20240221 09:03:45.852607 936757 recstore.cc:67] init folly done
I20240221 09:03:45.902276 936820 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240221 09:03:45.919529 936757 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240221 09:03:45.920372 936692 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240221 09:03:45.922328 936821 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.482 us                | 709.482 us                |
| Forward                   | 925.092 ms                | 925.092 ms                |
| back: bucket keys         | 31.045 ms                 | 31.045 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.704 ms                  | 21.328 ms                 |
| Forward                   | 6.684 ms                  | 925.092 ms                |
| back: bucket keys         | 219.107 us                | 280.142 us                |
| back: a2a                 | 2.777 ms                  | 3.550 ms                  |
| back: cache               | 1.490 ms                  | 2.307 ms                  |
| back: aggr dram keys      | 19.425 ms                 | 25.391 ms                 |
| back: set dram grad       | 786.781 us                | 3.031 ms                  |
| Backward                  | 52.400 ms                 | 5.690 s                   |
| Optimize                  | 11.440 ms                 | 34.044 ms                 |
| BarrierTimeBeforeRank0    | 69.580 us                 | 104.458 us                |
| BlockToStepN              | 26.080 us                 | 71.020 us                 |
| OneStep                   | 73.962 ms                 | 6.630 s                   |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 14.307, sample: 0.385, forward: 1.499, backward: 10.454, update: 0.172
train_sampler.Prefill()
-------Step 0-------
tensor([2104, 1791, 4322,  851,    0, 9960, 2331, 1092,  125, 7453]) tensor([ 1101, 11550,  1664,  4162,  5030,  9137,  3979,  1038,   907,  8477])
-------Step 1-------
tensor([2104, 1791, 4322,  851,    0, 9960, 2331, 1092,  125, 7453]) tensor([14386,  1111,  3146,  1640,  7755,  2339,  1219,  5031,  9420, 14752])
-------Step 2-------
tensor([11525, 13455,  5921,  3146,  1029,  9813,  3320, 14230,   903,  7374]) tensor([ 3381, 11578, 14277,  6464,  8002,  6448,  3833,  8838,  5500, 11888])
-------Step 3-------
tensor([11525, 13455,  5921,  3146,  1029,  9813,  3320, 14230,   903,  7374]) tensor([ 7481, 11295, 14532,  8627,  4994,  7670,  2128,  9272, 14896, 12179])
-------Step 4-------
tensor([  14,   81, 1669, 6957,    0,   50,  107, 1382, 7175, 6110]) tensor([4035, 1749, 9124,  266, 4392, 9147, 2880, 3322, 8124,  777])
-------Step 5-------
tensor([  14,   81, 1669, 6957,    0,   50,  107, 1382, 7175, 6110]) tensor([ 1910,  4465, 14658, 11137,  5717, 10799,  6279,  7860,  6207, 12280])
-------Step 6-------
tensor([ 4244,  3771, 13256,  5568, 10884,   133, 12140,  7333, 12643,  1000]) tensor([ 7373,  5325, 13705,  6147, 11808,  3074,  7533,  3929,  3482,  1964])
-------Step 7-------
tensor([ 4244,  3771, 13256,  5568, 10884,   133, 12140,  7333, 12643,  1000]) tensor([ 7841,  1911, 12254, 13662,  6192,  6959,  9969, 13348,  8199,  9848])
-------Step 8-------
tensor([11825,   601,    59,   811,     3,  9435,  6948,  6937,  9196,  7292]) tensor([ 3507, 10003, 14883,  9592,  4250, 12228,  5421,  2704,  1042,  8769])
-------Step 9-------
tensor([11825,   601,    59,   811,     3,  9435,  6948,  6937,  9196,  7292]) tensor([10163,   360,  8515,  8297,  7080, 12972,  6901,  4388, 12139, 13957])
before start barrier
start train
[proc 0] 100 steps, total: 14.310, sample: 0.395, forward: 1.557, backward: 11.055, update: 1.173
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 14.309, sample: 0.376, forward: 1.479, backward: 10.288, update: 0.167
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 14.328, sample: 0.373, forward: 1.469, backward: 10.323, update: 0.161
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.723 ms                  | 21.245 ms                 |
| Forward                   | 6.695 ms                  | 7.171 ms                  |
| back: bucket keys         | 213.385 us                | 247.478 us                |
| back: a2a                 | 2.579 ms                  | 3.550 ms                  |
| back: cache               | 1.282 ms                  | 2.114 ms                  |
| back: aggr dram keys      | 21.624 ms                 | 26.985 ms                 |
| back: set dram grad       | 725.508 us                | 3.029 ms                  |
| Backward                  | 55.588 ms                 | 65.436 ms                 |
| Optimize                  | 11.478 ms                 | 20.359 ms                 |
| BarrierTimeBeforeRank0    | 58.441 us                 | 101.010 us                |
| BlockToStepN              | 26.835 us                 | 71.020 us                 |
| OneStep                   | 76.520 ms                 | 103.603 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.729 ms                  | 21.328 ms                 |
| Forward                   | 6.687 ms                  | 6.896 ms                  |
| back: bucket keys         | 216.007 us                | 239.372 us                |
| back: a2a                 | 2.583 ms                  | 3.550 ms                  |
| back: cache               | 1.282 ms                  | 2.114 ms                  |
| back: aggr dram keys      | 20.117 ms                 | 25.984 ms                 |
| back: set dram grad       | 732.183 us                | 3.029 ms                  |
| Backward                  | 53.486 ms                 | 63.928 ms                 |
| Optimize                  | 11.485 ms                 | 20.088 ms                 |
| BarrierTimeBeforeRank0    | 58.376 us                 | 100.862 us                |
| BlockToStepN              | 26.915 us                 | 53.348 us                 |
| OneStep                   | 75.862 ms                 | 101.283 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 7.623, sample: 0.440, forward: 0.641, backward: 5.270, update: 1.137
[proc 2] 200 steps, total: 7.623, sample: 0.439, forward: 0.569, backward: 4.762, update: 0.161
[proc 1] 200 steps, total: 7.624, sample: 0.428, forward: 0.567, backward: 4.566, update: 0.166
[proc 3] 200 steps, total: 7.624, sample: 0.437, forward: 0.589, backward: 4.564, update: 0.173
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.732 ms                  | 21.522 ms                 |
| Forward                   | 6.684 ms                  | 6.896 ms                  |
| back: bucket keys         | 212.193 us                | 234.842 us                |
| back: a2a                 | 2.524 ms                  | 3.550 ms                  |
| back: cache               | 1.282 ms                  | 1.856 ms                  |
| back: aggr dram keys      | 21.605 ms                 | 26.985 ms                 |
| back: set dram grad       | 722.408 us                | 3.009 ms                  |
| Backward                  | 54.876 ms                 | 65.056 ms                 |
| Optimize                  | 11.522 ms                 | 20.359 ms                 |
| BarrierTimeBeforeRank0    | 58.272 us                 | 100.862 us                |
| BlockToStepN              | 27.375 us                 | 71.020 us                 |
| OneStep                   | 75.968 ms                 | 103.040 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.734 ms                  | 21.489 ms                 |
| Forward                   | 6.676 ms                  | 6.889 ms                  |
| back: bucket keys         | 182.152 us                | 232.935 us                |
| back: a2a                 | 2.473 ms                  | 3.522 ms                  |
| back: cache               | 1.282 ms                  | 1.719 ms                  |
| back: aggr dram keys      | 21.667 ms                 | 26.521 ms                 |
| back: set dram grad       | 708.818 us                | 2.976 ms                  |
| Backward                  | 54.822 ms                 | 63.928 ms                 |
| Optimize                  | 11.524 ms                 | 20.181 ms                 |
| BarrierTimeBeforeRank0    | 58.303 us                 | 96.806 us                 |
| BlockToStepN              | 27.635 us                 | 71.020 us                 |
| OneStep                   | 75.665 ms                 | 101.908 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 300 steps, total: 7.786, sample: 0.225, forward: 0.358, backward: 5.433, update: 0.103
[proc 0] 300 steps, total: 7.786, sample: 0.400, forward: 0.634, backward: 5.488, update: 1.135
[proc 1] 300 steps, total: 7.786, sample: 0.382, forward: 0.557, backward: 4.581, update: 0.165
[proc 3] 300 steps, total: 7.786, sample: 0.400, forward: 0.586, backward: 4.628, update: 0.167
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.736 ms                  | 21.489 ms                 |
| Forward                   | 6.671 ms                  | 6.874 ms                  |
| back: bucket keys         | 175.953 us                | 231.028 us                |
| back: a2a                 | 2.462 ms                  | 3.595 ms                  |
| back: cache               | 1.286 ms                  | 1.647 ms                  |
| back: aggr dram keys      | 21.745 ms                 | 26.308 ms                 |
| back: set dram grad       | 698.805 us                | 2.737 ms                  |
| Backward                  | 54.876 ms                 | 63.318 ms                 |
| Optimize                  | 11.540 ms                 | 21.853 ms                 |
| BarrierTimeBeforeRank0    | 58.385 us                 | 96.806 us                 |
| BlockToStepN              | 27.830 us                 | 71.020 us                 |
| OneStep                   | 75.948 ms                 | 101.283 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 8.005, sample: 0.413, forward: 0.638, backward: 5.494, update: 1.327
[proc 3] 400 steps, total: 8.005, sample: 0.389, forward: 0.581, backward: 4.707, update: 0.166
[proc 2] 400 steps, total: 8.005, sample: 0.345, forward: 0.505, backward: 5.007, update: 0.146
[proc 1] 400 steps, total: 8.005, sample: 0.395, forward: 0.570, backward: 4.943, update: 0.163
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.736 ms                  | 21.522 ms                 |
| Forward                   | 6.673 ms                  | 6.889 ms                  |
| back: bucket keys         | 174.522 us                | 230.789 us                |
| back: a2a                 | 2.447 ms                  | 3.550 ms                  |
| back: cache               | 1.294 ms                  | 1.618 ms                  |
| back: aggr dram keys      | 21.763 ms                 | 26.308 ms                 |
| back: set dram grad       | 690.937 us                | 2.640 ms                  |
| Backward                  | 54.917 ms                 | 63.318 ms                 |
| Optimize                  | 11.543 ms                 | 21.853 ms                 |
| BarrierTimeBeforeRank0    | 58.374 us                 | 96.806 us                 |
| BlockToStepN              | 27.756 us                 | 71.020 us                 |
| OneStep                   | 76.091 ms                 | 101.283 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.737 ms                  | 21.509 ms                 |
| Forward                   | 6.673 ms                  | 6.874 ms                  |
| back: bucket keys         | 174.046 us                | 230.312 us                |
| back: a2a                 | 2.447 ms                  | 19.171 ms                 |
| back: cache               | 1.294 ms                  | 1.617 ms                  |
| back: aggr dram keys      | 21.776 ms                 | 25.827 ms                 |
| back: set dram grad       | 689.983 us                | 2.434 ms                  |
| Backward                  | 55.062 ms                 | 73.197 ms                 |
| Optimize                  | 11.546 ms                 | 21.468 ms                 |
| BarrierTimeBeforeRank0    | 58.291 us                 | 96.595 us                 |
| BlockToStepN              | 27.531 us                 | 58.943 us                 |
| OneStep                   | 76.304 ms                 | 101.033 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 8.132, sample: 0.420, forward: 0.552, backward: 4.907, update: 0.159
[proc 1] 500 steps, total: 8.132, sample: 0.416, forward: 0.558, backward: 4.925, update: 0.160
[proc 0] 500 steps, total: 8.132, sample: 0.401, forward: 0.641, backward: 5.797, update: 1.160
[proc 3] 500 steps, total: 8.132, sample: 0.414, forward: 0.591, backward: 5.295, update: 0.167
Successfully xmh. training takes 45.85759472846985 seconds
before call kg_cache_controller.StopThreads()
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
INFO [936466 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

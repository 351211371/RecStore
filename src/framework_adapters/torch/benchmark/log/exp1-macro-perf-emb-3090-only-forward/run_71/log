perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f9e3f0d4e50>==========
Worker 0 pid=40327
Worker 1 pid=40328
Worker 2 pid=40329
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  9%|▊         | 86/1000 [00:00<00:01, 859.94it/s]Step99:rank2, time: 0.128, per_step: 0.001283
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
 19%|█▉        | 193/1000 [00:00<00:00, 954.26it/s]  0%|          | 0/1000 [00:00<?, ?it/s]Step199:rank2, time: 0.102, per_step: 0.001011
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]Step299:rank2, time: 0.081, per_step: 0.000798
Step99:rank3, time: 0.087, per_step: 0.000871
Step99:rank1, time: 0.077, per_step: 0.000769
Step99:rank0, time: 0.116, per_step: 0.001159
 34%|███▎      | 335/1000 [00:00<00:00, 1161.84it/s] 10%|█         | 105/1000 [00:00<00:00, 974.42it/s] 14%|█▍        | 143/1000 [00:00<00:00, 1385.52it/s] 17%|█▋        | 168/1000 [00:00<00:00, 1587.45it/s]Step399:rank2, time: 0.046, per_step: 0.000452
Step199:rank1, time: 0.054, per_step: 0.000533
Step199:rank3, time: 0.060, per_step: 0.000594
Step299:rank3, time: 0.044, per_step: 0.000440
 47%|████▋     | 468/1000 [00:00<00:00, 1226.10it/s]Step199:rank0, time: 0.115, per_step: 0.001137
 20%|██        | 203/1000 [00:00<00:00, 960.82it/s]Step499:rank2, time: 0.085, per_step: 0.000843
 36%|███▋      | 364/1000 [00:00<00:00, 1860.75it/s]Step299:rank1, time: 0.082, per_step: 0.000811
 33%|███▎      | 327/1000 [00:00<00:00, 1538.75it/s]Step399:rank3, time: 0.043, per_step: 0.000423
Step299:rank0, time: 0.037, per_step: 0.000363
Step599:rank2, time: 0.035, per_step: 0.000349
Step399:rank1, time: 0.033, per_step: 0.000329
Step499:rank3, time: 0.033, per_step: 0.000328
Step399:rank0, time: 0.033, per_step: 0.000331
Step699:rank2, time: 0.033, per_step: 0.000328
Step499:rank1, time: 0.033, per_step: 0.000329
Step599:rank3, time: 0.033, per_step: 0.000331
 75%|███████▌  | 752/1000 [00:00<00:00, 1801.49it/s] 49%|████▉     | 494/1000 [00:00<00:00, 1825.55it/s]Step499:rank0, time: 0.034, per_step: 0.000334
Step799:rank2, time: 0.033, per_step: 0.000331
 66%|██████▋   | 663/1000 [00:00<00:00, 2369.75it/s]Step599:rank1, time: 0.033, per_step: 0.000327
Step699:rank3, time: 0.033, per_step: 0.000327
 63%|██████▎   | 629/1000 [00:00<00:00, 2191.86it/s]Step599:rank0, time: 0.033, per_step: 0.000331
Step699:rank1, time: 0.033, per_step: 0.000327
Step899:rank2, time: 0.040, per_step: 0.000396
Step799:rank3, time: 0.033, per_step: 0.000326
Step699:rank0, time: 0.038, per_step: 0.000376
Step799:rank1, time: 0.033, per_step: 0.000330
Step999:rank2, time: 0.033, per_step: 0.000330
100%|██████████| 1000/1000 [00:00<00:00, 1678.86it/s]
Step899:rank3, time: 0.034, per_step: 0.000334
 78%|███████▊  | 775/1000 [00:00<00:00, 2205.34it/s] 96%|█████████▌| 962/1000 [00:00<00:00, 2612.14it/s]Step799:rank0, time: 0.035, per_step: 0.000350
Step899:rank1, time: 0.034, per_step: 0.000337
 93%|█████████▎| 928/1000 [00:00<00:00, 2497.33it/s]Step999:rank3, time: 0.038, per_step: 0.000379
100%|██████████| 1000/1000 [00:00<00:00, 2374.49it/s]
Step999:rank1, time: 0.034, per_step: 0.000338
100%|██████████| 1000/1000 [00:00<00:00, 2289.81it/s]Step899:rank0, time: 0.034, per_step: 0.000341

Step999:rank0, time: 0.034, per_step: 0.000342
100%|██████████| 1000/1000 [00:00<00:00, 2043.96it/s]
Worker 3 pid=40330
Successfully xmh

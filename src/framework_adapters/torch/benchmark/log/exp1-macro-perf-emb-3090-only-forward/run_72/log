perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f5dbfe3de50>==========
Worker 0 pid=48758
Worker 1 pid=48759
Worker 2 pid=48760
Worker 3 pid=48761
Worker 4 pid=48762
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:02<33:24,  2.01s/it]  0%|          | 1/1000 [00:02<33:48,  2.03s/it]  0%|          | 1/1000 [00:02<34:05,  2.05s/it]  0%|          | 1/1000 [00:02<34:20,  2.06s/it]  0%|          | 1/1000 [00:02<34:25,  2.07s/it]  0%|          | 1/1000 [00:02<34:35,  2.08s/it]  5%|▌         | 52/1000 [00:02<00:27, 34.34it/s]  5%|▌         | 51/1000 [00:02<00:28, 33.32it/s]  5%|▌         | 51/1000 [00:02<00:28, 33.05it/s]  5%|▌         | 52/1000 [00:02<00:28, 33.46it/s]  5%|▌         | 54/1000 [00:02<00:27, 34.67it/s]  5%|▌         | 53/1000 [00:02<00:27, 33.91it/s]Step99:rank1, time: 2.191, per_step: 0.021913
Step99:rank2, time: 2.217, per_step: 0.022166
 12%|█▏        | 117/1000 [00:02<00:10, 87.63it/s]Step99:rank4, time: 2.237, per_step: 0.022374
 12%|█▏        | 116/1000 [00:02<00:10, 86.20it/s]Step99:rank5, time: 2.248, per_step: 0.022483
Step99:rank0, time: 2.249, per_step: 0.022494
 11%|█▏        | 113/1000 [00:02<00:10, 83.02it/s]Step99:rank3, time: 2.261, per_step: 0.022605
 12%|█▏        | 117/1000 [00:02<00:10, 85.56it/s] 12%|█▏        | 119/1000 [00:02<00:10, 86.56it/s] 12%|█▏        | 118/1000 [00:02<00:10, 85.68it/s] 19%|█▉        | 194/1000 [00:02<00:04, 162.55it/s]Step199:rank1, time: 0.133, per_step: 0.001315
 19%|█▉        | 194/1000 [00:02<00:04, 161.76it/s]Step199:rank2, time: 0.131, per_step: 0.001301
 18%|█▊        | 185/1000 [00:02<00:05, 152.09it/s] 19%|█▉        | 194/1000 [00:02<00:05, 159.26it/s]Step199:rank4, time: 0.139, per_step: 0.001374
Step199:rank5, time: 0.132, per_step: 0.001312
 20%|█▉        | 195/1000 [00:02<00:05, 158.95it/s] 19%|█▉        | 194/1000 [00:02<00:05, 157.95it/s]Step199:rank0, time: 0.135, per_step: 0.001332
Step199:rank3, time: 0.134, per_step: 0.001331
 28%|██▊       | 285/1000 [00:02<00:02, 263.83it/s]Step299:rank1, time: 0.108, per_step: 0.001070
 29%|██▉       | 288/1000 [00:02<00:02, 266.39it/s]Step299:rank2, time: 0.105, per_step: 0.001042
 27%|██▋       | 270/1000 [00:02<00:02, 245.69it/s] 29%|██▊       | 286/1000 [00:02<00:02, 260.67it/s] 29%|██▊       | 286/1000 [00:02<00:02, 258.64it/s] 28%|██▊       | 284/1000 [00:02<00:02, 256.44it/s]Step299:rank5, time: 0.107, per_step: 0.001056
Step299:rank4, time: 0.113, per_step: 0.001117
Step299:rank0, time: 0.109, per_step: 0.001079
Step299:rank3, time: 0.109, per_step: 0.001076
 40%|███▉      | 398/1000 [00:02<00:01, 403.93it/s]Step399:rank1, time: 0.088, per_step: 0.000868
Step399:rank2, time: 0.085, per_step: 0.000841
 40%|████      | 405/1000 [00:02<00:01, 411.78it/s] 37%|███▋      | 372/1000 [00:02<00:01, 369.72it/s] 40%|███▉      | 399/1000 [00:02<00:01, 399.74it/s]Step399:rank5, time: 0.087, per_step: 0.000864
Step399:rank4, time: 0.094, per_step: 0.000930
 40%|███▉      | 395/1000 [00:02<00:01, 391.08it/s] 39%|███▉      | 394/1000 [00:02<00:01, 390.48it/s]Step399:rank0, time: 0.090, per_step: 0.000894
Step399:rank3, time: 0.090, per_step: 0.000888
Step499:rank1, time: 0.073, per_step: 0.000727
Step499:rank2, time: 0.071, per_step: 0.000705
 54%|█████▍    | 539/1000 [00:02<00:00, 592.87it/s] 55%|█████▌    | 553/1000 [00:02<00:00, 611.09it/s]Step499:rank5, time: 0.073, per_step: 0.000719
 50%|████▉     | 496/1000 [00:02<00:00, 531.70it/s]Step499:rank4, time: 0.079, per_step: 0.000778
Step599:rank1, time: 0.061, per_step: 0.000606
Step499:rank0, time: 0.075, per_step: 0.000742
Step499:rank3, time: 0.075, per_step: 0.000738
Step599:rank2, time: 0.060, per_step: 0.000597
 54%|█████▍    | 541/1000 [00:02<00:00, 589.49it/s] 53%|█████▎    | 532/1000 [00:02<00:00, 572.36it/s] 53%|█████▎    | 528/1000 [00:02<00:00, 565.67it/s]Step599:rank5, time: 0.062, per_step: 0.000612
Step699:rank1, time: 0.053, per_step: 0.000524
Step699:rank2, time: 0.052, per_step: 0.000511
 72%|███████▏  | 723/1000 [00:02<00:00, 856.14it/s]Step599:rank4, time: 0.067, per_step: 0.000663
Step599:rank0, time: 0.067, per_step: 0.000662
Step599:rank3, time: 0.075, per_step: 0.000742
 74%|███████▍  | 745/1000 [00:02<00:00, 886.48it/s] 65%|██████▌   | 651/1000 [00:02<00:00, 745.10it/s]Step799:rank1, time: 0.046, per_step: 0.000454
Step699:rank5, time: 0.054, per_step: 0.000532
Step799:rank2, time: 0.046, per_step: 0.000455
 72%|███████▏  | 722/1000 [00:02<00:00, 845.64it/s]Step699:rank4, time: 0.058, per_step: 0.000574
Step699:rank0, time: 0.055, per_step: 0.000540
 70%|███████   | 700/1000 [00:02<00:00, 803.93it/s] 68%|██████▊   | 685/1000 [00:02<00:00, 775.21it/s]Step699:rank3, time: 0.054, per_step: 0.000538
Step899:rank1, time: 0.041, per_step: 0.000405
Step899:rank2, time: 0.040, per_step: 0.000395
Step799:rank5, time: 0.047, per_step: 0.000464
 97%|█████████▋| 966/1000 [00:02<00:00, 1221.20it/s]Step799:rank4, time: 0.051, per_step: 0.000507
Step999:rank1, time: 0.037, per_step: 0.000364
100%|██████████| 1000/1000 [00:02<00:00, 354.11it/s]
100%|█████████▉| 998/1000 [00:02<00:00, 1266.10it/s]Step999:rank2, time: 0.037, per_step: 0.000363
100%|██████████| 1000/1000 [00:02<00:00, 352.65it/s]
Step799:rank3, time: 0.047, per_step: 0.000468
Step799:rank0, time: 0.060, per_step: 0.000599
Step899:rank5, time: 0.042, per_step: 0.000412
 84%|████████▍ | 845/1000 [00:02<00:00, 1020.25it/s] 96%|█████████▌| 958/1000 [00:02<00:00, 1194.56it/s]Step899:rank4, time: 0.047, per_step: 0.000462
Step899:rank3, time: 0.043, per_step: 0.000426
 89%|████████▉ | 891/1000 [00:02<00:00, 1057.93it/s] 90%|█████████ | 905/1000 [00:02<00:00, 1101.92it/s]Step999:rank5, time: 0.039, per_step: 0.000382
100%|██████████| 1000/1000 [00:02<00:00, 346.96it/s]
Step899:rank0, time: 0.044, per_step: 0.000434
Step999:rank4, time: 0.043, per_step: 0.000423
Step999:rank3, time: 0.040, per_step: 0.000392
100%|██████████| 1000/1000 [00:02<00:00, 342.59it/s]100%|██████████| 1000/1000 [00:02<00:00, 342.57it/s]

Step999:rank0, time: 0.040, per_step: 0.000396
100%|██████████| 1000/1000 [00:02<00:00, 342.80it/s]
Worker 5 pid=48763
Successfully xmh

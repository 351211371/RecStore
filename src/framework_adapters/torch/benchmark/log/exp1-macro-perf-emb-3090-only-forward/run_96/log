perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f755154ae50>==========
Worker 0 pid=50179
Worker 1 pid=50180
Worker 2 pid=50181
Worker 3 pid=50182
Worker 4 pid=50183
Worker 5 pid=50184
Worker 6 pid=50185
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:02<38:20,  2.30s/it]  0%|          | 1/1000 [00:02<38:43,  2.33s/it]  0%|          | 1/1000 [00:02<38:44,  2.33s/it]  0%|          | 1/1000 [00:02<38:45,  2.33s/it]  0%|          | 1/1000 [00:02<39:06,  2.35s/it]  0%|          | 1/1000 [00:02<39:36,  2.38s/it]  5%|▌         | 52/1000 [00:02<00:31, 30.20it/s]  5%|▌         | 53/1000 [00:02<00:31, 30.49it/s]  5%|▌         | 53/1000 [00:02<00:31, 30.47it/s]  0%|          | 1/1000 [00:02<40:24,  2.43s/it]  5%|▌         | 50/1000 [00:02<00:33, 28.71it/s]  5%|▌         | 50/1000 [00:02<00:33, 28.48it/s]  0%|          | 1/1000 [00:02<40:53,  2.46s/it]Step99:rank5, time: 2.494, per_step: 0.024935
  5%|▌         | 52/1000 [00:02<00:32, 29.28it/s]Step99:rank2, time: 2.515, per_step: 0.025154
Step99:rank1, time: 2.517, per_step: 0.025168
 12%|█▏        | 118/1000 [00:02<00:11, 78.66it/s]Step99:rank3, time: 2.527, per_step: 0.025270
 12%|█▏        | 119/1000 [00:02<00:11, 78.53it/s]  5%|▌         | 51/1000 [00:02<00:33, 28.17it/s] 12%|█▏        | 120/1000 [00:02<00:11, 79.19it/s] 11%|█         | 112/1000 [00:02<00:12, 73.80it/s]Step99:rank4, time: 2.547, per_step: 0.025470
 11%|█▏        | 113/1000 [00:02<00:11, 73.95it/s]  5%|▌         | 54/1000 [00:02<00:32, 29.51it/s]Step99:rank7, time: 2.573, per_step: 0.025725
 12%|█▏        | 116/1000 [00:02<00:11, 74.98it/s] 20%|█▉        | 196/1000 [00:02<00:05, 148.03it/s]Step199:rank5, time: 0.132, per_step: 0.001305
Step99:rank6, time: 2.628, per_step: 0.026280
 19%|█▉        | 188/1000 [00:02<00:05, 138.64it/s] 11%|█         | 111/1000 [00:02<00:12, 70.21it/s]Step99:rank0, time: 2.645, per_step: 0.026449
 19%|█▊        | 186/1000 [00:02<00:05, 139.22it/s] 20%|█▉        | 198/1000 [00:02<00:05, 147.96it/s]Step199:rank1, time: 0.131, per_step: 0.001298
Step199:rank2, time: 0.142, per_step: 0.001411
Step199:rank3, time: 0.136, per_step: 0.001343
 19%|█▊        | 187/1000 [00:02<00:05, 138.80it/s] 12%|█▏        | 119/1000 [00:02<00:11, 74.66it/s]Step199:rank4, time: 0.136, per_step: 0.001350
 19%|█▉        | 191/1000 [00:02<00:05, 140.12it/s]Step199:rank7, time: 0.135, per_step: 0.001335
 29%|██▉       | 289/1000 [00:02<00:02, 244.65it/s]Step299:rank5, time: 0.107, per_step: 0.001057
 28%|██▊       | 278/1000 [00:02<00:03, 232.21it/s] 19%|█▊        | 186/1000 [00:02<00:06, 134.77it/s] 27%|██▋       | 274/1000 [00:02<00:03, 230.27it/s] 29%|██▉       | 291/1000 [00:02<00:02, 243.95it/s]Step299:rank1, time: 0.107, per_step: 0.001059
Step199:rank6, time: 0.134, per_step: 0.001327
Step299:rank2, time: 0.108, per_step: 0.001067
 28%|██▊       | 275/1000 [00:02<00:03, 229.28it/s]Step299:rank3, time: 0.109, per_step: 0.001081
 20%|█▉        | 195/1000 [00:02<00:05, 139.18it/s]Step199:rank0, time: 0.134, per_step: 0.001326
Step299:rank4, time: 0.110, per_step: 0.001088
 28%|██▊       | 280/1000 [00:02<00:03, 230.93it/s]Step299:rank7, time: 0.109, per_step: 0.001083
Step399:rank5, time: 0.087, per_step: 0.000865
 40%|████      | 403/1000 [00:02<00:01, 378.81it/s]Step399:rank1, time: 0.086, per_step: 0.000856
 39%|███▉      | 388/1000 [00:02<00:01, 361.81it/s] 28%|██▊       | 275/1000 [00:02<00:03, 225.02it/s] 38%|███▊      | 381/1000 [00:02<00:01, 355.69it/s] 41%|████      | 406/1000 [00:02<00:01, 379.17it/s]Step399:rank2, time: 0.088, per_step: 0.000871
Step399:rank3, time: 0.090, per_step: 0.000886
 38%|███▊      | 382/1000 [00:02<00:01, 353.75it/s]Step299:rank6, time: 0.108, per_step: 0.001067
 29%|██▊       | 286/1000 [00:02<00:03, 230.41it/s]Step399:rank4, time: 0.090, per_step: 0.000895
Step299:rank0, time: 0.108, per_step: 0.001074
Step499:rank5, time: 0.073, per_step: 0.000723
 39%|███▉      | 388/1000 [00:02<00:01, 356.17it/s]Step399:rank7, time: 0.090, per_step: 0.000888
Step499:rank1, time: 0.072, per_step: 0.000717
 55%|█████▍    | 546/1000 [00:02<00:00, 564.24it/s]Step499:rank2, time: 0.073, per_step: 0.000725
Step499:rank3, time: 0.074, per_step: 0.000734
 53%|█████▎    | 526/1000 [00:02<00:00, 540.50it/s] 38%|███▊      | 384/1000 [00:02<00:01, 350.73it/s] 52%|█████▏    | 515/1000 [00:02<00:00, 528.66it/s] 55%|█████▌    | 552/1000 [00:02<00:00, 568.99it/s]Step599:rank5, time: 0.062, per_step: 0.000610
Step399:rank6, time: 0.089, per_step: 0.000879
Step499:rank4, time: 0.075, per_step: 0.000745
 51%|█████▏    | 514/1000 [00:02<00:00, 522.55it/s] 40%|███▉      | 397/1000 [00:02<00:01, 357.30it/s]Step599:rank1, time: 0.061, per_step: 0.000600
Step399:rank0, time: 0.089, per_step: 0.000884
Step499:rank7, time: 0.075, per_step: 0.000742
Step599:rank2, time: 0.063, per_step: 0.000620
 52%|█████▏    | 522/1000 [00:02<00:00, 527.33it/s]Step599:rank3, time: 0.063, per_step: 0.000622
Step699:rank5, time: 0.053, per_step: 0.000526
 73%|███████▎  | 731/1000 [00:03<00:00, 822.80it/s]Step599:rank4, time: 0.064, per_step: 0.000631
Step699:rank1, time: 0.053, per_step: 0.000522
Step499:rank6, time: 0.073, per_step: 0.000726
Step699:rank2, time: 0.054, per_step: 0.000531
 70%|███████   | 702/1000 [00:03<00:00, 785.11it/s]Step599:rank7, time: 0.064, per_step: 0.000636
 52%|█████▏    | 521/1000 [00:03<00:00, 525.79it/s] 69%|██████▉   | 688/1000 [00:03<00:00, 769.12it/s] 74%|███████▍  | 740/1000 [00:03<00:00, 831.84it/s]Step499:rank0, time: 0.075, per_step: 0.000739
Step699:rank3, time: 0.054, per_step: 0.000535
Step799:rank5, time: 0.047, per_step: 0.000462
 68%|██████▊   | 683/1000 [00:03<00:00, 755.49it/s]Step799:rank1, time: 0.046, per_step: 0.000454
 54%|█████▎    | 535/1000 [00:03<00:00, 532.32it/s]Step699:rank4, time: 0.055, per_step: 0.000544
Step799:rank2, time: 0.047, per_step: 0.000467
Step599:rank6, time: 0.062, per_step: 0.000615
Step899:rank5, time: 0.041, per_step: 0.000409
 67%|██████▋   | 670/1000 [00:03<00:00, 716.35it/s]Step799:rank3, time: 0.047, per_step: 0.000462
Step899:rank1, time: 0.041, per_step: 0.000401
Step599:rank0, time: 0.062, per_step: 0.000618
Step699:rank7, time: 0.071, per_step: 0.000701
 97%|█████████▋| 973/1000 [00:03<00:00, 1179.11it/s]Step799:rank4, time: 0.048, per_step: 0.000474
Step899:rank2, time: 0.041, per_step: 0.000406
Step999:rank5, time: 0.037, per_step: 0.000368
100%|██████████| 1000/1000 [00:03<00:00, 320.87it/s]
Step899:rank3, time: 0.042, per_step: 0.000416
 93%|█████████▎| 932/1000 [00:03<00:00, 1122.40it/s] 99%|█████████▉| 989/1000 [00:03<00:00, 1201.17it/s] 70%|██████▉   | 697/1000 [00:03<00:00, 768.66it/s] 91%|█████████▏| 913/1000 [00:03<00:00, 1098.09it/s]Step699:rank6, time: 0.054, per_step: 0.000535
Step999:rank1, time: 0.037, per_step: 0.000365
100%|██████████| 1000/1000 [00:03<00:00, 319.01it/s]
Step799:rank7, time: 0.048, per_step: 0.000472
Step699:rank0, time: 0.054, per_step: 0.000538
Step899:rank4, time: 0.043, per_step: 0.000428
 90%|█████████ | 901/1000 [00:03<00:00, 1070.96it/s]Step999:rank2, time: 0.040, per_step: 0.000391
100%|██████████| 1000/1000 [00:03<00:00, 316.96it/s]
 71%|███████   | 712/1000 [00:03<00:00, 775.46it/s]Step999:rank3, time: 0.038, per_step: 0.000380
100%|██████████| 1000/1000 [00:03<00:00, 316.06it/s]
Step799:rank6, time: 0.047, per_step: 0.000470
 87%|████████▋ | 874/1000 [00:03<00:00, 1009.17it/s]Step999:rank4, time: 0.039, per_step: 0.000386
100%|██████████| 1000/1000 [00:03<00:00, 313.32it/s]
Step899:rank7, time: 0.044, per_step: 0.000437
Step799:rank0, time: 0.048, per_step: 0.000477
Step899:rank6, time: 0.042, per_step: 0.000415
 92%|█████████▏| 923/1000 [00:03<00:00, 1095.94it/s]Step999:rank7, time: 0.039, per_step: 0.000388
100%|██████████| 1000/1000 [00:03<00:00, 309.43it/s]
Step899:rank0, time: 0.043, per_step: 0.000427
 94%|█████████▎| 937/1000 [00:03<00:00, 1098.30it/s]Step999:rank6, time: 0.038, per_step: 0.000379
100%|██████████| 1000/1000 [00:03<00:00, 306.75it/s]
Step999:rank0, time: 0.040, per_step: 0.000392
100%|██████████| 1000/1000 [00:03<00:00, 304.57it/s]
Worker 7 pid=50188
Successfully xmh

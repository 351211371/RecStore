perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f64c5bf4e50>==========
Worker 0 pid=20289
Worker 1 pid=20290
Worker 2 pid=20291
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank1, time: 0.070, per_step: 0.000696
 19%|█▊        | 186/1000 [00:00<00:00, 1859.47it/s]Step199:rank1, time: 0.050, per_step: 0.000493
Step299:rank1, time: 0.055, per_step: 0.000546
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
 37%|███▋      | 372/1000 [00:00<00:00, 1687.60it/s]  0%|          | 0/1000 [00:00<?, ?it/s]Step399:rank1, time: 0.067, per_step: 0.000665
Step99:rank2, time: 0.060, per_step: 0.000603
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
Step99:rank3, time: 0.105, per_step: 0.001051
 16%|█▌        | 157/1000 [00:00<00:00, 1379.21it/s] 12%|█▏        | 118/1000 [00:00<00:00, 1178.04it/s]  0%|          | 0/1000 [00:00<?, ?it/s]Step499:rank1, time: 0.118, per_step: 0.001169
Step199:rank2, time: 0.099, per_step: 0.000976
Step99:rank0, time: 0.076, per_step: 0.000757
 54%|█████▍    | 542/1000 [00:00<00:00, 1406.33it/s]Step199:rank3, time: 0.066, per_step: 0.000649
Step599:rank1, time: 0.043, per_step: 0.000430
Step199:rank0, time: 0.037, per_step: 0.000363
 30%|██▉       | 298/1000 [00:00<00:00, 1541.56it/s]Step299:rank3, time: 0.053, per_step: 0.000525
 30%|██▉       | 295/1000 [00:00<00:00, 1291.35it/s] 29%|██▉       | 288/1000 [00:00<00:00, 2875.81it/s]Step299:rank2, time: 0.078, per_step: 0.000768
Step299:rank0, time: 0.031, per_step: 0.000310
Step699:rank1, time: 0.045, per_step: 0.000442
Step399:rank2, time: 0.030, per_step: 0.000300
Step399:rank0, time: 0.029, per_step: 0.000285
Step799:rank1, time: 0.028, per_step: 0.000282
 81%|████████  | 806/1000 [00:00<00:00, 1824.72it/s]Step399:rank3, time: 0.041, per_step: 0.000401
Step499:rank2, time: 0.026, per_step: 0.000260
Step499:rank0, time: 0.028, per_step: 0.000273
Step899:rank1, time: 0.027, per_step: 0.000269
Step499:rank3, time: 0.028, per_step: 0.000273
Step599:rank2, time: 0.026, per_step: 0.000261
Step599:rank0, time: 0.028, per_step: 0.000274
Step999:rank1, time: 0.027, per_step: 0.000266
100%|██████████| 1000/1000 [00:00<00:00, 1934.15it/s]
Step599:rank3, time: 0.028, per_step: 0.000278
 61%|██████    | 610/1000 [00:00<00:00, 2260.03it/s] 65%|██████▌   | 652/1000 [00:00<00:00, 2263.21it/s] 64%|██████▍   | 641/1000 [00:00<00:00, 3257.74it/s]Step699:rank2, time: 0.028, per_step: 0.000281
Step699:rank0, time: 0.028, per_step: 0.000282
Step699:rank3, time: 0.028, per_step: 0.000276
Step799:rank0, time: 0.028, per_step: 0.000275
Step799:rank2, time: 0.032, per_step: 0.000317
Step799:rank3, time: 0.028, per_step: 0.000273
Step899:rank0, time: 0.028, per_step: 0.000276
Step899:rank2, time: 0.028, per_step: 0.000272
Step899:rank3, time: 0.028, per_step: 0.000277
 97%|█████████▋| 969/1000 [00:00<00:00, 2782.31it/s]100%|█████████▉| 998/1000 [00:00<00:00, 2715.87it/s] 98%|█████████▊| 982/1000 [00:00<00:00, 3326.62it/s]Step999:rank2, time: 0.028, per_step: 0.000275
100%|██████████| 1000/1000 [00:00<00:00, 2341.58it/s]
Step999:rank0, time: 0.034, per_step: 0.000332
100%|██████████| 1000/1000 [00:00<00:00, 3266.10it/s]
Step999:rank3, time: 0.029, per_step: 0.000291
100%|██████████| 1000/1000 [00:00<00:00, 2435.22it/s]
Worker 3 pid=20292
Successfully xmh

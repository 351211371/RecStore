perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f383e8ebe50>==========
Worker 0 pid=53324
Worker 1 pid=53325
Worker 2 pid=53326
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<30:22,  1.82s/it]  0%|          | 1/1000 [00:01<30:22,  1.82s/it]  0%|          | 1/1000 [00:01<30:19,  1.82s/it]  0%|          | 1/1000 [00:01<30:51,  1.85s/it]  3%|▎         | 29/1000 [00:01<00:46, 20.82it/s]  3%|▎         | 30/1000 [00:01<00:45, 21.53it/s]  3%|▎         | 30/1000 [00:01<00:44, 21.57it/s]  3%|▎         | 29/1000 [00:01<00:47, 20.52it/s]  6%|▋         | 64/1000 [00:02<00:18, 51.69it/s]  7%|▋         | 66/1000 [00:02<00:17, 53.26it/s]  7%|▋         | 66/1000 [00:02<00:17, 53.35it/s]  6%|▋         | 65/1000 [00:02<00:18, 51.90it/s]Step99:rank3, time: 2.114, per_step: 0.021143
Step99:rank0, time: 2.111, per_step: 0.021110
Step99:rank2, time: 2.122, per_step: 0.021221
 11%|█         | 106/1000 [00:02<00:09, 95.09it/s] 11%|█         | 110/1000 [00:02<00:09, 98.87it/s] 11%|█         | 110/1000 [00:02<00:08, 99.02it/s]Step99:rank1, time: 2.149, per_step: 0.021486
 11%|█         | 108/1000 [00:02<00:09, 95.85it/s] 16%|█▌        | 157/1000 [00:02<00:05, 154.94it/s] 16%|█▋        | 165/1000 [00:02<00:05, 163.68it/s] 16%|█▌        | 155/1000 [00:02<00:05, 149.41it/s] 16%|█▌        | 162/1000 [00:02<00:05, 158.87it/s]Step199:rank3, time: 0.176, per_step: 0.001739
Step199:rank2, time: 0.183, per_step: 0.001808
Step199:rank0, time: 0.196, per_step: 0.001941
Step199:rank1, time: 0.177, per_step: 0.001755
 22%|██▏       | 223/1000 [00:02<00:03, 240.75it/s] 24%|██▎       | 236/1000 [00:02<00:02, 256.88it/s] 22%|██▏       | 219/1000 [00:02<00:03, 232.93it/s] 23%|██▎       | 232/1000 [00:02<00:03, 249.93it/s]Step299:rank3, time: 0.116, per_step: 0.001149
Step299:rank2, time: 0.122, per_step: 0.001204
Step299:rank0, time: 0.123, per_step: 0.001221
 31%|███       | 311/1000 [00:02<00:01, 365.78it/s] 33%|███▎      | 334/1000 [00:02<00:01, 398.59it/s] 30%|███       | 304/1000 [00:02<00:01, 353.78it/s]Step299:rank1, time: 0.117, per_step: 0.001159
 33%|███▎      | 328/1000 [00:02<00:01, 387.61it/s]Step399:rank3, time: 0.082, per_step: 0.000810
Step399:rank2, time: 0.087, per_step: 0.000857
Step399:rank0, time: 0.087, per_step: 0.000859
Step399:rank1, time: 0.082, per_step: 0.000812
 48%|████▊     | 478/1000 [00:02<00:00, 625.93it/s] 44%|████▎     | 435/1000 [00:02<00:01, 556.22it/s] 42%|████▎     | 425/1000 [00:02<00:01, 540.22it/s]Step499:rank3, time: 0.062, per_step: 0.000609
 47%|████▋     | 469/1000 [00:02<00:00, 609.09it/s]Step499:rank2, time: 0.066, per_step: 0.000654
Step499:rank1, time: 0.062, per_step: 0.000613
Step599:rank3, time: 0.050, per_step: 0.000491
Step499:rank0, time: 0.077, per_step: 0.000759
Step599:rank2, time: 0.054, per_step: 0.000539
Step599:rank1, time: 0.050, per_step: 0.000492
 69%|██████▉   | 689/1000 [00:02<00:00, 978.71it/s] 61%|██████    | 609/1000 [00:02<00:00, 836.87it/s] 57%|█████▋    | 570/1000 [00:02<00:00, 756.18it/s]Step699:rank3, time: 0.043, per_step: 0.000423
Step599:rank0, time: 0.056, per_step: 0.000556
 68%|██████▊   | 677/1000 [00:02<00:00, 956.51it/s]Step699:rank1, time: 0.042, per_step: 0.000419
Step799:rank3, time: 0.038, per_step: 0.000379
Step699:rank2, time: 0.047, per_step: 0.000468
Step699:rank0, time: 0.043, per_step: 0.000430
Step899:rank3, time: 0.035, per_step: 0.000351
Step799:rank1, time: 0.037, per_step: 0.000366
Step799:rank2, time: 0.043, per_step: 0.000421
Step799:rank0, time: 0.039, per_step: 0.000382
 96%|█████████▋| 964/1000 [00:02<00:00, 1427.14it/s] 84%|████████▎ | 837/1000 [00:02<00:00, 1201.63it/s] 81%|████████  | 810/1000 [00:02<00:00, 1172.10it/s]Step999:rank3, time: 0.034, per_step: 0.000338
Step899:rank1, time: 0.034, per_step: 0.000339
100%|██████████| 1000/1000 [00:02<00:00, 364.65it/s]
Step899:rank2, time: 0.040, per_step: 0.000401
 96%|█████████▌| 959/1000 [00:02<00:00, 1426.42it/s]Step899:rank0, time: 0.036, per_step: 0.000354
Step999:rank1, time: 0.033, per_step: 0.000322
100%|██████████| 1000/1000 [00:02<00:00, 360.33it/s]
Step999:rank2, time: 0.039, per_step: 0.000385
100%|██████████| 1000/1000 [00:02<00:00, 357.78it/s]
Step999:rank0, time: 0.035, per_step: 0.000343
100%|██████████| 1000/1000 [00:02<00:00, 357.76it/s]
Worker 3 pid=53327
Successfully xmh

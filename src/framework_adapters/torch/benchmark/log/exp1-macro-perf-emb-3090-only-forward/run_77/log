perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f76bb813e50>==========
Worker 0 pid=55265
Worker 1 pid=55266
Worker 2 pid=55267
Worker 3 pid=55268
Worker 4 pid=55269
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<16:51,  1.01s/it]Step99:rank1, time: 1.091, per_step: 0.010911
 17%|█▋        | 172/1000 [00:01<00:03, 212.24it/s]Step199:rank1, time: 0.049, per_step: 0.000481
Step299:rank1, time: 0.043, per_step: 0.000429
Step399:rank1, time: 0.043, per_step: 0.000428
 40%|████      | 403/1000 [00:01<00:01, 526.85it/s]Step499:rank1, time: 0.047, per_step: 0.000464
Step599:rank1, time: 0.043, per_step: 0.000429
 63%|██████▎   | 626/1000 [00:01<00:00, 827.26it/s]Step699:rank1, time: 0.046, per_step: 0.000457
Step799:rank1, time: 0.043, per_step: 0.000427
 85%|████████▌ | 851/1000 [00:01<00:00, 1113.43it/s]Step899:rank1, time: 0.046, per_step: 0.000452
Step999:rank1, time: 0.043, per_step: 0.000425
100%|██████████| 1000/1000 [00:01<00:00, 675.76it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<02:25,  6.84it/s]  0%|          | 1/1000 [00:00<02:42,  6.14it/s]  0%|          | 1/1000 [00:00<02:42,  6.15it/s]  0%|          | 1/1000 [00:00<02:13,  7.46it/s]  0%|          | 1/1000 [00:00<02:11,  7.61it/s]Step99:rank3, time: 0.179, per_step: 0.001790
Step99:rank2, time: 0.185, per_step: 0.001849
Step99:rank0, time: 0.215, per_step: 0.002153
Step99:rank4, time: 0.199, per_step: 0.001992
Step99:rank5, time: 0.218, per_step: 0.002178
Step199:rank3, time: 0.037, per_step: 0.000366
Step199:rank2, time: 0.037, per_step: 0.000367
Step199:rank0, time: 0.038, per_step: 0.000375
Step199:rank4, time: 0.042, per_step: 0.000416
Step199:rank5, time: 0.043, per_step: 0.000425
 23%|██▎       | 232/1000 [00:00<00:00, 1143.75it/s] 25%|██▍       | 246/1000 [00:00<00:00, 1147.64it/s] 22%|██▏       | 219/1000 [00:00<00:00, 1022.88it/s] 25%|██▌       | 252/1000 [00:00<00:00, 1298.67it/s] 28%|██▊       | 276/1000 [00:00<00:00, 1435.91it/s]Step299:rank3, time: 0.032, per_step: 0.000320
Step299:rank2, time: 0.033, per_step: 0.000325
Step299:rank0, time: 0.034, per_step: 0.000334
Step299:rank4, time: 0.035, per_step: 0.000350
Step299:rank5, time: 0.033, per_step: 0.000331
Step399:rank3, time: 0.032, per_step: 0.000319
Step399:rank2, time: 0.033, per_step: 0.000322
Step399:rank0, time: 0.033, per_step: 0.000331
Step399:rank4, time: 0.033, per_step: 0.000325
Step399:rank5, time: 0.033, per_step: 0.000329
Step499:rank3, time: 0.032, per_step: 0.000319
Step499:rank2, time: 0.033, per_step: 0.000322
Step499:rank0, time: 0.034, per_step: 0.000332
Step499:rank4, time: 0.033, per_step: 0.000323
Step499:rank5, time: 0.033, per_step: 0.000328
 53%|█████▎    | 530/1000 [00:00<00:00, 1901.24it/s] 54%|█████▍    | 544/1000 [00:00<00:00, 1880.41it/s] 52%|█████▏    | 520/1000 [00:00<00:00, 1818.05it/s] 56%|█████▌    | 559/1000 [00:00<00:00, 2048.03it/s] 59%|█████▊    | 587/1000 [00:00<00:00, 2149.97it/s]Step599:rank3, time: 0.032, per_step: 0.000315
Step599:rank2, time: 0.033, per_step: 0.000326
Step599:rank0, time: 0.034, per_step: 0.000335
Step599:rank4, time: 0.033, per_step: 0.000328
Step599:rank5, time: 0.033, per_step: 0.000323
Step699:rank3, time: 0.031, per_step: 0.000309
Step699:rank2, time: 0.033, per_step: 0.000323
Step699:rank0, time: 0.033, per_step: 0.000331
Step699:rank4, time: 0.035, per_step: 0.000345
Step699:rank5, time: 0.032, per_step: 0.000322
Step799:rank3, time: 0.031, per_step: 0.000309
Step799:rank2, time: 0.032, per_step: 0.000321
Step799:rank0, time: 0.033, per_step: 0.000330
Step799:rank4, time: 0.033, per_step: 0.000323
Step799:rank5, time: 0.032, per_step: 0.000320
Step899:rank3, time: 0.031, per_step: 0.000309
 83%|████████▎ | 829/1000 [00:00<00:00, 2303.01it/s] 84%|████████▍ | 843/1000 [00:00<00:00, 2281.27it/s] 83%|████████▎ | 829/1000 [00:00<00:00, 2278.41it/s] 87%|████████▋ | 866/1000 [00:00<00:00, 2430.84it/s] 91%|█████████ | 907/1000 [00:00<00:00, 2547.17it/s]Step899:rank2, time: 0.033, per_step: 0.000324
Step899:rank0, time: 0.034, per_step: 0.000333
Step899:rank4, time: 0.033, per_step: 0.000324
Step899:rank5, time: 0.033, per_step: 0.000327
Step999:rank3, time: 0.032, per_step: 0.000315
100%|██████████| 1000/1000 [00:00<00:00, 2168.57it/s]
Step999:rank2, time: 0.034, per_step: 0.000333
100%|██████████| 1000/1000 [00:00<00:00, 2086.07it/s]
Step999:rank0, time: 0.035, per_step: 0.000350
100%|██████████| 1000/1000 [00:00<00:00, 1930.77it/s]
Step999:rank5, time: 0.035, per_step: 0.000348
100%|██████████| 1000/1000 [00:00<00:00, 1916.29it/s]
Step999:rank4, time: 0.037, per_step: 0.000371
100%|██████████| 1000/1000 [00:00<00:00, 1970.05it/s]
Worker 5 pid=55270
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7efec61a3e50>==========
Worker 0 pid=25019
Worker 1 pid=25020
Worker 2 pid=25021
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<30:27,  1.83s/it]  0%|          | 1/1000 [00:01<30:27,  1.83s/it]  0%|          | 1/1000 [00:01<30:29,  1.83s/it]  0%|          | 1/1000 [00:01<30:34,  1.84s/it]Step99:rank3, time: 1.932, per_step: 0.019317
Step99:rank2, time: 1.934, per_step: 0.019339
Step99:rank0, time: 1.935, per_step: 0.019352
 11%|█▏        | 113/1000 [00:01<00:10, 81.64it/s] 10%|█         | 102/1000 [00:01<00:12, 73.67it/s] 11%|█▏        | 114/1000 [00:01<00:10, 82.29it/s]Step99:rank1, time: 1.939, per_step: 0.019388
 11%|█▏        | 114/1000 [00:01<00:10, 82.06it/s]Step199:rank3, time: 0.030, per_step: 0.000298
Step199:rank2, time: 0.029, per_step: 0.000292
Step199:rank0, time: 0.030, per_step: 0.000300
Step199:rank1, time: 0.029, per_step: 0.000292
Step299:rank3, time: 0.030, per_step: 0.000297
Step299:rank2, time: 0.028, per_step: 0.000282
Step299:rank0, time: 0.030, per_step: 0.000298
Step299:rank1, time: 0.029, per_step: 0.000283
Step399:rank2, time: 0.033, per_step: 0.000323
Step399:rank0, time: 0.031, per_step: 0.000306
Step399:rank3, time: 0.035, per_step: 0.000351
Step399:rank1, time: 0.033, per_step: 0.000325
 43%|████▎     | 427/1000 [00:02<00:01, 368.45it/s] 43%|████▎     | 430/1000 [00:02<00:01, 374.31it/s] 45%|████▍     | 449/1000 [00:02<00:01, 388.43it/s] 45%|████▍     | 448/1000 [00:02<00:01, 386.49it/s]Step499:rank2, time: 0.028, per_step: 0.000281
Step499:rank0, time: 0.031, per_step: 0.000307
Step499:rank1, time: 0.029, per_step: 0.000283
Step499:rank3, time: 0.031, per_step: 0.000308
Step599:rank2, time: 0.028, per_step: 0.000279
Step599:rank1, time: 0.028, per_step: 0.000282
Step599:rank0, time: 0.029, per_step: 0.000292
Step599:rank3, time: 0.029, per_step: 0.000292
Step699:rank2, time: 0.028, per_step: 0.000280
Step699:rank1, time: 0.028, per_step: 0.000282
Step699:rank0, time: 0.029, per_step: 0.000285
Step699:rank3, time: 0.029, per_step: 0.000286
 77%|███████▋  | 766/1000 [00:02<00:00, 725.18it/s] 77%|███████▋  | 769/1000 [00:02<00:00, 730.39it/s]Step799:rank2, time: 0.028, per_step: 0.000279
 80%|████████  | 803/1000 [00:02<00:00, 760.28it/s] 80%|███████▉  | 799/1000 [00:02<00:00, 754.34it/s]Step799:rank1, time: 0.029, per_step: 0.000283
Step799:rank0, time: 0.029, per_step: 0.000290
Step799:rank3, time: 0.029, per_step: 0.000291
Step899:rank2, time: 0.028, per_step: 0.000280
Step899:rank1, time: 0.028, per_step: 0.000279
Step899:rank0, time: 0.028, per_step: 0.000282
Step899:rank3, time: 0.029, per_step: 0.000283
Step999:rank2, time: 0.028, per_step: 0.000277
100%|██████████| 1000/1000 [00:02<00:00, 457.27it/s]
Step999:rank1, time: 0.028, per_step: 0.000281
100%|██████████| 1000/1000 [00:02<00:00, 455.80it/s]
Step999:rank0, time: 0.029, per_step: 0.000286
100%|██████████| 1000/1000 [00:02<00:00, 455.32it/s]
Step999:rank3, time: 0.029, per_step: 0.000287
100%|██████████| 1000/1000 [00:02<00:00, 455.12it/s]
Worker 3 pid=25027
Successfully xmh

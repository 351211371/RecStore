perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f5350ea1e50>==========
Worker 0 pid=28409
Worker 1 pid=28410
Worker 2 pid=28411
Worker 3 pid=28412
Worker 4 pid=28419
Worker 5 pid=28420
Worker 6 pid=28421
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  1%|▏         | 14/1000 [00:00<00:07, 127.21it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  4%|▍         | 42/1000 [00:00<00:04, 213.46it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  1%|          | 8/1000 [00:00<00:12, 79.47it/s]  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank4, time: 0.235, per_step: 0.002346
  3%|▎         | 33/1000 [00:00<00:03, 320.61it/s] 10%|▉         | 96/1000 [00:00<00:00, 956.19it/s]Step99:rank5, time: 0.179, per_step: 0.001787
Step99:rank1, time: 0.299, per_step: 0.002990
  5%|▍         | 48/1000 [00:00<00:02, 450.39it/s] 14%|█▎        | 136/1000 [00:00<00:01, 537.10it/s] 10%|▉         | 99/1000 [00:00<00:00, 988.50it/s]Step99:rank0, time: 0.162, per_step: 0.001624
 18%|█▊        | 182/1000 [00:00<00:00, 1052.85it/s]  7%|▋         | 72/1000 [00:00<00:01, 670.34it/s]Step199:rank4, time: 0.061, per_step: 0.000602
Step199:rank5, time: 0.047, per_step: 0.000463
Step99:rank6, time: 0.231, per_step: 0.002306
Step99:rank2, time: 0.195, per_step: 0.001946
Step99:rank3, time: 0.194, per_step: 0.001945
  7%|▋         | 69/1000 [00:00<00:01, 646.76it/s]Step199:rank1, time: 0.059, per_step: 0.000582
Step99:rank7, time: 0.153, per_step: 0.001531
Step199:rank0, time: 0.058, per_step: 0.000575
 13%|█▎        | 128/1000 [00:00<00:01, 685.37it/s]Step299:rank5, time: 0.045, per_step: 0.000444
Step299:rank4, time: 0.056, per_step: 0.000558
 31%|███       | 307/1000 [00:00<00:00, 1633.42it/s]Step199:rank2, time: 0.048, per_step: 0.000476
Step299:rank1, time: 0.046, per_step: 0.000453
Step199:rank6, time: 0.055, per_step: 0.000543
Step199:rank7, time: 0.041, per_step: 0.000406
Step199:rank3, time: 0.059, per_step: 0.000589
 20%|██        | 200/1000 [00:00<00:00, 1062.58it/s] 34%|███▍      | 338/1000 [00:00<00:00, 1113.67it/s]Step299:rank0, time: 0.040, per_step: 0.000399
 30%|███       | 302/1000 [00:00<00:00, 1600.24it/s] 38%|███▊      | 384/1000 [00:00<00:00, 1493.34it/s] 27%|██▋       | 270/1000 [00:00<00:00, 1415.66it/s]Step399:rank4, time: 0.040, per_step: 0.000396
Step399:rank5, time: 0.045, per_step: 0.000444
Step299:rank2, time: 0.039, per_step: 0.000384
Step299:rank6, time: 0.039, per_step: 0.000385
Step399:rank1, time: 0.046, per_step: 0.000457
Step299:rank7, time: 0.039, per_step: 0.000384
 31%|███       | 308/1000 [00:00<00:00, 1643.24it/s]Step399:rank0, time: 0.040, per_step: 0.000397
Step499:rank4, time: 0.039, per_step: 0.000391
Step299:rank3, time: 0.059, per_step: 0.000584
Step499:rank5, time: 0.039, per_step: 0.000391
 38%|███▊      | 377/1000 [00:00<00:00, 1500.84it/s]Step399:rank2, time: 0.042, per_step: 0.000415
Step499:rank1, time: 0.040, per_step: 0.000393
Step399:rank6, time: 0.042, per_step: 0.000420
Step399:rank7, time: 0.039, per_step: 0.000387
 55%|█████▍    | 548/1000 [00:00<00:00, 1984.26it/s]Step499:rank0, time: 0.044, per_step: 0.000435
Step599:rank4, time: 0.039, per_step: 0.000390
Step599:rank5, time: 0.039, per_step: 0.000389
 38%|███▊      | 378/1000 [00:00<00:00, 1382.74it/s] 57%|█████▋    | 573/1000 [00:00<00:00, 1555.18it/s] 54%|█████▍    | 542/1000 [00:00<00:00, 1961.82it/s]Step499:rank2, time: 0.039, per_step: 0.000385
 64%|██████▎   | 637/1000 [00:00<00:00, 1901.82it/s]Step399:rank3, time: 0.053, per_step: 0.000528
Step599:rank1, time: 0.040, per_step: 0.000397
Step499:rank6, time: 0.039, per_step: 0.000386
 52%|█████▏    | 519/1000 [00:00<00:00, 1897.52it/s]Step499:rank7, time: 0.039, per_step: 0.000388
Step599:rank0, time: 0.041, per_step: 0.000403
Step699:rank4, time: 0.040, per_step: 0.000392
Step699:rank5, time: 0.039, per_step: 0.000386
 56%|█████▋    | 564/1000 [00:00<00:00, 2054.25it/s]Step599:rank2, time: 0.039, per_step: 0.000385
Step599:rank6, time: 0.039, per_step: 0.000385
Step699:rank1, time: 0.040, per_step: 0.000394
Step599:rank7, time: 0.039, per_step: 0.000389
Step499:rank3, time: 0.053, per_step: 0.000525
 63%|██████▎   | 633/1000 [00:00<00:00, 1916.27it/s]Step699:rank0, time: 0.040, per_step: 0.000399
Step799:rank4, time: 0.039, per_step: 0.000388
Step799:rank5, time: 0.039, per_step: 0.000386
 80%|████████  | 804/1000 [00:00<00:00, 2210.23it/s]Step699:rank2, time: 0.039, per_step: 0.000391
Step699:rank6, time: 0.040, per_step: 0.000400
Step799:rank1, time: 0.041, per_step: 0.000409
 56%|█████▋    | 564/1000 [00:00<00:00, 1566.60it/s]Step699:rank7, time: 0.046, per_step: 0.000460
 82%|████████▏ | 820/1000 [00:00<00:00, 1862.39it/s] 79%|███████▊  | 786/1000 [00:00<00:00, 2147.01it/s] 89%|████████▉ | 891/1000 [00:00<00:00, 2131.14it/s]Step799:rank0, time: 0.042, per_step: 0.000419
Step899:rank4, time: 0.039, per_step: 0.000391
 77%|███████▋  | 773/1000 [00:00<00:00, 2145.13it/s]Step899:rank5, time: 0.039, per_step: 0.000387
Step599:rank3, time: 0.055, per_step: 0.000547
Step799:rank2, time: 0.040, per_step: 0.000396
Step799:rank6, time: 0.040, per_step: 0.000392
Step899:rank1, time: 0.041, per_step: 0.000403
Step799:rank7, time: 0.040, per_step: 0.000392
 80%|████████  | 800/1000 [00:00<00:00, 2171.11it/s]Step999:rank4, time: 0.039, per_step: 0.000388
100%|██████████| 1000/1000 [00:00<00:00, 1838.45it/s]
Step899:rank0, time: 0.041, per_step: 0.000404
Step999:rank5, time: 0.039, per_step: 0.000389
100%|██████████| 1000/1000 [00:00<00:00, 2092.88it/s]
Step899:rank2, time: 0.041, per_step: 0.000402
 88%|████████▊ | 880/1000 [00:00<00:00, 2115.15it/s]Step899:rank6, time: 0.041, per_step: 0.000410
Step699:rank3, time: 0.055, per_step: 0.000549
Step999:rank1, time: 0.042, per_step: 0.000420
100%|██████████| 1000/1000 [00:00<00:00, 1458.09it/s]
Step899:rank7, time: 0.042, per_step: 0.000420
Step999:rank0, time: 0.043, per_step: 0.000429
100%|██████████| 1000/1000 [00:00<00:00, 2036.02it/s]
 74%|███████▍  | 744/1000 [00:00<00:00, 1648.50it/s]Step999:rank2, time: 0.042, per_step: 0.000416
100%|██████████| 1000/1000 [00:00<00:00, 1994.09it/s]
Step999:rank6, time: 0.042, per_step: 0.000416
100%|██████████| 1000/1000 [00:00<00:00, 1804.35it/s]
Step999:rank7, time: 0.042, per_step: 0.000414
100%|██████████| 1000/1000 [00:00<00:00, 2033.91it/s]
Step799:rank3, time: 0.057, per_step: 0.000566
Step899:rank3, time: 0.055, per_step: 0.000546
 92%|█████████▏| 923/1000 [00:00<00:00, 1695.94it/s]Step999:rank3, time: 0.057, per_step: 0.000561
100%|██████████| 1000/1000 [00:00<00:00, 1533.76it/s]
Worker 7 pid=28424
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f5c9b0aee50>==========
Worker 0 pid=6935
Worker 1 pid=6936
Worker 2 pid=6937
Worker 3 pid=6938
Worker 4 pid=6939
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank2, time: 0.079, per_step: 0.000788
 15%|█▌        | 151/1000 [00:00<00:00, 1428.84it/s]Step199:rank2, time: 0.070, per_step: 0.000696
Step299:rank2, time: 0.053, per_step: 0.000523
 35%|███▌      | 351/1000 [00:00<00:00, 1755.76it/s]Step399:rank2, time: 0.040, per_step: 0.000395
Step499:rank2, time: 0.038, per_step: 0.000380
Step599:rank2, time: 0.039, per_step: 0.000383
 61%|██████    | 610/1000 [00:00<00:00, 2129.54it/s]Step699:rank2, time: 0.039, per_step: 0.000384
Step799:rank2, time: 0.038, per_step: 0.000380
 87%|████████▋ | 870/1000 [00:00<00:00, 2311.74it/s]Step899:rank2, time: 0.039, per_step: 0.000383
Step999:rank2, time: 0.038, per_step: 0.000380
100%|██████████| 1000/1000 [00:00<00:00, 2190.46it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<01:48,  9.22it/s]  0%|          | 1/1000 [00:00<03:26,  4.83it/s]  0%|          | 1/1000 [00:00<02:35,  6.43it/s]  0%|          | 1/1000 [00:00<02:09,  7.71it/s]  0%|          | 1/1000 [00:00<01:43,  9.66it/s]  4%|▎         | 36/1000 [00:00<00:05, 181.06it/s]  4%|▍         | 43/1000 [00:00<00:04, 204.34it/s]  5%|▍         | 49/1000 [00:00<00:05, 188.89it/s]  3%|▎         | 26/1000 [00:00<00:07, 126.39it/s]  7%|▋         | 73/1000 [00:00<00:02, 420.73it/s]Step99:rank1, time: 0.234, per_step: 0.002340
Step99:rank0, time: 0.311, per_step: 0.003109
Step99:rank3, time: 0.400, per_step: 0.004005
Step99:rank4, time: 0.321, per_step: 0.003210
Step99:rank5, time: 0.297, per_step: 0.002966
 14%|█▍        | 144/1000 [00:00<00:01, 558.63it/s] 17%|█▋        | 172/1000 [00:00<00:01, 644.36it/s]Step199:rank0, time: 0.054, per_step: 0.000530
Step199:rank4, time: 0.051, per_step: 0.000502
 18%|█▊        | 176/1000 [00:00<00:01, 573.99it/s]Step199:rank5, time: 0.051, per_step: 0.000506
 20%|██        | 204/1000 [00:00<00:00, 807.85it/s]Step199:rank3, time: 0.062, per_step: 0.000613
Step199:rank1, time: 0.076, per_step: 0.000757
 21%|██        | 210/1000 [00:00<00:00, 849.13it/s]Step299:rank0, time: 0.038, per_step: 0.000378
Step299:rank4, time: 0.037, per_step: 0.000364
Step299:rank5, time: 0.036, per_step: 0.000361
Step299:rank3, time: 0.037, per_step: 0.000371
Step299:rank1, time: 0.048, per_step: 0.000476
 38%|███▊      | 384/1000 [00:00<00:00, 1247.67it/s]Step399:rank0, time: 0.038, per_step: 0.000377
Step399:rank4, time: 0.037, per_step: 0.000362
Step399:rank5, time: 0.036, per_step: 0.000356
Step399:rank3, time: 0.037, per_step: 0.000370
 44%|████▍     | 443/1000 [00:00<00:00, 1401.67it/s] 44%|████▍     | 443/1000 [00:00<00:00, 1280.60it/s] 48%|████▊     | 481/1000 [00:00<00:00, 1533.64it/s]Step399:rank1, time: 0.048, per_step: 0.000472
Step499:rank4, time: 0.037, per_step: 0.000361
Step499:rank0, time: 0.038, per_step: 0.000374
Step499:rank5, time: 0.036, per_step: 0.000360
 42%|████▏     | 419/1000 [00:00<00:00, 1335.66it/s]Step499:rank3, time: 0.038, per_step: 0.000372
Step599:rank4, time: 0.037, per_step: 0.000363
Step599:rank0, time: 0.038, per_step: 0.000379
Step599:rank5, time: 0.036, per_step: 0.000354
Step499:rank1, time: 0.048, per_step: 0.000476
Step599:rank3, time: 0.037, per_step: 0.000369
 65%|██████▍   | 647/1000 [00:00<00:00, 1729.50it/s]Step699:rank4, time: 0.036, per_step: 0.000360
Step699:rank5, time: 0.036, per_step: 0.000355
Step699:rank0, time: 0.038, per_step: 0.000375
 72%|███████▏  | 717/1000 [00:00<00:00, 1861.63it/s]Step699:rank3, time: 0.037, per_step: 0.000370
 71%|███████   | 711/1000 [00:00<00:00, 1733.75it/s]Step599:rank1, time: 0.048, per_step: 0.000472
 76%|███████▌  | 759/1000 [00:00<00:00, 1963.95it/s] 63%|██████▎   | 628/1000 [00:00<00:00, 1605.85it/s]Step799:rank4, time: 0.037, per_step: 0.000365
Step799:rank5, time: 0.036, per_step: 0.000361
Step799:rank0, time: 0.038, per_step: 0.000376
Step799:rank3, time: 0.038, per_step: 0.000372
Step699:rank1, time: 0.048, per_step: 0.000476
Step899:rank4, time: 0.036, per_step: 0.000360
Step899:rank5, time: 0.036, per_step: 0.000355
Step899:rank0, time: 0.038, per_step: 0.000375
 91%|█████████ | 911/1000 [00:00<00:00, 2030.91it/s]Step899:rank3, time: 0.037, per_step: 0.000368
 99%|█████████▉| 991/1000 [00:00<00:00, 2149.49it/s]Step999:rank4, time: 0.037, per_step: 0.000363
100%|██████████| 1000/1000 [00:00<00:00, 1515.49it/s]
Step999:rank5, time: 0.036, per_step: 0.000358
100%|██████████| 1000/1000 [00:00<00:00, 1587.12it/s]
Step799:rank1, time: 0.049, per_step: 0.000483
 98%|█████████▊| 976/1000 [00:00<00:00, 2022.87it/s]Step999:rank0, time: 0.040, per_step: 0.000399
100%|██████████| 1000/1000 [00:00<00:00, 1500.47it/s]
Step999:rank3, time: 0.039, per_step: 0.000389
100%|██████████| 1000/1000 [00:00<00:00, 1368.91it/s]
 83%|████████▎ | 832/1000 [00:00<00:00, 1752.24it/s]Step899:rank1, time: 0.051, per_step: 0.000505
Step999:rank1, time: 0.050, per_step: 0.000499
100%|██████████| 1000/1000 [00:00<00:00, 1450.56it/s]
Worker 5 pid=6940
Successfully xmh

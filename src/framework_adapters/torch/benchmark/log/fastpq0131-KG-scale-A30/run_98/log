WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 21:55:37.068234 411718 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_108', no_save_emb=True, max_step=500, batch_size=2400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [411718 sampler.py:454] Start PreSampling
WARNING [411718 sampler.py:532] Before construct renumbering_dict
WARNING [411718 sampler.py:555] PreSampling done
W20240207 21:55:39.027179 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 21:55:39.027309 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 21:55:39.027335 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 21:55:39.027352 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 21:55:39.027374 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 21:55:39.027387 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 21:55:39.027405 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 21:55:39.027422 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 21:55:39.027436 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 21:55:39.027454 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 21:55:39.027472 411718 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 21:55:39.027487 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 21:55:39.027504 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 21:55:39.027592 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 21:55:39.027614 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 21:55:39.027630 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 21:55:39.027658 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 21:55:39.027673 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 21:55:39.027688 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 21:55:39.027706 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 21:55:39.027726 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 21:55:39.027740 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 21:55:39.027755 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 21:55:39.027774 411718 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 21:55:39.027787 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 21:55:39.027799 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 21:55:39.027833 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240207 21:55:39.027853 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240207 21:55:39.027870 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240207 21:55:39.027889 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240207 21:55:39.027905 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240207 21:55:39.027926 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240207 21:55:39.027941 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240207 21:55:39.027959 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240207 21:55:39.027973 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240207 21:55:39.027994 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240207 21:55:39.028016 411718 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240207 21:55:39.028029 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240207 21:55:39.028041 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240207 21:55:39.028074 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240207 21:55:39.028091 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240207 21:55:39.028105 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240207 21:55:39.028120 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240207 21:55:39.028136 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240207 21:55:39.028153 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240207 21:55:39.028168 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240207 21:55:39.028184 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240207 21:55:39.028198 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240207 21:55:39.028211 411718 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240207 21:55:39.028225 411718 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240207 21:55:39.028237 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240207 21:55:39.028249 411718 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240207 21:55:39.153287 411718 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240207 21:55:39.180900 411718 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 939, 1333, 1439,  ..., 1521, 5353, 6000]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.134 seconds
[Rank1] pid = 411928
[Rank2] pid = 411993
INFO [411718 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [411928 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [412057 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [411718 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [411928 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [411993 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
W20240207 21:55:42.271116 412058 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
INFO [411993 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240207 21:55:42.271936 412058 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x100014876000 7.629 MB
W20240207 21:55:42.272014 411929 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240207 21:55:42.272127 412058 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100015019000 7.629 MB
W20240207 21:55:42.272220 412058 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000157bc000 1.49 GB
W20240207 21:55:42.272310 412058 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100074d9f000 1.49 GB
W20240207 21:55:42.272397 412058 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 21:55:42.272578 411929 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000d4384000 7.629 MB
W20240207 21:55:42.272732 411929 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000d4b27000 7.629 MB
W20240207 21:55:42.272781 411929 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000d52ca000 1.49 GB
W20240207 21:55:42.272820 411929 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001348ad000 1.49 GB
W20240207 21:55:42.272850 411929 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
INFO [412057 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240207 21:55:42.279394 411929 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240207 21:55:42.279436 412058 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 21:55:42.280339 412059 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240207 21:55:42.280514 411994 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240207 21:55:42.286355 412059 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100193e9c000 7.629 MB
W20240207 21:55:42.286487 412059 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x10019463f000 7.629 MB
W20240207 21:55:42.286540 412059 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x100194de2000 1.49 GB
W20240207 21:55:42.286574 412059 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1001f43c5000 1.49 GB
W20240207 21:55:42.286603 412059 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 21:55:42.286612 411994 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1002539a8000 7.629 MB
W20240207 21:55:42.286864 411994 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10025414b000 7.629 MB
W20240207 21:55:42.286978 411994 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1002548ee000 1.49 GB
W20240207 21:55:42.287053 411994 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1002b3ed1000 1.49 GB
W20240207 21:55:42.287139 411994 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 21:55:42.295617 412059 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 21:55:42.295866 411994 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [411928 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [412057 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [411993 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 412057
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [411718 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 21:55:43.283658 412058 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240207 21:55:43.283741 411929 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 21:55:43.283804 411994 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 21:55:43.284024 412059 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240207 21:55:43.285055 412058 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240207 21:55:43.285197 412058 grad_base.h:184] Init GradProcessingBase done
I20240207 21:55:43.287247 412058 grad_async_v1.h:203] Use main thread to update emb.
W20240207 21:55:43.287276 412058 kg_controller.h:75] after init GradAsyncProcessing
I20240207 21:55:43.287281 412058 kg_controller.h:84] Construct KGCacheController done
E20240207 21:55:43.638562 412059 recstore.cc:66] init folly done
E20240207 21:55:43.638569 411929 recstore.cc:66] init folly done
E20240207 21:55:43.638684 411994 recstore.cc:66] init folly done
E20240207 21:55:43.638684 412058 recstore.cc:66] init folly done
I20240207 21:55:43.639189 412058 grad_base.h:60] GraphEnv RegTensorsPerProcess
I20240207 21:55:44.304584 412058 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240207 21:55:44.321259 412059 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240207 21:55:44.353089 411994 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240207 21:55:44.355413 411929 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240207 21:55:46.458225 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=1, pq.top=1
E20240207 21:55:46.498031 412058 grad_async_v1.h:533] Stalled in ProcessBackward: rank=3, step_no=1, sample_step_cpp_seen_[rank]=0
W20240207 21:55:47.458005 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=25, pq.top=25
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 767.160 us                | 13.093 ms                 |
| Forward                   | 3.190 ms                  | 654.798 ms                |
| Backward                  | 6.117 ms                  | 203.901 ms                |
| Optimize                  | 1.411 ms                  | 74.230 ms                 |
| BarrierTimeBeforeRank0    | 34.974 us                 | 219.295 ms                |
| AfterBackward             | 9.945 ms                  | 949.041 ms                |
| BlockToStepN              | 15.605 ms                 | 25.040 ms                 |
| OneStep                   | 40.956 ms                 | 2.127 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 21:55:48.458009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=47, pq.top=47
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.733 ms                  | 164.254 ms                |
| ProcessBack:UpdateCache   | 1.203 ms                  | 181.543 ms                |
| ProcessBack:UpsertPq      | 6.950 ms                  | 12.152 ms                 |
| ProcessOneStep            | 10.182 ms                 | 948.754 ms                |
| BlockToStepN              | 18.651 ms                 | 27.944 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:55:49.458009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=65, pq.top=65
W20240207 21:55:50.462000 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=81, pq.top=81
W20240207 21:55:51.461009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=96, pq.top=96
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 7.382, sample: 0.188, forward: 1.122, backward: 0.799, update: 0.214
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.380, sample: 0.195, forward: 0.952, backward: 0.822, update: 0.191
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 7.414, sample: 0.208, forward: 1.096, backward: 0.859, update: 0.193
train_sampler.Prefill()
-------Step 0-------
tensor([12479,  4104,  8442,  6162,  9092,  6188,   679,  5043, 11158,  7993]) tensor([ 1439,  7220,  8511,  4030,  6781, 11756, 12331, 12312,  6491,  6573])
-------Step 1-------
tensor([12479,  4104,  8442,  6162,  9092,  6188,   679,  5043, 11158,  7993]) tensor([ 2277,   419,  4642,  3646, 11850,    21, 14343,  4629,  6254,  6915])
-------Step 2-------
tensor([   13, 14798,  9100,  9775,  4585,  5177, 13733,  7291,  3995,  1335]) tensor([14800,  5607,  9167, 10291,  3954, 10660,  6699,   376, 10802, 13946])
-------Step 3-------
tensor([   13, 14798,  9100,  9775,  4585,  5177, 13733,  7291,  3995,  1335]) tensor([ 7471, 12930,  6808,  8106,  4440,  7049, 12824,  7914,  5795, 14059])
-------Step 4-------
tensor([10976,  8435, 14531, 10868,  4089,  5797,   996,  4359,  4195, 14950]) tensor([  386,  9054, 14663,   975, 12268,  8933,  1452, 10594,  6738,  7195])
-------Step 5-------
tensor([10976,  8435, 14531, 10868,  4089,  5797,   996,  4359,  4195, 14950]) tensor([ 3540, 10129,  3259,  8858,  5654, 10745,  3208,   889, 12209,  1480])
-------Step 6-------
tensor([ 5667, 11983, 13783, 12124,  3620, 10157,  8868,  8646,  4442, 11017]) tensor([14172, 13166, 11906,   543, 10851,  8270,  8936,  1889,  5906,  8277])
-------Step 7-------
tensor([ 5667, 11983, 13783, 12124,  3620, 10157,  8868,  8646,  4442, 11017]) tensor([ 5066,  4609, 10520, 13740,  6467,  8651,  7864, 11778, 14188,  5198])
-------Step 8-------
tensor([  331, 12519,  4623,  7007,  1997,  7682,  2952,  2340,   187,  5768]) tensor([ 8242, 13220, 10786, 12663,  6515,  7500,  6747,  1442,  2201,  9379])
-------Step 9-------
tensor([  331, 12519,  4623,  7007,  1997,  7682,  2952,  2340,   187,  5768]) tensor([ 1959, 14020,  3678, 12356,  2183,   258,  3245,  1067, 14903, 14250])
before start barrier
start train
[proc 0] 100 steps, total: 7.430, sample: 0.246, forward: 1.003, backward: 0.792, update: 0.242
W20240207 21:55:52.464452 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=111, pq.top=111
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 924.092 us                | 17.432 ms                 |
| Forward                   | 3.500 ms                  | 6.148 ms                  |
| Backward                  | 6.157 ms                  | 7.144 ms                  |
| Optimize                  | 1.404 ms                  | 3.370 ms                  |
| BarrierTimeBeforeRank0    | 20.100 us                 | 8.286 ms                  |
| AfterBackward             | 11.290 ms                 | 240.714 ms                |
| BlockToStepN              | 29.855 ms                 | 49.691 ms                 |
| OneStep                   | 57.850 ms                 | 252.561 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:55:53.468510 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=125, pq.top=125
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.741 ms                  | 2.798 ms                  |
| ProcessBack:UpdateCache   | 1.208 ms                  | 1.544 ms                  |
| ProcessBack:UpsertPq      | 7.613 ms                  | 11.762 ms                 |
| ProcessOneStep            | 11.263 ms                 | 240.664 ms                |
| BlockToStepN              | 31.342 ms                 | 50.271 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:55:54.489234 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=138, pq.top=138
W20240207 21:55:55.498123 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=149, pq.top=149
W20240207 21:55:56.498009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=158, pq.top=158
W20240207 21:55:57.498006 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=169, pq.top=169
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 963.998 us                | 17.432 ms                 |
| Forward                   | 3.539 ms                  | 5.110 ms                  |
| Backward                  | 6.166 ms                  | 7.144 ms                  |
| Optimize                  | 1.384 ms                  | 3.354 ms                  |
| BarrierTimeBeforeRank0    | 20.906 us                 | 12.117 ms                 |
| AfterBackward             | 11.047 ms                 | 23.438 ms                 |
| BlockToStepN              | 38.876 ms                 | 77.867 ms                 |
| OneStep                   | 66.272 ms                 | 117.070 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:55:58.498009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=180, pq.top=180
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.741 ms                  | 2.798 ms                  |
| ProcessBack:UpdateCache   | 1.197 ms                  | 1.533 ms                  |
| ProcessBack:UpsertPq      | 7.645 ms                  | 11.762 ms                 |
| ProcessOneStep            | 11.051 ms                 | 23.409 ms                 |
| BlockToStepN              | 39.143 ms                 | 77.815 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:55:59.498011 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=192, pq.top=192
[proc 3] 200 steps, total: 8.475, sample: 0.217, forward: 0.320, backward: 0.612, update: 0.154
[proc 0] 200 steps, total: 8.475, sample: 0.282, forward: 0.346, backward: 0.611, update: 0.150
[proc 2] 200 steps, total: 8.475, sample: 0.189, forward: 0.251, backward: 0.562, update: 0.151
[proc 1] 200 steps, total: 8.475, sample: 0.230, forward: 0.330, backward: 0.448, update: 0.151
W20240207 21:56:00.508567 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=204, pq.top=204
W20240207 21:56:01.512620 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=215, pq.top=215
W20240207 21:56:02.512009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=225, pq.top=225
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 979.879 us                | 17.432 ms                 |
| Forward                   | 3.497 ms                  | 5.110 ms                  |
| Backward                  | 6.165 ms                  | 7.144 ms                  |
| Optimize                  | 1.367 ms                  | 3.354 ms                  |
| BarrierTimeBeforeRank0    | 21.628 us                 | 12.117 ms                 |
| AfterBackward             | 10.839 ms                 | 23.438 ms                 |
| BlockToStepN              | 45.154 ms                 | 78.212 ms                 |
| OneStep                   | 71.463 ms                 | 117.070 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:03.512005 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=236, pq.top=236
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.742 ms                  | 2.721 ms                  |
| ProcessBack:UpdateCache   | 1.188 ms                  | 1.519 ms                  |
| ProcessBack:UpsertPq      | 7.511 ms                  | 12.152 ms                 |
| ProcessOneStep            | 10.794 ms                 | 23.409 ms                 |
| BlockToStepN              | 45.636 ms                 | 78.159 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:04.519492 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=247, pq.top=247
W20240207 21:56:05.519011 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=257, pq.top=257
W20240207 21:56:06.519006 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=268, pq.top=268
W20240207 21:56:07.519009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=278, pq.top=278
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 995.361 us                | 16.813 ms                 |
| Forward                   | 3.500 ms                  | 4.981 ms                  |
| Backward                  | 6.175 ms                  | 7.124 ms                  |
| Optimize                  | 1.358 ms                  | 3.323 ms                  |
| BarrierTimeBeforeRank0    | 21.713 us                 | 11.498 ms                 |
| AfterBackward             | 10.803 ms                 | 19.947 ms                 |
| BlockToStepN              | 51.282 ms                 | 83.364 ms                 |
| OneStep                   | 79.890 ms                 | 117.070 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:08.531394 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=288, pq.top=288
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.741 ms                  | 2.721 ms                  |
| ProcessBack:UpdateCache   | 1.186 ms                  | 1.511 ms                  |
| ProcessBack:UpsertPq      | 7.512 ms                  | 12.942 ms                 |
| ProcessOneStep            | 10.785 ms                 | 19.905 ms                 |
| BlockToStepN              | 52.278 ms                 | 83.284 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:09.531006 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=297, pq.top=297
[proc 0] 300 steps, total: 9.661, sample: 0.296, forward: 0.343, backward: 0.612, update: 0.143
[proc 2] 300 steps, total: 9.661, sample: 0.185, forward: 0.251, backward: 0.566, update: 0.148
[proc 3] 300 steps, total: 9.661, sample: 0.228, forward: 0.309, backward: 0.608, update: 0.141
[proc 1] 300 steps, total: 9.661, sample: 0.209, forward: 0.326, backward: 0.591, update: 0.146
W20240207 21:56:10.531009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=307, pq.top=307
W20240207 21:56:11.531009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=317, pq.top=317
W20240207 21:56:12.531006 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=327, pq.top=327
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.018 ms                  | 17.060 ms                 |
| Forward                   | 3.497 ms                  | 4.981 ms                  |
| Backward                  | 6.179 ms                  | 7.124 ms                  |
| Optimize                  | 1.353 ms                  | 3.323 ms                  |
| BarrierTimeBeforeRank0    | 21.628 us                 | 12.117 ms                 |
| AfterBackward             | 10.803 ms                 | 19.947 ms                 |
| BlockToStepN              | 57.175 ms                 | 91.054 ms                 |
| OneStep                   | 85.615 ms                 | 126.738 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:13.544711 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=337, pq.top=337
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.740 ms                  | 2.703 ms                  |
| ProcessBack:UpdateCache   | 1.180 ms                  | 1.505 ms                  |
| ProcessBack:UpsertPq      | 7.509 ms                  | 12.942 ms                 |
| ProcessOneStep            | 10.783 ms                 | 19.905 ms                 |
| BlockToStepN              | 57.340 ms                 | 91.009 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:14.544006 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=346, pq.top=346
W20240207 21:56:15.566898 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=356, pq.top=356
W20240207 21:56:16.566007 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=365, pq.top=365
W20240207 21:56:17.588984 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=375, pq.top=375
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.034 ms                  | 16.813 ms                 |
| Forward                   | 3.508 ms                  | 4.906 ms                  |
| Backward                  | 6.177 ms                  | 7.124 ms                  |
| Optimize                  | 1.354 ms                  | 3.286 ms                  |
| BarrierTimeBeforeRank0    | 22.770 us                 | 11.684 ms                 |
| AfterBackward             | 10.841 ms                 | 16.465 ms                 |
| BlockToStepN              | 61.234 ms                 | 93.293 ms                 |
| OneStep                   | 89.386 ms                 | 133.396 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:18.617619 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=385, pq.top=385
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.741 ms                  | 2.721 ms                  |
| ProcessBack:UpdateCache   | 1.173 ms                  | 1.502 ms                  |
| ProcessBack:UpsertPq      | 7.558 ms                  | 12.684 ms                 |
| ProcessOneStep            | 10.819 ms                 | 16.427 ms                 |
| BlockToStepN              | 61.404 ms                 | 93.257 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:19.617007 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=394, pq.top=394
[proc 2] 400 steps, total: 10.454, sample: 0.183, forward: 0.250, backward: 0.562, update: 0.151
[proc 0] 400 steps, total: 10.454, sample: 0.287, forward: 0.340, backward: 0.612, update: 0.151
[proc 1] 400 steps, total: 10.454, sample: 0.230, forward: 0.328, backward: 0.610, update: 0.142
[proc 3] 400 steps, total: 10.454, sample: 0.202, forward: 0.313, backward: 0.610, update: 0.152
W20240207 21:56:20.617009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=403, pq.top=403
W20240207 21:56:21.617007 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=412, pq.top=412
W20240207 21:56:22.637152 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=422, pq.top=422
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.044 ms                  | 17.020 ms                 |
| Forward                   | 3.523 ms                  | 4.906 ms                  |
| Backward                  | 6.176 ms                  | 7.124 ms                  |
| Optimize                  | 1.348 ms                  | 3.286 ms                  |
| BarrierTimeBeforeRank0    | 23.308 us                 | 12.117 ms                 |
| AfterBackward             | 10.823 ms                 | 16.465 ms                 |
| BlockToStepN              | 63.219 ms                 | 97.905 ms                 |
| OneStep                   | 92.241 ms                 | 133.396 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:23.637009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=430, pq.top=430
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.741 ms                  | 2.721 ms                  |
| ProcessBack:UpdateCache   | 1.169 ms                  | 1.498 ms                  |
| ProcessBack:UpsertPq      | 7.572 ms                  | 12.853 ms                 |
| ProcessOneStep            | 10.816 ms                 | 16.427 ms                 |
| BlockToStepN              | 63.481 ms                 | 97.837 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:24.637007 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=439, pq.top=439
W20240207 21:56:25.637009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=448, pq.top=448
W20240207 21:56:26.637006 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=457, pq.top=457
W20240207 21:56:27.637010 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=465, pq.top=465
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.054 ms                  | 17.060 ms                 |
| Forward                   | 3.514 ms                  | 4.858 ms                  |
| Backward                  | 6.176 ms                  | 6.971 ms                  |
| Optimize                  | 1.344 ms                  | 3.280 ms                  |
| BarrierTimeBeforeRank0    | 23.061 us                 | 12.117 ms                 |
| AfterBackward             | 10.841 ms                 | 16.210 ms                 |
| BlockToStepN              | 65.465 ms                 | 101.618 ms                |
| OneStep                   | 93.613 ms                 | 140.279 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:28.637007 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=474, pq.top=474
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.740 ms                  | 2.803 ms                  |
| ProcessBack:UpdateCache   | 1.165 ms                  | 1.498 ms                  |
| ProcessBack:UpsertPq      | 7.572 ms                  | 12.853 ms                 |
| ProcessOneStep            | 10.819 ms                 | 16.177 ms                 |
| BlockToStepN              | 65.596 ms                 | 101.567 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:56:29.637012 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=482, pq.top=482
W20240207 21:56:30.637005 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=491, pq.top=491
W20240207 21:56:31.637009 412058 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=500, pq.top=500
[proc 0] 500 steps, total: 11.385, sample: 0.304, forward: 0.341, backward: 0.611, update: 0.133
Successfully xmh. training takes 47.40548300743103 seconds
before call kg_cache_controller.StopThreads()
[proc 1] 500 steps, total: 11.385, sample: 0.207, forward: 0.327, backward: 0.607, update: 0.138
W20240207 21:56:31.710098 412058 grad_async_v1.h:243] call StopThreads. PID = 411718
[proc 2] 500 steps, total: 11.385, sample: 0.187, forward: 0.257, backward: 0.544, update: 0.150
W20240207 21:56:31.710117 412058 grad_base.h:212] before processOneStepNegThread_.join();
[proc 3] 500 steps, total: 11.385, sample: 0.208, forward: 0.317, backward: 0.607, update: 0.157
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240207 21:56:31.718603 412058 grad_base.h:214] after processOneStepNegThread_.join();
W20240207 21:56:31.718628 412058 grad_async_v1.h:245] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240207 21:56:31.748292 412058 grad_async_v1.h:264] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fd35dfac110>

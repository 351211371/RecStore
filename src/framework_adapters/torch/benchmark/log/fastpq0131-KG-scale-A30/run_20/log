WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240201 00:22:12.885099 3298692 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_222', no_save_emb=True, max_step=500, batch_size=2400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [3298692 sampler.py:454] Start PreSampling
WARNING [3298692 sampler.py:532] Before construct renumbering_dict
WARNING [3298692 sampler.py:555] PreSampling done
W20240201 00:22:15.447320 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240201 00:22:15.447610 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240201 00:22:15.447728 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240201 00:22:15.447847 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240201 00:22:15.447957 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240201 00:22:15.448060 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240201 00:22:15.448166 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240201 00:22:15.448274 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240201 00:22:15.448379 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240201 00:22:15.448488 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240201 00:22:15.448601 3298692 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240201 00:22:15.448704 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240201 00:22:15.448807 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240201 00:22:15.448983 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240201 00:22:15.449097 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240201 00:22:15.449203 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240201 00:22:15.449326 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240201 00:22:15.449430 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240201 00:22:15.449538 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240201 00:22:15.449643 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240201 00:22:15.449744 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240201 00:22:15.449849 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240201 00:22:15.449949 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240201 00:22:15.450057 3298692 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240201 00:22:15.450157 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240201 00:22:15.450259 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240201 00:22:15.450383 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240201 00:22:15.450508 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240201 00:22:15.450613 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240201 00:22:15.450719 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240201 00:22:15.450825 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240201 00:22:15.450929 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240201 00:22:15.451035 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240201 00:22:15.451140 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240201 00:22:15.451242 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240201 00:22:15.451344 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240201 00:22:15.451445 3298692 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240201 00:22:15.451547 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240201 00:22:15.451648 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240201 00:22:15.451776 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240201 00:22:15.451889 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240201 00:22:15.451989 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240201 00:22:15.452091 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240201 00:22:15.452190 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240201 00:22:15.452289 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240201 00:22:15.452389 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240201 00:22:15.452481 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240201 00:22:15.452569 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240201 00:22:15.452659 3298692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240201 00:22:15.452746 3298692 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240201 00:22:15.452831 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240201 00:22:15.452925 3298692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240201 00:22:15.587003 3298692 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240201 00:22:15.614003 3298692 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 884, 1147, 1260,  ..., 1680, 6832, 7763]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.759 seconds
[Rank1] pid = 3298904
[Rank2] pid = 3298969
INFO [3298692 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3298904 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3298692 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3298969 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [3298904 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3298969 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240201 00:22:18.868712 3299034 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240201 00:22:18.869475 3299034 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x100014876000 7.629 MB
W20240201 00:22:18.869709 3299034 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100015019000 7.629 MB
W20240201 00:22:18.869818 3299034 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000157bc000 1.49 GB
W20240201 00:22:18.869889 3299034 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100074d9f000 1.49 GB
W20240201 00:22:18.869971 3299034 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240201 00:22:18.869904 3298905 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
INFO [3299033 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [3299033 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240201 00:22:18.875236 3299034 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240201 00:22:18.875450 3298905 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000d4386000 7.629 MB
W20240201 00:22:18.875717 3298905 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000d4b29000 7.629 MB
W20240201 00:22:18.875866 3298905 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000d52cc000 1.49 GB
W20240201 00:22:18.875963 3298905 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001348af000 1.49 GB
W20240201 00:22:18.875895 3298970 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240201 00:22:18.876055 3298905 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240201 00:22:18.877519 3299035 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240201 00:22:18.884945 3298905 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240201 00:22:18.885098 3299035 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100193e9a000 7.629 MB
W20240201 00:22:18.885334 3298970 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10019463d000 7.629 MB
W20240201 00:22:18.885417 3299035 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x100194de0000 7.629 MB
W20240201 00:22:18.885535 3299035 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x100195583000 1.49 GB
W20240201 00:22:18.885607 3299035 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1001f4b66000 1.49 GB
W20240201 00:22:18.885690 3299035 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240201 00:22:18.885727 3298970 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x100254149000 7.629 MB
W20240201 00:22:18.885882 3298970 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1002548ec000 1.49 GB
W20240201 00:22:18.885991 3298970 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1002b3ecf000 1.49 GB
W20240201 00:22:18.886086 3298970 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240201 00:22:18.901271 3299035 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240201 00:22:18.901460 3298970 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
[Rank3] pid = 3299033
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [3298692 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [3298904 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [3298969 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [3299033 DistTensor.py:59] The tensor name already exists in the kvstore
I20240201 00:22:19.954344 3299034 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240201 00:22:19.954396 3299035 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240201 00:22:19.954440 3298970 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240201 00:22:19.954488 3298905 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240201 00:22:19.955348 3299034 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240201 00:22:19.955467 3299034 grad_base.h:184] Init GradProcessingBase done
I20240201 00:22:19.957247 3299034 grad_async_v1.h:203] Use main thread to update emb.
W20240201 00:22:19.957274 3299034 kg_controller.h:75] after init GradAsyncProcessing
I20240201 00:22:19.957279 3299034 kg_controller.h:84] Construct KGCacheController done
E20240201 00:22:20.311831 3299034 recstore.cc:66] init folly done
E20240201 00:22:20.311913 3298970 recstore.cc:66] init folly done
E20240201 00:22:20.311969 3298905 recstore.cc:66] init folly done
E20240201 00:22:20.312008 3299035 recstore.cc:66] init folly done
I20240201 00:22:20.312641 3299034 grad_base.h:60] GraphEnv RegTensorsPerProcess
I20240201 00:22:21.007141 3299034 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240201 00:22:21.057788 3299035 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240201 00:22:21.060454 3298970 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240201 00:22:21.060557 3298905 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240201 00:22:23.300491 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240201 00:22:24.300010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=23, pq.top=23
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 717.852 us                | 18.857 ms                 |
| Forward                   | 3.577 ms                  | 883.769 ms                |
| Backward                  | 5.967 ms                  | 181.612 ms                |
| Optimize                  | 1.764 ms                  | 7.783 ms                  |
| BarrierTimeBeforeRank0    | 253.821 us                | 146.465 ms                |
| AfterBackward             | 8.979 ms                  | 1.023 s                   |
| BlockToStepN              | 65.558 us                 | 318.131 ms                |
| OneStep                   | 27.480 ms                 | 2.249 s                   |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:25.300007 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=31, pq.top=31
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.726 ms                  | 160.375 ms                |
| ProcessBack:UpdateCache   | 1.210 ms                  | 196.972 ms                |
| ProcessBack:UpsertPq      | 5.829 ms                  | 14.995 ms                 |
| ProcessOneStep            | 9.347 ms                  | 1.023 s                   |
| BlockToStepN              | 957.000 ns                | 318.059 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:26.300010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=42, pq.top=42
W20240201 00:22:27.300006 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=54, pq.top=54
W20240201 00:22:28.306834 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=65, pq.top=65
W20240201 00:22:29.306010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=75, pq.top=75
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 976.758 us                | 15.311 ms                 |
| Forward                   | 3.603 ms                  | 12.416 ms                 |
| Backward                  | 5.946 ms                  | 6.897 ms                  |
| Optimize                  | 1.599 ms                  | 5.517 ms                  |
| BarrierTimeBeforeRank0    | 26.773 us                 | 3.093 ms                  |
| AfterBackward             | 10.634 ms                 | 19.556 ms                 |
| BlockToStepN              | 63.878 ms                 | 202.349 ms                |
| OneStep                   | 88.603 ms                 | 339.282 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:30.306005 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=85, pq.top=85
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.718 ms                  | 4.518 ms                  |
| ProcessBack:UpdateCache   | 1.196 ms                  | 2.437 ms                  |
| ProcessBack:UpsertPq      | 7.544 ms                  | 14.931 ms                 |
| ProcessOneStep            | 10.645 ms                 | 19.515 ms                 |
| BlockToStepN              | 64.407 ms                 | 202.302 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:31.306010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=95, pq.top=95
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 10.811, sample: 0.209, forward: 1.272, backward: 0.804, update: 0.172
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 10.808, sample: 0.226, forward: 1.281, backward: 0.789, update: 0.180
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 10.808, sample: 0.192, forward: 1.067, backward: 0.795, update: 0.166
train_sampler.Prefill()
-------Step 0-------
tensor([ 9279,  1868,  9836,  7940,  9021,  5171,   704,  5304, 14123, 10113]) tensor([ 1260,  9938,  9911,  4400,  8284,  8838, 13547,  9163,  8331,  8350])
-------Step 1-------
tensor([ 9279,  1868,  9836,  7940,  9021,  5171,   704,  5304, 14123, 10113]) tensor([ 2494,   425,  5112,  4922, 13209,    83, 14009,  5985,  6344,  3290])
-------Step 2-------
tensor([   46,  5934,  9101, 11075,  6738,  6587, 12736,  7429,  4384,  1622]) tensor([14383,  5930,  8850, 11375,  4213, 10252,  6918,   383, 10304, 13719])
-------Step 3-------
tensor([   46,  5934,  9101, 11075,  6738,  6587, 12736,  7429,  4384,  1622]) tensor([ 9248, 13918,  7029,  7898,  4814,  7119,  5662,  7945,  7132, 13264])
-------Step 4-------
tensor([10460,  8233, 14043, 11662,  5428,  7524,  1087,  6041,  5382, 12696]) tensor([  384, 11230, 14565,  1109, 11362, 10962,  1801, 10331,  8070,  7235])
-------Step 5-------
tensor([10460,  8233, 14043, 11662,  5428,  7524,  1087,  6041,  5382, 12696]) tensor([ 4558, 11896,  4159, 10166,  6027, 10241,  4110,   900, 14121,  1595])
-------Step 6-------
tensor([ 5849,  8963, 13303, 11056,  3919, 12068,  8550, 10369,  6095,  9846]) tensor([13100, 11878, 13598,   487, 12987, 10077,  7111,  1964,  7577,  8098])
-------Step 7-------
tensor([ 5849,  8963, 13303, 11056,  3919, 12068,  8550, 10369,  6095,  9846]) tensor([ 6385,  6346, 10100, 13369,  6629,  8539,  7474, 13006, 13822,  7004])
-------Step 8-------
tensor([  368, 13528,  6238,  7046,  1153,  3028,  4411,  2967,   215,  7502]) tensor([ 8005,  4871, 12557, 14702,  7818,  9271,  6854,  1807,  2428,  9229])
-------Step 9-------
tensor([  368, 13528,  6238,  7046,  1153,  3028,  4411,  2967,   215,  7502]) tensor([ 1141, 13106,  3077, 13576,  2271,   288,  3417,  1120, 12282, 13868])
before start barrier
start train
[proc 0] 100 steps, total: 10.861, sample: 0.254, forward: 1.257, backward: 0.749, update: 0.190
W20240201 00:22:32.330650 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=105, pq.top=105
W20240201 00:22:33.330010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=114, pq.top=114
W20240201 00:22:34.334321 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=124, pq.top=124
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.031 ms                  | 15.311 ms                 |
| Forward                   | 3.666 ms                  | 12.416 ms                 |
| Backward                  | 5.934 ms                  | 6.897 ms                  |
| Optimize                  | 1.531 ms                  | 5.517 ms                  |
| BarrierTimeBeforeRank0    | 25.536 us                 | 10.447 ms                 |
| AfterBackward             | 10.756 ms                 | 19.556 ms                 |
| BlockToStepN              | 70.782 ms                 | 202.349 ms                |
| OneStep                   | 96.036 ms                 | 339.282 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.721 ms                  | 4.497 ms                  |
| ProcessBack:UpdateCache   | 1.177 ms                  | 2.305 ms                  |
| ProcessBack:UpsertPq      | 7.677 ms                  | 13.809 ms                 |
| ProcessOneStep            | 10.744 ms                 | 19.515 ms                 |
| BlockToStepN              | 71.212 ms                 | 202.302 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:35.334004 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=133, pq.top=133
W20240201 00:22:36.350885 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=142, pq.top=142
W20240201 00:22:37.350009 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=151, pq.top=151
W20240201 00:22:38.350005 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=160, pq.top=160
W20240201 00:22:39.371147 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=169, pq.top=169
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.061 ms                  | 15.725 ms                 |
| Forward                   | 3.613 ms                  | 6.991 ms                  |
| Backward                  | 5.933 ms                  | 7.315 ms                  |
| Optimize                  | 1.523 ms                  | 4.776 ms                  |
| BarrierTimeBeforeRank0    | 21.168 us                 | 12.868 ms                 |
| AfterBackward             | 10.961 ms                 | 19.247 ms                 |
| BlockToStepN              | 74.745 ms                 | 102.468 ms                |
| OneStep                   | 101.254 ms                | 241.101 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.724 ms                  | 3.743 ms                  |
| ProcessBack:UpdateCache   | 1.168 ms                  | 2.123 ms                  |
| ProcessBack:UpsertPq      | 7.827 ms                  | 13.795 ms                 |
| ProcessOneStep            | 10.946 ms                 | 19.221 ms                 |
| BlockToStepN              | 75.227 ms                 | 102.431 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:40.371007 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=177, pq.top=177
W20240201 00:22:41.371007 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=186, pq.top=186
W20240201 00:22:42.375473 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=195, pq.top=195
[proc 3] 200 steps, total: 11.198, sample: 0.217, forward: 0.318, backward: 0.578, update: 0.173
[proc 2] 200 steps, total: 11.198, sample: 0.218, forward: 0.306, backward: 0.573, update: 0.152
[proc 1] 200 steps, total: 11.198, sample: 0.217, forward: 0.329, backward: 0.565, update: 0.154
[proc 0] 200 steps, total: 11.198, sample: 0.297, forward: 0.364, backward: 0.588, update: 0.165
W20240201 00:22:43.375005 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=203, pq.top=203
W20240201 00:22:44.375010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=211, pq.top=211
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.101 ms                  | 15.725 ms                 |
| Forward                   | 3.602 ms                  | 6.991 ms                  |
| Backward                  | 5.938 ms                  | 7.315 ms                  |
| Optimize                  | 1.481 ms                  | 4.776 ms                  |
| BarrierTimeBeforeRank0    | 20.831 us                 | 12.868 ms                 |
| AfterBackward             | 11.082 ms                 | 19.247 ms                 |
| BlockToStepN              | 78.632 ms                 | 119.149 ms                |
| OneStep                   | 104.915 ms                | 241.101 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.725 ms                  | 3.743 ms                  |
| ProcessBack:UpdateCache   | 1.152 ms                  | 2.123 ms                  |
| ProcessBack:UpsertPq      | 7.922 ms                  | 13.795 ms                 |
| ProcessOneStep            | 11.063 ms                 | 19.221 ms                 |
| BlockToStepN              | 78.715 ms                 | 119.101 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:45.375010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=219, pq.top=219
W20240201 00:22:46.375006 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=227, pq.top=227
W20240201 00:22:47.375010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=235, pq.top=235
W20240201 00:22:48.408933 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=244, pq.top=244
W20240201 00:22:49.408010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=252, pq.top=252
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.133 ms                  | 15.396 ms                 |
| Forward                   | 3.565 ms                  | 5.723 ms                  |
| Backward                  | 5.943 ms                  | 8.322 ms                  |
| Optimize                  | 1.463 ms                  | 3.861 ms                  |
| BarrierTimeBeforeRank0    | 21.168 us                 | 12.276 ms                 |
| AfterBackward             | 11.124 ms                 | 17.067 ms                 |
| BlockToStepN              | 80.448 ms                 | 116.616 ms                |
| OneStep                   | 107.782 ms                | 143.055 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.727 ms                  | 3.710 ms                  |
| ProcessBack:UpdateCache   | 1.150 ms                  | 1.982 ms                  |
| ProcessBack:UpsertPq      | 7.982 ms                  | 11.929 ms                 |
| ProcessOneStep            | 11.110 ms                 | 17.019 ms                 |
| BlockToStepN              | 80.415 ms                 | 116.586 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:50.408006 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=260, pq.top=260
W20240201 00:22:51.408010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=268, pq.top=268
W20240201 00:22:52.434015 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=276, pq.top=276
W20240201 00:22:53.438957 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=284, pq.top=284
W20240201 00:22:54.438007 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=291, pq.top=291
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.170 ms                  | 17.149 ms                 |
| Forward                   | 3.581 ms                  | 5.723 ms                  |
| Backward                  | 5.945 ms                  | 8.899 ms                  |
| Optimize                  | 1.500 ms                  | 3.861 ms                  |
| BarrierTimeBeforeRank0    | 21.662 us                 | 12.276 ms                 |
| AfterBackward             | 11.169 ms                 | 17.067 ms                 |
| BlockToStepN              | 82.161 ms                 | 119.149 ms                |
| OneStep                   | 111.240 ms                | 152.996 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.730 ms                  | 3.584 ms                  |
| ProcessBack:UpdateCache   | 1.133 ms                  | 1.982 ms                  |
| ProcessBack:UpsertPq      | 8.035 ms                  | 11.566 ms                 |
| ProcessOneStep            | 11.156 ms                 | 17.019 ms                 |
| BlockToStepN              | 82.812 ms                 | 119.101 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:22:55.438009 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=299, pq.top=299
[proc 3] 300 steps, total: 12.596, sample: 0.241, forward: 0.316, backward: 0.588, update: 0.168
[proc 2] 300 steps, total: 12.596, sample: 0.220, forward: 0.319, backward: 0.586, update: 0.168
[proc 0] 300 steps, total: 12.596, sample: 0.320, forward: 0.351, backward: 0.611, update: 0.171
[proc 1] 300 steps, total: 12.596, sample: 0.193, forward: 0.329, backward: 0.585, update: 0.150
W20240201 00:22:56.438010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=306, pq.top=306
W20240201 00:22:57.438007 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=314, pq.top=314
W20240201 00:22:58.441004 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=322, pq.top=322
W20240201 00:22:59.440009 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=329, pq.top=329
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.196 ms                  | 17.149 ms                 |
| Forward                   | 3.602 ms                  | 5.723 ms                  |
| Backward                  | 5.951 ms                  | 9.790 ms                  |
| Optimize                  | 1.491 ms                  | 3.861 ms                  |
| BarrierTimeBeforeRank0    | 20.905 us                 | 12.276 ms                 |
| AfterBackward             | 11.218 ms                 | 17.067 ms                 |
| BlockToStepN              | 84.850 ms                 | 120.745 ms                |
| OneStep                   | 114.169 ms                | 156.685 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.735 ms                  | 3.584 ms                  |
| ProcessBack:UpdateCache   | 1.107 ms                  | 1.982 ms                  |
| ProcessBack:UpsertPq      | 8.073 ms                  | 11.566 ms                 |
| ProcessOneStep            | 11.198 ms                 | 17.019 ms                 |
| BlockToStepN              | 84.968 ms                 | 120.698 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:23:00.440011 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=337, pq.top=337
W20240201 00:23:01.454221 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=345, pq.top=345
W20240201 00:23:02.454011 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=352, pq.top=352
W20240201 00:23:03.469875 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=360, pq.top=360
W20240201 00:23:04.469007 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=367, pq.top=367
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.214 ms                  | 17.029 ms                 |
| Forward                   | 3.617 ms                  | 5.424 ms                  |
| Backward                  | 5.954 ms                  | 9.790 ms                  |
| Optimize                  | 1.479 ms                  | 3.547 ms                  |
| BarrierTimeBeforeRank0    | 21.372 us                 | 12.276 ms                 |
| AfterBackward             | 11.231 ms                 | 15.165 ms                 |
| BlockToStepN              | 86.856 ms                 | 121.879 ms                |
| OneStep                   | 115.147 ms                | 156.685 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.736 ms                  | 3.710 ms                  |
| ProcessBack:UpdateCache   | 1.078 ms                  | 1.982 ms                  |
| ProcessBack:UpsertPq      | 8.101 ms                  | 12.077 ms                 |
| ProcessOneStep            | 11.206 ms                 | 15.139 ms                 |
| BlockToStepN              | 86.824 ms                 | 121.849 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:23:05.469012 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=374, pq.top=374
W20240201 00:23:06.469009 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=382, pq.top=382
W20240201 00:23:07.478436 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=390, pq.top=390
W20240201 00:23:08.478013 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=397, pq.top=397
[proc 3] 400 steps, total: 13.299, sample: 0.209, forward: 0.319, backward: 0.611, update: 0.165
[proc 2] 400 steps, total: 13.299, sample: 0.222, forward: 0.325, backward: 0.609, update: 0.169
[proc 0] 400 steps, total: 13.299, sample: 0.310, forward: 0.370, backward: 0.624, update: 0.180
[proc 1] 400 steps, total: 13.299, sample: 0.211, forward: 0.317, backward: 0.620, update: 0.148
W20240201 00:23:09.478010 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=404, pq.top=404
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.236 ms                  | 17.029 ms                 |
| Forward                   | 3.620 ms                  | 5.424 ms                  |
| Backward                  | 5.954 ms                  | 9.869 ms                  |
| Optimize                  | 1.486 ms                  | 4.776 ms                  |
| BarrierTimeBeforeRank0    | 21.168 us                 | 12.276 ms                 |
| AfterBackward             | 11.263 ms                 | 17.067 ms                 |
| BlockToStepN              | 88.020 ms                 | 126.641 ms                |
| OneStep                   | 117.877 ms                | 156.685 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.738 ms                  | 3.584 ms                  |
| ProcessBack:UpdateCache   | 1.030 ms                  | 1.906 ms                  |
| ProcessBack:UpsertPq      | 8.152 ms                  | 12.254 ms                 |
| ProcessOneStep            | 11.250 ms                 | 17.019 ms                 |
| BlockToStepN              | 87.990 ms                 | 126.552 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:23:10.478006 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=411, pq.top=411
W20240201 00:23:11.478008 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=419, pq.top=419
W20240201 00:23:12.498044 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=427, pq.top=427
W20240201 00:23:13.498005 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=434, pq.top=434
W20240201 00:23:14.498008 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=441, pq.top=441
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.262 ms                  | 17.149 ms                 |
| Forward                   | 3.617 ms                  | 5.424 ms                  |
| Backward                  | 5.952 ms                  | 9.869 ms                  |
| Optimize                  | 1.481 ms                  | 4.776 ms                  |
| BarrierTimeBeforeRank0    | 20.861 us                 | 12.276 ms                 |
| AfterBackward             | 11.308 ms                 | 17.067 ms                 |
| BlockToStepN              | 88.932 ms                 | 127.917 ms                |
| OneStep                   | 119.656 ms                | 161.210 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.739 ms                  | 3.558 ms                  |
| ProcessBack:UpdateCache   | 1.022 ms                  | 1.729 ms                  |
| ProcessBack:UpsertPq      | 8.179 ms                  | 12.254 ms                 |
| ProcessOneStep            | 11.295 ms                 | 17.019 ms                 |
| BlockToStepN              | 88.904 ms                 | 127.887 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:23:15.519162 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=449, pq.top=449
W20240201 00:23:16.519011 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=456, pq.top=456
W20240201 00:23:17.539803 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=463, pq.top=463
W20240201 00:23:18.539011 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=470, pq.top=470
W20240201 00:23:19.539009 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=477, pq.top=477
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.270 ms                  | 17.149 ms                 |
| Forward                   | 3.619 ms                  | 5.329 ms                  |
| Backward                  | 5.949 ms                  | 9.869 ms                  |
| Optimize                  | 1.479 ms                  | 3.861 ms                  |
| BarrierTimeBeforeRank0    | 21.180 us                 | 11.867 ms                 |
| AfterBackward             | 11.327 ms                 | 16.875 ms                 |
| BlockToStepN              | 91.094 ms                 | 131.757 ms                |
| OneStep                   | 121.592 ms                | 166.418 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.742 ms                  | 3.429 ms                  |
| ProcessBack:UpdateCache   | 994.706 us                | 1.722 ms                  |
| ProcessBack:UpsertPq      | 8.199 ms                  | 12.818 ms                 |
| ProcessOneStep            | 11.316 ms                 | 16.852 ms                 |
| BlockToStepN              | 91.194 ms                 | 131.720 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:23:20.539005 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=485, pq.top=485
W20240201 00:23:21.539012 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=492, pq.top=492
W20240201 00:23:22.547648 3299034 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=500, pq.top=500
[proc 0] 500 steps, total: 13.687, sample: 0.349, forward: 0.356, backward: 0.626, update: 0.161
[proc 2] 500 steps, total: 13.687, sample: 0.217, forward: 0.325, backward: 0.617, update: 0.164
Successfully xmh. training takes 61.64120674133301 seconds
[proc 3] 500 steps, total: 13.687, sample: 0.216, forward: 0.320, backward: 0.620, update: 0.164
[proc 1] 500 steps, total: 13.687, sample: 0.193, forward: 0.323, backward: 0.631, update: 0.163
before call kg_cache_controller.StopThreads()
W20240201 00:23:22.648391 3299034 grad_async_v1.h:243] call StopThreads. PID = 3298692
W20240201 00:23:22.648401 3299034 grad_base.h:212] before processOneStepNegThread_.join();
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240201 00:23:22.658280 3299034 grad_base.h:214] after processOneStepNegThread_.join();
W20240201 00:23:22.658304 3299034 grad_async_v1.h:245] call GradProcessingBase::StopThreads.
W20240201 00:23:22.685035 3299034 grad_async_v1.h:264] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fd61fa76650>

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240201 01:12:29.014439 3385830 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_270', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=3, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=3, gpu=[0, 1, 2], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [3385830 sampler.py:454] Start PreSampling
WARNING [3385830 sampler.py:532] Before construct renumbering_dict
WARNING [3385830 sampler.py:555] PreSampling done
W20240201 01:12:31.797363 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240201 01:12:31.797528 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240201 01:12:31.797554 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240201 01:12:31.797582 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240201 01:12:31.797607 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240201 01:12:31.797626 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240201 01:12:31.797647 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240201 01:12:31.797677 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240201 01:12:31.797698 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240201 01:12:31.797725 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240201 01:12:31.797748 3385830 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240201 01:12:31.797770 3385830 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240201 01:12:31.797787 3385830 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240201 01:12:31.797879 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240201 01:12:31.797906 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240201 01:12:31.797926 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240201 01:12:31.797963 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240201 01:12:31.797984 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240201 01:12:31.798007 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240201 01:12:31.798025 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240201 01:12:31.798049 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240201 01:12:31.798070 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240201 01:12:31.798089 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240201 01:12:31.798108 3385830 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240201 01:12:31.798125 3385830 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240201 01:12:31.798141 3385830 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240201 01:12:31.798182 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240201 01:12:31.798205 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240201 01:12:31.798228 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240201 01:12:31.798250 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240201 01:12:31.798272 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240201 01:12:31.798300 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240201 01:12:31.798319 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240201 01:12:31.798341 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240201 01:12:31.798359 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240201 01:12:31.798381 3385830 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240201 01:12:31.798404 3385830 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240201 01:12:31.798419 3385830 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240201 01:12:31.798436 3385830 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240201 01:12:31.936321 3385830 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x10000e52e000 22.81 MB
W20240201 01:12:31.963197 3385830 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000fc00000 58.4 kB
{0: Graph(num_nodes=11296, num_edges=176344,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12898, num_edges=253277,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=12169, num_edges=314310,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 11296 N 176344 E
MertisPartition: part 1 has 12898 N 253277 E
MertisPartition: part 2 has 12169 N 314310 E
Rank0: cached key size 249
Rank1: cached key size 249
Rank2: cached key size 249
Before renumbering graph:  {'_ID': tensor([    0,     2,    10,  ...,  8580,   176, 12835]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 782,  838, 1131,  ..., 7586, 7649, 3613]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 2, 2])}
part_g: DGLGraph(num_nodes=11296, num_edges=176344,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=11296, num_edges=176344,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.973 seconds
[Rank1] pid = 3386043
INFO [3385830 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3386043 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3386108 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [3386043 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [3386108 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [3385830 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
W20240201 01:12:33.934082 3386044 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240201 01:12:33.934394 3386138 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240201 01:12:33.934458 3386044 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10000fc12000 7.629 MB
W20240201 01:12:33.934557 3386044 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000103b5000 7.629 MB
W20240201 01:12:33.934543 3386109 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240201 01:12:33.934598 3386044 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x100010b58000 1.49 GB
W20240201 01:12:33.934630 3386044 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10007013b000 1.49 GB
W20240201 01:12:33.934667 3386044 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240201 01:12:33.934907 3386138 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1000cf720000 7.629 MB
W20240201 01:12:33.935021 3386138 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1000cfec3000 7.629 MB
W20240201 01:12:33.935086 3386138 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1000d0666000 1.49 GB
W20240201 01:12:33.935132 3386138 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x10012fc49000 1.49 GB
W20240201 01:12:33.935180 3386138 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240201 01:12:33.938369 3386044 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240201 01:12:33.938385 3386138 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240201 01:12:33.938540 3386109 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10018f232000 7.629 MB
W20240201 01:12:33.938696 3386109 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10018f9d5000 7.629 MB
W20240201 01:12:33.938791 3386109 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x100190178000 1.49 GB
W20240201 01:12:33.938864 3386109 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1001ef75b000 1.49 GB
W20240201 01:12:33.938933 3386109 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240201 01:12:33.946615 3386109 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x10000e52e000
1: KnownLocalCachedEmbedding init done
WARNING [3386043 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000e52e000
2: KnownLocalCachedEmbedding init done
WARNING [3386108 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank2] pid = 3386108
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241)]
cudaHostRegister 0x10000e52e000
0: KnownLocalCachedEmbedding init done
WARNING [3385830 DistTensor.py:59] The tensor name already exists in the kvstore
I20240201 01:12:34.848496 3386109 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 3
I20240201 01:12:34.848600 3386044 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
I20240201 01:12:34.848686 3386138 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
W20240201 01:12:34.849642 3386109 grad_base.h:55] KGCacheController, config={
        "num_gpus": 3,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240201 01:12:34.849730 3386109 grad_base.h:184] Init GradProcessingBase done
I20240201 01:12:34.851249 3386109 grad_async_v1.h:203] Use main thread to update emb.
W20240201 01:12:34.851275 3386109 kg_controller.h:75] after init GradAsyncProcessing
I20240201 01:12:34.851279 3386109 kg_controller.h:84] Construct KGCacheController done
E20240201 01:12:35.099851 3386138 recstore.cc:66] init folly done
E20240201 01:12:35.099850 3386109 recstore.cc:66] init folly done
E20240201 01:12:35.099896 3386044 recstore.cc:66] init folly done
I20240201 01:12:35.100612 3386109 grad_base.h:60] GraphEnv RegTensorsPerProcess
I20240201 01:12:35.526432 3386109 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 3
I20240201 01:12:35.540424 3386138 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
I20240201 01:12:35.582986 3386044 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
W20240201 01:12:37.446851 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=1, pq.top=1
E20240201 01:12:37.489025 3386109 grad_async_v1.h:533] Stalled in ProcessBackward: rank=2, step_no=1, sample_step_cpp_seen_[rank]=0
W20240201 01:12:38.451200 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=34, pq.top=34
W20240201 01:12:39.451007 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=54, pq.top=54
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 755.061 us                | 12.800 ms                 |
| Forward                   | 3.096 ms                  | 8.917 ms                  |
| Backward                  | 5.485 ms                  | 6.253 ms                  |
| Optimize                  | 1.230 ms                  | 2.818 ms                  |
| BarrierTimeBeforeRank0    | 20.300 us                 | 2.255 ms                  |
| AfterBackward             | 6.411 ms                  | 18.767 ms                 |
| BlockToStepN              | 22.765 ms                 | 41.131 ms                 |
| OneStep                   | 40.934 ms                 | 63.367 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.039 ms                  | 75.601 ms                 |
| ProcessBack:UpdateCache   | 693.270 us                | 165.205 ms                |
| ProcessBack:UpsertPq      | 4.202 ms                  | 7.811 ms                  |
| ProcessOneStep            | 6.443 ms                  | 18.745 ms                 |
| BlockToStepN              | 23.568 ms                 | 45.557 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:12:40.451004 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=70, pq.top=70
W20240201 01:12:41.451007 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=85, pq.top=85
W20240201 01:12:42.451005 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=98, pq.top=98
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.046, sample: 0.174, forward: 1.018, backward: 0.685, update: 0.137
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 7.089, sample: 0.174, forward: 1.307, backward: 0.753, update: 0.134
train_sampler.Prefill()
-------Step 0-------
tensor([  142,  6721,   197, 12004,  9310,  2168, 12574, 14349, 13500,   607]) tensor([ 1131, 10002,  7806, 11181, 11753,  9610,  7224,  6346,  6090, 10294])
-------Step 1-------
tensor([  142,  6721,   197, 12004,  9310,  2168, 12574, 14349, 13500,   607]) tensor([ 1390,  8204,  8317,  2861, 11132, 10284,  9785, 14393,  7534, 14775])
-------Step 2-------
tensor([11662,  8899, 14501,     2,  6890,  4898,  7986,  7146,  8408,  1852]) tensor([3459, 8226,  728, 3759, 6448, 1883, 1167, 1155, 7190, 5293])
-------Step 3-------
tensor([11662,  8899, 14501,     2,  6890,  4898,  7986,  7146,  8408,  1852]) tensor([ 9803,  7936, 10556, 11997,  8301,  9387, 12509,  7511,  3636,  6027])
-------Step 4-------
tensor([12367,  6689,  4408,   209,  4380,  1407, 13649, 13295,   135,  6750]) tensor([10801,  2962,  3343,  6059,  7897,  2528, 11220,  2348,  2643, 11586])
-------Step 5-------
tensor([12367,  6689,  4408,   209,  4380,  1407, 13649, 13295,   135,  6750]) tensor([13072, 10806,  6474,  5533,  8785,  9421,  4138,  5977,  9966,  9001])
-------Step 6-------
tensor([ 7807, 11400,  2168,  1611, 13604,  7234,  3313,   154,   232,  8607]) tensor([10925,   594,  5062,  1901,  9065,  2298,  9034, 10457, 14453,  6414])
-------Step 7-------
tensor([ 7807, 11400,  2168,  1611, 13604,  7234,  3313,   154,   232,  8607]) tensor([14840,  7557,   245, 14013, 12334,  9675, 14650, 10172, 12073, 10855])
-------Step 8-------
tensor([ 1269, 10375,  3022,  5627,  7217,   959,  2420, 14482,  9958,  8815]) tensor([ 3841,  8695,  7879,  5058,  2872, 11053,  4302,  6425,  8831,   640])
-------Step 9-------
tensor([ 1269, 10375,  3022,  5627,  7217,   959,  2420, 14482,  9958,  8815]) tensor([ 7040,  2613,  2016, 12374,  7456,  9148,  5921,  5526,  8415, 11091])
before start barrier
start train
[proc 0] 100 steps, total: 7.103, sample: 0.204, forward: 1.055, backward: 0.708, update: 0.140
W20240201 01:12:43.451009 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=111, pq.top=111
W20240201 01:12:44.451009 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=123, pq.top=123
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 841.924 us                | 12.800 ms                 |
| Forward                   | 3.145 ms                  | 8.917 ms                  |
| Backward                  | 5.597 ms                  | 6.253 ms                  |
| Optimize                  | 1.191 ms                  | 2.821 ms                  |
| BarrierTimeBeforeRank0    | 17.854 us                 | 2.255 ms                  |
| AfterBackward             | 6.591 ms                  | 18.767 ms                 |
| BlockToStepN              | 43.423 ms                 | 65.804 ms                 |
| OneStep                   | 62.122 ms                 | 91.337 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.030 ms                  | 1.802 ms                  |
| ProcessBack:UpdateCache   | 691.773 us                | 1.267 ms                  |
| ProcessBack:UpsertPq      | 4.566 ms                  | 6.593 ms                  |
| ProcessOneStep            | 6.575 ms                  | 18.745 ms                 |
| BlockToStepN              | 43.581 ms                 | 66.227 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:12:45.451004 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=135, pq.top=135
W20240201 01:12:46.466825 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=147, pq.top=147
W20240201 01:12:47.466008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=158, pq.top=158
W20240201 01:12:48.466004 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=169, pq.top=169
W20240201 01:12:49.466008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=180, pq.top=180
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 898.113 us                | 12.837 ms                 |
| Forward                   | 3.139 ms                  | 4.307 ms                  |
| Backward                  | 5.604 ms                  | 6.253 ms                  |
| Optimize                  | 1.206 ms                  | 2.818 ms                  |
| BarrierTimeBeforeRank0    | 17.582 us                 | 1.900 ms                  |
| AfterBackward             | 6.628 ms                  | 10.158 ms                 |
| BlockToStepN              | 53.729 ms                 | 79.034 ms                 |
| OneStep                   | 73.582 ms                 | 101.051 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.029 ms                  | 1.802 ms                  |
| ProcessBack:UpdateCache   | 694.172 us                | 1.123 ms                  |
| ProcessBack:UpsertPq      | 4.608 ms                  | 7.650 ms                  |
| ProcessOneStep            | 6.611 ms                  | 10.115 ms                 |
| BlockToStepN              | 53.844 ms                 | 78.973 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:12:50.466008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=191, pq.top=191
[proc 0] 200 steps, total: 8.757, sample: 0.245, forward: 0.314, backward: 0.556, update: 0.135
[proc 2] 200 steps, total: 8.757, sample: 0.199, forward: 0.260, backward: 0.550, update: 0.126
[proc 1] 200 steps, total: 8.758, sample: 0.196, forward: 0.276, backward: 0.543, update: 0.129
W20240201 01:12:51.466006 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=201, pq.top=201
W20240201 01:12:52.466008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=212, pq.top=212
W20240201 01:12:53.482739 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=223, pq.top=223
W20240201 01:12:54.482008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=232, pq.top=232
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 952.279 us                | 12.837 ms                 |
| Forward                   | 3.151 ms                  | 4.307 ms                  |
| Backward                  | 5.605 ms                  | 6.253 ms                  |
| Optimize                  | 1.191 ms                  | 2.818 ms                  |
| BarrierTimeBeforeRank0    | 16.627 us                 | 2.327 ms                  |
| AfterBackward             | 6.654 ms                  | 10.158 ms                 |
| BlockToStepN              | 61.144 ms                 | 88.928 ms                 |
| OneStep                   | 80.713 ms                 | 112.475 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.029 ms                  | 1.802 ms                  |
| ProcessBack:UpdateCache   | 689.171 us                | 1.089 ms                  |
| ProcessBack:UpsertPq      | 4.610 ms                  | 7.649 ms                  |
| ProcessOneStep            | 6.638 ms                  | 10.115 ms                 |
| BlockToStepN              | 61.344 ms                 | 89.503 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:12:55.505676 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=243, pq.top=243
W20240201 01:12:56.505009 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=253, pq.top=253
W20240201 01:12:57.531513 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=264, pq.top=264
W20240201 01:12:58.531005 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=274, pq.top=274
W20240201 01:12:59.531010 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=283, pq.top=283
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 988.316 us                | 12.800 ms                 |
| Forward                   | 3.145 ms                  | 4.236 ms                  |
| Backward                  | 5.610 ms                  | 6.253 ms                  |
| Optimize                  | 1.188 ms                  | 2.802 ms                  |
| BarrierTimeBeforeRank0    | 16.672 us                 | 9.333 ms                  |
| AfterBackward             | 6.662 ms                  | 9.919 ms                  |
| BlockToStepN              | 65.228 ms                 | 93.824 ms                 |
| OneStep                   | 84.980 ms                 | 120.233 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.028 ms                  | 1.941 ms                  |
| ProcessBack:UpdateCache   | 684.892 us                | 1.024 ms                  |
| ProcessBack:UpsertPq      | 4.636 ms                  | 7.649 ms                  |
| ProcessOneStep            | 6.648 ms                  | 9.903 ms                  |
| BlockToStepN              | 65.212 ms                 | 93.766 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:13:00.531008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=294, pq.top=294
[proc 0] 300 steps, total: 9.857, sample: 0.241, forward: 0.308, backward: 0.559, update: 0.118
[proc 1] 300 steps, total: 9.857, sample: 0.179, forward: 0.272, backward: 0.541, update: 0.124
[proc 2] 300 steps, total: 9.857, sample: 0.175, forward: 0.261, backward: 0.559, update: 0.129
W20240201 01:13:01.531005 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=303, pq.top=303
W20240201 01:13:02.531009 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=312, pq.top=312
W20240201 01:13:03.531008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=323, pq.top=323
W20240201 01:13:04.531005 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=333, pq.top=333
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.009 ms                  | 12.800 ms                 |
| Forward                   | 3.143 ms                  | 4.236 ms                  |
| Backward                  | 5.617 ms                  | 6.253 ms                  |
| Optimize                  | 1.186 ms                  | 2.802 ms                  |
| BarrierTimeBeforeRank0    | 16.578 us                 | 10.708 ms                 |
| AfterBackward             | 6.662 ms                  | 9.919 ms                  |
| BlockToStepN              | 67.731 ms                 | 99.226 ms                 |
| OneStep                   | 88.217 ms                 | 122.493 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.029 ms                  | 1.802 ms                  |
| ProcessBack:UpdateCache   | 681.315 us                | 974.861 us                |
| ProcessBack:UpsertPq      | 4.630 ms                  | 7.208 ms                  |
| ProcessOneStep            | 6.646 ms                  | 9.903 ms                  |
| BlockToStepN              | 67.687 ms                 | 99.153 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:13:05.560961 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=343, pq.top=343
W20240201 01:13:06.560011 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=352, pq.top=352
W20240201 01:13:07.560004 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=362, pq.top=362
W20240201 01:13:08.570565 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=372, pq.top=372
W20240201 01:13:09.574844 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=382, pq.top=382
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.050 ms                  | 13.332 ms                 |
| Forward                   | 3.143 ms                  | 4.201 ms                  |
| Backward                  | 5.626 ms                  | 6.163 ms                  |
| Optimize                  | 1.185 ms                  | 2.789 ms                  |
| BarrierTimeBeforeRank0    | 16.672 us                 | 10.708 ms                 |
| AfterBackward             | 6.673 ms                  | 9.868 ms                  |
| BlockToStepN              | 69.831 ms                 | 100.837 ms                |
| OneStep                   | 91.428 ms                 | 122.493 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.029 ms                  | 1.670 ms                  |
| ProcessBack:UpdateCache   | 680.279 us                | 947.017 us                |
| ProcessBack:UpsertPq      | 4.636 ms                  | 7.137 ms                  |
| ProcessOneStep            | 6.657 ms                  | 9.849 ms                  |
| BlockToStepN              | 69.789 ms                 | 100.801 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 01:13:10.595935 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=392, pq.top=392
[proc 0] 400 steps, total: 10.212, sample: 0.255, forward: 0.308, backward: 0.559, update: 0.121
[proc 1] 400 steps, total: 10.212, sample: 0.179, forward: 0.271, backward: 0.541, update: 0.118
[proc 2] 400 steps, total: 10.212, sample: 0.190, forward: 0.261, backward: 0.560, update: 0.129
W20240201 01:13:11.595005 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=402, pq.top=402
W20240201 01:13:12.595011 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=411, pq.top=411
W20240201 01:13:13.595007 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=421, pq.top=421
W20240201 01:13:14.595005 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=431, pq.top=431
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.065 ms                  | 13.332 ms                 |
| Forward                   | 3.136 ms                  | 4.201 ms                  |
| Backward                  | 5.637 ms                  | 6.163 ms                  |
| Optimize                  | 1.185 ms                  | 2.789 ms                  |
| BarrierTimeBeforeRank0    | 17.582 us                 | 10.708 ms                 |
| AfterBackward             | 6.681 ms                  | 9.868 ms                  |
| BlockToStepN              | 71.336 ms                 | 100.837 ms                |
| OneStep                   | 92.542 ms                 | 122.493 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.031 ms                  | 1.646 ms                  |
| ProcessBack:UpdateCache   | 679.072 us                | 946.817 us                |
| ProcessBack:UpsertPq      | 4.639 ms                  | 7.137 ms                  |
| ProcessOneStep            | 6.664 ms                  | 9.849 ms                  |
| BlockToStepN              | 71.296 ms                 | 100.801 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 01:13:15.601352 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=441, pq.top=441
W20240201 01:13:16.601011 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=450, pq.top=450
W20240201 01:13:17.601006 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=460, pq.top=460
W20240201 01:13:18.601008 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=470, pq.top=470
W20240201 01:13:19.601013 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=479, pq.top=479
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.087 ms                  | 13.332 ms                 |
| Forward                   | 3.139 ms                  | 4.134 ms                  |
| Backward                  | 5.639 ms                  | 6.159 ms                  |
| Optimize                  | 1.186 ms                  | 2.785 ms                  |
| BarrierTimeBeforeRank0    | 17.707 us                 | 10.894 ms                 |
| AfterBackward             | 6.681 ms                  | 9.844 ms                  |
| BlockToStepN              | 73.453 ms                 | 100.837 ms                |
| OneStep                   | 94.078 ms                 | 122.132 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.032 ms                  | 1.599 ms                  |
| ProcessBack:UpdateCache   | 676.870 us                | 880.287 us                |
| ProcessBack:UpsertPq      | 4.641 ms                  | 7.208 ms                  |
| ProcessOneStep            | 6.662 ms                  | 9.828 ms                  |
| BlockToStepN              | 73.445 ms                 | 100.801 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 01:13:20.601006 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=489, pq.top=489
W20240201 01:13:21.601009 3386109 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=498, pq.top=498
[proc 0] 500 steps, total: 10.340, sample: 0.256, forward: 0.310, backward: 0.561, update: 0.122
[proc 1] 500 steps, total: 10.340, sample: 0.199, forward: 0.277, backward: 0.538, update: 0.138
[proc 2] 500 steps, total: 10.340, sample: 0.201, forward: 0.260, backward: 0.554, update: 0.133
Successfully xmh. training takes 46.27009701728821 seconds
before call kg_cache_controller.StopThreads()
W20240201 01:13:21.796583 3386109 grad_async_v1.h:243] call StopThreads. PID = 3385830
W20240201 01:13:21.796607 3386109 grad_base.h:212] before processOneStepNegThread_.join();
W20240201 01:13:21.801317 3386109 grad_base.h:214] after processOneStepNegThread_.join();
W20240201 01:13:21.801379 3386109 grad_async_v1.h:245] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240201 01:13:21.832099 3386109 grad_async_v1.h:264] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f66cdb326d0>

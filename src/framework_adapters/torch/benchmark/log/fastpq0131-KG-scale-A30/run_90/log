WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 21:46:58.708768 396309 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_100', no_save_emb=True, max_step=500, batch_size=1800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [396309 sampler.py:454] Start PreSampling
WARNING [396309 sampler.py:532] Before construct renumbering_dict
WARNING [396309 sampler.py:555] PreSampling done
W20240207 21:47:00.664676 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 21:47:00.664822 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 21:47:00.664851 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 21:47:00.664873 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 21:47:00.664888 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 21:47:00.664902 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 21:47:00.664919 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 21:47:00.664943 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 21:47:00.664958 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 21:47:00.664985 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 21:47:00.665002 396309 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 21:47:00.665019 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 21:47:00.665031 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 21:47:00.665127 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 21:47:00.665150 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 21:47:00.665164 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 21:47:00.665199 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 21:47:00.665218 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 21:47:00.665233 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 21:47:00.665251 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 21:47:00.665266 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 21:47:00.665289 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 21:47:00.665307 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 21:47:00.665323 396309 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 21:47:00.665335 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 21:47:00.665346 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 21:47:00.665380 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240207 21:47:00.665398 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240207 21:47:00.665417 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240207 21:47:00.665431 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240207 21:47:00.665445 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240207 21:47:00.665459 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240207 21:47:00.665477 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240207 21:47:00.665494 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240207 21:47:00.665509 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240207 21:47:00.665525 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240207 21:47:00.665549 396309 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240207 21:47:00.665563 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240207 21:47:00.665585 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240207 21:47:00.665616 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240207 21:47:00.665632 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240207 21:47:00.665647 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240207 21:47:00.665664 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240207 21:47:00.665679 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240207 21:47:00.665699 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240207 21:47:00.665720 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240207 21:47:00.665735 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240207 21:47:00.665752 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240207 21:47:00.665767 396309 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240207 21:47:00.665783 396309 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240207 21:47:00.665796 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240207 21:47:00.665818 396309 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240207 21:47:00.816504 396309 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240207 21:47:00.845095 396309 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 862, 1085, 1167,  ..., 1553, 5514, 6763]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.159 seconds
[Rank1] pid = 396519
[Rank2] pid = 396583
INFO [396309 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [396519 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [396648 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [396648 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [396583 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [396309 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [396583 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [396519 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240207 21:47:04.063634 396650 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240207 21:47:04.063849 396649 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240207 21:47:04.064141 396650 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100014876000 7.629 MB
W20240207 21:47:04.064270 396650 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x100015019000 7.629 MB
W20240207 21:47:04.064328 396650 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000157bc000 1.49 GB
W20240207 21:47:04.064366 396650 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x100074da1000 1.49 GB
W20240207 21:47:04.064402 396650 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 21:47:04.064402 396584 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240207 21:47:04.064477 396649 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000d4384000 7.629 MB
W20240207 21:47:04.064671 396649 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1000d4b27000 7.629 MB
W20240207 21:47:04.064625 396520 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240207 21:47:04.064749 396649 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000d52ca000 1.49 GB
W20240207 21:47:04.064806 396649 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1001348ad000 1.49 GB
W20240207 21:47:04.064858 396649 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 21:47:04.071341 396650 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 21:47:04.071415 396649 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 21:47:04.071444 396584 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x100193e98000 7.629 MB
W20240207 21:47:04.071475 396520 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10019463b000 7.629 MB
W20240207 21:47:04.071589 396584 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x100194dde000 7.629 MB
W20240207 21:47:04.071638 396584 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x100195581000 1.49 GB
W20240207 21:47:04.071661 396520 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1001f4b64000 7.629 MB
W20240207 21:47:04.071688 396584 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1001f5307000 1.49 GB
W20240207 21:47:04.071743 396584 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 21:47:04.071784 396520 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1002548ea000 1.49 GB
W20240207 21:47:04.071854 396520 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1002b3ecd000 1.49 GB
W20240207 21:47:04.071928 396520 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240207 21:47:04.083680 396584 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 21:47:04.083750 396520 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [396583 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [396648 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [396519 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 396648
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [396309 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 21:47:05.317359 396649 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240207 21:47:05.317487 396650 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 21:47:05.317546 396520 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 21:47:05.317811 396584 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240207 21:47:05.319164 396649 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240207 21:47:05.319304 396649 grad_base.h:184] Init GradProcessingBase done
I20240207 21:47:05.323681 396649 grad_async_v2.h:42] Use main thread to update emb.
W20240207 21:47:05.323712 396649 kg_controller.h:78] after init GradAsyncProcessingV2
I20240207 21:47:05.323716 396649 kg_controller.h:84] Construct KGCacheController done
E20240207 21:47:05.695637 396649 recstore.cc:66] init folly done
E20240207 21:47:05.695907 396650 recstore.cc:66] init folly done
E20240207 21:47:05.695924 396584 recstore.cc:66] init folly done
E20240207 21:47:05.695930 396520 recstore.cc:66] init folly done
I20240207 21:47:05.696784 396649 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240207 21:47:06.337857 397028 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 21:47:06.338152 397028 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 21:47:06.366019 396649 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240207 21:47:06.383397 396650 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240207 21:47:06.400251 396584 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240207 21:47:06.407701 396520 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240207 21:47:08.808123 396836 parallel_pq_v2.h:79] insert failed, size(hashtable)=5
W20240207 21:47:08.830138 397028 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 21:47:08.853911 396836 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=1, sample_step_cpp_seen_[rank]=0
W20240207 21:47:09.179983 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=11, pq.top=11
E20240207 21:47:09.808107 397028 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 21:47:09.838716 397028 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end5
W20240207 21:47:10.234972 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=35, pq.top=35
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.341 ms                  | 25.707 ms                 |
| Forward                   | 4.278 ms                  | 777.353 ms                |
| Backward                  | 3.062 ms                  | 279.771 ms                |
| Optimize                  | 2.032 ms                  | 39.901 ms                 |
| BarrierTimeBeforeRank0    | 38.774 us                 | 72.153 ms                 |
| AfterBackward             | 21.875 ms                 | 1.248 s                   |
| BlockToStepN              | 118.588 us                | 1.579 ms                  |
| OneStep                   | 36.145 ms                 | 2.421 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 243.217 us                | 3.215 ms                  |
| ProcessBack:Shuffle       | 2.396 ms                  | 100.062 ms                |
| ProcessBack:UpdateCache   | 2.005 ms                  | 297.938 ms                |
| ProcessBack:UpsertPq      | 14.426 ms                 | 20.968 ms                 |
| ProcessOneStep            | 20.188 ms                 | 1.247 s                   |
| BlockToStepN              | 115.331 us                | 1.524 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 21:47:10.808008 396836 parallel_pq_v2.h:79] insert failed, size(hashtable)=114
W20240207 21:47:10.855791 397028 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
W20240207 21:47:11.255117 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=63, pq.top=63
E20240207 21:47:11.808010 396649 parallel_pq_v2.h:79] insert failed, size(hashtable)=193
W20240207 21:47:11.879354 397028 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end6
W20240207 21:47:12.475476 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=90, pq.top=90
E20240207 21:47:12.808008 396836 parallel_pq_v2.h:79] insert failed, size(hashtable)=928
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 6.407, sample: 0.272, forward: 1.125, backward: 0.631, update: 0.182
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 6.415, sample: 0.224, forward: 1.084, backward: 0.591, update: 0.191
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 6.432, sample: 0.228, forward: 1.102, backward: 0.675, update: 0.227
train_sampler.Prefill()
-------Step 0-------
tensor([ 8375,  3295,  8524,  6749,  9458,  4282,   650,  4060, 13372, 11750]) tensor([ 1167,  8662,  8597,   655,  7021,  7903, 14415,  8246,  7396,  7078])
-------Step 1-------
tensor([ 8375,  3295,  8524,  6749,  9458,  4282,   650,  4060, 13372, 11750]) tensor([12415, 10126,   983,  2982,  1956, 12207,  5679,  2646,  2313, 13226])
-------Step 2-------
tensor([ 8893,  8935,  5039,  7287,  1329,  7655,  8631,  2717, 14455,   116]) tensor([ 7052,  6052,  3501,  9114,  8764,   670,  4063, 11753, 14323,  3142])
-------Step 3-------
tensor([ 8893,  8935,  5039,  7287,  1329,  7655,  8631,  2717, 14455,   116]) tensor([ 7606,   266,  5132,   167, 11631,  9397, 13981,  9156, 13312,  5110])
-------Step 4-------
tensor([11009,  4700,   542,    24, 10061, 10794, 12625, 10133,  9212,  6170]) tensor([ 2614,  9984,  7752, 13547,  8510, 10384,  1208,  1990, 11374, 13520])
-------Step 5-------
tensor([11009,  4700,   542,    24, 10061, 10794, 12625, 10133,  9212,  6170]) tensor([11301,  7054, 10109,   587,  1557,  9210,  7837, 11214, 11103, 14800])
-------Step 6-------
tensor([  143,    91,  3391,  8863, 11909,    62, 10149,    95,  3193,   138]) tensor([ 6030, 10670,  6733, 11260,  7124,  1644,  9106, 11557, 10871, 14308])
-------Step 7-------
tensor([  143,    91,  3391,  8863, 11909,    62, 10149,    95,  3193,   138]) tensor([13344, 13893,  6757, 12348,  7449, 11478, 10391, 13567, 13300,  9138])
-------Step 8-------
tensor([ 4521,  8052, 14517, 12942,  3930, 10259,  9637, 12116,  4944,  8935]) tensor([12440, 10616, 12377,   438, 11991,  8950,  6133,  1664,  6278,  8693])
-------Step 9-------
tensor([ 4521,  8052, 14517, 12942,  3930, 10259,  9637, 12116,  4944,  8935]) tensor([ 8019, 14675,  7341,  6497,  4577,  6611, 12844,  6994,  5584, 14540])
before start barrier
start train
[proc 0] 100 steps, total: 6.449, sample: 0.381, forward: 1.181, backward: 0.579, update: 0.230
W20240207 21:47:12.895442 397028 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240207 21:47:13.545609 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=120, pq.top=120
E20240207 21:47:13.808010 396836 parallel_pq_v2.h:79] insert failed, size(hashtable)=810
W20240207 21:47:13.896265 397028 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240207 21:47:14.580643 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=149, pq.top=149
E20240207 21:47:14.808009 396836 parallel_pq_v2.h:79] insert failed, size(hashtable)=75
W20240207 21:47:14.902441 397028 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.192 ms                  | 23.807 ms                 |
| Forward                   | 3.923 ms                  | 6.207 ms                  |
| Backward                  | 3.141 ms                  | 4.635 ms                  |
| Optimize                  | 1.806 ms                  | 3.899 ms                  |
| BarrierTimeBeforeRank0    | 26.345 us                 | 13.658 ms                 |
| AfterBackward             | 21.925 ms                 | 165.973 ms                |
| BlockToStepN              | 382.991 us                | 1.542 ms                  |
| OneStep                   | 34.034 ms                 | 177.342 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 21:47:15.600867 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=176, pq.top=176
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 283.174 us                | 2.826 ms                  |
| ProcessBack:Shuffle       | 2.236 ms                  | 2.907 ms                  |
| ProcessBack:UpdateCache   | 1.632 ms                  | 2.685 ms                  |
| ProcessBack:UpsertPq      | 15.014 ms                 | 20.691 ms                 |
| ProcessOneStep            | 22.142 ms                 | 165.913 ms                |
| BlockToStepN              | 345.723 us                | 1.499 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 21:47:15.808015 397028 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240207 21:47:15.920374 397028 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
[proc 3] 200 steps, total: 3.759, sample: 0.265, forward: 0.328, backward: 0.312, update: 0.154
[proc 2] 200 steps, total: 3.759, sample: 0.310, forward: 0.347, backward: 0.269, update: 0.147
[proc 1] 200 steps, total: 3.759, sample: 0.314, forward: 0.336, backward: 0.286, update: 0.154
[proc 0] 200 steps, total: 3.759, sample: 0.383, forward: 0.375, backward: 0.312, update: 0.174
W20240207 21:47:16.617902 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=201, pq.top=201
E20240207 21:47:16.808059 397040 parallel_pq_v2.h:79] insert failed, size(hashtable)=8750
W20240207 21:47:16.921814 397028 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240207 21:47:17.617879 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=227, pq.top=227
E20240207 21:47:17.808092 397028 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240207 21:47:17.923208 397028 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240207 21:47:18.637814 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=253, pq.top=253
E20240207 21:47:18.808306 396649 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 21:47:18.946744 397028 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240207 21:47:19.666220 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=280, pq.top=280
E20240207 21:47:19.808008 396649 parallel_pq_v2.h:79] insert failed, size(hashtable)=911
W20240207 21:47:19.953224 397028 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.203 ms                  | 23.856 ms                 |
| Forward                   | 3.796 ms                  | 5.726 ms                  |
| Backward                  | 3.176 ms                  | 4.427 ms                  |
| Optimize                  | 1.743 ms                  | 3.567 ms                  |
| BarrierTimeBeforeRank0    | 33.433 us                 | 16.801 ms                 |
| AfterBackward             | 21.655 ms                 | 146.350 ms                |
| BlockToStepN              | 595.433 us                | 2.360 ms                  |
| OneStep                   | 34.592 ms                 | 157.228 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 3.854, sample: 0.285, forward: 0.343, backward: 0.301, update: 0.138
[proc 0] 300 steps, total: 3.854, sample: 0.292, forward: 0.331, backward: 0.312, update: 0.166
[proc 3] 300 steps, total: 3.854, sample: 0.309, forward: 0.345, backward: 0.318, update: 0.153
[proc 2] 300 steps, total: 3.854, sample: 0.285, forward: 0.348, backward: 0.319, update: 0.136
W20240207 21:47:20.693641 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=307, pq.top=307
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 280.346 us                | 3.210 ms                  |
| ProcessBack:Shuffle       | 2.238 ms                  | 2.902 ms                  |
| ProcessBack:UpdateCache   | 1.410 ms                  | 2.633 ms                  |
| ProcessBack:UpsertPq      | 15.528 ms                 | 20.639 ms                 |
| ProcessOneStep            | 21.585 ms                 | 146.164 ms                |
| BlockToStepN              | 563.172 us                | 2.320 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 21:47:20.808238 397059 parallel_pq_v2.h:79] insert failed, size(hashtable)=14
W20240207 21:47:20.954201 397028 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240207 21:47:21.711899 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=333, pq.top=333
E20240207 21:47:21.808015 396836 parallel_pq_v2.h:79] insert failed, size(hashtable)=1126
W20240207 21:47:21.959266 397028 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240207 21:47:22.718582 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=358, pq.top=358
E20240207 21:47:22.808012 397027 parallel_pq_v2.h:79] insert failed, size(hashtable)=13074
W20240207 21:47:22.961853 397028 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240207 21:47:23.724530 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=384, pq.top=384
E20240207 21:47:23.808729 397029 parallel_pq_v2.h:79] insert failed, size(hashtable)=6224
W20240207 21:47:23.964757 397028 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
[proc 2] 400 steps, total: 3.949, sample: 0.284, forward: 0.344, backward: 0.274, update: 0.128
[proc 1] 400 steps, total: 3.949, sample: 0.279, forward: 0.349, backward: 0.303, update: 0.138
[proc 0] 400 steps, total: 3.949, sample: 0.319, forward: 0.328, backward: 0.314, update: 0.173
[proc 3] 400 steps, total: 3.949, sample: 0.289, forward: 0.346, backward: 0.315, update: 0.149
W20240207 21:47:24.746156 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=409, pq.top=409
E20240207 21:47:24.808034 397028 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 21:47:24.968097 397028 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.236 ms                  | 23.807 ms                 |
| Forward                   | 3.682 ms                  | 5.495 ms                  |
| Backward                  | 3.176 ms                  | 4.427 ms                  |
| Optimize                  | 1.719 ms                  | 3.542 ms                  |
| BarrierTimeBeforeRank0    | 31.580 us                 | 15.880 ms                 |
| AfterBackward             | 21.540 ms                 | 111.103 ms                |
| BlockToStepN              | 949.959 us                | 2.707 ms                  |
| OneStep                   | 35.016 ms                 | 142.243 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 316.909 us                | 3.087 ms                  |
| ProcessBack:Shuffle       | 2.244 ms                  | 2.874 ms                  |
| ProcessBack:UpdateCache   | 1.337 ms                  | 2.522 ms                  |
| ProcessBack:UpsertPq      | 15.912 ms                 | 20.623 ms                 |
| ProcessOneStep            | 21.538 ms                 | 110.962 ms                |
| BlockToStepN              | 1.002 ms                  | 2.741 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 21:47:25.808015 396649 parallel_pq_v2.h:79] insert failed, size(hashtable)=15
W20240207 21:47:25.828557 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=435, pq.top=435
W20240207 21:47:25.968186 397028 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240207 21:47:26.808007 396649 parallel_pq_v2.h:79] insert failed, size(hashtable)=931
W20240207 21:47:26.867915 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=460, pq.top=460
W20240207 21:47:26.977986 397028 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240207 21:47:27.808017 397027 parallel_pq_v2.h:79] insert failed, size(hashtable)=2927
W20240207 21:47:27.895114 396649 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=485, pq.top=485
W20240207 21:47:27.981122 397028 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
[proc 1] 500 steps, total: 4.135, sample: 0.278, forward: 0.343, backward: 0.362, update: 0.125
[proc 0] 500 steps, total: 4.135, sample: 0.394, forward: 0.368, backward: 0.307, update: 0.179
[proc 2] 500 steps, total: 4.135, sample: 0.313, forward: 0.345, backward: 0.271, update: 0.130
[proc 3] 500 steps, total: 4.135, sample: 0.215, forward: 0.312, backward: 0.308, update: 0.161
Successfully xmh. training takes 22.145499229431152 seconds
before call kg_cache_controller.StopThreads()
W20240207 21:47:28.511610 396649 grad_async_v2.h:84] call StopThreads. PID = 396309
W20240207 21:47:28.511646 396649 grad_base.h:212] before processOneStepNegThread_.join();
W20240207 21:47:28.511997 396649 grad_base.h:214] after processOneStepNegThread_.join();
W20240207 21:47:28.512008 396649 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240207 21:47:28.513182 396649 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f74a4303290>

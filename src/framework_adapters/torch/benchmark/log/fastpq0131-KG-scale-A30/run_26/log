WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240201 00:29:14.040953 3309825 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_228', no_save_emb=True, max_step=500, batch_size=3000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [3309825 sampler.py:454] Start PreSampling
WARNING [3309825 sampler.py:532] Before construct renumbering_dict
WARNING [3309825 sampler.py:555] PreSampling done
W20240201 00:29:15.892688 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240201 00:29:15.892812 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240201 00:29:15.892838 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240201 00:29:15.892860 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240201 00:29:15.892876 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240201 00:29:15.892896 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240201 00:29:15.892911 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240201 00:29:15.892935 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240201 00:29:15.892967 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240201 00:29:15.892984 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240201 00:29:15.893007 3309825 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240201 00:29:15.893024 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240201 00:29:15.893043 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240201 00:29:15.893131 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240201 00:29:15.893157 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240201 00:29:15.893172 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240201 00:29:15.893216 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240201 00:29:15.893234 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240201 00:29:15.893249 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240201 00:29:15.893266 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240201 00:29:15.893286 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240201 00:29:15.893301 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240201 00:29:15.893317 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240201 00:29:15.893337 3309825 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240201 00:29:15.893350 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240201 00:29:15.893364 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240201 00:29:15.893397 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240201 00:29:15.893419 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240201 00:29:15.893433 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240201 00:29:15.893448 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240201 00:29:15.893462 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240201 00:29:15.893481 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240201 00:29:15.893498 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240201 00:29:15.893517 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240201 00:29:15.893535 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240201 00:29:15.893553 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240201 00:29:15.893568 3309825 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240201 00:29:15.893580 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240201 00:29:15.893596 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240201 00:29:15.893631 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240201 00:29:15.893654 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240201 00:29:15.893675 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240201 00:29:15.893692 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240201 00:29:15.893707 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240201 00:29:15.893723 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240201 00:29:15.893747 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240201 00:29:15.893764 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240201 00:29:15.893779 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240201 00:29:15.893795 3309825 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240201 00:29:15.893813 3309825 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240201 00:29:15.893826 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240201 00:29:15.893848 3309825 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240201 00:29:16.033035 3309825 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240201 00:29:16.060849 3309825 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 876, 1157, 1235,  ..., 1709, 6423, 7267]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.042 seconds
[Rank1] pid = 3310035
[Rank2] pid = 3310100
INFO [3309825 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3310164 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [3310164 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3310035 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3310035 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240201 00:29:18.481269 3310166 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240201 00:29:18.481652 3310166 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100014876000 7.629 MB
W20240201 00:29:18.481757 3310166 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x100015019000 7.629 MB
W20240201 00:29:18.481802 3310166 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000157bc000 1.49 GB
W20240201 00:29:18.481839 3310166 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x100074d9f000 1.49 GB
W20240201 00:29:18.481874 3310166 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
INFO [3309825 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3310100 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
W20240201 00:29:18.483896 3310166 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240201 00:29:18.483999 3310165 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
INFO [3310100 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240201 00:29:18.486021 3310165 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000d4388000 7.629 MB
W20240201 00:29:18.486171 3310165 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1000d4b2b000 7.629 MB
W20240201 00:29:18.486240 3310165 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000d52ce000 1.49 GB
W20240201 00:29:18.486287 3310165 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1001348b1000 1.49 GB
W20240201 00:29:18.486347 3310165 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240201 00:29:18.486670 3310101 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240201 00:29:18.490428 3310036 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240201 00:29:18.491621 3310165 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240201 00:29:18.491750 3310101 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x100193e9a000 7.629 MB
W20240201 00:29:18.491995 3310101 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10019463d000 7.629 MB
W20240201 00:29:18.492076 3310101 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x100194de0000 1.49 GB
W20240201 00:29:18.492121 3310036 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1001f43c3000 7.629 MB
W20240201 00:29:18.492154 3310101 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1001f4b66000 1.49 GB
W20240201 00:29:18.492245 3310101 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240201 00:29:18.492528 3310036 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100254149000 7.629 MB
W20240201 00:29:18.492744 3310036 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1002548ec000 1.49 GB
W20240201 00:29:18.492902 3310036 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1002b3ecf000 1.49 GB
W20240201 00:29:18.493031 3310036 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240201 00:29:18.503846 3310101 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240201 00:29:18.503931 3310036 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [3310100 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [3310164 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 3310164
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [3309825 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [3310035 DistTensor.py:59] The tensor name already exists in the kvstore
I20240201 00:29:19.491017 3310036 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240201 00:29:19.491071 3310165 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240201 00:29:19.491147 3310166 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240201 00:29:19.491343 3310101 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240201 00:29:19.492300 3310165 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240201 00:29:19.492484 3310165 grad_base.h:184] Init GradProcessingBase done
I20240201 00:29:19.494589 3310165 grad_async_v1.h:203] Use main thread to update emb.
W20240201 00:29:19.494617 3310165 kg_controller.h:75] after init GradAsyncProcessing
I20240201 00:29:19.494622 3310165 kg_controller.h:84] Construct KGCacheController done
E20240201 00:29:19.830651 3310165 recstore.cc:66] init folly done
E20240201 00:29:19.830698 3310166 recstore.cc:66] init folly done
E20240201 00:29:19.830725 3310036 recstore.cc:66] init folly done
E20240201 00:29:19.830746 3310101 recstore.cc:66] init folly done
I20240201 00:29:19.831481 3310165 grad_base.h:60] GraphEnv RegTensorsPerProcess
I20240201 00:29:20.541919 3310165 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240201 00:29:20.582034 3310166 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240201 00:29:20.586596 3310036 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240201 00:29:20.588114 3310101 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240201 00:29:22.875191 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240201 00:29:23.875007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=21, pq.top=21
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.011 ms                  | 20.716 ms                 |
| Forward                   | 4.072 ms                  | 953.228 ms                |
| Backward                  | 6.140 ms                  | 247.677 ms                |
| Optimize                  | 2.015 ms                  | 4.142 ms                  |
| BarrierTimeBeforeRank0    | 28.223 us                 | 3.304 ms                  |
| AfterBackward             | 10.814 ms                 | 1.080 s                   |
| BlockToStepN              | 44.631 us                 | 157.731 ms                |
| OneStep                   | 37.205 ms                 | 2.298 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.954 ms                  | 170.243 ms                |
| ProcessBack:UpdateCache   | 1.269 ms                  | 259.108 ms                |
| ProcessBack:UpsertPq      | 7.303 ms                  | 16.607 ms                 |
| ProcessOneStep            | 11.325 ms                 | 1.080 s                   |
| BlockToStepN              | 10.386 ms                 | 157.647 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:29:24.875010 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=31, pq.top=31
W20240201 00:29:25.875006 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=42, pq.top=42
W20240201 00:29:26.891515 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=54, pq.top=54
W20240201 00:29:27.891007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=64, pq.top=64
W20240201 00:29:28.891005 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=74, pq.top=74
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.155 ms                  | 20.295 ms                 |
| Forward                   | 4.084 ms                  | 13.641 ms                 |
| Backward                  | 6.202 ms                  | 6.869 ms                  |
| Optimize                  | 1.850 ms                  | 4.195 ms                  |
| BarrierTimeBeforeRank0    | 22.058 us                 | 1.708 ms                  |
| AfterBackward             | 12.447 ms                 | 20.901 ms                 |
| BlockToStepN              | 61.826 ms                 | 94.399 ms                 |
| OneStep                   | 90.837 ms                 | 181.220 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.964 ms                  | 3.321 ms                  |
| ProcessBack:UpdateCache   | 1.241 ms                  | 1.747 ms                  |
| ProcessBack:UpsertPq      | 8.867 ms                  | 16.359 ms                 |
| ProcessOneStep            | 12.423 ms                 | 20.873 ms                 |
| BlockToStepN              | 61.882 ms                 | 94.349 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 00:29:29.891008 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=84, pq.top=84
W20240201 00:29:30.894023 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=94, pq.top=94
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 10.963, sample: 0.208, forward: 1.261, backward: 0.856, update: 0.204
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 10.968, sample: 0.226, forward: 1.120, backward: 0.881, update: 0.195
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 10.962, sample: 0.204, forward: 1.073, backward: 0.778, update: 0.205
train_sampler.Prefill()
-------Step 0-------
tensor([10128,  3312,  9809,  6537,  8028,  5180, 11425,  3857, 11185, 10326]) tensor([ 1235,  7415,  9917,  3355,  8361,  9586, 14008,  9971,  8001,  7718])
-------Step 1-------
tensor([10128,  3312,  9809,  6537,  8028,  5180, 11425,  3857, 11185, 10326]) tensor([ 4447, 12276,  3851, 10207,  6552,  9434,  4030,   878, 14563,  1347])
-------Step 2-------
tensor([ 7281,  5146, 10807,  7203,  2809,  5837,  1746,  6452, 11559,  9446]) tensor([12641, 13330, 10721, 14419,  9853, 13273,  9056, 10312,   363,  7858])
-------Step 3-------
tensor([ 7281,  5146, 10807,  7203,  2809,  5837,  1746,  6452, 11559,  9446]) tensor([13233,  4279,  2379,  5934, 13315, 12294,  8972,  6002,  1466,  4982])
-------Step 4-------
tensor([ 2259,  2559,  5871,   970,  7908, 12001,  9625,  2990, 13246,    60]) tensor([ 7540,  8647,  5440,  9335,  8551,  6635,  4612,  3471,  8208, 14645])
-------Step 5-------
tensor([ 2259,  2559,  5871,   970,  7908, 12001,  9625,  2990, 13246,    60]) tensor([  666,  5103, 11413,  6354, 14726, 12474,  3148, 12325,  7009, 10156])
-------Step 6-------
tensor([ 8595, 13820,   821,  8242,  9794, 14089,  6734,  4326,  2797,  4710]) tensor([ 4973, 14865, 13241, 12800,  1870,  7933, 12471, 13895,   260,  4413])
-------Step 7-------
tensor([ 8595, 13820,   821,  8242,  9794, 14089,  6734,  4326,  2797,  4710]) tensor([ 1991,  2550, 12914,  8643, 13335,  7714,  9678, 12527,  6780, 14069])
-------Step 8-------
tensor([  154, 12880, 12836,   102,  7739,  6040, 14347, 14299, 13689,  9591]) tensor([ 6316,  6665,  8278, 12823,  8154, 13140,  2373, 14413,  7955,  5640])
-------Step 9-------
tensor([  154, 12880, 12836,   102,  7739,  6040, 14347, 14299, 13689,  9591]) tensor([  50, 1938, 1753, 7070, 2370, 1530, 8633, 1351, 2087, 9482])
before start barrier
start train
[proc 0] 100 steps, total: 11.008, sample: 0.321, forward: 1.374, backward: 0.842, update: 0.231
W20240201 00:29:31.934303 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=104, pq.top=104
W20240201 00:29:32.934010 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=113, pq.top=113
W20240201 00:29:33.934010 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=122, pq.top=122
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.139 ms                  | 20.295 ms                 |
| Forward                   | 4.041 ms                  | 13.641 ms                 |
| Backward                  | 6.231 ms                  | 8.689 ms                  |
| Optimize                  | 1.745 ms                  | 4.195 ms                  |
| BarrierTimeBeforeRank0    | 22.692 us                 | 13.846 ms                 |
| AfterBackward             | 12.272 ms                 | 20.901 ms                 |
| BlockToStepN              | 67.252 ms                 | 94.399 ms                 |
| OneStep                   | 96.987 ms                 | 181.220 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.908 ms                  | 3.420 ms                  |
| ProcessBack:UpdateCache   | 1.209 ms                  | 1.709 ms                  |
| ProcessBack:UpsertPq      | 8.785 ms                  | 14.909 ms                 |
| ProcessOneStep            | 12.240 ms                 | 20.873 ms                 |
| BlockToStepN              | 67.259 ms                 | 94.349 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 00:29:34.934006 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=131, pq.top=131
W20240201 00:29:35.941694 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240201 00:29:36.955725 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=149, pq.top=149
W20240201 00:29:37.955008 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=157, pq.top=157
W20240201 00:29:38.955009 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=166, pq.top=166
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.121 ms                  | 20.223 ms                 |
| Forward                   | 4.017 ms                  | 6.013 ms                  |
| Backward                  | 6.227 ms                  | 7.519 ms                  |
| Optimize                  | 1.731 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 25.959 us                 | 13.846 ms                 |
| AfterBackward             | 12.272 ms                 | 18.527 ms                 |
| BlockToStepN              | 72.005 ms                 | 97.087 ms                 |
| OneStep                   | 101.851 ms                | 134.413 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.883 ms                  | 3.420 ms                  |
| ProcessBack:UpdateCache   | 1.185 ms                  | 1.709 ms                  |
| ProcessBack:UpsertPq      | 8.796 ms                  | 14.909 ms                 |
| ProcessOneStep            | 12.264 ms                 | 18.489 ms                 |
| BlockToStepN              | 72.071 ms                 | 97.035 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 00:29:39.955006 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=174, pq.top=174
W20240201 00:29:40.964152 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=183, pq.top=183
W20240201 00:29:41.964006 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=191, pq.top=191
W20240201 00:29:42.966441 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=200, pq.top=200
[proc 0] 200 steps, total: 11.510, sample: 0.341, forward: 0.395, backward: 0.624, update: 0.209
[proc 3] 200 steps, total: 11.510, sample: 0.245, forward: 0.358, backward: 0.606, update: 0.196
[proc 1] 200 steps, total: 11.510, sample: 0.239, forward: 0.368, backward: 0.602, update: 0.193
[proc 2] 200 steps, total: 11.510, sample: 0.239, forward: 0.347, backward: 0.578, update: 0.203
W20240201 00:29:43.966007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=208, pq.top=208
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.139 ms                  | 20.223 ms                 |
| Forward                   | 4.019 ms                  | 6.013 ms                  |
| Backward                  | 6.238 ms                  | 8.415 ms                  |
| Optimize                  | 1.723 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 28.434 us                 | 13.846 ms                 |
| AfterBackward             | 12.261 ms                 | 18.527 ms                 |
| BlockToStepN              | 74.814 ms                 | 100.587 ms                |
| OneStep                   | 106.364 ms                | 144.946 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.859 ms                  | 3.420 ms                  |
| ProcessBack:UpdateCache   | 1.163 ms                  | 1.709 ms                  |
| ProcessBack:UpsertPq      | 8.798 ms                  | 14.567 ms                 |
| ProcessOneStep            | 12.251 ms                 | 18.489 ms                 |
| BlockToStepN              | 74.772 ms                 | 100.531 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:29:44.966008 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=216, pq.top=216
W20240201 00:29:45.966009 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=224, pq.top=224
W20240201 00:29:46.966006 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=232, pq.top=232
W20240201 00:29:47.966007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=241, pq.top=241
W20240201 00:29:48.978338 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=249, pq.top=249
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.145 ms                  | 20.245 ms                 |
| Forward                   | 3.980 ms                  | 5.705 ms                  |
| Backward                  | 6.231 ms                  | 7.519 ms                  |
| Optimize                  | 1.719 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 30.109 us                 | 13.846 ms                 |
| AfterBackward             | 12.284 ms                 | 17.130 ms                 |
| BlockToStepN              | 76.622 ms                 | 100.587 ms                |
| OneStep                   | 110.279 ms                | 140.560 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.843 ms                  | 3.321 ms                  |
| ProcessBack:UpdateCache   | 1.164 ms                  | 1.707 ms                  |
| ProcessBack:UpsertPq      | 8.825 ms                  | 13.840 ms                 |
| ProcessOneStep            | 12.264 ms                 | 17.101 ms                 |
| BlockToStepN              | 76.809 ms                 | 101.613 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:29:49.978008 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=257, pq.top=257
W20240201 00:29:51.015473 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=266, pq.top=266
W20240201 00:29:52.015005 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=274, pq.top=274
W20240201 00:29:53.015012 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=281, pq.top=281
W20240201 00:29:54.015571 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=290, pq.top=290
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.157 ms                  | 20.245 ms                 |
| Forward                   | 3.980 ms                  | 5.705 ms                  |
| Backward                  | 6.223 ms                  | 7.519 ms                  |
| Optimize                  | 1.717 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 31.701 us                 | 13.846 ms                 |
| AfterBackward             | 12.261 ms                 | 17.130 ms                 |
| BlockToStepN              | 79.531 ms                 | 110.892 ms                |
| OneStep                   | 113.105 ms                | 150.332 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.831 ms                  | 3.200 ms                  |
| ProcessBack:UpdateCache   | 1.159 ms                  | 1.703 ms                  |
| ProcessBack:UpsertPq      | 8.828 ms                  | 13.395 ms                 |
| ProcessOneStep            | 12.240 ms                 | 17.101 ms                 |
| BlockToStepN              | 79.695 ms                 | 110.835 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:29:55.036056 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=298, pq.top=298
[proc 0] 300 steps, total: 12.301, sample: 0.347, forward: 0.394, backward: 0.613, update: 0.212
[proc 3] 300 steps, total: 12.301, sample: 0.244, forward: 0.361, backward: 0.601, update: 0.201
[proc 1] 300 steps, total: 12.301, sample: 0.239, forward: 0.359, backward: 0.596, update: 0.200
[proc 2] 300 steps, total: 12.301, sample: 0.210, forward: 0.337, backward: 0.578, update: 0.201
W20240201 00:29:56.056725 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=306, pq.top=306
W20240201 00:29:57.056007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=314, pq.top=314
W20240201 00:29:58.056008 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=322, pq.top=322
W20240201 00:29:59.076556 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=330, pq.top=330
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.161 ms                  | 20.245 ms                 |
| Forward                   | 3.949 ms                  | 5.705 ms                  |
| Backward                  | 6.219 ms                  | 7.519 ms                  |
| Optimize                  | 1.672 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 64.612 us                 | 14.144 ms                 |
| AfterBackward             | 12.226 ms                 | 17.130 ms                 |
| BlockToStepN              | 81.308 ms                 | 114.930 ms                |
| OneStep                   | 114.237 ms                | 154.709 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.824 ms                  | 3.096 ms                  |
| ProcessBack:UpdateCache   | 1.160 ms                  | 1.617 ms                  |
| ProcessBack:UpsertPq      | 8.825 ms                  | 13.158 ms                 |
| ProcessOneStep            | 12.202 ms                 | 17.101 ms                 |
| BlockToStepN              | 81.357 ms                 | 114.880 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:30:00.076010 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=337, pq.top=337
W20240201 00:30:01.076006 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=344, pq.top=344
W20240201 00:30:02.076009 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=352, pq.top=352
W20240201 00:30:03.076007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=358, pq.top=358
W20240201 00:30:04.076007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=366, pq.top=366
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.163 ms                  | 20.245 ms                 |
| Forward                   | 3.980 ms                  | 5.586 ms                  |
| Backward                  | 6.213 ms                  | 7.398 ms                  |
| Optimize                  | 1.682 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 102.381 us                | 13.960 ms                 |
| AfterBackward             | 12.201 ms                 | 17.019 ms                 |
| BlockToStepN              | 83.795 ms                 | 128.075 ms                |
| OneStep                   | 115.969 ms                | 160.274 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.826 ms                  | 3.096 ms                  |
| ProcessBack:UpdateCache   | 1.145 ms                  | 1.617 ms                  |
| ProcessBack:UpsertPq      | 8.798 ms                  | 13.158 ms                 |
| ProcessOneStep            | 12.177 ms                 | 16.978 ms                 |
| BlockToStepN              | 83.986 ms                 | 128.027 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:30:05.076009 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=373, pq.top=373
W20240201 00:30:06.076005 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=380, pq.top=380
W20240201 00:30:07.076010 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=387, pq.top=387
W20240201 00:30:08.076005 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=395, pq.top=395
[proc 3] 400 steps, total: 13.439, sample: 0.239, forward: 0.357, backward: 0.607, update: 0.198
[proc 2] 400 steps, total: 13.439, sample: 0.231, forward: 0.332, backward: 0.575, update: 0.199
[proc 0] 400 steps, total: 13.439, sample: 0.350, forward: 0.387, backward: 0.611, update: 0.197
[proc 1] 400 steps, total: 13.439, sample: 0.224, forward: 0.363, backward: 0.598, update: 0.205
W20240201 00:30:09.084338 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=403, pq.top=403
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.174 ms                  | 20.245 ms                 |
| Forward                   | 3.980 ms                  | 5.586 ms                  |
| Backward                  | 6.210 ms                  | 7.398 ms                  |
| Optimize                  | 1.679 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 86.611 us                 | 13.960 ms                 |
| AfterBackward             | 12.194 ms                 | 17.275 ms                 |
| BlockToStepN              | 85.839 ms                 | 129.110 ms                |
| OneStep                   | 118.198 ms                | 165.036 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.824 ms                  | 2.816 ms                  |
| ProcessBack:UpdateCache   | 1.136 ms                  | 1.569 ms                  |
| ProcessBack:UpsertPq      | 8.806 ms                  | 13.444 ms                 |
| ProcessOneStep            | 12.172 ms                 | 17.240 ms                 |
| BlockToStepN              | 85.928 ms                 | 129.059 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:30:10.084007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=410, pq.top=410
W20240201 00:30:11.084008 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=418, pq.top=418
W20240201 00:30:12.084009 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=425, pq.top=425
W20240201 00:30:13.084004 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=433, pq.top=433
W20240201 00:30:14.084008 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=440, pq.top=440
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.175 ms                  | 20.245 ms                 |
| Forward                   | 3.980 ms                  | 5.705 ms                  |
| Backward                  | 6.207 ms                  | 7.398 ms                  |
| Optimize                  | 1.692 ms                  | 4.155 ms                  |
| BarrierTimeBeforeRank0    | 69.387 us                 | 13.960 ms                 |
| AfterBackward             | 12.194 ms                 | 17.977 ms                 |
| BlockToStepN              | 87.079 ms                 | 132.299 ms                |
| OneStep                   | 119.413 ms                | 167.231 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.825 ms                  | 2.774 ms                  |
| ProcessBack:UpdateCache   | 1.118 ms                  | 1.557 ms                  |
| ProcessBack:UpsertPq      | 8.806 ms                  | 14.154 ms                 |
| ProcessOneStep            | 12.170 ms                 | 17.954 ms                 |
| BlockToStepN              | 87.042 ms                 | 132.253 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:30:15.084005 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=447, pq.top=447
W20240201 00:30:16.084009 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=455, pq.top=455
W20240201 00:30:17.112435 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=463, pq.top=463
W20240201 00:30:18.112007 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=470, pq.top=470
W20240201 00:30:19.112010 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=477, pq.top=477
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.178 ms                  | 20.223 ms                 |
| Forward                   | 3.972 ms                  | 5.586 ms                  |
| Backward                  | 6.205 ms                  | 7.311 ms                  |
| Optimize                  | 1.672 ms                  | 4.142 ms                  |
| BarrierTimeBeforeRank0    | 70.532 us                 | 13.960 ms                 |
| AfterBackward             | 12.201 ms                 | 18.454 ms                 |
| BlockToStepN              | 88.467 ms                 | 131.896 ms                |
| OneStep                   | 120.566 ms                | 166.974 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.819 ms                  | 2.774 ms                  |
| ProcessBack:UpdateCache   | 1.112 ms                  | 1.509 ms                  |
| ProcessBack:UpsertPq      | 8.816 ms                  | 14.567 ms                 |
| ProcessOneStep            | 12.180 ms                 | 18.432 ms                 |
| BlockToStepN              | 88.430 ms                 | 131.849 ms                |
+---------------------------+---------------------------+---------------------------+
W20240201 00:30:20.112005 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=484, pq.top=484
W20240201 00:30:21.112010 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=491, pq.top=491
W20240201 00:30:22.112004 3310165 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=498, pq.top=498
[proc 2] 500 steps, total: 13.730, sample: 0.209, forward: 0.342, backward: 0.575, update: 0.198
[proc 0] 500 steps, total: 13.730, sample: 0.319, forward: 0.392, backward: 0.614, update: 0.206
[proc 3] 500 steps, total: 13.730, sample: 0.238, forward: 0.360, backward: 0.570, update: 0.208
[proc 1] 500 steps, total: 13.730, sample: 0.226, forward: 0.356, backward: 0.598, update: 0.200
Successfully xmh. training takes 61.988239765167236 seconds
before call kg_cache_controller.StopThreads()
W20240201 00:30:22.530194 3310165 grad_async_v1.h:243] call StopThreads. PID = 3309825
W20240201 00:30:22.530215 3310165 grad_base.h:212] before processOneStepNegThread_.join();
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240201 00:30:22.538034 3310165 grad_base.h:214] after processOneStepNegThread_.join();
W20240201 00:30:22.538048 3310165 grad_async_v1.h:245] call GradProcessingBase::StopThreads.
W20240201 00:30:22.563278 3310165 grad_async_v1.h:264] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fb41ce9c950>

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240201 01:05:21.715930 3373182 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_262', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [3373182 sampler.py:454] Start PreSampling
WARNING [3373182 sampler.py:532] Before construct renumbering_dict
WARNING [3373182 sampler.py:555] PreSampling done
W20240201 01:05:24.348628 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240201 01:05:24.348882 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240201 01:05:24.348937 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240201 01:05:24.348965 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240201 01:05:24.349010 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240201 01:05:24.349056 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240201 01:05:24.349105 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240201 01:05:24.349130 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240201 01:05:24.349169 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240201 01:05:24.349205 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240201 01:05:24.349238 3373182 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240201 01:05:24.349262 3373182 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240201 01:05:24.349279 3373182 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240201 01:05:24.349390 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240201 01:05:24.349418 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240201 01:05:24.349444 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240201 01:05:24.349481 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240201 01:05:24.349501 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240201 01:05:24.349535 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240201 01:05:24.349571 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240201 01:05:24.349602 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240201 01:05:24.349628 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240201 01:05:24.349671 3373182 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240201 01:05:24.349690 3373182 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240201 01:05:24.349707 3373182 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240201 01:05:24.349738 3373182 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240201 01:05:24.497879 3373182 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000098ca000 22.81 MB
W20240201 01:05:24.524861 3373182 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000af9c000 58.4 kB
{0: Graph(num_nodes=13458, num_edges=276636,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12796, num_edges=383671,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13458 N 276636 E
MertisPartition: part 1 has 12796 N 383671 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  749,   790,   862,  ..., 11932, 12948, 12210]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13458, num_edges=276636,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13458, num_edges=276636,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.838 seconds
INFO [3373397 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3373397 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [3373182 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3373182 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240201 01:05:26.230067 3373420 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240201 01:05:26.230454 3373420 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10000afae000 7.629 MB
W20240201 01:05:26.230607 3373420 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x10000b751000 7.629 MB
W20240201 01:05:26.230666 3373420 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10000bef4000 1.49 GB
W20240201 01:05:26.230695 3373420 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10006b4d7000 1.49 GB
W20240201 01:05:26.230680 3373398 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240201 01:05:26.230736 3373420 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240201 01:05:26.232589 3373398 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000caabc000 7.629 MB
W20240201 01:05:26.232764 3373398 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1000cb25f000 7.629 MB
W20240201 01:05:26.232856 3373398 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000cba02000 1.49 GB
W20240201 01:05:26.232936 3373398 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10012afe5000 1.49 GB
W20240201 01:05:26.233016 3373398 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240201 01:05:26.237975 3373398 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240201 01:05:26.238313 3373420 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
[Rank1] pid = 3373397
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
cudaHostRegister 0x1000098ca000
0: KnownLocalCachedEmbedding init done
WARNING [3373182 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x1000098ca000
1: KnownLocalCachedEmbedding init done
WARNING [3373397 DistTensor.py:59] The tensor name already exists in the kvstore
I20240201 01:05:27.026854 3373420 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240201 01:05:27.027079 3373398 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240201 01:05:27.027940 3373398 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240201 01:05:27.028039 3373398 grad_base.h:184] Init GradProcessingBase done
I20240201 01:05:27.031199 3373398 grad_async_v2.h:42] Use main thread to update emb.
W20240201 01:05:27.031231 3373398 kg_controller.h:78] after init GradAsyncProcessingV2
I20240201 01:05:27.031237 3373398 kg_controller.h:84] Construct KGCacheController done
E20240201 01:05:27.243891 3373420 recstore.cc:66] init folly done
E20240201 01:05:27.244767 3373398 recstore.cc:66] init folly done
I20240201 01:05:27.245278 3373398 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240201 01:05:27.452436 3373658 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240201 01:05:27.452757 3373658 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
I20240201 01:05:27.483376 3373398 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240201 01:05:27.506784 3373420 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
E20240201 01:05:28.953269 3373562 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240201 01:05:28.966564 3373658 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240201 01:05:29.321681 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=11, pq.top=11
E20240201 01:05:29.830229 3373398 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=32, sample_step_cpp_seen_[rank]=31
E20240201 01:05:29.953008 3373658 parallel_pq_v2.h:79] insert failed, size(hashtable)=15
W20240201 01:05:29.971493 3373658 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end8
W20240201 01:05:30.325351 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=49, pq.top=49
E20240201 01:05:30.953044 3373658 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240201 01:05:31.006541 3373658 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
W20240201 01:05:31.337419 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=83, pq.top=83
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 4.382, sample: 0.284, forward: 1.155, backward: 0.743, update: 0.173
train_sampler.Prefill()
-------Step 0-------
tensor([13521, 12682, 13315, 14489,  1346,  1717,  2391, 10491,  1999,  6660]) tensor([  890,  4553,  4046,  6220,  7938,  4603, 11468, 12373,  4934,  9531])
-------Step 1-------
tensor([13521, 12682, 13315, 14489,  1346,  1717,  2391, 10491,  1999,  6660]) tensor([11129,  7678,  8438,  5950, 14555,  1570,  7546,  1820,  1491, 10791])
-------Step 2-------
tensor([  340,  2654, 11262,   178,  7760,  8906,  2080,    16,     0,   128]) tensor([  208,  6404,   652, 12539, 13317, 14317,  9390,  5900,  3706,  3975])
-------Step 3-------
tensor([  340,  2654, 11262,   178,  7760,  8906,  2080,    16,     0,   128]) tensor([ 2372,   452,  2630,  6049,  9962, 14938,  6476,  2013,  9716,  4416])
-------Step 4-------
tensor([ 8430,  6289,  8649, 11987, 14568,  5197,  6568, 13687,   133,  6703]) tensor([ 2907, 12633,  4544,  9198,  4146, 10853,  1804, 12046,  5281, 13086])
-------Step 5-------
tensor([ 8430,  6289,  8649, 11987, 14568,  5197,  6568, 13687,   133,  6703]) tensor([ 5455,  3762,  1002, 11114, 11965,  3170,  5223,  4696, 12386,  5928])
-------Step 6-------
tensor([14538,   175,  8537, 11892,  5201,  6098, 11139,   265, 10348,    23]) tensor([ 9499,  9911,  6085, 12273, 14788,  2331, 13597, 12383, 14786,  8404])
-------Step 7-------
tensor([14538,   175,  8537, 11892,  5201,  6098, 11139,   265, 10348,    23]) tensor([ 1513,  3977, 10598, 14092,  5631, 12811, 12690,  8485, 13074,  4952])
-------Step 8-------
tensor([ 3398, 11754,  9591,     5, 14489,  6566,  2951,   453,  9380, 14083]) tensor([ 2076, 10233,  3363, 12826,  5804,   774,  3236,  8301, 10577,  9868])
-------Step 9-------
tensor([ 3398, 11754,  9591,     5, 14489,  6566,  2951,   453,  9380, 14083]) tensor([ 8764, 12263, 10526, 14114,   679,  2359, 12575,  8314,  7757,  6539])
before start barrier
start train
[proc 0] 100 steps, total: 4.406, sample: 0.356, forward: 1.294, backward: 0.609, update: 0.182
E20240201 01:05:31.953222 3373661 parallel_pq_v2.h:79] insert failed, size(hashtable)=5822
W20240201 01:05:32.019436 3373658 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.254 ms                  | 25.684 ms                 |
| Forward                   | 3.679 ms                  | 18.126 ms                 |
| Backward                  | 2.778 ms                  | 52.129 ms                 |
| Optimize                  | 1.607 ms                  | 3.897 ms                  |
| BarrierTimeBeforeRank0    | 389.667 us                | 6.301 ms                  |
| AfterBackward             | 13.398 ms                 | 41.372 ms                 |
| BlockToStepN              | 675.643 us                | 4.630 ms                  |
| OneStep                   | 27.301 ms                 | 85.454 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 303.558 us                | 3.349 ms                  |
| ProcessBack:Shuffle       | 776.719 us                | 1.848 ms                  |
| ProcessBack:UpdateCache   | 321.904 us                | 1.642 ms                  |
| ProcessBack:UpsertPq      | 10.689 ms                 | 18.830 ms                 |
| ProcessOneStep            | 13.532 ms                 | 41.352 ms                 |
| BlockToStepN              | 706.104 us                | 4.591 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240201 01:05:32.361220 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=114, pq.top=114
E20240201 01:05:32.955339 3373658 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240201 01:05:33.029752 3373658 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
W20240201 01:05:33.379415 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=149, pq.top=149
E20240201 01:05:33.955106 3373675 parallel_pq_v2.h:79] insert failed, size(hashtable)=7002
W20240201 01:05:34.036983 3373658 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240201 01:05:34.381155 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=182, pq.top=182
E20240201 01:05:34.955056 3373673 parallel_pq_v2.h:79] insert failed, size(hashtable)=3972
[proc 1] 200 steps, total: 3.110, sample: 0.305, forward: 0.368, backward: 0.283, update: 0.182
[proc 0] 200 steps, total: 3.110, sample: 0.443, forward: 0.370, backward: 0.261, update: 0.164
W20240201 01:05:35.039942 3373658 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240201 01:05:35.403679 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=213, pq.top=213
E20240201 01:05:35.955010 3373666 parallel_pq_v2.h:79] insert failed, size(hashtable)=273
W20240201 01:05:36.058060 3373658 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240201 01:05:36.422573 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=244, pq.top=244
E20240201 01:05:36.955368 3373668 parallel_pq_v2.h:79] insert failed, size(hashtable)=6872
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.622 ms                  | 24.356 ms                 |
| Forward                   | 3.681 ms                  | 8.390 ms                  |
| Backward                  | 2.683 ms                  | 6.472 ms                  |
| Optimize                  | 1.493 ms                  | 3.624 ms                  |
| BarrierTimeBeforeRank0    | 27.746 us                 | 5.174 ms                  |
| AfterBackward             | 15.230 ms                 | 21.136 ms                 |
| BlockToStepN              | 1.666 ms                  | 5.016 ms                  |
| OneStep                   | 29.138 ms                 | 55.399 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:05:37.071745 3373658 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 298.549 us                | 3.243 ms                  |
| ProcessBack:Shuffle       | 794.694 us                | 1.378 ms                  |
| ProcessBack:UpdateCache   | 292.647 us                | 691.800 us                |
| ProcessBack:UpsertPq      | 12.261 ms                 | 19.167 ms                 |
| ProcessOneStep            | 15.268 ms                 | 21.116 ms                 |
| BlockToStepN              | 1.622 ms                  | 4.966 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240201 01:05:37.429589 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=275, pq.top=275
E20240201 01:05:37.955006 3373562 parallel_pq_v2.h:79] insert failed, size(hashtable)=262
W20240201 01:05:38.077389 3373658 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
[proc 1] 300 steps, total: 3.306, sample: 0.286, forward: 0.359, backward: 0.269, update: 0.156
[proc 0] 300 steps, total: 3.306, sample: 0.402, forward: 0.367, backward: 0.262, update: 0.152
W20240201 01:05:38.431046 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=304, pq.top=304
E20240201 01:05:38.955121 3373658 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240201 01:05:39.084242 3373658 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240201 01:05:39.434700 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=333, pq.top=333
E20240201 01:05:39.955052 3373679 parallel_pq_v2.h:79] insert failed, size(hashtable)=6943
W20240201 01:05:40.100083 3373658 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240201 01:05:40.436148 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=363, pq.top=363
E20240201 01:05:40.955024 3373677 parallel_pq_v2.h:79] insert failed, size(hashtable)=6521
W20240201 01:05:41.120976 3373658 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240201 01:05:41.444440 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=391, pq.top=391
[proc 0] 400 steps, total: 3.471, sample: 0.398, forward: 0.364, backward: 0.265, update: 0.145
[proc 1] 400 steps, total: 3.471, sample: 0.300, forward: 0.350, backward: 0.281, update: 0.155
E20240201 01:05:41.955008 3373562 parallel_pq_v2.h:79] insert failed, size(hashtable)=53
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.736 ms                  | 23.831 ms                 |
| Forward                   | 3.702 ms                  | 7.709 ms                  |
| Backward                  | 2.676 ms                  | 6.272 ms                  |
| Optimize                  | 1.459 ms                  | 3.506 ms                  |
| BarrierTimeBeforeRank0    | 21.671 us                 | 17.031 ms                 |
| AfterBackward             | 16.698 ms                 | 21.488 ms                 |
| BlockToStepN              | 1.934 ms                  | 5.632 ms                  |
| OneStep                   | 30.457 ms                 | 54.972 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240201 01:05:42.121608 3373658 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 290.723 us                | 3.734 ms                  |
| ProcessBack:Shuffle       | 808.648 us                | 1.401 ms                  |
| ProcessBack:UpdateCache   | 281.972 us                | 671.339 us                |
| ProcessBack:UpsertPq      | 13.430 ms                 | 19.274 ms                 |
| ProcessOneStep            | 16.703 ms                 | 21.454 ms                 |
| BlockToStepN              | 1.946 ms                  | 5.592 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240201 01:05:42.452172 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=418, pq.top=418
E20240201 01:05:42.955027 3373672 parallel_pq_v2.h:79] insert failed, size(hashtable)=10905
W20240201 01:05:43.125121 3373658 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
W20240201 01:05:43.481173 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=445, pq.top=445
E20240201 01:05:43.955009 3373562 parallel_pq_v2.h:79] insert failed, size(hashtable)=176
W20240201 01:05:44.146514 3373658 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240201 01:05:44.481894 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=473, pq.top=473
E20240201 01:05:44.962791 3373658 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240201 01:05:45.173534 3373658 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240201 01:05:45.489913 3373398 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=500, pq.top=500
[proc 0] 500 steps, total: 3.715, sample: 0.420, forward: 0.365, backward: 0.267, update: 0.143
[proc 1] 500 steps, total: 3.715, sample: 0.306, forward: 0.353, backward: 0.281, update: 0.160
Successfully xmh. training takes 18.00864315032959 seconds
before call kg_cache_controller.StopThreads()
W20240201 01:05:45.492067 3373398 grad_async_v2.h:84] call StopThreads. PID = 3373182
W20240201 01:05:45.492081 3373398 grad_base.h:212] before processOneStepNegThread_.join();
W20240201 01:05:45.492388 3373398 grad_base.h:214] after processOneStepNegThread_.join();
W20240201 01:05:45.492399 3373398 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240201 01:05:45.493774 3373398 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f321ee846d0>

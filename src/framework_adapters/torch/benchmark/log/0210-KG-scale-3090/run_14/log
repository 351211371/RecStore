WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240211 08:06:57.518641 58185 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_224', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [58185 sampler.py:454] Start PreSampling
WARNING [58185 sampler.py:532] Before construct renumbering_dict
WARNING [58185 sampler.py:555] PreSampling done
W20240211 08:07:02.455440 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240211 08:07:02.455720 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240211 08:07:02.455755 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240211 08:07:02.455785 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240211 08:07:02.455829 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240211 08:07:02.455857 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240211 08:07:02.455883 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240211 08:07:02.455916 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240211 08:07:02.455956 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240211 08:07:02.455988 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240211 08:07:02.456022 58185 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240211 08:07:02.456058 58185 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240211 08:07:02.456084 58185 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240211 08:07:02.456308 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240211 08:07:02.456348 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240211 08:07:02.456386 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240211 08:07:02.456432 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240211 08:07:02.456465 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240211 08:07:02.456501 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240211 08:07:02.456555 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240211 08:07:02.456605 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240211 08:07:02.456634 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240211 08:07:02.456658 58185 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240211 08:07:02.456692 58185 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240211 08:07:02.456715 58185 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240211 08:07:02.456737 58185 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240211 08:07:02.718784 58185 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000098ca000 22.81 MB
W20240211 08:07:02.810052 58185 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000af9c000 58.4 kB
{0: Graph(num_nodes=13804, num_edges=289155,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12626, num_edges=379866,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13804 N 289155 E
MertisPartition: part 1 has 12626 N 379866 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  752,   825,   933,  ...,  9616, 10146, 10332]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.392 seconds
INFO [58185 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [58388 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [58185 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [58388 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
WARNING [58185 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [58388 DistTensor.py:59] The tensor name already exists in the kvstore
I20240211 08:07:04.917714 58448 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240211 08:07:04.918125 58389 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
E20240211 08:07:06.154294 58389 recstore.cc:66] init folly done
E20240211 08:07:06.154296 58448 recstore.cc:66] init folly done
I20240211 08:07:06.250394 58389 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240211 08:07:06.254140 58448 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 689.264 us                | 689.264 us                |
| bucket keys               | 118.683 ms                | 118.683 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 689.264 us                | 689.264 us                |
| bucket keys               | 118.683 ms                | 118.683 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 689.264 us                | 689.264 us                |
| bucket keys               | 118.683 ms                | 118.683 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 689.264 us                | 689.264 us                |
| bucket keys               | 118.683 ms                | 118.683 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 689.264 us                | 689.264 us                |
| bucket keys               | 118.683 ms                | 118.683 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 689.264 us                | 689.264 us                |
| bucket keys               | 118.683 ms                | 118.683 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 689.264 us                | 689.264 us                |
| bucket keys               | 118.683 ms                | 118.683 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.454 ms                  | 4.323 ms                  |
| bucket keys               | 1.474 ms                  | 118.683 ms                |
| forward: a2a keys         | 1.171 ms                  | 37.516 s                  |
| forward: search cache     | 150.492 us                | 20.800 ms                 |
| forward: a2a values       | 770.685 us                | 6.996 ms                  |
| forward: join             | 1.900 ms                  | 3.498 ms                  |
| Forward                   | 22.453 ms                 | 38.128 s                  |
| back: aggr dram keys      | 17.729 ms                 | 210.071 ms                |
| back: set dram grad       | 2.364 ms                  | 3.286 ms                  |
| back: a2a grad            | 1.819 ms                  | 2.139 ms                  |
| back: grad sum & grad cache  | 846.132 us                | 1.469 ms                  |
| Backward                  | 63.428 ms                 | 401.198 ms                |
| Optimize                  | 8.154 ms                  | 9.401 ms                  |
| BarrierTimeBeforeRank0    | 33.013 us                 | 210.116 us                |
| BlockToStepN              | 20.175 us                 | 41.317 us                 |
| OneStep                   | 98.640 ms                 | 38.540 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.197 ms                  | 24.923 ms                 |
| bucket keys               | 1.565 ms                  | 3.909 ms                  |
| forward: a2a keys         | 807.677 us                | 6.892 ms                  |
| forward: search cache     | 165.059 us                | 451.353 us                |
| forward: a2a values       | 762.120 us                | 1.775 ms                  |
| forward: join             | 2.151 ms                  | 5.260 ms                  |
| Forward                   | 16.968 ms                 | 24.157 ms                 |
| back: aggr dram keys      | 18.943 ms                 | 37.005 ms                 |
| back: set dram grad       | 2.497 ms                  | 5.556 ms                  |
| back: a2a grad            | 1.888 ms                  | 3.000 ms                  |
| back: grad sum & grad cache  | 1.351 ms                  | 2.777 ms                  |
| Backward                  | 57.717 ms                 | 86.595 ms                 |
| Optimize                  | 15.289 ms                 | 23.190 ms                 |
| BarrierTimeBeforeRank0    | 65.986 us                 | 210.116 us                |
| BlockToStepN              | 20.097 us                 | 169.263 us                |
| OneStep                   | 94.094 ms                 | 149.592 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 47.969, sample: 0.453, forward: 39.799, backward: 6.112, update: 0.251
[Rank1] pid = 58388
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
train_sampler.Prefill()
-------Step 0-------
tensor([  191,  4775,  8442,  8731,  3191, 14902,  3499,  8022,  6165,  7574]) tensor([  967,  8098, 10152, 12167, 14575,  7053,  5770,   394,  7176, 10635])
-------Step 1-------
tensor([  191,  4775,  8442,  8731,  3191, 14902,  3499,  8022,  6165,  7574]) tensor([14043,  1818,  2043,  4090,  7369, 12591, 11969,  8971, 10256,  4524])
-------Step 2-------
tensor([14902,    12,    50,   175,  5760,  6575,  1758, 13223, 11064, 10078]) tensor([ 2420,  2372, 14709, 13153,  5677,  6656, 11034,  1838,  6585,  5998])
-------Step 3-------
tensor([14902,    12,    50,   175,  5760,  6575,  1758, 13223, 11064, 10078]) tensor([12469,  1938,   336,  4783,  5451,  9839,  3100,   839, 13006, 14093])
-------Step 4-------
tensor([ 2889,  2058,   108,  1905,  7418,  6303, 11364,  9711,    89,  7007]) tensor([ 6593, 12656, 10442,  7320, 10628,  7026,  7655,  7683,  4405,  7305])
-------Step 5-------
tensor([ 2889,  2058,   108,  1905,  7418,  6303, 11364,  9711,    89,  7007]) tensor([10468,  2763, 13405,  5485,  3418,  8616,    56,   790,  6304,  8605])
-------Step 6-------
tensor([ 5833,  3798,  7448,   209,  1316,   131, 14902,  7934,   124,   314]) tensor([11188, 14415,  8978,  7441,   911,  5923,  4520, 14355, 14859, 10622])
-------Step 7-------
tensor([ 5833,  3798,  7448,   209,  1316,   131, 14902,  7934,   124,   314]) tensor([ 7081,  1828, 13042, 11337, 12984,  7912,  1875,   535,    35,  6853])
-------Step 8-------
tensor([ 5228,  8377,  5329,  2331,  4775,  5162,  5760,  2889, 11834, 13639]) tensor([13920,  6078, 14779,  5385,  5408,  7605,  2876,  8707, 12657, 10955])
-------Step 9-------
tensor([ 5228,  8377,  5329,  2331,  4775,  5162,  5760,  2889, 11834, 13639]) tensor([ 4002,  8712, 13353, 12242, 14130,  4587,  2643,  8971, 11788,  3548])
before start barrier
start train
[proc 0] 100 steps, total: 47.972, sample: 0.492, forward: 39.789, backward: 6.163, update: 1.433
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.098 ms                  | 26.743 ms                 |
| bucket keys               | 1.570 ms                  | 3.264 ms                  |
| forward: a2a keys         | 818.961 us                | 5.445 ms                  |
| forward: search cache     | 159.983 us                | 451.353 us                |
| forward: a2a values       | 769.502 us                | 1.775 ms                  |
| forward: join             | 2.100 ms                  | 5.260 ms                  |
| Forward                   | 16.827 ms                 | 24.157 ms                 |
| back: aggr dram keys      | 18.974 ms                 | 35.331 ms                 |
| back: set dram grad       | 2.564 ms                  | 5.740 ms                  |
| back: a2a grad            | 1.819 ms                  | 2.981 ms                  |
| back: grad sum & grad cache  | 1.312 ms                  | 2.404 ms                  |
| Backward                  | 57.640 ms                 | 86.595 ms                 |
| Optimize                  | 13.931 ms                 | 23.190 ms                 |
| BarrierTimeBeforeRank0    | 62.580 us                 | 210.116 us                |
| BlockToStepN              | 21.532 us                 | 169.263 us                |
| OneStep                   | 92.830 ms                 | 149.592 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.118 ms                  | 26.747 ms                 |
| bucket keys               | 1.574 ms                  | 3.264 ms                  |
| forward: a2a keys         | 836.354 us                | 5.445 ms                  |
| forward: search cache     | 161.817 us                | 314.299 us                |
| forward: a2a values       | 770.685 us                | 1.424 ms                  |
| forward: join             | 2.100 ms                  | 4.104 ms                  |
| Forward                   | 16.944 ms                 | 23.415 ms                 |
| back: aggr dram keys      | 19.052 ms                 | 35.002 ms                 |
| back: set dram grad       | 2.570 ms                  | 5.740 ms                  |
| back: a2a grad            | 1.742 ms                  | 4.135 ms                  |
| back: grad sum & grad cache  | 1.270 ms                  | 2.315 ms                  |
| Backward                  | 58.178 ms                 | 74.834 ms                 |
| Optimize                  | 13.894 ms                 | 22.016 ms                 |
| BarrierTimeBeforeRank0    | 60.459 us                 | 193.031 us                |
| BlockToStepN              | 22.542 us                 | 169.263 us                |
| OneStep                   | 93.703 ms                 | 122.734 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 9.519, sample: 0.511, forward: 1.712, backward: 5.844, update: 1.364
[proc 1] 200 steps, total: 9.519, sample: 0.502, forward: 1.704, backward: 5.802, update: 0.269
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.118 ms                  | 26.747 ms                 |
| bucket keys               | 1.572 ms                  | 3.704 ms                  |
| forward: a2a keys         | 873.309 us                | 6.297 ms                  |
| forward: search cache     | 161.582 us                | 266.973 us                |
| forward: a2a values       | 771.872 us                | 1.416 ms                  |
| forward: join             | 2.108 ms                  | 4.268 ms                  |
| Forward                   | 16.992 ms                 | 23.977 ms                 |
| back: aggr dram keys      | 19.016 ms                 | 35.002 ms                 |
| back: set dram grad       | 2.564 ms                  | 5.740 ms                  |
| back: a2a grad            | 1.734 ms                  | 3.789 ms                  |
| back: grad sum & grad cache  | 1.270 ms                  | 2.207 ms                  |
| Backward                  | 57.640 ms                 | 81.256 ms                 |
| Optimize                  | 13.788 ms                 | 22.016 ms                 |
| BarrierTimeBeforeRank0    | 60.261 us                 | 193.031 us                |
| BlockToStepN              | 22.834 us                 | 196.491 us                |
| OneStep                   | 92.561 ms                 | 122.734 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.134 ms                  | 26.747 ms                 |
| bucket keys               | 1.567 ms                  | 3.830 ms                  |
| forward: a2a keys         | 881.328 us                | 5.839 ms                  |
| forward: search cache     | 161.817 us                | 294.548 us                |
| forward: a2a values       | 769.568 us                | 1.406 ms                  |
| forward: join             | 2.101 ms                  | 4.104 ms                  |
| Forward                   | 17.111 ms                 | 23.415 ms                 |
| back: aggr dram keys      | 18.943 ms                 | 35.488 ms                 |
| back: set dram grad       | 2.556 ms                  | 5.903 ms                  |
| back: a2a grad            | 1.724 ms                  | 3.789 ms                  |
| back: grad sum & grad cache  | 1.270 ms                  | 2.315 ms                  |
| Backward                  | 57.564 ms                 | 78.909 ms                 |
| Optimize                  | 13.788 ms                 | 21.932 ms                 |
| BarrierTimeBeforeRank0    | 59.611 us                 | 152.485 us                |
| BlockToStepN              | 22.834 us                 | 169.263 us                |
| OneStep                   | 91.853 ms                 | 124.431 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 9.362, sample: 0.437, forward: 1.718, backward: 5.651, update: 0.245
[proc 0] 300 steps, total: 9.362, sample: 0.474, forward: 1.702, backward: 5.702, update: 1.392
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.158 ms                  | 26.784 ms                 |
| bucket keys               | 1.567 ms                  | 3.704 ms                  |
| forward: a2a keys         | 836.549 us                | 6.785 ms                  |
| forward: search cache     | 162.937 us                | 294.548 us                |
| forward: a2a values       | 769.502 us                | 1.406 ms                  |
| forward: join             | 2.108 ms                  | 4.268 ms                  |
| Forward                   | 17.039 ms                 | 24.157 ms                 |
| back: aggr dram keys      | 19.016 ms                 | 35.435 ms                 |
| back: set dram grad       | 2.544 ms                  | 5.740 ms                  |
| back: a2a grad            | 1.720 ms                  | 4.010 ms                  |
| back: grad sum & grad cache  | 1.270 ms                  | 2.207 ms                  |
| Backward                  | 57.717 ms                 | 78.909 ms                 |
| Optimize                  | 13.851 ms                 | 21.932 ms                 |
| BarrierTimeBeforeRank0    | 59.292 us                 | 152.485 us                |
| BlockToStepN              | 21.969 us                 | 196.491 us                |
| OneStep                   | 92.311 ms                 | 132.758 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.134 ms                  | 26.784 ms                 |
| bucket keys               | 1.567 ms                  | 3.475 ms                  |
| forward: a2a keys         | 837.666 us                | 6.785 ms                  |
| forward: search cache     | 163.038 us                | 266.973 us                |
| forward: a2a values       | 769.502 us                | 1.416 ms                  |
| forward: join             | 2.108 ms                  | 4.104 ms                  |
| Forward                   | 16.993 ms                 | 23.977 ms                 |
| back: aggr dram keys      | 18.896 ms                 | 35.331 ms                 |
| back: set dram grad       | 2.544 ms                  | 5.740 ms                  |
| back: a2a grad            | 1.724 ms                  | 4.010 ms                  |
| back: grad sum & grad cache  | 1.270 ms                  | 2.199 ms                  |
| Backward                  | 57.640 ms                 | 75.867 ms                 |
| Optimize                  | 13.833 ms                 | 21.614 ms                 |
| BarrierTimeBeforeRank0    | 58.895 us                 | 123.061 us                |
| BlockToStepN              | 22.114 us                 | 169.263 us                |
| OneStep                   | 91.982 ms                 | 125.767 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 9.543, sample: 0.483, forward: 1.697, backward: 5.903, update: 1.368
[proc 1] 400 steps, total: 9.543, sample: 0.459, forward: 1.711, backward: 5.854, update: 0.274
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.135 ms                  | 27.077 ms                 |
| bucket keys               | 1.570 ms                  | 3.475 ms                  |
| forward: a2a keys         | 850.488 us                | 6.785 ms                  |
| forward: search cache     | 163.038 us                | 260.892 us                |
| forward: a2a values       | 769.568 us                | 1.538 ms                  |
| forward: join             | 2.108 ms                  | 4.268 ms                  |
| Forward                   | 16.992 ms                 | 24.157 ms                 |
| back: aggr dram keys      | 19.016 ms                 | 35.250 ms                 |
| back: set dram grad       | 2.541 ms                  | 5.648 ms                  |
| back: a2a grad            | 1.719 ms                  | 4.010 ms                  |
| back: grad sum & grad cache  | 1.270 ms                  | 2.195 ms                  |
| Backward                  | 57.640 ms                 | 78.909 ms                 |
| Optimize                  | 13.835 ms                 | 21.614 ms                 |
| BarrierTimeBeforeRank0    | 58.900 us                 | 126.164 us                |
| BlockToStepN              | 22.147 us                 | 213.698 us                |
| OneStep                   | 92.368 ms                 | 128.395 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.126 ms                  | 28.244 ms                 |
| bucket keys               | 1.570 ms                  | 3.436 ms                  |
| forward: a2a keys         | 850.488 us                | 6.371 ms                  |
| forward: search cache     | 162.937 us                | 259.664 us                |
| forward: a2a values       | 780.984 us                | 1.538 ms                  |
| forward: join             | 2.108 ms                  | 4.012 ms                  |
| Forward                   | 16.993 ms                 | 24.157 ms                 |
| back: aggr dram keys      | 18.974 ms                 | 35.002 ms                 |
| back: set dram grad       | 2.556 ms                  | 5.556 ms                  |
| back: a2a grad            | 1.717 ms                  | 3.000 ms                  |
| back: grad sum & grad cache  | 1.270 ms                  | 2.185 ms                  |
| Backward                  | 57.390 ms                 | 75.867 ms                 |
| Optimize                  | 13.752 ms                 | 21.574 ms                 |
| BarrierTimeBeforeRank0    | 58.459 us                 | 126.164 us                |
| BlockToStepN              | 21.969 us                 | 196.491 us                |
| OneStep                   | 92.115 ms                 | 128.395 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 9.266, sample: 0.431, forward: 1.740, backward: 5.587, update: 0.253
[proc 0] 500 steps, total: 9.266, sample: 0.486, forward: 1.686, backward: 5.651, update: 1.348
Successfully xmh. training takes 85.66235327720642 seconds
before call kg_cache_controller.StopThreads()
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads
INFO [58185 controller_process.py:421] call rank0 to StopThreads

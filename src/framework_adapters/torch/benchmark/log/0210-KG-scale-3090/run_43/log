WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240212 01:01:55.685426 43370 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_102', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [43370 sampler.py:454] Start PreSampling
WARNING [43370 sampler.py:532] Before construct renumbering_dict
WARNING [43370 sampler.py:555] PreSampling done
W20240212 01:02:00.520732 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240212 01:02:00.520992 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240212 01:02:00.521034 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240212 01:02:00.521075 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240212 01:02:00.521123 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240212 01:02:00.521164 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240212 01:02:00.521206 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240212 01:02:00.521255 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240212 01:02:00.521288 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240212 01:02:00.521322 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240212 01:02:00.521369 43370 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240212 01:02:00.521404 43370 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240212 01:02:00.521432 43370 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240212 01:02:00.521591 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240212 01:02:00.521633 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240212 01:02:00.521677 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240212 01:02:00.521724 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240212 01:02:00.521764 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240212 01:02:00.521806 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240212 01:02:00.521844 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240212 01:02:00.521885 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240212 01:02:00.521941 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240212 01:02:00.521976 43370 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240212 01:02:00.522011 43370 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240212 01:02:00.522042 43370 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240212 01:02:00.522070 43370 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240212 01:02:00.794070 43370 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000098ca000 22.81 MB
W20240212 01:02:00.885288 43370 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000af9c000 58.4 kB
{0: Graph(num_nodes=13804, num_edges=289155,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12626, num_edges=379866,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13804 N 289155 E
MertisPartition: part 1 has 12626 N 379866 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  748,   805,   845,  ..., 10192, 11112, 10883]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.300 seconds
INFO [43370 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [43370 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [43573 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [43573 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
WARNING [43573 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [43370 DistTensor.py:59] The tensor name already exists in the kvstore
I20240212 01:02:04.552651 43574 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240212 01:02:04.553222 43601 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
E20240212 01:02:04.779790 43574 recstore.cc:66] init folly done
E20240212 01:02:04.779803 43601 recstore.cc:66] init folly done
I20240212 01:02:04.871273 43601 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240212 01:02:04.873481 43574 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.171 us                | 709.171 us                |
| bucket keys               | 138.293 ms                | 138.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.171 us                | 709.171 us                |
| bucket keys               | 138.293 ms                | 138.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.171 us                | 709.171 us                |
| bucket keys               | 138.293 ms                | 138.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.171 us                | 709.171 us                |
| bucket keys               | 138.293 ms                | 138.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.171 us                | 709.171 us                |
| bucket keys               | 138.293 ms                | 138.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.171 us                | 709.171 us                |
| bucket keys               | 138.293 ms                | 138.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 709.171 us                | 709.171 us                |
| bucket keys               | 138.293 ms                | 138.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.130 ms                  | 27.184 ms                 |
| bucket keys               | 1.686 ms                  | 138.293 ms                |
| forward: a2a keys         | 782.630 us                | 37.014 s                  |
| forward: search cache     | 169.183 us                | 21.289 ms                 |
| forward: a2a values       | 863.733 us                | 9.679 ms                  |
| forward: join             | 2.212 ms                  | 4.052 ms                  |
| Forward                   | 17.399 ms                 | 37.445 s                  |
| back: aggr dram keys      | 24.308 ms                 | 173.718 ms                |
| back: set dram grad       | 2.073 ms                  | 4.489 ms                  |
| back: a2a grad            | 1.559 ms                  | 4.512 ms                  |
| back: grad sum & grad cache  | 890.544 us                | 2.194 ms                  |
| Backward                  | 63.232 ms                 | 365.923 ms                |
| Optimize                  | 15.763 ms                 | 42.510 ms                 |
| BarrierTimeBeforeRank0    | 70.758 us                 | 2.192 ms                  |
| BlockToStepN              | 24.574 us                 | 57.375 us                 |
| OneStep                   | 101.667 ms                | 37.857 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.130 ms                  | 27.184 ms                 |
| bucket keys               | 1.599 ms                  | 3.303 ms                  |
| forward: a2a keys         | 782.630 us                | 2.576 ms                  |
| forward: search cache     | 169.183 us                | 278.278 us                |
| forward: a2a values       | 768.128 us                | 2.568 ms                  |
| forward: join             | 2.217 ms                  | 5.124 ms                  |
| Forward                   | 17.258 ms                 | 22.513 ms                 |
| back: aggr dram keys      | 24.308 ms                 | 34.568 ms                 |
| back: set dram grad       | 2.092 ms                  | 4.489 ms                  |
| back: a2a grad            | 1.553 ms                  | 2.760 ms                  |
| back: grad sum & grad cache  | 1.304 ms                  | 2.244 ms                  |
| Backward                  | 62.359 ms                 | 74.657 ms                 |
| Optimize                  | 15.510 ms                 | 41.003 ms                 |
| BarrierTimeBeforeRank0    | 56.836 us                 | 113.972 us                |
| BlockToStepN              | 22.751 us                 | 62.497 us                 |
| OneStep                   | 99.933 ms                 | 131.939 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 48.020, sample: 0.440, forward: 39.167, backward: 6.592, update: 0.321
[Rank1] pid = 43573
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
train_sampler.Prefill()
-------Step 0-------
tensor([  338,  5942,  8971,  7273,  2633, 13612,  3657,  7069,  6629,  7414]) tensor([  847, 10225, 10842, 14035, 14221,  5981,  6046,   404,  5231,  9954])
-------Step 1-------
tensor([  338,  5942,  8971,  7273,  2633, 13612,  3657,  7069,  6629,  7414]) tensor([14774,  1826,  2028,  4176,  7776, 12177, 11546,  8799, 10804,  4386])
-------Step 2-------
tensor([13612,     9,    61,   191,  6201,  6545,  1485, 11072,  8266, 10614]) tensor([ 1890,  2186, 13727,  9667,  4893,  7079, 13687,  1938,  5883,  5935])
-------Step 3-------
tensor([13612,     9,    61,   191,  6201,  6545,  1485, 11072,  8266, 10614]) tensor([14620,  2335,   262,  5905,  5841, 11493,  3182,   827, 13910, 11918])
-------Step 4-------
tensor([ 2676,  2219,   149,  1626,  8191,  6387, 10063,  9505,    20,  5812]) tensor([ 5498, 13177,  7619, 10424, 11183,  5130,  6311,  9614,  4655,  7939])
-------Step 5-------
tensor([ 2676,  2219,   149,  1626,  8191,  6387, 10063,  9505,    20,  5812]) tensor([ 7781,  2938, 10650,  5215,  3450, 12322,    46,   804,  5533,  7101])
-------Step 6-------
tensor([ 6273,  3494,  7073,   210,  1228,    97, 13612,  7800,   229,   371]) tensor([12552, 13149,  7410,  7866,   883,  6150,  4518, 14244, 13783, 10387])
-------Step 7-------
tensor([ 6273,  3494,  7073,   210,  1228,    97, 13612,  7800,   229,   371]) tensor([ 7419,  1995, 14733, 11929, 13655,  8030,  1963,   614,    37,  7178])
-------Step 8-------
tensor([ 5233,  9111,  5746,  2026,  5942,  5900,  6201,  2676, 12162, 13649]) tensor([12273,  6551, 13580,  5265,  5725,  8407,  2368,  8233,  9152, 12039])
-------Step 9-------
tensor([ 5233,  9111,  5746,  2026,  5942,  5900,  6201,  2676, 12162, 13649]) tensor([ 4038,  9226, 11209, 14561, 12602,  4611,  2463,  8799, 13640,  3655])
before start barrier
start train
[proc 0] 100 steps, total: 48.018, sample: 0.503, forward: 39.138, backward: 6.639, update: 1.635
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.197 ms                  | 27.691 ms                 |
| bucket keys               | 1.622 ms                  | 3.471 ms                  |
| forward: a2a keys         | 761.345 us                | 2.511 ms                  |
| forward: search cache     | 170.448 us                | 278.278 us                |
| forward: a2a values       | 764.669 us                | 2.568 ms                  |
| forward: join             | 2.217 ms                  | 4.562 ms                  |
| Forward                   | 17.313 ms                 | 22.513 ms                 |
| back: aggr dram keys      | 24.308 ms                 | 36.416 ms                 |
| back: set dram grad       | 2.077 ms                  | 5.851 ms                  |
| back: a2a grad            | 1.589 ms                  | 2.760 ms                  |
| back: grad sum & grad cache  | 1.280 ms                  | 2.244 ms                  |
| Backward                  | 62.969 ms                 | 79.811 ms                 |
| Optimize                  | 14.716 ms                 | 41.003 ms                 |
| BarrierTimeBeforeRank0    | 58.112 us                 | 113.972 us                |
| BlockToStepN              | 22.245 us                 | 143.348 us                |
| OneStep                   | 99.928 ms                 | 131.939 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.223 ms                  | 27.691 ms                 |
| bucket keys               | 1.611 ms                  | 3.406 ms                  |
| forward: a2a keys         | 803.382 us                | 2.511 ms                  |
| forward: search cache     | 171.394 us                | 267.108 us                |
| forward: a2a values       | 759.593 us                | 1.465 ms                  |
| forward: join             | 2.246 ms                  | 4.562 ms                  |
| Forward                   | 17.436 ms                 | 22.513 ms                 |
| back: aggr dram keys      | 20.267 ms                 | 36.416 ms                 |
| back: set dram grad       | 2.078 ms                  | 4.584 ms                  |
| back: a2a grad            | 1.637 ms                  | 2.770 ms                  |
| back: grad sum & grad cache  | 1.274 ms                  | 2.527 ms                  |
| Backward                  | 62.883 ms                 | 76.018 ms                 |
| Optimize                  | 14.786 ms                 | 31.915 ms                 |
| BarrierTimeBeforeRank0    | 57.596 us                 | 109.317 us                |
| BlockToStepN              | 21.327 us                 | 150.323 us                |
| OneStep                   | 99.690 ms                 | 129.475 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 9.845, sample: 0.521, forward: 1.745, backward: 5.971, update: 1.506
[proc 1] 200 steps, total: 9.845, sample: 0.454, forward: 1.787, backward: 5.924, update: 0.274
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.148 ms                  | 27.691 ms                 |
| bucket keys               | 1.599 ms                  | 3.406 ms                  |
| forward: a2a keys         | 868.585 us                | 5.256 ms                  |
| forward: search cache     | 169.552 us                | 264.430 us                |
| forward: a2a values       | 761.926 us                | 1.465 ms                  |
| forward: join             | 2.173 ms                  | 4.551 ms                  |
| Forward                   | 17.580 ms                 | 22.513 ms                 |
| back: aggr dram keys      | 18.806 ms                 | 35.812 ms                 |
| back: set dram grad       | 2.141 ms                  | 4.584 ms                  |
| back: a2a grad            | 1.698 ms                  | 4.113 ms                  |
| back: grad sum & grad cache  | 1.274 ms                  | 2.244 ms                  |
| Backward                  | 61.845 ms                 | 76.018 ms                 |
| Optimize                  | 14.577 ms                 | 31.915 ms                 |
| BarrierTimeBeforeRank0    | 55.709 us                 | 109.317 us                |
| BlockToStepN              | 22.507 us                 | 173.064 us                |
| OneStep                   | 98.252 ms                 | 129.475 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.142 ms                  | 27.691 ms                 |
| bucket keys               | 1.604 ms                  | 3.401 ms                  |
| forward: a2a keys         | 920.307 us                | 5.256 ms                  |
| forward: search cache     | 168.697 us                | 264.430 us                |
| forward: a2a values       | 766.258 us                | 1.465 ms                  |
| forward: join             | 2.152 ms                  | 4.551 ms                  |
| Forward                   | 17.772 ms                 | 22.513 ms                 |
| back: aggr dram keys      | 18.730 ms                 | 35.440 ms                 |
| back: set dram grad       | 2.162 ms                  | 4.970 ms                  |
| back: a2a grad            | 1.719 ms                  | 4.017 ms                  |
| back: grad sum & grad cache  | 1.274 ms                  | 2.244 ms                  |
| Backward                  | 60.499 ms                 | 74.657 ms                 |
| Optimize                  | 14.496 ms                 | 24.894 ms                 |
| BarrierTimeBeforeRank0    | 55.195 us                 | 104.558 us                |
| BlockToStepN              | 23.335 us                 | 150.323 us                |
| OneStep                   | 97.201 ms                 | 128.094 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 300 steps, total: 9.163, sample: 0.459, forward: 1.881, backward: 5.465, update: 1.272
[proc 1] 300 steps, total: 9.163, sample: 0.518, forward: 1.839, backward: 5.382, update: 0.323
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.119 ms                  | 28.180 ms                 |
| bucket keys               | 1.604 ms                  | 3.401 ms                  |
| forward: a2a keys         | 945.916 us                | 7.122 ms                  |
| forward: search cache     | 167.530 us                | 264.227 us                |
| forward: a2a values       | 769.729 us                | 1.465 ms                  |
| forward: join             | 2.132 ms                  | 4.418 ms                  |
| Forward                   | 17.952 ms                 | 24.057 ms                 |
| back: aggr dram keys      | 18.730 ms                 | 34.938 ms                 |
| back: set dram grad       | 2.170 ms                  | 4.584 ms                  |
| back: a2a grad            | 1.727 ms                  | 3.971 ms                  |
| back: grad sum & grad cache  | 1.274 ms                  | 2.244 ms                  |
| Backward                  | 59.701 ms                 | 74.657 ms                 |
| Optimize                  | 14.336 ms                 | 24.894 ms                 |
| BarrierTimeBeforeRank0    | 54.445 us                 | 104.558 us                |
| BlockToStepN              | 24.574 us                 | 150.323 us                |
| OneStep                   | 96.115 ms                 | 128.094 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.100 ms                  | 27.691 ms                 |
| bucket keys               | 1.604 ms                  | 3.401 ms                  |
| forward: a2a keys         | 955.424 us                | 7.747 ms                  |
| forward: search cache     | 165.198 us                | 262.991 us                |
| forward: a2a values       | 768.854 us                | 1.465 ms                  |
| forward: join             | 2.138 ms                  | 4.379 ms                  |
| Forward                   | 17.971 ms                 | 24.057 ms                 |
| back: aggr dram keys      | 18.779 ms                 | 34.882 ms                 |
| back: set dram grad       | 2.166 ms                  | 4.489 ms                  |
| back: a2a grad            | 1.722 ms                  | 3.971 ms                  |
| back: grad sum & grad cache  | 1.274 ms                  | 2.194 ms                  |
| Backward                  | 59.442 ms                 | 73.441 ms                 |
| Optimize                  | 14.170 ms                 | 23.961 ms                 |
| BarrierTimeBeforeRank0    | 53.419 us                 | 104.497 us                |
| BlockToStepN              | 24.379 us                 | 150.323 us                |
| OneStep                   | 95.765 ms                 | 128.032 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 9.354, sample: 0.448, forward: 1.836, backward: 5.702, update: 1.280
[proc 1] 400 steps, total: 9.354, sample: 0.526, forward: 1.777, backward: 5.622, update: 0.317
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.081 ms                  | 27.691 ms                 |
| bucket keys               | 1.601 ms                  | 3.401 ms                  |
| forward: a2a keys         | 974.537 us                | 7.763 ms                  |
| forward: search cache     | 159.843 us                | 262.768 us                |
| forward: a2a values       | 771.327 us                | 1.472 ms                  |
| forward: join             | 2.130 ms                  | 4.245 ms                  |
| Forward                   | 18.083 ms                 | 24.057 ms                 |
| back: aggr dram keys      | 18.784 ms                 | 34.868 ms                 |
| back: set dram grad       | 2.170 ms                  | 4.375 ms                  |
| back: a2a grad            | 1.729 ms                  | 3.971 ms                  |
| back: grad sum & grad cache  | 1.274 ms                  | 2.049 ms                  |
| Backward                  | 58.989 ms                 | 73.441 ms                 |
| Optimize                  | 14.089 ms                 | 23.961 ms                 |
| BarrierTimeBeforeRank0    | 52.349 us                 | 104.497 us                |
| BlockToStepN              | 25.201 us                 | 173.064 us                |
| OneStep                   | 95.198 ms                 | 128.032 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.081 ms                  | 28.352 ms                 |
| bucket keys               | 1.600 ms                  | 3.401 ms                  |
| forward: a2a keys         | 990.495 us                | 8.037 ms                  |
| forward: search cache     | 159.434 us                | 262.768 us                |
| forward: a2a values       | 769.561 us                | 1.472 ms                  |
| forward: join             | 2.144 ms                  | 4.162 ms                  |
| Forward                   | 18.113 ms                 | 24.057 ms                 |
| back: aggr dram keys      | 18.784 ms                 | 34.868 ms                 |
| back: set dram grad       | 2.159 ms                  | 4.375 ms                  |
| back: a2a grad            | 1.728 ms                  | 3.971 ms                  |
| back: grad sum & grad cache  | 1.266 ms                  | 2.049 ms                  |
| Backward                  | 59.289 ms                 | 73.441 ms                 |
| Optimize                  | 14.018 ms                 | 22.416 ms                 |
| BarrierTimeBeforeRank0    | 51.958 us                 | 104.497 us                |
| BlockToStepN              | 25.273 us                 | 150.323 us                |
| OneStep                   | 95.238 ms                 | 128.094 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 9.682, sample: 0.522, forward: 1.812, backward: 5.907, update: 0.327
[proc 0] 500 steps, total: 9.682, sample: 0.480, forward: 1.845, backward: 5.982, update: 1.290
Successfully xmh. training takes 86.06251263618469 seconds
before call kg_cache_controller.StopThreads()
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads
INFO [43370 controller_process.py:421] call rank0 to StopThreads

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7ff3a9d68ee0>==========
Worker 0 pid=21120
Worker 1 pid=21121
Worker 2 pid=21122
Worker 3 pid=21123
Worker 4 pid=21124
Worker 5 pid=21125
Worker 6 pid=21126
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
Step99:rank5, time: 31.724, per_step: 0.317244
Step99:rank1, time: 31.546, per_step: 0.315462
Step99:rank7, time: 31.699, per_step: 0.316990
Step99:rank4, time: 31.949, per_step: 0.319490
Step99:rank3, time: 31.591, per_step: 0.315912
Step99:rank2, time: 31.648, per_step: 0.316476
Step99:rank6, time: 31.565, per_step: 0.315650
Step99:rank0, time: 31.750, per_step: 0.317496
Step199:rank5, time: 29.774, per_step: 0.294794
Step199:rank2, time: 29.765, per_step: 0.294699
Step199:rank7, time: 29.770, per_step: 0.294752
Step199:rank6, time: 29.766, per_step: 0.294711
Step199:rank1, time: 29.780, per_step: 0.294855
Step199:rank4, time: 29.778, per_step: 0.294836
Step199:rank3, time: 29.784, per_step: 0.294887
Step199:rank0, time: 29.824, per_step: 0.295283
Step299:rank7, time: 29.699, per_step: 0.294052
Step299:rank3, time: 29.684, per_step: 0.293905
Step299:rank4, time: 29.692, per_step: 0.293980
Step299:rank2, time: 29.707, per_step: 0.294127
Step299:rank5, time: 29.723, per_step: 0.294287
Step299:rank6, time: 29.719, per_step: 0.294252
Step299:rank1, time: 29.728, per_step: 0.294338
Step299:rank0, time: 29.715, per_step: 0.294205
Step399:rank5, time: 30.419, per_step: 0.301182
Step399:rank3, time: 30.439, per_step: 0.301374
Step399:rank7, time: 30.440, per_step: 0.301387
Step399:rank6, time: 30.413, per_step: 0.301117
Step399:rank4, time: 30.439, per_step: 0.301372
Step399:rank1, time: 30.406, per_step: 0.301047
Step399:rank2, time: 30.451, per_step: 0.301491
Step399:rank0, time: 30.401, per_step: 0.300996
Step499:rank3, time: 30.450, per_step: 0.301488
Step499:rank5, time: 30.453, per_step: 0.301514
Step499:rank2, time: 30.440, per_step: 0.301385
Step499:rank7, time: 30.455, per_step: 0.301538
Step499:rank6, time: 30.456, per_step: 0.301542
Step499:rank4, time: 30.458, per_step: 0.301568
Step499:rank1, time: 30.466, per_step: 0.301641
Step499:rank0, time: 30.482, per_step: 0.301801
Worker 7 pid=21133
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f46c1ef5e50>==========
Worker 0 pid=45529
Worker 1 pid=45530
Worker 2 pid=45531
Worker 3 pid=45532
Worker 4 pid=45533
Worker 5 pid=45540
Worker 6 pid=45541
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank2, time: 0.084, per_step: 0.000837
 14%|█▍        | 145/1000 [00:00<00:00, 1263.74it/s]Step199:rank2, time: 0.078, per_step: 0.000769
Step299:rank2, time: 0.058, per_step: 0.000571
 32%|███▏      | 320/1000 [00:00<00:00, 1532.27it/s]Step399:rank2, time: 0.041, per_step: 0.000409
Step499:rank2, time: 0.045, per_step: 0.000448
 55%|█████▌    | 554/1000 [00:00<00:00, 1886.39it/s]Step599:rank2, time: 0.041, per_step: 0.000406
Step699:rank2, time: 0.041, per_step: 0.000403
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
 77%|███████▋  | 774/1000 [00:00<00:00, 2007.37it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step799:rank2, time: 0.241, per_step: 0.002388
  3%|▎         | 31/1000 [00:00<00:03, 308.69it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  2%|▏         | 24/1000 [00:00<00:04, 201.45it/s]  2%|▏         | 21/1000 [00:00<00:05, 184.14it/s]  3%|▎         | 30/1000 [00:00<00:03, 299.34it/s]  2%|▏         | 15/1000 [00:00<00:06, 146.75it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  4%|▎         | 37/1000 [00:00<00:02, 360.04it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  5%|▍         | 49/1000 [00:00<00:04, 218.02it/s]  6%|▋         | 63/1000 [00:00<00:03, 290.74it/s]  5%|▌         | 53/1000 [00:00<00:03, 258.82it/s]Step99:rank7, time: 0.320, per_step: 0.003201
  8%|▊         | 77/1000 [00:00<00:02, 357.24it/s]  5%|▍         | 47/1000 [00:00<00:03, 247.54it/s]Step99:rank6, time: 0.399, per_step: 0.003987
Step899:rank2, time: 0.195, per_step: 0.001929
Step99:rank4, time: 0.297, per_step: 0.002971
  7%|▋         | 71/1000 [00:00<00:01, 709.77it/s] 10%|▉         | 97/1000 [00:00<00:02, 325.40it/s] 18%|█▊        | 182/1000 [00:00<00:01, 681.83it/s]  8%|▊         | 78/1000 [00:00<00:02, 358.40it/s]Step99:rank5, time: 0.392, per_step: 0.003922
Step99:rank0, time: 0.127, per_step: 0.001273
Step199:rank7, time: 0.067, per_step: 0.000663
Step99:rank3, time: 0.400, per_step: 0.003998
 15%|█▍        | 147/1000 [00:00<00:01, 558.64it/s] 98%|█████████▊| 977/1000 [00:00<00:00, 910.24it/s] Step99:rank1, time: 0.285, per_step: 0.002853
Step199:rank6, time: 0.053, per_step: 0.000524
Step999:rank2, time: 0.060, per_step: 0.000590
100%|██████████| 1000/1000 [00:00<00:00, 1148.80it/s]
Step199:rank5, time: 0.047, per_step: 0.000470
Step199:rank4, time: 0.070, per_step: 0.000690
 26%|██▌       | 262/1000 [00:00<00:00, 996.21it/s] 17%|█▋        | 168/1000 [00:00<00:01, 684.64it/s]Step299:rank6, time: 0.047, per_step: 0.000469
Step199:rank3, time: 0.059, per_step: 0.000589
Step199:rank0, time: 0.073, per_step: 0.000721
 22%|██▏       | 216/1000 [00:00<00:00, 1143.32it/s] 30%|██▉       | 298/1000 [00:00<00:00, 958.16it/s]Step299:rank5, time: 0.048, per_step: 0.000473
 15%|█▌        | 152/1000 [00:00<00:01, 523.18it/s] 27%|██▋       | 267/1000 [00:00<00:01, 729.09it/s]Step299:rank4, time: 0.064, per_step: 0.000630
Step399:rank6, time: 0.046, per_step: 0.000455
 32%|███▏      | 316/1000 [00:00<00:00, 995.51it/s]Step299:rank7, time: 0.115, per_step: 0.001136
Step199:rank1, time: 0.105, per_step: 0.001043
Step299:rank0, time: 0.055, per_step: 0.000542
Step299:rank3, time: 0.068, per_step: 0.000678
Step399:rank5, time: 0.045, per_step: 0.000441
 47%|████▋     | 472/1000 [00:00<00:00, 1415.13it/s] 33%|███▎      | 331/1000 [00:00<00:00, 1056.53it/s]Step399:rank4, time: 0.042, per_step: 0.000421
Step499:rank6, time: 0.048, per_step: 0.000474
Step399:rank7, time: 0.044, per_step: 0.000437
Step299:rank1, time: 0.043, per_step: 0.000423
Step399:rank0, time: 0.043, per_step: 0.000427
Step399:rank3, time: 0.043, per_step: 0.000425
Step499:rank5, time: 0.043, per_step: 0.000423
 43%|████▎     | 427/1000 [00:00<00:00, 1582.80it/s] 53%|█████▎    | 527/1000 [00:00<00:00, 1422.48it/s]Step499:rank4, time: 0.042, per_step: 0.000418
 36%|███▌      | 362/1000 [00:00<00:00, 1125.31it/s] 47%|████▋     | 474/1000 [00:00<00:00, 1195.43it/s]Step599:rank6, time: 0.042, per_step: 0.000420
Step499:rank7, time: 0.046, per_step: 0.000453
Step399:rank1, time: 0.044, per_step: 0.000440
Step499:rank0, time: 0.045, per_step: 0.000442
 55%|█████▌    | 553/1000 [00:00<00:00, 1483.36it/s]Step499:rank3, time: 0.044, per_step: 0.000434
Step599:rank5, time: 0.043, per_step: 0.000427
Step599:rank4, time: 0.043, per_step: 0.000422
Step699:rank6, time: 0.043, per_step: 0.000423
 71%|███████   | 707/1000 [00:00<00:00, 1742.47it/s] 56%|█████▌    | 561/1000 [00:00<00:00, 1503.61it/s]Step599:rank7, time: 0.044, per_step: 0.000438
Step499:rank1, time: 0.044, per_step: 0.000435
Step599:rank0, time: 0.043, per_step: 0.000427
Step699:rank5, time: 0.043, per_step: 0.000422
Step599:rank3, time: 0.043, per_step: 0.000425
Step699:rank4, time: 0.042, per_step: 0.000419
 66%|██████▌   | 656/1000 [00:00<00:00, 1859.79it/s]Step799:rank6, time: 0.043, per_step: 0.000422
 76%|███████▌  | 761/1000 [00:00<00:00, 1725.90it/s] 59%|█████▉    | 591/1000 [00:00<00:00, 1536.39it/s] 69%|██████▉   | 690/1000 [00:00<00:00, 1514.34it/s]Step599:rank1, time: 0.043, per_step: 0.000427
Step699:rank0, time: 0.043, per_step: 0.000428
Step699:rank7, time: 0.048, per_step: 0.000479
Step799:rank5, time: 0.043, per_step: 0.000425
Step699:rank3, time: 0.043, per_step: 0.000427
 78%|███████▊  | 783/1000 [00:00<00:00, 1701.19it/s]Step799:rank4, time: 0.056, per_step: 0.000554
Step899:rank6, time: 0.047, per_step: 0.000461
 93%|█████████▎| 933/1000 [00:00<00:00, 1915.31it/s] 78%|███████▊  | 780/1000 [00:00<00:00, 1736.30it/s]Step699:rank1, time: 0.052, per_step: 0.000511
Step799:rank7, time: 0.048, per_step: 0.000475
Step799:rank0, time: 0.053, per_step: 0.000522
Step899:rank5, time: 0.048, per_step: 0.000474
Step799:rank3, time: 0.049, per_step: 0.000485
Step899:rank4, time: 0.042, per_step: 0.000412
Step999:rank6, time: 0.042, per_step: 0.000417
100%|██████████| 1000/1000 [00:00<00:00, 1540.35it/s]
 86%|████████▋ | 864/1000 [00:00<00:00, 1937.81it/s] 98%|█████████▊| 982/1000 [00:00<00:00, 1880.89it/s]Step799:rank1, time: 0.043, per_step: 0.000424
Step899:rank7, time: 0.044, per_step: 0.000438
 80%|████████  | 804/1000 [00:00<00:00, 1733.78it/s]Step899:rank0, time: 0.045, per_step: 0.000442
 91%|█████████ | 908/1000 [00:00<00:00, 1726.02it/s]Step999:rank5, time: 0.044, per_step: 0.000437
100%|██████████| 1000/1000 [00:00<00:00, 1351.80it/s]
Step899:rank3, time: 0.045, per_step: 0.000442
Step999:rank4, time: 0.044, per_step: 0.000440
100%|██████████| 1000/1000 [00:00<00:00, 1388.65it/s]
Step899:rank1, time: 0.045, per_step: 0.000442
Step999:rank7, time: 0.046, per_step: 0.000453
100%|██████████| 1000/1000 [00:00<00:00, 1307.86it/s]
Step999:rank0, time: 0.046, per_step: 0.000452
100%|██████████| 1000/1000 [00:00<00:00, 1776.64it/s]
 98%|█████████▊| 983/1000 [00:00<00:00, 1830.43it/s]Step999:rank3, time: 0.058, per_step: 0.000574
100%|██████████| 1000/1000 [00:00<00:00, 1400.98it/s]
Step999:rank1, time: 0.045, per_step: 0.000446
100%|██████████| 1000/1000 [00:00<00:00, 1416.05it/s]
Worker 7 pid=45542
Successfully xmh

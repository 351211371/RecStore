perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f34d4cd7e50>==========
Worker 0 pid=62768
Worker 1 pid=62769
Worker 2 pid=62770
Worker 3 pid=62771
Worker 4 pid=62772
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<17:03,  1.02s/it]Step99:rank1, time: 1.116, per_step: 0.011160
 14%|█▍        | 138/1000 [00:01<00:05, 168.37it/s]Step199:rank1, time: 0.080, per_step: 0.000797
 28%|██▊       | 279/1000 [00:01<00:02, 352.79it/s]Step299:rank1, time: 0.054, per_step: 0.000537
Step399:rank1, time: 0.049, per_step: 0.000489
 49%|████▉     | 489/1000 [00:01<00:00, 658.39it/s]Step499:rank1, time: 0.046, per_step: 0.000458
Step599:rank1, time: 0.048, per_step: 0.000474
Step699:rank1, time: 0.046, per_step: 0.000459
 70%|███████   | 702/1000 [00:01<00:00, 951.87it/s]Step799:rank1, time: 0.047, per_step: 0.000461
Step899:rank1, time: 0.047, per_step: 0.000466
 92%|█████████▏| 916/1000 [00:01<00:00, 1215.17it/s]Step999:rank1, time: 0.047, per_step: 0.000465
100%|██████████| 1000/1000 [00:01<00:00, 638.50it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<03:17,  5.05it/s]  0%|          | 1/1000 [00:00<03:39,  4.55it/s]  0%|          | 1/1000 [00:00<03:40,  4.54it/s]  0%|          | 1/1000 [00:00<03:07,  5.34it/s]  0%|          | 1/1000 [00:00<03:34,  4.67it/s]Step99:rank5, time: 0.275, per_step: 0.002752
  5%|▍         | 48/1000 [00:00<00:05, 189.50it/s] 18%|█▊        | 182/1000 [00:00<00:01, 714.01it/s]  6%|▌         | 58/1000 [00:00<00:04, 217.55it/s]  4%|▎         | 37/1000 [00:00<00:06, 156.14it/s]Step199:rank5, time: 0.060, per_step: 0.000590
  4%|▍         | 44/1000 [00:00<00:05, 174.57it/s]Step99:rank4, time: 0.371, per_step: 0.003711
Step99:rank0, time: 0.380, per_step: 0.003795
Step99:rank2, time: 0.359, per_step: 0.003588
Step99:rank3, time: 0.373, per_step: 0.003735
Step299:rank5, time: 0.064, per_step: 0.000635
 18%|█▊        | 181/1000 [00:00<00:01, 601.90it/s]Step199:rank0, time: 0.045, per_step: 0.000443
Step199:rank4, time: 0.064, per_step: 0.000636
 38%|███▊      | 375/1000 [00:00<00:00, 1149.82it/s] 20%|██        | 205/1000 [00:00<00:01, 655.12it/s] 15%|█▍        | 148/1000 [00:00<00:01, 512.84it/s]Step399:rank5, time: 0.037, per_step: 0.000362
 17%|█▋        | 173/1000 [00:00<00:01, 579.76it/s]Step299:rank0, time: 0.036, per_step: 0.000361
Step199:rank3, time: 0.055, per_step: 0.000543
Step199:rank2, time: 0.062, per_step: 0.000617
Step499:rank5, time: 0.034, per_step: 0.000336
Step299:rank4, time: 0.046, per_step: 0.000455
Step299:rank3, time: 0.033, per_step: 0.000331
Step399:rank0, time: 0.035, per_step: 0.000347
Step299:rank2, time: 0.034, per_step: 0.000340
 46%|████▌     | 461/1000 [00:00<00:00, 1349.48it/s]Step599:rank5, time: 0.034, per_step: 0.000336
Step399:rank3, time: 0.034, per_step: 0.000337
Step499:rank0, time: 0.035, per_step: 0.000348
Step399:rank4, time: 0.045, per_step: 0.000448
Step399:rank2, time: 0.035, per_step: 0.000344
 67%|██████▋   | 667/1000 [00:00<00:00, 1749.42it/s] 43%|████▎     | 426/1000 [00:00<00:00, 1171.60it/s] 44%|████▍     | 438/1000 [00:00<00:00, 1344.81it/s] 47%|████▋     | 470/1000 [00:00<00:00, 1395.91it/s]Step699:rank5, time: 0.034, per_step: 0.000338
Step499:rank3, time: 0.034, per_step: 0.000332
Step599:rank0, time: 0.035, per_step: 0.000345
Step499:rank2, time: 0.034, per_step: 0.000338
Step499:rank4, time: 0.045, per_step: 0.000448
Step799:rank5, time: 0.034, per_step: 0.000336
Step599:rank3, time: 0.033, per_step: 0.000330
Step699:rank0, time: 0.035, per_step: 0.000346
Step599:rank2, time: 0.034, per_step: 0.000336
 75%|███████▍  | 747/1000 [00:00<00:00, 1843.19it/s]Step899:rank5, time: 0.034, per_step: 0.000333
Step599:rank4, time: 0.045, per_step: 0.000442
Step699:rank3, time: 0.034, per_step: 0.000334
Step799:rank0, time: 0.035, per_step: 0.000346
Step699:rank2, time: 0.034, per_step: 0.000340
 96%|█████████▋| 963/1000 [00:00<00:00, 2142.38it/s] 65%|██████▍   | 649/1000 [00:00<00:00, 1511.39it/s] 73%|███████▎  | 731/1000 [00:00<00:00, 1871.44it/s] 77%|███████▋  | 768/1000 [00:00<00:00, 1915.06it/s]Step999:rank5, time: 0.034, per_step: 0.000335
100%|██████████| 1000/1000 [00:00<00:00, 1577.50it/s]
Step799:rank3, time: 0.035, per_step: 0.000344
Step699:rank4, time: 0.046, per_step: 0.000452
Step899:rank0, time: 0.036, per_step: 0.000355
Step799:rank2, time: 0.036, per_step: 0.000355
Step899:rank3, time: 0.036, per_step: 0.000354
Step999:rank0, time: 0.036, per_step: 0.000357
100%|██████████| 1000/1000 [00:00<00:00, 1423.80it/s]
Step899:rank2, time: 0.037, per_step: 0.000366
Step799:rank4, time: 0.047, per_step: 0.000462
Step999:rank3, time: 0.037, per_step: 0.000361
100%|██████████| 1000/1000 [00:00<00:00, 1430.23it/s]
 86%|████████▋ | 865/1000 [00:00<00:00, 1714.28it/s] 98%|█████████▊| 981/1000 [00:00<00:00, 2069.96it/s]Step899:rank4, time: 0.046, per_step: 0.000454
Step999:rank2, time: 0.050, per_step: 0.000495
100%|██████████| 1000/1000 [00:00<00:00, 1416.73it/s]
Step999:rank4, time: 0.046, per_step: 0.000460
100%|██████████| 1000/1000 [00:00<00:00, 1257.74it/s]
Worker 5 pid=62773
Successfully xmh

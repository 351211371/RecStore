perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7efc9edaae50>==========
Worker 0 pid=53512
Worker 1 pid=53513
Worker 2 pid=53514
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<05:29,  3.04it/s]  0%|          | 1/1000 [00:00<06:04,  2.74it/s]  0%|          | 1/1000 [00:00<07:28,  2.23it/s]  0%|          | 1/1000 [00:00<07:28,  2.23it/s]  1%|▏         | 14/1000 [00:00<00:25, 38.23it/s]  1%|▏         | 14/1000 [00:00<00:30, 32.85it/s]  1%|▏         | 14/1000 [00:00<00:24, 41.04it/s]  1%|▏         | 14/1000 [00:00<00:30, 32.84it/s]  3%|▎         | 26/1000 [00:00<00:15, 63.74it/s]  3%|▎         | 26/1000 [00:00<00:17, 54.37it/s]  3%|▎         | 26/1000 [00:00<00:16, 60.61it/s]  3%|▎         | 26/1000 [00:00<00:17, 54.37it/s]  4%|▍         | 41/1000 [00:00<00:11, 86.01it/s]  4%|▍         | 41/1000 [00:00<00:12, 79.48it/s]  4%|▍         | 41/1000 [00:00<00:10, 89.06it/s]  4%|▍         | 41/1000 [00:00<00:12, 79.47it/s]  6%|▌         | 56/1000 [00:00<00:09, 97.30it/s]  6%|▌         | 56/1000 [00:00<00:08, 105.43it/s]  6%|▌         | 56/1000 [00:00<00:09, 102.87it/s]  6%|▌         | 56/1000 [00:00<00:09, 97.30it/s]  7%|▋         | 72/1000 [00:00<00:08, 114.18it/s]  7%|▋         | 72/1000 [00:00<00:07, 118.81it/s]  7%|▋         | 72/1000 [00:00<00:07, 120.83it/s]  7%|▋         | 72/1000 [00:00<00:08, 114.19it/s]  9%|▉         | 89/1000 [00:00<00:06, 132.09it/s]  9%|▉         | 89/1000 [00:00<00:06, 133.68it/s]  9%|▉         | 89/1000 [00:01<00:07, 128.38it/s]  9%|▉         | 89/1000 [00:01<00:07, 128.44it/s]Step99:rank1, time: 1.181, per_step: 0.011813
Step99:rank3, time: 1.043, per_step: 0.010428
Step99:rank0, time: 1.183, per_step: 0.011826
Step99:rank2, time: 1.078, per_step: 0.010778
 10%|█         | 104/1000 [00:01<00:06, 130.60it/s] 10%|█         | 104/1000 [00:01<00:06, 134.25it/s] 10%|█         | 104/1000 [00:01<00:06, 133.08it/s] 10%|█         | 104/1000 [00:01<00:06, 129.35it/s] 12%|█▏        | 120/1000 [00:01<00:06, 141.30it/s] 12%|█▏        | 120/1000 [00:01<00:06, 138.53it/s] 12%|█▏        | 120/1000 [00:01<00:06, 140.38it/s] 12%|█▏        | 121/1000 [00:01<00:06, 139.52it/s] 14%|█▍        | 138/1000 [00:01<00:05, 149.24it/s] 14%|█▍        | 138/1000 [00:01<00:05, 151.30it/s] 14%|█▍        | 138/1000 [00:01<00:05, 150.68it/s] 14%|█▍        | 139/1000 [00:01<00:05, 149.97it/s] 16%|█▌        | 157/1000 [00:01<00:05, 160.41it/s] 16%|█▌        | 157/1000 [00:01<00:05, 158.85it/s] 16%|█▌        | 157/1000 [00:01<00:05, 159.88it/s] 16%|█▌        | 158/1000 [00:01<00:05, 159.35it/s] 18%|█▊        | 176/1000 [00:01<00:04, 166.63it/s] 18%|█▊        | 176/1000 [00:01<00:04, 167.72it/s] 18%|█▊        | 176/1000 [00:01<00:04, 167.37it/s] 18%|█▊        | 177/1000 [00:01<00:04, 167.02it/s] 20%|█▉        | 195/1000 [00:01<00:04, 173.27it/s] 20%|█▉        | 195/1000 [00:01<00:04, 174.10it/s] 20%|█▉        | 195/1000 [00:01<00:04, 173.88it/s] 20%|█▉        | 196/1000 [00:01<00:04, 173.60it/s]Step199:rank0, time: 0.562, per_step: 0.005567
Step199:rank1, time: 0.562, per_step: 0.005569
Step199:rank3, time: 0.563, per_step: 0.005570
Step199:rank2, time: 0.562, per_step: 0.005568
 21%|██▏       | 214/1000 [00:01<00:04, 175.91it/s] 21%|██▏       | 214/1000 [00:01<00:04, 176.51it/s] 21%|██▏       | 214/1000 [00:01<00:04, 176.29it/s] 22%|██▏       | 215/1000 [00:01<00:04, 176.15it/s] 23%|██▎       | 233/1000 [00:01<00:04, 177.54it/s] 23%|██▎       | 233/1000 [00:01<00:04, 177.95it/s] 23%|██▎       | 233/1000 [00:01<00:04, 177.82it/s] 23%|██▎       | 234/1000 [00:01<00:04, 177.86it/s] 25%|██▌       | 253/1000 [00:02<00:04, 179.53it/s] 25%|██▌       | 253/1000 [00:02<00:04, 179.60it/s] 25%|██▌       | 253/1000 [00:01<00:04, 179.88it/s] 25%|██▌       | 253/1000 [00:01<00:04, 179.71it/s] 27%|██▋       | 274/1000 [00:02<00:03, 186.88it/s] 27%|██▋       | 274/1000 [00:02<00:03, 186.86it/s] 27%|██▋       | 274/1000 [00:01<00:03, 187.07it/s] 27%|██▋       | 274/1000 [00:02<00:03, 186.98it/s] 29%|██▉       | 294/1000 [00:02<00:03, 189.61it/s] 29%|██▉       | 294/1000 [00:02<00:03, 189.75it/s] 29%|██▉       | 294/1000 [00:02<00:03, 189.56it/s] 29%|██▉       | 294/1000 [00:02<00:03, 189.69it/s]Step299:rank1, time: 0.525, per_step: 0.005203
Step299:rank0, time: 0.526, per_step: 0.005203
Step299:rank3, time: 0.525, per_step: 0.005202
Step299:rank2, time: 0.525, per_step: 0.005202
 32%|███▏      | 315/1000 [00:02<00:03, 193.45it/s] 32%|███▏      | 315/1000 [00:02<00:03, 193.55it/s] 32%|███▏      | 315/1000 [00:02<00:03, 193.46it/s] 32%|███▏      | 315/1000 [00:02<00:03, 193.55it/s] 34%|███▎      | 335/1000 [00:02<00:03, 193.25it/s] 34%|███▎      | 335/1000 [00:02<00:03, 193.19it/s] 34%|███▎      | 335/1000 [00:02<00:03, 193.30it/s] 34%|███▎      | 335/1000 [00:02<00:03, 193.24it/s] 36%|███▌      | 356/1000 [00:02<00:03, 196.43it/s] 36%|███▌      | 356/1000 [00:02<00:03, 196.49it/s] 36%|███▌      | 356/1000 [00:02<00:03, 196.42it/s] 36%|███▌      | 356/1000 [00:02<00:03, 196.47it/s] 38%|███▊      | 377/1000 [00:02<00:03, 199.96it/s] 38%|███▊      | 377/1000 [00:02<00:03, 199.90it/s] 38%|███▊      | 377/1000 [00:02<00:03, 199.88it/s] 38%|███▊      | 377/1000 [00:02<00:03, 199.92it/s] 40%|███▉      | 399/1000 [00:02<00:02, 205.13it/s] 40%|███▉      | 399/1000 [00:02<00:02, 205.14it/s] 40%|███▉      | 399/1000 [00:02<00:02, 205.14it/s] 40%|███▉      | 399/1000 [00:02<00:02, 205.12it/s]Step399:rank1, time: 0.488, per_step: 0.004834
Step399:rank3, time: 0.488, per_step: 0.004833
Step399:rank0, time: 0.488, per_step: 0.004834
Step399:rank2, time: 0.488, per_step: 0.004834
 42%|████▏     | 421/1000 [00:02<00:02, 207.24it/s] 42%|████▏     | 421/1000 [00:02<00:02, 207.19it/s] 42%|████▏     | 421/1000 [00:02<00:02, 207.25it/s] 42%|████▏     | 421/1000 [00:02<00:02, 207.13it/s] 44%|████▍     | 443/1000 [00:02<00:02, 210.99it/s] 44%|████▍     | 443/1000 [00:02<00:02, 210.96it/s] 44%|████▍     | 443/1000 [00:02<00:02, 210.93it/s] 44%|████▍     | 444/1000 [00:02<00:02, 211.19it/s] 46%|████▋     | 465/1000 [00:03<00:02, 212.59it/s] 46%|████▋     | 465/1000 [00:03<00:02, 212.54it/s] 46%|████▋     | 465/1000 [00:02<00:02, 212.55it/s] 47%|████▋     | 466/1000 [00:02<00:02, 212.65it/s] 49%|████▊     | 487/1000 [00:03<00:02, 214.04it/s] 49%|████▊     | 487/1000 [00:03<00:02, 214.07it/s] 49%|████▊     | 487/1000 [00:03<00:02, 214.06it/s] 49%|████▉     | 488/1000 [00:03<00:02, 214.21it/s]Step499:rank0, time: 0.459, per_step: 0.004545
Step499:rank1, time: 0.459, per_step: 0.004546
Step499:rank3, time: 0.459, per_step: 0.004546
Step499:rank2, time: 0.459, per_step: 0.004545
 51%|█████     | 510/1000 [00:03<00:02, 218.09it/s] 51%|█████     | 510/1000 [00:03<00:02, 218.08it/s] 51%|█████     | 510/1000 [00:03<00:02, 218.04it/s] 51%|█████     | 511/1000 [00:03<00:02, 218.20it/s] 53%|█████▎    | 533/1000 [00:03<00:02, 219.34it/s] 53%|█████▎    | 533/1000 [00:03<00:02, 219.29it/s] 53%|█████▎    | 533/1000 [00:03<00:02, 219.33it/s] 53%|█████▎    | 534/1000 [00:03<00:02, 219.41it/s] 56%|█████▌    | 557/1000 [00:03<00:01, 222.76it/s] 56%|█████▌    | 557/1000 [00:03<00:01, 222.76it/s] 56%|█████▌    | 557/1000 [00:03<00:01, 222.74it/s] 56%|█████▌    | 558/1000 [00:03<00:01, 222.83it/s] 58%|█████▊    | 580/1000 [00:03<00:01, 221.30it/s] 58%|█████▊    | 580/1000 [00:03<00:01, 221.25it/s] 58%|█████▊    | 580/1000 [00:03<00:01, 221.28it/s] 58%|█████▊    | 581/1000 [00:03<00:01, 221.27it/s]Step599:rank0, time: 0.443, per_step: 0.004391
Step599:rank1, time: 0.444, per_step: 0.004391
Step599:rank3, time: 0.443, per_step: 0.004391
Step599:rank2, time: 0.443, per_step: 0.004391
 60%|██████    | 604/1000 [00:03<00:01, 224.36it/s] 60%|██████    | 604/1000 [00:03<00:01, 224.37it/s] 60%|██████    | 604/1000 [00:03<00:01, 224.37it/s] 60%|██████    | 605/1000 [00:03<00:01, 224.36it/s] 63%|██████▎   | 627/1000 [00:03<00:01, 224.99it/s] 63%|██████▎   | 627/1000 [00:03<00:01, 224.99it/s] 63%|██████▎   | 627/1000 [00:03<00:01, 224.96it/s] 63%|██████▎   | 628/1000 [00:03<00:01, 225.02it/s] 65%|██████▌   | 651/1000 [00:03<00:01, 227.37it/s] 65%|██████▌   | 651/1000 [00:03<00:01, 227.39it/s] 65%|██████▌   | 651/1000 [00:03<00:01, 227.37it/s] 65%|██████▌   | 652/1000 [00:03<00:01, 227.40it/s] 68%|██████▊   | 675/1000 [00:03<00:01, 228.74it/s] 68%|██████▊   | 675/1000 [00:03<00:01, 228.73it/s] 68%|██████▊   | 675/1000 [00:03<00:01, 228.73it/s] 68%|██████▊   | 676/1000 [00:03<00:01, 228.81it/s] 70%|██████▉   | 698/1000 [00:04<00:01, 213.66it/s] 70%|██████▉   | 698/1000 [00:04<00:01, 213.69it/s] 70%|██████▉   | 698/1000 [00:03<00:01, 213.67it/s] 70%|██████▉   | 699/1000 [00:04<00:01, 213.66it/s]Step699:rank3, time: 0.459, per_step: 0.004542
Step699:rank0, time: 0.459, per_step: 0.004542
Step699:rank1, time: 0.459, per_step: 0.004542
Step699:rank2, time: 0.459, per_step: 0.004542
 72%|███████▏  | 720/1000 [00:04<00:01, 211.18it/s] 72%|███████▏  | 720/1000 [00:04<00:01, 211.17it/s] 72%|███████▏  | 720/1000 [00:04<00:01, 211.17it/s] 72%|███████▏  | 721/1000 [00:04<00:01, 211.20it/s] 74%|███████▍  | 742/1000 [00:04<00:01, 211.79it/s] 74%|███████▍  | 742/1000 [00:04<00:01, 211.77it/s] 74%|███████▍  | 742/1000 [00:04<00:01, 211.42it/s] 74%|███████▍  | 743/1000 [00:04<00:01, 211.24it/s] 77%|███████▋  | 766/1000 [00:04<00:01, 217.54it/s] 77%|███████▋  | 766/1000 [00:04<00:01, 217.42it/s] 77%|███████▋  | 766/1000 [00:04<00:01, 217.41it/s] 77%|███████▋  | 767/1000 [00:04<00:01, 217.61it/s] 79%|███████▉  | 789/1000 [00:04<00:00, 220.45it/s] 79%|███████▉  | 789/1000 [00:04<00:00, 220.38it/s] 79%|███████▉  | 789/1000 [00:04<00:00, 220.35it/s] 79%|███████▉  | 790/1000 [00:04<00:00, 220.52it/s]Step799:rank1, time: 0.453, per_step: 0.004490
Step799:rank0, time: 0.454, per_step: 0.004490
Step799:rank3, time: 0.454, per_step: 0.004491
Step799:rank2, time: 0.454, per_step: 0.004491
 81%|████████  | 812/1000 [00:04<00:00, 221.48it/s] 81%|████████  | 812/1000 [00:04<00:00, 221.49it/s] 81%|████████  | 812/1000 [00:04<00:00, 221.42it/s] 81%|████████▏ | 813/1000 [00:04<00:00, 221.48it/s] 84%|████████▎ | 835/1000 [00:04<00:00, 212.27it/s] 84%|████████▎ | 835/1000 [00:04<00:00, 212.25it/s] 84%|████████▎ | 835/1000 [00:04<00:00, 212.25it/s] 84%|████████▎ | 836/1000 [00:04<00:00, 212.31it/s] 86%|████████▌ | 857/1000 [00:04<00:00, 210.65it/s] 86%|████████▌ | 857/1000 [00:04<00:00, 210.61it/s] 86%|████████▌ | 857/1000 [00:04<00:00, 210.62it/s] 86%|████████▌ | 858/1000 [00:04<00:00, 210.65it/s] 88%|████████▊ | 880/1000 [00:04<00:00, 215.40it/s] 88%|████████▊ | 880/1000 [00:04<00:00, 215.37it/s] 88%|████████▊ | 880/1000 [00:04<00:00, 215.39it/s] 88%|████████▊ | 881/1000 [00:04<00:00, 215.39it/s]Step899:rank1, time: 0.468, per_step: 0.004636
Step899:rank0, time: 0.468, per_step: 0.004635
Step899:rank3, time: 0.468, per_step: 0.004636
Step899:rank2, time: 0.468, per_step: 0.004636
 90%|█████████ | 904/1000 [00:05<00:00, 220.38it/s] 90%|█████████ | 904/1000 [00:05<00:00, 220.38it/s] 90%|█████████ | 904/1000 [00:04<00:00, 220.35it/s] 90%|█████████ | 905/1000 [00:04<00:00, 220.39it/s] 93%|█████████▎| 927/1000 [00:05<00:00, 221.66it/s] 93%|█████████▎| 927/1000 [00:05<00:00, 221.67it/s] 93%|█████████▎| 927/1000 [00:05<00:00, 221.45it/s] 93%|█████████▎| 928/1000 [00:05<00:00, 221.53it/s] 95%|█████████▌| 951/1000 [00:05<00:00, 224.84it/s] 95%|█████████▌| 951/1000 [00:05<00:00, 224.85it/s] 95%|█████████▌| 951/1000 [00:05<00:00, 224.82it/s] 95%|█████████▌| 952/1000 [00:05<00:00, 224.87it/s] 98%|█████████▊| 975/1000 [00:05<00:00, 227.52it/s] 98%|█████████▊| 975/1000 [00:05<00:00, 227.51it/s] 98%|█████████▊| 975/1000 [00:05<00:00, 227.51it/s] 98%|█████████▊| 976/1000 [00:05<00:00, 227.54it/s]100%|█████████▉| 999/1000 [00:05<00:00, 228.37it/s]100%|█████████▉| 999/1000 [00:05<00:00, 228.36it/s]100%|█████████▉| 999/1000 [00:05<00:00, 228.36it/s]100%|█████████▉| 999/1000 [00:05<00:00, 226.03it/s]Step999:rank1, time: 0.438, per_step: 0.004336
Step999:rank3, time: 0.438, per_step: 0.004336
Step999:rank0, time: 0.438, per_step: 0.004337
100%|██████████| 1000/1000 [00:05<00:00, 183.39it/s]100%|██████████| 1000/1000 [00:05<00:00, 187.49it/s]100%|██████████| 1000/1000 [00:05<00:00, 183.40it/s]Step999:rank2, time: 0.438, per_step: 0.004337


100%|██████████| 1000/1000 [00:05<00:00, 186.24it/s]

Worker 3 pid=53515
Successfully xmh

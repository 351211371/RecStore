perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f003c394e50>==========
Worker 0 pid=39038
Worker 1 pid=39039
Worker 2 pid=39040
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<29:31,  1.77s/it]  0%|          | 1/1000 [00:01<30:47,  1.85s/it]  2%|▏         | 23/1000 [00:01<00:57, 16.88it/s]  0%|          | 1/1000 [00:01<31:13,  1.88s/it]  0%|          | 1/1000 [00:01<31:28,  1.89s/it]  1%|          | 7/1000 [00:01<03:28,  4.77it/s]  4%|▍         | 44/1000 [00:01<00:27, 35.36it/s]  1%|          | 8/1000 [00:01<03:02,  5.44it/s]  1%|          | 11/1000 [00:01<02:11,  7.52it/s]  3%|▎         | 26/1000 [00:02<00:44, 21.86it/s]  3%|▎         | 34/1000 [00:02<00:33, 28.75it/s]  9%|▉         | 90/1000 [00:02<00:10, 86.29it/s]  4%|▍         | 43/1000 [00:02<00:26, 35.99it/s]Step99:rank0, time: 2.112, per_step: 0.021119
  6%|▌         | 58/1000 [00:02<00:16, 56.45it/s] 14%|█▎        | 137/1000 [00:02<00:06, 142.34it/s]  6%|▋         | 64/1000 [00:02<00:15, 60.01it/s]  8%|▊         | 79/1000 [00:02<00:12, 73.27it/s]Step99:rank2, time: 2.258, per_step: 0.022576
  9%|▉         | 91/1000 [00:02<00:09, 95.22it/s] 18%|█▊        | 185/1000 [00:02<00:04, 200.26it/s]  9%|▉         | 94/1000 [00:02<00:09, 93.82it/s]Step99:rank1, time: 2.299, per_step: 0.022989
 12%|█▏        | 116/1000 [00:02<00:07, 114.78it/s]Step99:rank3, time: 2.310, per_step: 0.023103
Step199:rank0, time: 0.210, per_step: 0.002079
 12%|█▏        | 124/1000 [00:02<00:06, 134.50it/s] 23%|██▎       | 233/1000 [00:02<00:03, 255.19it/s] 12%|█▏        | 124/1000 [00:02<00:06, 128.17it/s] 15%|█▌        | 153/1000 [00:02<00:05, 157.19it/s] 16%|█▌        | 157/1000 [00:02<00:04, 172.08it/s] 15%|█▌        | 154/1000 [00:02<00:05, 161.15it/s] 28%|██▊       | 275/1000 [00:02<00:02, 289.39it/s] 18%|█▊        | 185/1000 [00:02<00:04, 180.44it/s]Step299:rank0, time: 0.230, per_step: 0.002279
Step199:rank2, time: 0.312, per_step: 0.003086
 19%|█▉        | 189/1000 [00:02<00:03, 203.28it/s] 32%|███▏      | 317/1000 [00:02<00:02, 320.36it/s] 18%|█▊        | 181/1000 [00:02<00:04, 182.50it/s]Step199:rank1, time: 0.310, per_step: 0.003073
 22%|██▏       | 221/1000 [00:02<00:03, 217.68it/s]Step199:rank3, time: 0.343, per_step: 0.003396
 22%|██▏       | 222/1000 [00:02<00:03, 232.63it/s] 36%|███▋      | 363/1000 [00:02<00:01, 353.97it/s] 21%|██▏       | 214/1000 [00:02<00:03, 216.28it/s] 26%|██▌       | 258/1000 [00:02<00:02, 251.96it/s]Step399:rank0, time: 0.229, per_step: 0.002264
 25%|██▍       | 247/1000 [00:02<00:03, 244.14it/s] 41%|████      | 407/1000 [00:02<00:01, 372.22it/s] 25%|██▌       | 253/1000 [00:02<00:03, 231.22it/s] 30%|██▉       | 295/1000 [00:02<00:02, 279.74it/s]Step299:rank2, time: 0.275, per_step: 0.002718
 45%|████▌     | 453/1000 [00:02<00:01, 395.89it/s] 28%|██▊       | 284/1000 [00:02<00:02, 275.95it/s] 29%|██▊       | 286/1000 [00:02<00:02, 255.21it/s] 33%|███▎      | 332/1000 [00:02<00:02, 302.01it/s]Step299:rank3, time: 0.297, per_step: 0.002938
Step299:rank1, time: 0.346, per_step: 0.003430
Step499:rank0, time: 0.218, per_step: 0.002157
 50%|█████     | 501/1000 [00:02<00:01, 419.09it/s] 32%|███▏      | 316/1000 [00:02<00:02, 285.97it/s] 32%|███▏      | 319/1000 [00:03<00:02, 273.77it/s] 37%|███▋      | 369/1000 [00:03<00:01, 319.25it/s] 55%|█████▍    | 549/1000 [00:03<00:01, 435.82it/s] 35%|███▍      | 348/1000 [00:03<00:02, 288.54it/s] 35%|███▌      | 352/1000 [00:03<00:02, 287.93it/s]Step399:rank2, time: 0.273, per_step: 0.002704
 41%|████      | 406/1000 [00:03<00:01, 332.28it/s] 60%|█████▉    | 598/1000 [00:03<00:00, 449.93it/s]Step599:rank0, time: 0.208, per_step: 0.002063
 38%|███▊      | 379/1000 [00:03<00:02, 290.04it/s] 38%|███▊      | 384/1000 [00:03<00:02, 282.07it/s] 44%|████▍     | 442/1000 [00:03<00:01, 323.30it/s]Step399:rank1, time: 0.328, per_step: 0.003247
Step399:rank3, time: 0.339, per_step: 0.003353
 65%|██████▍   | 646/1000 [00:03<00:00, 456.04it/s] 41%|████      | 410/1000 [00:03<00:02, 291.02it/s] 42%|████▏     | 417/1000 [00:03<00:01, 293.86it/s] 48%|████▊     | 479/1000 [00:03<00:01, 335.18it/s] 69%|██████▉   | 693/1000 [00:03<00:00, 457.14it/s]Step499:rank2, time: 0.293, per_step: 0.002905
Step699:rank0, time: 0.216, per_step: 0.002137
 44%|████▍     | 441/1000 [00:03<00:01, 291.86it/s] 45%|████▌     | 450/1000 [00:03<00:01, 302.80it/s] 52%|█████▏    | 516/1000 [00:03<00:01, 343.61it/s] 74%|███████▍  | 740/1000 [00:03<00:00, 436.75it/s] 47%|████▋     | 471/1000 [00:03<00:01, 290.99it/s] 48%|████▊     | 483/1000 [00:03<00:01, 309.34it/s] 55%|█████▌    | 553/1000 [00:03<00:01, 349.55it/s]Step499:rank1, time: 0.307, per_step: 0.003037
 78%|███████▊  | 785/1000 [00:03<00:00, 436.46it/s]Step499:rank3, time: 0.346, per_step: 0.003428
 50%|█████     | 501/1000 [00:03<00:01, 288.39it/s] 52%|█████▏    | 516/1000 [00:03<00:01, 314.71it/s] 59%|█████▉    | 590/1000 [00:03<00:01, 354.24it/s]Step799:rank0, time: 0.242, per_step: 0.002397
Step599:rank2, time: 0.281, per_step: 0.002784
 83%|████████▎ | 830/1000 [00:03<00:00, 429.13it/s] 55%|█████▍    | 549/1000 [00:03<00:01, 318.17it/s] 53%|█████▎    | 531/1000 [00:03<00:01, 289.66it/s] 63%|██████▎   | 626/1000 [00:03<00:01, 351.61it/s] 87%|████████▋ | 874/1000 [00:03<00:00, 430.74it/s] 58%|█████▊    | 582/1000 [00:03<00:01, 321.01it/s] 56%|█████▌    | 561/1000 [00:03<00:01, 290.36it/s] 66%|██████▋   | 663/1000 [00:03<00:00, 355.69it/s]Step599:rank1, time: 0.306, per_step: 0.003029
Step899:rank0, time: 0.233, per_step: 0.002307
 92%|█████████▏| 920/1000 [00:03<00:00, 437.79it/s] 62%|██████▏   | 615/1000 [00:03<00:01, 321.94it/s] 59%|█████▉    | 591/1000 [00:03<00:01, 290.27it/s]Step699:rank2, time: 0.272, per_step: 0.002698
 70%|███████   | 700/1000 [00:03<00:00, 358.28it/s]Step599:rank3, time: 0.345, per_step: 0.003416
 97%|█████████▋| 967/1000 [00:04<00:00, 446.08it/s] 65%|██████▍   | 648/1000 [00:04<00:01, 323.33it/s] 62%|██████▏   | 624/1000 [00:04<00:01, 299.73it/s] 74%|███████▎  | 737/1000 [00:04<00:00, 360.36it/s]Step999:rank0, time: 0.216, per_step: 0.002142
100%|██████████| 1000/1000 [00:04<00:00, 243.44it/s]
 68%|██████▊   | 684/1000 [00:04<00:00, 331.87it/s] 66%|██████▌   | 656/1000 [00:04<00:01, 304.67it/s] 78%|███████▊  | 776/1000 [00:04<00:00, 368.46it/s]Step699:rank1, time: 0.289, per_step: 0.002860
 72%|███████▏  | 721/1000 [00:04<00:00, 342.72it/s]Step799:rank2, time: 0.286, per_step: 0.002828
 69%|██████▉   | 693/1000 [00:04<00:00, 323.23it/s]Step699:rank3, time: 0.298, per_step: 0.002952
 81%|████████▏ | 813/1000 [00:04<00:00, 351.95it/s] 76%|███████▌  | 758/1000 [00:04<00:00, 350.70it/s] 73%|███████▎  | 726/1000 [00:04<00:00, 309.34it/s] 85%|████████▍ | 849/1000 [00:04<00:00, 348.70it/s]Step799:rank1, time: 0.263, per_step: 0.002599
 80%|████████  | 800/1000 [00:04<00:00, 369.63it/s] 76%|███████▌  | 758/1000 [00:04<00:00, 301.07it/s] 89%|████████▊ | 887/1000 [00:04<00:00, 356.38it/s]Step899:rank2, time: 0.306, per_step: 0.003026
 84%|████████▎ | 837/1000 [00:04<00:00, 329.51it/s] 79%|███████▉  | 789/1000 [00:04<00:00, 277.47it/s] 92%|█████████▏| 923/1000 [00:04<00:00, 291.85it/s]Step799:rank3, time: 0.416, per_step: 0.004116
 87%|████████▋ | 871/1000 [00:04<00:00, 313.95it/s] 82%|████████▏ | 818/1000 [00:04<00:00, 237.21it/s]Step899:rank1, time: 0.343, per_step: 0.003400
 91%|█████████ | 906/1000 [00:04<00:00, 321.87it/s] 96%|█████████▌| 955/1000 [00:04<00:00, 264.06it/s] 84%|████████▍ | 843/1000 [00:04<00:00, 229.09it/s] 98%|█████████▊| 984/1000 [00:04<00:00, 265.48it/s] 94%|█████████▍| 939/1000 [00:04<00:00, 299.92it/s]Step999:rank2, time: 0.447, per_step: 0.004422
100%|██████████| 1000/1000 [00:04<00:00, 200.17it/s]
 87%|████████▋ | 868/1000 [00:05<00:00, 232.12it/s] 99%|█████████▉| 991/1000 [00:05<00:00, 358.60it/s]Step999:rank1, time: 0.267, per_step: 0.002641
100%|██████████| 1000/1000 [00:05<00:00, 197.97it/s]
Step899:rank3, time: 0.397, per_step: 0.003927
 91%|█████████ | 907/1000 [00:05<00:00, 273.42it/s] 98%|█████████▊| 981/1000 [00:05<00:00, 400.32it/s]Step999:rank3, time: 0.153, per_step: 0.001516
100%|██████████| 1000/1000 [00:05<00:00, 190.93it/s]
Worker 3 pid=39043
Successfully xmh

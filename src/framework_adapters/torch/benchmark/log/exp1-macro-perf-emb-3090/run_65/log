perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f59aa253e50>==========
Worker 0 pid=25621
Worker 1 pid=25622
Worker 2 pid=25623
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank0, time: 0.062, per_step: 0.000619
Step199:rank0, time: 0.051, per_step: 0.000502
 20%|██        | 201/1000 [00:00<00:00, 2005.78it/s]Step299:rank0, time: 0.034, per_step: 0.000342
Step399:rank0, time: 0.034, per_step: 0.000334
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
 47%|████▋     | 467/1000 [00:00<00:00, 2248.32it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
Step499:rank0, time: 0.120, per_step: 0.001184
  0%|          | 0/1000 [00:00<?, ?it/s]  4%|▍         | 44/1000 [00:00<00:02, 419.18it/s]  8%|▊         | 81/1000 [00:00<00:01, 756.32it/s]Step99:rank1, time: 0.131, per_step: 0.001311
Step99:rank3, time: 0.187, per_step: 0.001871
  7%|▋         | 73/1000 [00:00<00:01, 728.36it/s]Step599:rank0, time: 0.111, per_step: 0.001101
Step199:rank1, time: 0.068, per_step: 0.000677
Step99:rank2, time: 0.143, per_step: 0.001427
 15%|█▍        | 147/1000 [00:00<00:01, 763.02it/s] 26%|██▋       | 265/1000 [00:00<00:00, 1374.00it/s] 69%|██████▉   | 691/1000 [00:00<00:00, 1480.57it/s]Step299:rank1, time: 0.034, per_step: 0.000334
Step199:rank3, time: 0.052, per_step: 0.000517
Step699:rank0, time: 0.038, per_step: 0.000376
Step199:rank2, time: 0.035, per_step: 0.000350
Step399:rank1, time: 0.027, per_step: 0.000268
Step299:rank3, time: 0.027, per_step: 0.000271
Step799:rank0, time: 0.027, per_step: 0.000268
Step299:rank2, time: 0.027, per_step: 0.000272
Step499:rank1, time: 0.027, per_step: 0.000267
Step399:rank3, time: 0.027, per_step: 0.000268
Step899:rank0, time: 0.027, per_step: 0.000266
 40%|███▉      | 398/1000 [00:00<00:00, 2207.93it/s]Step399:rank2, time: 0.027, per_step: 0.000270
Step599:rank1, time: 0.027, per_step: 0.000269
Step499:rank3, time: 0.027, per_step: 0.000264
Step999:rank0, time: 0.027, per_step: 0.000268
100%|██████████| 1000/1000 [00:00<00:00, 1929.83it/s]
 51%|█████     | 512/1000 [00:00<00:00, 2057.17it/s] 63%|██████▎   | 630/1000 [00:00<00:00, 2395.95it/s]Step499:rank2, time: 0.028, per_step: 0.000274
Step699:rank1, time: 0.029, per_step: 0.000290
Step599:rank3, time: 0.029, per_step: 0.000288
Step599:rank2, time: 0.029, per_step: 0.000287
Step799:rank1, time: 0.028, per_step: 0.000282
Step699:rank3, time: 0.029, per_step: 0.000283
Step699:rank2, time: 0.029, per_step: 0.000285
 75%|███████▍  | 748/1000 [00:00<00:00, 2795.02it/s]Step899:rank1, time: 0.028, per_step: 0.000282
Step799:rank3, time: 0.029, per_step: 0.000284
Step799:rank2, time: 0.029, per_step: 0.000287
 86%|████████▌ | 861/1000 [00:00<00:00, 2614.10it/s] 98%|█████████▊| 980/1000 [00:00<00:00, 2826.42it/s]Step999:rank1, time: 0.029, per_step: 0.000287
100%|██████████| 1000/1000 [00:00<00:00, 2418.07it/s]
Step899:rank3, time: 0.034, per_step: 0.000332
Step899:rank2, time: 0.029, per_step: 0.000288
Step999:rank2, time: 0.029, per_step: 0.000289
100%|██████████| 1000/1000 [00:00<00:00, 2672.59it/s]
Step999:rank3, time: 0.041, per_step: 0.000407
100%|██████████| 1000/1000 [00:00<00:00, 2152.89it/s]
Worker 3 pid=25630
Successfully xmh

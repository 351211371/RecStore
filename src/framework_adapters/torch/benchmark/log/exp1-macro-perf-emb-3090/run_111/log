perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f7820c3de50>==========
Worker 0 pid=27418
Worker 1 pid=27419
Worker 2 pid=27420
Worker 3 pid=27421
Worker 4 pid=27428
Worker 5 pid=27429
Worker 6 pid=27430
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:02<37:30,  2.25s/it]  0%|          | 1/1000 [00:02<37:36,  2.26s/it]  0%|          | 1/1000 [00:02<37:45,  2.27s/it]  0%|          | 1/1000 [00:02<37:43,  2.27s/it]  0%|          | 1/1000 [00:02<37:58,  2.28s/it]  0%|          | 1/1000 [00:02<38:02,  2.28s/it]  0%|          | 1/1000 [00:02<38:09,  2.29s/it]  0%|          | 1/1000 [00:02<38:09,  2.29s/it] 10%|▉         | 98/1000 [00:02<00:15, 58.25it/s]Step99:rank2, time: 2.361, per_step: 0.023612
Step99:rank3, time: 2.364, per_step: 0.023636
 11%|█         | 108/1000 [00:02<00:13, 64.05it/s]Step99:rank5, time: 2.373, per_step: 0.023728
  9%|▉         | 89/1000 [00:02<00:17, 52.62it/s] 10%|█         | 105/1000 [00:02<00:14, 61.90it/s]Step99:rank4, time: 2.378, per_step: 0.023783
Step99:rank7, time: 2.390, per_step: 0.023903
 10%|▉         | 95/1000 [00:02<00:16, 55.81it/s] 10%|█         | 104/1000 [00:02<00:14, 61.03it/s]Step99:rank6, time: 2.392, per_step: 0.023918
Step199:rank3, time: 0.030, per_step: 0.000302
Step99:rank0, time: 2.394, per_step: 0.023944
Step99:rank1, time: 2.395, per_step: 0.023948
Step199:rank2, time: 0.035, per_step: 0.000347
 11%|█         | 112/1000 [00:02<00:13, 65.55it/s] 11%|█▏        | 114/1000 [00:02<00:13, 66.70it/s]Step199:rank5, time: 0.036, per_step: 0.000359
Step199:rank4, time: 0.032, per_step: 0.000316
Step199:rank7, time: 0.031, per_step: 0.000306
Step199:rank6, time: 0.030, per_step: 0.000297
Step299:rank3, time: 0.030, per_step: 0.000296
Step299:rank2, time: 0.030, per_step: 0.000299
Step199:rank1, time: 0.032, per_step: 0.000313
Step199:rank0, time: 0.032, per_step: 0.000316
Step299:rank5, time: 0.030, per_step: 0.000301
Step299:rank4, time: 0.031, per_step: 0.000310
Step299:rank7, time: 0.030, per_step: 0.000296
Step299:rank6, time: 0.029, per_step: 0.000289
Step399:rank3, time: 0.030, per_step: 0.000296
Step399:rank2, time: 0.030, per_step: 0.000297
Step299:rank1, time: 0.031, per_step: 0.000302
Step299:rank0, time: 0.031, per_step: 0.000304
 41%|████▏     | 413/1000 [00:02<00:01, 300.88it/s] 44%|████▍     | 442/1000 [00:02<00:01, 320.52it/s]Step399:rank5, time: 0.030, per_step: 0.000298
Step399:rank4, time: 0.031, per_step: 0.000308
 40%|████      | 405/1000 [00:02<00:02, 295.34it/s] 43%|████▎     | 431/1000 [00:02<00:01, 310.92it/s]Step399:rank6, time: 0.029, per_step: 0.000288
Step399:rank7, time: 0.030, per_step: 0.000296
Step499:rank3, time: 0.030, per_step: 0.000297
Step499:rank2, time: 0.030, per_step: 0.000298
Step399:rank1, time: 0.030, per_step: 0.000302
Step399:rank0, time: 0.031, per_step: 0.000303
 43%|████▎     | 434/1000 [00:02<00:01, 314.69it/s] 44%|████▎     | 435/1000 [00:02<00:01, 312.97it/s] 44%|████▎     | 435/1000 [00:02<00:01, 310.30it/s]Step499:rank5, time: 0.030, per_step: 0.000300
 44%|████▎     | 436/1000 [00:02<00:01, 310.13it/s]Step499:rank4, time: 0.031, per_step: 0.000308
Step499:rank6, time: 0.029, per_step: 0.000289
Step499:rank7, time: 0.030, per_step: 0.000298
Step599:rank2, time: 0.030, per_step: 0.000294
Step599:rank3, time: 0.033, per_step: 0.000323
Step499:rank0, time: 0.031, per_step: 0.000304
Step499:rank1, time: 0.033, per_step: 0.000330
Step599:rank5, time: 0.030, per_step: 0.000296
Step599:rank4, time: 0.031, per_step: 0.000307
Step599:rank6, time: 0.029, per_step: 0.000286
Step599:rank7, time: 0.030, per_step: 0.000295
Step699:rank2, time: 0.030, per_step: 0.000295
Step699:rank3, time: 0.030, per_step: 0.000297
Step599:rank0, time: 0.031, per_step: 0.000305
Step599:rank1, time: 0.030, per_step: 0.000302
Step699:rank5, time: 0.030, per_step: 0.000298
 75%|███████▍  | 748/1000 [00:02<00:00, 608.19it/s] 77%|███████▋  | 766/1000 [00:02<00:00, 614.19it/s]Step699:rank4, time: 0.031, per_step: 0.000308
Step699:rank6, time: 0.029, per_step: 0.000287
Step699:rank7, time: 0.030, per_step: 0.000297
 73%|███████▎  | 727/1000 [00:02<00:00, 588.86it/s]Step799:rank2, time: 0.030, per_step: 0.000298
Step799:rank3, time: 0.030, per_step: 0.000300
 76%|███████▋  | 763/1000 [00:02<00:00, 612.10it/s]Step699:rank0, time: 0.031, per_step: 0.000306
Step699:rank1, time: 0.031, per_step: 0.000304
Step799:rank5, time: 0.030, per_step: 0.000300
 78%|███████▊  | 779/1000 [00:02<00:00, 627.71it/s] 77%|███████▋  | 768/1000 [00:02<00:00, 613.81it/s]Step799:rank6, time: 0.029, per_step: 0.000288
Step799:rank4, time: 0.031, per_step: 0.000309
 76%|███████▌  | 759/1000 [00:02<00:00, 601.75it/s] 76%|███████▌  | 762/1000 [00:02<00:00, 603.16it/s]Step799:rank7, time: 0.030, per_step: 0.000300
Step899:rank2, time: 0.030, per_step: 0.000294
Step899:rank3, time: 0.030, per_step: 0.000297
Step799:rank1, time: 0.031, per_step: 0.000304
Step799:rank0, time: 0.034, per_step: 0.000335
Step899:rank5, time: 0.030, per_step: 0.000297
Step899:rank6, time: 0.029, per_step: 0.000285
Step899:rank4, time: 0.031, per_step: 0.000305
Step899:rank7, time: 0.030, per_step: 0.000296
Step999:rank2, time: 0.030, per_step: 0.000295
100%|██████████| 1000/1000 [00:02<00:00, 380.42it/s]
Step999:rank3, time: 0.030, per_step: 0.000296
100%|██████████| 1000/1000 [00:02<00:00, 380.25it/s]
Step899:rank1, time: 0.031, per_step: 0.000305
Step899:rank0, time: 0.031, per_step: 0.000307
Step999:rank5, time: 0.030, per_step: 0.000301
100%|██████████| 1000/1000 [00:02<00:00, 378.23it/s]
Step999:rank6, time: 0.030, per_step: 0.000293
100%|██████████| 1000/1000 [00:02<00:00, 377.90it/s]
Step999:rank4, time: 0.032, per_step: 0.000313
100%|██████████| 1000/1000 [00:02<00:00, 377.20it/s]
Step999:rank7, time: 0.034, per_step: 0.000337
100%|██████████| 1000/1000 [00:02<00:00, 376.13it/s]
Step999:rank1, time: 0.032, per_step: 0.000317
100%|██████████| 1000/1000 [00:02<00:00, 374.72it/s]
Step999:rank0, time: 0.033, per_step: 0.000322
100%|██████████| 1000/1000 [00:02<00:00, 374.41it/s]
Worker 7 pid=27433
Successfully xmh

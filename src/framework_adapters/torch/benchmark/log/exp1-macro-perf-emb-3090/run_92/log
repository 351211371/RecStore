perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f4fcf2a6e50>==========
Worker 0 pid=33926
Worker 1 pid=33927
Worker 2 pid=33928
Worker 3 pid=33929
Worker 4 pid=33932
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<02:22,  7.01it/s]Step99:rank0, time: 0.205, per_step: 0.002055
 18%|█▊        | 184/1000 [00:00<00:00, 918.62it/s]Step199:rank0, time: 0.055, per_step: 0.000547
Step299:rank0, time: 0.051, per_step: 0.000509
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s] 32%|███▏      | 315/1000 [00:00<00:00, 812.44it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  5%|▌         | 53/1000 [00:00<00:01, 474.26it/s]  6%|▌         | 61/1000 [00:00<00:01, 608.76it/s]  4%|▍         | 43/1000 [00:00<00:02, 330.92it/s]  6%|▋         | 65/1000 [00:00<00:01, 549.68it/s]Step99:rank3, time: 0.197, per_step: 0.001970
Step99:rank4, time: 0.182, per_step: 0.001825
  5%|▍         | 47/1000 [00:00<00:02, 437.22it/s]Step99:rank1, time: 0.159, per_step: 0.001589
 12%|█▎        | 125/1000 [00:00<00:01, 598.27it/s]Step99:rank2, time: 0.206, per_step: 0.002060
 16%|█▋        | 163/1000 [00:00<00:01, 783.39it/s]Step399:rank0, time: 0.334, per_step: 0.003307
  8%|▊         | 80/1000 [00:00<00:02, 346.79it/s] 41%|████      | 407/1000 [00:00<00:00, 621.03it/s] 13%|█▎        | 132/1000 [00:00<00:01, 619.98it/s]Step99:rank5, time: 0.265, per_step: 0.002650
Step199:rank4, time: 0.078, per_step: 0.000768
Step199:rank3, time: 0.097, per_step: 0.000961
Step199:rank2, time: 0.052, per_step: 0.000513
 21%|██        | 210/1000 [00:00<00:00, 1116.08it/s]Step499:rank0, time: 0.050, per_step: 0.000492
Step299:rank4, time: 0.042, per_step: 0.000412
Step199:rank1, time: 0.109, per_step: 0.001083
Step199:rank5, time: 0.051, per_step: 0.000508
Step299:rank3, time: 0.040, per_step: 0.000392
 32%|███▏      | 320/1000 [00:00<00:00, 1191.76it/s]Step299:rank2, time: 0.041, per_step: 0.000405
Step599:rank0, time: 0.038, per_step: 0.000377
Step399:rank4, time: 0.036, per_step: 0.000354
Step299:rank1, time: 0.036, per_step: 0.000358
Step299:rank5, time: 0.036, per_step: 0.000357
 42%|████▏     | 418/1000 [00:00<00:00, 1557.23it/s] 31%|███       | 307/1000 [00:00<00:00, 1163.03it/s]Step399:rank3, time: 0.035, per_step: 0.000346
 64%|██████▍   | 644/1000 [00:00<00:00, 1048.41it/s] 35%|███▍      | 347/1000 [00:00<00:00, 1288.40it/s]Step399:rank2, time: 0.036, per_step: 0.000355
Step699:rank0, time: 0.036, per_step: 0.000361
Step399:rank1, time: 0.036, per_step: 0.000359
Step499:rank4, time: 0.040, per_step: 0.000394
Step399:rank5, time: 0.036, per_step: 0.000353
Step499:rank3, time: 0.035, per_step: 0.000343
 48%|████▊     | 479/1000 [00:00<00:00, 1820.61it/s]Step499:rank2, time: 0.036, per_step: 0.000358
Step799:rank0, time: 0.036, per_step: 0.000356
Step499:rank1, time: 0.036, per_step: 0.000355
Step599:rank4, time: 0.035, per_step: 0.000350
Step599:rank3, time: 0.034, per_step: 0.000341
Step499:rank5, time: 0.041, per_step: 0.000408
 61%|██████    | 609/1000 [00:00<00:00, 1845.04it/s]Step599:rank2, time: 0.042, per_step: 0.000418
Step899:rank0, time: 0.036, per_step: 0.000356
 69%|██████▉   | 688/1000 [00:00<00:00, 1997.01it/s] 57%|█████▋    | 572/1000 [00:00<00:00, 1722.34it/s]Step699:rank4, time: 0.036, per_step: 0.000354
 92%|█████████▏| 921/1000 [00:00<00:00, 1494.07it/s]Step699:rank3, time: 0.035, per_step: 0.000347
Step599:rank1, time: 0.043, per_step: 0.000422
 61%|██████    | 606/1000 [00:00<00:00, 1788.13it/s]Step599:rank5, time: 0.036, per_step: 0.000357
Step699:rank2, time: 0.036, per_step: 0.000356
Step999:rank0, time: 0.036, per_step: 0.000360
100%|██████████| 1000/1000 [00:00<00:00, 1151.32it/s]
Step799:rank4, time: 0.036, per_step: 0.000354
Step799:rank3, time: 0.035, per_step: 0.000349
 74%|███████▎  | 736/1000 [00:00<00:00, 2111.95it/s]Step699:rank1, time: 0.037, per_step: 0.000370
Step699:rank5, time: 0.036, per_step: 0.000360
Step799:rank2, time: 0.038, per_step: 0.000377
 88%|████████▊ | 875/1000 [00:00<00:00, 2132.37it/s]Step899:rank4, time: 0.037, per_step: 0.000366
Step799:rank1, time: 0.037, per_step: 0.000367
Step799:rank5, time: 0.037, per_step: 0.000369
Step899:rank3, time: 0.042, per_step: 0.000418
 96%|█████████▌| 961/1000 [00:00<00:00, 2256.99it/s] 84%|████████▍ | 843/1000 [00:00<00:00, 2067.51it/s]Step899:rank2, time: 0.036, per_step: 0.000360
 88%|████████▊ | 876/1000 [00:00<00:00, 2111.30it/s]Step999:rank4, time: 0.038, per_step: 0.000371
100%|██████████| 1000/1000 [00:00<00:00, 1874.26it/s]
Step899:rank1, time: 0.037, per_step: 0.000367
Step999:rank3, time: 0.037, per_step: 0.000367
100%|██████████| 1000/1000 [00:00<00:00, 1776.85it/s]
Step899:rank5, time: 0.038, per_step: 0.000380
Step999:rank2, time: 0.038, per_step: 0.000375
100%|██████████| 1000/1000 [00:00<00:00, 1974.83it/s]
Step999:rank1, time: 0.039, per_step: 0.000382
100%|██████████| 1000/1000 [00:00<00:00, 1779.52it/s]
Step999:rank5, time: 0.038, per_step: 0.000371
100%|██████████| 1000/1000 [00:00<00:00, 1686.84it/s]
Worker 5 pid=33936
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f5f60110e50>==========
Worker 0 pid=55874
Worker 1 pid=55875
Worker 2 pid=55876
Worker 3 pid=55877
Worker 4 pid=55878
Worker 5 pid=55879
Worker 6 pid=55880
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:02<39:41,  2.38s/it]  0%|          | 1/1000 [00:02<39:48,  2.39s/it]  0%|          | 1/1000 [00:02<39:58,  2.40s/it]  0%|          | 1/1000 [00:02<40:05,  2.41s/it]  0%|          | 1/1000 [00:02<40:13,  2.42s/it]  0%|          | 1/1000 [00:02<40:16,  2.42s/it]  0%|          | 1/1000 [00:02<40:38,  2.44s/it]  0%|          | 1/1000 [00:02<41:11,  2.47s/it]  3%|▎         | 28/1000 [00:02<01:02, 15.65it/s]  3%|▎         | 28/1000 [00:02<01:02, 15.60it/s]  3%|▎         | 28/1000 [00:02<01:02, 15.55it/s]  3%|▎         | 28/1000 [00:02<01:02, 15.51it/s]  2%|▏         | 24/1000 [00:02<01:13, 13.22it/s]  3%|▎         | 29/1000 [00:02<01:00, 15.98it/s]  3%|▎         | 29/1000 [00:02<01:01, 15.85it/s]  3%|▎         | 29/1000 [00:02<01:02, 15.64it/s]  6%|▋         | 63/1000 [00:02<00:23, 40.58it/s]  6%|▋         | 63/1000 [00:02<00:23, 40.44it/s]  6%|▋         | 63/1000 [00:02<00:23, 40.34it/s]  6%|▋         | 63/1000 [00:02<00:23, 40.20it/s]  6%|▌         | 58/1000 [00:02<00:25, 37.32it/s]  6%|▋         | 64/1000 [00:02<00:23, 40.57it/s]  6%|▋         | 64/1000 [00:02<00:23, 40.28it/s]Step99:rank1, time: 2.693, per_step: 0.026931
  6%|▋         | 63/1000 [00:02<00:23, 39.07it/s]Step99:rank7, time: 2.701, per_step: 0.027013
 10%|█         | 105/1000 [00:02<00:11, 76.92it/s]Step99:rank0, time: 2.709, per_step: 0.027086
 10%|█         | 105/1000 [00:02<00:11, 76.82it/s]Step99:rank2, time: 2.720, per_step: 0.027195
 10%|█         | 105/1000 [00:02<00:11, 76.69it/s]Step99:rank4, time: 2.725, per_step: 0.027253
 10%|█         | 104/1000 [00:02<00:11, 75.48it/s] 10%|▉         | 99/1000 [00:02<00:12, 72.73it/s]Step99:rank6, time: 2.739, per_step: 0.027387
 11%|█         | 107/1000 [00:02<00:11, 77.54it/s]Step99:rank5, time: 2.746, per_step: 0.027462
 11%|█         | 107/1000 [00:02<00:11, 77.01it/s]Step99:rank3, time: 2.785, per_step: 0.027853
 10%|█         | 104/1000 [00:02<00:12, 73.69it/s] 15%|█▍        | 148/1000 [00:02<00:07, 119.40it/s] 16%|█▌        | 157/1000 [00:02<00:06, 130.00it/s] 16%|█▌        | 158/1000 [00:02<00:06, 130.97it/s] 16%|█▌        | 155/1000 [00:02<00:06, 127.44it/s] 15%|█▍        | 149/1000 [00:02<00:06, 123.64it/s] 16%|█▌        | 159/1000 [00:02<00:06, 130.37it/s] 16%|█▌        | 160/1000 [00:02<00:06, 130.74it/s]Step199:rank7, time: 0.181, per_step: 0.001787
Step199:rank0, time: 0.179, per_step: 0.001773
Step199:rank1, time: 0.199, per_step: 0.001968
 15%|█▌        | 154/1000 [00:02<00:06, 123.71it/s]Step199:rank2, time: 0.183, per_step: 0.001813
Step199:rank4, time: 0.180, per_step: 0.001785
 21%|██        | 211/1000 [00:02<00:04, 194.02it/s] 22%|██▏       | 223/1000 [00:02<00:03, 207.70it/s]Step199:rank6, time: 0.183, per_step: 0.001815
 22%|██▎       | 225/1000 [00:02<00:03, 209.66it/s]Step199:rank5, time: 0.178, per_step: 0.001762
 22%|██▏       | 220/1000 [00:02<00:03, 203.44it/s] 21%|██        | 211/1000 [00:02<00:04, 195.98it/s] 23%|██▎       | 226/1000 [00:02<00:03, 208.82it/s] 23%|██▎       | 228/1000 [00:02<00:03, 210.34it/s]Step199:rank3, time: 0.196, per_step: 0.001936
 21%|██        | 209/1000 [00:02<00:04, 184.67it/s]Step299:rank7, time: 0.122, per_step: 0.001212
Step299:rank0, time: 0.120, per_step: 0.001184
 29%|██▉       | 294/1000 [00:02<00:02, 303.93it/s] 31%|███       | 310/1000 [00:02<00:02, 321.98it/s]Step299:rank1, time: 0.123, per_step: 0.001216
 32%|███▏      | 316/1000 [00:03<00:02, 330.24it/s]Step299:rank2, time: 0.124, per_step: 0.001225
Step299:rank4, time: 0.121, per_step: 0.001201
 30%|███       | 305/1000 [00:03<00:02, 314.76it/s] 29%|██▉       | 294/1000 [00:03<00:02, 304.79it/s] 32%|███▏      | 315/1000 [00:03<00:02, 326.09it/s]Step299:rank5, time: 0.120, per_step: 0.001185
Step299:rank6, time: 0.123, per_step: 0.001220
 32%|███▏      | 320/1000 [00:03<00:02, 331.81it/s]Step399:rank0, time: 0.084, per_step: 0.000836
Step399:rank7, time: 0.089, per_step: 0.000876
 29%|██▉       | 290/1000 [00:03<00:02, 290.73it/s]Step399:rank1, time: 0.084, per_step: 0.000836
Step299:rank3, time: 0.127, per_step: 0.001262
 41%|████▏     | 413/1000 [00:03<00:01, 479.41it/s]Step399:rank2, time: 0.086, per_step: 0.000849
Step399:rank4, time: 0.086, per_step: 0.000847
 43%|████▎     | 430/1000 [00:03<00:01, 495.56it/s] 45%|████▍     | 447/1000 [00:03<00:01, 523.81it/s]Step399:rank5, time: 0.084, per_step: 0.000831
 43%|████▎     | 428/1000 [00:03<00:01, 495.12it/s]Step399:rank6, time: 0.087, per_step: 0.000866
 41%|████      | 409/1000 [00:03<00:01, 471.05it/s] 44%|████▍     | 443/1000 [00:03<00:01, 514.08it/s]Step499:rank0, time: 0.063, per_step: 0.000628
Step499:rank7, time: 0.068, per_step: 0.000676
Step499:rank1, time: 0.064, per_step: 0.000632
 45%|████▌     | 452/1000 [00:03<00:01, 525.88it/s]Step499:rank4, time: 0.064, per_step: 0.000631
Step499:rank2, time: 0.065, per_step: 0.000645
Step499:rank5, time: 0.064, per_step: 0.000632
Step399:rank3, time: 0.087, per_step: 0.000862
Step499:rank6, time: 0.065, per_step: 0.000644
 40%|████      | 404/1000 [00:03<00:01, 456.04it/s]Step599:rank0, time: 0.051, per_step: 0.000505
 59%|█████▉    | 589/1000 [00:03<00:00, 761.62it/s]Step599:rank1, time: 0.051, per_step: 0.000505
Step599:rank7, time: 0.054, per_step: 0.000538
 60%|██████    | 600/1000 [00:03<00:00, 760.32it/s] 64%|██████▍   | 638/1000 [00:03<00:00, 828.90it/s]Step599:rank4, time: 0.051, per_step: 0.000506
Step599:rank2, time: 0.052, per_step: 0.000514
 61%|██████    | 606/1000 [00:03<00:00, 777.28it/s] 58%|█████▊    | 577/1000 [00:03<00:00, 736.60it/s] 63%|██████▎   | 632/1000 [00:03<00:00, 816.40it/s]Step599:rank5, time: 0.051, per_step: 0.000503
Step699:rank0, time: 0.043, per_step: 0.000430
Step599:rank6, time: 0.053, per_step: 0.000528
Step699:rank1, time: 0.044, per_step: 0.000432
Step499:rank3, time: 0.066, per_step: 0.000658
Step699:rank7, time: 0.048, per_step: 0.000471
 65%|██████▍   | 646/1000 [00:03<00:00, 835.70it/s]Step699:rank4, time: 0.044, per_step: 0.000439
Step699:rank2, time: 0.045, per_step: 0.000446
Step699:rank5, time: 0.044, per_step: 0.000431
Step799:rank0, time: 0.039, per_step: 0.000385
Step799:rank1, time: 0.038, per_step: 0.000381
Step699:rank6, time: 0.045, per_step: 0.000450
 57%|█████▋    | 567/1000 [00:03<00:00, 711.62it/s]Step799:rank7, time: 0.042, per_step: 0.000420
 84%|████████▎ | 835/1000 [00:03<00:00, 1167.65it/s]Step799:rank4, time: 0.039, per_step: 0.000387
Step799:rank2, time: 0.040, per_step: 0.000395
Step599:rank3, time: 0.054, per_step: 0.000531
 82%|████████▎ | 825/1000 [00:03<00:00, 1116.67it/s] 90%|████████▉ | 899/1000 [00:03<00:00, 1254.09it/s]Step899:rank0, time: 0.036, per_step: 0.000353
Step799:rank5, time: 0.038, per_step: 0.000380
Step899:rank1, time: 0.036, per_step: 0.000354
 85%|████████▍ | 848/1000 [00:03<00:00, 1169.31it/s]Step799:rank6, time: 0.041, per_step: 0.000404
 80%|████████  | 805/1000 [00:03<00:00, 1104.65it/s] 89%|████████▊ | 886/1000 [00:03<00:00, 1227.47it/s]Step899:rank7, time: 0.040, per_step: 0.000393
Step899:rank4, time: 0.037, per_step: 0.000364
Step899:rank2, time: 0.038, per_step: 0.000372
Step999:rank0, time: 0.034, per_step: 0.000336
100%|██████████| 1000/1000 [00:03<00:00, 299.23it/s]
Step899:rank5, time: 0.036, per_step: 0.000352
Step699:rank3, time: 0.045, per_step: 0.000449
 91%|█████████ | 910/1000 [00:03<00:00, 1265.30it/s]Step999:rank1, time: 0.034, per_step: 0.000338
100%|██████████| 1000/1000 [00:03<00:00, 298.52it/s]
Step899:rank6, time: 0.039, per_step: 0.000385
Step999:rank4, time: 0.035, per_step: 0.000349
100%|██████████| 1000/1000 [00:03<00:00, 297.04it/s]
Step999:rank7, time: 0.039, per_step: 0.000385
100%|██████████| 1000/1000 [00:03<00:00, 296.90it/s]
Step999:rank2, time: 0.037, per_step: 0.000362
100%|██████████| 1000/1000 [00:03<00:00, 296.56it/s]
Step999:rank5, time: 0.035, per_step: 0.000347
100%|██████████| 1000/1000 [00:03<00:00, 295.95it/s]
 79%|███████▉  | 791/1000 [00:03<00:00, 1073.64it/s]Step799:rank3, time: 0.042, per_step: 0.000413
Step999:rank6, time: 0.037, per_step: 0.000369
100%|██████████| 1000/1000 [00:03<00:00, 294.33it/s]
Step899:rank3, time: 0.038, per_step: 0.000381
Step999:rank3, time: 0.036, per_step: 0.000361
100%|██████████| 1000/1000 [00:03<00:00, 288.90it/s]
Worker 7 pid=55881
Successfully xmh

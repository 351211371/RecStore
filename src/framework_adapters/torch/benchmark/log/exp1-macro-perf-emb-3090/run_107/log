perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f2871707e50>==========
Worker 0 pid=9941
Worker 1 pid=9942
Worker 2 pid=9943
Worker 3 pid=9944
Worker 4 pid=9945
Worker 5 pid=9946
Worker 6 pid=9947
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank3, time: 0.083, per_step: 0.000834
 13%|█▎        | 131/1000 [00:00<00:00, 1295.28it/s]Step199:rank3, time: 0.075, per_step: 0.000744
 30%|██▉       | 299/1000 [00:00<00:00, 1518.24it/s]Step299:rank3, time: 0.060, per_step: 0.000590
Step399:rank3, time: 0.043, per_step: 0.000428
Step499:rank3, time: 0.043, per_step: 0.000422
 53%|█████▎    | 531/1000 [00:00<00:00, 1882.47it/s]Step599:rank3, time: 0.043, per_step: 0.000424
Step699:rank3, time: 0.043, per_step: 0.000421
 77%|███████▋  | 766/1000 [00:00<00:00, 2064.79it/s]Step799:rank3, time: 0.043, per_step: 0.000423
Step899:rank3, time: 0.042, per_step: 0.000419
Step999:rank3, time: 0.042, per_step: 0.000420
100%|██████████| 1000/1000 [00:00<00:00, 1994.68it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<04:15,  3.92it/s]  0%|          | 1/1000 [00:00<04:01,  4.13it/s]  0%|          | 1/1000 [00:00<03:56,  4.22it/s]  0%|          | 1/1000 [00:00<03:41,  4.51it/s]  0%|          | 1/1000 [00:00<04:57,  3.36it/s]  0%|          | 1/1000 [00:00<05:15,  3.17it/s]  2%|▏         | 22/1000 [00:00<00:12, 79.49it/s]  0%|          | 1/1000 [00:00<04:31,  3.68it/s]  3%|▎         | 27/1000 [00:00<00:11, 88.18it/s]  2%|▏         | 22/1000 [00:00<00:13, 73.97it/s]  2%|▏         | 24/1000 [00:00<00:11, 83.63it/s]  3%|▎         | 28/1000 [00:00<00:10, 88.37it/s]  6%|▌         | 55/1000 [00:00<00:05, 164.98it/s]  3%|▎         | 28/1000 [00:00<00:11, 82.41it/s]  5%|▍         | 47/1000 [00:00<00:05, 160.58it/s]  6%|▌         | 58/1000 [00:00<00:05, 167.19it/s]  6%|▌         | 62/1000 [00:00<00:05, 162.43it/s]Step99:rank0, time: 0.408, per_step: 0.004076
Step99:rank6, time: 0.498, per_step: 0.004984
Step99:rank1, time: 0.493, per_step: 0.004930
Step99:rank7, time: 0.529, per_step: 0.005286
Step99:rank2, time: 0.438, per_step: 0.004376
Step99:rank5, time: 0.518, per_step: 0.005176
Step99:rank4, time: 0.492, per_step: 0.004918
 13%|█▎        | 128/1000 [00:00<00:02, 403.49it/s] 11%|█         | 112/1000 [00:00<00:02, 323.47it/s] 20%|█▉        | 196/1000 [00:00<00:01, 573.16it/s] 18%|█▊        | 181/1000 [00:00<00:01, 513.60it/s]Step199:rank6, time: 0.057, per_step: 0.000560
Step199:rank0, time: 0.063, per_step: 0.000625
Step199:rank7, time: 0.048, per_step: 0.000475
Step199:rank1, time: 0.053, per_step: 0.000523
 22%|██▏       | 218/1000 [00:00<00:01, 670.48it/s]Step199:rank2, time: 0.056, per_step: 0.000550
 16%|█▌        | 161/1000 [00:00<00:01, 441.46it/s] 27%|██▋       | 269/1000 [00:00<00:00, 737.19it/s]Step299:rank6, time: 0.042, per_step: 0.000418
Step299:rank0, time: 0.044, per_step: 0.000435
Step299:rank7, time: 0.043, per_step: 0.000425
Step199:rank5, time: 0.083, per_step: 0.000823
Step299:rank1, time: 0.043, per_step: 0.000424
Step199:rank4, time: 0.088, per_step: 0.000870
Step299:rank2, time: 0.043, per_step: 0.000423
 34%|███▍      | 342/1000 [00:00<00:00, 965.07it/s]Step399:rank6, time: 0.043, per_step: 0.000424
 26%|██▋       | 265/1000 [00:00<00:01, 695.69it/s]Step399:rank0, time: 0.044, per_step: 0.000438
Step399:rank7, time: 0.043, per_step: 0.000426
Step399:rank1, time: 0.044, per_step: 0.000432
 43%|████▎     | 430/1000 [00:00<00:00, 1136.75it/s] 41%|████      | 412/1000 [00:00<00:00, 1049.29it/s]Step299:rank4, time: 0.044, per_step: 0.000437
Step399:rank2, time: 0.043, per_step: 0.000429
Step299:rank5, time: 0.057, per_step: 0.000560
 44%|████▍     | 445/1000 [00:00<00:00, 1181.12it/s] 33%|███▎      | 327/1000 [00:00<00:00, 821.39it/s]Step499:rank6, time: 0.043, per_step: 0.000426
Step499:rank0, time: 0.044, per_step: 0.000436
Step499:rank7, time: 0.043, per_step: 0.000424
 50%|█████     | 502/1000 [00:00<00:00, 1215.90it/s]Step499:rank1, time: 0.043, per_step: 0.000430
Step399:rank4, time: 0.042, per_step: 0.000418
Step499:rank2, time: 0.043, per_step: 0.000422
Step399:rank5, time: 0.056, per_step: 0.000553
Step599:rank6, time: 0.042, per_step: 0.000416
Step599:rank0, time: 0.044, per_step: 0.000431
 58%|█████▊    | 576/1000 [00:00<00:00, 1398.67it/s]Step599:rank7, time: 0.043, per_step: 0.000424
Step599:rank1, time: 0.043, per_step: 0.000427
Step499:rank4, time: 0.042, per_step: 0.000418
 50%|█████     | 501/1000 [00:00<00:00, 1205.00it/s]Step599:rank2, time: 0.043, per_step: 0.000425
 66%|██████▋   | 665/1000 [00:00<00:00, 1516.24it/s] 64%|██████▍   | 643/1000 [00:00<00:00, 1424.81it/s] 67%|██████▋   | 673/1000 [00:00<00:00, 1525.53it/s]Step699:rank6, time: 0.043, per_step: 0.000427
Step499:rank5, time: 0.057, per_step: 0.000560
Step699:rank7, time: 0.043, per_step: 0.000428
Step699:rank0, time: 0.044, per_step: 0.000440
 50%|█████     | 505/1000 [00:00<00:00, 1116.07it/s]Step699:rank1, time: 0.044, per_step: 0.000434
Step599:rank4, time: 0.043, per_step: 0.000423
Step699:rank2, time: 0.043, per_step: 0.000427
 72%|███████▏  | 716/1000 [00:00<00:00, 1488.90it/s]Step799:rank6, time: 0.042, per_step: 0.000418
Step799:rank0, time: 0.043, per_step: 0.000428
Step799:rank1, time: 0.043, per_step: 0.000423
Step699:rank4, time: 0.042, per_step: 0.000416
Step799:rank2, time: 0.042, per_step: 0.000420
Step599:rank5, time: 0.056, per_step: 0.000552
 81%|████████  | 810/1000 [00:00<00:00, 1689.20it/s]Step799:rank7, time: 0.062, per_step: 0.000609
 74%|███████▍  | 738/1000 [00:00<00:00, 1558.12it/s]Step899:rank6, time: 0.042, per_step: 0.000418
 90%|█████████ | 902/1000 [00:00<00:00, 1777.82it/s] 88%|████████▊ | 876/1000 [00:00<00:00, 1693.98it/s]Step899:rank0, time: 0.044, per_step: 0.000432
 90%|█████████ | 903/1000 [00:00<00:00, 1763.70it/s]Step899:rank1, time: 0.043, per_step: 0.000429
Step799:rank4, time: 0.042, per_step: 0.000418
Step899:rank2, time: 0.043, per_step: 0.000422
 68%|██████▊   | 679/1000 [00:00<00:00, 1306.23it/s]Step899:rank7, time: 0.042, per_step: 0.000418
Step699:rank5, time: 0.059, per_step: 0.000585
 93%|█████████▎| 929/1000 [00:00<00:00, 1680.66it/s]Step999:rank6, time: 0.042, per_step: 0.000421
100%|██████████| 1000/1000 [00:00<00:00, 1124.60it/s]
Step999:rank0, time: 0.045, per_step: 0.000443
100%|██████████| 1000/1000 [00:00<00:00, 1224.62it/s]
Step999:rank1, time: 0.044, per_step: 0.000438
100%|██████████| 1000/1000 [00:00<00:00, 1127.42it/s]
Step999:rank2, time: 0.045, per_step: 0.000442
100%|██████████| 1000/1000 [00:00<00:00, 1198.74it/s]
Step899:rank4, time: 0.048, per_step: 0.000479
Step999:rank7, time: 0.049, per_step: 0.000490
100%|██████████| 1000/1000 [00:00<00:00, 1067.02it/s]
 96%|█████████▌| 957/1000 [00:00<00:00, 1748.91it/s]Step799:rank5, time: 0.060, per_step: 0.000594
Step999:rank4, time: 0.045, per_step: 0.000441
100%|██████████| 1000/1000 [00:00<00:00, 1083.78it/s]
 85%|████████▍ | 848/1000 [00:00<00:00, 1421.16it/s]Step899:rank5, time: 0.059, per_step: 0.000584
Step999:rank5, time: 0.058, per_step: 0.000575
100%|██████████| 1000/1000 [00:01<00:00, 947.51it/s]
Worker 7 pid=9948
Successfully xmh

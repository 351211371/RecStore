perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fc0e4904e50>==========
Worker 0 pid=19799
Worker 1 pid=19800
Worker 2 pid=19801
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<06:40,  2.50it/s]  0%|          | 1/1000 [00:00<10:33,  1.58it/s]  0%|          | 1/1000 [00:00<09:32,  1.75it/s]  0%|          | 1/1000 [00:00<08:42,  1.91it/s]  2%|▏         | 19/1000 [00:00<00:28, 34.15it/s]  2%|▏         | 19/1000 [00:00<00:20, 48.72it/s]  2%|▏         | 19/1000 [00:00<00:24, 39.83it/s]  2%|▏         | 19/1000 [00:00<00:26, 37.07it/s]  4%|▍         | 39/1000 [00:00<00:13, 72.93it/s]  4%|▍         | 39/1000 [00:00<00:10, 89.55it/s]  4%|▍         | 39/1000 [00:00<00:14, 68.35it/s]  4%|▍         | 39/1000 [00:00<00:12, 77.06it/s]  7%|▋         | 66/1000 [00:00<00:08, 113.66it/s]  7%|▋         | 66/1000 [00:00<00:06, 138.90it/s]  7%|▋         | 66/1000 [00:00<00:07, 119.37it/s]  7%|▋         | 66/1000 [00:00<00:07, 124.41it/s]  9%|▉         | 91/1000 [00:01<00:06, 145.79it/s]  9%|▉         | 91/1000 [00:00<00:05, 168.78it/s]  9%|▉         | 91/1000 [00:00<00:06, 151.23it/s]  9%|▉         | 91/1000 [00:00<00:05, 155.92it/s]Step99:rank0, time: 0.873, per_step: 0.008734
Step99:rank3, time: 1.097, per_step: 0.010969
Step99:rank2, time: 1.033, per_step: 0.010329
Step99:rank1, time: 0.982, per_step: 0.009825
 12%|█▏        | 120/1000 [00:01<00:04, 181.45it/s] 12%|█▏        | 120/1000 [00:01<00:04, 186.41it/s] 12%|█▏        | 120/1000 [00:00<00:04, 201.68it/s] 12%|█▏        | 120/1000 [00:01<00:04, 190.56it/s] 15%|█▌        | 150/1000 [00:01<00:03, 228.82it/s] 15%|█▌        | 150/1000 [00:01<00:04, 212.05it/s] 15%|█▌        | 150/1000 [00:01<00:03, 216.25it/s] 15%|█▌        | 150/1000 [00:01<00:03, 219.72it/s] 18%|█▊        | 180/1000 [00:01<00:03, 235.61it/s] 18%|█▊        | 180/1000 [00:01<00:03, 248.77it/s] 18%|█▊        | 180/1000 [00:01<00:03, 238.94it/s] 18%|█▊        | 180/1000 [00:01<00:03, 241.71it/s]Step199:rank0, time: 0.341, per_step: 0.003380
Step199:rank3, time: 0.341, per_step: 0.003380
Step199:rank2, time: 0.341, per_step: 0.003380
Step199:rank1, time: 0.341, per_step: 0.003380
 21%|██        | 211/1000 [00:01<00:03, 254.38it/s] 21%|██        | 211/1000 [00:01<00:02, 264.34it/s] 21%|██        | 211/1000 [00:01<00:03, 256.92it/s] 21%|██        | 211/1000 [00:01<00:03, 259.02it/s] 24%|██▍       | 242/1000 [00:01<00:02, 268.73it/s] 24%|██▍       | 242/1000 [00:01<00:02, 276.12it/s] 24%|██▍       | 242/1000 [00:01<00:02, 270.64it/s] 24%|██▍       | 242/1000 [00:01<00:02, 272.21it/s] 27%|██▋       | 272/1000 [00:01<00:02, 276.72it/s] 27%|██▋       | 272/1000 [00:01<00:02, 278.13it/s] 27%|██▋       | 272/1000 [00:01<00:02, 279.27it/s] 27%|██▋       | 272/1000 [00:01<00:02, 282.06it/s]Step299:rank1, time: 0.338, per_step: 0.003342
Step299:rank0, time: 0.338, per_step: 0.003343
Step299:rank3, time: 0.338, per_step: 0.003343
Step299:rank2, time: 0.338, per_step: 0.003343
 30%|███       | 301/1000 [00:01<00:02, 279.51it/s] 30%|███       | 301/1000 [00:01<00:02, 283.32it/s] 30%|███       | 301/1000 [00:01<00:02, 280.52it/s] 30%|███       | 301/1000 [00:01<00:02, 281.33it/s] 33%|███▎      | 331/1000 [00:01<00:02, 286.72it/s] 33%|███▎      | 331/1000 [00:01<00:02, 284.72it/s] 33%|███▎      | 331/1000 [00:01<00:02, 285.29it/s] 33%|███▎      | 331/1000 [00:01<00:02, 283.99it/s] 36%|███▌      | 362/1000 [00:01<00:02, 289.46it/s] 36%|███▌      | 362/1000 [00:01<00:02, 291.40it/s] 36%|███▌      | 362/1000 [00:01<00:02, 289.97it/s] 36%|███▌      | 362/1000 [00:01<00:02, 290.35it/s] 39%|███▉      | 393/1000 [00:01<00:02, 295.01it/s] 39%|███▉      | 393/1000 [00:01<00:02, 294.33it/s] 39%|███▉      | 393/1000 [00:02<00:02, 293.61it/s] 39%|███▉      | 393/1000 [00:02<00:02, 294.00it/s]Step399:rank0, time: 0.333, per_step: 0.003295
Step399:rank2, time: 0.333, per_step: 0.003295
Step399:rank3, time: 0.333, per_step: 0.003295
Step399:rank1, time: 0.333, per_step: 0.003296
 42%|████▏     | 423/1000 [00:02<00:02, 283.67it/s] 42%|████▏     | 423/1000 [00:02<00:02, 283.91it/s] 42%|████▏     | 423/1000 [00:01<00:02, 284.53it/s] 42%|████▏     | 423/1000 [00:02<00:02, 284.03it/s] 45%|████▌     | 452/1000 [00:02<00:01, 285.06it/s] 45%|████▌     | 452/1000 [00:02<00:01, 285.34it/s] 45%|████▌     | 452/1000 [00:02<00:01, 285.68it/s] 45%|████▌     | 452/1000 [00:02<00:01, 285.17it/s] 48%|████▊     | 482/1000 [00:02<00:01, 288.25it/s] 48%|████▊     | 482/1000 [00:02<00:01, 287.76it/s] 48%|████▊     | 482/1000 [00:02<00:01, 287.91it/s] 48%|████▊     | 482/1000 [00:02<00:01, 288.01it/s]Step499:rank1, time: 0.355, per_step: 0.003519
Step499:rank0, time: 0.355, per_step: 0.003520
Step499:rank2, time: 0.356, per_step: 0.003520
Step499:rank3, time: 0.356, per_step: 0.003520
 51%|█████     | 512/1000 [00:02<00:01, 290.39it/s] 51%|█████     | 512/1000 [00:02<00:01, 290.50it/s] 51%|█████     | 512/1000 [00:02<00:01, 290.23it/s] 51%|█████     | 512/1000 [00:02<00:01, 290.11it/s] 54%|█████▍    | 542/1000 [00:02<00:01, 290.12it/s] 54%|█████▍    | 542/1000 [00:02<00:01, 290.01it/s] 54%|█████▍    | 542/1000 [00:02<00:01, 289.87it/s] 54%|█████▍    | 542/1000 [00:02<00:01, 289.91it/s] 57%|█████▋    | 572/1000 [00:02<00:01, 289.99it/s] 57%|█████▋    | 572/1000 [00:02<00:01, 289.80it/s] 57%|█████▋    | 572/1000 [00:02<00:01, 289.86it/s] 57%|█████▋    | 572/1000 [00:02<00:01, 289.90it/s]Step599:rank3, time: 0.348, per_step: 0.003444
Step599:rank0, time: 0.348, per_step: 0.003445
Step599:rank1, time: 0.348, per_step: 0.003445
Step599:rank2, time: 0.348, per_step: 0.003445
 60%|██████    | 602/1000 [00:02<00:01, 286.42it/s] 60%|██████    | 602/1000 [00:02<00:01, 286.45it/s] 60%|██████    | 602/1000 [00:02<00:01, 286.39it/s] 60%|██████    | 602/1000 [00:02<00:01, 286.33it/s] 63%|██████▎   | 631/1000 [00:02<00:01, 282.58it/s] 63%|██████▎   | 631/1000 [00:02<00:01, 282.53it/s] 63%|██████▎   | 631/1000 [00:02<00:01, 282.48it/s] 63%|██████▎   | 631/1000 [00:02<00:01, 282.48it/s] 66%|██████▌   | 660/1000 [00:02<00:01, 273.38it/s] 66%|██████▌   | 660/1000 [00:02<00:01, 273.40it/s] 66%|██████▌   | 660/1000 [00:02<00:01, 273.32it/s] 66%|██████▌   | 660/1000 [00:03<00:01, 273.37it/s] 69%|██████▉   | 691/1000 [00:03<00:01, 282.26it/s] 69%|██████▉   | 691/1000 [00:02<00:01, 282.26it/s] 69%|██████▉   | 691/1000 [00:03<00:01, 282.22it/s] 69%|██████▉   | 691/1000 [00:03<00:01, 282.20it/s]Step699:rank1, time: 0.362, per_step: 0.003588
Step699:rank0, time: 0.362, per_step: 0.003589
Step699:rank2, time: 0.362, per_step: 0.003589
Step699:rank3, time: 0.363, per_step: 0.003589
 72%|███████▏  | 720/1000 [00:03<00:00, 283.40it/s] 72%|███████▏  | 720/1000 [00:02<00:00, 283.41it/s] 72%|███████▏  | 720/1000 [00:03<00:00, 283.37it/s] 72%|███████▏  | 720/1000 [00:03<00:00, 283.41it/s] 75%|███████▍  | 749/1000 [00:03<00:00, 284.79it/s] 75%|███████▍  | 749/1000 [00:03<00:00, 284.80it/s] 75%|███████▍  | 749/1000 [00:03<00:00, 284.80it/s] 75%|███████▍  | 749/1000 [00:03<00:00, 284.81it/s] 78%|███████▊  | 780/1000 [00:03<00:00, 290.26it/s] 78%|███████▊  | 780/1000 [00:03<00:00, 290.27it/s] 78%|███████▊  | 780/1000 [00:03<00:00, 290.24it/s] 78%|███████▊  | 780/1000 [00:03<00:00, 290.23it/s]Step799:rank1, time: 0.340, per_step: 0.003366
Step799:rank0, time: 0.340, per_step: 0.003366
Step799:rank2, time: 0.340, per_step: 0.003366
Step799:rank3, time: 0.340, per_step: 0.003366
 81%|████████  | 810/1000 [00:03<00:00, 291.45it/s] 81%|████████  | 810/1000 [00:03<00:00, 291.43it/s] 81%|████████  | 810/1000 [00:03<00:00, 291.41it/s] 81%|████████  | 810/1000 [00:03<00:00, 289.16it/s] 84%|████████▍ | 840/1000 [00:03<00:00, 293.25it/s] 84%|████████▍ | 840/1000 [00:03<00:00, 293.23it/s] 84%|████████▍ | 840/1000 [00:03<00:00, 293.23it/s] 84%|████████▍ | 841/1000 [00:03<00:00, 293.93it/s] 87%|████████▋ | 870/1000 [00:03<00:00, 294.06it/s] 87%|████████▋ | 870/1000 [00:03<00:00, 294.09it/s] 87%|████████▋ | 870/1000 [00:03<00:00, 294.03it/s] 87%|████████▋ | 871/1000 [00:03<00:00, 294.56it/s]Step899:rank0, time: 0.333, per_step: 0.003299
Step899:rank1, time: 0.333, per_step: 0.003300
Step899:rank3, time: 0.333, per_step: 0.003300
Step899:rank2, time: 0.333, per_step: 0.003300
 90%|█████████ | 901/1000 [00:03<00:00, 297.09it/s] 90%|█████████ | 901/1000 [00:03<00:00, 297.06it/s] 90%|█████████ | 901/1000 [00:03<00:00, 297.04it/s] 90%|█████████ | 902/1000 [00:03<00:00, 297.38it/s] 93%|█████████▎| 932/1000 [00:03<00:00, 299.14it/s] 93%|█████████▎| 932/1000 [00:03<00:00, 299.14it/s] 93%|█████████▎| 932/1000 [00:03<00:00, 299.15it/s] 93%|█████████▎| 933/1000 [00:03<00:00, 297.20it/s] 96%|█████████▌| 962/1000 [00:03<00:00, 297.60it/s] 96%|█████████▌| 962/1000 [00:03<00:00, 297.58it/s] 96%|█████████▌| 962/1000 [00:03<00:00, 297.61it/s] 96%|█████████▋| 964/1000 [00:04<00:00, 298.52it/s] 99%|█████████▉| 992/1000 [00:04<00:00, 297.63it/s] 99%|█████████▉| 992/1000 [00:03<00:00, 297.63it/s] 99%|█████████▉| 992/1000 [00:04<00:00, 297.65it/s] 99%|█████████▉| 994/1000 [00:04<00:00, 298.26it/s]Step999:rank1, time: 0.338, per_step: 0.003350
Step999:rank2, time: 0.338, per_step: 0.003350
Step999:rank3, time: 0.338, per_step: 0.003350
Step999:rank0, time: 0.339, per_step: 0.003352
100%|██████████| 1000/1000 [00:04<00:00, 246.66it/s]100%|██████████| 1000/1000 [00:04<00:00, 243.67it/s]100%|██████████| 1000/1000 [00:04<00:00, 240.05it/s]100%|██████████| 1000/1000 [00:03<00:00, 254.34it/s]



Worker 3 pid=19802
Successfully xmh

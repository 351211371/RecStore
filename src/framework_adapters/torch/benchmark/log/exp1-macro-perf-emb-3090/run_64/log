perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f17d7ec7e50>==========
Worker 0 pid=25181
Worker 1 pid=25182
Worker 2 pid=25183
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<11:25,  1.46it/s]  0%|          | 1/1000 [00:00<09:07,  1.83it/s]  0%|          | 1/1000 [00:00<08:14,  2.02it/s]  0%|          | 1/1000 [00:00<05:51,  2.84it/s]  2%|▏         | 17/1000 [00:00<00:20, 48.05it/s]  2%|▏         | 17/1000 [00:00<00:28, 34.45it/s]  2%|▏         | 17/1000 [00:00<00:26, 37.32it/s]  2%|▏         | 17/1000 [00:00<00:34, 28.70it/s]  4%|▎         | 35/1000 [00:00<00:11, 86.46it/s]  4%|▎         | 36/1000 [00:00<00:13, 69.18it/s]  4%|▎         | 36/1000 [00:00<00:16, 59.98it/s]  4%|▎         | 36/1000 [00:00<00:13, 73.50it/s]  6%|▌         | 59/1000 [00:00<00:09, 96.72it/s]  6%|▌         | 59/1000 [00:00<00:08, 112.88it/s]  6%|▌         | 59/1000 [00:00<00:07, 129.25it/s]  6%|▌         | 59/1000 [00:00<00:08, 107.53it/s]  8%|▊         | 85/1000 [00:00<00:05, 165.99it/s]  8%|▊         | 85/1000 [00:01<00:06, 134.44it/s]  8%|▊         | 85/1000 [00:00<00:06, 146.02it/s]  8%|▊         | 85/1000 [00:00<00:06, 150.82it/s]Step99:rank0, time: 0.828, per_step: 0.008280
Step99:rank2, time: 0.971, per_step: 0.009715
Step99:rank3, time: 1.033, per_step: 0.010329
Step99:rank1, time: 1.161, per_step: 0.011607
 11%|█▏        | 113/1000 [00:01<00:05, 170.06it/s] 11%|█▏        | 113/1000 [00:00<00:04, 197.94it/s] 11%|█▏        | 113/1000 [00:01<00:04, 184.98it/s] 11%|█▏        | 113/1000 [00:01<00:04, 180.70it/s] 14%|█▍        | 140/1000 [00:01<00:04, 204.91it/s] 14%|█▍        | 140/1000 [00:00<00:03, 218.64it/s] 14%|█▍        | 140/1000 [00:01<00:04, 208.39it/s] 14%|█▍        | 140/1000 [00:01<00:04, 195.99it/s] 16%|█▋        | 164/1000 [00:01<00:03, 209.33it/s] 16%|█▋        | 164/1000 [00:01<00:04, 206.90it/s] 16%|█▋        | 164/1000 [00:01<00:04, 200.58it/s] 16%|█▋        | 164/1000 [00:01<00:03, 216.14it/s] 19%|█▉        | 189/1000 [00:01<00:03, 218.24it/s] 19%|█▉        | 189/1000 [00:01<00:03, 216.42it/s] 19%|█▉        | 189/1000 [00:01<00:03, 211.68it/s] 19%|█▉        | 189/1000 [00:01<00:03, 223.23it/s]Step199:rank2, time: 0.412, per_step: 0.004079
Step199:rank3, time: 0.412, per_step: 0.004080
Step199:rank1, time: 0.412, per_step: 0.004079
Step199:rank0, time: 0.412, per_step: 0.004082
 21%|██▏       | 214/1000 [00:01<00:03, 224.90it/s] 21%|██▏       | 214/1000 [00:01<00:03, 220.10it/s] 21%|██▏       | 214/1000 [00:01<00:03, 223.58it/s] 21%|██▏       | 214/1000 [00:01<00:03, 228.54it/s] 24%|██▍       | 238/1000 [00:01<00:03, 231.37it/s] 24%|██▍       | 239/1000 [00:01<00:03, 226.69it/s] 24%|██▍       | 239/1000 [00:01<00:03, 225.72it/s] 24%|██▍       | 239/1000 [00:01<00:03, 223.22it/s] 26%|██▌       | 262/1000 [00:01<00:03, 228.24it/s] 26%|██▋       | 263/1000 [00:01<00:03, 226.72it/s] 26%|██▋       | 263/1000 [00:01<00:03, 224.95it/s] 26%|██▋       | 263/1000 [00:01<00:03, 227.34it/s] 29%|██▉       | 289/1000 [00:01<00:02, 239.39it/s] 29%|██▉       | 290/1000 [00:01<00:02, 238.66it/s] 29%|██▉       | 290/1000 [00:01<00:02, 238.20it/s] 29%|██▉       | 290/1000 [00:01<00:02, 236.88it/s]Step299:rank3, time: 0.408, per_step: 0.004044
Step299:rank2, time: 0.408, per_step: 0.004044
Step299:rank1, time: 0.408, per_step: 0.004044
Step299:rank0, time: 0.408, per_step: 0.004042
 32%|███▏      | 316/1000 [00:01<00:02, 247.12it/s] 32%|███▏      | 317/1000 [00:01<00:02, 246.59it/s] 32%|███▏      | 317/1000 [00:01<00:02, 246.22it/s] 32%|███▏      | 317/1000 [00:02<00:02, 245.25it/s] 34%|███▍      | 343/1000 [00:01<00:02, 251.96it/s] 34%|███▍      | 344/1000 [00:02<00:02, 251.00it/s] 34%|███▍      | 344/1000 [00:02<00:02, 250.25it/s] 34%|███▍      | 344/1000 [00:01<00:02, 251.20it/s] 37%|███▋      | 371/1000 [00:01<00:02, 258.19it/s] 37%|███▋      | 372/1000 [00:02<00:02, 257.32it/s] 37%|███▋      | 372/1000 [00:02<00:02, 257.98it/s] 37%|███▋      | 372/1000 [00:02<00:02, 257.78it/s] 40%|███▉      | 399/1000 [00:02<00:02, 263.12it/s]Step399:rank2, time: 0.372, per_step: 0.003687
Step399:rank3, time: 0.372, per_step: 0.003688
Step399:rank1, time: 0.372, per_step: 0.003688
Step399:rank0, time: 0.372, per_step: 0.003688
 40%|████      | 400/1000 [00:02<00:02, 262.97it/s] 40%|████      | 400/1000 [00:02<00:02, 262.83it/s] 40%|████      | 400/1000 [00:02<00:02, 262.44it/s] 43%|████▎     | 427/1000 [00:02<00:02, 265.66it/s] 43%|████▎     | 427/1000 [00:02<00:02, 264.78it/s] 43%|████▎     | 428/1000 [00:02<00:02, 262.52it/s] 43%|████▎     | 428/1000 [00:02<00:02, 261.45it/s] 45%|████▌     | 454/1000 [00:02<00:02, 253.03it/s] 45%|████▌     | 454/1000 [00:02<00:02, 253.09it/s] 46%|████▌     | 455/1000 [00:02<00:02, 254.20it/s] 46%|████▌     | 455/1000 [00:02<00:02, 253.56it/s] 48%|████▊     | 482/1000 [00:02<00:01, 259.14it/s] 48%|████▊     | 482/1000 [00:02<00:01, 259.11it/s] 48%|████▊     | 483/1000 [00:02<00:01, 259.89it/s] 48%|████▊     | 483/1000 [00:02<00:01, 259.46it/s]Step499:rank0, time: 0.385, per_step: 0.003816
Step499:rank3, time: 0.386, per_step: 0.003817
Step499:rank1, time: 0.385, per_step: 0.003816
Step499:rank2, time: 0.386, per_step: 0.003817
 51%|█████     | 510/1000 [00:02<00:01, 264.03it/s] 51%|█████     | 510/1000 [00:02<00:01, 263.97it/s] 51%|█████     | 511/1000 [00:02<00:01, 264.51it/s] 51%|█████     | 511/1000 [00:02<00:01, 264.20it/s] 54%|█████▍    | 538/1000 [00:02<00:01, 267.17it/s] 54%|█████▍    | 538/1000 [00:02<00:01, 267.16it/s] 54%|█████▍    | 539/1000 [00:02<00:01, 267.49it/s] 54%|█████▍    | 539/1000 [00:02<00:01, 267.26it/s] 56%|█████▋    | 565/1000 [00:02<00:01, 263.97it/s] 56%|█████▋    | 565/1000 [00:02<00:01, 263.92it/s] 57%|█████▋    | 566/1000 [00:02<00:01, 264.09it/s] 57%|█████▋    | 566/1000 [00:02<00:01, 263.92it/s] 59%|█████▉    | 592/1000 [00:02<00:01, 263.70it/s] 59%|█████▉    | 592/1000 [00:02<00:01, 263.65it/s] 59%|█████▉    | 593/1000 [00:03<00:01, 263.65it/s] 59%|█████▉    | 593/1000 [00:02<00:01, 263.75it/s]Step599:rank3, time: 0.376, per_step: 0.003721
Step599:rank0, time: 0.376, per_step: 0.003721
Step599:rank1, time: 0.376, per_step: 0.003721
Step599:rank2, time: 0.376, per_step: 0.003721
 62%|██████▏   | 619/1000 [00:03<00:01, 265.04it/s] 62%|██████▏   | 619/1000 [00:02<00:01, 265.02it/s] 62%|██████▏   | 620/1000 [00:02<00:01, 265.24it/s] 62%|██████▏   | 620/1000 [00:03<00:01, 265.15it/s] 65%|██████▍   | 646/1000 [00:03<00:01, 253.42it/s] 65%|██████▍   | 646/1000 [00:02<00:01, 252.80it/s] 65%|██████▍   | 647/1000 [00:03<00:01, 252.18it/s] 65%|██████▍   | 647/1000 [00:03<00:01, 252.20it/s] 67%|██████▋   | 672/1000 [00:03<00:01, 240.42it/s] 67%|██████▋   | 672/1000 [00:03<00:01, 240.57it/s] 67%|██████▋   | 673/1000 [00:03<00:01, 240.85it/s] 67%|██████▋   | 673/1000 [00:03<00:01, 240.81it/s] 70%|██████▉   | 699/1000 [00:03<00:01, 248.25it/s] 70%|██████▉   | 699/1000 [00:03<00:01, 248.38it/s]Step699:rank0, time: 0.416, per_step: 0.004123
Step699:rank3, time: 0.416, per_step: 0.004123
Step699:rank2, time: 0.416, per_step: 0.004124
Step699:rank1, time: 0.416, per_step: 0.004124
 70%|███████   | 700/1000 [00:03<00:01, 247.08it/s] 70%|███████   | 700/1000 [00:03<00:01, 247.07it/s] 72%|███████▎  | 725/1000 [00:03<00:01, 247.88it/s] 72%|███████▎  | 725/1000 [00:03<00:01, 247.33it/s] 72%|███████▎  | 725/1000 [00:03<00:01, 247.85it/s] 72%|███████▎  | 725/1000 [00:03<00:01, 247.47it/s] 75%|███████▌  | 751/1000 [00:03<00:00, 250.13it/s] 75%|███████▌  | 751/1000 [00:03<00:00, 250.04it/s] 75%|███████▌  | 751/1000 [00:03<00:00, 250.43it/s] 75%|███████▌  | 751/1000 [00:03<00:00, 250.41it/s] 78%|███████▊  | 778/1000 [00:03<00:00, 252.55it/s] 78%|███████▊  | 778/1000 [00:03<00:00, 252.54it/s] 78%|███████▊  | 778/1000 [00:03<00:00, 252.25it/s] 78%|███████▊  | 778/1000 [00:03<00:00, 252.18it/s]Step799:rank2, time: 0.432, per_step: 0.004282
Step799:rank1, time: 0.432, per_step: 0.004282
Step799:rank0, time: 0.433, per_step: 0.004283
Step799:rank3, time: 0.434, per_step: 0.004300
 80%|████████  | 804/1000 [00:03<00:00, 220.71it/s] 80%|████████  | 804/1000 [00:03<00:00, 220.71it/s] 80%|████████  | 804/1000 [00:03<00:00, 220.70it/s] 80%|████████  | 804/1000 [00:03<00:00, 217.19it/s] 83%|████████▎ | 827/1000 [00:04<00:00, 222.65it/s] 83%|████████▎ | 827/1000 [00:03<00:00, 222.63it/s] 83%|████████▎ | 827/1000 [00:03<00:00, 222.64it/s] 83%|████████▎ | 829/1000 [00:03<00:00, 224.46it/s] 85%|████████▌ | 852/1000 [00:04<00:00, 228.75it/s] 85%|████████▌ | 852/1000 [00:03<00:00, 228.70it/s] 85%|████████▌ | 852/1000 [00:03<00:00, 228.73it/s] 85%|████████▌ | 854/1000 [00:04<00:00, 229.99it/s] 88%|████████▊ | 878/1000 [00:04<00:00, 236.75it/s] 88%|████████▊ | 878/1000 [00:03<00:00, 236.73it/s] 88%|████████▊ | 878/1000 [00:04<00:00, 236.75it/s] 88%|████████▊ | 880/1000 [00:04<00:00, 237.64it/s]Step899:rank0, time: 0.417, per_step: 0.004131
Step899:rank3, time: 0.415, per_step: 0.004114
Step899:rank2, time: 0.417, per_step: 0.004132
Step899:rank1, time: 0.417, per_step: 0.004132
 90%|█████████ | 904/1000 [00:04<00:00, 242.11it/s] 90%|█████████ | 904/1000 [00:04<00:00, 242.12it/s] 90%|█████████ | 904/1000 [00:04<00:00, 242.14it/s] 91%|█████████ | 906/1000 [00:04<00:00, 242.57it/s] 93%|█████████▎| 931/1000 [00:04<00:00, 248.51it/s] 93%|█████████▎| 931/1000 [00:04<00:00, 248.53it/s] 93%|█████████▎| 931/1000 [00:04<00:00, 248.52it/s] 93%|█████████▎| 933/1000 [00:04<00:00, 248.92it/s] 96%|█████████▌| 958/1000 [00:04<00:00, 253.81it/s] 96%|█████████▌| 958/1000 [00:04<00:00, 253.76it/s] 96%|█████████▌| 958/1000 [00:04<00:00, 253.72it/s] 96%|█████████▌| 960/1000 [00:04<00:00, 253.59it/s] 98%|█████████▊| 985/1000 [00:04<00:00, 257.24it/s] 98%|█████████▊| 985/1000 [00:04<00:00, 257.24it/s] 98%|█████████▊| 985/1000 [00:04<00:00, 257.22it/s] 99%|█████████▊| 987/1000 [00:04<00:00, 257.70it/s]Step999:rank1, time: 0.376, per_step: 0.003723
Step999:rank0, time: 0.376, per_step: 0.003724
Step999:rank3, time: 0.376, per_step: 0.003724
Step999:rank2, time: 0.376, per_step: 0.003724
100%|██████████| 1000/1000 [00:04<00:00, 216.92it/s]100%|██████████| 1000/1000 [00:04<00:00, 226.54it/s]100%|██████████| 1000/1000 [00:04<00:00, 210.57it/s]100%|██████████| 1000/1000 [00:04<00:00, 219.45it/s]



Worker 3 pid=25184
Successfully xmh

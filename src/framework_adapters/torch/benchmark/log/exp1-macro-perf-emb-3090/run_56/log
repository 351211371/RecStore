perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fc235a3ee50>==========
Worker 0 pid=60525
Worker 1 pid=60526
Worker 2 pid=60527
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<06:51,  2.43it/s]Step99:rank3, time: 0.473, per_step: 0.004729
 18%|█▊        | 183/1000 [00:00<00:01, 470.17it/s]Step199:rank3, time: 0.062, per_step: 0.000617
Step299:rank3, time: 0.035, per_step: 0.000349
Step399:rank3, time: 0.035, per_step: 0.000342
 48%|████▊     | 480/1000 [00:00<00:00, 1142.02it/s]Step499:rank3, time: 0.030, per_step: 0.000297
Step599:rank3, time: 0.030, per_step: 0.000295
Step699:rank3, time: 0.030, per_step: 0.000296
Step799:rank3, time: 0.030, per_step: 0.000296
 81%|████████▏ | 814/1000 [00:00<00:00, 1751.38it/s]Step899:rank3, time: 0.030, per_step: 0.000295
Step999:rank3, time: 0.029, per_step: 0.000292
100%|██████████| 1000/1000 [00:00<00:00, 1302.99it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<02:08,  7.76it/s]  0%|          | 1/1000 [00:00<01:47,  9.31it/s]  6%|▌         | 56/1000 [00:00<00:01, 558.50it/s]Step99:rank1, time: 0.123, per_step: 0.001227
Step99:rank2, time: 0.201, per_step: 0.002013
  9%|▉         | 93/1000 [00:00<00:01, 487.14it/s]Step99:rank0, time: 0.237, per_step: 0.002370
 11%|█▏        | 113/1000 [00:00<00:01, 622.51it/s]Step199:rank1, time: 0.052, per_step: 0.000510
 27%|██▋       | 272/1000 [00:00<00:00, 1496.61it/s]Step299:rank1, time: 0.042, per_step: 0.000412
 20%|█▉        | 196/1000 [00:00<00:01, 719.15it/s]Step199:rank0, time: 0.099, per_step: 0.000979
 19%|█▉        | 190/1000 [00:00<00:01, 686.75it/s]Step199:rank2, time: 0.124, per_step: 0.001228
Step399:rank1, time: 0.040, per_step: 0.000393
Step299:rank0, time: 0.035, per_step: 0.000349
Step499:rank1, time: 0.030, per_step: 0.000296
Step299:rank2, time: 0.040, per_step: 0.000393
Step399:rank0, time: 0.031, per_step: 0.000305
 56%|█████▋    | 564/1000 [00:00<00:00, 2142.87it/s]Step599:rank1, time: 0.030, per_step: 0.000297
Step399:rank2, time: 0.038, per_step: 0.000373
Step499:rank0, time: 0.030, per_step: 0.000300
 51%|█████     | 506/1000 [00:00<00:00, 1622.12it/s] 45%|████▍     | 446/1000 [00:00<00:00, 1408.15it/s]Step699:rank1, time: 0.030, per_step: 0.000294
Step599:rank0, time: 0.031, per_step: 0.000302
Step499:rank2, time: 0.038, per_step: 0.000377
Step799:rank1, time: 0.030, per_step: 0.000297
Step699:rank0, time: 0.030, per_step: 0.000301
Step599:rank2, time: 0.038, per_step: 0.000376
 90%|████████▉ | 898/1000 [00:00<00:00, 2613.05it/s]Step899:rank1, time: 0.030, per_step: 0.000299
Step799:rank0, time: 0.031, per_step: 0.000304
 83%|████████▎ | 833/1000 [00:00<00:00, 2201.18it/s]Step999:rank1, time: 0.030, per_step: 0.000295
100%|██████████| 1000/1000 [00:00<00:00, 2316.84it/s]
Step699:rank2, time: 0.039, per_step: 0.000382
 71%|███████   | 708/1000 [00:00<00:00, 1836.36it/s]Step899:rank0, time: 0.032, per_step: 0.000316
Step799:rank2, time: 0.040, per_step: 0.000393
Step999:rank0, time: 0.032, per_step: 0.000314
100%|██████████| 1000/1000 [00:00<00:00, 1715.59it/s]
Step899:rank2, time: 0.040, per_step: 0.000397
 96%|█████████▌| 959/1000 [00:00<00:00, 2062.29it/s]Step999:rank2, time: 0.040, per_step: 0.000395
100%|██████████| 1000/1000 [00:00<00:00, 1584.85it/s]
Worker 3 pid=60528
Successfully xmh

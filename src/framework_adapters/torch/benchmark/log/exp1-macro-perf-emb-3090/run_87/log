perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fddebed5e50>==========
Worker 0 pid=26044
Worker 1 pid=26045
Worker 2 pid=26046
Worker 3 pid=26047
Worker 4 pid=26054
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:02<34:07,  2.05s/it]  0%|          | 1/1000 [00:02<35:09,  2.11s/it]  0%|          | 1/1000 [00:02<35:18,  2.12s/it]  0%|          | 1/1000 [00:02<35:34,  2.14s/it]Step99:rank3, time: 2.154, per_step: 0.021542
  0%|          | 1/1000 [00:02<35:45,  2.15s/it] 11%|█         | 106/1000 [00:02<00:12, 68.87it/s]  0%|          | 1/1000 [00:02<35:48,  2.15s/it]Step199:rank3, time: 0.030, per_step: 0.000299
Step299:rank3, time: 0.033, per_step: 0.000327
  8%|▊         | 85/1000 [00:02<00:17, 53.66it/s]Step99:rank4, time: 2.225, per_step: 0.022246
  9%|▉         | 93/1000 [00:02<00:15, 58.50it/s]Step99:rank0, time: 2.231, per_step: 0.022313
 10%|▉         | 98/1000 [00:02<00:14, 61.23it/s]Step99:rank1, time: 2.244, per_step: 0.022441
Step399:rank3, time: 0.029, per_step: 0.000283
 10%|▉         | 99/1000 [00:02<00:14, 61.56it/s]Step99:rank2, time: 2.256, per_step: 0.022562
 44%|████▎     | 436/1000 [00:02<00:01, 343.98it/s] 10%|▉         | 97/1000 [00:02<00:14, 60.22it/s]Step199:rank4, time: 0.034, per_step: 0.000333
Step99:rank5, time: 2.259, per_step: 0.022589
Step199:rank0, time: 0.031, per_step: 0.000304
Step199:rank1, time: 0.029, per_step: 0.000285
Step499:rank3, time: 0.029, per_step: 0.000285
Step199:rank2, time: 0.031, per_step: 0.000306
Step199:rank5, time: 0.031, per_step: 0.000306
Step299:rank4, time: 0.033, per_step: 0.000327
Step299:rank0, time: 0.030, per_step: 0.000294
Step299:rank1, time: 0.028, per_step: 0.000279
Step599:rank3, time: 0.029, per_step: 0.000284
Step299:rank2, time: 0.030, per_step: 0.000296
 38%|███▊      | 383/1000 [00:02<00:02, 296.53it/s]Step299:rank5, time: 0.030, per_step: 0.000298
Step399:rank0, time: 0.029, per_step: 0.000291
Step399:rank4, time: 0.033, per_step: 0.000328
Step399:rank1, time: 0.028, per_step: 0.000276
 43%|████▎     | 426/1000 [00:02<00:01, 329.00it/s]Step699:rank3, time: 0.029, per_step: 0.000283
 45%|████▌     | 451/1000 [00:02<00:01, 346.29it/s]Step399:rank2, time: 0.030, per_step: 0.000295
Step399:rank5, time: 0.030, per_step: 0.000296
Step499:rank0, time: 0.030, per_step: 0.000293
 43%|████▎     | 430/1000 [00:02<00:01, 327.25it/s] 78%|███████▊  | 785/1000 [00:02<00:00, 685.09it/s]Step499:rank4, time: 0.033, per_step: 0.000322
Step499:rank1, time: 0.028, per_step: 0.000276
 43%|████▎     | 426/1000 [00:02<00:01, 324.04it/s]Step799:rank3, time: 0.029, per_step: 0.000285
Step499:rank2, time: 0.030, per_step: 0.000297
Step499:rank5, time: 0.030, per_step: 0.000296
Step599:rank0, time: 0.029, per_step: 0.000290
Step599:rank1, time: 0.028, per_step: 0.000273
Step899:rank3, time: 0.029, per_step: 0.000282
Step599:rank4, time: 0.033, per_step: 0.000324
Step599:rank2, time: 0.029, per_step: 0.000291
Step599:rank5, time: 0.029, per_step: 0.000292
Step699:rank0, time: 0.029, per_step: 0.000290
Step699:rank1, time: 0.028, per_step: 0.000274
Step999:rank3, time: 0.029, per_step: 0.000284
100%|██████████| 1000/1000 [00:02<00:00, 414.66it/s]
 69%|██████▉   | 689/1000 [00:02<00:00, 589.21it/s]Step699:rank4, time: 0.033, per_step: 0.000328
 77%|███████▋  | 766/1000 [00:02<00:00, 653.28it/s]Step699:rank2, time: 0.030, per_step: 0.000297
Step699:rank5, time: 0.030, per_step: 0.000298
Step799:rank0, time: 0.030, per_step: 0.000297
Step799:rank1, time: 0.028, per_step: 0.000276
 81%|████████  | 812/1000 [00:02<00:00, 689.08it/s]Step799:rank4, time: 0.033, per_step: 0.000325
 76%|███████▋  | 765/1000 [00:02<00:00, 643.39it/s] 76%|███████▌  | 761/1000 [00:02<00:00, 640.08it/s]Step799:rank2, time: 0.031, per_step: 0.000302
Step899:rank1, time: 0.028, per_step: 0.000277
Step899:rank0, time: 0.030, per_step: 0.000297
Step799:rank5, time: 0.031, per_step: 0.000303
Step899:rank4, time: 0.033, per_step: 0.000323
Step999:rank1, time: 0.028, per_step: 0.000273
100%|██████████| 1000/1000 [00:02<00:00, 401.78it/s]
Step899:rank2, time: 0.030, per_step: 0.000301
Step999:rank0, time: 0.030, per_step: 0.000299
100%|██████████| 1000/1000 [00:02<00:00, 401.30it/s]
Step899:rank5, time: 0.031, per_step: 0.000304
 99%|█████████▉| 993/1000 [00:02<00:00, 911.19it/s]Step999:rank4, time: 0.033, per_step: 0.000328
100%|██████████| 1000/1000 [00:02<00:00, 397.60it/s]
Step999:rank2, time: 0.031, per_step: 0.000311
100%|██████████| 1000/1000 [00:02<00:00, 396.69it/s]
Step999:rank5, time: 0.032, per_step: 0.000315
100%|██████████| 1000/1000 [00:02<00:00, 395.85it/s]
Worker 5 pid=26055
Successfully xmh

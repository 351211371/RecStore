perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fdf1fc58e50>==========
Worker 0 pid=36812
Worker 1 pid=36813
Worker 2 pid=36814
Worker 3 pid=36815
Worker 4 pid=36818
Worker 5 pid=36822
Worker 6 pid=36823
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<02:53,  5.75it/s]Step99:rank6, time: 0.256, per_step: 0.002561
 16%|█▌        | 158/1000 [00:00<00:01, 709.76it/s]Step199:rank6, time: 0.055, per_step: 0.000547
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s] 25%|██▌       | 251/1000 [00:00<00:01, 508.32it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  1%|          | 10/1000 [00:00<00:10, 92.32it/s]  1%|▏         | 13/1000 [00:00<00:07, 129.73it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  2%|▏         | 21/1000 [00:00<00:04, 209.77it/s]  1%|          | 10/1000 [00:00<00:09, 99.64it/s]  2%|▎         | 25/1000 [00:00<00:04, 224.50it/s]  3%|▎         | 34/1000 [00:00<00:05, 176.02it/s]  1%|▏         | 13/1000 [00:00<00:08, 117.73it/s]  2%|▏         | 17/1000 [00:00<00:07, 137.02it/s]  5%|▍         | 47/1000 [00:00<00:03, 238.84it/s]  4%|▍         | 39/1000 [00:00<00:05, 169.13it/s]Step99:rank4, time: 0.212, per_step: 0.002124
Step99:rank3, time: 0.232, per_step: 0.002316
Step99:rank5, time: 0.391, per_step: 0.003909
Step299:rank6, time: 0.416, per_step: 0.004115
 14%|█▎        | 136/1000 [00:00<00:01, 780.65it/s] 32%|███▏      | 319/1000 [00:00<00:01, 433.46it/s] 15%|█▍        | 147/1000 [00:00<00:01, 783.28it/s] 15%|█▍        | 148/1000 [00:00<00:01, 606.64it/s]Step99:rank1, time: 0.295, per_step: 0.002953
  5%|▌         | 51/1000 [00:00<00:03, 249.41it/s]Step199:rank3, time: 0.054, per_step: 0.000539
Step199:rank4, time: 0.064, per_step: 0.000638
Step99:rank0, time: 0.444, per_step: 0.004439
Step199:rank5, time: 0.052, per_step: 0.000517
  8%|▊         | 76/1000 [00:00<00:02, 378.53it/s]Step399:rank6, time: 0.052, per_step: 0.000512
 16%|█▌        | 156/1000 [00:00<00:01, 626.96it/s]Step99:rank2, time: 0.288, per_step: 0.002882
 13%|█▎        | 126/1000 [00:00<00:01, 454.57it/s]Step99:rank7, time: 0.308, per_step: 0.003081
Step199:rank1, time: 0.048, per_step: 0.000474
Step299:rank3, time: 0.044, per_step: 0.000438
Step299:rank4, time: 0.044, per_step: 0.000440
Step299:rank5, time: 0.044, per_step: 0.000434
Step499:rank6, time: 0.040, per_step: 0.000394
Step199:rank0, time: 0.051, per_step: 0.000509
Step199:rank2, time: 0.045, per_step: 0.000443
 35%|███▌      | 351/1000 [00:00<00:00, 1403.55it/s]Step199:rank7, time: 0.043, per_step: 0.000425
 53%|█████▎    | 533/1000 [00:00<00:00, 820.80it/s] 37%|███▋      | 373/1000 [00:00<00:00, 1438.58it/s]Step299:rank1, time: 0.040, per_step: 0.000396
 37%|███▋      | 368/1000 [00:00<00:00, 1225.99it/s]Step399:rank3, time: 0.042, per_step: 0.000418
Step399:rank4, time: 0.042, per_step: 0.000415
Step399:rank5, time: 0.045, per_step: 0.000445
 26%|██▌       | 261/1000 [00:00<00:00, 1045.07it/s]Step299:rank0, time: 0.040, per_step: 0.000398
Step599:rank6, time: 0.046, per_step: 0.000453
Step299:rank2, time: 0.042, per_step: 0.000413
 30%|███       | 305/1000 [00:00<00:00, 1204.56it/s]Step299:rank7, time: 0.043, per_step: 0.000423
Step399:rank1, time: 0.040, per_step: 0.000393
 41%|████      | 406/1000 [00:00<00:00, 1364.27it/s] 37%|███▋      | 366/1000 [00:00<00:00, 1169.81it/s]Step499:rank3, time: 0.042, per_step: 0.000416
Step499:rank4, time: 0.042, per_step: 0.000417
Step399:rank0, time: 0.040, per_step: 0.000397
Step499:rank5, time: 0.042, per_step: 0.000417
Step699:rank6, time: 0.039, per_step: 0.000385
Step399:rank2, time: 0.041, per_step: 0.000408
Step399:rank7, time: 0.042, per_step: 0.000415
Step499:rank1, time: 0.043, per_step: 0.000426
 59%|█████▉    | 591/1000 [00:00<00:00, 1794.86it/s]Step599:rank3, time: 0.041, per_step: 0.000405
Step599:rank4, time: 0.041, per_step: 0.000408
 79%|███████▉  | 790/1000 [00:00<00:00, 1248.69it/s] 61%|██████▏   | 614/1000 [00:00<00:00, 1813.25it/s]Step499:rank0, time: 0.040, per_step: 0.000394
Step799:rank6, time: 0.039, per_step: 0.000386
Step599:rank5, time: 0.041, per_step: 0.000411
 61%|██████    | 606/1000 [00:00<00:00, 1633.30it/s]Step499:rank2, time: 0.041, per_step: 0.000404
 50%|████▉     | 498/1000 [00:00<00:00, 1548.80it/s]Step499:rank7, time: 0.042, per_step: 0.000420
Step599:rank1, time: 0.039, per_step: 0.000388
Step699:rank3, time: 0.042, per_step: 0.000417
 55%|█████▌    | 550/1000 [00:00<00:00, 1678.14it/s]Step699:rank4, time: 0.041, per_step: 0.000409
Step599:rank0, time: 0.040, per_step: 0.000394
Step899:rank6, time: 0.039, per_step: 0.000385
 65%|██████▌   | 652/1000 [00:00<00:00, 1756.84it/s] 62%|██████▏   | 617/1000 [00:00<00:00, 1630.88it/s]Step699:rank5, time: 0.048, per_step: 0.000473
Step599:rank2, time: 0.041, per_step: 0.000405
Step599:rank7, time: 0.042, per_step: 0.000414
Step699:rank1, time: 0.040, per_step: 0.000392
Step799:rank3, time: 0.041, per_step: 0.000405
Step799:rank4, time: 0.042, per_step: 0.000412
Step999:rank6, time: 0.039, per_step: 0.000386
100%|██████████| 1000/1000 [00:01<00:00, 993.25it/s]
Step699:rank0, time: 0.040, per_step: 0.000397
 83%|████████▎ | 830/1000 [00:00<00:00, 2009.10it/s]Step699:rank2, time: 0.042, per_step: 0.000412
Step799:rank5, time: 0.047, per_step: 0.000466
 85%|████████▌ | 852/1000 [00:00<00:00, 2014.59it/s]Step699:rank7, time: 0.043, per_step: 0.000427
Step799:rank1, time: 0.041, per_step: 0.000401
 82%|████████▏ | 821/1000 [00:00<00:00, 1805.31it/s]Step899:rank3, time: 0.043, per_step: 0.000428
 73%|███████▎  | 733/1000 [00:00<00:00, 1828.54it/s]Step899:rank4, time: 0.043, per_step: 0.000426
Step799:rank0, time: 0.041, per_step: 0.000408
 79%|███████▉  | 791/1000 [00:00<00:00, 1935.29it/s]Step799:rank2, time: 0.042, per_step: 0.000416
Step899:rank5, time: 0.045, per_step: 0.000442
Step899:rank1, time: 0.040, per_step: 0.000399
 90%|█████████ | 901/1000 [00:00<00:00, 2003.48it/s] 86%|████████▌ | 862/1000 [00:00<00:00, 1900.86it/s]Step799:rank7, time: 0.048, per_step: 0.000474
Step999:rank3, time: 0.042, per_step: 0.000420
100%|██████████| 1000/1000 [00:00<00:00, 1738.14it/s]
Step899:rank0, time: 0.041, per_step: 0.000410
Step999:rank4, time: 0.043, per_step: 0.000423
100%|██████████| 1000/1000 [00:00<00:00, 1742.85it/s]
Step899:rank2, time: 0.043, per_step: 0.000425
Step999:rank5, time: 0.043, per_step: 0.000427
100%|██████████| 1000/1000 [00:00<00:00, 1450.18it/s]
Step999:rank1, time: 0.042, per_step: 0.000420
100%|██████████| 1000/1000 [00:00<00:00, 1553.92it/s]
Step899:rank7, time: 0.044, per_step: 0.000436
Step999:rank0, time: 0.043, per_step: 0.000429
100%|██████████| 1000/1000 [00:00<00:00, 1433.88it/s]
 95%|█████████▌| 952/1000 [00:00<00:00, 1947.95it/s]Step999:rank2, time: 0.043, per_step: 0.000424
100%|██████████| 1000/1000 [00:00<00:00, 1625.70it/s]
Step999:rank7, time: 0.044, per_step: 0.000433
100%|██████████| 1000/1000 [00:00<00:00, 1552.24it/s]
Worker 7 pid=36824
Successfully xmh

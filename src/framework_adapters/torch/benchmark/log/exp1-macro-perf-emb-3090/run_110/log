perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fd9136a0e50>==========
Worker 0 pid=23094
Worker 1 pid=23095
Worker 2 pid=23096
Worker 3 pid=23099
Worker 4 pid=23103
Worker 5 pid=23104
Worker 6 pid=23105
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<02:33,  6.51it/s]Step99:rank6, time: 0.218, per_step: 0.002179
Step199:rank6, time: 0.041, per_step: 0.000405
 22%|██▏       | 221/1000 [00:00<00:00, 1062.96it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  3%|▎         | 31/1000 [00:00<00:03, 286.14it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  3%|▎         | 29/1000 [00:00<00:03, 289.89it/s]  3%|▎         | 28/1000 [00:00<00:03, 279.03it/s]  6%|▌         | 60/1000 [00:00<00:03, 264.85it/s]  8%|▊         | 78/1000 [00:00<00:01, 779.68it/s]Step299:rank6, time: 0.255, per_step: 0.002528
Step99:rank0, time: 0.235, per_step: 0.002348
Step99:rank4, time: 0.243, per_step: 0.002431
  9%|▉         | 92/1000 [00:00<00:00, 918.70it/s]Step99:rank2, time: 0.193, per_step: 0.001933
Step99:rank1, time: 0.121, per_step: 0.001211
Step99:rank7, time: 0.126, per_step: 0.001260
Step99:rank3, time: 0.269, per_step: 0.002694
 35%|███▌      | 351/1000 [00:00<00:00, 665.29it/s] Step99:rank5, time: 0.253, per_step: 0.002531
Step199:rank0, time: 0.045, per_step: 0.000448
 14%|█▎        | 137/1000 [00:00<00:00, 1369.10it/s] 13%|█▎        | 127/1000 [00:00<00:00, 1264.48it/s]Step199:rank4, time: 0.047, per_step: 0.000464
Step399:rank6, time: 0.066, per_step: 0.000656
Step199:rank2, time: 0.046, per_step: 0.000454
Step199:rank3, time: 0.044, per_step: 0.000437
 23%|██▎       | 231/1000 [00:00<00:00, 1305.29it/s] 25%|██▍       | 247/1000 [00:00<00:00, 1399.32it/s]Step199:rank1, time: 0.067, per_step: 0.000663
Step199:rank7, time: 0.060, per_step: 0.000593
Step299:rank0, time: 0.038, per_step: 0.000373
 25%|██▍       | 246/1000 [00:00<00:00, 945.44it/s] 32%|███▏      | 320/1000 [00:00<00:00, 1743.26it/s]Step199:rank5, time: 0.059, per_step: 0.000588
Step299:rank4, time: 0.039, per_step: 0.000381
Step299:rank2, time: 0.039, per_step: 0.000383
 23%|██▎       | 233/1000 [00:00<00:00, 1205.59it/s]Step299:rank3, time: 0.039, per_step: 0.000387
Step399:rank0, time: 0.038, per_step: 0.000380
Step299:rank7, time: 0.039, per_step: 0.000386
 50%|████▉     | 499/1000 [00:00<00:00, 868.34it/s]Step499:rank6, time: 0.071, per_step: 0.000707
Step399:rank4, time: 0.038, per_step: 0.000376
Step399:rank2, time: 0.038, per_step: 0.000379
Step299:rank1, time: 0.054, per_step: 0.000539
Step299:rank5, time: 0.050, per_step: 0.000499
 37%|███▋      | 366/1000 [00:00<00:00, 1908.67it/s]Step399:rank3, time: 0.039, per_step: 0.000385
 33%|███▎      | 328/1000 [00:00<00:00, 1699.91it/s]Step499:rank0, time: 0.037, per_step: 0.000368
Step399:rank7, time: 0.038, per_step: 0.000380
 49%|████▉     | 493/1000 [00:00<00:00, 1903.19it/s]Step499:rank4, time: 0.038, per_step: 0.000381
Step399:rank1, time: 0.037, per_step: 0.000365
Step499:rank2, time: 0.038, per_step: 0.000375
 51%|█████     | 508/1000 [00:00<00:00, 1951.19it/s]Step599:rank6, time: 0.049, per_step: 0.000482
Step399:rank5, time: 0.037, per_step: 0.000366
Step499:rank3, time: 0.039, per_step: 0.000387
 50%|█████     | 503/1000 [00:00<00:00, 1558.60it/s] 59%|█████▊    | 586/1000 [00:00<00:00, 2160.27it/s]Step599:rank0, time: 0.038, per_step: 0.000376
Step499:rank7, time: 0.038, per_step: 0.000380
Step599:rank4, time: 0.038, per_step: 0.000379
 50%|████▉     | 497/1000 [00:00<00:00, 1856.92it/s]Step499:rank1, time: 0.038, per_step: 0.000376
Step599:rank2, time: 0.038, per_step: 0.000380
Step499:rank5, time: 0.037, per_step: 0.000362
Step699:rank6, time: 0.038, per_step: 0.000375
Step599:rank3, time: 0.039, per_step: 0.000388
 73%|███████▎  | 733/1000 [00:00<00:00, 1254.65it/s]Step699:rank0, time: 0.038, per_step: 0.000376
Step599:rank7, time: 0.039, per_step: 0.000384
Step699:rank4, time: 0.038, per_step: 0.000376
Step599:rank1, time: 0.038, per_step: 0.000372
 62%|██████▏   | 617/1000 [00:00<00:00, 2161.55it/s]Step699:rank2, time: 0.038, per_step: 0.000380
Step599:rank5, time: 0.037, per_step: 0.000363
 60%|██████    | 601/1000 [00:00<00:00, 2166.53it/s]Step799:rank6, time: 0.038, per_step: 0.000377
Step699:rank3, time: 0.039, per_step: 0.000386
 76%|███████▌  | 755/1000 [00:00<00:00, 2182.78it/s]Step799:rank0, time: 0.038, per_step: 0.000372
 77%|███████▋  | 770/1000 [00:00<00:00, 2214.45it/s]Step699:rank7, time: 0.044, per_step: 0.000431
 75%|███████▍  | 749/1000 [00:00<00:00, 1873.44it/s]Step799:rank4, time: 0.042, per_step: 0.000418
Step699:rank1, time: 0.041, per_step: 0.000408
 85%|████████▌ | 851/1000 [00:00<00:00, 2353.13it/s]Step899:rank6, time: 0.038, per_step: 0.000374
Step799:rank2, time: 0.042, per_step: 0.000418
Step699:rank5, time: 0.041, per_step: 0.000402
Step799:rank3, time: 0.043, per_step: 0.000428
Step899:rank0, time: 0.037, per_step: 0.000367
 75%|███████▌  | 754/1000 [00:00<00:00, 2137.28it/s]Step799:rank7, time: 0.038, per_step: 0.000374
Step799:rank1, time: 0.037, per_step: 0.000367
Step899:rank4, time: 0.038, per_step: 0.000376
100%|█████████▉| 997/1000 [00:00<00:00, 1632.41it/s]Step799:rank5, time: 0.037, per_step: 0.000363
Step999:rank6, time: 0.038, per_step: 0.000376
Step899:rank2, time: 0.037, per_step: 0.000370
100%|██████████| 1000/1000 [00:00<00:00, 1192.91it/s]
Step999:rank0, time: 0.038, per_step: 0.000376
100%|██████████| 1000/1000 [00:00<00:00, 2189.42it/s]
 88%|████████▊ | 877/1000 [00:00<00:00, 2331.43it/s]Step899:rank3, time: 0.040, per_step: 0.000400
 86%|████████▌ | 859/1000 [00:00<00:00, 2327.64it/s]Step899:rank7, time: 0.040, per_step: 0.000395
Step899:rank1, time: 0.039, per_step: 0.000384
Step999:rank4, time: 0.040, per_step: 0.000397
100%|██████████| 1000/1000 [00:00<00:00, 2023.23it/s]
Step899:rank5, time: 0.039, per_step: 0.000387
Step999:rank2, time: 0.040, per_step: 0.000399
100%|██████████| 1000/1000 [00:00<00:00, 1999.28it/s]
100%|█████████▉| 996/1000 [00:00<00:00, 2072.12it/s]Step999:rank3, time: 0.041, per_step: 0.000409
100%|██████████| 1000/1000 [00:00<00:00, 1595.67it/s]
Step999:rank7, time: 0.040, per_step: 0.000397
100%|██████████| 1000/1000 [00:00<00:00, 2211.92it/s]
Step999:rank1, time: 0.040, per_step: 0.000394
100%|██████████| 1000/1000 [00:00<00:00, 2013.55it/s]
Step999:rank5, time: 0.040, per_step: 0.000393
100%|██████████| 1000/1000 [00:00<00:00, 2189.06it/s]
Worker 7 pid=23106
Successfully xmh

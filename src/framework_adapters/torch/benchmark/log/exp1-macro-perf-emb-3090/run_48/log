perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fe3372cbe50>==========
Worker 0 pid=47663
Worker 1 pid=47664
Worker 2 pid=47665
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<29:33,  1.78s/it]  0%|          | 1/1000 [00:01<30:05,  1.81s/it]  0%|          | 1/1000 [00:01<30:17,  1.82s/it]  0%|          | 1/1000 [00:01<30:24,  1.83s/it]  5%|▌         | 53/1000 [00:01<00:24, 39.22it/s]  5%|▌         | 53/1000 [00:01<00:24, 38.60it/s]  5%|▌         | 54/1000 [00:01<00:24, 39.07it/s]  5%|▌         | 52/1000 [00:01<00:25, 37.47it/s]Step99:rank2, time: 1.958, per_step: 0.019583
 12%|█▏        | 118/1000 [00:01<00:09, 97.81it/s]Step99:rank3, time: 1.989, per_step: 0.019891
Step99:rank1, time: 2.000, per_step: 0.020003
Step99:rank0, time: 2.012, per_step: 0.020120
 12%|█▏        | 118/1000 [00:02<00:09, 96.44it/s] 12%|█▏        | 120/1000 [00:02<00:09, 97.46it/s] 12%|█▏        | 116/1000 [00:02<00:09, 93.99it/s] 19%|█▉        | 194/1000 [00:02<00:04, 177.66it/s]Step199:rank2, time: 0.134, per_step: 0.001322
 20%|█▉        | 195/1000 [00:02<00:04, 176.50it/s]Step199:rank3, time: 0.133, per_step: 0.001321
 20%|█▉        | 198/1000 [00:02<00:04, 178.08it/s]Step199:rank1, time: 0.132, per_step: 0.001309
 19%|█▉        | 193/1000 [00:02<00:04, 173.67it/s]Step199:rank0, time: 0.133, per_step: 0.001318
 29%|██▊       | 286/1000 [00:02<00:02, 286.37it/s]Step299:rank2, time: 0.108, per_step: 0.001066
 29%|██▊       | 287/1000 [00:02<00:02, 284.18it/s]Step299:rank3, time: 0.107, per_step: 0.001063
 29%|██▉       | 290/1000 [00:02<00:02, 285.15it/s] 28%|██▊       | 285/1000 [00:02<00:02, 281.32it/s]Step299:rank1, time: 0.108, per_step: 0.001068
Step299:rank0, time: 0.106, per_step: 0.001054
 40%|███▉      | 399/1000 [00:02<00:01, 432.22it/s]Step399:rank2, time: 0.088, per_step: 0.000867
Step399:rank3, time: 0.088, per_step: 0.000870
 40%|████      | 400/1000 [00:02<00:01, 428.87it/s]Step399:rank1, time: 0.087, per_step: 0.000863
 40%|████      | 404/1000 [00:02<00:01, 431.21it/s] 40%|███▉      | 398/1000 [00:02<00:01, 425.92it/s]Step399:rank0, time: 0.087, per_step: 0.000865
Step499:rank2, time: 0.073, per_step: 0.000726
 54%|█████▍    | 540/1000 [00:02<00:00, 625.42it/s]Step499:rank3, time: 0.074, per_step: 0.000729
Step499:rank1, time: 0.074, per_step: 0.000728
Step499:rank0, time: 0.073, per_step: 0.000721
 54%|█████▍    | 541/1000 [00:02<00:00, 621.34it/s]Step599:rank2, time: 0.062, per_step: 0.000615
 55%|█████▍    | 547/1000 [00:02<00:00, 627.00it/s] 54%|█████▍    | 539/1000 [00:02<00:00, 618.81it/s]Step599:rank3, time: 0.062, per_step: 0.000617
Step599:rank1, time: 0.061, per_step: 0.000608
Step599:rank0, time: 0.062, per_step: 0.000612
Step699:rank2, time: 0.053, per_step: 0.000524
 72%|███████▏  | 723/1000 [00:02<00:00, 890.69it/s]Step699:rank3, time: 0.053, per_step: 0.000527
Step699:rank1, time: 0.053, per_step: 0.000526
 72%|███████▏  | 724/1000 [00:02<00:00, 885.56it/s]Step799:rank2, time: 0.047, per_step: 0.000463
Step699:rank0, time: 0.052, per_step: 0.000516
 73%|███████▎  | 732/1000 [00:02<00:00, 894.00it/s] 72%|███████▏  | 724/1000 [00:02<00:00, 887.74it/s]Step799:rank3, time: 0.047, per_step: 0.000462
Step799:rank1, time: 0.046, per_step: 0.000457
Step899:rank2, time: 0.041, per_step: 0.000405
Step799:rank0, time: 0.047, per_step: 0.000462
 96%|█████████▌| 962/1000 [00:02<00:00, 1249.22it/s]Step899:rank3, time: 0.041, per_step: 0.000410
Step999:rank2, time: 0.038, per_step: 0.000373
100%|██████████| 1000/1000 [00:02<00:00, 385.52it/s]
Step899:rank1, time: 0.042, per_step: 0.000411
Step899:rank0, time: 0.041, per_step: 0.000404
 96%|█████████▌| 961/1000 [00:02<00:00, 1239.15it/s] 97%|█████████▋| 973/1000 [00:02<00:00, 1253.98it/s]Step999:rank3, time: 0.038, per_step: 0.000378
100%|██████████| 1000/1000 [00:02<00:00, 380.76it/s]
 96%|█████████▋| 964/1000 [00:02<00:00, 1247.54it/s]Step999:rank1, time: 0.038, per_step: 0.000380
100%|██████████| 1000/1000 [00:02<00:00, 379.62it/s]
Step999:rank0, time: 0.038, per_step: 0.000374
100%|██████████| 1000/1000 [00:02<00:00, 378.25it/s]
Worker 3 pid=47666
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fbb3c875e50>==========
Worker 0 pid=31792
Worker 1 pid=31793
Worker 2 pid=31794
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank0, time: 0.074, per_step: 0.000737
 19%|█▊        | 186/1000 [00:00<00:00, 1695.97it/s]Step199:rank0, time: 0.059, per_step: 0.000584
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step299:rank0, time: 0.043, per_step: 0.000424
Step399:rank0, time: 0.050, per_step: 0.000499
 40%|████      | 402/1000 [00:00<00:00, 1956.80it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  7%|▋         | 74/1000 [00:00<00:01, 737.43it/s]Step499:rank0, time: 0.041, per_step: 0.000405
Step99:rank2, time: 0.143, per_step: 0.001431
Step599:rank0, time: 0.041, per_step: 0.000410
 63%|██████▎   | 626/1000 [00:00<00:00, 2081.19it/s]  2%|▏         | 19/1000 [00:00<00:05, 170.03it/s] 15%|█▍        | 148/1000 [00:00<00:01, 680.93it/s]Step699:rank0, time: 0.078, per_step: 0.000777
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([10000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step799:rank0, time: 0.055, per_step: 0.000543
Step199:rank2, time: 0.153, per_step: 0.001516
 84%|████████▎ | 835/1000 [00:00<00:00, 1873.63it/s]  7%|▋         | 73/1000 [00:00<00:02, 369.30it/s]Step899:rank0, time: 0.041, per_step: 0.000405
 22%|██▏       | 224/1000 [00:00<00:01, 700.61it/s]Step99:rank3, time: 0.255, per_step: 0.002552
  9%|▊         | 86/1000 [00:00<00:01, 857.68it/s]Step99:rank1, time: 0.131, per_step: 0.001310
Step999:rank0, time: 0.041, per_step: 0.000401
100%|██████████| 1000/1000 [00:00<00:00, 1975.28it/s]
Step299:rank2, time: 0.085, per_step: 0.000843
Step199:rank3, time: 0.057, per_step: 0.000563
 25%|██▍       | 246/1000 [00:00<00:00, 966.87it/s]Step199:rank1, time: 0.045, per_step: 0.000446
Step399:rank2, time: 0.040, per_step: 0.000397
 42%|████▎     | 425/1000 [00:00<00:00, 1195.27it/s]Step299:rank3, time: 0.053, per_step: 0.000523
Step299:rank1, time: 0.036, per_step: 0.000356
Step499:rank2, time: 0.040, per_step: 0.000396
 34%|███▍      | 339/1000 [00:00<00:00, 1838.74it/s]Step399:rank1, time: 0.034, per_step: 0.000332
Step399:rank3, time: 0.046, per_step: 0.000453
Step599:rank2, time: 0.032, per_step: 0.000320
 47%|████▋     | 467/1000 [00:00<00:00, 1444.83it/s]Step499:rank1, time: 0.031, per_step: 0.000305
Step699:rank2, time: 0.029, per_step: 0.000291
 73%|███████▎  | 728/1000 [00:00<00:00, 1837.26it/s]Step499:rank3, time: 0.043, per_step: 0.000430
Step599:rank1, time: 0.031, per_step: 0.000309
Step799:rank2, time: 0.030, per_step: 0.000296
 66%|██████▌   | 660/1000 [00:00<00:00, 2463.35it/s]Step599:rank3, time: 0.038, per_step: 0.000377
Step699:rank1, time: 0.031, per_step: 0.000302
Step899:rank2, time: 0.030, per_step: 0.000292
Step799:rank1, time: 0.030, per_step: 0.000301
Step699:rank3, time: 0.038, per_step: 0.000380
Step999:rank2, time: 0.030, per_step: 0.000297
100%|██████████| 1000/1000 [00:00<00:00, 1662.98it/s]
 71%|███████▏  | 714/1000 [00:00<00:00, 1805.97it/s]Step899:rank1, time: 0.032, per_step: 0.000319
Step799:rank3, time: 0.040, per_step: 0.000400
 98%|█████████▊| 981/1000 [00:00<00:00, 2756.25it/s]Step999:rank1, time: 0.031, per_step: 0.000311
100%|██████████| 1000/1000 [00:00<00:00, 2457.55it/s]
Step899:rank3, time: 0.040, per_step: 0.000394
 97%|█████████▋| 966/1000 [00:00<00:00, 2045.60it/s]Step999:rank3, time: 0.040, per_step: 0.000391
100%|██████████| 1000/1000 [00:00<00:00, 1586.96it/s]
Worker 3 pid=31795
Successfully xmh

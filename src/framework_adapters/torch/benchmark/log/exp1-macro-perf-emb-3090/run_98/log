perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f8bdd664e50>==========
Worker 0 pid=51203
Worker 1 pid=51204
Worker 2 pid=51205
Worker 3 pid=51206
Worker 4 pid=51207
Worker 5 pid=51208
Worker 6 pid=51209
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank6, time: 0.096, per_step: 0.000963
 15%|█▍        | 149/1000 [00:00<00:00, 1481.97it/s]Step199:rank6, time: 0.046, per_step: 0.000455
Step299:rank6, time: 0.037, per_step: 0.000368
Step399:rank6, time: 0.037, per_step: 0.000368
 41%|████▏     | 414/1000 [00:00<00:00, 2165.64it/s]Step499:rank6, time: 0.037, per_step: 0.000368
Step599:rank6, time: 0.037, per_step: 0.000368
 68%|██████▊   | 684/1000 [00:00<00:00, 2406.54it/s]Step699:rank6, time: 0.037, per_step: 0.000369
Step799:rank6, time: 0.037, per_step: 0.000366
Step899:rank6, time: 0.037, per_step: 0.000364
 96%|█████████▌| 955/1000 [00:00<00:00, 2523.74it/s]Step999:rank6, time: 0.037, per_step: 0.000368
100%|██████████| 1000/1000 [00:00<00:00, 2391.80it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<03:08,  5.30it/s]  0%|          | 1/1000 [00:00<02:51,  5.82it/s]  0%|          | 1/1000 [00:00<02:49,  5.89it/s]  0%|          | 1/1000 [00:00<02:44,  6.07it/s]  0%|          | 1/1000 [00:00<02:57,  5.63it/s]  0%|          | 1/1000 [00:00<02:52,  5.79it/s]  0%|          | 1/1000 [00:00<02:43,  6.10it/s]Step99:rank4, time: 0.229, per_step: 0.002289
Step99:rank3, time: 0.223, per_step: 0.002226
Step99:rank2, time: 0.249, per_step: 0.002491
Step99:rank7, time: 0.232, per_step: 0.002324
Step99:rank0, time: 0.250, per_step: 0.002498
Step99:rank1, time: 0.243, per_step: 0.002427
Step99:rank5, time: 0.257, per_step: 0.002570
Step199:rank4, time: 0.041, per_step: 0.000409
Step199:rank3, time: 0.041, per_step: 0.000410
Step199:rank7, time: 0.038, per_step: 0.000379
Step199:rank2, time: 0.042, per_step: 0.000417
 21%|██        | 210/1000 [00:00<00:00, 903.36it/s] 22%|██▏       | 215/1000 [00:00<00:00, 973.69it/s] 21%|██        | 211/1000 [00:00<00:00, 961.44it/s] 22%|██▏       | 215/1000 [00:00<00:00, 996.49it/s] 16%|█▌        | 161/1000 [00:00<00:01, 715.82it/s] 14%|█▍        | 141/1000 [00:00<00:01, 654.07it/s] 13%|█▎        | 134/1000 [00:00<00:01, 604.06it/s]Step199:rank0, time: 0.057, per_step: 0.000564
Step299:rank4, time: 0.038, per_step: 0.000373
Step299:rank3, time: 0.038, per_step: 0.000375
Step299:rank7, time: 0.038, per_step: 0.000379
Step299:rank2, time: 0.039, per_step: 0.000381
Step199:rank5, time: 0.060, per_step: 0.000595
Step199:rank1, time: 0.065, per_step: 0.000645
Step399:rank4, time: 0.037, per_step: 0.000371
Step399:rank3, time: 0.038, per_step: 0.000372
Step399:rank7, time: 0.038, per_step: 0.000377
Step399:rank2, time: 0.038, per_step: 0.000378
Step299:rank0, time: 0.053, per_step: 0.000523
Step299:rank1, time: 0.042, per_step: 0.000411
Step299:rank5, time: 0.057, per_step: 0.000566
 48%|████▊     | 482/1000 [00:00<00:00, 1640.47it/s] 47%|████▋     | 472/1000 [00:00<00:00, 1555.49it/s] 47%|████▋     | 473/1000 [00:00<00:00, 1615.88it/s] 48%|████▊     | 481/1000 [00:00<00:00, 1658.22it/s] 34%|███▍      | 343/1000 [00:00<00:00, 1144.86it/s] 35%|███▍      | 348/1000 [00:00<00:00, 1217.69it/s] 31%|███       | 309/1000 [00:00<00:00, 1052.23it/s]Step499:rank4, time: 0.037, per_step: 0.000370
Step499:rank3, time: 0.038, per_step: 0.000373
Step499:rank7, time: 0.038, per_step: 0.000379
Step499:rank2, time: 0.038, per_step: 0.000379
Step399:rank1, time: 0.039, per_step: 0.000382
Step399:rank0, time: 0.053, per_step: 0.000522
Step399:rank5, time: 0.039, per_step: 0.000383
Step599:rank4, time: 0.037, per_step: 0.000369
Step599:rank3, time: 0.037, per_step: 0.000371
Step599:rank7, time: 0.038, per_step: 0.000376
Step599:rank2, time: 0.038, per_step: 0.000377
Step499:rank1, time: 0.038, per_step: 0.000381
Step499:rank5, time: 0.038, per_step: 0.000380
Step699:rank4, time: 0.037, per_step: 0.000368
Step699:rank3, time: 0.037, per_step: 0.000369
Step699:rank7, time: 0.038, per_step: 0.000375
Step699:rank2, time: 0.038, per_step: 0.000376
Step499:rank0, time: 0.059, per_step: 0.000588
Step599:rank1, time: 0.038, per_step: 0.000379
 74%|███████▎  | 735/1000 [00:00<00:00, 1931.87it/s] 74%|███████▎  | 737/1000 [00:00<00:00, 1983.08it/s] 75%|███████▌  | 751/1000 [00:00<00:00, 2015.39it/s] 53%|█████▎    | 529/1000 [00:00<00:00, 1398.99it/s] 75%|███████▍  | 749/1000 [00:00<00:00, 2026.33it/s] 61%|██████    | 608/1000 [00:00<00:00, 1719.02it/s] 57%|█████▋    | 569/1000 [00:00<00:00, 1607.40it/s]Step599:rank5, time: 0.038, per_step: 0.000380
Step799:rank4, time: 0.037, per_step: 0.000371
Step799:rank3, time: 0.037, per_step: 0.000370
Step799:rank7, time: 0.038, per_step: 0.000374
Step799:rank2, time: 0.038, per_step: 0.000378
Step599:rank0, time: 0.037, per_step: 0.000362
Step699:rank1, time: 0.038, per_step: 0.000378
Step699:rank5, time: 0.038, per_step: 0.000376
Step899:rank4, time: 0.037, per_step: 0.000367
Step899:rank3, time: 0.037, per_step: 0.000368
Step899:rank7, time: 0.038, per_step: 0.000373
Step699:rank0, time: 0.036, per_step: 0.000358
Step899:rank2, time: 0.038, per_step: 0.000375
Step799:rank1, time: 0.038, per_step: 0.000377
Step799:rank5, time: 0.038, per_step: 0.000377
Step999:rank4, time: 0.037, per_step: 0.000368
100%|██████████| 1000/1000 [00:00<00:00, 1769.52it/s]
Step999:rank3, time: 0.038, per_step: 0.000371
100%|██████████| 1000/1000 [00:00<00:00, 1787.63it/s]
Step799:rank0, time: 0.037, per_step: 0.000370
100%|█████████▉| 996/1000 [00:00<00:00, 2157.52it/s]Step999:rank7, time: 0.039, per_step: 0.000384
100%|██████████| 1000/1000 [00:00<00:00, 2200.49it/s]100%|██████████| 1000/1000 [00:00<00:00, 1751.77it/s]
 80%|████████  | 802/1000 [00:00<00:00, 1846.23it/s] 87%|████████▋ | 868/1000 [00:00<00:00, 2018.31it/s] 83%|████████▎ | 829/1000 [00:00<00:00, 1941.38it/s]Step999:rank2, time: 0.039, per_step: 0.000390
100%|██████████| 1000/1000 [00:00<00:00, 1690.45it/s]
Step899:rank1, time: 0.040, per_step: 0.000399
Step899:rank5, time: 0.041, per_step: 0.000407
Step899:rank0, time: 0.041, per_step: 0.000403
Step999:rank1, time: 0.039, per_step: 0.000389
100%|██████████| 1000/1000 [00:00<00:00, 1619.53it/s]
Step999:rank5, time: 0.040, per_step: 0.000396
100%|██████████| 1000/1000 [00:00<00:00, 1554.82it/s]
Step999:rank0, time: 0.041, per_step: 0.000406
100%|██████████| 1000/1000 [00:00<00:00, 1516.50it/s]
Worker 7 pid=51210
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7fa081825e50>==========
Worker 0 pid=59306
Worker 1 pid=59307
Worker 2 pid=59308
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:01<29:31,  1.77s/it]  0%|          | 1/1000 [00:01<29:46,  1.79s/it]  0%|          | 1/1000 [00:01<30:39,  1.84s/it]  1%|          | 6/1000 [00:01<03:56,  4.20it/s]  1%|          | 6/1000 [00:01<03:58,  4.17it/s]  0%|          | 1/1000 [00:01<31:38,  1.90s/it]  1%|          | 6/1000 [00:01<04:02,  4.10it/s]  1%|          | 11/1000 [00:01<01:56,  8.50it/s]  1%|          | 10/1000 [00:02<02:11,  7.53it/s]  1%|          | 7/1000 [00:02<03:32,  4.67it/s]  1%|          | 12/1000 [00:02<01:47,  9.17it/s]  1%|          | 12/1000 [00:02<01:52,  8.76it/s]  2%|▏         | 15/1000 [00:02<01:19, 12.35it/s]  2%|▏         | 17/1000 [00:02<01:09, 14.23it/s]  2%|▏         | 18/1000 [00:02<01:05, 14.93it/s]  2%|▏         | 18/1000 [00:02<01:07, 14.57it/s]  2%|▏         | 20/1000 [00:02<00:55, 17.53it/s]  2%|▏         | 24/1000 [00:02<00:45, 21.53it/s]  2%|▎         | 25/1000 [00:02<00:43, 22.32it/s]  2%|▎         | 25/1000 [00:02<00:44, 21.86it/s]  2%|▎         | 25/1000 [00:02<00:42, 22.90it/s]  3%|▎         | 31/1000 [00:02<00:34, 28.30it/s]  3%|▎         | 32/1000 [00:02<00:32, 29.55it/s]  3%|▎         | 32/1000 [00:02<00:33, 29.13it/s]  3%|▎         | 31/1000 [00:02<00:33, 29.13it/s]  4%|▍         | 39/1000 [00:02<00:26, 36.28it/s]  4%|▍         | 40/1000 [00:02<00:25, 37.72it/s]  4%|▍         | 39/1000 [00:02<00:26, 36.54it/s]  4%|▍         | 38/1000 [00:02<00:25, 37.45it/s]  5%|▍         | 46/1000 [00:02<00:22, 42.97it/s]  5%|▍         | 48/1000 [00:02<00:20, 46.37it/s]  5%|▍         | 47/1000 [00:02<00:21, 45.08it/s]  5%|▍         | 46/1000 [00:02<00:20, 45.69it/s]  5%|▌         | 54/1000 [00:02<00:18, 50.33it/s]  6%|▌         | 55/1000 [00:02<00:18, 51.68it/s]  6%|▌         | 55/1000 [00:02<00:18, 52.38it/s]  5%|▌         | 53/1000 [00:02<00:19, 49.82it/s]  6%|▌         | 62/1000 [00:02<00:16, 57.17it/s]  6%|▋         | 64/1000 [00:02<00:15, 59.73it/s]  6%|▋         | 64/1000 [00:02<00:15, 60.08it/s]  6%|▌         | 60/1000 [00:02<00:17, 54.02it/s]  7%|▋         | 72/1000 [00:02<00:14, 64.94it/s]  7%|▋         | 73/1000 [00:02<00:13, 67.13it/s]  7%|▋         | 73/1000 [00:02<00:13, 67.32it/s]  7%|▋         | 68/1000 [00:02<00:15, 60.35it/s]  8%|▊         | 83/1000 [00:03<00:12, 75.20it/s]  8%|▊         | 82/1000 [00:03<00:12, 72.39it/s]  8%|▊         | 83/1000 [00:03<00:12, 75.63it/s]  8%|▊         | 75/1000 [00:03<00:14, 62.30it/s]  9%|▉         | 93/1000 [00:03<00:11, 82.21it/s] 10%|▉         | 95/1000 [00:03<00:10, 84.31it/s]  9%|▉         | 94/1000 [00:03<00:10, 84.05it/s]Step99:rank1, time: 3.186, per_step: 0.031858
  8%|▊         | 83/1000 [00:03<00:13, 67.03it/s]Step99:rank2, time: 3.209, per_step: 0.032093
Step99:rank0, time: 3.232, per_step: 0.032316
 10%|█         | 104/1000 [00:03<00:10, 88.49it/s] 11%|█         | 107/1000 [00:03<00:09, 92.94it/s] 11%|█         | 106/1000 [00:03<00:09, 92.54it/s]  9%|▉         | 94/1000 [00:03<00:11, 77.52it/s] 12%|█▏        | 116/1000 [00:03<00:09, 97.20it/s] 12%|█▏        | 120/1000 [00:03<00:08, 102.22it/s]Step99:rank3, time: 3.360, per_step: 0.033605
 12%|█▏        | 119/1000 [00:03<00:08, 102.25it/s] 11%|█         | 107/1000 [00:03<00:09, 89.76it/s] 13%|█▎        | 130/1000 [00:03<00:08, 107.26it/s] 14%|█▎        | 135/1000 [00:03<00:07, 115.17it/s] 13%|█▎        | 134/1000 [00:03<00:07, 112.98it/s] 12%|█▏        | 119/1000 [00:03<00:09, 94.12it/s] 14%|█▍        | 145/1000 [00:03<00:07, 118.42it/s] 15%|█▌        | 150/1000 [00:03<00:06, 124.72it/s] 15%|█▌        | 150/1000 [00:03<00:06, 124.23it/s] 13%|█▎        | 133/1000 [00:03<00:08, 106.36it/s] 16%|█▌        | 161/1000 [00:03<00:06, 130.15it/s] 17%|█▋        | 167/1000 [00:03<00:06, 137.65it/s] 17%|█▋        | 167/1000 [00:03<00:06, 137.02it/s] 15%|█▍        | 148/1000 [00:03<00:07, 114.87it/s] 18%|█▊        | 179/1000 [00:03<00:05, 143.00it/s] 19%|█▊        | 186/1000 [00:03<00:05, 152.79it/s] 19%|█▊        | 186/1000 [00:03<00:05, 150.45it/s]Step199:rank1, time: 0.641, per_step: 0.006343
 16%|█▌        | 162/1000 [00:03<00:06, 120.60it/s] 20%|█▉        | 198/1000 [00:03<00:05, 156.59it/s] 21%|██        | 208/1000 [00:03<00:04, 172.30it/s]Step199:rank2, time: 0.664, per_step: 0.006571
Step199:rank0, time: 0.649, per_step: 0.006430
 21%|██        | 206/1000 [00:03<00:04, 161.67it/s] 18%|█▊        | 177/1000 [00:03<00:06, 128.59it/s] 23%|██▎       | 231/1000 [00:03<00:04, 188.18it/s] 22%|██▏       | 218/1000 [00:03<00:04, 167.55it/s] 23%|██▎       | 228/1000 [00:04<00:04, 177.24it/s] 19%|█▉        | 194/1000 [00:04<00:05, 138.67it/s] 26%|██▌       | 257/1000 [00:04<00:03, 208.85it/s] 24%|██▎       | 235/1000 [00:04<00:04, 159.54it/s]Step199:rank3, time: 0.726, per_step: 0.007192
 25%|██▌       | 253/1000 [00:04<00:03, 197.00it/s] 22%|██▏       | 216/1000 [00:04<00:04, 161.98it/s] 29%|██▊       | 286/1000 [00:04<00:03, 231.42it/s] 26%|██▌       | 260/1000 [00:04<00:04, 184.16it/s]Step299:rank1, time: 0.386, per_step: 0.003822
 27%|██▋       | 273/1000 [00:04<00:03, 191.39it/s] 24%|██▍       | 238/1000 [00:04<00:04, 176.67it/s] 32%|███▏      | 317/1000 [00:04<00:02, 253.29it/s] 29%|██▉       | 288/1000 [00:04<00:03, 209.96it/s]Step299:rank0, time: 0.446, per_step: 0.004411
Step299:rank2, time: 0.455, per_step: 0.004502
 30%|███       | 302/1000 [00:04<00:03, 217.56it/s] 35%|███▍      | 348/1000 [00:04<00:02, 268.99it/s] 32%|███▏      | 318/1000 [00:04<00:02, 233.60it/s] 26%|██▌       | 256/1000 [00:04<00:04, 158.34it/s] 33%|███▎      | 333/1000 [00:04<00:02, 242.47it/s] 38%|███▊      | 383/1000 [00:04<00:02, 291.35it/s] 35%|███▍      | 349/1000 [00:04<00:02, 253.53it/s] 28%|██▊       | 279/1000 [00:04<00:04, 175.95it/s] 36%|███▋      | 364/1000 [00:04<00:02, 261.40it/s]Step399:rank1, time: 0.343, per_step: 0.003391
 41%|████▏     | 413/1000 [00:04<00:02, 277.55it/s]Step299:rank3, time: 0.507, per_step: 0.005018
 38%|███▊      | 382/1000 [00:04<00:02, 273.86it/s] 30%|███       | 304/1000 [00:04<00:03, 195.53it/s] 40%|███▉      | 398/1000 [00:04<00:02, 282.44it/s]Step399:rank0, time: 0.319, per_step: 0.003160
Step399:rank2, time: 0.323, per_step: 0.003193
 45%|████▌     | 451/1000 [00:04<00:01, 305.84it/s] 42%|████▏     | 416/1000 [00:04<00:02, 290.69it/s] 33%|███▎      | 332/1000 [00:04<00:03, 218.08it/s] 43%|████▎     | 433/1000 [00:04<00:01, 301.91it/s] 49%|████▉     | 489/1000 [00:04<00:01, 326.93it/s] 45%|████▌     | 451/1000 [00:04<00:01, 307.03it/s] 37%|███▋      | 367/1000 [00:04<00:02, 255.46it/s]Step499:rank1, time: 0.266, per_step: 0.002632
 47%|████▋     | 469/1000 [00:04<00:01, 317.52it/s] 53%|█████▎    | 528/1000 [00:04<00:01, 344.63it/s] 48%|████▊     | 485/1000 [00:04<00:01, 315.77it/s]Step399:rank3, time: 0.312, per_step: 0.003089
 40%|████      | 402/1000 [00:04<00:02, 282.74it/s]Step499:rank0, time: 0.302, per_step: 0.002988
 50%|█████     | 501/1000 [00:04<00:01, 309.75it/s]Step499:rank2, time: 0.302, per_step: 0.002992
 57%|█████▋    | 566/1000 [00:04<00:01, 352.97it/s] 52%|█████▏    | 517/1000 [00:05<00:01, 306.92it/s] 43%|████▎     | 431/1000 [00:05<00:02, 270.55it/s] 53%|█████▎    | 533/1000 [00:05<00:01, 302.72it/s]Step599:rank1, time: 0.270, per_step: 0.002673
 60%|██████    | 602/1000 [00:05<00:01, 353.17it/s] 55%|█████▍    | 548/1000 [00:05<00:01, 294.11it/s] 46%|████▌     | 462/1000 [00:05<00:01, 281.76it/s] 56%|█████▋    | 564/1000 [00:05<00:01, 300.18it/s] 64%|██████▍   | 638/1000 [00:05<00:01, 325.69it/s] 49%|████▉     | 494/1000 [00:05<00:01, 291.99it/s] 58%|█████▊    | 578/1000 [00:05<00:01, 277.48it/s]Step499:rank3, time: 0.345, per_step: 0.003418
 60%|█████▉    | 597/1000 [00:05<00:01, 305.76it/s]Step599:rank0, time: 0.334, per_step: 0.003310
Step599:rank2, time: 0.372, per_step: 0.003680
 68%|██████▊   | 677/1000 [00:05<00:00, 342.92it/s] 53%|█████▎    | 531/1000 [00:05<00:01, 313.57it/s] 61%|██████    | 606/1000 [00:05<00:01, 276.92it/s] 63%|██████▎   | 628/1000 [00:05<00:01, 286.27it/s]Step699:rank1, time: 0.342, per_step: 0.003391
 57%|█████▋    | 572/1000 [00:05<00:01, 340.94it/s] 71%|███████   | 712/1000 [00:05<00:00, 309.11it/s] 63%|██████▎   | 634/1000 [00:05<00:01, 262.55it/s]Step599:rank3, time: 0.260, per_step: 0.002570
 66%|██████▌   | 657/1000 [00:05<00:01, 269.56it/s] 61%|██████    | 608/1000 [00:05<00:01, 344.94it/s] 75%|███████▌  | 753/1000 [00:05<00:00, 334.20it/s] 66%|██████▋   | 663/1000 [00:05<00:01, 268.41it/s] 69%|██████▊   | 687/1000 [00:05<00:01, 276.36it/s] 64%|██████▍   | 643/1000 [00:05<00:01, 319.29it/s]Step699:rank0, time: 0.384, per_step: 0.003799
 79%|███████▉  | 793/1000 [00:05<00:00, 351.13it/s] 70%|██████▉   | 699/1000 [00:05<00:01, 293.09it/s]Step699:rank2, time: 0.356, per_step: 0.003526
Step799:rank1, time: 0.256, per_step: 0.002538
 72%|███████▏  | 718/1000 [00:05<00:00, 283.14it/s] 68%|██████▊   | 676/1000 [00:05<00:01, 322.17it/s] 83%|████████▎ | 829/1000 [00:05<00:00, 353.41it/s] 73%|███████▎  | 729/1000 [00:05<00:00, 294.50it/s] 76%|███████▋  | 763/1000 [00:05<00:00, 329.78it/s]Step699:rank3, time: 0.329, per_step: 0.003254
 71%|███████   | 710/1000 [00:05<00:00, 327.11it/s] 86%|████████▋ | 865/1000 [00:05<00:00, 351.39it/s] 76%|███████▋  | 765/1000 [00:05<00:00, 312.95it/s]Step799:rank0, time: 0.225, per_step: 0.002229
 82%|████████▏ | 820/1000 [00:05<00:00, 397.59it/s]Step799:rank2, time: 0.270, per_step: 0.002674
Step899:rank1, time: 0.273, per_step: 0.002703
 75%|███████▌  | 752/1000 [00:05<00:00, 353.95it/s] 91%|█████████ | 906/1000 [00:05<00:00, 366.21it/s] 81%|████████▏ | 814/1000 [00:05<00:00, 363.43it/s] 87%|████████▋ | 872/1000 [00:06<00:00, 432.20it/s] 80%|███████▉  | 795/1000 [00:06<00:00, 374.00it/s]Step799:rank3, time: 0.240, per_step: 0.002372
 86%|████████▋ | 864/1000 [00:06<00:00, 402.46it/s] 95%|█████████▍| 947/1000 [00:06<00:00, 376.61it/s]Step899:rank0, time: 0.191, per_step: 0.001889
 92%|█████████▎| 925/1000 [00:06<00:00, 458.32it/s]Step899:rank2, time: 0.202, per_step: 0.001996
 84%|████████▎ | 837/1000 [00:06<00:00, 386.97it/s] 91%|█████████▏| 914/1000 [00:06<00:00, 429.55it/s] 99%|█████████▉| 988/1000 [00:06<00:00, 384.51it/s]Step999:rank1, time: 0.249, per_step: 0.002464
100%|██████████| 1000/1000 [00:06<00:00, 161.18it/s]
 97%|█████████▋| 974/1000 [00:06<00:00, 465.57it/s] 88%|████████▊ | 876/1000 [00:06<00:00, 381.18it/s] 96%|█████████▌| 958/1000 [00:06<00:00, 428.16it/s]Step999:rank0, time: 0.222, per_step: 0.002199
100%|██████████| 1000/1000 [00:06<00:00, 158.81it/s]
Step899:rank3, time: 0.238, per_step: 0.002361
 93%|█████████▎| 932/1000 [00:06<00:00, 433.37it/s]Step999:rank2, time: 0.251, per_step: 0.002486
100%|██████████| 1000/1000 [00:06<00:00, 156.34it/s]
Step999:rank3, time: 0.146, per_step: 0.001443
100%|██████████| 1000/1000 [00:06<00:00, 154.89it/s]
Worker 3 pid=59309
Successfully xmh

perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f75992c6e50>==========
Worker 0 pid=56899
Worker 1 pid=56900
Worker 2 pid=56901
Worker 3 pid=56902
Worker 4 pid=56903
Worker 5 pid=56904
Worker 6 pid=56905
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]Step99:rank0, time: 0.080, per_step: 0.000798
 16%|█▋        | 165/1000 [00:00<00:00, 1646.61it/s]Step199:rank0, time: 0.059, per_step: 0.000586
Step299:rank0, time: 0.039, per_step: 0.000390
 40%|███▉      | 398/1000 [00:00<00:00, 2044.39it/s]Step399:rank0, time: 0.040, per_step: 0.000396
Step499:rank0, time: 0.040, per_step: 0.000395
Step599:rank0, time: 0.040, per_step: 0.000391
 65%|██████▍   | 649/1000 [00:00<00:00, 2256.01it/s]Step699:rank0, time: 0.040, per_step: 0.000395
Step799:rank0, time: 0.040, per_step: 0.000393
Step899:rank0, time: 0.040, per_step: 0.000392
 90%|█████████ | 901/1000 [00:00<00:00, 2359.16it/s]Step999:rank0, time: 0.040, per_step: 0.000392
100%|██████████| 1000/1000 [00:00<00:00, 2272.94it/s]
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]cudaHostRegister cudaError.success, type(r)=<class 'torch._C._cudart.cudaError'>
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<03:12,  5.20it/s]  0%|          | 1/1000 [00:00<04:20,  3.83it/s]  0%|          | 1/1000 [00:00<04:21,  3.82it/s]  0%|          | 1/1000 [00:00<04:00,  4.15it/s]  0%|          | 1/1000 [00:00<01:40,  9.98it/s]  0%|          | 1/1000 [00:00<04:21,  3.82it/s]  0%|          | 1/1000 [00:00<03:39,  4.56it/s]Step99:rank4, time: 0.165, per_step: 0.001648
Step99:rank2, time: 0.320, per_step: 0.003196
Step99:rank3, time: 0.246, per_step: 0.002456
Step99:rank7, time: 0.318, per_step: 0.003181
Step99:rank1, time: 0.309, per_step: 0.003087
Step99:rank5, time: 0.359, per_step: 0.003588
Step99:rank6, time: 0.303, per_step: 0.003033
Step199:rank7, time: 0.044, per_step: 0.000438
Step199:rank2, time: 0.050, per_step: 0.000499
Step199:rank4, time: 0.051, per_step: 0.000503
Step199:rank3, time: 0.051, per_step: 0.000504
 21%|██        | 209/1000 [00:00<00:01, 737.62it/s] 21%|██        | 209/1000 [00:00<00:00, 1225.28it/s] 15%|█▌        | 154/1000 [00:00<00:01, 571.88it/s] 21%|██        | 207/1000 [00:00<00:00, 879.15it/s] 21%|██▏       | 213/1000 [00:00<00:01, 749.93it/s] 13%|█▎        | 131/1000 [00:00<00:01, 515.21it/s] 13%|█▎        | 132/1000 [00:00<00:01, 464.89it/s]Step199:rank1, time: 0.066, per_step: 0.000651
Step299:rank7, time: 0.043, per_step: 0.000422
Step299:rank4, time: 0.043, per_step: 0.000426
Step299:rank2, time: 0.043, per_step: 0.000430
Step299:rank3, time: 0.044, per_step: 0.000434
Step199:rank5, time: 0.070, per_step: 0.000690
Step199:rank6, time: 0.070, per_step: 0.000689
Step399:rank7, time: 0.042, per_step: 0.000420
Step399:rank4, time: 0.043, per_step: 0.000427
Step399:rank2, time: 0.044, per_step: 0.000434
Step399:rank3, time: 0.044, per_step: 0.000437
Step299:rank1, time: 0.060, per_step: 0.000592
Step299:rank6, time: 0.048, per_step: 0.000473
 44%|████▍     | 440/1000 [00:00<00:00, 1719.96it/s] 44%|████▍     | 438/1000 [00:00<00:00, 1257.16it/s] 45%|████▍     | 447/1000 [00:00<00:00, 1282.53it/s] 32%|███▏      | 321/1000 [00:00<00:00, 952.62it/s] 28%|██▊       | 276/1000 [00:00<00:00, 791.32it/s] 43%|████▎     | 434/1000 [00:00<00:00, 1403.60it/s] 31%|███       | 312/1000 [00:00<00:00, 980.55it/s]Step299:rank5, time: 0.065, per_step: 0.000639
Step499:rank7, time: 0.044, per_step: 0.000435
Step499:rank4, time: 0.045, per_step: 0.000442
Step499:rank2, time: 0.045, per_step: 0.000447
Step499:rank3, time: 0.045, per_step: 0.000450
Step399:rank6, time: 0.043, per_step: 0.000430
Step399:rank1, time: 0.062, per_step: 0.000611
Step399:rank5, time: 0.044, per_step: 0.000440
Step599:rank7, time: 0.043, per_step: 0.000430
Step599:rank4, time: 0.044, per_step: 0.000434
Step599:rank2, time: 0.044, per_step: 0.000436
Step599:rank3, time: 0.044, per_step: 0.000438
Step499:rank6, time: 0.042, per_step: 0.000415
Step499:rank5, time: 0.041, per_step: 0.000411
 51%|█████     | 507/1000 [00:00<00:00, 1282.89it/s] 67%|██████▋   | 668/1000 [00:00<00:00, 1593.45it/s] 67%|██████▋   | 672/1000 [00:00<00:00, 1953.68it/s] 49%|████▉     | 489/1000 [00:00<00:00, 1192.22it/s] 68%|██████▊   | 683/1000 [00:00<00:00, 1629.19it/s] 66%|██████▌   | 662/1000 [00:00<00:00, 1709.44it/s] 55%|█████▌    | 550/1000 [00:00<00:00, 1454.09it/s]Step499:rank1, time: 0.058, per_step: 0.000573
Step699:rank7, time: 0.041, per_step: 0.000402
Step699:rank4, time: 0.041, per_step: 0.000409
Step699:rank2, time: 0.042, per_step: 0.000411
Step699:rank3, time: 0.042, per_step: 0.000415
Step599:rank6, time: 0.040, per_step: 0.000399
Step599:rank5, time: 0.041, per_step: 0.000409
Step799:rank7, time: 0.040, per_step: 0.000401
Step799:rank4, time: 0.041, per_step: 0.000409
Step799:rank2, time: 0.042, per_step: 0.000413
Step799:rank3, time: 0.042, per_step: 0.000415
Step699:rank6, time: 0.040, per_step: 0.000396
Step599:rank1, time: 0.057, per_step: 0.000563
Step699:rank5, time: 0.041, per_step: 0.000409
Step899:rank7, time: 0.041, per_step: 0.000403
Step899:rank4, time: 0.041, per_step: 0.000407
Step899:rank2, time: 0.041, per_step: 0.000410
 75%|███████▍  | 749/1000 [00:00<00:00, 1642.19it/s]Step899:rank3, time: 0.042, per_step: 0.000417
 90%|█████████ | 900/1000 [00:00<00:00, 1932.94it/s] 93%|█████████▎| 929/1000 [00:00<00:00, 1890.72it/s] 92%|█████████▏| 915/1000 [00:00<00:00, 2122.52it/s] 91%|█████████ | 909/1000 [00:00<00:00, 1849.32it/s] 66%|██████▋   | 665/1000 [00:00<00:00, 1373.02it/s]Step799:rank6, time: 0.040, per_step: 0.000397
 80%|████████  | 800/1000 [00:00<00:00, 1794.09it/s]Step699:rank1, time: 0.057, per_step: 0.000566
Step799:rank5, time: 0.042, per_step: 0.000412
Step999:rank7, time: 0.041, per_step: 0.000404
100%|██████████| 1000/1000 [00:00<00:00, 1445.59it/s]
Step999:rank4, time: 0.042, per_step: 0.000415
100%|██████████| 1000/1000 [00:00<00:00, 1862.78it/s]
Step999:rank2, time: 0.042, per_step: 0.000420
100%|██████████| 1000/1000 [00:00<00:00, 1426.69it/s]
Step899:rank6, time: 0.042, per_step: 0.000419
Step999:rank3, time: 0.043, per_step: 0.000425
100%|██████████| 1000/1000 [00:00<00:00, 1571.46it/s]
Step899:rank5, time: 0.042, per_step: 0.000411
Step799:rank1, time: 0.057, per_step: 0.000569
Step999:rank6, time: 0.049, per_step: 0.000489
100%|██████████| 1000/1000 [00:00<00:00, 1403.92it/s]
 99%|█████████▉| 992/1000 [00:00<00:00, 1884.90it/s] 84%|████████▍ | 840/1000 [00:00<00:00, 1489.63it/s]Step999:rank5, time: 0.041, per_step: 0.000405
100%|██████████| 1000/1000 [00:00<00:00, 1305.62it/s]
Step899:rank1, time: 0.057, per_step: 0.000560
Step999:rank1, time: 0.055, per_step: 0.000547
100%|██████████| 1000/1000 [00:00<00:00, 1202.75it/s]
Worker 7 pid=56906
Successfully xmh

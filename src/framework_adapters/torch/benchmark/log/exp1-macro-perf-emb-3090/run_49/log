perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f094adb8e50>==========
Worker 0 pid=47854
Worker 1 pid=47855
Worker 2 pid=47856
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:00<05:34,  2.99it/s]  0%|          | 1/1000 [00:00<05:31,  3.01it/s]  0%|          | 1/1000 [00:00<09:52,  1.69it/s]  0%|          | 1/1000 [00:00<06:04,  2.74it/s]  2%|▏         | 18/1000 [00:00<00:19, 49.66it/s]  2%|▏         | 18/1000 [00:00<00:28, 34.26it/s]  2%|▏         | 18/1000 [00:00<00:18, 53.05it/s]  2%|▏         | 18/1000 [00:00<00:18, 52.75it/s]  4%|▎         | 37/1000 [00:00<00:14, 67.33it/s]  4%|▎         | 37/1000 [00:00<00:10, 92.47it/s]  4%|▎         | 37/1000 [00:00<00:10, 92.81it/s]  4%|▎         | 37/1000 [00:00<00:10, 88.31it/s]  6%|▌         | 58/1000 [00:00<00:07, 122.44it/s]  6%|▌         | 58/1000 [00:00<00:07, 126.36it/s]  6%|▌         | 58/1000 [00:00<00:07, 126.02it/s]  6%|▌         | 58/1000 [00:00<00:09, 99.97it/s]  8%|▊         | 80/1000 [00:00<00:06, 153.06it/s]  8%|▊         | 80/1000 [00:00<00:06, 149.68it/s]  8%|▊         | 80/1000 [00:01<00:07, 129.20it/s]  8%|▊         | 80/1000 [00:00<00:06, 152.75it/s]Step99:rank1, time: 1.124, per_step: 0.011242
Step99:rank2, time: 0.844, per_step: 0.008435
Step99:rank0, time: 0.846, per_step: 0.008458
Step99:rank3, time: 0.878, per_step: 0.008778
 10%|█         | 101/1000 [00:00<00:05, 168.87it/s] 10%|█         | 101/1000 [00:01<00:06, 149.71it/s] 10%|█         | 101/1000 [00:00<00:05, 169.06it/s] 10%|█         | 101/1000 [00:00<00:05, 166.06it/s] 12%|█▏        | 123/1000 [00:01<00:05, 168.52it/s] 12%|█▏        | 123/1000 [00:00<00:04, 183.81it/s] 12%|█▏        | 123/1000 [00:00<00:04, 183.65it/s] 12%|█▏        | 124/1000 [00:00<00:04, 182.30it/s] 15%|█▍        | 146/1000 [00:01<00:04, 196.79it/s] 15%|█▍        | 146/1000 [00:01<00:04, 184.98it/s] 15%|█▍        | 146/1000 [00:01<00:04, 196.63it/s] 15%|█▍        | 147/1000 [00:01<00:04, 195.66it/s] 17%|█▋        | 170/1000 [00:01<00:04, 198.28it/s] 17%|█▋        | 170/1000 [00:01<00:04, 206.96it/s] 17%|█▋        | 170/1000 [00:01<00:04, 207.03it/s] 17%|█▋        | 171/1000 [00:01<00:04, 206.21it/s] 19%|█▉        | 194/1000 [00:01<00:03, 215.17it/s] 19%|█▉        | 194/1000 [00:01<00:03, 208.75it/s] 19%|█▉        | 194/1000 [00:01<00:03, 215.19it/s] 20%|█▉        | 195/1000 [00:01<00:03, 214.60it/s]Step199:rank2, time: 0.440, per_step: 0.004361
Step199:rank1, time: 0.441, per_step: 0.004362
Step199:rank3, time: 0.439, per_step: 0.004350
Step199:rank0, time: 0.441, per_step: 0.004362
 22%|██▏       | 218/1000 [00:01<00:03, 221.99it/s] 22%|██▏       | 218/1000 [00:01<00:03, 217.25it/s] 22%|██▏       | 218/1000 [00:01<00:03, 221.89it/s] 22%|██▏       | 219/1000 [00:01<00:03, 221.57it/s] 24%|██▍       | 243/1000 [00:01<00:03, 224.23it/s] 24%|██▍       | 243/1000 [00:01<00:03, 227.56it/s] 24%|██▍       | 243/1000 [00:01<00:03, 227.55it/s] 24%|██▍       | 244/1000 [00:01<00:03, 227.30it/s] 27%|██▋       | 267/1000 [00:01<00:03, 227.51it/s] 27%|██▋       | 267/1000 [00:01<00:03, 225.12it/s] 27%|██▋       | 267/1000 [00:01<00:03, 227.49it/s] 27%|██▋       | 268/1000 [00:01<00:03, 227.37it/s] 29%|██▉       | 291/1000 [00:01<00:03, 228.05it/s] 29%|██▉       | 291/1000 [00:01<00:03, 229.75it/s] 29%|██▉       | 291/1000 [00:01<00:03, 229.66it/s] 29%|██▉       | 292/1000 [00:01<00:03, 229.64it/s]Step299:rank3, time: 0.424, per_step: 0.004196
Step299:rank0, time: 0.424, per_step: 0.004197
Step299:rank1, time: 0.424, per_step: 0.004197
Step299:rank2, time: 0.424, per_step: 0.004199
 32%|███▏      | 316/1000 [00:02<00:02, 232.92it/s] 32%|███▏      | 316/1000 [00:01<00:02, 234.12it/s] 32%|███▏      | 316/1000 [00:01<00:02, 234.04it/s] 32%|███▏      | 317/1000 [00:01<00:02, 234.03it/s] 34%|███▍      | 341/1000 [00:02<00:02, 237.15it/s] 34%|███▍      | 341/1000 [00:01<00:02, 238.01it/s] 34%|███▍      | 341/1000 [00:01<00:02, 237.98it/s] 34%|███▍      | 342/1000 [00:01<00:02, 238.08it/s] 36%|███▋      | 365/1000 [00:01<00:02, 223.24it/s] 36%|███▋      | 365/1000 [00:01<00:02, 223.25it/s] 36%|███▋      | 365/1000 [00:02<00:02, 222.28it/s] 37%|███▋      | 366/1000 [00:02<00:02, 222.52it/s] 39%|███▉      | 389/1000 [00:02<00:02, 227.73it/s] 39%|███▉      | 389/1000 [00:02<00:02, 227.68it/s] 39%|███▉      | 390/1000 [00:02<00:02, 227.62it/s] 39%|███▉      | 391/1000 [00:02<00:02, 228.20it/s]Step399:rank3, time: 0.453, per_step: 0.004482
Step399:rank1, time: 0.453, per_step: 0.004482
Step399:rank2, time: 0.453, per_step: 0.004481
Step399:rank0, time: 0.454, per_step: 0.004492
 41%|████      | 412/1000 [00:02<00:02, 213.56it/s] 41%|████      | 412/1000 [00:02<00:02, 213.42it/s] 41%|████▏     | 413/1000 [00:02<00:02, 213.33it/s] 42%|████▏     | 415/1000 [00:02<00:02, 213.61it/s] 44%|████▎     | 435/1000 [00:02<00:02, 216.06it/s] 44%|████▎     | 435/1000 [00:02<00:02, 216.02it/s] 44%|████▎     | 436/1000 [00:02<00:02, 216.01it/s] 44%|████▍     | 438/1000 [00:02<00:02, 216.15it/s] 46%|████▌     | 458/1000 [00:02<00:02, 216.81it/s] 46%|████▌     | 458/1000 [00:02<00:02, 216.59it/s] 46%|████▌     | 458/1000 [00:02<00:02, 216.72it/s] 46%|████▌     | 460/1000 [00:02<00:02, 216.80it/s] 48%|████▊     | 482/1000 [00:02<00:02, 221.43it/s] 48%|████▊     | 482/1000 [00:02<00:02, 221.32it/s] 48%|████▊     | 482/1000 [00:02<00:02, 221.34it/s] 48%|████▊     | 484/1000 [00:02<00:02, 221.37it/s]Step499:rank3, time: 0.455, per_step: 0.004501
Step499:rank2, time: 0.455, per_step: 0.004501
Step499:rank1, time: 0.455, per_step: 0.004501
Step499:rank0, time: 0.454, per_step: 0.004492
 50%|█████     | 505/1000 [00:02<00:02, 221.49it/s] 50%|█████     | 505/1000 [00:02<00:02, 221.38it/s] 50%|█████     | 505/1000 [00:02<00:02, 221.48it/s] 51%|█████     | 507/1000 [00:02<00:02, 221.57it/s] 53%|█████▎    | 529/1000 [00:02<00:02, 225.57it/s] 53%|█████▎    | 529/1000 [00:02<00:02, 225.58it/s] 53%|█████▎    | 529/1000 [00:02<00:02, 225.54it/s] 53%|█████▎    | 531/1000 [00:02<00:02, 225.58it/s] 55%|█████▌    | 553/1000 [00:03<00:01, 228.62it/s] 55%|█████▌    | 553/1000 [00:02<00:01, 228.62it/s] 55%|█████▌    | 553/1000 [00:02<00:01, 228.56it/s] 56%|█████▌    | 555/1000 [00:02<00:01, 228.70it/s] 58%|█████▊    | 577/1000 [00:03<00:01, 231.33it/s] 58%|█████▊    | 577/1000 [00:02<00:01, 231.31it/s] 58%|█████▊    | 577/1000 [00:02<00:01, 231.33it/s] 58%|█████▊    | 579/1000 [00:02<00:01, 231.49it/s]Step599:rank2, time: 0.424, per_step: 0.004197
Step599:rank3, time: 0.424, per_step: 0.004197
Step599:rank1, time: 0.424, per_step: 0.004197
Step599:rank0, time: 0.424, per_step: 0.004196
 60%|██████    | 601/1000 [00:03<00:01, 233.26it/s] 60%|██████    | 601/1000 [00:03<00:01, 233.24it/s] 60%|██████    | 601/1000 [00:03<00:01, 233.24it/s] 60%|██████    | 603/1000 [00:03<00:01, 233.29it/s] 62%|██████▎   | 625/1000 [00:03<00:01, 235.19it/s] 62%|██████▎   | 625/1000 [00:03<00:01, 235.13it/s] 62%|██████▎   | 625/1000 [00:03<00:01, 235.13it/s] 63%|██████▎   | 627/1000 [00:03<00:01, 235.24it/s] 65%|██████▍   | 649/1000 [00:03<00:01, 234.30it/s] 65%|██████▍   | 649/1000 [00:03<00:01, 234.22it/s] 65%|██████▍   | 649/1000 [00:03<00:01, 234.25it/s] 65%|██████▌   | 651/1000 [00:03<00:01, 234.29it/s] 67%|██████▋   | 674/1000 [00:03<00:01, 236.73it/s] 67%|██████▋   | 674/1000 [00:03<00:01, 236.73it/s] 67%|██████▋   | 674/1000 [00:03<00:01, 236.74it/s] 68%|██████▊   | 676/1000 [00:03<00:01, 236.91it/s] 70%|██████▉   | 699/1000 [00:03<00:01, 238.79it/s] 70%|██████▉   | 699/1000 [00:03<00:01, 238.77it/s] 70%|██████▉   | 699/1000 [00:03<00:01, 238.77it/s]Step699:rank2, time: 0.418, per_step: 0.004135
Step699:rank1, time: 0.418, per_step: 0.004136
Step699:rank3, time: 0.418, per_step: 0.004136
Step699:rank0, time: 0.418, per_step: 0.004135
 70%|███████   | 701/1000 [00:03<00:01, 238.89it/s] 72%|███████▏  | 724/1000 [00:03<00:01, 240.26it/s] 72%|███████▏  | 724/1000 [00:03<00:01, 240.23it/s] 72%|███████▏  | 724/1000 [00:03<00:01, 240.27it/s] 73%|███████▎  | 726/1000 [00:03<00:01, 240.29it/s] 75%|███████▍  | 749/1000 [00:03<00:01, 241.10it/s] 75%|███████▍  | 749/1000 [00:03<00:01, 241.11it/s] 75%|███████▍  | 749/1000 [00:03<00:01, 241.09it/s] 75%|███████▌  | 751/1000 [00:03<00:01, 241.16it/s] 77%|███████▋  | 774/1000 [00:04<00:00, 242.58it/s] 77%|███████▋  | 774/1000 [00:03<00:00, 242.55it/s] 77%|███████▋  | 774/1000 [00:03<00:00, 242.58it/s] 78%|███████▊  | 776/1000 [00:03<00:00, 242.63it/s] 80%|███████▉  | 799/1000 [00:03<00:00, 242.91it/s] 80%|███████▉  | 799/1000 [00:04<00:00, 242.89it/s] 80%|███████▉  | 799/1000 [00:03<00:00, 242.86it/s]Step799:rank1, time: 0.410, per_step: 0.004055
Step799:rank3, time: 0.410, per_step: 0.004055
Step799:rank2, time: 0.410, per_step: 0.004056
Step799:rank0, time: 0.410, per_step: 0.004056
 80%|████████  | 801/1000 [00:03<00:00, 242.88it/s] 82%|████████▏ | 824/1000 [00:03<00:00, 243.55it/s] 82%|████████▏ | 824/1000 [00:04<00:00, 243.50it/s] 82%|████████▏ | 824/1000 [00:03<00:00, 243.55it/s] 83%|████████▎ | 826/1000 [00:04<00:00, 243.60it/s] 85%|████████▍ | 849/1000 [00:04<00:00, 234.42it/s] 85%|████████▍ | 849/1000 [00:04<00:00, 234.47it/s] 85%|████████▍ | 849/1000 [00:04<00:00, 232.81it/s] 85%|████████▌ | 851/1000 [00:04<00:00, 229.43it/s] 87%|████████▋ | 873/1000 [00:04<00:00, 226.63it/s] 87%|████████▋ | 873/1000 [00:04<00:00, 226.09it/s] 87%|████████▋ | 873/1000 [00:04<00:00, 224.88it/s] 88%|████████▊ | 875/1000 [00:04<00:00, 223.80it/s] 90%|████████▉ | 898/1000 [00:04<00:00, 231.26it/s] 90%|████████▉ | 898/1000 [00:04<00:00, 231.50it/s] 90%|████████▉ | 898/1000 [00:04<00:00, 231.75it/s]Step899:rank2, time: 0.439, per_step: 0.004344
Step899:rank3, time: 0.439, per_step: 0.004345
Step899:rank1, time: 0.439, per_step: 0.004345
Step899:rank0, time: 0.439, per_step: 0.004342
 90%|█████████ | 902/1000 [00:04<00:00, 235.00it/s] 93%|█████████▎| 927/1000 [00:04<00:00, 246.32it/s] 93%|█████████▎| 927/1000 [00:04<00:00, 245.90it/s] 93%|█████████▎| 927/1000 [00:04<00:00, 246.11it/s] 93%|█████████▎| 931/1000 [00:04<00:00, 248.68it/s] 96%|█████████▌| 956/1000 [00:04<00:00, 257.16it/s] 96%|█████████▌| 956/1000 [00:04<00:00, 256.98it/s] 96%|█████████▌| 956/1000 [00:04<00:00, 257.23it/s] 96%|█████████▌| 959/1000 [00:04<00:00, 254.05it/s] 98%|█████████▊| 983/1000 [00:04<00:00, 259.97it/s] 98%|█████████▊| 983/1000 [00:04<00:00, 259.84it/s] 98%|█████████▊| 983/1000 [00:04<00:00, 259.98it/s] 99%|█████████▉| 988/1000 [00:04<00:00, 262.96it/s]Step999:rank2, time: 0.359, per_step: 0.003551
Step999:rank3, time: 0.359, per_step: 0.003550
Step999:rank0, time: 0.359, per_step: 0.003551
Step999:rank1, time: 0.359, per_step: 0.003551
100%|██████████| 1000/1000 [00:04<00:00, 214.63it/s]100%|██████████| 1000/1000 [00:04<00:00, 213.13it/s]100%|██████████| 1000/1000 [00:04<00:00, 203.22it/s]100%|██████████| 1000/1000 [00:04<00:00, 214.51it/s]



Worker 3 pid=47857
Successfully xmh

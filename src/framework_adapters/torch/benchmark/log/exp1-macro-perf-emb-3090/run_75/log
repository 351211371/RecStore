perf_emb.py:126: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("Before init DistEmbedding")
WARNING [perf_emb.py:126] Before init DistEmbedding
perf_emb.py:129: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  logging.warn("After init DistEmbedding")
WARNING [perf_emb.py:129] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f0ea8109e50>==========
Worker 0 pid=54435
Worker 1 pid=54436
Worker 2 pid=54437
Worker 3 pid=54438
Worker 4 pid=54439
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [distributed_c10d.py:466] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [distributed_c10d.py:466] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:432] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [distributed_c10d.py:466] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [distributed_c10d.py:466] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]weight.shape torch.Size([100000000, 32])
weight.shape torch.Size([100000000, 32])
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 1/1000 [00:02<35:20,  2.12s/it]  0%|          | 1/1000 [00:02<35:21,  2.12s/it]  0%|          | 1/1000 [00:02<35:03,  2.11s/it]  0%|          | 1/1000 [00:02<35:24,  2.13s/it]  0%|          | 1/1000 [00:02<35:56,  2.16s/it]  0%|          | 1/1000 [00:02<35:57,  2.16s/it]  3%|▎         | 28/1000 [00:02<00:55, 17.60it/s]  3%|▎         | 28/1000 [00:02<00:55, 17.45it/s]  2%|▏         | 24/1000 [00:02<01:05, 14.92it/s]  3%|▎         | 29/1000 [00:02<00:53, 18.04it/s]  3%|▎         | 29/1000 [00:02<00:54, 17.79it/s]  3%|▎         | 29/1000 [00:02<00:54, 17.78it/s]  6%|▋         | 63/1000 [00:02<00:20, 45.24it/s]  6%|▋         | 63/1000 [00:02<00:20, 44.84it/s]  6%|▌         | 58/1000 [00:02<00:22, 41.71it/s]  6%|▋         | 64/1000 [00:02<00:20, 45.38it/s]  6%|▋         | 64/1000 [00:02<00:20, 44.77it/s]  6%|▋         | 64/1000 [00:02<00:20, 44.70it/s]Step99:rank4, time: 2.408, per_step: 0.024078
Step99:rank3, time: 2.424, per_step: 0.024244
 11%|█         | 106/1000 [00:02<00:10, 85.95it/s] 10%|█         | 105/1000 [00:02<00:10, 84.33it/s] 10%|▉         | 99/1000 [00:02<00:11, 80.43it/s]Step99:rank5, time: 2.439, per_step: 0.024385
Step99:rank1, time: 2.428, per_step: 0.024276
 11%|█         | 106/1000 [00:02<00:10, 84.72it/s]Step99:rank2, time: 2.459, per_step: 0.024593
Step99:rank0, time: 2.463, per_step: 0.024630
 11%|█         | 106/1000 [00:02<00:10, 83.64it/s] 10%|█         | 105/1000 [00:02<00:10, 82.58it/s] 16%|█▌        | 157/1000 [00:02<00:05, 141.28it/s] 15%|█▌        | 150/1000 [00:02<00:06, 132.39it/s] 15%|█▍        | 149/1000 [00:02<00:06, 134.95it/s] 16%|█▌        | 157/1000 [00:02<00:06, 140.09it/s] 16%|█▌        | 157/1000 [00:02<00:06, 138.71it/s] 16%|█▌        | 155/1000 [00:02<00:06, 136.23it/s]Step199:rank3, time: 0.181, per_step: 0.001791
Step199:rank4, time: 0.196, per_step: 0.001941
Step199:rank5, time: 0.183, per_step: 0.001816
Step199:rank1, time: 0.183, per_step: 0.001813
 22%|██▏       | 222/1000 [00:02<00:03, 221.04it/s] 21%|██▏       | 213/1000 [00:02<00:03, 210.63it/s] 21%|██        | 211/1000 [00:02<00:03, 211.11it/s]Step199:rank2, time: 0.183, per_step: 0.001811
Step199:rank0, time: 0.188, per_step: 0.001866
 22%|██▏       | 223/1000 [00:02<00:03, 221.36it/s] 22%|██▏       | 222/1000 [00:02<00:03, 218.13it/s] 22%|██▏       | 217/1000 [00:02<00:03, 211.16it/s]Step299:rank3, time: 0.124, per_step: 0.001226
 31%|███       | 308/1000 [00:02<00:02, 337.89it/s] 30%|██▉       | 295/1000 [00:02<00:02, 322.35it/s] 29%|██▉       | 294/1000 [00:02<00:02, 324.44it/s]Step299:rank4, time: 0.125, per_step: 0.001235
Step299:rank5, time: 0.123, per_step: 0.001214
Step299:rank1, time: 0.122, per_step: 0.001206
 31%|███       | 311/1000 [00:02<00:02, 341.48it/s]Step299:rank2, time: 0.123, per_step: 0.001218
 31%|███       | 309/1000 [00:02<00:02, 336.16it/s] 30%|██▉       | 298/1000 [00:02<00:02, 319.57it/s]Step299:rank0, time: 0.128, per_step: 0.001269
Step399:rank3, time: 0.087, per_step: 0.000866
Step399:rank5, time: 0.087, per_step: 0.000858
Step399:rank4, time: 0.089, per_step: 0.000878
Step399:rank1, time: 0.087, per_step: 0.000858
 41%|████      | 408/1000 [00:02<00:01, 490.22it/s] 43%|████▎     | 429/1000 [00:02<00:01, 518.24it/s] 41%|████      | 410/1000 [00:02<00:01, 497.15it/s]Step399:rank2, time: 0.087, per_step: 0.000862
 44%|████▎     | 435/1000 [00:02<00:01, 527.08it/s]Step399:rank0, time: 0.091, per_step: 0.000900
 43%|████▎     | 431/1000 [00:02<00:01, 518.09it/s] 41%|████      | 409/1000 [00:02<00:01, 482.07it/s]Step499:rank3, time: 0.066, per_step: 0.000655
Step499:rank5, time: 0.065, per_step: 0.000648
Step499:rank4, time: 0.067, per_step: 0.000660
Step499:rank1, time: 0.065, per_step: 0.000647
Step499:rank2, time: 0.066, per_step: 0.000651
Step599:rank3, time: 0.053, per_step: 0.000526
 57%|█████▋    | 571/1000 [00:02<00:00, 750.81it/s] 60%|██████    | 604/1000 [00:02<00:00, 798.83it/s] 58%|█████▊    | 578/1000 [00:02<00:00, 766.44it/s]Step499:rank0, time: 0.070, per_step: 0.000693
Step599:rank5, time: 0.053, per_step: 0.000526
Step599:rank1, time: 0.053, per_step: 0.000522
Step599:rank4, time: 0.054, per_step: 0.000537
 62%|██████▏   | 615/1000 [00:02<00:00, 816.59it/s]Step599:rank2, time: 0.053, per_step: 0.000520
 61%|██████    | 608/1000 [00:02<00:00, 801.98it/s] 56%|█████▋    | 563/1000 [00:02<00:00, 721.77it/s]Step699:rank3, time: 0.045, per_step: 0.000449
Step699:rank5, time: 0.045, per_step: 0.000444
Step699:rank1, time: 0.045, per_step: 0.000447
Step599:rank0, time: 0.058, per_step: 0.000569
Step699:rank4, time: 0.047, per_step: 0.000461
Step699:rank2, time: 0.045, per_step: 0.000448
Step799:rank3, time: 0.041, per_step: 0.000404
Step799:rank5, time: 0.041, per_step: 0.000401
Step799:rank1, time: 0.040, per_step: 0.000397
 79%|███████▉  | 792/1000 [00:03<00:00, 1110.11it/s] 84%|████████▍ | 841/1000 [00:03<00:00, 1185.07it/s] 81%|████████  | 810/1000 [00:03<00:00, 1147.63it/s]Step799:rank4, time: 0.042, per_step: 0.000416
Step699:rank0, time: 0.049, per_step: 0.000485
Step799:rank2, time: 0.040, per_step: 0.000398
 86%|████████▌ | 858/1000 [00:03<00:00, 1212.75it/s]Step899:rank3, time: 0.038, per_step: 0.000374
Step899:rank5, time: 0.037, per_step: 0.000371
Step899:rank1, time: 0.038, per_step: 0.000372
 85%|████████▍ | 849/1000 [00:03<00:00, 1195.35it/s] 77%|███████▋  | 769/1000 [00:03<00:00, 1048.64it/s]Step899:rank4, time: 0.039, per_step: 0.000388
Step799:rank0, time: 0.045, per_step: 0.000441
Step899:rank2, time: 0.038, per_step: 0.000374
Step999:rank3, time: 0.036, per_step: 0.000353
100%|██████████| 1000/1000 [00:03<00:00, 323.96it/s]
Step999:rank5, time: 0.036, per_step: 0.000355
100%|██████████| 1000/1000 [00:03<00:00, 322.52it/s]
Step999:rank1, time: 0.036, per_step: 0.000354
100%|██████████| 1000/1000 [00:03<00:00, 324.08it/s]
Step999:rank4, time: 0.038, per_step: 0.000375
100%|██████████| 1000/1000 [00:03<00:00, 323.48it/s]
Step999:rank2, time: 0.036, per_step: 0.000356
100%|██████████| 1000/1000 [00:03<00:00, 320.37it/s]
Step899:rank0, time: 0.042, per_step: 0.000414
Step999:rank0, time: 0.041, per_step: 0.000404
100%|██████████| 1000/1000 [00:03<00:00, 315.93it/s]
Worker 5 pid=54440
Successfully xmh

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240125 16:12:13.815893 64220 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_101', no_save_emb=True, max_step=500, batch_size=800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [64220 sampler.py:454] Start PreSampling
WARNING [64220 sampler.py:532] Before construct renumbering_dict
WARNING [64220 sampler.py:555] PreSampling done
W20240125 16:12:24.029299 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240125 16:12:24.029661 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240125 16:12:24.029768 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240125 16:12:24.029822 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240125 16:12:24.029867 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240125 16:12:24.029902 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240125 16:12:24.029944 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240125 16:12:24.029996 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240125 16:12:24.030035 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240125 16:12:24.030082 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240125 16:12:24.030133 64220 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240125 16:12:24.030165 64220 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240125 16:12:24.030196 64220 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240125 16:12:24.030427 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240125 16:12:24.030486 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240125 16:12:24.030524 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240125 16:12:24.030560 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240125 16:12:24.030606 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240125 16:12:24.030640 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240125 16:12:24.030689 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240125 16:12:24.030727 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240125 16:12:24.030761 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240125 16:12:24.030812 64220 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240125 16:12:24.030853 64220 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240125 16:12:24.030885 64220 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240125 16:12:24.030920 64220 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240125 16:12:24.488327 64220 IPCTensor.h:365] NewIPCTensor: full_emb [14951, 400]0x100000f72000 22.81 MB
W20240125 16:12:24.488641 64220 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100002644000 58.4 kB
{0: Graph(num_nodes=13500, num_edges=273181,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12803, num_edges=385691,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13500 N 273181 E
MertisPartition: part 1 has 12803 N 385691 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  746,   787,   844,  ...,  6248, 12467, 13705]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13500, num_edges=273181,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13500, num_edges=273181,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 10.864 seconds
INFO [65269 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [64220 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [64220 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [65269 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240125 16:12:25.682643 65270 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240125 16:12:25.683079 65293 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240125 16:12:25.712822 65270 IPCTensor.h:365] NewIPCTensor: input_keys_0 [100000]0x100002658000 781.2 kB
W20240125 16:12:25.712855 65293 IPCTensor.h:365] NewIPCTensor: input_keys_1 [100000]0x10000271d000 781.2 kB
W20240125 16:12:25.713088 65270 IPCTensor.h:365] NewIPCTensor: input_keys_neg_0 [100000]0x1000027e2000 781.2 kB
W20240125 16:12:25.713092 65293 IPCTensor.h:365] NewIPCTensor: input_keys_neg_1 [100000]0x1000028a7000 781.2 kB
W20240125 16:12:25.713174 65270 IPCTensor.h:365] NewIPCTensor: backward_grads_0 [100000, 400]0x10000296c000 152.6 MB
W20240125 16:12:25.713198 65293 IPCTensor.h:365] NewIPCTensor: backward_grads_1 [100000, 400]0x10000c204000 152.6 MB
W20240125 16:12:25.713253 65270 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x100015a9c000 152.6 MB
W20240125 16:12:25.713258 65293 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x10001f334000 152.6 MB
W20240125 16:12:25.713310 65270 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240125 16:12:25.713316 65293 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240125 16:12:25.714531 65270 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240125 16:12:25.714540 65293 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
[Rank1] pid = 65269
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
cudaHostRegister 0x100000f72000
0: KnownLocalCachedEmbedding init done
WARNING [64220 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100000f72000
1: KnownLocalCachedEmbedding init done
WARNING [65269 DistTensor.py:56] The tensor name already exists in the kvstore
I20240125 16:12:25.944504 65293 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240125 16:12:25.944595 65270 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240125 16:12:25.945550 65270 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240125 16:12:25.945720 65270 grad_base.h:172] Init GradProcessingBase done
I20240125 16:12:25.951537 65270 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240125 16:12:25.951771 65270 kg_controller.h:78] after init GradAsyncProcessingV2
I20240125 16:12:25.951786 65270 kg_controller.h:84] Construct KGCacheController done
I20240125 16:12:26.318560 65270 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240125 16:12:26.593777   529 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:12:26.594812   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240125 16:12:26.685907 65293 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240125 16:12:26.726712 65270 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
E20240125 16:12:29.640787   652 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240125 16:12:29.774331 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240125 16:12:29.803649   529 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240125 16:12:30.656955   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240125 16:12:30.830543   529 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240125 16:12:30.918711 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=13, pq.top=13
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.419 ms                  | 45.813 ms                 |
| Forward                   | 12.503 ms                 | 1.861 s                   |
| Backward                  | 7.618 ms                  | 512.511 ms                |
| Optimize                  | 2.598 ms                  | 38.670 ms                 |
| BarrierTimeBeforeRank0    | 84.244 us                 | 138.568 us                |
| AfterBackward             | 36.435 ms                 | 666.120 ms                |
| BlockToStepN              | 725.966 us                | 82.907 ms                 |
| OneStep                   | 100.028 ms                | 3.070 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.115 ms                  | 194.628 ms                |
| ProcessBack:UpdateCache   | 736.297 us                | 334.068 ms                |
| ProcessBack:UpsertPq      | 15.904 ms                 | 135.593 ms                |
| ProcessOneStep            | 32.644 ms                 | 665.569 ms                |
| BlockToStepN              | 4.507 ms                  | 82.675 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:12:31.656030   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=52
W20240125 16:12:31.847162   529 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:12:31.997315 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=25, pq.top=25
E20240125 16:12:32.666910 65270 parallel_pq_v2.h:76] insert failed, size(hashtable)=96
W20240125 16:12:32.953876   529 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:12:32.997294 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=36, pq.top=36
E20240125 16:12:33.666226   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=7751
W20240125 16:12:33.966472   529 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240125 16:12:34.006922 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=48, pq.top=47
E20240125 16:12:34.666317   653 parallel_pq_v2.h:76] insert failed, size(hashtable)=97
W20240125 16:12:34.984196   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240125 16:12:35.006119 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=59, pq.top=58
E20240125 16:12:35.666719   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=11861
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.042 ms                  | 45.813 ms                 |
| Forward                   | 6.598 ms                  | 39.248 ms                 |
| Backward                  | 6.494 ms                  | 57.389 ms                 |
| Optimize                  | 2.558 ms                  | 14.604 ms                 |
| BarrierTimeBeforeRank0    | 79.528 us                 | 26.077 ms                 |
| AfterBackward             | 22.711 ms                 | 56.352 ms                 |
| BlockToStepN              | 20.065 ms                 | 72.698 ms                 |
| OneStep                   | 83.280 ms                 | 175.339 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:12:36.006166 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=71, pq.top=70
W20240125 16:12:36.124466   529 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.049 ms                  | 175.659 ms                |
| ProcessBack:UpdateCache   | 688.390 us                | 332.775 ms                |
| ProcessBack:UpsertPq      | 5.001 ms                  | 121.119 ms                |
| ProcessOneStep            | 23.347 ms                 | 56.282 ms                 |
| BlockToStepN              | 20.096 ms                 | 82.675 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:12:36.669384   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=10251
W20240125 16:12:37.097733 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=84, pq.top=84
W20240125 16:12:37.139565   529 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:12:37.669978   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=4445
W20240125 16:12:38.097162 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=94, pq.top=94
W20240125 16:12:38.200875   529 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 11.789, sample: 0.430, forward: 1.908, backward: 1.298, update: 0.225
train_sampler.Prefill()
-------Step 0-------
tensor([ 6927,  7218,  3159,  5509,    31,  9519, 14174,    34, 11442,  8163]) tensor([  859,  2763,  4038,  2488,  7647,  4044,  6175,  4331, 14213,  9679])
-------Step 1-------
tensor([ 6927,  7218,  3159,  5509,    31,  9519, 14174,    34, 11442,  8163]) tensor([ 3734, 10825, 11044,  1811,  1787,  7225,  2556,  5313, 10837,  4977])
-------Step 2-------
tensor([ 5397,    19,  3250,  8275,  7027,  9397, 13256,   189,    67,  6187]) tensor([ 9103,  7144,  5531, 13694,  7915,  7378, 12236,  7161,  1140,   154])
-------Step 3-------
tensor([ 5397,    19,  3250,  8275,  7027,  9397, 13256,   189,    67,  6187]) tensor([ 1478, 12937, 12282, 14831,  3462,  5953, 13369,  6115,  3236,  2245])
-------Step 4-------
tensor([13123,  3948,     4,   288,   352, 11665, 13451,  3650,  3871,    33]) tensor([ 9699,  4804,  5586, 13809,  3513, 14446, 13577,  9712,  6075,  8706])
-------Step 5-------
tensor([13123,  3948,     4,   288,   352, 11665, 13451,  3650,  3871,    33]) tensor([ 7867,  2571, 12051,  8187,  6214,  2813,  1453,  4467,  9388,  9284])
-------Step 6-------
tensor([  291,  2472,  5396, 12202, 11869,   243,    51,  3380,   255,   103]) tensor([10416,  4446, 13228,  2136, 12969,  8093,  7782,  4462, 14535, 13052])
-------Step 7-------
tensor([  291,  2472,  5396, 12202, 11869,   243,    51,  3380,   255,   103]) tensor([ 4049, 11688,  6022,  3370,  1675, 12057,  2043,  5747,  1052,  5329])
-------Step 8-------
tensor([10087,    86, 14599,   232,   206,  8614, 11956,   164,  9645,  6784]) tensor([14346, 11528,  6336,  4255, 11185, 14584,  5273, 11994,  6785, 11484])
-------Step 9-------
tensor([10087,    86, 14599,   232,   206,  8614, 11956,   164,  9645,  6784]) tensor([11058, 13487,  5253,  7196,  8464,  2680,  4426, 12933, 14361,  8072])
before start barrier
start train
[proc 0] 100 steps, total: 11.749, sample: 0.670, forward: 2.695, backward: 1.491, update: 0.305
E20240125 16:12:38.669018   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=99
W20240125 16:12:39.110445 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=108, pq.top=107
W20240125 16:12:39.204839   529 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240125 16:12:39.671347   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=6535
W20240125 16:12:40.134042 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=118, pq.top=118
W20240125 16:12:40.204985   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:12:40.676872   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=4620
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.991 ms                  | 45.907 ms                 |
| Forward                   | 6.383 ms                  | 39.248 ms                 |
| Backward                  | 6.293 ms                  | 57.389 ms                 |
| Optimize                  | 2.537 ms                  | 14.604 ms                 |
| BarrierTimeBeforeRank0    | 75.930 us                 | 28.436 ms                 |
| AfterBackward             | 23.122 ms                 | 61.014 ms                 |
| BlockToStepN              | 22.212 ms                 | 92.751 ms                 |
| OneStep                   | 83.808 ms                 | 200.017 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:12:41.156430 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=129, pq.top=129
W20240125 16:12:41.252844   529 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.031 ms                  | 28.425 ms                 |
| ProcessBack:UpdateCache   | 691.786 us                | 24.595 ms                 |
| ProcessBack:UpsertPq      | 5.367 ms                  | 48.204 ms                 |
| ProcessOneStep            | 23.051 ms                 | 60.943 ms                 |
| BlockToStepN              | 20.974 ms                 | 92.495 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:12:41.676025   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=71
W20240125 16:12:42.191576 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240125 16:12:42.276851   529 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240125 16:12:42.676043   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=444
W20240125 16:12:43.197832 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=152, pq.top=152
W20240125 16:12:43.289656   528 HazptrDomain.h:767] 10 request backlog for hazptr asynchronous reclamation executor
W20240125 16:12:43.386466   529 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240125 16:12:43.676103   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=343
W20240125 16:12:44.248447 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=164, pq.top=164
W20240125 16:12:44.430271   529 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240125 16:12:44.676018   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=5433
W20240125 16:12:45.342742 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=177, pq.top=177
W20240125 16:12:45.450548   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:12:45.684863   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=5843
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.963 ms                  | 45.813 ms                 |
| Forward                   | 6.331 ms                  | 39.248 ms                 |
| Backward                  | 6.573 ms                  | 31.956 ms                 |
| Optimize                  | 2.524 ms                  | 14.604 ms                 |
| BarrierTimeBeforeRank0    | 69.935 us                 | 26.761 ms                 |
| AfterBackward             | 22.986 ms                 | 56.403 ms                 |
| BlockToStepN              | 22.244 ms                 | 82.907 ms                 |
| OneStep                   | 84.536 ms                 | 200.012 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 991.506 us                | 28.565 ms                 |
| ProcessBack:UpdateCache   | 695.317 us                | 20.764 ms                 |
| ProcessBack:UpsertPq      | 5.362 ms                  | 45.389 ms                 |
| ProcessOneStep            | 22.902 ms                 | 56.661 ms                 |
| BlockToStepN              | 22.137 ms                 | 82.675 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:12:46.382840 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=189, pq.top=189
W20240125 16:12:46.534364   529 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:12:46.684015   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=9675
W20240125 16:12:47.481271 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=200, pq.top=200
[proc 1] 200 steps, total: 9.022, sample: 0.542, forward: 0.730, backward: 0.955, update: 0.229
[proc 0] 200 steps, total: 9.022, sample: 0.596, forward: 0.864, backward: 0.999, update: 0.253
W20240125 16:12:47.614215   529 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240125 16:12:47.686021   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=4654
W20240125 16:12:48.481729 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=213, pq.top=213
W20240125 16:12:48.645613   529 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:12:48.696705 65270 parallel_pq_v2.h:76] insert failed, size(hashtable)=11
W20240125 16:12:49.547847 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=224, pq.top=224
E20240125 16:12:49.696022   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=3885
W20240125 16:12:49.704929   529 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240125 16:12:50.582209 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=235, pq.top=235
E20240125 16:12:50.697551   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=4506
W20240125 16:12:50.704051   529 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.960 ms                  | 45.907 ms                 |
| Forward                   | 6.293 ms                  | 45.442 ms                 |
| Backward                  | 6.970 ms                  | 35.964 ms                 |
| Optimize                  | 2.531 ms                  | 14.604 ms                 |
| BarrierTimeBeforeRank0    | 66.101 us                 | 28.436 ms                 |
| AfterBackward             | 23.122 ms                 | 61.014 ms                 |
| BlockToStepN              | 22.244 ms                 | 82.907 ms                 |
| OneStep                   | 84.707 ms                 | 200.012 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.011 ms                  | 28.565 ms                 |
| ProcessBack:UpdateCache   | 704.536 us                | 17.943 ms                 |
| ProcessBack:UpsertPq      | 5.621 ms                  | 42.215 ms                 |
| ProcessOneStep            | 23.165 ms                 | 60.943 ms                 |
| BlockToStepN              | 22.137 ms                 | 82.675 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:12:51.588358 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=245, pq.top=245
E20240125 16:12:51.697028   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=9388
W20240125 16:12:51.715770   529 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240125 16:12:52.595404 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=257, pq.top=256
E20240125 16:12:52.697018   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=8321
W20240125 16:12:52.738250   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240125 16:12:53.609787 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=267, pq.top=267
E20240125 16:12:53.700845   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=10706
W20240125 16:12:53.786357   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240125 16:12:54.678418 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=277, pq.top=277
E20240125 16:12:54.702834   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=9382
W20240125 16:12:54.852226   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:12:55.702020 65270 parallel_pq_v2.h:76] insert failed, size(hashtable)=2071
W20240125 16:12:55.706099 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=289, pq.top=288
W20240125 16:12:55.906812   529 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.956 ms                  | 45.813 ms                 |
| Forward                   | 6.239 ms                  | 45.442 ms                 |
| Backward                  | 6.635 ms                  | 35.964 ms                 |
| Optimize                  | 2.515 ms                  | 14.080 ms                 |
| BarrierTimeBeforeRank0    | 64.207 us                 | 26.761 ms                 |
| AfterBackward             | 23.245 ms                 | 56.861 ms                 |
| BlockToStepN              | 22.611 ms                 | 74.102 ms                 |
| OneStep                   | 86.798 ms                 | 175.339 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.011 ms                  | 28.425 ms                 |
| ProcessBack:UpdateCache   | 697.922 us                | 17.061 ms                 |
| ProcessBack:UpsertPq      | 5.646 ms                  | 44.626 ms                 |
| ProcessOneStep            | 23.141 ms                 | 56.721 ms                 |
| BlockToStepN              | 22.930 ms                 | 73.866 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:12:56.711617   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=10345
[proc 1] 300 steps, total: 9.218, sample: 0.468, forward: 0.703, backward: 0.871, update: 0.227
[proc 0] 300 steps, total: 9.210, sample: 0.531, forward: 0.805, backward: 0.961, update: 0.243
W20240125 16:12:56.768296 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=301, pq.top=301
W20240125 16:12:56.911034   529 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240125 16:12:57.711012   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=9046
W20240125 16:12:57.808467 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=312, pq.top=312
W20240125 16:12:57.938477   529 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240125 16:12:58.711026   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=8596
W20240125 16:12:58.847151 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=325, pq.top=325
W20240125 16:12:59.015883   529 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240125 16:12:59.711027   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=4413
W20240125 16:12:59.873756 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=336, pq.top=336
W20240125 16:13:00.058959   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:13:00.711014   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=4017
W20240125 16:13:00.921888 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=348, pq.top=348
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.956 ms                  | 45.813 ms                 |
| Forward                   | 6.212 ms                  | 45.442 ms                 |
| Backward                  | 6.573 ms                  | 35.964 ms                 |
| Optimize                  | 2.506 ms                  | 14.080 ms                 |
| BarrierTimeBeforeRank0    | 63.822 us                 | 28.436 ms                 |
| AfterBackward             | 22.498 ms                 | 56.861 ms                 |
| BlockToStepN              | 23.468 ms                 | 82.907 ms                 |
| OneStep                   | 85.770 ms                 | 200.012 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:13:01.123713   529 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.000 ms                  | 27.386 ms                 |
| ProcessBack:UpdateCache   | 699.219 us                | 17.061 ms                 |
| ProcessBack:UpsertPq      | 5.620 ms                  | 42.215 ms                 |
| ProcessOneStep            | 22.433 ms                 | 56.661 ms                 |
| BlockToStepN              | 23.420 ms                 | 80.331 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:13:01.716846   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=8879
W20240125 16:13:02.110810 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=360, pq.top=360
W20240125 16:13:02.146366   529 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:13:02.716017   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=11019
W20240125 16:13:03.147565 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=371, pq.top=371
W20240125 16:13:03.182343   529 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240125 16:13:03.724860   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=10241
W20240125 16:13:04.174437 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=383, pq.top=383
W20240125 16:13:04.212348   529 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240125 16:13:04.724858   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=8465
W20240125 16:13:05.248948 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=394, pq.top=394
W20240125 16:13:05.285005   529 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:13:05.724020   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=267
[proc 1] 400 steps, total: 9.185, sample: 0.476, forward: 0.621, backward: 0.908, update: 0.221
[proc 0] 400 steps, total: 9.185, sample: 0.589, forward: 0.770, backward: 0.822, update: 0.234
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.952 ms                  | 45.813 ms                 |
| Forward                   | 6.232 ms                  | 39.892 ms                 |
| Backward                  | 6.601 ms                  | 31.956 ms                 |
| Optimize                  | 2.513 ms                  | 13.897 ms                 |
| BarrierTimeBeforeRank0    | 63.489 us                 | 28.727 ms                 |
| AfterBackward             | 22.774 ms                 | 56.861 ms                 |
| BlockToStepN              | 24.329 ms                 | 81.107 ms                 |
| OneStep                   | 86.798 ms                 | 175.339 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:13:06.285518   529 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.013 ms                  | 25.609 ms                 |
| ProcessBack:UpdateCache   | 702.147 us                | 17.061 ms                 |
| ProcessBack:UpsertPq      | 5.764 ms                  | 42.215 ms                 |
| ProcessOneStep            | 22.710 ms                 | 56.721 ms                 |
| BlockToStepN              | 23.927 ms                 | 80.896 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:13:06.461885 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=407, pq.top=407
E20240125 16:13:06.734125   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=7763
W20240125 16:13:07.314855   529 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:13:07.528978 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=418, pq.top=418
E20240125 16:13:07.738238   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=7233
W20240125 16:13:08.339797   529 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:13:08.653192 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=430, pq.top=430
E20240125 16:13:08.738018   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=9077
W20240125 16:13:09.365228   529 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240125 16:13:09.656407 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=440, pq.top=440
E20240125 16:13:09.738035 65270 parallel_pq_v2.h:76] insert failed, size(hashtable)=779
W20240125 16:13:10.368858   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:13:10.752898 65449 parallel_pq_v2.h:76] insert failed, size(hashtable)=152
W20240125 16:13:10.770004 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=453, pq.top=453
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.970 ms                  | 39.119 ms                 |
| Forward                   | 6.232 ms                  | 39.248 ms                 |
| Backward                  | 6.794 ms                  | 31.956 ms                 |
| Optimize                  | 2.511 ms                  | 13.897 ms                 |
| BarrierTimeBeforeRank0    | 63.671 us                 | 29.213 ms                 |
| AfterBackward             | 22.879 ms                 | 61.014 ms                 |
| BlockToStepN              | 24.329 ms                 | 80.563 ms                 |
| OneStep                   | 86.374 ms                 | 175.339 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.012 ms                  | 25.609 ms                 |
| ProcessBack:UpdateCache   | 698.542 us                | 17.061 ms                 |
| ProcessBack:UpsertPq      | 5.771 ms                  | 42.215 ms                 |
| ProcessOneStep            | 22.753 ms                 | 60.943 ms                 |
| BlockToStepN              | 24.667 ms                 | 80.331 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:13:11.393123   529 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:13:11.744859   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=9463
W20240125 16:13:11.798501 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=462, pq.top=462
W20240125 16:13:12.454504   529 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240125 16:13:12.744014   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=179
W20240125 16:13:12.833629 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=473, pq.top=472
W20240125 16:13:13.460304   529 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240125 16:13:13.751044   529 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240125 16:13:13.836161 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=483, pq.top=483
W20240125 16:13:14.522845   529 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:13:14.751039   528 parallel_pq_v2.h:76] insert failed, size(hashtable)=10260
W20240125 16:13:14.851821 65270 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=494, pq.top=494
[proc 1] 500 steps, total: 9.427, sample: 0.562, forward: 0.812, backward: 0.908, update: 0.236
[proc 0] 500 steps, total: 9.427, sample: 0.573, forward: 0.773, backward: 0.891, update: 0.249
Successfully xmh. training takes 48.602575063705444 seconds
before call kg_cache_controller.StopThreads()
W20240125 16:13:15.330107 65270 grad_async_v2.h:71] call StopThreads. PID = 64220
W20240125 16:13:15.330502 65270 grad_base.h:210] before processOneStepNegThread_.join();
W20240125 16:13:15.331648 65270 grad_base.h:212] after processOneStepNegThread_.join();
W20240125 16:13:15.331848 65270 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240125 16:13:15.361963 65270 grad_async_v2.h:91] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f2d0c8aff90>
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.975 ms                  | 45.813 ms                 |
| Forward                   | 6.235 ms                  | 39.248 ms                 |
| Backward                  | 6.740 ms                  | 31.956 ms                 |
| Optimize                  | 2.511 ms                  | 13.897 ms                 |
| BarrierTimeBeforeRank0    | 63.767 us                 | 30.448 ms                 |
| AfterBackward             | 22.701 ms                 | 62.033 ms                 |
| BlockToStepN              | 25.137 ms                 | 80.563 ms                 |
| OneStep                   | 87.182 ms                 | 175.339 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.015 ms                  | 25.318 ms                 |
| ProcessBack:UpdateCache   | 698.259 us                | 17.061 ms                 |
| ProcessBack:UpsertPq      | 5.771 ms                  | 42.952 ms                 |
| ProcessOneStep            | 22.503 ms                 | 61.957 ms                 |
| BlockToStepN              | 24.877 ms                 | 80.331 ms                 |
+---------------------------+---------------------------+---------------------------+

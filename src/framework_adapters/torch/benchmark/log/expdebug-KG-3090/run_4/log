WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240125 16:18:04.852910 19645 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_104', no_save_emb=True, max_step=500, batch_size=800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [19645 sampler.py:454] Start PreSampling
WARNING [19645 sampler.py:532] Before construct renumbering_dict
WARNING [19645 sampler.py:555] PreSampling done
W20240125 16:18:17.707764 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240125 16:18:17.709036 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240125 16:18:17.709575 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240125 16:18:17.710029 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240125 16:18:17.710449 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240125 16:18:17.710867 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240125 16:18:17.711279 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240125 16:18:17.711699 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240125 16:18:17.712119 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240125 16:18:17.712543 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240125 16:18:17.713003 19645 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240125 16:18:17.713436 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240125 16:18:17.713846 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240125 16:18:17.714463 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240125 16:18:17.714893 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240125 16:18:17.715323 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240125 16:18:17.715761 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240125 16:18:17.716198 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240125 16:18:17.716609 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240125 16:18:17.717032 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240125 16:18:17.717449 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240125 16:18:17.717873 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240125 16:18:17.718297 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240125 16:18:17.718724 19645 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240125 16:18:17.719134 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240125 16:18:17.719532 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240125 16:18:17.720072 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240125 16:18:17.720577 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240125 16:18:17.721026 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240125 16:18:17.721277 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240125 16:18:17.721333 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240125 16:18:17.721371 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240125 16:18:17.721408 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240125 16:18:17.721446 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240125 16:18:17.721482 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240125 16:18:17.721513 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240125 16:18:17.721554 19645 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240125 16:18:17.721581 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240125 16:18:17.721612 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240125 16:18:17.721760 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240125 16:18:17.721814 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240125 16:18:17.721850 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240125 16:18:17.721889 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240125 16:18:17.721922 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240125 16:18:17.721968 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240125 16:18:17.721997 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240125 16:18:17.722031 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240125 16:18:17.722066 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240125 16:18:17.722105 19645 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240125 16:18:17.722138 19645 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240125 16:18:17.722163 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240125 16:18:17.722193 19645 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240125 16:18:18.201684 19645 IPCTensor.h:365] NewIPCTensor: full_emb [14951, 400]0x100001ee2000 22.81 MB
W20240125 16:18:18.201913 19645 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000035b4000 58.4 kB
{0: Graph(num_nodes=9703, num_edges=161860,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11374, num_edges=168961,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=10715, num_edges=190828,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=11184, num_edges=240046,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9703 N 161860 E
MertisPartition: part 1 has 11374 N 168961 E
MertisPartition: part 2 has 10715 N 190828 E
MertisPartition: part 3 has 11184 N 240046 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([   6,   10,   11,  ..., 5824, 6189, 2559]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 1001,  1061,  1076,  ..., 12005,  2488, 12083]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 13.520 seconds
[Rank1] pid = 20841
[Rank2] pid = 20912
INFO [19645 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [20841 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [20912 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [20946 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [19645 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [20841 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [20912 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [20946 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240125 16:18:20.567880 20979 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240125 16:18:20.569110 20842 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240125 16:18:20.569113 20915 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240125 16:18:20.569078 21042 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240125 16:18:20.610188 20979 IPCTensor.h:365] NewIPCTensor: input_keys_0 [100000]0x1000035cc000 781.2 kB
W20240125 16:18:20.610462 20979 IPCTensor.h:365] NewIPCTensor: input_keys_neg_0 [100000]0x100003691000 781.2 kB
W20240125 16:18:20.610496 21042 IPCTensor.h:365] NewIPCTensor: input_keys_3 [100000]0x10000381b000 781.2 kB
W20240125 16:18:20.610492 20842 IPCTensor.h:365] NewIPCTensor: input_keys_1 [100000]0x100003756000 781.2 kB
W20240125 16:18:20.610502 20915 IPCTensor.h:365] NewIPCTensor: input_keys_2 [100000]0x1000038e0000 781.2 kB
W20240125 16:18:20.610553 20979 IPCTensor.h:365] NewIPCTensor: backward_grads_0 [100000, 400]0x1000039a5000 152.6 MB
W20240125 16:18:20.610623 20979 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x10000d23d000 152.6 MB
W20240125 16:18:20.610663 20979 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240125 16:18:20.610694 20915 IPCTensor.h:365] NewIPCTensor: input_keys_neg_2 [100000]0x100016ad5000 781.2 kB
W20240125 16:18:20.610700 20842 IPCTensor.h:365] NewIPCTensor: input_keys_neg_1 [100000]0x100016b9a000 781.2 kB
W20240125 16:18:20.610720 21042 IPCTensor.h:365] NewIPCTensor: input_keys_neg_3 [100000]0x100016c5f000 781.2 kB
W20240125 16:18:20.610780 20842 IPCTensor.h:365] NewIPCTensor: backward_grads_1 [100000, 400]0x100016d24000 152.6 MB
W20240125 16:18:20.610785 20915 IPCTensor.h:365] NewIPCTensor: backward_grads_2 [100000, 400]0x1000205bc000 152.6 MB
W20240125 16:18:20.610802 21042 IPCTensor.h:365] NewIPCTensor: backward_grads_3 [100000, 400]0x100029e54000 152.6 MB
W20240125 16:18:20.610836 20842 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x1000336ec000 152.6 MB
W20240125 16:18:20.610852 21042 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x10003cf84000 152.6 MB
W20240125 16:18:20.610860 20915 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x10004681c000 152.6 MB
W20240125 16:18:20.610898 21042 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240125 16:18:20.610903 20915 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240125 16:18:20.610908 20842 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240125 16:18:20.613005 20842 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240125 16:18:20.613013 21042 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240125 16:18:20.613004 20979 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240125 16:18:20.613004 20915 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
cudaHostRegister 0x100001ee2000
3: KnownLocalCachedEmbedding init done
WARNING [20946 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
1: KnownLocalCachedEmbedding init done
WARNING [20841 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
2: KnownLocalCachedEmbedding init done
WARNING [20912 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 20946
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100001ee2000
0: KnownLocalCachedEmbedding init done
WARNING [19645 DistTensor.py:56] The tensor name already exists in the kvstore
I20240125 16:18:20.859608 20979 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240125 16:18:20.859668 20915 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240125 16:18:20.859774 21042 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240125 16:18:20.859897 20842 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240125 16:18:20.860911 20979 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240125 16:18:20.861097 20979 grad_base.h:172] Init GradProcessingBase done
I20240125 16:18:20.866835 20979 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240125 16:18:20.867063 20979 kg_controller.h:78] after init GradAsyncProcessingV2
I20240125 16:18:20.867076 20979 kg_controller.h:84] Construct KGCacheController done
I20240125 16:18:21.537041 20979 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240125 16:18:22.248827 21427 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:18:22.257237 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240125 16:18:22.329216 20842 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240125 16:18:22.334244 20915 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240125 16:18:22.406520 20979 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240125 16:18:22.427932 21042 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.513 ms                  | 1.513 ms                  |
| Forward                   | 2.369 s                   | 2.369 s                   |
| Backward                  | 876.024 ms                | 876.024 ms                |
| Optimize                  | 4.571 ms                  | 4.571 ms                  |
| BarrierTimeBeforeRank0    | 133.209 us                | 133.209 us                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 574.244 ms                | 578.577 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:27.852200 21853 parallel_pq_v2.h:76] insert failed, size(hashtable)=11
W20240125 16:18:27.917711 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240125 16:18:27.984930 21427 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240125 16:18:28.852102 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=10334
W20240125 16:18:28.964479 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=10, pq.top=10
W20240125 16:18:29.011338 21427 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:18:29.860991 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=10197
W20240125 16:18:30.020006 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=19, pq.top=19
W20240125 16:18:30.024365 21427 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:18:30.860065 21854 parallel_pq_v2.h:76] insert failed, size(hashtable)=153
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.959 ms                  | 38.628 ms                 |
| Forward                   | 6.585 ms                  | 2.369 s                   |
| Backward                  | 6.088 ms                  | 876.024 ms                |
| Optimize                  | 2.403 ms                  | 22.731 ms                 |
| BarrierTimeBeforeRank0    | 1.839 ms                  | 28.081 ms                 |
| AfterBackward             | 45.033 ms                 | 2.232 s                   |
| BlockToStepN              | 19.253 ms                 | 43.227 ms                 |
| OneStep                   | 119.378 ms                | 5.535 s                   |
+---------------------------+---------------------------+---------------------------+
W20240125 16:18:31.019040 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=27, pq.top=27
W20240125 16:18:31.102342 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.893 ms                  | 574.244 ms                |
| ProcessBack:UpdateCache   | 2.775 ms                  | 1.547 s                   |
| ProcessBack:UpsertPq      | 18.972 ms                 | 82.589 ms                 |
| ProcessOneStep            | 44.544 ms                 | 2.231 s                   |
| BlockToStepN              | 19.582 ms                 | 60.606 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:31.868855 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9595
W20240125 16:18:32.039211 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=35, pq.top=34
W20240125 16:18:32.136893 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240125 16:18:32.869943 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8217
W20240125 16:18:32.933655 21426 HazptrDomain.h:767] 10 request backlog for hazptr asynchronous reclamation executor
W20240125 16:18:33.092600 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=44, pq.top=44
W20240125 16:18:33.142032 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:18:33.869221 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7693
W20240125 16:18:34.144884 21427 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:18:34.196609 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=54, pq.top=54
E20240125 16:18:34.876858 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7355
W20240125 16:18:35.236487 21427 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240125 16:18:35.314262 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=62, pq.top=62
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.810 ms                  | 38.628 ms                 |
| Forward                   | 6.394 ms                  | 32.707 ms                 |
| Backward                  | 7.993 ms                  | 21.281 ms                 |
| Optimize                  | 2.423 ms                  | 19.027 ms                 |
| BarrierTimeBeforeRank0    | 3.262 ms                  | 34.724 ms                 |
| AfterBackward             | 37.386 ms                 | 88.863 ms                 |
| BlockToStepN              | 28.824 ms                 | 68.572 ms                 |
| OneStep                   | 120.935 ms                | 181.408 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:35.880733 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=12
W20240125 16:18:36.250445 21427 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240125 16:18:36.329676 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=70, pq.top=70
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.720 ms                  | 574.244 ms                |
| ProcessBack:UpdateCache   | 2.591 ms                  | 1.547 s                   |
| ProcessBack:UpsertPq      | 17.912 ms                 | 82.589 ms                 |
| ProcessOneStep            | 37.308 ms                 | 88.748 ms                 |
| BlockToStepN              | 29.697 ms                 | 68.357 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:36.884866 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=6934
W20240125 16:18:37.296748 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240125 16:18:37.409750 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=78, pq.top=78
E20240125 16:18:37.895520 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=66
W20240125 16:18:38.312215 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:18:38.718978 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=88, pq.top=88
E20240125 16:18:38.895017 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=5851
W20240125 16:18:39.368901 21427 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:18:39.787917 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=97, pq.top=97
E20240125 16:18:39.899876 21855 parallel_pq_v2.h:76] insert failed, size(hashtable)=1149
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 17.805, sample: 0.602, forward: 2.803, backward: 1.683, update: 0.270
train_sampler.Prefill()
-------Step 0-------
tensor([ 3102,  4217, 13643,  2758,   184, 11373,  4831,     6,    12,  9131]) tensor([ 1076,  5240,  4270, 13790,  1745,  5639,  2116, 12770,  8640,  7237])
-------Step 1-------
tensor([ 3102,  4217, 13643,  2758,   184, 11373,  4831,     6,    12,  9131]) tensor([ 3339,  8012,  2578,  5654, 11186, 13644,  1638,  7540,  2634,  2663])
-------Step 2-------
tensor([ 1403, 14567, 10589, 11276,  4451,    19,  2926,  1166,  5107,  6975]) tensor([11975, 11593,  9706,  2794,  4397,  2185,  8155,  4289,   494, 11726])
-------Step 3-------
tensor([ 1403, 14567, 10589, 11276,  4451,    19,  2926,  1166,  5107,  6975]) tensor([13082,  5002, 14654, 14764, 14109,  4741, 12356, 12342,  3578,  1551])
-------Step 4-------
tensor([ 8335,    14, 14905, 11468,  7033,  2004,  4173,  3975, 11063,  4979]) tensor([11534,  4946, 13698, 14298,  9358,  6173,  7676,  9625,  1075,  1600])
-------Step 5-------
tensor([ 8335,    14, 14905, 11468,  7033,  2004,  4173,  3975, 11063,  4979]) tensor([ 1558, 12296, 12602,   453,  3334,  7042,  4193, 13437, 12737,  6493])
-------Step 6-------
tensor([13601,  4183,  8982,  1446,  3220,  6203,  4685, 14203,    20, 14793]) tensor([  665,  2840,  6107, 12493,  3094,   147, 10652, 10981, 14814,  4151])
-------Step 7-------
tensor([13601,  4183,  8982,  1446,  3220,  6203,  4685, 14203,    20, 14793]) tensor([ 6408,  4381, 11860,  8878,  8396, 14607, 10423,  5077, 14930,   704])
-------Step 8-------
tensor([ 8385,  9545,  6376,  9908,   191, 11003,  8123,  3776,  3057,   162]) tensor([ 7212, 13865, 12765,  2184, 11397,   340,  6585, 13295,  7519, 11254])
-------Step 9-------
tensor([ 8385,  9545,  6376,  9908,   191, 11003,  8123,  3776,  3057,   162]) tensor([ 2064,  4312, 12899, 12107,   347, 14821,  9965,  8415,  5906, 12664])
before start barrier
start train
[proc 0] 100 steps, total: 17.827, sample: 0.538, forward: 3.186, backward: 1.761, update: 0.291
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 17.900, sample: 0.479, forward: 2.830, backward: 1.556, update: 0.228
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 17.912, sample: 0.447, forward: 2.721, backward: 1.306, update: 0.233
W20240125 16:18:40.374366 21427 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240125 16:18:40.872288 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=105, pq.top=105
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.810 ms                  | 42.950 ms                 |
| Forward                   | 6.303 ms                  | 32.707 ms                 |
| Backward                  | 7.993 ms                  | 28.757 ms                 |
| Optimize                  | 2.421 ms                  | 19.027 ms                 |
| BarrierTimeBeforeRank0    | 10.980 ms                 | 47.308 ms                 |
| AfterBackward             | 38.542 ms                 | 88.863 ms                 |
| BlockToStepN              | 30.183 ms                 | 68.572 ms                 |
| OneStep                   | 122.142 ms                | 187.437 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:40.908851 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=10061
W20240125 16:18:41.381327 21427 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.671 ms                  | 31.074 ms                 |
| ProcessBack:UpdateCache   | 2.521 ms                  | 27.291 ms                 |
| ProcessBack:UpsertPq      | 17.356 ms                 | 76.888 ms                 |
| ProcessOneStep            | 37.308 ms                 | 88.748 ms                 |
| BlockToStepN              | 30.408 ms                 | 68.357 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:41.909752 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=248
W20240125 16:18:41.913838 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=114, pq.top=114
W20240125 16:18:42.386672 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240125 16:18:42.909015 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=21
W20240125 16:18:42.974167 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=122, pq.top=122
W20240125 16:18:43.395903 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240125 16:18:43.912400 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8567
W20240125 16:18:44.062394 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=131, pq.top=131
W20240125 16:18:44.396241 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:18:44.912014 20979 parallel_pq_v2.h:76] insert failed, size(hashtable)=1344
W20240125 16:18:45.166294 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=141, pq.top=141
W20240125 16:18:45.439707 21427 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.770 ms                  | 42.950 ms                 |
| Forward                   | 6.165 ms                  | 32.707 ms                 |
| Backward                  | 7.330 ms                  | 34.006 ms                 |
| Optimize                  | 2.415 ms                  | 19.027 ms                 |
| BarrierTimeBeforeRank0    | 8.980 ms                  | 49.377 ms                 |
| AfterBackward             | 39.149 ms                 | 88.863 ms                 |
| BlockToStepN              | 29.739 ms                 | 68.572 ms                 |
| OneStep                   | 121.733 ms                | 187.437 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:45.912017 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=6184
W20240125 16:18:46.279759 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=150, pq.top=150
W20240125 16:18:46.503626 21427 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.669 ms                  | 32.670 ms                 |
| ProcessBack:UpdateCache   | 2.514 ms                  | 24.600 ms                 |
| ProcessBack:UpsertPq      | 17.489 ms                 | 61.723 ms                 |
| ProcessOneStep            | 38.903 ms                 | 81.873 ms                 |
| BlockToStepN              | 29.937 ms                 | 67.197 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:46.912016 20979 parallel_pq_v2.h:76] insert failed, size(hashtable)=652
W20240125 16:18:47.347820 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=159, pq.top=159
W20240125 16:18:47.506806 21427 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:18:47.912041 20979 parallel_pq_v2.h:76] insert failed, size(hashtable)=569
W20240125 16:18:48.347404 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=167, pq.top=167
W20240125 16:18:48.537415 21427 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:18:48.912009 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7591
W20240125 16:18:49.419428 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=176, pq.top=176
W20240125 16:18:49.596578 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240125 16:18:49.912829 21853 parallel_pq_v2.h:76] insert failed, size(hashtable)=504
W20240125 16:18:50.499117 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=184, pq.top=184
W20240125 16:18:50.671321 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.750 ms                  | 40.298 ms                 |
| Forward                   | 6.094 ms                  | 32.707 ms                 |
| Backward                  | 7.234 ms                  | 28.757 ms                 |
| Optimize                  | 2.417 ms                  | 16.493 ms                 |
| BarrierTimeBeforeRank0    | 8.957 ms                  | 47.308 ms                 |
| AfterBackward             | 39.149 ms                 | 82.057 ms                 |
| BlockToStepN              | 30.727 ms                 | 67.448 ms                 |
| OneStep                   | 121.733 ms                | 187.437 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:18:50.912015 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9897
W20240125 16:18:51.505080 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=192, pq.top=192
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.666 ms                  | 31.074 ms                 |
| ProcessBack:UpdateCache   | 2.492 ms                  | 24.196 ms                 |
| ProcessBack:UpsertPq      | 17.525 ms                 | 58.290 ms                 |
| ProcessOneStep            | 38.903 ms                 | 81.873 ms                 |
| BlockToStepN              | 30.973 ms                 | 67.197 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:18:51.730413 21427 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240125 16:18:51.920840 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=4013
W20240125 16:18:52.608669 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=200, pq.top=200
[proc 1] 200 steps, total: 12.408, sample: 0.621, forward: 0.695, backward: 1.070, update: 0.235
[proc 0] 200 steps, total: 12.416, sample: 0.569, forward: 0.726, backward: 0.933, update: 0.239
[proc 3] 200 steps, total: 12.416, sample: 0.488, forward: 0.740, backward: 0.929, update: 0.244
[proc 2] 200 steps, total: 12.416, sample: 0.567, forward: 0.730, backward: 0.911, update: 0.227
W20240125 16:18:52.773710 21427 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240125 16:18:52.929090 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=7
W20240125 16:18:53.608646 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=207, pq.top=207
W20240125 16:18:53.788869 21427 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:18:53.929013 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9142
W20240125 16:18:54.647250 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=215, pq.top=215
W20240125 16:18:54.807466 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240125 16:18:54.929015 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7535
W20240125 16:18:55.694797 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=223, pq.top=223
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.768 ms                  | 42.079 ms                 |
| Forward                   | 6.110 ms                  | 32.707 ms                 |
| Backward                  | 7.330 ms                  | 34.006 ms                 |
| Optimize                  | 2.421 ms                  | 16.493 ms                 |
| BarrierTimeBeforeRank0    | 7.560 ms                  | 47.308 ms                 |
| AfterBackward             | 38.571 ms                 | 88.863 ms                 |
| BlockToStepN              | 32.409 ms                 | 69.474 ms                 |
| OneStep                   | 123.065 ms                | 190.790 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:18:55.910969 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:18:55.929013 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9145
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.675 ms                  | 30.299 ms                 |
| ProcessBack:UpdateCache   | 2.495 ms                  | 27.291 ms                 |
| ProcessBack:UpsertPq      | 17.489 ms                 | 58.290 ms                 |
| ProcessOneStep            | 38.465 ms                 | 88.748 ms                 |
| BlockToStepN              | 32.186 ms                 | 69.254 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:18:56.734225 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=231, pq.top=231
E20240125 16:18:56.929013 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7816
W20240125 16:18:56.974411 21427 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240125 16:18:57.803717 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=238, pq.top=238
E20240125 16:18:57.929029 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=147
W20240125 16:18:57.984889 21427 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240125 16:18:58.860605 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=247, pq.top=247
E20240125 16:18:58.932847 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9588
W20240125 16:18:58.991999 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240125 16:18:59.862859 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=256, pq.top=256
E20240125 16:18:59.932054 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=262
W20240125 16:19:00.081970 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240125 16:19:00.862998 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=263, pq.top=263
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.779 ms                  | 40.298 ms                 |
| Forward                   | 6.158 ms                  | 32.366 ms                 |
| Backward                  | 7.330 ms                  | 34.006 ms                 |
| Optimize                  | 2.427 ms                  | 12.838 ms                 |
| BarrierTimeBeforeRank0    | 6.774 ms                  | 40.662 ms                 |
| AfterBackward             | 37.962 ms                 | 88.863 ms                 |
| BlockToStepN              | 32.833 ms                 | 70.027 ms                 |
| OneStep                   | 122.623 ms                | 190.790 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:00.938902 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240125 16:19:01.115324 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.704 ms                  | 30.299 ms                 |
| ProcessBack:UpdateCache   | 2.504 ms                  | 27.998 ms                 |
| ProcessBack:UpsertPq      | 17.259 ms                 | 72.163 ms                 |
| ProcessOneStep            | 37.896 ms                 | 88.748 ms                 |
| BlockToStepN              | 32.629 ms                 | 69.811 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:19:01.932294 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=271, pq.top=270
E20240125 16:19:01.938093 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=213
W20240125 16:19:02.135607 21427 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240125 16:19:02.938107 21188 parallel_pq_v2.h:76] insert failed, size(hashtable)=1871
W20240125 16:19:02.972055 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=279, pq.top=279
W20240125 16:19:03.179069 21427 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:19:03.938024 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=10431
W20240125 16:19:04.040349 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=286, pq.top=286
W20240125 16:19:04.262385 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240125 16:19:04.940830 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=6415
W20240125 16:19:05.088356 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=294, pq.top=294
W20240125 16:19:05.281203 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.786 ms                  | 40.298 ms                 |
| Forward                   | 6.127 ms                  | 32.366 ms                 |
| Backward                  | 7.275 ms                  | 34.006 ms                 |
| Optimize                  | 2.429 ms                  | 12.838 ms                 |
| BarrierTimeBeforeRank0    | 7.340 ms                  | 40.662 ms                 |
| AfterBackward             | 37.844 ms                 | 89.802 ms                 |
| BlockToStepN              | 33.547 ms                 | 76.920 ms                 |
| OneStep                   | 123.765 ms                | 191.091 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:05.944865 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8227
[proc 3] 300 steps, total: 13.353, sample: 0.470, forward: 0.709, backward: 0.987, update: 0.221
[proc 0] 300 steps, total: 13.353, sample: 0.524, forward: 0.793, backward: 0.996, update: 0.245
[proc 2] 300 steps, total: 13.352, sample: 0.485, forward: 0.663, backward: 1.067, update: 0.236
[proc 1] 300 steps, total: 13.354, sample: 0.535, forward: 0.736, backward: 0.958, update: 0.233
W20240125 16:19:06.088475 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=301, pq.top=301
W20240125 16:19:06.291594 21427 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.717 ms                  | 29.668 ms                 |
| ProcessBack:UpdateCache   | 2.504 ms                  | 28.537 ms                 |
| ProcessBack:UpsertPq      | 17.095 ms                 | 70.130 ms                 |
| ProcessOneStep            | 37.579 ms                 | 89.737 ms                 |
| BlockToStepN              | 33.331 ms                 | 76.716 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:06.944012 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7779
W20240125 16:19:07.088907 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=308, pq.top=308
W20240125 16:19:07.344851 21427 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240125 16:19:07.952860 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=5701
W20240125 16:19:08.088605 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=315, pq.top=315
W20240125 16:19:08.452850 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240125 16:19:08.952014 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=11273
W20240125 16:19:09.173329 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=323, pq.top=323
W20240125 16:19:09.530580 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240125 16:19:09.952826 21854 parallel_pq_v2.h:76] insert failed, size(hashtable)=1627
W20240125 16:19:10.284708 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=330, pq.top=330
W20240125 16:19:10.531457 21427 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.780 ms                  | 42.079 ms                 |
| Forward                   | 6.150 ms                  | 32.366 ms                 |
| Backward                  | 7.424 ms                  | 34.006 ms                 |
| Optimize                  | 2.425 ms                  | 12.838 ms                 |
| BarrierTimeBeforeRank0    | 7.277 ms                  | 41.049 ms                 |
| AfterBackward             | 37.669 ms                 | 89.802 ms                 |
| BlockToStepN              | 34.254 ms                 | 92.114 ms                 |
| OneStep                   | 125.269 ms                | 199.597 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:10.952016 21855 parallel_pq_v2.h:76] insert failed, size(hashtable)=2204
W20240125 16:19:11.285159 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=337, pq.top=337
W20240125 16:19:11.538456 21427 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.719 ms                  | 29.668 ms                 |
| ProcessBack:UpdateCache   | 2.508 ms                  | 27.998 ms                 |
| ProcessBack:UpsertPq      | 17.028 ms                 | 61.723 ms                 |
| ProcessOneStep            | 37.438 ms                 | 89.737 ms                 |
| BlockToStepN              | 34.013 ms                 | 96.500 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:11.952260 21854 parallel_pq_v2.h:76] insert failed, size(hashtable)=1460
W20240125 16:19:12.341318 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=345, pq.top=345
W20240125 16:19:12.563920 21427 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240125 16:19:12.952850 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=10663
W20240125 16:19:13.415678 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=353, pq.top=353
W20240125 16:19:13.620977 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:19:13.968919 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=10158
W20240125 16:19:14.416302 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=359, pq.top=359
W20240125 16:19:14.622793 21427 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:19:14.968888 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7848
W20240125 16:19:15.437197 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=366, pq.top=366
W20240125 16:19:15.692350 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.785 ms                  | 40.298 ms                 |
| Forward                   | 6.127 ms                  | 32.346 ms                 |
| Backward                  | 7.331 ms                  | 33.843 ms                 |
| Optimize                  | 2.431 ms                  | 10.935 ms                 |
| BarrierTimeBeforeRank0    | 7.277 ms                  | 40.662 ms                 |
| AfterBackward             | 37.844 ms                 | 89.802 ms                 |
| BlockToStepN              | 35.217 ms                 | 96.694 ms                 |
| OneStep                   | 127.169 ms                | 210.139 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:15.968853 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9006
W20240125 16:19:16.541616 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=373, pq.top=373
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.719 ms                  | 31.074 ms                 |
| ProcessBack:UpdateCache   | 2.505 ms                  | 27.998 ms                 |
| ProcessBack:UpsertPq      | 16.936 ms                 | 70.130 ms                 |
| ProcessOneStep            | 37.723 ms                 | 102.781 ms                |
| BlockToStepN              | 35.170 ms                 | 96.500 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:19:16.792480 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240125 16:19:16.968874 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8877
W20240125 16:19:17.590890 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=380, pq.top=380
W20240125 16:19:17.876726 21427 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240125 16:19:17.968864 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=6836
W20240125 16:19:18.593295 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=387, pq.top=387
E20240125 16:19:18.968014 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=11260
W20240125 16:19:18.975706 21427 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240125 16:19:19.593770 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=393, pq.top=392
E20240125 16:19:19.968024 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=3945
W20240125 16:19:19.977542 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:19:20.635177 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=400, pq.top=400
[proc 0] 400 steps, total: 14.690, sample: 0.548, forward: 0.822, backward: 1.042, update: 0.246
[proc 1] 400 steps, total: 14.677, sample: 0.518, forward: 0.771, backward: 0.963, update: 0.229
[proc 3] 400 steps, total: 14.694, sample: 0.480, forward: 0.723, backward: 1.106, update: 0.263
[proc 2] 400 steps, total: 14.695, sample: 0.470, forward: 0.750, backward: 0.966, update: 0.234
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.786 ms                  | 42.950 ms                 |
| Forward                   | 6.112 ms                  | 32.346 ms                 |
| Backward                  | 7.377 ms                  | 33.843 ms                 |
| Optimize                  | 2.432 ms                  | 10.935 ms                 |
| BarrierTimeBeforeRank0    | 7.361 ms                  | 41.049 ms                 |
| AfterBackward             | 38.103 ms                 | 102.993 ms                |
| BlockToStepN              | 36.215 ms                 | 108.373 ms                |
| OneStep                   | 129.167 ms                | 214.844 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:20.968024 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7234
W20240125 16:19:20.996369 21427 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.720 ms                  | 31.074 ms                 |
| ProcessBack:UpdateCache   | 2.502 ms                  | 27.291 ms                 |
| ProcessBack:UpsertPq      | 17.213 ms                 | 61.723 ms                 |
| ProcessOneStep            | 38.055 ms                 | 102.781 ms                |
| BlockToStepN              | 35.977 ms                 | 108.164 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:19:21.653522 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=406, pq.top=406
E20240125 16:19:21.970024 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8776
W20240125 16:19:22.062310 21427 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240125 16:19:22.943307 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=413, pq.top=413
E20240125 16:19:22.972867 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8398
W20240125 16:19:23.142805 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240125 16:19:23.947253 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=420, pq.top=420
E20240125 16:19:23.976745 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8091
W20240125 16:19:24.159355 21427 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240125 16:19:24.976277 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=153
W20240125 16:19:25.044179 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=427, pq.top=427
W20240125 16:19:25.227335 21427 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.787 ms                  | 42.950 ms                 |
| Forward                   | 6.110 ms                  | 32.346 ms                 |
| Backward                  | 7.273 ms                  | 33.843 ms                 |
| Optimize                  | 2.438 ms                  | 10.935 ms                 |
| BarrierTimeBeforeRank0    | 7.802 ms                  | 49.377 ms                 |
| AfterBackward             | 38.901 ms                 | 104.029 ms                |
| BlockToStepN              | 37.007 ms                 | 108.373 ms                |
| OneStep                   | 130.911 ms                | 235.514 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:25.976025 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=5728
W20240125 16:19:26.081602 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=434, pq.top=434
W20240125 16:19:26.230553 21427 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.720 ms                  | 32.670 ms                 |
| ProcessBack:UpdateCache   | 2.502 ms                  | 27.998 ms                 |
| ProcessBack:UpsertPq      | 17.474 ms                 | 70.130 ms                 |
| ProcessOneStep            | 38.903 ms                 | 103.919 ms                |
| BlockToStepN              | 36.793 ms                 | 108.164 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:26.984876 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=7770
W20240125 16:19:27.087507 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=441, pq.top=441
W20240125 16:19:27.264849 21427 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240125 16:19:27.985158 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=8645
W20240125 16:19:28.102257 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=448, pq.top=447
W20240125 16:19:28.292759 21427 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
E20240125 16:19:28.985015 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=6394
W20240125 16:19:29.112824 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=456, pq.top=456
W20240125 16:19:29.308627 21427 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240125 16:19:29.987702 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=10575
W20240125 16:19:30.123710 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=462, pq.top=462
W20240125 16:19:30.395836 21427 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.787 ms                  | 42.950 ms                 |
| Forward                   | 6.106 ms                  | 32.346 ms                 |
| Backward                  | 7.263 ms                  | 31.873 ms                 |
| Optimize                  | 2.441 ms                  | 10.935 ms                 |
| BarrierTimeBeforeRank0    | 7.560 ms                  | 50.881 ms                 |
| AfterBackward             | 38.901 ms                 | 102.993 ms                |
| BlockToStepN              | 37.944 ms                 | 96.694 ms                 |
| OneStep                   | 131.348 ms                | 235.514 ms                |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:30.988838 21188 parallel_pq_v2.h:76] insert failed, size(hashtable)=518
W20240125 16:19:31.186105 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=469, pq.top=469
W20240125 16:19:31.416982 21427 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.755 ms                  | 32.670 ms                 |
| ProcessBack:UpdateCache   | 2.506 ms                  | 27.998 ms                 |
| ProcessBack:UpsertPq      | 17.474 ms                 | 70.130 ms                 |
| ProcessOneStep            | 38.903 ms                 | 102.781 ms                |
| BlockToStepN              | 37.741 ms                 | 96.500 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:19:31.988014 21427 parallel_pq_v2.h:76] insert failed, size(hashtable)=245
W20240125 16:19:32.313498 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=477, pq.top=477
W20240125 16:19:32.562242 21427 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240125 16:19:32.988022 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9084
W20240125 16:19:33.318066 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=484, pq.top=484
W20240125 16:19:33.618296 21427 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240125 16:19:33.992710 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=5427
W20240125 16:19:34.466802 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=492, pq.top=492
W20240125 16:19:34.694896 21427 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240125 16:19:34.995878 21426 parallel_pq_v2.h:76] insert failed, size(hashtable)=9153
W20240125 16:19:35.478422 20979 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=499, pq.top=499
[proc 2] 500 steps, total: 14.995, sample: 0.582, forward: 0.728, backward: 0.993, update: 0.229
[proc 0] 500 steps, total: 15.000, sample: 0.517, forward: 0.854, backward: 0.866, update: 0.251
Successfully xmh. training takes 73.28687405586243 seconds
before call kg_cache_controller.StopThreads()
W20240125 16:19:35.693322 20979 grad_async_v2.h:71] call StopThreads. PID = 19645
W20240125 16:19:35.693365 20979 grad_base.h:210] before processOneStepNegThread_.join();
[proc 3] 500 steps, total: 15.006, sample: 0.413, forward: 0.792, backward: 0.881, update: 0.248
[proc 1] 500 steps, total: 15.008, sample: 0.501, forward: 0.741, backward: 0.894, update: 0.242
W20240125 16:19:35.705267 20979 grad_base.h:212] after processOneStepNegThread_.join();
W20240125 16:19:35.705355 20979 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240125 16:19:35.712319 20979 grad_async_v2.h:91] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

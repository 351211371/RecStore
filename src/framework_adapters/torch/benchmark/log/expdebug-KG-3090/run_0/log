WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240125 16:10:32.648026 58861 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_100', no_save_emb=True, max_step=500, batch_size=400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [58861 sampler.py:454] Start PreSampling
WARNING [58861 sampler.py:532] Before construct renumbering_dict
WARNING [58861 sampler.py:555] PreSampling done
W20240125 16:10:42.147713 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240125 16:10:42.148608 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240125 16:10:42.149161 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240125 16:10:42.149641 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240125 16:10:42.150068 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240125 16:10:42.150492 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240125 16:10:42.150920 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240125 16:10:42.151340 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240125 16:10:42.151754 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240125 16:10:42.152189 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240125 16:10:42.152621 58861 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240125 16:10:42.153035 58861 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240125 16:10:42.153447 58861 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240125 16:10:42.154059 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240125 16:10:42.154469 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240125 16:10:42.154888 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240125 16:10:42.155303 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240125 16:10:42.155743 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240125 16:10:42.156163 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240125 16:10:42.156584 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240125 16:10:42.157001 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240125 16:10:42.157450 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240125 16:10:42.157856 58861 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240125 16:10:42.158253 58861 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240125 16:10:42.158659 58861 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240125 16:10:42.159056 58861 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240125 16:10:42.662818 58861 IPCTensor.h:365] NewIPCTensor: full_emb [14951, 400]0x100000f72000 22.81 MB
W20240125 16:10:42.663262 58861 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100002644000 58.4 kB
{0: Graph(num_nodes=13500, num_edges=273181,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12803, num_edges=385691,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13500 N 273181 E
MertisPartition: part 1 has 12803 N 385691 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  764,   850,   976,  ..., 12177, 11702, 11289]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13500, num_edges=273181,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13500, num_edges=273181,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 10.183 seconds
INFO [58861 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [59878 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [58861 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [59878 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240125 16:10:44.680330 59879 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240125 16:10:44.680651 59890 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240125 16:10:44.714407 59879 IPCTensor.h:365] NewIPCTensor: input_keys_0 [100000]0x100002658000 781.2 kB
W20240125 16:10:44.714416 59890 IPCTensor.h:365] NewIPCTensor: input_keys_1 [100000]0x10000271d000 781.2 kB
W20240125 16:10:44.714633 59879 IPCTensor.h:365] NewIPCTensor: input_keys_neg_0 [100000]0x1000028a7000 781.2 kB
W20240125 16:10:44.714632 59890 IPCTensor.h:365] NewIPCTensor: input_keys_neg_1 [100000]0x1000027e2000 781.2 kB
W20240125 16:10:44.714702 59879 IPCTensor.h:365] NewIPCTensor: backward_grads_0 [100000, 400]0x10000296c000 152.6 MB
W20240125 16:10:44.714725 59890 IPCTensor.h:365] NewIPCTensor: backward_grads_1 [100000, 400]0x10000c204000 152.6 MB
W20240125 16:10:44.714753 59879 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x100015a9c000 152.6 MB
W20240125 16:10:44.714788 59890 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x10001f334000 152.6 MB
W20240125 16:10:44.714802 59879 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240125 16:10:44.714836 59890 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240125 16:10:44.716017 59879 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240125 16:10:44.716039 59890 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
[Rank1] pid = 59878
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
cudaHostRegister 0x100000f72000
0: KnownLocalCachedEmbedding init done
WARNING [58861 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100000f72000
1: KnownLocalCachedEmbedding init done
WARNING [59878 DistTensor.py:56] The tensor name already exists in the kvstore
I20240125 16:10:44.935942 59890 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240125 16:10:44.935995 59879 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240125 16:10:44.937098 59879 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240125 16:10:44.937273 59879 grad_base.h:172] Init GradProcessingBase done
I20240125 16:10:44.942953 59879 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240125 16:10:44.943150 59879 kg_controller.h:78] after init GradAsyncProcessingV2
I20240125 16:10:44.943161 59879 kg_controller.h:84] Construct KGCacheController done
I20240125 16:10:45.285857 59879 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240125 16:10:45.531769 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:10:45.532191 60201 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240125 16:10:45.623576 59890 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240125 16:10:45.700500 59879 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
E20240125 16:10:48.495362 60363 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240125 16:10:48.625962 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240125 16:10:48.680627 60201 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240125 16:10:48.949294 59879 grad_async_v2.h:236] pq is empty
W20240125 16:10:49.045892 59879 grad_async_v2.h:236] pq is empty
E20240125 16:10:49.495820 60201 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240125 16:10:49.673375 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=13, pq.top=13
W20240125 16:10:49.683840 60201 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.947 ms                  | 29.284 ms                 |
| Forward                   | 9.365 ms                  | 1.706 s                   |
| Backward                  | 6.717 ms                  | 433.221 ms                |
| Optimize                  | 1.935 ms                  | 3.612 ms                  |
| BarrierTimeBeforeRank0    | 79.412 us                 | 9.873 ms                  |
| AfterBackward             | 25.203 ms                 | 779.215 ms                |
| BlockToStepN              | 3.040 ms                  | 39.815 ms                 |
| OneStep                   | 76.783 ms                 | 2.966 s                   |
+---------------------------+---------------------------+---------------------------+
W20240125 16:10:49.996930 59879 grad_async_v2.h:236] pq is empty
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 889.754 us                | 148.692 ms                |
| ProcessBack:UpdateCache   | 711.205 us                | 502.187 ms                |
| ProcessBack:UpsertPq      | 5.915 ms                  | 148.284 ms                |
| ProcessOneStep            | 22.545 ms                 | 778.553 ms                |
| BlockToStepN              | 2.826 ms                  | 41.281 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:10:50.495111 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=1030
W20240125 16:10:50.683435 60201 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240125 16:10:50.853983 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=30, pq.top=30
W20240125 16:10:51.076900 59879 grad_async_v2.h:236] pq is empty
E20240125 16:10:51.495012 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=1547
W20240125 16:10:51.685058 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240125 16:10:51.893672 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=44, pq.top=44
W20240125 16:10:52.001111 59879 grad_async_v2.h:236] pq is empty
W20240125 16:10:52.077128 59879 grad_async_v2.h:236] pq is empty
W20240125 16:10:52.373174 59879 grad_async_v2.h:236] pq is empty
E20240125 16:10:52.496846 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=1940
W20240125 16:10:52.729032 60201 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240125 16:10:52.909271 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=59, pq.top=59
E20240125 16:10:53.498791 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=4109
W20240125 16:10:53.808854 60201 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240125 16:10:53.928654 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=74, pq.top=74
E20240125 16:10:54.503688 60201 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240125 16:10:54.824896 60201 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.969 ms                  | 30.568 ms                 |
| Forward                   | 6.909 ms                  | 40.017 ms                 |
| Backward                  | 6.247 ms                  | 52.993 ms                 |
| Optimize                  | 1.881 ms                  | 3.612 ms                  |
| BarrierTimeBeforeRank0    | 69.852 us                 | 13.244 ms                 |
| AfterBackward             | 21.276 ms                 | 79.203 ms                 |
| BlockToStepN              | 6.618 ms                  | 39.815 ms                 |
| OneStep                   | 70.402 ms                 | 127.448 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:10:54.959808 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=88, pq.top=87
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 926.647 us                | 23.366 ms                 |
| ProcessBack:UpdateCache   | 728.971 us                | 29.585 ms                 |
| ProcessBack:UpsertPq      | 3.271 ms                  | 65.452 ms                 |
| ProcessOneStep            | 21.001 ms                 | 79.077 ms                 |
| BlockToStepN              | 7.795 ms                  | 38.940 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:10:55.504509 60062 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 10.210, sample: 0.348, forward: 1.886, backward: 1.186, update: 0.148
train_sampler.Prefill()
-------Step 0-------
tensor([14372, 14287,  3573, 13828,   343,  6206,  9255,   196,  4149, 12745]) tensor([ 1016, 13437,  4691,  4860, 12324,  8302, 11125, 13675,  5982, 13819])
-------Step 1-------
tensor([14372, 14287,  3573, 13828,   343,  6206,  9255,   196,  4149, 12745]) tensor([ 7217,  2870, 11261,  4656,  1150,  8451,  6143,  9615,  3247,  4587])
-------Step 2-------
tensor([ 7720, 13097,  7538, 11346,  9608, 11304,   358,  3310,  4963,  3935]) tensor([ 2140,  4565,  1954, 11223, 12255,  3117,  4801,  4510,  8871,  4296])
-------Step 3-------
tensor([ 7720, 13097,  7538, 11346,  9608, 11304,   358,  3310,  4963,  3935]) tensor([14644,  4371,   949, 12223,  9112,  8397, 12762,  4040, 14950,  2219])
-------Step 4-------
tensor([14093,   312,  7222, 13679, 11879, 10186,  3897,   365,   132, 14170]) tensor([ 9396, 13299,  1129, 11219,  8938,  4421, 10777, 13314,  1225,   108])
-------Step 5-------
tensor([14093,   312,  7222, 13679, 11879, 10186,  3897,   365,   132, 14170]) tensor([ 2637, 10541,  8060,  8307,   190,  7941,  2639, 13754, 11955, 12005])
-------Step 6-------
tensor([ 4816,    25,  9513,  6470, 12460,  6582,  2630, 10760,  3624,  5825]) tensor([ 5429,  7629, 14560,  3228,  8898,  2217,   603,  7371,  9111,  2609])
-------Step 7-------
tensor([ 4816,    25,  9513,  6470, 12460,  6582,  2630, 10760,  3624,  5825]) tensor([10961, 11319,     2,  1603,  6713,  8812,   902,  6047,  5795,  5288])
-------Step 8-------
tensor([ 4522, 13616,   277,    82,     0,  6412,  3224,  7491,  7874,   361]) tensor([14645,  9814,  6189,  8241,  3966,  5389, 10372, 13823,  6595,  4135])
-------Step 9-------
tensor([ 4522, 13616,   277,    82,     0,  6412,  3224,  7491,  7874,   361]) tensor([ 3717,  9610,  8400,  4266, 14526, 10061, 13883,  4838,  7092,  2488])
before start barrier
start train
[proc 0] 100 steps, total: 10.133, sample: 0.539, forward: 2.735, backward: 1.230, update: 0.177
W20240125 16:10:55.835100 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240125 16:10:55.960521 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=102, pq.top=102
E20240125 16:10:56.507839 60201 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240125 16:10:56.935770 60201 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240125 16:10:56.975803 60363 HazptrDomain.h:767] 10 request backlog for hazptr asynchronous reclamation executor
W20240125 16:10:56.981336 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=117, pq.top=117
E20240125 16:10:57.507025 60363 parallel_pq_v2.h:76] insert failed, size(hashtable)=134
W20240125 16:10:57.986284 60201 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240125 16:10:58.017555 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=132, pq.top=132
E20240125 16:10:58.517306 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=1597
W20240125 16:10:58.879823 59879 grad_async_v2.h:236] pq is empty
W20240125 16:10:59.004426 60201 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240125 16:10:59.028360 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=147, pq.top=146
E20240125 16:10:59.518512 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=803
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.843 ms                  | 30.568 ms                 |
| Forward                   | 6.249 ms                  | 34.946 ms                 |
| Backward                  | 6.247 ms                  | 27.516 ms                 |
| Optimize                  | 1.867 ms                  | 2.876 ms                  |
| BarrierTimeBeforeRank0    | 64.718 us                 | 16.054 ms                 |
| AfterBackward             | 19.399 ms                 | 69.516 ms                 |
| BlockToStepN              | 12.016 ms                 | 45.644 ms                 |
| OneStep                   | 69.271 ms                 | 119.092 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:11:00.007735 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240125 16:11:00.050529 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=161, pq.top=161
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 911.622 us                | 23.353 ms                 |
| ProcessBack:UpdateCache   | 716.844 us                | 18.280 ms                 |
| ProcessBack:UpsertPq      | 3.072 ms                  | 42.630 ms                 |
| ProcessOneStep            | 19.256 ms                 | 69.450 ms                 |
| BlockToStepN              | 11.034 ms                 | 45.438 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:11:00.518563 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=5638
W20240125 16:11:01.033560 60201 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240125 16:11:01.076154 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=175, pq.top=175
E20240125 16:11:01.520895 60201 parallel_pq_v2.h:76] insert failed, size(hashtable)=35
W20240125 16:11:02.055985 60201 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240125 16:11:02.180229 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=191, pq.top=191
E20240125 16:11:02.520043 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=10374
[proc 1] 200 steps, total: 7.059, sample: 0.334, forward: 0.637, backward: 0.713, update: 0.148
[proc 0] 200 steps, total: 7.060, sample: 0.415, forward: 0.838, backward: 0.874, update: 0.168
W20240125 16:11:03.084976 60201 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:11:03.184417 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=205, pq.top=205
E20240125 16:11:03.531383 60062 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240125 16:11:04.122392 60201 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240125 16:11:04.263176 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=221, pq.top=221
E20240125 16:11:04.532701 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=1519
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.780 ms                  | 30.568 ms                 |
| Forward                   | 6.096 ms                  | 49.114 ms                 |
| Backward                  | 6.282 ms                  | 27.516 ms                 |
| Optimize                  | 1.855 ms                  | 2.876 ms                  |
| BarrierTimeBeforeRank0    | 62.418 us                 | 16.054 ms                 |
| AfterBackward             | 18.760 ms                 | 69.516 ms                 |
| BlockToStepN              | 13.719 ms                 | 51.351 ms                 |
| OneStep                   | 68.164 ms                 | 119.250 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:11:05.162526 60201 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240125 16:11:05.263279 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=235, pq.top=235
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 907.794 us                | 21.220 ms                 |
| ProcessBack:UpdateCache   | 711.205 us                | 17.029 ms                 |
| ProcessBack:UpsertPq      | 2.988 ms                  | 40.928 ms                 |
| ProcessOneStep            | 18.718 ms                 | 69.450 ms                 |
| BlockToStepN              | 13.918 ms                 | 51.290 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:11:05.534366 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=7748
W20240125 16:11:06.170388 60201 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:11:06.265683 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=247, pq.top=247
E20240125 16:11:06.534119 59879 parallel_pq_v2.h:76] insert failed, size(hashtable)=33
W20240125 16:11:07.198348 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240125 16:11:07.278477 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=262, pq.top=262
E20240125 16:11:07.564909 60364 parallel_pq_v2.h:76] insert failed, size(hashtable)=562
W20240125 16:11:08.226326 60201 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:11:08.321877 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=275, pq.top=275
E20240125 16:11:08.540944 60364 parallel_pq_v2.h:76] insert failed, size(hashtable)=49
W20240125 16:11:09.228374 60201 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240125 16:11:09.355216 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=289, pq.top=289
E20240125 16:11:09.540855 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=3335
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.775 ms                  | 29.284 ms                 |
| Forward                   | 5.956 ms                  | 41.745 ms                 |
| Backward                  | 6.216 ms                  | 25.349 ms                 |
| Optimize                  | 1.846 ms                  | 3.612 ms                  |
| BarrierTimeBeforeRank0    | 59.586 us                 | 16.054 ms                 |
| AfterBackward             | 18.781 ms                 | 69.516 ms                 |
| BlockToStepN              | 15.691 ms                 | 53.647 ms                 |
| OneStep                   | 69.262 ms                 | 127.448 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 7.318, sample: 0.342, forward: 0.629, backward: 0.691, update: 0.152
[proc 0] 300 steps, total: 7.316, sample: 0.353, forward: 0.749, backward: 0.887, update: 0.177
W20240125 16:11:10.232270 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 901.479 us                | 21.220 ms                 |
| ProcessBack:UpdateCache   | 712.414 us                | 17.720 ms                 |
| ProcessBack:UpsertPq      | 2.892 ms                  | 41.221 ms                 |
| ProcessOneStep            | 18.696 ms                 | 69.450 ms                 |
| BlockToStepN              | 15.854 ms                 | 53.391 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:11:10.366664 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=303, pq.top=303
E20240125 16:11:10.540019 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=7876
W20240125 16:11:11.258236 60201 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:11:11.371819 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=315, pq.top=315
E20240125 16:11:11.541170 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=11493
W20240125 16:11:12.298556 60201 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240125 16:11:12.431275 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=328, pq.top=328
E20240125 16:11:12.548856 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=11411
W20240125 16:11:13.330035 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240125 16:11:13.434906 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=342, pq.top=342
E20240125 16:11:13.548242 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=12386
W20240125 16:11:14.381691 60201 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:11:14.435573 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=354, pq.top=354
E20240125 16:11:14.549162 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=10286
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.765 ms                  | 29.284 ms                 |
| Forward                   | 5.882 ms                  | 41.745 ms                 |
| Backward                  | 6.216 ms                  | 23.284 ms                 |
| Optimize                  | 1.841 ms                  | 2.876 ms                  |
| BarrierTimeBeforeRank0    | 60.034 us                 | 17.127 ms                 |
| AfterBackward             | 18.822 ms                 | 57.482 ms                 |
| BlockToStepN              | 16.729 ms                 | 57.789 ms                 |
| OneStep                   | 71.002 ms                 | 127.448 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 898.463 us                | 18.899 ms                 |
| ProcessBack:UpdateCache   | 709.891 us                | 17.612 ms                 |
| ProcessBack:UpsertPq      | 2.909 ms                  | 40.928 ms                 |
| ProcessOneStep            | 18.718 ms                 | 57.310 ms                 |
| BlockToStepN              | 16.523 ms                 | 59.076 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:11:15.385255 60201 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:11:15.500144 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=367, pq.top=367
E20240125 16:11:15.554062 59879 parallel_pq_v2.h:76] insert failed, size(hashtable)=124
W20240125 16:11:16.389134 60201 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240125 16:11:16.509403 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=378, pq.top=378
E20240125 16:11:16.558068 59879 parallel_pq_v2.h:76] insert failed, size(hashtable)=33
W20240125 16:11:17.392949 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:11:17.564172 59879 parallel_pq_v2.h:76] insert failed, size(hashtable)=2
W20240125 16:11:17.777417 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=395, pq.top=395
[proc 1] 400 steps, total: 7.965, sample: 0.362, forward: 0.652, backward: 0.778, update: 0.157
[proc 0] 400 steps, total: 7.965, sample: 0.381, forward: 0.744, backward: 0.778, update: 0.199
W20240125 16:11:18.420984 60201 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240125 16:11:18.576864 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=7990
W20240125 16:11:18.819350 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=408, pq.top=408
W20240125 16:11:19.455888 60201 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240125 16:11:19.576040 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=8523
W20240125 16:11:19.822471 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=420, pq.top=420
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.755 ms                  | 29.284 ms                 |
| Forward                   | 5.820 ms                  | 41.745 ms                 |
| Backward                  | 5.972 ms                  | 23.284 ms                 |
| Optimize                  | 1.831 ms                  | 3.803 ms                  |
| BarrierTimeBeforeRank0    | 59.379 us                 | 27.680 ms                 |
| AfterBackward             | 18.891 ms                 | 57.482 ms                 |
| BlockToStepN              | 17.799 ms                 | 62.207 ms                 |
| OneStep                   | 72.058 ms                 | 138.195 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 900.349 us                | 18.899 ms                 |
| ProcessBack:UpdateCache   | 704.847 us                | 17.101 ms                 |
| ProcessBack:UpsertPq      | 2.955 ms                  | 38.256 ms                 |
| ProcessOneStep            | 18.825 ms                 | 57.310 ms                 |
| BlockToStepN              | 17.593 ms                 | 61.918 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240125 16:11:20.534220 60201 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240125 16:11:20.576041 60201 parallel_pq_v2.h:76] insert failed, size(hashtable)=30
W20240125 16:11:20.875037 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=432, pq.top=432
W20240125 16:11:21.534328 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240125 16:11:21.577451 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=10750
W20240125 16:11:21.939339 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=445, pq.top=445
E20240125 16:11:22.580022 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=8628
W20240125 16:11:22.638274 60201 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240125 16:11:22.955632 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=457, pq.top=457
E20240125 16:11:23.580767 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=12904
W20240125 16:11:23.662200 60201 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240125 16:11:24.015677 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=471, pq.top=471
E20240125 16:11:24.582659 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=10395
W20240125 16:11:24.666451 60201 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.747 ms                  | 28.517 ms                 |
| Forward                   | 5.781 ms                  | 40.017 ms                 |
| Backward                  | 5.947 ms                  | 23.101 ms                 |
| Optimize                  | 1.825 ms                  | 3.803 ms                  |
| BarrierTimeBeforeRank0    | 58.216 us                 | 26.616 ms                 |
| AfterBackward             | 18.822 ms                 | 56.132 ms                 |
| BlockToStepN              | 18.802 ms                 | 62.152 ms                 |
| OneStep                   | 72.900 ms                 | 138.195 ms                |
+---------------------------+---------------------------+---------------------------+
W20240125 16:11:25.192297 59879 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=485, pq.top=485
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 900.093 us                | 18.329 ms                 |
| ProcessBack:UpdateCache   | 705.985 us                | 16.994 ms                 |
| ProcessBack:UpsertPq      | 2.959 ms                  | 37.667 ms                 |
| ProcessOneStep            | 18.759 ms                 | 56.066 ms                 |
| BlockToStepN              | 18.678 ms                 | 61.918 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240125 16:11:25.582036 60200 parallel_pq_v2.h:76] insert failed, size(hashtable)=9921
W20240125 16:11:25.708159 60201 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
[proc 1] 500 steps, total: 8.176, sample: 0.282, forward: 0.616, backward: 0.702, update: 0.169
[proc 0] 500 steps, total: 8.176, sample: 0.324, forward: 0.797, backward: 0.744, update: 0.175
Successfully xmh. training takes 40.652785539627075 seconds
before call kg_cache_controller.StopThreads()
W20240125 16:11:26.353426 59879 grad_async_v2.h:71] call StopThreads. PID = 58861
W20240125 16:11:26.353474 59879 grad_base.h:210] before processOneStepNegThread_.join();
W20240125 16:11:26.355954 59879 grad_base.h:212] after processOneStepNegThread_.join();
W20240125 16:11:26.356019 59879 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240125 16:11:26.377573 59879 grad_async_v2.h:91] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fb14faaa1d0>

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 15:18:53.756629 1923692 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_139', no_save_emb=True, max_step=500, batch_size=2400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1923692 sampler.py:454] Start PreSampling
WARNING [1923692 sampler.py:532] Before construct renumbering_dict
WARNING [1923692 sampler.py:555] PreSampling done
W20240129 15:18:56.361451 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 15:18:56.361681 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 15:18:56.361704 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 15:18:56.361718 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 15:18:56.361732 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 15:18:56.361757 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 15:18:56.361789 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 15:18:56.361806 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 15:18:56.361820 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 15:18:56.361858 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 15:18:56.361887 1923692 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 15:18:56.361903 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 15:18:56.361920 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 15:18:56.362004 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 15:18:56.362038 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 15:18:56.362052 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 15:18:56.362090 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 15:18:56.362118 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 15:18:56.362147 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 15:18:56.362181 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 15:18:56.362218 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 15:18:56.362257 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 15:18:56.362275 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 15:18:56.362290 1923692 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 15:18:56.362303 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 15:18:56.362329 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 15:18:56.362380 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 15:18:56.362408 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 15:18:56.362422 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 15:18:56.362434 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 15:18:56.362455 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 15:18:56.362478 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 15:18:56.362501 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 15:18:56.362514 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 15:18:56.362529 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 15:18:56.362551 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 15:18:56.362572 1923692 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 15:18:56.362584 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 15:18:56.362596 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 15:18:56.362623 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 15:18:56.362650 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 15:18:56.362670 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 15:18:56.362689 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 15:18:56.362702 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 15:18:56.362727 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 15:18:56.362753 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 15:18:56.362767 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 15:18:56.362792 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 15:18:56.362807 1923692 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 15:18:56.362828 1923692 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 15:18:56.362839 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 15:18:56.362856 1923692 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 15:18:56.592180 1923692 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240129 15:18:56.592329 1923692 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 875, 1083, 1155,  ..., 1387, 6499, 6180]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.868 seconds
[Rank1] pid = 1923950
[Rank2] pid = 1924015
INFO [1923692 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [1923950 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [1924079 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [1924015 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [1924079 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1924015 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1923950 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1923692 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 15:18:59.668298 1924081 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240129 15:18:59.668303 1924016 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240129 15:18:59.668805 1924081 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100014878000 7.629 MB
W20240129 15:18:59.668828 1924016 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10001501b000 7.629 MB
W20240129 15:18:59.668880 1923951 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240129 15:18:59.668881 1924080 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240129 15:18:59.668957 1924081 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1000157be000 7.629 MB
W20240129 15:18:59.668992 1924016 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x100015f61000 7.629 MB
W20240129 15:18:59.669015 1924081 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x100016704000 1.49 GB
W20240129 15:18:59.669059 1924016 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x100075ce7000 1.49 GB
W20240129 15:18:59.669063 1924081 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1000d52ca000 1.49 GB
W20240129 15:18:59.669101 1924081 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 15:18:59.669113 1924016 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1001348ad000 1.49 GB
W20240129 15:18:59.669148 1924016 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 15:18:59.671125 1923951 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x100193e92000 7.629 MB
W20240129 15:18:59.671216 1923951 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100194635000 7.629 MB
W20240129 15:18:59.671249 1923951 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x100194dd8000 1.49 GB
W20240129 15:18:59.671278 1923951 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001f43bb000 1.49 GB
W20240129 15:18:59.671308 1923951 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 15:18:59.675045 1924080 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1002539a0000 7.629 MB
W20240129 15:18:59.675130 1923951 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 15:18:59.675154 1924081 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 15:18:59.675209 1924016 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 15:18:59.675215 1924080 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100254149000 7.629 MB
W20240129 15:18:59.675316 1924080 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1002548ec000 1.49 GB
W20240129 15:18:59.675387 1924080 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1002b3ecf000 1.49 GB
W20240129 15:18:59.675462 1924080 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 15:18:59.685616 1924080 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [1924079 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [1923950 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [1924015 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 1924079
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [1923692 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 15:19:00.734762 1924080 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240129 15:19:00.734807 1923951 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 15:19:00.734843 1924016 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 15:19:00.735038 1924081 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240129 15:19:00.736037 1924080 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 15:19:00.736215 1924080 grad_base.h:184] Init GradProcessingBase done
I20240129 15:19:00.740368 1924080 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240129 15:19:00.740475 1924080 kg_controller.h:78] after init GradAsyncProcessingV2
I20240129 15:19:00.740481 1924080 kg_controller.h:84] Construct KGCacheController done
E20240129 15:19:02.130656 1923951 recstore.cc:66] init folly done
E20240129 15:19:02.130668 1924016 recstore.cc:66] init folly done
E20240129 15:19:02.130754 1924080 recstore.cc:66] init folly done
E20240129 15:19:02.130754 1924081 recstore.cc:66] init folly done
I20240129 15:19:02.131386 1924080 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 15:19:02.799768 1924553 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 15:19:02.800104 1924553 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240129 15:19:02.829130 1924016 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240129 15:19:02.849428 1924080 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 15:19:02.855726 1923951 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 15:19:02.872354 1924081 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240129 15:19:05.246682 1924266 parallel_pq_v2.h:76] insert failed, size(hashtable)=4
W20240129 15:19:05.264434 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=1, pq.top=0
W20240129 15:19:05.275530 1924553 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.337 ms                  | 22.392 ms                 |
| Forward                   | 4.196 ms                  | 1.560 s                   |
| Backward                  | 2.875 ms                  | 270.316 ms                |
| Optimize                  | 1.963 ms                  | 4.545 ms                  |
| BarrierTimeBeforeRank0    | 60.593 us                 | 1.868 ms                  |
| AfterBackward             | 23.700 ms                 | 555.843 ms                |
| BlockToStepN              | 197.681 us                | 25.090 ms                 |
| OneStep                   | 44.331 ms                 | 2.402 s                   |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:06.246052 1924553 parallel_pq_v2.h:76] insert failed, size(hashtable)=295
W20240129 15:19:06.289741 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=23, pq.top=23
W20240129 15:19:06.302356 1924553 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.365 ms                  | 58.671 ms                 |
| ProcessBack:UpdateCache   | 1.859 ms                  | 185.626 ms                |
| ProcessBack:UpsertPq      | 20.037 ms                 | 27.263 ms                 |
| ProcessOneStep            | 25.369 ms                 | 555.545 ms                |
| BlockToStepN              | 736.637 us                | 25.046 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:07.246068 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=4157
W20240129 15:19:07.289018 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=44, pq.top=44
W20240129 15:19:07.310149 1924553 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 15:19:08.246012 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=4520
W20240129 15:19:08.289055 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=62, pq.top=62
W20240129 15:19:08.314694 1924553 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 15:19:09.246037 1924080 parallel_pq_v2.h:76] insert failed, size(hashtable)=2192
W20240129 15:19:09.301055 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=81, pq.top=81
W20240129 15:19:09.323045 1924553 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 15:19:10.246021 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=1598
W20240129 15:19:10.320307 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=98, pq.top=98
W20240129 15:19:10.345032 1924553 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 7.627, sample: 0.330, forward: 1.644, backward: 0.613, update: 0.210
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 7.584, sample: 0.312, forward: 1.322, backward: 0.657, update: 0.213
train_sampler.Prefill()
-------Step 0-------
tensor([ 8209,  3008,  8071,  7462,  9039,  4199,   711,  4734, 11164, 10536]) tensor([ 1155,  7270,  8146,  3953,  8290,  7754, 13937,  8085,  6748,  7941])
-------Step 1-------
tensor([ 8209,  3008,  8071,  7462,  9039,  4199,   711,  4734, 11164, 10536]) tensor([ 1926,   411,  5830,  4423, 11474,    42, 14319,  5601,  5732,  8208])
-------Step 2-------
tensor([   82, 11389, 11357, 11543,  4646,  6214, 13250,  7099,  3895,  1378]) tensor([14557,  5514,  7705, 10436,  3738, 10578,  6414,   374, 10221, 11558])
-------Step 3-------
tensor([   82, 11389, 11357, 11543,  4646,  6214, 13250,  7099,  3895,  1378]) tensor([ 9046, 12998,  6595,  7619,  4384,  6886, 14242,  7591,  6897, 13752])
-------Step 4-------
tensor([10384,  7095, 14424,  7803,  4788,  5818,   963,  5758,  4800, 11753]) tensor([  398, 11842, 14874,   994, 11864,  9290,  1740,  8273,  8017,  6036])
-------Step 5-------
tensor([10384,  7095, 14424,  7803,  4788,  5818,   963,  5758,  4800, 11753]) tensor([ 4326, 12135,  3833, 10402,  4825, 10159,  3900,   884, 14400,  1513])
-------Step 6-------
tensor([ 5260,  7887, 13583, 11567,  3518, 12524,  8625, 10294,  4491,  9976]) tensor([13464, 12146, 13947,   465, 10916, 10018,  5978,  1810,  7068,  6962])
-------Step 7-------
tensor([ 5260,  7887, 13583, 11567,  3518, 12524,  8625, 10294,  4491,  9976]) tensor([ 4738,  6100, 10145, 11229,  6225,  8233,  7150, 13487, 14032,  6872])
-------Step 8-------
tensor([  315, 12607,  5595,  6578,  1578,  5369,  3014,  2793,   250,  6957]) tensor([ 7982,  9197, 13018, 12547,  7525,  9072,  6611,  1607,  1877,  9337])
-------Step 9-------
tensor([  315, 12607,  5595,  6578,  1578,  5369,  3014,  2793,   250,  6957]) tensor([ 1556, 13409,  2589, 13958,  2143,   278,  3031,  1013, 11344, 14194])
before start barrier
start train
[proc 0] 100 steps, total: 7.607, sample: 0.404, forward: 1.980, backward: 0.550, update: 0.239
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.601, sample: 0.326, forward: 1.175, backward: 0.684, update: 0.231
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.265 ms                  | 24.654 ms                 |
| Forward                   | 4.068 ms                  | 7.268 ms                  |
| Backward                  | 2.859 ms                  | 3.472 ms                  |
| Optimize                  | 1.909 ms                  | 4.545 ms                  |
| BarrierTimeBeforeRank0    | 85.796 us                 | 7.102 ms                  |
| AfterBackward             | 25.584 ms                 | 32.966 ms                 |
| BlockToStepN              | 11.587 ms                 | 45.715 ms                 |
| OneStep                   | 53.098 ms                 | 120.822 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:11.246016 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=1944
W20240129 15:19:11.320016 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=113, pq.top=113
W20240129 15:19:11.352418 1924553 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.348 ms                  | 10.244 ms                 |
| ProcessBack:UpdateCache   | 1.851 ms                  | 9.194 ms                  |
| ProcessBack:UpsertPq      | 20.618 ms                 | 27.029 ms                 |
| ProcessOneStep            | 26.044 ms                 | 32.941 ms                 |
| BlockToStepN              | 13.297 ms                 | 57.219 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:12.246013 1924080 parallel_pq_v2.h:76] insert failed, size(hashtable)=2179
W20240129 15:19:12.320180 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=127, pq.top=127
W20240129 15:19:12.356818 1924553 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 15:19:13.246021 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=5118
W20240129 15:19:13.369928 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=141, pq.top=141
W20240129 15:19:13.392096 1924553 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 15:19:14.246007 1924080 parallel_pq_v2.h:76] insert failed, size(hashtable)=2202
W20240129 15:19:14.412765 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=154, pq.top=154
W20240129 15:19:14.414592 1924553 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
E20240129 15:19:15.246127 1924553 parallel_pq_v2.h:76] insert failed, size(hashtable)=350
W20240129 15:19:15.414705 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=167, pq.top=167
W20240129 15:19:15.427603 1924553 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.289 ms                  | 25.787 ms                 |
| Forward                   | 4.148 ms                  | 8.557 ms                  |
| Backward                  | 2.881 ms                  | 3.695 ms                  |
| Optimize                  | 1.927 ms                  | 4.545 ms                  |
| BarrierTimeBeforeRank0    | 157.475 us                | 20.851 ms                 |
| AfterBackward             | 26.066 ms                 | 32.744 ms                 |
| BlockToStepN              | 17.907 ms                 | 58.265 ms                 |
| OneStep                   | 59.990 ms                 | 98.015 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:16.246021 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=4901
W20240129 15:19:16.436841 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=186, pq.top=186
W20240129 15:19:16.464401 1924553 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.350 ms                  | 4.519 ms                  |
| ProcessBack:UpdateCache   | 1.973 ms                  | 2.891 ms                  |
| ProcessBack:UpsertPq      | 20.037 ms                 | 26.189 ms                 |
| ProcessOneStep            | 25.560 ms                 | 32.719 ms                 |
| BlockToStepN              | 17.557 ms                 | 105.320 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:17.249634 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=2161
W20240129 15:19:17.436149 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=195, pq.top=195
W20240129 15:19:17.515496 1924553 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
[proc 2] 200 steps, total: 7.702, sample: 0.307, forward: 0.362, backward: 0.277, update: 0.194
[proc 0] 200 steps, total: 7.702, sample: 0.435, forward: 0.432, backward: 0.312, update: 0.220
[proc 1] 200 steps, total: 7.702, sample: 0.366, forward: 0.404, backward: 0.302, update: 0.216
[proc 3] 200 steps, total: 7.702, sample: 0.343, forward: 0.388, backward: 0.337, update: 0.186
E20240129 15:19:18.250792 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=1987
W20240129 15:19:18.436159 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=203, pq.top=203
W20240129 15:19:18.516744 1924553 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 15:19:19.250420 1924553 parallel_pq_v2.h:76] insert failed, size(hashtable)=95
W20240129 15:19:19.436094 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=214, pq.top=214
W20240129 15:19:19.540534 1924553 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 15:19:20.250015 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=2483
W20240129 15:19:20.451669 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=227, pq.top=227
W20240129 15:19:20.542210 1924553 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.312 ms                  | 26.646 ms                 |
| Forward                   | 4.128 ms                  | 8.557 ms                  |
| Backward                  | 2.946 ms                  | 6.049 ms                  |
| Optimize                  | 1.907 ms                  | 4.545 ms                  |
| BarrierTimeBeforeRank0    | 149.635 us                | 21.414 ms                 |
| AfterBackward             | 24.853 ms                 | 32.744 ms                 |
| BlockToStepN              | 20.120 ms                 | 105.719 ms                |
| OneStep                   | 62.544 ms                 | 159.304 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:21.250011 1924080 parallel_pq_v2.h:76] insert failed, size(hashtable)=70
W20240129 15:19:21.493693 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=241, pq.top=241
W20240129 15:19:21.544895 1924553 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.321 ms                  | 4.518 ms                  |
| ProcessBack:UpdateCache   | 1.874 ms                  | 2.756 ms                  |
| ProcessBack:UpsertPq      | 19.148 ms                 | 26.101 ms                 |
| ProcessOneStep            | 24.946 ms                 | 32.719 ms                 |
| BlockToStepN              | 20.678 ms                 | 105.651 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:22.250792 1924553 parallel_pq_v2.h:76] insert failed, size(hashtable)=8
W20240129 15:19:22.502549 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=255, pq.top=255
W20240129 15:19:22.550336 1924553 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 15:19:23.250016 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=2075
W20240129 15:19:23.502012 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=267, pq.top=267
W20240129 15:19:23.556838 1924553 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
E20240129 15:19:24.258347 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=2509
W20240129 15:19:24.516644 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=281, pq.top=281
W20240129 15:19:24.565747 1924553 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 15:19:25.258095 1924553 parallel_pq_v2.h:76] insert failed, size(hashtable)=102
W20240129 15:19:25.526111 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=296, pq.top=296
W20240129 15:19:25.579128 1924553 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.298 ms                  | 26.646 ms                 |
| Forward                   | 4.085 ms                  | 7.268 ms                  |
| Backward                  | 3.049 ms                  | 5.882 ms                  |
| Optimize                  | 1.881 ms                  | 4.496 ms                  |
| BarrierTimeBeforeRank0    | 363.110 us                | 21.414 ms                 |
| AfterBackward             | 25.375 ms                 | 32.233 ms                 |
| BlockToStepN              | 21.783 ms                 | 105.396 ms                |
| OneStep                   | 65.762 ms                 | 147.041 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 300 steps, total: 7.713, sample: 0.336, forward: 0.354, backward: 0.296, update: 0.203
[proc 1] 300 steps, total: 7.713, sample: 0.350, forward: 0.436, backward: 0.332, update: 0.207
[proc 0] 300 steps, total: 7.713, sample: 0.429, forward: 0.402, backward: 0.316, update: 0.205
[proc 3] 300 steps, total: 7.713, sample: 0.352, forward: 0.369, backward: 0.311, update: 0.195
E20240129 15:19:26.258016 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=1967
W20240129 15:19:26.526213 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=309, pq.top=309
W20240129 15:19:26.583680 1924553 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.316 ms                  | 4.415 ms                  |
| ProcessBack:UpdateCache   | 1.851 ms                  | 2.741 ms                  |
| ProcessBack:UpsertPq      | 19.465 ms                 | 26.101 ms                 |
| ProcessOneStep            | 25.307 ms                 | 32.192 ms                 |
| BlockToStepN              | 22.369 ms                 | 105.320 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:27.258034 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=4895
W20240129 15:19:27.543226 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=322, pq.top=322
W20240129 15:19:27.583434 1924553 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 15:19:28.258057 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=5215
W20240129 15:19:28.543035 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=335, pq.top=335
W20240129 15:19:28.649209 1924553 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
E20240129 15:19:29.258170 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=2113
W20240129 15:19:29.570885 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=348, pq.top=348
W20240129 15:19:29.653518 1924553 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
E20240129 15:19:30.258029 1924266 parallel_pq_v2.h:76] insert failed, size(hashtable)=91
W20240129 15:19:30.615657 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=362, pq.top=362
W20240129 15:19:30.657238 1924553 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.319 ms                  | 26.329 ms                 |
| Forward                   | 4.072 ms                  | 6.878 ms                  |
| Backward                  | 3.134 ms                  | 6.010 ms                  |
| Optimize                  | 1.860 ms                  | 4.453 ms                  |
| BarrierTimeBeforeRank0    | 363.110 us                | 21.510 ms                 |
| AfterBackward             | 25.672 ms                 | 32.077 ms                 |
| BlockToStepN              | 24.045 ms                 | 100.708 ms                |
| OneStep                   | 69.184 ms                 | 137.458 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:31.258009 1924266 parallel_pq_v2.h:76] insert failed, size(hashtable)=334
W20240129 15:19:31.615080 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=374, pq.top=374
W20240129 15:19:31.703675 1924553 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.332 ms                  | 3.679 ms                  |
| ProcessBack:UpdateCache   | 1.853 ms                  | 2.737 ms                  |
| ProcessBack:UpsertPq      | 19.872 ms                 | 25.957 ms                 |
| ProcessOneStep            | 25.799 ms                 | 32.192 ms                 |
| BlockToStepN              | 24.445 ms                 | 100.643 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:32.258009 1924080 parallel_pq_v2.h:76] insert failed, size(hashtable)=470
W20240129 15:19:32.616565 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=387, pq.top=387
W20240129 15:19:32.703478 1924553 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 15:19:33.258011 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=4438
W20240129 15:19:33.639982 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=400, pq.top=400
[proc 0] 400 steps, total: 7.791, sample: 0.411, forward: 0.398, backward: 0.324, update: 0.177
[proc 1] 400 steps, total: 7.791, sample: 0.387, forward: 0.422, backward: 0.318, update: 0.199
[proc 3] 400 steps, total: 7.791, sample: 0.289, forward: 0.350, backward: 0.314, update: 0.188
[proc 2] 400 steps, total: 7.792, sample: 0.340, forward: 0.357, backward: 0.280, update: 0.203
W20240129 15:19:33.738894 1924553 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 15:19:34.258064 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=5322
W20240129 15:19:34.639072 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=412, pq.top=412
W20240129 15:19:34.743199 1924553 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 15:19:35.258023 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=5884
W20240129 15:19:35.697230 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=425, pq.top=425
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.351 ms                  | 26.646 ms                 |
| Forward                   | 4.069 ms                  | 6.972 ms                  |
| Backward                  | 3.176 ms                  | 6.010 ms                  |
| Optimize                  | 1.850 ms                  | 4.453 ms                  |
| BarrierTimeBeforeRank0    | 401.482 us                | 21.609 ms                 |
| AfterBackward             | 26.039 ms                 | 32.966 ms                 |
| BlockToStepN              | 25.090 ms                 | 100.708 ms                |
| OneStep                   | 71.386 ms                 | 137.458 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:19:35.749931 1924553 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 15:19:36.258153 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=5338
W20240129 15:19:36.697485 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=437, pq.top=437
W20240129 15:19:36.795655 1924553 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.348 ms                  | 3.662 ms                  |
| ProcessBack:UpdateCache   | 1.889 ms                  | 2.769 ms                  |
| ProcessBack:UpsertPq      | 20.618 ms                 | 27.029 ms                 |
| ProcessOneStep            | 26.119 ms                 | 32.941 ms                 |
| BlockToStepN              | 25.249 ms                 | 100.643 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 15:19:37.258008 1924080 parallel_pq_v2.h:76] insert failed, size(hashtable)=2341
W20240129 15:19:37.725351 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=450, pq.top=450
W20240129 15:19:37.855247 1924553 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 15:19:38.258045 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=6421
W20240129 15:19:38.757391 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=464, pq.top=464
W20240129 15:19:38.879516 1924553 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
E20240129 15:19:39.258015 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=2894
W20240129 15:19:39.757207 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=476, pq.top=476
W20240129 15:19:39.922577 1924553 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
E20240129 15:19:40.258224 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=2034
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.360 ms                  | 27.425 ms                 |
| Forward                   | 4.073 ms                  | 6.878 ms                  |
| Backward                  | 3.192 ms                  | 5.983 ms                  |
| Optimize                  | 1.850 ms                  | 4.393 ms                  |
| BarrierTimeBeforeRank0    | 401.194 us                | 21.656 ms                 |
| AfterBackward             | 26.209 ms                 | 32.825 ms                 |
| BlockToStepN              | 26.063 ms                 | 100.708 ms                |
| OneStep                   | 72.240 ms                 | 137.458 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:19:40.757741 1924080 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=491, pq.top=491
W20240129 15:19:40.957603 1924553 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
E20240129 15:19:41.258020 1924552 parallel_pq_v2.h:76] insert failed, size(hashtable)=1840
[proc 1] 500 steps, total: 7.861, sample: 0.345, forward: 0.413, backward: 0.300, update: 0.210
[proc 0] 500 steps, total: 7.861, sample: 0.486, forward: 0.401, backward: 0.317, update: 0.198
[proc 2] 500 steps, total: 7.861, sample: 0.289, forward: 0.359, backward: 0.337, update: 0.196
[proc 3] 500 steps, total: 7.861, sample: 0.247, forward: 0.340, backward: 0.320, update: 0.205
Successfully xmh. training takes 38.67495059967041 seconds
before call kg_cache_controller.StopThreads()
W20240129 15:19:41.524421 1924080 grad_async_v2.h:71] call StopThreads. PID = 1923692
W20240129 15:19:41.524458 1924080 grad_base.h:212] before processOneStepNegThread_.join();
W20240129 15:19:41.524716 1924080 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 15:19:41.524724 1924080 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240129 15:19:41.533383 1924080 grad_async_v2.h:92] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.350 ms                  | 3.655 ms                  |
| ProcessBack:UpdateCache   | 1.876 ms                  | 2.764 ms                  |
| ProcessBack:UpsertPq      | 20.746 ms                 | 26.737 ms                 |
| ProcessOneStep            | 26.215 ms                 | 32.801 ms                 |
| BlockToStepN              | 26.312 ms                 | 100.643 ms                |
+---------------------------+---------------------------+---------------------------+
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fb5cf518850>

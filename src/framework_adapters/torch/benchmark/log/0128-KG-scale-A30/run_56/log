WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 15:46:59.186417 1982791 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_165', no_save_emb=True, max_step=500, batch_size=2400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1982791 sampler.py:454] Start PreSampling
WARNING [1982791 sampler.py:532] Before construct renumbering_dict
WARNING [1982791 sampler.py:555] PreSampling done
W20240129 15:47:01.410553 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 15:47:01.410727 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 15:47:01.410753 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 15:47:01.410769 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 15:47:01.410786 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 15:47:01.410815 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 15:47:01.410835 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 15:47:01.410856 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 15:47:01.410876 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 15:47:01.410899 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 15:47:01.410928 1982791 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 15:47:01.410946 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 15:47:01.410966 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 15:47:01.411065 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 15:47:01.411096 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 15:47:01.411113 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 15:47:01.411145 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 15:47:01.411166 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 15:47:01.411188 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 15:47:01.411204 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 15:47:01.411227 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 15:47:01.411245 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 15:47:01.411260 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 15:47:01.411285 1982791 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 15:47:01.411299 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 15:47:01.411314 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 15:47:01.411352 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 15:47:01.411374 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 15:47:01.411391 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 15:47:01.411407 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 15:47:01.411427 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 15:47:01.411442 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 15:47:01.411458 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 15:47:01.411473 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 15:47:01.411495 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 15:47:01.411510 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 15:47:01.411525 1982791 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 15:47:01.411540 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 15:47:01.411551 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 15:47:01.411587 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 15:47:01.411607 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 15:47:01.411623 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 15:47:01.411638 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 15:47:01.411653 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 15:47:01.411667 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 15:47:01.411685 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 15:47:01.411700 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 15:47:01.411716 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 15:47:01.411733 1982791 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 15:47:01.411748 1982791 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 15:47:01.411772 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 15:47:01.411792 1982791 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 15:47:01.562978 1982791 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240129 15:47:01.563108 1982791 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 373
Rank1: cached key size 373
Rank2: cached key size 373
Rank3: cached key size 373
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([1651, 1935, 2013,  ..., 2586, 5974, 8375]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.408 seconds
[Rank1] pid = 1983148
[Rank2] pid = 1983212
INFO [1982791 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [1983257 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [1983212 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [1983257 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1983212 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1983148 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [1983148 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 15:47:04.589396 1983306 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [1495, 400]; dev=3; size=2.281 MB
W20240129 15:47:04.589519 1983214 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [1495, 400]; dev=2; size=2.281 MB
W20240129 15:47:04.590054 1983214 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x100014876000 7.629 MB
W20240129 15:47:04.590209 1983214 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10001501b000 7.629 MB
W20240129 15:47:04.590260 1983306 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x1000157be000 7.629 MB
W20240129 15:47:04.590276 1983214 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x100015f61000 1.49 GB
W20240129 15:47:04.590329 1983214 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x100075544000 1.49 GB
W20240129 15:47:04.590368 1983214 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 15:47:04.590389 1983306 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1000d4b27000 7.629 MB
W20240129 15:47:04.590426 1983306 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000d52ca000 1.49 GB
W20240129 15:47:04.590449 1983306 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1001348ad000 1.49 GB
W20240129 15:47:04.590477 1983306 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 15:47:04.590632 1983149 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [1495, 400]; dev=1; size=2.281 MB
W20240129 15:47:04.594211 1983306 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 15:47:04.594233 1983214 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 15:47:04.594419 1983149 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x100193e96000 7.629 MB
W20240129 15:47:04.594642 1983149 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100194639000 7.629 MB
W20240129 15:47:04.594740 1983149 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x100194ddc000 1.49 GB
W20240129 15:47:04.594808 1983149 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1001f43bf000 1.49 GB
W20240129 15:47:04.594907 1983149 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
INFO [1982791 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 15:47:04.595789 1983278 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [1495, 400]; dev=0; size=2.281 MB
W20240129 15:47:04.602672 1983149 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 15:47:04.602893 1983278 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1002539aa000 7.629 MB
W20240129 15:47:04.603063 1983278 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10025414d000 7.629 MB
W20240129 15:47:04.603150 1983278 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1002548f0000 1.49 GB
W20240129 15:47:04.603220 1983278 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1002b3ed3000 1.49 GB
W20240129 15:47:04.603294 1983278 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 15:47:04.614303 1983278 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [1983148 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [1983257 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 1983257
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 1495), (1495, 2990), (2990, 4485), (4485, 5980)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [1982791 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [1983212 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 15:47:05.597548 1983214 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240129 15:47:05.597640 1983306 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 15:47:05.597682 1983278 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 15:47:05.597730 1983149 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240129 15:47:05.598776 1983278 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.1,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 15:47:05.598871 1983278 grad_base.h:184] Init GradProcessingBase done
I20240129 15:47:05.600852 1983278 grad_async_v1.h:199] Use main thread to update emb.
W20240129 15:47:05.600886 1983278 kg_controller.h:75] after init GradAsyncProcessing
I20240129 15:47:05.600891 1983278 kg_controller.h:84] Construct KGCacheController done
E20240129 15:47:05.934487 1983214 recstore.cc:66] init folly done
E20240129 15:47:05.934491 1983278 recstore.cc:66] init folly done
E20240129 15:47:05.934531 1983149 recstore.cc:66] init folly done
E20240129 15:47:05.934595 1983306 recstore.cc:66] init folly done
I20240129 15:47:05.935247 1983278 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 15:47:06.596081 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
I20240129 15:47:06.617648 1983278 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240129 15:47:06.642324 1983214 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 15:47:06.648483 1983149 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 15:47:06.665933 1983306 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240129 15:47:08.850970 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240129 15:47:08.874019 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 15:47:09.850008 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=18, pq.top=18
W20240129 15:47:09.889307 1983767 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.281 ms                  | 19.556 ms                 |
| Forward                   | 4.181 ms                  | 810.275 ms                |
| Backward                  | 5.815 ms                  | 215.265 ms                |
| Optimize                  | 1.774 ms                  | 6.321 ms                  |
| BarrierTimeBeforeRank0    | 22.946 us                 | 272.501 ms                |
| AfterBackward             | 10.413 ms                 | 882.364 ms                |
| BlockToStepN              | 53.598 us                 | 362.695 ms                |
| OneStep                   | 31.538 ms                 | 2.207 s                   |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:10.850010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=24, pq.top=24
W20240129 15:47:10.896910 1983767 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.948 ms                  | 291.806 ms                |
| ProcessBack:UpdateCache   | 1.262 ms                  | 213.551 ms                |
| ProcessBack:UpsertPq      | 6.452 ms                  | 21.805 ms                 |
| ProcessOneStep            | 10.570 ms                 | 881.914 ms                |
| BlockToStepN              | 1.156 us                  | 362.637 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:11.850011 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=32, pq.top=32
W20240129 15:47:11.905941 1983767 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 15:47:12.850006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=41, pq.top=41
W20240129 15:47:12.914314 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 15:47:13.850011 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=51, pq.top=51
W20240129 15:47:13.975396 1983767 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 15:47:14.850006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=61, pq.top=61
W20240129 15:47:14.998749 1983767 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.101 ms                  | 17.080 ms                 |
| Forward                   | 3.827 ms                  | 14.012 ms                 |
| Backward                  | 5.933 ms                  | 7.006 ms                  |
| Optimize                  | 1.538 ms                  | 3.545 ms                  |
| BarrierTimeBeforeRank0    | 20.605 us                 | 2.134 ms                  |
| AfterBackward             | 11.037 ms                 | 25.232 ms                 |
| BlockToStepN              | 77.530 ms                 | 199.924 ms                |
| OneStep                   | 102.508 ms                | 385.538 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:15.870066 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=71, pq.top=71
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.923 ms                  | 146.013 ms                |
| ProcessBack:UpdateCache   | 1.216 ms                  | 213.394 ms                |
| ProcessBack:UpsertPq      | 7.185 ms                  | 20.195 ms                 |
| ProcessOneStep            | 11.017 ms                 | 25.199 ms                 |
| BlockToStepN              | 77.474 ms                 | 199.851 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:16.069586 1983767 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 15:47:16.870012 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=80, pq.top=80
W20240129 15:47:17.069164 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 15:47:17.870009 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=89, pq.top=89
W20240129 15:47:18.070617 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 15:47:18.870007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=98, pq.top=98
W20240129 15:47:19.071000 1983767 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 12.508, sample: 0.213, forward: 1.091, backward: 0.855, update: 0.178
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 12.515, sample: 0.191, forward: 1.294, backward: 0.829, update: 0.167
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 12.491, sample: 0.196, forward: 1.028, backward: 0.815, update: 0.172
train_sampler.Prefill()
-------Step 0-------
tensor([10651,   363,  8932,  6923,  8591,  5867, 12244,  4950, 12080,    79]) tensor([ 2013,  8106,  8998,  1121,  7291, 10169, 12578, 10513,  9005,  1165])
-------Step 1-------
tensor([10651,   363,  8932,  6923,  8591,  5867, 12244,  4950, 12080,    79]) tensor([ 2743,   770,  5464,  4570, 12331,   164,   744,  6443,  6606,  7351])
-------Step 2-------
tensor([ 3918, 13856, 10065, 10012,  5459,  5661, 12682,  6803,  4031,  2134]) tensor([14863,   998, 12460, 10899,  4527,   661,  6449,   921, 10042, 12959])
-------Step 3-------
tensor([ 3918, 13856, 10065, 10012,  5459,  5661, 12682,  6803,  4031,  2134]) tensor([ 8665, 13886,  6414,  7489,  4709,  6442, 13153,  7456,  7882, 12546])
-------Step 4-------
tensor([10189, 11515, 13305, 10733,  5618,  8088,  1733,  5781,  4765, 14560]) tensor([  749, 10971, 14165,  1775, 10497, 12114,  2324,  9485,  9006,  9873])
-------Step 5-------
tensor([10189, 11515, 13305, 10733,  5618,  8088,  1733,  5781,  4765, 14560]) tensor([ 5066, 11406,  3898,  9065,  7927,  9987,  1047,  1610, 13078,  2108])
-------Step 6-------
tensor([ 6138,   508, 12685, 10134,  3779, 10809,  7708,    35,  6171,  9224]) tensor([12442, 13341, 12539,   866, 14410,  8994,  8075,  2424,  6899, 11264])
-------Step 7-------
tensor([ 6138,   508, 12685, 10134,  3779, 10809,  7708,    35,  6171,  9224]) tensor([ 5553,  6016,  9493, 12552,  6157,  8154,  6971,   659, 13689,  6760])
-------Step 8-------
tensor([10452, 13404,  5523,  6588,  2459,  6738,  3876,  3136,   666,  6545]) tensor([ 7194, 10937, 11420, 14906,  6822,  8695,  6140,  2458,  2700,  8446])
-------Step 9-------
tensor([10452, 13404,  5523,  6588,  2459,  6738,  3876,  3136,   666,  6545]) tensor([ 2434, 14576,  3773, 12604,  2688,   540,  3823,  1774, 14295, 13079])
before start barrier
start train
[proc 0] 100 steps, total: 12.539, sample: 0.286, forward: 1.202, backward: 0.775, update: 0.172
W20240129 15:47:19.875622 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=107, pq.top=107
W20240129 15:47:20.078977 1983767 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.105 ms                  | 17.080 ms                 |
| Forward                   | 3.788 ms                  | 14.012 ms                 |
| Backward                  | 5.937 ms                  | 7.006 ms                  |
| Optimize                  | 1.534 ms                  | 3.545 ms                  |
| BarrierTimeBeforeRank0    | 22.113 us                 | 11.616 ms                 |
| AfterBackward             | 10.503 ms                 | 25.232 ms                 |
| BlockToStepN              | 83.132 ms                 | 199.924 ms                |
| OneStep                   | 108.306 ms                | 385.538 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:20.875006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=115, pq.top=115
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.848 ms                  | 3.906 ms                  |
| ProcessBack:UpdateCache   | 1.208 ms                  | 2.205 ms                  |
| ProcessBack:UpsertPq      | 7.247 ms                  | 13.301 ms                 |
| ProcessOneStep            | 10.481 ms                 | 25.199 ms                 |
| BlockToStepN              | 83.549 ms                 | 199.851 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:21.158828 1983767 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 15:47:21.875010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=123, pq.top=123
W20240129 15:47:22.235404 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:47:22.875011 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=132, pq.top=132
W20240129 15:47:23.320608 1983767 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
W20240129 15:47:23.875007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240129 15:47:24.320976 1983767 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 15:47:24.875010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=148, pq.top=148
W20240129 15:47:25.326483 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.116 ms                  | 17.059 ms                 |
| Forward                   | 3.696 ms                  | 7.719 ms                  |
| Backward                  | 5.904 ms                  | 6.871 ms                  |
| Optimize                  | 1.512 ms                  | 3.530 ms                  |
| BarrierTimeBeforeRank0    | 22.946 us                 | 11.003 ms                 |
| AfterBackward             | 10.515 ms                 | 16.645 ms                 |
| BlockToStepN              | 86.405 ms                 | 171.128 ms                |
| OneStep                   | 113.075 ms                | 230.358 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:25.875010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=156, pq.top=156
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.814 ms                  | 3.452 ms                  |
| ProcessBack:UpdateCache   | 1.199 ms                  | 1.958 ms                  |
| ProcessBack:UpsertPq      | 7.276 ms                  | 12.101 ms                 |
| ProcessOneStep            | 10.496 ms                 | 16.592 ms                 |
| BlockToStepN              | 86.365 ms                 | 171.092 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:26.361598 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 15:47:26.875006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=165, pq.top=165
W20240129 15:47:27.366058 1983767 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 15:47:27.890369 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=173, pq.top=173
W20240129 15:47:28.367807 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:47:28.890012 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=181, pq.top=181
W20240129 15:47:29.435572 1983767 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
W20240129 15:47:29.890007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=189, pq.top=189
W20240129 15:47:30.443918 1983767 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.151 ms                  | 17.059 ms                 |
| Forward                   | 3.690 ms                  | 7.719 ms                  |
| Backward                  | 5.939 ms                  | 6.871 ms                  |
| Optimize                  | 1.516 ms                  | 3.530 ms                  |
| BarrierTimeBeforeRank0    | 23.463 us                 | 11.616 ms                 |
| AfterBackward             | 10.542 ms                 | 16.645 ms                 |
| BlockToStepN              | 87.518 ms                 | 171.128 ms                |
| OneStep                   | 115.122 ms                | 230.358 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:30.890009 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=197, pq.top=197
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.813 ms                  | 3.303 ms                  |
| ProcessBack:UpdateCache   | 1.199 ms                  | 1.863 ms                  |
| ProcessBack:UpsertPq      | 7.276 ms                  | 12.016 ms                 |
| ProcessOneStep            | 10.496 ms                 | 16.592 ms                 |
| BlockToStepN              | 87.576 ms                 | 171.092 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 200 steps, total: 12.118, sample: 0.202, forward: 0.295, backward: 0.548, update: 0.168
[proc 0] 200 steps, total: 12.118, sample: 0.293, forward: 0.361, backward: 0.581, update: 0.160
[proc 1] 200 steps, total: 12.118, sample: 0.232, forward: 0.367, backward: 0.581, update: 0.157
[proc 2] 200 steps, total: 12.118, sample: 0.203, forward: 0.286, backward: 0.543, update: 0.162
W20240129 15:47:31.534401 1983767 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 15:47:31.890009 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=205, pq.top=205
W20240129 15:47:32.558037 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 15:47:32.890007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=213, pq.top=213
W20240129 15:47:33.593685 1983767 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 15:47:33.890007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=221, pq.top=221
W20240129 15:47:34.645654 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:47:34.890007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=228, pq.top=228
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.152 ms                  | 17.059 ms                 |
| Forward                   | 3.725 ms                  | 7.719 ms                  |
| Backward                  | 5.907 ms                  | 6.871 ms                  |
| Optimize                  | 1.531 ms                  | 3.530 ms                  |
| BarrierTimeBeforeRank0    | 25.302 us                 | 11.815 ms                 |
| AfterBackward             | 10.556 ms                 | 16.645 ms                 |
| BlockToStepN              | 90.697 ms                 | 171.128 ms                |
| OneStep                   | 119.054 ms                | 230.358 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:35.694749 1983767 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 15:47:35.890009 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=236, pq.top=236
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.808 ms                  | 3.117 ms                  |
| ProcessBack:UpdateCache   | 1.196 ms                  | 1.691 ms                  |
| ProcessBack:UpsertPq      | 7.301 ms                  | 10.715 ms                 |
| ProcessOneStep            | 10.535 ms                 | 16.592 ms                 |
| BlockToStepN              | 90.666 ms                 | 171.092 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:36.768160 1983767 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 15:47:36.921339 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=244, pq.top=244
W20240129 15:47:37.779094 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 15:47:37.921010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=251, pq.top=251
W20240129 15:47:38.851399 1983767 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 15:47:38.921008 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=259, pq.top=259
W20240129 15:47:39.866309 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:47:39.921006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=267, pq.top=267
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.162 ms                  | 16.732 ms                 |
| Forward                   | 3.738 ms                  | 6.460 ms                  |
| Backward                  | 5.914 ms                  | 6.871 ms                  |
| Optimize                  | 1.514 ms                  | 3.358 ms                  |
| BarrierTimeBeforeRank0    | 23.734 us                 | 11.726 ms                 |
| AfterBackward             | 10.558 ms                 | 16.498 ms                 |
| BlockToStepN              | 92.626 ms                 | 138.408 ms                |
| OneStep                   | 121.280 ms                | 194.381 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:40.866572 1983767 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 15:47:40.921007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=274, pq.top=274
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.809 ms                  | 3.117 ms                  |
| ProcessBack:UpdateCache   | 1.192 ms                  | 1.691 ms                  |
| ProcessBack:UpsertPq      | 7.298 ms                  | 10.715 ms                 |
| ProcessOneStep            | 10.535 ms                 | 16.470 ms                 |
| BlockToStepN              | 92.589 ms                 | 138.362 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:41.921013 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=281, pq.top=281
W20240129 15:47:41.935132 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 15:47:42.930650 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=289, pq.top=289
W20240129 15:47:43.023932 1983767 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 15:47:43.930011 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=296, pq.top=296
W20240129 15:47:44.037434 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
[proc 0] 300 steps, total: 13.316, sample: 0.308, forward: 0.366, backward: 0.546, update: 0.156
[proc 1] 300 steps, total: 13.316, sample: 0.211, forward: 0.352, backward: 0.566, update: 0.162
[proc 2] 300 steps, total: 13.316, sample: 0.204, forward: 0.292, backward: 0.534, update: 0.165
[proc 3] 300 steps, total: 13.316, sample: 0.223, forward: 0.299, backward: 0.545, update: 0.163
W20240129 15:47:44.930011 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=303, pq.top=303
W20240129 15:47:45.111838 1983767 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.181 ms                  | 17.025 ms                 |
| Forward                   | 3.741 ms                  | 6.460 ms                  |
| Backward                  | 5.915 ms                  | 6.871 ms                  |
| Optimize                  | 1.499 ms                  | 3.358 ms                  |
| BarrierTimeBeforeRank0    | 24.742 us                 | 11.815 ms                 |
| AfterBackward             | 10.556 ms                 | 16.498 ms                 |
| BlockToStepN              | 94.426 ms                 | 138.408 ms                |
| OneStep                   | 122.529 ms                | 194.381 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:45.930007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=310, pq.top=310
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.807 ms                  | 2.992 ms                  |
| ProcessBack:UpdateCache   | 1.185 ms                  | 1.572 ms                  |
| ProcessBack:UpsertPq      | 7.301 ms                  | 9.593 ms                  |
| ProcessOneStep            | 10.535 ms                 | 16.470 ms                 |
| BlockToStepN              | 94.511 ms                 | 138.362 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:46.121933 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 15:47:46.938098 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=318, pq.top=318
W20240129 15:47:47.180893 1983767 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 15:47:47.938010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=325, pq.top=325
W20240129 15:47:48.185808 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:47:48.938006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=332, pq.top=332
W20240129 15:47:49.219888 1983767 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 15:47:49.966856 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=340, pq.top=340
W20240129 15:47:50.227916 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.196 ms                  | 17.025 ms                 |
| Forward                   | 3.726 ms                  | 6.460 ms                  |
| Backward                  | 5.921 ms                  | 6.871 ms                  |
| Optimize                  | 1.487 ms                  | 3.358 ms                  |
| BarrierTimeBeforeRank0    | 22.558 us                 | 11.815 ms                 |
| AfterBackward             | 10.591 ms                 | 16.498 ms                 |
| BlockToStepN              | 96.411 ms                 | 138.408 ms                |
| OneStep                   | 123.485 ms                | 194.381 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.807 ms                  | 2.992 ms                  |
| ProcessBack:UpdateCache   | 1.184 ms                  | 1.547 ms                  |
| ProcessBack:UpsertPq      | 7.312 ms                  | 10.103 ms                 |
| ProcessOneStep            | 10.572 ms                 | 16.470 ms                 |
| BlockToStepN              | 96.370 ms                 | 138.362 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:50.966004 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=347, pq.top=347
W20240129 15:47:51.303107 1983767 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 15:47:51.966010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=354, pq.top=354
W20240129 15:47:52.310810 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:47:52.966010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=361, pq.top=361
W20240129 15:47:53.341645 1983767 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 15:47:53.966006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=368, pq.top=368
W20240129 15:47:54.349920 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 15:47:54.966009 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=375, pq.top=375
W20240129 15:47:55.445349 1983767 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.207 ms                  | 16.979 ms                 |
| Forward                   | 3.696 ms                  | 6.358 ms                  |
| Backward                  | 5.921 ms                  | 6.842 ms                  |
| Optimize                  | 1.483 ms                  | 3.335 ms                  |
| BarrierTimeBeforeRank0    | 23.463 us                 | 11.815 ms                 |
| AfterBackward             | 10.611 ms                 | 15.188 ms                 |
| BlockToStepN              | 98.226 ms                 | 131.958 ms                |
| OneStep                   | 125.270 ms                | 165.454 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.810 ms                  | 2.895 ms                  |
| ProcessBack:UpdateCache   | 1.187 ms                  | 1.537 ms                  |
| ProcessBack:UpsertPq      | 7.316 ms                  | 10.484 ms                 |
| ProcessOneStep            | 10.592 ms                 | 15.168 ms                 |
| BlockToStepN              | 98.251 ms                 | 131.904 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:47:55.966008 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=382, pq.top=382
W20240129 15:47:56.515923 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:47:56.977712 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=390, pq.top=390
W20240129 15:47:57.523954 1983767 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 15:47:57.977011 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=397, pq.top=397
[proc 2] 400 steps, total: 13.901, sample: 0.201, forward: 0.289, backward: 0.540, update: 0.165
[proc 1] 400 steps, total: 13.901, sample: 0.232, forward: 0.355, backward: 0.567, update: 0.162
[proc 0] 400 steps, total: 13.901, sample: 0.303, forward: 0.352, backward: 0.585, update: 0.144
[proc 3] 400 steps, total: 13.901, sample: 0.191, forward: 0.300, backward: 0.547, update: 0.157
W20240129 15:47:58.634907 1983767 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 15:47:58.977007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=404, pq.top=404
W20240129 15:47:59.637598 1983767 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 15:47:59.977572 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=411, pq.top=411
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.215 ms                  | 16.979 ms                 |
| Forward                   | 3.693 ms                  | 6.358 ms                  |
| Backward                  | 5.927 ms                  | 6.842 ms                  |
| Optimize                  | 1.483 ms                  | 3.335 ms                  |
| BarrierTimeBeforeRank0    | 23.259 us                 | 12.121 ms                 |
| AfterBackward             | 10.622 ms                 | 15.188 ms                 |
| BlockToStepN              | 99.949 ms                 | 132.323 ms                |
| OneStep                   | 126.533 ms                | 165.454 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:48:00.647104 1983767 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.810 ms                  | 2.895 ms                  |
| ProcessBack:UpdateCache   | 1.186 ms                  | 1.537 ms                  |
| ProcessBack:UpsertPq      | 7.316 ms                  | 10.484 ms                 |
| ProcessOneStep            | 10.601 ms                 | 15.168 ms                 |
| BlockToStepN              | 99.943 ms                 | 132.240 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:48:00.977010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=418, pq.top=418
W20240129 15:48:01.718789 1983767 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 15:48:01.977007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=425, pq.top=425
W20240129 15:48:02.773214 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 15:48:02.977008 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=432, pq.top=432
W20240129 15:48:03.774987 1983767 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 15:48:03.977006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=439, pq.top=439
W20240129 15:48:04.778400 1983767 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 15:48:04.977010 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=446, pq.top=446
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.218 ms                  | 16.979 ms                 |
| Forward                   | 3.687 ms                  | 5.662 ms                  |
| Backward                  | 5.930 ms                  | 6.467 ms                  |
| Optimize                  | 1.474 ms                  | 3.318 ms                  |
| BarrierTimeBeforeRank0    | 22.479 us                 | 12.121 ms                 |
| AfterBackward             | 10.623 ms                 | 13.887 ms                 |
| BlockToStepN              | 101.080 ms                | 138.408 ms                |
| OneStep                   | 127.712 ms                | 184.269 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:48:05.814193 1983767 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.809 ms                  | 2.895 ms                  |
| ProcessBack:UpdateCache   | 1.183 ms                  | 1.487 ms                  |
| ProcessBack:UpsertPq      | 7.322 ms                  | 10.590 ms                 |
| ProcessOneStep            | 10.603 ms                 | 13.869 ms                 |
| BlockToStepN              | 101.006 ms                | 136.978 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:48:05.991696 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=454, pq.top=454
W20240129 15:48:06.870627 1983767 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 15:48:06.991009 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=460, pq.top=460
W20240129 15:48:07.886575 1983767 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 15:48:07.991008 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=467, pq.top=467
W20240129 15:48:08.894979 1983767 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 15:48:08.991006 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=474, pq.top=474
W20240129 15:48:09.919286 1983767 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 15:48:09.991009 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=481, pq.top=481
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.219 ms                  | 16.979 ms                 |
| Forward                   | 3.694 ms                  | 5.662 ms                  |
| Backward                  | 5.930 ms                  | 6.842 ms                  |
| Optimize                  | 1.474 ms                  | 3.318 ms                  |
| BarrierTimeBeforeRank0    | 22.303 us                 | 12.121 ms                 |
| AfterBackward             | 10.632 ms                 | 15.188 ms                 |
| BlockToStepN              | 101.809 ms                | 142.441 ms                |
| OneStep                   | 128.579 ms                | 184.269 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:48:10.926667 1983767 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.809 ms                  | 2.878 ms                  |
| ProcessBack:UpdateCache   | 1.181 ms                  | 1.481 ms                  |
| ProcessBack:UpsertPq      | 7.327 ms                  | 10.715 ms                 |
| ProcessOneStep            | 10.622 ms                 | 15.168 ms                 |
| BlockToStepN              | 101.817 ms                | 142.391 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 15:48:10.991007 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=488, pq.top=488
W20240129 15:48:11.980938 1983767 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 15:48:12.011610 1983278 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=495, pq.top=495
[proc 0] 500 steps, total: 14.324, sample: 0.315, forward: 0.355, backward: 0.580, update: 0.151
[proc 1] 500 steps, total: 14.324, sample: 0.209, forward: 0.353, backward: 0.530, update: 0.157
[proc 3] 500 steps, total: 14.324, sample: 0.207, forward: 0.295, backward: 0.543, update: 0.162
[proc 2] 500 steps, total: 14.324, sample: 0.202, forward: 0.290, backward: 0.540, update: 0.161
Successfully xmh. training takes 66.19700574874878 seconds
before call kg_cache_controller.StopThreads()
W20240129 15:48:12.814708 1983278 grad_async_v1.h:230] call StopThreads. PID = 1982791
W20240129 15:48:12.814733 1983278 grad_base.h:212] before processOneStepNegThread_.join();
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240129 15:48:12.822796 1983278 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 15:48:12.822832 1983278 grad_async_v1.h:232] call GradProcessingBase::StopThreads.
W20240129 15:48:12.849485 1983278 grad_async_v1.h:251] StopThreads done.
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f9494640150>

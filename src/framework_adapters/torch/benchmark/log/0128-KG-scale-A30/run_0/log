WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 03:21:43.500449 1203330 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_109', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1203330 sampler.py:454] Start PreSampling
WARNING [1203330 sampler.py:532] Before construct renumbering_dict
WARNING [1203330 sampler.py:555] PreSampling done
W20240129 03:21:45.740643 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 03:21:45.740948 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 03:21:45.740979 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 03:21:45.740995 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 03:21:45.741014 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 03:21:45.741029 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 03:21:45.741042 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 03:21:45.741060 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 03:21:45.741073 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 03:21:45.741089 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 03:21:45.741113 1203330 IPCTensor.h:368] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 03:21:45.741130 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 03:21:45.741143 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 03:21:45.741219 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 03:21:45.741238 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 03:21:45.741252 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 03:21:45.741282 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 03:21:45.741299 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 03:21:45.741317 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 03:21:45.741334 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 03:21:45.741349 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 03:21:45.741367 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 03:21:45.741381 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 03:21:45.741395 1203330 IPCTensor.h:368] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 03:21:45.741408 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 03:21:45.741425 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 03:21:45.741456 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 03:21:45.741473 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 03:21:45.741493 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 03:21:45.741513 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 03:21:45.741531 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 03:21:45.741551 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 03:21:45.741565 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 03:21:45.741580 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 03:21:45.741595 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 03:21:45.741608 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 03:21:45.741622 1203330 IPCTensor.h:368] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 03:21:45.741634 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 03:21:45.741648 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 03:21:45.741676 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 03:21:45.741693 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 03:21:45.741710 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 03:21:45.741727 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 03:21:45.741748 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 03:21:45.741765 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 03:21:45.741781 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 03:21:45.741801 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 03:21:45.741813 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 03:21:45.741828 1203330 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 03:21:45.741842 1203330 IPCTensor.h:368] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 03:21:45.741854 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 03:21:45.741875 1203330 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 03:21:45.864375 1203330 IPCTensor.h:368] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240129 03:21:45.864492 1203330 IPCTensor.h:368] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 852, 1057, 1133,  ..., 1697, 5806, 6697]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.394 seconds
[Rank1] pid = 1203543
[Rank2] pid = 1203608
INFO [1203330 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [1203672 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [1203672 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1203543 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [1203608 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [1203330 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1203608 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1203543 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 03:21:49.392191 1203673 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240129 03:21:49.392756 1203674 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240129 03:21:49.392956 1203673 IPCTensor.h:368] NewIPCTensor: input_keys_0 [1000000]0x100014876000 7.629 MB
W20240129 03:21:49.393144 1203673 IPCTensor.h:368] NewIPCTensor: input_keys_neg_0 [1000000]0x100015019000 7.629 MB
W20240129 03:21:49.393252 1203673 IPCTensor.h:368] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000157bc000 1.49 GB
W20240129 03:21:49.393325 1203673 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100074da1000 1.49 GB
W20240129 03:21:49.393388 1203673 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 03:21:49.393407 1203544 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240129 03:21:49.393406 1203609 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240129 03:21:49.393503 1203674 IPCTensor.h:368] NewIPCTensor: input_keys_3 [1000000]0x1000d4384000 7.629 MB
W20240129 03:21:49.393707 1203674 IPCTensor.h:368] NewIPCTensor: input_keys_neg_3 [1000000]0x1000d4b27000 7.629 MB
W20240129 03:21:49.393791 1203674 IPCTensor.h:368] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000d52ca000 1.49 GB
W20240129 03:21:49.393846 1203674 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1001348ad000 1.49 GB
W20240129 03:21:49.393904 1203674 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 03:21:49.404629 1203673 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 03:21:49.404690 1203674 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 03:21:49.404810 1203544 IPCTensor.h:368] NewIPCTensor: input_keys_1 [1000000]0x100193e98000 7.629 MB
W20240129 03:21:49.404835 1203609 IPCTensor.h:368] NewIPCTensor: input_keys_2 [1000000]0x10019463b000 7.629 MB
W20240129 03:21:49.405051 1203609 IPCTensor.h:368] NewIPCTensor: input_keys_neg_2 [1000000]0x100194dde000 7.629 MB
W20240129 03:21:49.405072 1203544 IPCTensor.h:368] NewIPCTensor: input_keys_neg_1 [1000000]0x100195581000 7.629 MB
W20240129 03:21:49.405167 1203609 IPCTensor.h:368] NewIPCTensor: backward_grads_2 [1000000, 400]0x100195d24000 1.49 GB
W20240129 03:21:49.405179 1203544 IPCTensor.h:368] NewIPCTensor: backward_grads_1 [1000000, 400]0x1001f5307000 1.49 GB
W20240129 03:21:49.405248 1203609 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1002548ea000 1.49 GB
W20240129 03:21:49.405277 1203544 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1002b3ecd000 1.49 GB
W20240129 03:21:49.405334 1203609 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 03:21:49.405339 1203544 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 03:21:49.423563 1203609 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 03:21:49.423573 1203544 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [1203672 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [1203543 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [1203608 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 1203672
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [1203330 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 03:21:50.836119 1203673 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240129 03:21:50.836164 1203609 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 03:21:50.836194 1203544 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 03:21:50.836367 1203674 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240129 03:21:50.837375 1203673 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 03:21:50.837534 1203673 grad_base.h:184] Init GradProcessingBase done
I20240129 03:21:50.841552 1203673 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240129 03:21:50.841650 1203673 kg_controller.h:78] after init GradAsyncProcessingV2
I20240129 03:21:50.841655 1203673 kg_controller.h:84] Construct KGCacheController done
E20240129 03:21:52.258466 1203673 recstore.cc:66] init folly done
E20240129 03:21:52.258467 1203544 recstore.cc:66] init folly done
E20240129 03:21:52.258467 1203609 recstore.cc:66] init folly done
E20240129 03:21:52.258514 1203674 recstore.cc:66] init folly done
I20240129 03:21:52.259327 1203673 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 03:21:52.964723 1204086 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
E20240129 03:21:52.965121 1204086 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240129 03:21:52.988601 1203609 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240129 03:21:52.989102 1203673 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 03:21:53.017378 1203674 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 03:21:53.023070 1203544 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240129 03:21:55.640197 1203858 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240129 03:21:55.656312 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=1, pq.top=0
W20240129 03:21:55.660627 1204086 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.058 ms                  | 14.005 ms                 |
| Forward                   | 3.332 ms                  | 1.206 s                   |
| Backward                  | 3.712 ms                  | 264.365 ms                |
| Optimize                  | 1.198 ms                  | 2.528 ms                  |
| BarrierTimeBeforeRank0    | 36.881 us                 | 68.027 ms                 |
| AfterBackward             | 16.528 ms                 | 1.091 s                   |
| BlockToStepN              | 587.634 us                | 18.282 ms                 |
| OneStep                   | 27.234 ms                 | 2.636 s                   |
+---------------------------+---------------------------+---------------------------+
E20240129 03:21:56.640497 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=6752
W20240129 03:21:56.656020 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=25, pq.top=25
W20240129 03:21:56.667236 1204086 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.138 ms                  | 83.192 ms                 |
| ProcessBack:UpdateCache   | 1.904 ms                  | 231.163 ms                |
| ProcessBack:UpsertPq      | 12.355 ms                 | 18.025 ms                 |
| ProcessOneStep            | 16.919 ms                 | 1.091 s                   |
| BlockToStepN              | 3.053 ms                  | 24.062 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 03:21:57.640023 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=5718
W20240129 03:21:57.669371 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=52, pq.top=51
W20240129 03:21:57.678200 1204086 grad_async_v2.h:121] Detect new sample comes, old_end2, new_end3
E20240129 03:21:58.640017 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=6665
W20240129 03:21:58.669085 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=76, pq.top=75
W20240129 03:21:58.683619 1204086 grad_async_v2.h:121] Detect new sample comes, old_end6, new_end7
E20240129 03:21:59.640024 1203673 parallel_pq_v2.h:76] insert failed, size(hashtable)=954
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 6.633, sample: 0.230, forward: 1.379, backward: 0.639, update: 0.118
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 6.662, sample: 0.200, forward: 1.502, backward: 0.586, update: 0.116
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 6.628, sample: 0.154, forward: 1.320, backward: 0.741, update: 0.099
train_sampler.Prefill()
-------Step 0-------
tensor([ 8060,  3962,  9295,  7250,  7740,  4145,   702,  4445, 12303, 10204]) tensor([ 1133,  8038,  9365,   690,  7364,  7635, 13523,  7938,  7292,  7669])
-------Step 1-------
tensor([ 8060,  3962,  9295,  7250,  7740,  4145,   702,  4445, 12303, 10204]) tensor([ 6824, 12599, 11877, 14169,  7033,  8683,  5649,  1529,  1966,  9502])
-------Step 2-------
tensor([ 8459,  2082,  3406,   128,  8996,  9048,  4248, 10186, 12529,  8776]) tensor([ 9498,  3617,  3055, 13315,  1597,  2107, 11687,  5445, 11392,  6633])
-------Step 3-------
tensor([ 8459,  2082,  3406,   128,  8996,  9048,  4248, 10186, 12529,  8776]) tensor([ 4729, 11097,  6604, 11844,  2279, 10794,  1680, 11605,  5015,    12])
-------Step 4-------
tensor([  184, 14829, 11835, 10630,  5089,  5834, 12935,  6424,  3537,  1366]) tensor([13288,  4731, 10874,  9755,  3265, 10819,  6066,   543,  9150, 12584])
-------Step 5-------
tensor([  184, 14829, 11835, 10630,  5089,  5834, 12935,  6424,  3537,  1366]) tensor([ 6485,  6711,  8080, 13683,  8309, 11017,  2665, 14295,  6795,  5780])
-------Step 6-------
tensor([12460,  4363,   399,    63, 11828, 10639, 14175, 11835,  8943,  6236]) tensor([ 2767,  8686,  6803, 10854,  9157, 11683,  1263,  2140, 11235, 14868])
-------Step 7-------
tensor([12460,  4363,   399,    63, 11828, 10639, 14175, 11835,  8943,  6236]) tensor([ 4389, 14272,  9033,  6535,  4978,   462,  6793,  6754,  9698, 13831])
-------Step 8-------
tensor([ 9307,  9954, 12989,  9397,  4517,  6413,  1034,  5517,  4601, 11688]) tensor([  399, 11469, 14912,  1018, 10207, 10012,  1648,  9077,  7245,  8439])
-------Step 9-------
tensor([ 9307,  9954, 12989,  9397,  4517,  6413,  1034,  5517,  4601, 11688]) tensor([ 9669, 11105,  1044,  3330,  1677, 11306,  6261,  2452,  1966, 13485])
before start barrier
start train
[proc 0] 100 steps, total: 6.662, sample: 0.264, forward: 1.534, backward: 0.537, update: 0.121
W20240129 03:21:59.685151 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=101, pq.top=101
W20240129 03:21:59.693811 1204086 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
E20240129 03:22:00.640033 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=6733
W20240129 03:22:00.693617 1204086 grad_async_v2.h:121] Detect new sample comes, old_end4, new_end5
W20240129 03:22:00.699523 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=125, pq.top=124
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.108 ms                  | 14.159 ms                 |
| Forward                   | 3.305 ms                  | 6.799 ms                  |
| Backward                  | 2.750 ms                  | 5.085 ms                  |
| Optimize                  | 1.182 ms                  | 2.400 ms                  |
| BarrierTimeBeforeRank0    | 147.647 us                | 1.746 ms                  |
| AfterBackward             | 21.735 ms                 | 203.518 ms                |
| BlockToStepN              | 7.101 ms                  | 24.144 ms                 |
| OneStep                   | 39.823 ms                 | 217.075 ms                |
+---------------------------+---------------------------+---------------------------+
E20240129 03:22:01.640012 1203858 parallel_pq_v2.h:76] insert failed, size(hashtable)=252
W20240129 03:22:01.699198 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=148, pq.top=148
W20240129 03:22:01.702777 1204086 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.174 ms                  | 3.628 ms                  |
| ProcessBack:UpdateCache   | 2.492 ms                  | 2.985 ms                  |
| ProcessBack:UpsertPq      | 16.092 ms                 | 19.932 ms                 |
| ProcessOneStep            | 21.969 ms                 | 27.603 ms                 |
| BlockToStepN              | 7.373 ms                  | 21.164 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 03:22:02.640036 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=5285
W20240129 03:22:02.707253 1204086 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 03:22:02.714396 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=171, pq.top=171
E20240129 03:22:03.640007 1203673 parallel_pq_v2.h:76] insert failed, size(hashtable)=157
W20240129 03:22:03.708314 1204086 grad_async_v2.h:121] Detect new sample comes, old_end3, new_end4
W20240129 03:22:03.730763 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=194, pq.top=194
[proc 2] 200 steps, total: 4.373, sample: 0.243, forward: 0.310, backward: 0.279, update: 0.112
[proc 0] 200 steps, total: 4.373, sample: 0.294, forward: 0.324, backward: 0.272, update: 0.119
[proc 3] 200 steps, total: 4.373, sample: 0.256, forward: 0.297, backward: 0.276, update: 0.120
[proc 1] 200 steps, total: 4.373, sample: 0.214, forward: 0.290, backward: 0.376, update: 0.103
E20240129 03:22:04.640013 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=4428
W20240129 03:22:04.711009 1204086 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
W20240129 03:22:04.746605 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=216, pq.top=216
E20240129 03:22:05.640041 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=6437
W20240129 03:22:05.723263 1204086 grad_async_v2.h:121] Detect new sample comes, old_end7, new_end8
W20240129 03:22:05.753965 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=238, pq.top=237
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.165 ms                  | 14.714 ms                 |
| Forward                   | 3.317 ms                  | 6.747 ms                  |
| Backward                  | 2.761 ms                  | 4.482 ms                  |
| Optimize                  | 1.188 ms                  | 2.522 ms                  |
| BarrierTimeBeforeRank0    | 35.246 us                 | 11.752 ms                 |
| AfterBackward             | 22.124 ms                 | 27.897 ms                 |
| BlockToStepN              | 8.473 ms                  | 24.820 ms                 |
| OneStep                   | 41.736 ms                 | 70.738 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 03:22:06.640007 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=7066
W20240129 03:22:06.728978 1204086 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
W20240129 03:22:06.762012 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=260, pq.top=260
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.155 ms                  | 2.565 ms                  |
| ProcessBack:UpdateCache   | 2.410 ms                  | 2.967 ms                  |
| ProcessBack:UpsertPq      | 16.022 ms                 | 19.932 ms                 |
| ProcessOneStep            | 22.141 ms                 | 27.603 ms                 |
| BlockToStepN              | 8.649 ms                  | 24.062 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 03:22:07.640017 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=6588
W20240129 03:22:07.743642 1204086 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 03:22:07.774580 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=281, pq.top=261
E20240129 03:22:08.640015 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=8040
[proc 3] 300 steps, total: 4.699, sample: 0.244, forward: 0.299, backward: 0.311, update: 0.110
[proc 0] 300 steps, total: 4.699, sample: 0.306, forward: 0.324, backward: 0.272, update: 0.135
[proc 2] 300 steps, total: 4.699, sample: 0.227, forward: 0.310, backward: 0.280, update: 0.117
[proc 1] 300 steps, total: 4.699, sample: 0.197, forward: 0.298, backward: 0.285, update: 0.115
W20240129 03:22:08.748507 1204086 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 03:22:08.774016 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=301, pq.top=301
E20240129 03:22:09.640007 1203858 parallel_pq_v2.h:76] insert failed, size(hashtable)=1619
W20240129 03:22:09.760231 1204086 grad_async_v2.h:121] Detect new sample comes, old_end1, new_end2
W20240129 03:22:09.792542 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=322, pq.top=313
E20240129 03:22:10.640015 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=8193
W20240129 03:22:10.766105 1204086 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 03:22:10.801990 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=341, pq.top=341
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.243 ms                  | 15.649 ms                 |
| Forward                   | 3.314 ms                  | 4.301 ms                  |
| Backward                  | 2.755 ms                  | 4.376 ms                  |
| Optimize                  | 1.186 ms                  | 2.515 ms                  |
| BarrierTimeBeforeRank0    | 35.058 us                 | 12.176 ms                 |
| AfterBackward             | 22.144 ms                 | 27.627 ms                 |
| BlockToStepN              | 9.567 ms                  | 30.044 ms                 |
| OneStep                   | 43.740 ms                 | 90.074 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 03:22:11.640024 1203673 parallel_pq_v2.h:76] insert failed, size(hashtable)=1426
W20240129 03:22:11.774601 1204086 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
W20240129 03:22:11.801270 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=360, pq.top=360
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.137 ms                  | 2.435 ms                  |
| ProcessBack:UpdateCache   | 1.919 ms                  | 2.948 ms                  |
| ProcessBack:UpsertPq      | 16.022 ms                 | 20.150 ms                 |
| ProcessOneStep            | 22.154 ms                 | 27.603 ms                 |
| BlockToStepN              | 9.654 ms                  | 29.980 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 03:22:12.640026 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=6706
W20240129 03:22:12.790895 1204086 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 03:22:12.823225 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=381, pq.top=371
E20240129 03:22:13.640012 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=7110
W20240129 03:22:13.792124 1204086 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
[proc 3] 400 steps, total: 5.100, sample: 0.232, forward: 0.300, backward: 0.293, update: 0.109
[proc 0] 400 steps, total: 5.100, sample: 0.322, forward: 0.326, backward: 0.275, update: 0.117
[proc 2] 400 steps, total: 5.100, sample: 0.223, forward: 0.316, backward: 0.290, update: 0.112
[proc 1] 400 steps, total: 5.100, sample: 0.229, forward: 0.299, backward: 0.283, update: 0.105
W20240129 03:22:13.858523 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=401, pq.top=400
E20240129 03:22:14.640013 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=7296
W20240129 03:22:14.802016 1204086 grad_async_v2.h:121] Detect new sample comes, old_end0, new_end1
W20240129 03:22:14.858587 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=421, pq.top=420
E20240129 03:22:15.640008 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=4565
W20240129 03:22:15.804656 1204086 grad_async_v2.h:121] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.292 ms                  | 16.556 ms                 |
| Forward                   | 3.328 ms                  | 4.270 ms                  |
| Backward                  | 2.767 ms                  | 3.712 ms                  |
| Optimize                  | 1.192 ms                  | 2.515 ms                  |
| BarrierTimeBeforeRank0    | 26.469 us                 | 12.448 ms                 |
| AfterBackward             | 22.288 ms                 | 27.627 ms                 |
| BlockToStepN              | 9.875 ms                  | 45.471 ms                 |
| OneStep                   | 44.514 ms                 | 92.895 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 03:22:15.876049 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=440, pq.top=440
E20240129 03:22:16.640007 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=4170
W20240129 03:22:16.833562 1204086 grad_async_v2.h:121] Detect new sample comes, old_end9, new_end0
W20240129 03:22:16.876013 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=460, pq.top=460
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.140 ms                  | 2.451 ms                  |
| ProcessBack:UpdateCache   | 1.887 ms                  | 2.882 ms                  |
| ProcessBack:UpsertPq      | 16.092 ms                 | 20.576 ms                 |
| ProcessOneStep            | 22.308 ms                 | 26.740 ms                 |
| BlockToStepN              | 9.830 ms                  | 44.645 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240129 03:22:17.640013 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=8766
W20240129 03:22:17.866279 1204086 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
W20240129 03:22:17.909731 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=476, pq.top=476
E20240129 03:22:18.640026 1204085 parallel_pq_v2.h:76] insert failed, size(hashtable)=9159
W20240129 03:22:18.880374 1204086 grad_async_v2.h:121] Detect new sample comes, old_end5, new_end6
W20240129 03:22:18.915161 1203673 grad_async_v2.h:250] Sleep in <BlockToStepN>, step_no=496, pq.top=496
[proc 2] 500 steps, total: 5.293, sample: 0.254, forward: 0.320, backward: 0.309, update: 0.116
[proc 3] 500 steps, total: 5.293, sample: 0.234, forward: 0.317, backward: 0.293, update: 0.114
[proc 0] 500 steps, total: 5.293, sample: 0.332, forward: 0.338, backward: 0.277, update: 0.118
[proc 1] 500 steps, total: 5.293, sample: 0.240, forward: 0.326, backward: 0.292, update: 0.117
Successfully xmh. training takes 26.127113342285156 seconds
before call kg_cache_controller.StopThreads()
W20240129 03:22:19.116221 1203673 grad_async_v2.h:71] call StopThreads. PID = 1203330
W20240129 03:22:19.116254 1203673 grad_base.h:212] before processOneStepNegThread_.join();
W20240129 03:22:19.116478 1203673 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 03:22:19.116484 1203673 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240129 03:22:19.124776 1203673 grad_async_v2.h:92] StopThreads done.

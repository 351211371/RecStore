WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240204 14:03:19.148741 18197 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_94', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=8, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [18197 sampler.py:454] Start PreSampling
WARNING [18197 sampler.py:532] Before construct renumbering_dict
WARNING [18197 sampler.py:555] PreSampling done
W20240204 14:23:28.716646 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240204 14:23:28.716845 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240204 14:23:28.716881 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240204 14:23:28.716917 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240204 14:23:28.716960 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240204 14:23:28.716993 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240204 14:23:28.717032 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240204 14:23:28.717077 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240204 14:23:28.717113 18197 IPCTensor.h:369] NewIPCTensor: step_r0 [8]0x100003d1a000 64 B 
W20240204 14:23:28.717146 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100003d1c000 8 B 
W20240204 14:23:28.717180 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100003d1e000 8 B 
W20240204 14:23:28.717340 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100003d20000 7.629 MB
W20240204 14:23:28.717373 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x1000044c3000 7.629 MB
W20240204 14:23:28.717402 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100004c66000 7.629 MB
W20240204 14:23:28.717430 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x100005409000 7.629 MB
W20240204 14:23:28.717456 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100005bac000 7.629 MB
W20240204 14:23:28.717509 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x10000634f000 7.629 MB
W20240204 14:23:28.717535 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100006af2000 7.629 MB
W20240204 14:23:28.717564 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x100007295000 7.629 MB
W20240204 14:23:28.717589 18197 IPCTensor.h:369] NewIPCTensor: step_r1 [8]0x100007a38000 64 B 
W20240204 14:23:28.717613 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x100007a3a000 8 B 
W20240204 14:23:28.717635 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100007a3c000 8 B 
W20240204 14:23:28.717700 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x100007a3e000 7.629 MB
W20240204 14:23:28.717733 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x1000081e1000 7.629 MB
W20240204 14:23:28.717767 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x100008984000 7.629 MB
W20240204 14:23:28.717800 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x100009127000 7.629 MB
W20240204 14:23:28.717834 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x1000098ca000 7.629 MB
W20240204 14:23:28.717870 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000a06d000 7.629 MB
W20240204 14:23:28.717900 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000a810000 7.629 MB
W20240204 14:23:28.717937 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000afb3000 7.629 MB
W20240204 14:23:28.717974 18197 IPCTensor.h:369] NewIPCTensor: step_r2 [8]0x10000b756000 64 B 
W20240204 14:23:28.717999 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000b758000 8 B 
W20240204 14:23:28.718024 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000b75a000 8 B 
W20240204 14:23:28.718089 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000b75c000 7.629 MB
W20240204 14:23:28.718120 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000beff000 7.629 MB
W20240204 14:23:28.718154 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000c6a2000 7.629 MB
W20240204 14:23:28.718185 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000ce45000 7.629 MB
W20240204 14:23:28.718214 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x10000d5e8000 7.629 MB
W20240204 14:23:28.718240 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x10000dd8b000 7.629 MB
W20240204 14:23:28.718267 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x10000e52e000 7.629 MB
W20240204 14:23:28.718302 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x10000ecd1000 7.629 MB
W20240204 14:23:28.718327 18197 IPCTensor.h:369] NewIPCTensor: step_r3 [8]0x10000f474000 64 B 
W20240204 14:23:28.718350 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10000f476000 8 B 
W20240204 14:23:28.718374 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x10000f478000 8 B 
W20240204 14:23:28.718432 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x10000f47a000 7.629 MB
W20240204 14:23:28.718464 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x10000fc1d000 7.629 MB
W20240204 14:23:28.718497 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000103c0000 7.629 MB
W20240204 14:23:28.718528 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x100010b63000 7.629 MB
W20240204 14:23:28.718554 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x100011306000 7.629 MB
W20240204 14:23:28.718582 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x100011aa9000 7.629 MB
W20240204 14:23:28.718609 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x10001224c000 7.629 MB
W20240204 14:23:28.718639 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x1000129ef000 7.629 MB
W20240204 14:23:28.718672 18197 IPCTensor.h:369] NewIPCTensor: step_r4 [8]0x100013192000 64 B 
W20240204 14:23:28.718696 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100013194000 8 B 
W20240204 14:23:28.718724 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100013196000 8 B 
W20240204 14:23:28.718780 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100013198000 7.629 MB
W20240204 14:23:28.718812 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x10001393b000 7.629 MB
W20240204 14:23:28.718844 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x1000140de000 7.629 MB
W20240204 14:23:28.718876 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x100014881000 7.629 MB
W20240204 14:23:28.718907 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100015024000 7.629 MB
W20240204 14:23:28.718945 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x1000157c7000 7.629 MB
W20240204 14:23:28.718971 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x100015f6a000 7.629 MB
W20240204 14:23:28.718998 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001670d000 7.629 MB
W20240204 14:23:28.719025 18197 IPCTensor.h:369] NewIPCTensor: step_r5 [8]0x100016eb0000 64 B 
W20240204 14:23:28.719048 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x100016eb2000 8 B 
W20240204 14:23:28.719075 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100016eb4000 8 B 
W20240204 14:23:28.719125 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x100016eb6000 7.629 MB
W20240204 14:23:28.719156 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x100017659000 7.629 MB
W20240204 14:23:28.719182 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_2 [1000000]0x100017dfc000 7.629 MB
W20240204 14:23:28.719214 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_3 [1000000]0x10001859f000 7.629 MB
W20240204 14:23:28.719244 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_4 [1000000]0x100018d42000 7.629 MB
W20240204 14:23:28.719281 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_5 [1000000]0x1000194e5000 7.629 MB
W20240204 14:23:28.719323 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_6 [1000000]0x100019c88000 7.629 MB
W20240204 14:23:28.719350 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_7 [1000000]0x10001a42b000 7.629 MB
W20240204 14:23:28.719379 18197 IPCTensor.h:369] NewIPCTensor: step_r6 [8]0x10001abce000 64 B 
W20240204 14:23:28.719403 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x10001abd0000 8 B 
W20240204 14:23:28.719424 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x10001abd2000 8 B 
W20240204 14:23:28.719476 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_0 [1000000]0x10001abd4000 7.629 MB
W20240204 14:23:28.719506 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_1 [1000000]0x10001b377000 7.629 MB
W20240204 14:23:28.719533 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_2 [1000000]0x10001bb1a000 7.629 MB
W20240204 14:23:28.719561 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_3 [1000000]0x10001c2bd000 7.629 MB
W20240204 14:23:28.719590 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_4 [1000000]0x10001ca60000 7.629 MB
W20240204 14:23:28.719619 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_5 [1000000]0x10001d203000 7.629 MB
W20240204 14:23:28.719650 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_6 [1000000]0x10001d9a6000 7.629 MB
W20240204 14:23:28.719678 18197 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_7 [1000000]0x10001e149000 7.629 MB
W20240204 14:23:28.719707 18197 IPCTensor.h:369] NewIPCTensor: step_r7 [8]0x10001e8ec000 64 B 
W20240204 14:23:28.719729 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r7 [1]0x10001e8ee000 8 B 
W20240204 14:23:28.719753 18197 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x10001e8f0000 8 B 
W20240204 14:23:29.117857 18197 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10001e8f2000 128.2 GB
W20240204 14:32:08.890583 18197 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10202d52a000 328.3 MB
{0: Graph(num_nodes=18863774, num_edges=55186826,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=13493829, num_edges=51786811,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=12506959, num_edges=45797296,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=12605014, num_edges=52067933,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=14435508, num_edges=39101576,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=13252778, num_edges=37365728,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=14444909, num_edges=60122064,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=14493336, num_edges=37760331,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 18863774 N 55186826 E
MertisPartition: part 1 has 13493829 N 51786811 E
MertisPartition: part 2 has 12506959 N 45797296 E
MertisPartition: part 3 has 12605014 N 52067933 E
MertisPartition: part 4 has 14435508 N 39101576 E
MertisPartition: part 5 has 13252778 N 37365728 E
MertisPartition: part 6 has 14444909 N 60122064 E
MertisPartition: part 7 has 14493336 N 37760331 E
Rank0: cached key size 537838
Rank1: cached key size 537838
Rank2: cached key size 537838
Rank3: cached key size 537838
Rank4: cached key size 537838
Rank5: cached key size 537838
Rank6: cached key size 537838
Rank7: cached key size 537838
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 39512110,  9797409, 32293938]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 6, 6])}
After renumbering graph:  {'_ID': tensor([ 4302718,  4302737,    89698,  ..., 73078015, 70155502,  5261466]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 6, 6])}
part_g: DGLGraph(num_nodes=18863774, num_edges=55186826,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=18863774, num_edges=55186826,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2236.829 seconds
[Rank1] pid = 44467
[Rank2] pid = 44564
[Rank3] pid = 44631
[Rank4] pid = 44787
[Rank5] pid = 44952
[Rank6] pid = 45114
INFO [18197 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [44467 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [44564 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [44952 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [44631 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [44787 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [45114 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [45317 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [44952 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [44787 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [44631 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [45317 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [44467 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [45114 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [44564 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240204 14:40:47.574981 45381 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_7 [4302707, 400]; dev=7; size=6.412 GB
W20240204 14:40:47.575045 44953 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [4302707, 400]; dev=5; size=6.412 GB
W20240204 14:40:47.575044 44468 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240204 14:40:47.575047 45123 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_6 [4302707, 400]; dev=6; size=6.412 GB
W20240204 14:40:47.575292 44565 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240204 14:40:47.575923 44788 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [4302707, 400]; dev=4; size=6.412 GB
W20240204 14:40:47.575924 44632 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
INFO [18197 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240204 14:40:47.579145 45318 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240204 14:40:47.657579 45318 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102041d81000 7.629 MB
W20240204 14:40:47.657591 45381 IPCTensor.h:369] NewIPCTensor: input_keys_7 [1000000]0x102042cc7000 7.629 MB
W20240204 14:40:47.657598 44565 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10204346a000 7.629 MB
W20240204 14:40:47.657590 45123 IPCTensor.h:369] NewIPCTensor: input_keys_6 [1000000]0x102042524000 7.629 MB
W20240204 14:40:47.657613 44468 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102043c0d000 7.629 MB
W20240204 14:40:47.657632 44953 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x1020443b0000 7.629 MB
W20240204 14:40:47.657646 44632 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102044b53000 7.629 MB
W20240204 14:40:47.657649 44788 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x1020452f6000 7.629 MB
W20240204 14:40:47.657745 45318 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x102045a99000 7.629 MB
W20240204 14:40:47.657781 45381 IPCTensor.h:369] NewIPCTensor: input_keys_neg_7 [1000000]0x10204623c000 7.629 MB
W20240204 14:40:47.657785 44468 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1020469df000 7.629 MB
W20240204 14:40:47.657801 45123 IPCTensor.h:369] NewIPCTensor: input_keys_neg_6 [1000000]0x102047182000 7.629 MB
W20240204 14:40:47.657805 44565 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x102047925000 7.629 MB
W20240204 14:40:47.657812 45318 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1020480c8000 1.49 GB
W20240204 14:40:47.657824 44953 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x1020a76ab000 7.629 MB
W20240204 14:40:47.657848 45318 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1020a7e4e000 1.49 GB
W20240204 14:40:47.657873 45381 IPCTensor.h:369] NewIPCTensor: backward_grads_7 [1000000, 400]0x102107431000 1.49 GB
W20240204 14:40:47.657887 45318 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 14:40:47.657884 44788 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x102166a14000 7.629 MB
W20240204 14:40:47.657891 44632 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1021671b7000 7.629 MB
W20240204 14:40:47.657897 45123 IPCTensor.h:369] NewIPCTensor: backward_grads_6 [1000000, 400]0x10216795a000 1.49 GB
W20240204 14:40:47.657904 44468 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1021c6f3d000 1.49 GB
W20240204 14:40:47.657919 44565 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x102226520000 1.49 GB
W20240204 14:40:47.657927 44953 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x102285b03000 1.49 GB
W20240204 14:40:47.657959 45381 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_7 [1000000, 400]0x1022e50e6000 1.49 GB
W20240204 14:40:47.657979 45123 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_6 [1000000, 400]0x1023446c9000 1.49 GB
W20240204 14:40:47.657987 44565 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1023a3cac000 1.49 GB
W20240204 14:40:47.657994 44468 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10240328f000 1.49 GB
W20240204 14:40:47.658007 44953 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x102462872000 1.49 GB
W20240204 14:40:47.658031 45381 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 14:40:47.658048 45123 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 14:40:47.658056 44468 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240204 14:40:47.658056 44953 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 14:40:47.658056 44565 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 14:40:47.658067 44788 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x1024c1e55000 1.49 GB
W20240204 14:40:47.658073 44632 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102521438000 1.49 GB
W20240204 14:40:47.658144 44632 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x102580a1b000 1.49 GB
W20240204 14:40:47.658150 44788 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x1025dfffe000 1.49 GB
W20240204 14:40:47.658215 44788 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 14:40:47.658214 44632 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240204 14:40:47.671712 45318 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 14:40:47.671751 45381 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 14:40:47.671761 44953 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 14:40:47.671766 45123 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 14:40:47.671844 44468 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240204 14:40:47.671855 44565 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 14:40:47.671867 44788 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 14:40:47.671867 44632 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
cudaHostRegister 0x10001e8f2000
1: KnownLocalCachedEmbedding init done
WARNING [44467 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001e8f2000
5: KnownLocalCachedEmbedding init done
WARNING [44952 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank7] pid = 45317
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242), (25816242, 30118949), (30118949, 34421656)]
cudaHostRegister 0x10001e8f2000
0: KnownLocalCachedEmbedding init done
WARNING [18197 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001e8f2000
3: KnownLocalCachedEmbedding init done
WARNING [44631 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001e8f2000
2: KnownLocalCachedEmbedding init done
WARNING [44564 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001e8f2000
7: KnownLocalCachedEmbedding init done
WARNING [45317 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001e8f2000
6: KnownLocalCachedEmbedding init done
cudaHostRegister 0x10001e8f2000
4: KnownLocalCachedEmbedding init done
WARNING [45114 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [44787 DistTensor.py:59] The tensor name already exists in the kvstore
I20240204 14:41:37.851498 44788 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240204 14:41:37.851608 45123 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 14:41:37.851688 44953 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 14:41:37.851761 45381 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 14:41:37.851794 44565 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 14:41:37.851843 45318 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 14:41:37.851915 44468 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 14:41:37.851982 44632 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240204 14:41:37.854638 45318 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 8,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240204 14:41:37.855479 45318 grad_base.h:184] Init GradProcessingBase done
I20240204 14:41:51.135087 45318 grad_async_v2.h:42] Use main thread to update emb.
W20240204 14:41:51.135370 45318 kg_controller.h:78] after init GradAsyncProcessingV2
I20240204 14:41:51.135382 45318 kg_controller.h:84] Construct KGCacheController done
E20240204 14:41:51.896831 44632 recstore.cc:66] init folly done
E20240204 14:41:51.896834 45381 recstore.cc:66] init folly done
E20240204 14:41:51.896836 45318 recstore.cc:66] init folly done
E20240204 14:41:51.896845 44953 recstore.cc:66] init folly done
E20240204 14:41:51.896857 44468 recstore.cc:66] init folly done
E20240204 14:41:51.896863 44788 recstore.cc:66] init folly done
E20240204 14:41:51.897599 45123 recstore.cc:66] init folly done
E20240204 14:41:51.897656 44565 recstore.cc:66] init folly done
I20240204 14:41:51.898517 45318 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240204 14:42:10.625805 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 14:42:10.627558 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
E20240204 14:42:11.627049 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=3
W20240204 14:42:11.774437 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 170.312 us                | 357.665 us                |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:13.420986 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 14:42:13.421154 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
I20240204 14:42:14.000118 44953 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240204 14:42:14.043668 45381 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 14:42:14.336985 44788 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240204 14:42:14.421017 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=6
W20240204 14:42:14.717411 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
I20240204 14:42:15.088771 44565 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240204 14:42:15.421033 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240204 14:42:15.882544 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
I20240204 14:42:15.934926 45318 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240204 14:42:16.856951 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 159.288 us                | 280.420 us                |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:16.900722 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end4
I20240204 14:42:16.973134 44632 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 14:42:17.839670 44468 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240204 14:42:17.856010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=16
W20240204 14:42:17.957710 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
W20240204 14:42:19.177592 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240204 14:42:19.194254 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240204 14:42:19.357751 45123 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240204 14:42:20.194039 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
E20240204 14:42:21.806766 48137 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 153.337 us                | 2.054 ms                  |
| ProcessBack:Shuffle       | 309.183 ms                | 341.108 ms                |
| ProcessBack:UpdateCache   | 678.571 ms                | 679.019 ms                |
| ProcessBack:UpsertPq      | 24.566 ms                 | 24.566 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:21.918794 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240204 14:42:21.933748 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240204 14:42:22.806011 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=2553
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.515 ms                  | 59.576 ms                 |
| Forward                   | 5.907 ms                  | 947.938 ms                |
| Backward                  | 5.805 ms                  | 175.405 ms                |
| Optimize                  | 2.670 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 9.933 ms                  | 59.224 ms                 |
| AfterBackward             | 69.760 ms                 | 1.372 s                   |
| BlockToStepN              | 579.908 us                | 1.446 ms                  |
| OneStep                   | 126.457 ms                | 2.572 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:22.979163 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=8, pq.top=8
W20240204 14:42:23.166249 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
E20240204 14:42:23.771816 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=10, sample_step_cpp_seen_[rank]=9
E20240204 14:42:23.806008 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=226
W20240204 14:42:24.365252 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
E20240204 14:42:24.811548 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240204 14:42:25.421221 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240204 14:42:25.494877 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=13, pq.top=13
E20240204 14:42:25.811010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=6853
W20240204 14:42:26.428406 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
E20240204 14:42:26.811015 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=46
W20240204 14:42:26.851507 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=19, pq.top=19
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 435.346 us                | 5.780 ms                  |
| ProcessBack:Shuffle       | 9.113 ms                  | 341.108 ms                |
| ProcessBack:UpdateCache   | 10.107 ms                 | 679.019 ms                |
| ProcessBack:UpsertPq      | 66.816 ms                 | 204.227 ms                |
| ProcessOneStep            | 166.089 ms                | 1.371 s                   |
| BlockToStepN              | 641.594 us                | 1.960 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:27.605461 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end0
E20240204 14:42:27.811058 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=634
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.420 ms                  | 410.901 ms                |
| Forward                   | 6.805 ms                  | 947.938 ms                |
| Backward                  | 5.493 ms                  | 175.405 ms                |
| Optimize                  | 3.281 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 2.445 ms                  | 59.224 ms                 |
| AfterBackward             | 158.731 ms                | 1.372 s                   |
| BlockToStepN              | 809.811 us                | 2.045 ms                  |
| OneStep                   | 216.388 ms                | 2.572 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:28.680419 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
E20240204 14:42:28.771018 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=24, sample_step_cpp_seen_[rank]=23
E20240204 14:42:28.811009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=194
W20240204 14:42:28.962522 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=25, pq.top=25
W20240204 14:42:29.690253 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end5
E20240204 14:42:29.811014 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=51
W20240204 14:42:30.151705 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=31, pq.top=31
W20240204 14:42:30.787410 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240204 14:42:30.811004 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=421
W20240204 14:42:31.700107 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=39, pq.top=39
E20240204 14:42:31.811013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=71
W20240204 14:42:31.811306 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 413.467 us                | 3.101 ms                  |
| ProcessBack:Shuffle       | 8.666 ms                  | 309.183 ms                |
| ProcessBack:UpdateCache   | 10.101 ms                 | 678.571 ms                |
| ProcessBack:UpsertPq      | 51.529 ms                 | 197.356 ms                |
| ProcessOneStep            | 141.672 ms                | 1.371 s                   |
| BlockToStepN              | 731.817 us                | 7.120 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:32.738548 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=43, pq.top=43
E20240204 14:42:32.811021 48137 parallel_pq_v2.h:79] insert failed, size(hashtable)=150
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 11.911 ms                 | 410.901 ms                |
| Forward                   | 6.618 ms                  | 947.938 ms                |
| Backward                  | 5.523 ms                  | 175.405 ms                |
| Optimize                  | 3.204 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 475.889 us                | 59.224 ms                 |
| AfterBackward             | 141.735 ms                | 1.372 s                   |
| BlockToStepN              | 908.685 us                | 7.212 ms                  |
| OneStep                   | 215.254 ms                | 2.572 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:32.935418 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end5
E20240204 14:42:33.811012 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=1545
W20240204 14:42:33.829648 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=51, pq.top=51
E20240204 14:42:33.873486 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=6, step_no=51, sample_step_cpp_seen_[rank]=50
W20240204 14:42:33.962579 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
E20240204 14:42:34.811014 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=2034
W20240204 14:42:34.975766 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240204 14:42:35.811025 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1069
W20240204 14:42:36.024386 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
W20240204 14:42:36.780586 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=60, pq.top=60
E20240204 14:42:36.811596 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 481.976 us                | 3.730 ms                  |
| ProcessBack:Shuffle       | 8.675 ms                  | 309.183 ms                |
| ProcessBack:UpdateCache   | 10.467 ms                 | 678.571 ms                |
| ProcessBack:UpsertPq      | 66.816 ms                 | 197.356 ms                |
| ProcessOneStep            | 139.381 ms                | 1.231 s                   |
| BlockToStepN              | 557.281 us                | 6.202 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:37.147526 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240204 14:42:37.811033 51391 parallel_pq_v2.h:79] insert failed, size(hashtable)=2071
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.422 ms                  | 192.142 ms                |
| Forward                   | 6.178 ms                  | 33.136 ms                 |
| Backward                  | 5.729 ms                  | 11.703 ms                 |
| Optimize                  | 3.127 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 2.334 ms                  | 47.879 ms                 |
| AfterBackward             | 139.448 ms                | 1.231 s                   |
| BlockToStepN              | 719.746 us                | 6.295 ms                  |
| OneStep                   | 190.706 ms                | 1.261 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:38.287106 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end2
W20240204 14:42:38.580225 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=66, pq.top=66
E20240204 14:42:38.811019 48137 parallel_pq_v2.h:79] insert failed, size(hashtable)=2237
W20240204 14:42:39.347213 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 14:42:39.681638 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=74, pq.top=74
E20240204 14:42:39.811010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=34415
E20240204 14:42:39.938457 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=76, sample_step_cpp_seen_[rank]=75
W20240204 14:42:40.488421 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
E20240204 14:42:40.811008 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=147
W20240204 14:42:41.480059 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=79, pq.top=79
W20240204 14:42:41.521145 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
E20240204 14:42:41.811009 48137 parallel_pq_v2.h:79] insert failed, size(hashtable)=3039
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 500.735 us                | 3.321 ms                  |
| ProcessBack:Shuffle       | 8.603 ms                  | 38.505 ms                 |
| ProcessBack:UpdateCache   | 10.389 ms                 | 47.629 ms                 |
| ProcessBack:UpsertPq      | 53.028 ms                 | 191.725 ms                |
| ProcessOneStep            | 122.194 ms                | 1.231 s                   |
| BlockToStepN              | 676.010 us                | 7.936 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:42.563161 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end0
W20240204 14:42:42.668723 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=88, pq.top=88
E20240204 14:42:42.811012 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=597
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.459 ms                  | 192.142 ms                |
| Forward                   | 5.750 ms                  | 33.136 ms                 |
| Backward                  | 5.603 ms                  | 11.703 ms                 |
| Optimize                  | 3.035 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 3.461 ms                  | 57.688 ms                 |
| AfterBackward             | 121.046 ms                | 1.231 s                   |
| BlockToStepN              | 809.811 us                | 8.037 ms                  |
| OneStep                   | 166.769 ms                | 1.261 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:43.643872 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 14:42:43.798130 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=90, pq.top=90
E20240204 14:42:43.811013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=610
W20240204 14:42:44.669687 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end6
E20240204 14:42:44.811012 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=32022
W20240204 14:42:45.196911 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=97, pq.top=97
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 31.483, sample: 1.490, forward: 1.294, backward: 0.850, update: 0.257
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 28.553, sample: 1.503, forward: 1.316, backward: 1.017, update: 0.267
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 26.169, sample: 1.574, forward: 1.425, backward: 0.832, update: 0.295
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 31.526, sample: 1.418, forward: 1.263, backward: 1.045, update: 0.271
train_sampler.Prefill()
-------Step 0-------
tensor([   41337,    41369,    41395,    41422,  6182814,    91012, 67626380,
        15733101, 26133595,    41452]) tensor([ 5396160, 12918797, 72966397, 82836083, 16693605, 39277751, 29758943,
        63963210, 56920445, 36924027])
-------Step 1-------
tensor([   41337,    41369,    41395,    41422,  6182814,    91012, 67626380,
        15733101, 26133595,    41452]) tensor([57245315, 35352663,  9446874, 65998433, 68003895, 47474274, 58860429,
        38465012, 46466812, 12068393])
-------Step 2-------
tensor([  104271,   104303,   104323,    32167,   104346,   104376,   104394,
        30530443,   104409,   104439]) tensor([81097181, 20807087, 76996073, 60664574, 35019785, 35490435, 57532723,
        51737592, 16969808, 46381956])
-------Step 3-------
tensor([  104271,   104303,   104323,    32167,   104346,   104376,   104394,
        30530443,   104409,   104439]) tensor([61091554, 85737703, 42567345, 47435501, 73108001, 51706347, 45467912,
        14663971, 32933609,   764435])
-------Step 4-------
tensor([  167042, 37132705,   167071,   114603,   167100,   114633,   167126,
        49521853,   167149,   167170]) tensor([84894439,  8785381, 69250958, 14978473, 77477652, 34439342, 53931088,
        46617236, 83641309, 63270102])
-------Step 5-------
tensor([  167042, 37132705,   167071,   114603,   167100,   114633,   167126,
        49521853,   167149,   167170]) tensor([45599026, 62738167,   333381, 85465240, 45830983, 68027074, 17815613,
         7717067, 80308426, 51007309])
-------Step 6-------
tensor([  229527,    67690,   229547,   229574,    67748, 61373535,   229599,
          229635,   126372, 45298974]) tensor([11187477, 46769358, 45017470, 67245127, 43177436, 29789047, 29462280,
         7297207, 78748204, 82947930])
-------Step 7-------
tensor([  229527,    67690,   229547,   229574,    67748, 61373535,   229599,
          229635,   126372, 45298974]) tensor([21373170, 41631385, 58350833, 49136087, 84649941, 64888794, 43154113,
        69660039, 43595693, 25775106])
before start barrier
start train
[proc 0] 100 steps, total: 29.592, sample: 2.344, forward: 1.602, backward: 0.789, update: 0.321
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 27.687, sample: 1.701, forward: 1.390, backward: 0.942, update: 0.342
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 30.438, sample: 1.295, forward: 1.354, backward: 0.823, update: 0.237
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 31.190, sample: 1.721, forward: 1.385, backward: 0.852, update: 0.272
W20240204 14:42:45.787045 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240204 14:42:45.811012 51374 parallel_pq_v2.h:79] insert failed, size(hashtable)=5314
E20240204 14:42:46.151835 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=104, sample_step_cpp_seen_[rank]=103
W20240204 14:42:46.789459 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 14:42:46.811007 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=21029
W20240204 14:42:46.868870 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=105, pq.top=105
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 427.324 us                | 5.907 ms                  |
| ProcessBack:Shuffle       | 8.632 ms                  | 38.505 ms                 |
| ProcessBack:UpdateCache   | 10.530 ms                 | 47.629 ms                 |
| ProcessBack:UpsertPq      | 45.973 ms                 | 191.725 ms                |
| ProcessOneStep            | 120.802 ms                | 1.231 s                   |
| BlockToStepN              | 731.817 us                | 8.475 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240204 14:42:47.811008 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=459
W20240204 14:42:47.862275 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.272 ms                  | 192.142 ms                |
| Forward                   | 5.648 ms                  | 33.136 ms                 |
| Backward                  | 5.729 ms                  | 11.703 ms                 |
| Optimize                  | 2.792 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 3.181 ms                  | 59.224 ms                 |
| AfterBackward             | 121.577 ms                | 1.231 s                   |
| BlockToStepN              | 783.189 us                | 8.550 ms                  |
| OneStep                   | 160.941 ms                | 1.261 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:48.075874 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=113, pq.top=113
E20240204 14:42:48.811008 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=3318
W20240204 14:42:48.881476 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
W20240204 14:42:49.316234 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=119, pq.top=119
E20240204 14:42:49.837178 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 14:42:49.888020 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 14:42:50.335608 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=126, pq.top=125
E20240204 14:42:50.837010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=4083
W20240204 14:42:50.938083 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
E20240204 14:42:51.151006 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=7, step_no=131, sample_step_cpp_seen_[rank]=130
E20240204 14:42:51.837010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1096
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 380.292 us                | 4.840 ms                  |
| ProcessBack:Shuffle       | 8.773 ms                  | 22.397 ms                 |
| ProcessBack:UpdateCache   | 10.572 ms                 | 36.085 ms                 |
| ProcessBack:UpsertPq      | 43.243 ms                 | 187.318 ms                |
| ProcessOneStep            | 110.645 ms                | 1.231 s                   |
| BlockToStepN              | 794.898 us                | 42.617 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:51.957521 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240204 14:42:52.146703 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=134, pq.top=133
E20240204 14:42:52.837013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=197
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.798 ms                  | 192.142 ms                |
| Forward                   | 5.541 ms                  | 33.136 ms                 |
| Backward                  | 5.613 ms                  | 11.703 ms                 |
| Optimize                  | 2.670 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 3.589 ms                  | 89.730 ms                 |
| AfterBackward             | 109.146 ms                | 1.231 s                   |
| BlockToStepN              | 899.392 us                | 42.741 ms                 |
| OneStep                   | 153.118 ms                | 1.261 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:53.099274 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end5
W20240204 14:42:53.193069 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=141, pq.top=141
E20240204 14:42:53.837013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=2001
W20240204 14:42:54.100101 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 14:42:54.534783 45318 grad_async_v2.h:257] pq is empty
E20240204 14:42:54.837010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=7762
W20240204 14:42:55.122582 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end5
W20240204 14:42:55.503084 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=152, pq.top=152
E20240204 14:42:55.837010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=4732
E20240204 14:42:56.151011 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=7, step_no=155, sample_step_cpp_seen_[rank]=154
W20240204 14:42:56.278226 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
E20240204 14:42:56.837009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=14216
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 354.171 us                | 5.791 ms                  |
| ProcessBack:Shuffle       | 8.704 ms                  | 22.397 ms                 |
| ProcessBack:UpdateCache   | 10.540 ms                 | 36.085 ms                 |
| ProcessBack:UpsertPq      | 39.080 ms                 | 187.318 ms                |
| ProcessOneStep            | 108.304 ms                | 1.220 s                   |
| BlockToStepN              | 809.365 us                | 19.018 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:57.285773 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
W20240204 14:42:57.505518 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=161, pq.top=161
E20240204 14:42:57.837384 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=13158
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.086 ms                  | 140.328 ms                |
| Forward                   | 5.541 ms                  | 21.557 ms                 |
| Backward                  | 5.836 ms                  | 11.409 ms                 |
| Optimize                  | 2.672 ms                  | 7.281 ms                  |
| BarrierTimeBeforeRank0    | 3.822 ms                  | 78.098 ms                 |
| AfterBackward             | 107.041 ms                | 1.220 s                   |
| BlockToStepN              | 947.010 us                | 42.741 ms                 |
| OneStep                   | 150.418 ms                | 1.256 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:42:58.321134 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240204 14:42:58.837013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=871
W20240204 14:42:59.006361 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=168, pq.top=168
W20240204 14:42:59.326954 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240204 14:42:59.837018 51387 parallel_pq_v2.h:79] insert failed, size(hashtable)=70505
W20240204 14:43:00.048857 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=176, pq.top=175
W20240204 14:43:00.468101 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
E20240204 14:43:00.837013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=5981
E20240204 14:43:01.151008 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=179, sample_step_cpp_seen_[rank]=178
W20240204 14:43:01.494405 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240204 14:43:01.781049 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=181, pq.top=181
E20240204 14:43:01.837024 48137 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 364.871 us                | 5.938 ms                  |
| ProcessBack:Shuffle       | 8.762 ms                  | 22.397 ms                 |
| ProcessBack:UpdateCache   | 10.540 ms                 | 30.016 ms                 |
| ProcessBack:UpsertPq      | 38.289 ms                 | 177.955 ms                |
| ProcessOneStep            | 104.177 ms                | 1.220 s                   |
| BlockToStepN              | 880.312 us                | 53.120 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:02.521486 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240204 14:43:02.837010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=13097
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.722 ms                  | 140.328 ms                |
| Forward                   | 5.555 ms                  | 21.557 ms                 |
| Backward                  | 6.125 ms                  | 11.409 ms                 |
| Optimize                  | 2.635 ms                  | 14.428 ms                 |
| BarrierTimeBeforeRank0    | 3.822 ms                  | 78.098 ms                 |
| AfterBackward             | 104.576 ms                | 1.220 s                   |
| BlockToStepN              | 983.270 us                | 53.272 ms                 |
| OneStep                   | 149.857 ms                | 1.256 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:03.004060 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=189, pq.top=189
W20240204 14:43:03.539140 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end6
E20240204 14:43:03.837014 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=10682
W20240204 14:43:04.042551 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=191, pq.top=191
W20240204 14:43:04.543686 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
E20240204 14:43:04.837013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=667
W20240204 14:43:05.597880 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
[proc 0] 200 steps, total: 20.298, sample: 1.086, forward: 0.540, backward: 0.703, update: 0.328
[proc 7] 200 steps, total: 20.299, sample: 1.188, forward: 0.590, backward: 0.677, update: 0.258
[proc 1] 200 steps, total: 20.298, sample: 1.044, forward: 0.553, backward: 0.670, update: 0.308
[proc 5] 200 steps, total: 20.299, sample: 1.148, forward: 0.559, backward: 0.661, update: 0.255
[proc 4] 200 steps, total: 20.298, sample: 1.460, forward: 0.625, backward: 0.701, update: 0.284
[proc 6] 200 steps, total: 20.299, sample: 1.387, forward: 0.601, backward: 0.654, update: 0.292
[proc 3] 200 steps, total: 20.299, sample: 1.193, forward: 0.582, backward: 0.690, update: 0.323
[proc 2] 200 steps, total: 20.298, sample: 1.135, forward: 0.589, backward: 0.665, update: 0.294
E20240204 14:43:05.866873 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 14:43:06.041851 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=201, pq.top=201
W20240204 14:43:06.651706 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end5
E20240204 14:43:06.866010 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=1488
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 467.850 us                | 8.428 ms                  |
| ProcessBack:Shuffle       | 8.863 ms                  | 25.493 ms                 |
| ProcessBack:UpdateCache   | 10.530 ms                 | 30.016 ms                 |
| ProcessBack:UpsertPq      | 38.217 ms                 | 177.955 ms                |
| ProcessOneStep            | 104.051 ms                | 1.220 s                   |
| BlockToStepN              | 936.151 us                | 53.238 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:07.147733 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=209, pq.top=209
E20240204 14:43:07.663782 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=213, sample_step_cpp_seen_[rank]=212
W20240204 14:43:07.771988 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.294 ms                  | 140.328 ms                |
| Forward                   | 5.578 ms                  | 21.557 ms                 |
| Backward                  | 6.329 ms                  | 11.409 ms                 |
| Optimize                  | 2.635 ms                  | 14.428 ms                 |
| BarrierTimeBeforeRank0    | 3.313 ms                  | 78.098 ms                 |
| AfterBackward             | 104.094 ms                | 1.220 s                   |
| BlockToStepN              | 1.043 ms                  | 53.370 ms                 |
| OneStep                   | 146.829 ms                | 1.256 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:07.866008 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=6718
W20240204 14:43:08.480590 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=214, pq.top=214
W20240204 14:43:08.783072 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end0
E20240204 14:43:08.866031 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=497
W20240204 14:43:09.558111 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=221, pq.top=220
W20240204 14:43:09.806080 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end7
E20240204 14:43:09.867276 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=12064
E20240204 14:43:10.867010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1046
W20240204 14:43:10.947365 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end5
W20240204 14:43:11.685400 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=231, pq.top=231
E20240204 14:43:11.867009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=6651
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 465.296 us                | 6.531 ms                  |
| ProcessBack:Shuffle       | 8.861 ms                  | 25.415 ms                 |
| ProcessBack:UpdateCache   | 10.372 ms                 | 25.805 ms                 |
| ProcessBack:UpsertPq      | 36.625 ms                 | 177.955 ms                |
| ProcessOneStep            | 103.747 ms                | 1.220 s                   |
| BlockToStepN              | 1.044 ms                  | 57.986 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:12.000211 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
W20240204 14:43:12.685400 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=239, pq.top=239
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.868 ms                  | 140.328 ms                |
| Forward                   | 5.518 ms                  | 31.995 ms                 |
| Backward                  | 6.336 ms                  | 11.409 ms                 |
| Optimize                  | 2.648 ms                  | 14.428 ms                 |
| BarrierTimeBeforeRank0    | 3.554 ms                  | 87.560 ms                 |
| AfterBackward             | 102.962 ms                | 1.220 s                   |
| BlockToStepN              | 1.241 ms                  | 58.110 ms                 |
| OneStep                   | 145.508 ms                | 1.256 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:12.867008 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=5476
E20240204 14:43:12.980894 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=241, sample_step_cpp_seen_[rank]=240
W20240204 14:43:13.028159 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
W20240204 14:43:13.828168 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=243, pq.top=243
E20240204 14:43:13.872486 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1966
W20240204 14:43:14.034355 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end5
E20240204 14:43:14.872011 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=45
W20240204 14:43:15.046936 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end3
W20240204 14:43:15.062050 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=251, pq.top=251
E20240204 14:43:15.872015 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=4880
W20240204 14:43:16.260407 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240204 14:43:16.872009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=18329
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 381.864 us                | 7.209 ms                  |
| ProcessBack:Shuffle       | 8.847 ms                  | 25.415 ms                 |
| ProcessBack:UpdateCache   | 10.343 ms                 | 25.805 ms                 |
| ProcessBack:UpsertPq      | 34.928 ms                 | 177.955 ms                |
| ProcessOneStep            | 102.225 ms                | 1.165 s                   |
| BlockToStepN              | 1.214 ms                  | 53.238 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:17.037174 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=259, pq.top=259
W20240204 14:43:17.342083 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.748 ms                  | 135.547 ms                |
| Forward                   | 5.517 ms                  | 21.557 ms                 |
| Backward                  | 6.494 ms                  | 11.232 ms                 |
| Optimize                  | 2.638 ms                  | 8.195 ms                  |
| BarrierTimeBeforeRank0    | 3.822 ms                  | 87.560 ms                 |
| AfterBackward             | 101.781 ms                | 1.165 s                   |
| BlockToStepN              | 1.348 ms                  | 53.370 ms                 |
| OneStep                   | 145.959 ms                | 1.242 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:17.872009 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=630
W20240204 14:43:18.184571 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=267, pq.top=267
E20240204 14:43:18.227845 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=6, step_no=267, sample_step_cpp_seen_[rank]=266
W20240204 14:43:18.485121 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
E20240204 14:43:18.872375 51386 parallel_pq_v2.h:79] insert failed, size(hashtable)=31
W20240204 14:43:19.424091 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=269, pq.top=269
W20240204 14:43:19.514632 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end6
E20240204 14:43:19.872009 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=17249
W20240204 14:43:20.559939 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
E20240204 14:43:20.872011 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=5659
W20240204 14:43:21.426635 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=278, pq.top=278
W20240204 14:43:21.585711 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240204 14:43:21.872011 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=12939
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 453.687 us                | 9.398 ms                  |
| ProcessBack:Shuffle       | 8.818 ms                  | 22.397 ms                 |
| ProcessBack:UpdateCache   | 10.242 ms                 | 25.274 ms                 |
| ProcessBack:UpsertPq      | 36.607 ms                 | 173.923 ms                |
| ProcessOneStep            | 102.294 ms                | 1.165 s                   |
| BlockToStepN              | 1.357 ms                  | 53.238 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:22.452692 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=285, pq.top=285
W20240204 14:43:22.611495 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.612 ms                  | 135.547 ms                |
| Forward                   | 5.555 ms                  | 21.557 ms                 |
| Backward                  | 7.075 ms                  | 11.232 ms                 |
| Optimize                  | 2.638 ms                  | 9.516 ms                  |
| BarrierTimeBeforeRank0    | 3.323 ms                  | 87.560 ms                 |
| AfterBackward             | 102.384 ms                | 1.165 s                   |
| BlockToStepN              | 1.456 ms                  | 53.370 ms                 |
| OneStep                   | 145.959 ms                | 1.242 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:22.872013 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=899
E20240204 14:43:23.227011 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=289, sample_step_cpp_seen_[rank]=288
W20240204 14:43:23.640486 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end2
E20240204 14:43:23.872012 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=10831
W20240204 14:43:24.437242 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=294, pq.top=293
W20240204 14:43:24.745515 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
E20240204 14:43:24.872012 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=26
[proc 0] 300 steps, total: 19.488, sample: 0.984, forward: 0.594, backward: 0.738, update: 0.303
[proc 1] 300 steps, total: 19.488, sample: 1.149, forward: 0.523, backward: 0.682, update: 0.253
[proc 2] 300 steps, total: 19.488, sample: 1.352, forward: 0.576, backward: 0.655, update: 0.257
[proc 3] 300 steps, total: 19.488, sample: 1.310, forward: 0.558, backward: 0.761, update: 0.253
[proc 4] 300 steps, total: 19.488, sample: 1.198, forward: 0.549, backward: 0.692, update: 0.255
[proc 6] 300 steps, total: 19.488, sample: 1.352, forward: 0.589, backward: 0.713, update: 0.270
[proc 5] 300 steps, total: 19.488, sample: 1.249, forward: 0.602, backward: 0.681, update: 0.273
[proc 7] 300 steps, total: 19.488, sample: 1.148, forward: 0.558, backward: 0.742, update: 0.255
E20240204 14:43:25.872010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=14
W20240204 14:43:25.880496 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
E20240204 14:43:26.872015 51402 parallel_pq_v2.h:79] insert failed, size(hashtable)=29534
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 524.201 us                | 11.594 ms                 |
| ProcessBack:Shuffle       | 8.818 ms                  | 22.397 ms                 |
| ProcessBack:UpdateCache   | 10.152 ms                 | 25.274 ms                 |
| ProcessBack:UpsertPq      | 36.573 ms                 | 173.923 ms                |
| ProcessOneStep            | 102.899 ms                | 1.165 s                   |
| BlockToStepN              | 1.396 ms                  | 53.238 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:26.921129 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end2
W20240204 14:43:27.428575 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=309, pq.top=309
E20240204 14:43:27.872020 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=3457
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.611 ms                  | 135.547 ms                |
| Forward                   | 5.564 ms                  | 21.557 ms                 |
| Backward                  | 6.846 ms                  | 11.232 ms                 |
| Optimize                  | 2.638 ms                  | 9.516 ms                  |
| BarrierTimeBeforeRank0    | 3.181 ms                  | 87.560 ms                 |
| AfterBackward             | 102.384 ms                | 1.165 s                   |
| BlockToStepN              | 1.503 ms                  | 53.370 ms                 |
| OneStep                   | 144.733 ms                | 1.242 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:27.980203 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
E20240204 14:43:28.271495 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=6, step_no=313, sample_step_cpp_seen_[rank]=312
E20240204 14:43:28.872071 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=4961
W20240204 14:43:29.014545 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 14:43:29.172132 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=315, pq.top=315
E20240204 14:43:29.872012 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=24
W20240204 14:43:30.055462 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
W20240204 14:43:30.216801 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=323, pq.top=323
E20240204 14:43:30.872011 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=4546
W20240204 14:43:31.113430 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
W20240204 14:43:31.613293 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=326, pq.top=326
E20240204 14:43:31.872017 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=451
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 524.977 us                | 15.451 ms                 |
| ProcessBack:Shuffle       | 8.885 ms                  | 22.038 ms                 |
| ProcessBack:UpdateCache   | 10.128 ms                 | 24.033 ms                 |
| ProcessBack:UpsertPq      | 33.194 ms                 | 171.789 ms                |
| ProcessOneStep            | 102.225 ms                | 1.165 s                   |
| BlockToStepN              | 1.460 ms                  | 53.238 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:32.161863 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
W20240204 14:43:32.617130 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=331, pq.top=331
E20240204 14:43:32.872015 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=35841
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.713 ms                  | 192.142 ms                |
| Forward                   | 5.598 ms                  | 21.557 ms                 |
| Backward                  | 6.565 ms                  | 11.232 ms                 |
| Optimize                  | 2.638 ms                  | 9.516 ms                  |
| BarrierTimeBeforeRank0    | 2.876 ms                  | 87.560 ms                 |
| AfterBackward             | 102.287 ms                | 1.165 s                   |
| BlockToStepN              | 1.579 ms                  | 53.370 ms                 |
| OneStep                   | 145.959 ms                | 1.242 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:33.282702 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
E20240204 14:43:33.448321 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=4, step_no=337, sample_step_cpp_seen_[rank]=336
E20240204 14:43:33.878826 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 14:43:34.335592 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 14:43:34.670548 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=339, pq.top=339
E20240204 14:43:34.878007 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=17255
W20240204 14:43:35.511708 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
E20240204 14:43:35.878011 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=1479
W20240204 14:43:35.893309 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=347, pq.top=347
W20240204 14:43:36.630874 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
E20240204 14:43:36.878013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=34
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 556.603 us                | 14.441 ms                 |
| ProcessBack:Shuffle       | 8.871 ms                  | 22.038 ms                 |
| ProcessBack:UpdateCache   | 10.098 ms                 | 24.033 ms                 |
| ProcessBack:UpsertPq      | 34.709 ms                 | 171.789 ms                |
| ProcessOneStep            | 101.731 ms                | 1.165 s                   |
| BlockToStepN              | 1.550 ms                  | 53.238 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:37.168666 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=351, pq.top=351
W20240204 14:43:37.630429 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.868 ms                  | 165.405 ms                |
| Forward                   | 5.598 ms                  | 14.460 ms                 |
| Backward                  | 6.488 ms                  | 11.229 ms                 |
| Optimize                  | 2.635 ms                  | 8.195 ms                  |
| BarrierTimeBeforeRank0    | 2.737 ms                  | 85.020 ms                 |
| AfterBackward             | 102.287 ms                | 1.127 s                   |
| BlockToStepN              | 1.670 ms                  | 53.272 ms                 |
| OneStep                   | 146.394 ms                | 1.196 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:37.878010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=4603
W20240204 14:43:38.280375 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=359, pq.top=359
E20240204 14:43:38.575215 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=360, sample_step_cpp_seen_[rank]=359
W20240204 14:43:38.766603 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
E20240204 14:43:38.878010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=2615
W20240204 14:43:39.544873 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=361, pq.top=361
W20240204 14:43:39.804293 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end3
E20240204 14:43:39.878010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=50574
W20240204 14:43:40.697235 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=371, pq.top=371
E20240204 14:43:40.878016 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1157
W20240204 14:43:41.009490 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end5
W20240204 14:43:41.799813 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=373, pq.top=373
E20240204 14:43:41.878010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=7961
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 542.626 us                | 12.215 ms                 |
| ProcessBack:Shuffle       | 8.914 ms                  | 22.589 ms                 |
| ProcessBack:UpdateCache   | 10.169 ms                 | 24.033 ms                 |
| ProcessBack:UpsertPq      | 34.709 ms                 | 171.789 ms                |
| ProcessOneStep            | 102.225 ms                | 1.127 s                   |
| BlockToStepN              | 1.664 ms                  | 53.120 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:42.031020 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
W20240204 14:43:42.841835 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=380, pq.top=380
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.053 ms                  | 180.738 ms                |
| Forward                   | 5.566 ms                  | 14.460 ms                 |
| Backward                  | 6.405 ms                  | 11.229 ms                 |
| Optimize                  | 2.625 ms                  | 8.195 ms                  |
| BarrierTimeBeforeRank0    | 2.498 ms                  | 85.020 ms                 |
| AfterBackward             | 102.287 ms                | 1.127 s                   |
| BlockToStepN              | 1.786 ms                  | 53.272 ms                 |
| OneStep                   | 146.394 ms                | 1.196 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:42.878010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=5
W20240204 14:43:43.185415 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240204 14:43:43.575007 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=384, sample_step_cpp_seen_[rank]=383
E20240204 14:43:43.878012 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=12745
W20240204 14:43:44.235370 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
W20240204 14:43:44.427681 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=385, pq.top=385
E20240204 14:43:44.878015 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=76899
W20240204 14:43:45.319244 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
W20240204 14:43:45.761598 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=393, pq.top=393
E20240204 14:43:45.878010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=3960
W20240204 14:43:46.393009 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240204 14:43:46.878013 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=884
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 510.570 us                | 9.642 ms                  |
| ProcessBack:Shuffle       | 9.001 ms                  | 22.397 ms                 |
| ProcessBack:UpdateCache   | 10.249 ms                 | 24.031 ms                 |
| ProcessBack:UpsertPq      | 34.027 ms                 | 170.842 ms                |
| ProcessOneStep            | 102.899 ms                | 1.127 s                   |
| BlockToStepN              | 1.698 ms                  | 57.986 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:47.443341 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
W20240204 14:43:47.670475 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=399, pq.top=399
[proc 7] 400 steps, total: 22.553, sample: 1.154, forward: 0.597, backward: 0.668, update: 0.281
[proc 1] 400 steps, total: 22.553, sample: 1.186, forward: 0.656, backward: 0.666, update: 0.285
[proc 3] 400 steps, total: 22.553, sample: 1.192, forward: 0.565, backward: 0.830, update: 0.310
[proc 4] 400 steps, total: 22.553, sample: 1.068, forward: 0.620, backward: 0.645, update: 0.259
[proc 5] 400 steps, total: 22.553, sample: 0.982, forward: 0.593, backward: 0.639, update: 0.270
[proc 2] 400 steps, total: 22.553, sample: 1.071, forward: 0.570, backward: 0.726, update: 0.266
[proc 0] 400 steps, total: 22.553, sample: 2.472, forward: 0.574, backward: 0.608, update: 0.271
[proc 6] 400 steps, total: 22.553, sample: 1.279, forward: 0.600, backward: 0.741, update: 0.289
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.111 ms                  | 180.738 ms                |
| Forward                   | 5.596 ms                  | 14.460 ms                 |
| Backward                  | 6.329 ms                  | 11.229 ms                 |
| Optimize                  | 2.602 ms                  | 8.195 ms                  |
| BarrierTimeBeforeRank0    | 2.445 ms                  | 85.020 ms                 |
| AfterBackward             | 102.963 ms                | 1.165 s                   |
| BlockToStepN              | 1.816 ms                  | 58.110 ms                 |
| OneStep                   | 147.883 ms                | 1.210 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:47.879690 51402 parallel_pq_v2.h:79] insert failed, size(hashtable)=16994
W20240204 14:43:48.513995 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end4
W20240204 14:43:48.673429 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=405, pq.top=405
E20240204 14:43:48.879015 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=236
W20240204 14:43:49.738162 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
E20240204 14:43:49.879014 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=211
W20240204 14:43:49.897948 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=411, pq.top=411
E20240204 14:43:49.949767 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=411, sample_step_cpp_seen_[rank]=410
W20240204 14:43:50.742043 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240204 14:43:50.879015 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=8918
W20240204 14:43:51.072515 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=413, pq.top=413
W20240204 14:43:51.826550 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end3
E20240204 14:43:51.879009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=36063
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 550.550 us                | 6.970 ms                  |
| ProcessBack:Shuffle       | 9.087 ms                  | 22.397 ms                 |
| ProcessBack:UpdateCache   | 10.320 ms                 | 24.031 ms                 |
| ProcessBack:UpsertPq      | 34.315 ms                 | 171.789 ms                |
| ProcessOneStep            | 102.899 ms                | 1.165 s                   |
| BlockToStepN              | 1.801 ms                  | 65.837 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:52.140444 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=421, pq.top=421
W20240204 14:43:52.857928 51030 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.223 ms                  | 180.738 ms                |
| Forward                   | 5.602 ms                  | 14.460 ms                 |
| Backward                  | 6.407 ms                  | 11.232 ms                 |
| Optimize                  | 2.617 ms                  | 8.195 ms                  |
| BarrierTimeBeforeRank0    | 2.334 ms                  | 85.020 ms                 |
| AfterBackward             | 102.962 ms                | 1.165 s                   |
| BlockToStepN              | 1.921 ms                  | 65.983 ms                 |
| OneStep                   | 148.917 ms                | 1.210 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:52.879009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=4837
W20240204 14:43:53.691884 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=425, pq.top=425
W20240204 14:43:53.874154 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end3
E20240204 14:43:53.879743 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 14:43:54.725991 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=433, pq.top=433
E20240204 14:43:54.879009 45318 parallel_pq_v2.h:79] insert failed, size(hashtable)=6201
W20240204 14:43:54.925262 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
E20240204 14:43:55.021751 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=435, sample_step_cpp_seen_[rank]=434
E20240204 14:43:55.879010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=29815
W20240204 14:43:55.938414 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=437, pq.top=437
W20240204 14:43:55.938907 51030 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240204 14:43:56.879010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=45836
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 670.973 us                | 34.343 ms                 |
| ProcessBack:Shuffle       | 9.146 ms                  | 22.038 ms                 |
| ProcessBack:UpdateCache   | 10.343 ms                 | 23.193 ms                 |
| ProcessBack:UpsertPq      | 33.194 ms                 | 170.842 ms                |
| ProcessOneStep            | 102.225 ms                | 1.165 s                   |
| BlockToStepN              | 1.905 ms                  | 65.837 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:43:56.968739 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end5
W20240204 14:43:57.027673 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=445, pq.top=445
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.371 ms                  | 180.738 ms                |
| Forward                   | 5.564 ms                  | 14.460 ms                 |
| Backward                  | 6.491 ms                  | 11.232 ms                 |
| Optimize                  | 2.589 ms                  | 8.195 ms                  |
| BarrierTimeBeforeRank0    | 2.374 ms                  | 85.020 ms                 |
| AfterBackward             | 102.287 ms                | 1.165 s                   |
| BlockToStepN              | 2.017 ms                  | 66.815 ms                 |
| OneStep                   | 147.915 ms                | 1.210 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:43:57.879010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240204 14:43:57.972029 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
W20240204 14:43:58.201874 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=449, pq.top=449
E20240204 14:43:58.879009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=133
W20240204 14:43:58.978384 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
W20240204 14:43:59.340667 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=457, pq.top=456
E20240204 14:43:59.879043 51392 parallel_pq_v2.h:79] insert failed, size(hashtable)=20791
W20240204 14:44:00.024089 51030 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240204 14:44:00.040985 48137 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=462, sample_step_cpp_seen_[rank]=461
E20240204 14:44:00.879010 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=10936
W20240204 14:44:01.049988 51030 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 14:44:01.130570 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=465, pq.top=465
E20240204 14:44:01.879009 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=105495
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 602.054 us                | 47.154 ms                 |
| ProcessBack:Shuffle       | 9.083 ms                  | 22.038 ms                 |
| ProcessBack:UpdateCache   | 10.241 ms                 | 23.193 ms                 |
| ProcessBack:UpsertPq      | 32.893 ms                 | 170.842 ms                |
| ProcessOneStep            | 100.392 ms                | 1.127 s                   |
| BlockToStepN              | 1.999 ms                  | 76.796 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 14:44:02.085350 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
W20240204 14:44:02.130445 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=473, pq.top=472
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.477 ms                  | 167.258 ms                |
| Forward                   | 5.518 ms                  | 10.670 ms                 |
| Backward                  | 6.490 ms                  | 11.229 ms                 |
| Optimize                  | 2.586 ms                  | 7.329 ms                  |
| BarrierTimeBeforeRank0    | 2.009 ms                  | 84.340 ms                 |
| AfterBackward             | 100.187 ms                | 1.127 s                   |
| BlockToStepN              | 2.146 ms                  | 91.079 ms                 |
| OneStep                   | 146.829 ms                | 1.196 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:44:02.879132 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=5035
W20240204 14:44:03.202761 51030 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
E20240204 14:44:03.879015 51394 parallel_pq_v2.h:79] insert failed, size(hashtable)=73491
W20240204 14:44:03.968730 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=481, pq.top=481
W20240204 14:44:04.210258 51030 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end3
E20240204 14:44:04.879019 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=45871
W20240204 14:44:05.177753 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=489, pq.top=489
W20240204 14:44:05.326376 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
E20240204 14:44:05.398572 45318 grad_async_v2.h:404] Stalled in ProcessBackward: rank=7, step_no=490, sample_step_cpp_seen_[rank]=489
E20240204 14:44:05.879014 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=1025
W20240204 14:44:06.340075 51030 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240204 14:44:06.531147 45318 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=493, pq.top=493
E20240204 14:44:06.879011 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=12509
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 654.171 us                | 33.254 ms                 |
| ProcessBack:Shuffle       | 9.069 ms                  | 21.156 ms                 |
| ProcessBack:UpdateCache   | 10.241 ms                 | 20.475 ms                 |
| ProcessBack:UpsertPq      | 32.509 ms                 | 166.609 ms                |
| ProcessOneStep            | 99.687 ms                 | 1.127 s                   |
| BlockToStepN              | 2.177 ms                  | 95.110 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 0] 500 steps, total: 19.413, sample: 1.702, forward: 0.552, backward: 0.700, update: 0.284
[proc 7] 500 steps, total: 19.413, sample: 1.185, forward: 0.618, backward: 0.642, update: 0.291
[proc 4] 500 steps, total: 19.413, sample: 1.185, forward: 0.588, backward: 0.724, update: 0.267
[proc 6] 500 steps, total: 19.413, sample: 1.139, forward: 0.582, backward: 0.624, update: 0.259
[proc 3] 500 steps, total: 19.413, sample: 1.062, forward: 0.560, backward: 0.652, update: 0.251
Successfully xmh. training takes 111.34429574012756 seconds
[proc 2] 500 steps, total: 19.413, sample: 1.065, forward: 0.562, backward: 0.612, update: 0.261
before call kg_cache_controller.StopThreads()
[proc 1] 500 steps, total: 19.413, sample: 1.157, forward: 0.630, backward: 0.691, update: 0.278
[proc 5] 500 steps, total: 19.413, sample: 1.129, forward: 0.625, backward: 0.718, update: 0.278
W20240204 14:44:07.279153 45318 grad_async_v2.h:84] call StopThreads. PID = 18197
W20240204 14:44:07.279188 45318 grad_base.h:212] before processOneStepNegThread_.join();
W20240204 14:44:07.279553 45318 grad_base.h:214] after processOneStepNegThread_.join();
W20240204 14:44:07.279563 45318 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240204 14:44:07.459914 51030 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.546 ms                  | 167.258 ms                |
| Forward                   | 5.517 ms                  | 10.670 ms                 |
| Backward                  | 6.434 ms                  | 11.229 ms                 |
| Optimize                  | 2.573 ms                  | 8.195 ms                  |
| BarrierTimeBeforeRank0    | 2.000 ms                  | 84.340 ms                 |
| AfterBackward             | 99.750 ms                 | 1.127 s                   |
| BlockToStepN              | 2.304 ms                  | 95.376 ms                 |
| OneStep                   | 145.732 ms                | 1.196 s                   |
+---------------------------+---------------------------+---------------------------+
E20240204 14:44:07.879012 51030 parallel_pq_v2.h:79] insert failed, size(hashtable)=924
W20240204 14:44:07.990118 45318 grad_async_v2.h:105] StopThreads done.

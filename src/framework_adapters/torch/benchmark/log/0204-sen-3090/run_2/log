WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240204 10:07:34.615844 11320 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_108', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=4, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [11320 sampler.py:454] Start PreSampling
WARNING [11320 sampler.py:532] Before construct renumbering_dict
WARNING [11320 sampler.py:555] PreSampling done
W20240204 10:07:40.157562 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240204 10:07:40.157752 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240204 10:07:40.157805 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240204 10:07:40.157850 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240204 10:07:40.157897 11320 IPCTensor.h:369] NewIPCTensor: step_r0 [4]0x100001e8e000 32 B 
W20240204 10:07:40.157929 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100001e90000 8 B 
W20240204 10:07:40.157960 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100001e92000 8 B 
W20240204 10:07:40.158141 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100001e94000 7.629 MB
W20240204 10:07:40.158195 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100002637000 7.629 MB
W20240204 10:07:40.158250 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100002dda000 7.629 MB
W20240204 10:07:40.158285 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000357d000 7.629 MB
W20240204 10:07:40.158319 11320 IPCTensor.h:369] NewIPCTensor: step_r1 [4]0x100003d20000 32 B 
W20240204 10:07:40.158349 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x100003d22000 8 B 
W20240204 10:07:40.158377 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100003d24000 8 B 
W20240204 10:07:40.158440 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x100003d26000 7.629 MB
W20240204 10:07:40.158488 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x1000044c9000 7.629 MB
W20240204 10:07:40.158545 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x100004c6c000 7.629 MB
W20240204 10:07:40.158586 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000540f000 7.629 MB
W20240204 10:07:40.158622 11320 IPCTensor.h:369] NewIPCTensor: step_r2 [4]0x100005bb2000 32 B 
W20240204 10:07:40.158650 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x100005bb4000 8 B 
W20240204 10:07:40.158679 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100005bb6000 8 B 
W20240204 10:07:40.158739 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x100005bb8000 7.629 MB
W20240204 10:07:40.158782 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000635b000 7.629 MB
W20240204 10:07:40.158823 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x100006afe000 7.629 MB
W20240204 10:07:40.158855 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x1000072a1000 7.629 MB
W20240204 10:07:40.158888 11320 IPCTensor.h:369] NewIPCTensor: step_r3 [4]0x100007a44000 32 B 
W20240204 10:07:40.158916 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x100007a46000 8 B 
W20240204 10:07:40.158946 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100007a48000 8 B 
W20240204 10:07:40.159004 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100007a4a000 7.629 MB
W20240204 10:07:40.159042 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x1000081ed000 7.629 MB
W20240204 10:07:40.159078 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x100008990000 7.629 MB
W20240204 10:07:40.159111 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x100009133000 7.629 MB
W20240204 10:07:40.159143 11320 IPCTensor.h:369] NewIPCTensor: step_r4 [4]0x1000098d6000 32 B 
W20240204 10:07:40.159173 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x1000098d8000 8 B 
W20240204 10:07:40.159200 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x1000098da000 8 B 
W20240204 10:07:40.159260 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x1000098dc000 7.629 MB
W20240204 10:07:40.159304 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x10000a07f000 7.629 MB
W20240204 10:07:40.159343 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x10000a822000 7.629 MB
W20240204 10:07:40.159376 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x10000afc5000 7.629 MB
W20240204 10:07:40.159416 11320 IPCTensor.h:369] NewIPCTensor: step_r5 [4]0x10000b768000 32 B 
W20240204 10:07:40.159446 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10000b76a000 8 B 
W20240204 10:07:40.159473 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10000b76c000 8 B 
W20240204 10:07:40.159531 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x10000b76e000 7.629 MB
W20240204 10:07:40.159574 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x10000bf11000 7.629 MB
W20240204 10:07:40.159618 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_2 [1000000]0x10000c6b4000 7.629 MB
W20240204 10:07:40.159653 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_3 [1000000]0x10000ce57000 7.629 MB
W20240204 10:07:40.159690 11320 IPCTensor.h:369] NewIPCTensor: step_r6 [4]0x10000d5fa000 32 B 
W20240204 10:07:40.159719 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x10000d5fc000 8 B 
W20240204 10:07:40.159754 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x10000d5fe000 8 B 
W20240204 10:07:40.159816 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_0 [1000000]0x10000d600000 7.629 MB
W20240204 10:07:40.159862 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_1 [1000000]0x10000dda3000 7.629 MB
W20240204 10:07:40.159902 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_2 [1000000]0x10000e546000 7.629 MB
W20240204 10:07:40.159938 11320 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_3 [1000000]0x10000ece9000 7.629 MB
W20240204 10:07:40.159981 11320 IPCTensor.h:369] NewIPCTensor: step_r7 [4]0x10000f48c000 32 B 
W20240204 10:07:40.160009 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r7 [1]0x10000f48e000 8 B 
W20240204 10:07:40.160041 11320 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x10000f490000 8 B 
W20240204 10:07:40.407168 11320 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x10000f492000 22.81 MB
W20240204 10:07:40.498647 11320 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100010b64000 58.4 kB
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([ 744, 1114, 1638,  ..., 9373, 8894, 7115]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.981 seconds
[Rank1] pid = 11743
[Rank2] pid = 11768
[Rank3] pid = 11810
[Rank4] pid = 11873
[Rank5] pid = 11954
[Rank6] pid = 12001
INFO [11320 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [11743 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [11768 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [11810 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [11873 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [12001 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [11954 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [12134 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [12001 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [12134 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11954 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11873 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11810 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240204 10:07:43.134392 12004 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_6 [747, 400]; dev=6; size=1.14 MB
W20240204 10:07:43.136144 12150 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_7 [747, 400]; dev=7; size=1.14 MB
W20240204 10:07:43.136217 11937 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
W20240204 10:07:43.136220 12002 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240204 10:07:43.136507 11874 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
INFO [11768 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11743 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11320 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240204 10:07:43.138594 12135 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240204 10:07:43.139366 11809 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240204 10:07:43.139935 11744 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240204 10:07:43.174070 12150 IPCTensor.h:369] NewIPCTensor: input_keys_7 [1000000]0x100010b78000 7.629 MB
W20240204 10:07:43.174250 12004 IPCTensor.h:369] NewIPCTensor: input_keys_6 [1000000]0x10001131b000 7.629 MB
W20240204 10:07:43.174348 12150 IPCTensor.h:369] NewIPCTensor: input_keys_neg_7 [1000000]0x100011abe000 7.629 MB
W20240204 10:07:43.174484 12150 IPCTensor.h:369] NewIPCTensor: backward_grads_7 [1000000, 400]0x100012265000 1.49 GB
W20240204 10:07:43.174540 12150 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_7 [1000000, 400]0x10007184a000 1.49 GB
W20240204 10:07:43.174592 12150 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 10:07:43.174616 12004 IPCTensor.h:369] NewIPCTensor: input_keys_neg_6 [1000000]0x1000d0e2f000 7.629 MB
W20240204 10:07:43.174626 12002 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x1000d15d2000 7.629 MB
W20240204 10:07:43.174674 11937 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x1000d1d75000 7.629 MB
W20240204 10:07:43.174770 12135 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000d2cbb000 7.629 MB
W20240204 10:07:43.174768 11809 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1000d2518000 7.629 MB
W20240204 10:07:43.174794 12002 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x1000d345e000 7.629 MB
W20240204 10:07:43.174827 11937 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x1000d3c01000 7.629 MB
W20240204 10:07:43.174899 12135 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1000d43a4000 7.629 MB
W20240204 10:07:43.174963 11809 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1000d4b47000 7.629 MB
W20240204 10:07:43.174966 12135 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000d52ea000 1.49 GB
W20240204 10:07:43.175027 12135 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1001348cd000 1.49 GB
W20240204 10:07:43.176249 11937 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x100193eb0000 1.49 GB
W20240204 10:07:43.176249 12135 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 10:07:43.176278 12002 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x1001f3493000 1.49 GB
W20240204 10:07:43.176317 11937 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x100252a76000 1.49 GB
W20240204 10:07:43.176348 12002 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x1002b2059000 1.49 GB
W20240204 10:07:43.176393 12002 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 10:07:43.176393 11937 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 10:07:43.176429 11809 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x10031163c000 1.49 GB
W20240204 10:07:43.176472 12004 IPCTensor.h:369] NewIPCTensor: backward_grads_6 [1000000, 400]0x100370c1f000 1.49 GB
W20240204 10:07:43.176491 11809 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1003d0202000 1.49 GB
W20240204 10:07:43.176548 11809 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 10:07:43.176556 12004 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_6 [1000000, 400]0x10042f7e5000 1.49 GB
W20240204 10:07:43.176607 12004 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 10:07:43.185056 12150 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 10:07:43.185243 11874 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x10048edce000 7.629 MB
W20240204 10:07:43.185442 11874 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x10048f571000 7.629 MB
W20240204 10:07:43.185470 11744 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10048fd14000 7.629 MB
W20240204 10:07:43.185529 11874 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1004904b7000 1.49 GB
W20240204 10:07:43.185575 11874 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1004efa9a000 1.49 GB
W20240204 10:07:43.185591 11744 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x10054f07d000 7.629 MB
W20240204 10:07:43.185631 11874 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240204 10:07:43.185662 11744 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10054f820000 1.49 GB
W20240204 10:07:43.185715 11744 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1005aee03000 1.49 GB
W20240204 10:07:43.185767 11744 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240204 10:07:43.186887 12135 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 10:07:43.186977 11809 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 10:07:43.186992 12002 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 10:07:43.187011 11937 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 10:07:43.190817 12004 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 10:07:43.199169 11744 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240204 10:07:43.199172 11874 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
cudaHostRegister 0x10000f492000
1: KnownLocalCachedEmbedding init done
cudaHostRegister 0x10000f492000
3: KnownLocalCachedEmbedding init done
WARNING [11743 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [11810 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000f492000
2: KnownLocalCachedEmbedding init done
WARNING [11768 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000f492000
7: KnownLocalCachedEmbedding init done
WARNING [12134 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000f492000
6: KnownLocalCachedEmbedding init done
WARNING [12001 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000f492000
4: KnownLocalCachedEmbedding init done
WARNING [11873 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000f492000
5: KnownLocalCachedEmbedding init done
WARNING [11954 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank7] pid = 12134
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
cudaHostRegister 0x10000f492000
0: KnownLocalCachedEmbedding init done
WARNING [11320 DistTensor.py:59] The tensor name already exists in the kvstore
I20240204 10:07:45.657083 12135 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240204 10:07:45.657415 11874 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:07:45.658035 12002 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:07:45.658129 11809 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:07:45.658453 12150 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:07:45.658677 11744 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:07:45.658815 12004 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:07:45.658955 11937 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240204 10:07:45.662335 12135 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 4,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240204 10:07:45.662473 12135 grad_base.h:184] Init GradProcessingBase done
I20240204 10:07:45.667024 12135 grad_async_v2.h:42] Use main thread to update emb.
W20240204 10:07:45.667074 12135 kg_controller.h:78] after init GradAsyncProcessingV2
I20240204 10:07:45.667083 12135 kg_controller.h:84] Construct KGCacheController done
E20240204 10:07:46.437682 12004 recstore.cc:66] init folly done
E20240204 10:07:46.437692 12150 recstore.cc:66] init folly done
E20240204 10:07:46.437909 11937 recstore.cc:66] init folly done
E20240204 10:07:46.437970 12002 recstore.cc:66] init folly done
E20240204 10:07:46.438063 11744 recstore.cc:66] init folly done
E20240204 10:07:46.438063 11809 recstore.cc:66] init folly done
E20240204 10:07:46.438097 11874 recstore.cc:66] init folly done
E20240204 10:07:46.438124 12135 recstore.cc:66] init folly done
I20240204 10:07:46.438997 12135 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240204 10:07:47.211328 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:07:47.211767 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240204 10:07:47.231884 12004 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240204 10:07:47.232285 11744 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:07:47.232354 12002 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:07:47.234025 11874 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:07:47.234131 12150 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:07:47.235716 11809 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:07:47.239467 11937 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:07:47.241446 12135 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240204 10:07:49.601444 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240204 10:07:49.640794 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 10:07:49.829771 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=4, pq.top=4
E20240204 10:07:50.016219 12135 grad_async_v2.h:404] Stalled in ProcessBackward: rank=4, step_no=7, sample_step_cpp_seen_[rank]=6
E20240204 10:07:50.601158 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=588
W20240204 10:07:50.644827 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.744 ms                  | 20.002 ms                 |
| Forward                   | 5.524 ms                  | 669.880 ms                |
| Backward                  | 4.196 ms                  | 255.681 ms                |
| Optimize                  | 2.073 ms                  | 5.200 ms                  |
| BarrierTimeBeforeRank0    | 1.503 ms                  | 13.098 ms                 |
| AfterBackward             | 40.257 ms                 | 1.461 s                   |
| BlockToStepN              | 635.556 us                | 3.055 ms                  |
| OneStep                   | 58.081 ms                 | 2.394 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 10:07:50.887792 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=18, pq.top=17
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 521.063 us                | 14.250 ms                 |
| ProcessBack:Shuffle       | 8.396 ms                  | 351.098 ms                |
| ProcessBack:UpdateCache   | 10.186 ms                 | 777.144 ms                |
| ProcessBack:UpsertPq      | 23.801 ms                 | 49.758 ms                 |
| ProcessOneStep            | 43.869 ms                 | 1.460 s                   |
| BlockToStepN              | 1.103 ms                  | 5.981 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240204 10:07:51.601235 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=486
W20240204 10:07:51.652081 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 10:07:51.892102 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=30, pq.top=30
E20240204 10:07:52.601058 13291 parallel_pq_v2.h:79] insert failed, size(hashtable)=9444
W20240204 10:07:52.654143 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:07:52.930210 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=43, pq.top=42
E20240204 10:07:53.604728 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=12
W20240204 10:07:53.654029 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:07:53.932152 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=56, pq.top=56
E20240204 10:07:54.604055 13289 parallel_pq_v2.h:79] insert failed, size(hashtable)=7246
W20240204 10:07:54.658512 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 10:07:54.985061 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=68, pq.top=68
E20240204 10:07:55.604039 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=786
W20240204 10:07:55.658820 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.430 ms                  | 32.781 ms                 |
| Forward                   | 5.163 ms                  | 13.390 ms                 |
| Backward                  | 3.837 ms                  | 10.261 ms                 |
| Optimize                  | 2.039 ms                  | 4.353 ms                  |
| BarrierTimeBeforeRank0    | 1.503 ms                  | 13.098 ms                 |
| AfterBackward             | 48.438 ms                 | 125.907 ms                |
| BlockToStepN              | 6.371 ms                  | 16.173 ms                 |
| OneStep                   | 75.937 ms                 | 152.222 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:07:56.041119 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=81, pq.top=81
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 743.985 us                | 12.281 ms                 |
| ProcessBack:Shuffle       | 7.976 ms                  | 16.160 ms                 |
| ProcessBack:UpdateCache   | 9.499 ms                  | 19.505 ms                 |
| ProcessBack:UpsertPq      | 28.454 ms                 | 49.082 ms                 |
| ProcessOneStep            | 48.393 ms                 | 125.864 ms                |
| BlockToStepN              | 7.410 ms                  | 16.006 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:07:56.604014 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=650
W20240204 10:07:56.660343 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:07:57.102883 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=94, pq.top=94
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 10.341, sample: 0.358, forward: 1.160, backward: 0.641, update: 0.180
train_sampler.Prefill()
-------Step 0-------
tensor([ 2003,    70,  3087,  3074, 12902, 13686,  1135,   439, 11732, 10385]) tensor([ 1638,  9344,  5773, 10883, 11052,  1057,   568,  5327,   503, 12340])
-------Step 1-------
tensor([ 2003,    70,  3087,  3074, 12902, 13686,  1135,   439, 11732, 10385]) tensor([ 3928,  9164, 14570,  1535,  1006,  7650, 14580,  8934,  5470, 11587])
-------Step 2-------
tensor([ 6591,  9748,  5550,  3567, 10740,  7680, 10827,    85, 11264,   908]) tensor([ 3497,  4993,  3471,  9021,  5771,  9621, 12294,  8602, 14157,  8731])
-------Step 3-------
tensor([ 6591,  9748,  5550,  3567, 10740,  7680, 10827,    85, 11264,   908]) tensor([ 8950,  6627,  7458, 11535,  7113,   695,  5031,  2165, 11246,  1992])
before start barrier
start train
[proc 0] 100 steps, total: 10.334, sample: 0.484, forward: 1.205, backward: 0.662, update: 0.210
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 10.344, sample: 0.375, forward: 1.171, backward: 0.672, update: 0.188
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 10.340, sample: 0.382, forward: 1.160, backward: 0.619, update: 0.187
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 10.343, sample: 0.333, forward: 1.161, backward: 0.716, update: 0.188
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 10.336, sample: 0.358, forward: 1.155, backward: 0.613, update: 0.187
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 10.341, sample: 0.340, forward: 1.130, backward: 0.632, update: 0.167
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 10.343, sample: 0.358, forward: 1.164, backward: 0.600, update: 0.168
E20240204 10:07:57.604063 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=6
W20240204 10:07:57.664311 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 10:07:58.118328 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=107, pq.top=107
E20240204 10:07:58.604028 13303 parallel_pq_v2.h:79] insert failed, size(hashtable)=9653
W20240204 10:07:58.696076 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:07:59.148465 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=120, pq.top=120
E20240204 10:07:59.604064 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=26
W20240204 10:07:59.701432 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:00.184564 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=132, pq.top=132
E20240204 10:08:00.604013 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=15
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.657 ms                  | 32.781 ms                 |
| Forward                   | 5.003 ms                  | 13.390 ms                 |
| Backward                  | 3.837 ms                  | 11.006 ms                 |
| Optimize                  | 1.974 ms                  | 5.200 ms                  |
| BarrierTimeBeforeRank0    | 1.377 ms                  | 20.895 ms                 |
| AfterBackward             | 47.956 ms                 | 125.907 ms                |
| BlockToStepN              | 10.439 ms                 | 16.847 ms                 |
| OneStep                   | 77.030 ms                 | 152.222 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:00.710513 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:01.191176 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=144, pq.top=144
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 506.535 us                | 12.873 ms                 |
| ProcessBack:Shuffle       | 7.825 ms                  | 15.839 ms                 |
| ProcessBack:UpdateCache   | 9.215 ms                  | 15.175 ms                 |
| ProcessBack:UpsertPq      | 29.139 ms                 | 49.082 ms                 |
| ProcessOneStep            | 47.567 ms                 | 125.864 ms                |
| BlockToStepN              | 10.725 ms                 | 16.777 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:08:01.604040 13272 parallel_pq_v2.h:79] insert failed, size(hashtable)=5700
W20240204 10:08:01.718776 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:02.264469 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=157, pq.top=157
E20240204 10:08:02.604009 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=85
W20240204 10:08:02.729800 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:03.273813 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=168, pq.top=168
E20240204 10:08:03.604009 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=102
W20240204 10:08:03.739337 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 10:08:04.273258 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=179, pq.top=179
E20240204 10:08:04.604008 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=3524
W20240204 10:08:04.746934 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:08:05.274150 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=190, pq.top=190
E20240204 10:08:05.604008 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=1685
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.735 ms                  | 25.597 ms                 |
| Forward                   | 4.846 ms                  | 10.150 ms                 |
| Backward                  | 3.783 ms                  | 10.474 ms                 |
| Optimize                  | 1.974 ms                  | 4.353 ms                  |
| BarrierTimeBeforeRank0    | 1.822 ms                  | 26.511 ms                 |
| AfterBackward             | 47.649 ms                 | 108.423 ms                |
| BlockToStepN              | 11.674 ms                 | 19.342 ms                 |
| OneStep                   | 80.121 ms                 | 144.486 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:05.749702 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
[proc 5] 200 steps, total: 8.569, sample: 0.359, forward: 0.494, backward: 0.542, update: 0.182
[proc 4] 200 steps, total: 8.569, sample: 0.438, forward: 0.511, backward: 0.460, update: 0.177
[proc 1] 200 steps, total: 8.569, sample: 0.356, forward: 0.476, backward: 0.416, update: 0.165
[proc 3] 200 steps, total: 8.569, sample: 0.335, forward: 0.464, backward: 0.457, update: 0.167
[proc 0] 200 steps, total: 8.569, sample: 0.506, forward: 0.477, backward: 0.407, update: 0.190
[proc 2] 200 steps, total: 8.569, sample: 0.390, forward: 0.496, backward: 0.434, update: 0.177
[proc 7] 200 steps, total: 8.569, sample: 0.355, forward: 0.511, backward: 0.464, update: 0.188
[proc 6] 200 steps, total: 8.569, sample: 0.330, forward: 0.467, backward: 0.627, update: 0.168
W20240204 10:08:06.312400 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=202, pq.top=202
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 542.550 us                | 14.934 ms                 |
| ProcessBack:Shuffle       | 7.676 ms                  | 13.781 ms                 |
| ProcessBack:UpdateCache   | 8.972 ms                  | 15.128 ms                 |
| ProcessBack:UpsertPq      | 29.640 ms                 | 49.082 ms                 |
| ProcessOneStep            | 47.567 ms                 | 108.368 ms                |
| BlockToStepN              | 11.667 ms                 | 19.269 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:08:06.607224 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=24
W20240204 10:08:06.751623 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 10:08:07.344085 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=214, pq.top=214
E20240204 10:08:07.607085 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=3
W20240204 10:08:07.781850 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:08.357753 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=225, pq.top=225
E20240204 10:08:08.607007 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=736
W20240204 10:08:08.782974 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
E20240204 10:08:08.946754 12135 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=231, sample_step_cpp_seen_[rank]=230
W20240204 10:08:09.359419 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=236, pq.top=236
E20240204 10:08:09.607008 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=1677
W20240204 10:08:09.820847 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
W20240204 10:08:10.422691 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=246, pq.top=246
E20240204 10:08:10.607017 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=1163
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.916 ms                  | 25.597 ms                 |
| Forward                   | 4.830 ms                  | 10.150 ms                 |
| Backward                  | 3.746 ms                  | 10.474 ms                 |
| Optimize                  | 1.968 ms                  | 4.353 ms                  |
| BarrierTimeBeforeRank0    | 2.111 ms                  | 26.511 ms                 |
| AfterBackward             | 47.700 ms                 | 125.907 ms                |
| BlockToStepN              | 11.900 ms                 | 21.212 ms                 |
| OneStep                   | 82.328 ms                 | 152.328 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:10.861160 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 421.316 us                | 12.529 ms                 |
| ProcessBack:Shuffle       | 7.711 ms                  | 13.679 ms                 |
| ProcessBack:UpdateCache   | 8.740 ms                  | 14.840 ms                 |
| ProcessBack:UpsertPq      | 29.915 ms                 | 49.197 ms                 |
| ProcessOneStep            | 47.838 ms                 | 113.704 ms                |
| BlockToStepN              | 11.793 ms                 | 20.220 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:11.473444 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=256, pq.top=256
E20240204 10:08:11.607160 13305 parallel_pq_v2.h:79] insert failed, size(hashtable)=12868
W20240204 10:08:11.864835 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 10:08:12.531682 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=267, pq.top=267
E20240204 10:08:12.607009 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=6037
W20240204 10:08:12.896607 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end3
W20240204 10:08:13.544458 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=277, pq.top=277
E20240204 10:08:13.607012 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=9012
W20240204 10:08:13.904556 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:08:14.544454 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=287, pq.top=287
E20240204 10:08:14.607009 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=1871
W20240204 10:08:14.937487 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 10:08:15.580917 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=299, pq.top=299
E20240204 10:08:15.607019 13297 parallel_pq_v2.h:79] insert failed, size(hashtable)=11910
[proc 0] 300 steps, total: 9.522, sample: 0.529, forward: 0.548, backward: 0.415, update: 0.209
[proc 5] 300 steps, total: 9.522, sample: 0.315, forward: 0.475, backward: 0.586, update: 0.169
[proc 3] 300 steps, total: 9.522, sample: 0.324, forward: 0.456, backward: 0.516, update: 0.161
[proc 2] 300 steps, total: 9.522, sample: 0.314, forward: 0.448, backward: 0.443, update: 0.164
[proc 1] 300 steps, total: 9.522, sample: 0.322, forward: 0.459, backward: 0.400, update: 0.148
[proc 7] 300 steps, total: 9.522, sample: 0.342, forward: 0.470, backward: 0.450, update: 0.162
[proc 6] 300 steps, total: 9.522, sample: 0.365, forward: 0.479, backward: 0.497, update: 0.168
[proc 4] 300 steps, total: 9.522, sample: 0.319, forward: 0.487, backward: 0.442, update: 0.157
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.956 ms                  | 30.988 ms                 |
| Forward                   | 4.879 ms                  | 9.834 ms                  |
| Backward                  | 3.765 ms                  | 10.261 ms                 |
| Optimize                  | 1.992 ms                  | 3.847 ms                  |
| BarrierTimeBeforeRank0    | 2.416 ms                  | 24.384 ms                 |
| AfterBackward             | 48.228 ms                 | 151.195 ms                |
| BlockToStepN              | 11.489 ms                 | 20.314 ms                 |
| OneStep                   | 84.073 ms                 | 182.075 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:15.941890 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 460.911 us                | 12.035 ms                 |
| ProcessBack:Shuffle       | 7.818 ms                  | 13.679 ms                 |
| ProcessBack:UpdateCache   | 8.832 ms                  | 14.431 ms                 |
| ProcessBack:UpsertPq      | 29.887 ms                 | 49.197 ms                 |
| ProcessOneStep            | 48.065 ms                 | 151.112 ms                |
| BlockToStepN              | 11.433 ms                 | 20.220 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:16.583014 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=311, pq.top=311
E20240204 10:08:16.607080 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=1170
W20240204 10:08:16.950915 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240204 10:08:17.588126 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=323, pq.top=323
E20240204 10:08:17.607013 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=20
W20240204 10:08:17.956463 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:18.588308 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=334, pq.top=334
E20240204 10:08:18.607066 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=683
W20240204 10:08:18.960101 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240204 10:08:19.607009 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=1046
W20240204 10:08:19.618680 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=346, pq.top=346
E20240204 10:08:19.988193 12679 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=350, sample_step_cpp_seen_[rank]=349
W20240204 10:08:20.016126 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end3
E20240204 10:08:20.607026 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=246
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.895 ms                  | 28.245 ms                 |
| Forward                   | 4.853 ms                  | 9.078 ms                  |
| Backward                  | 3.727 ms                  | 8.664 ms                  |
| Optimize                  | 1.967 ms                  | 3.390 ms                  |
| BarrierTimeBeforeRank0    | 2.599 ms                  | 26.511 ms                 |
| AfterBackward             | 48.035 ms                 | 151.195 ms                |
| BlockToStepN              | 11.375 ms                 | 20.123 ms                 |
| OneStep                   | 84.646 ms                 | 182.075 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:21.018781 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:21.231740 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=361, pq.top=361
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 442.771 us                | 11.287 ms                 |
| ProcessBack:Shuffle       | 7.889 ms                  | 13.787 ms                 |
| ProcessBack:UpdateCache   | 8.903 ms                  | 13.456 ms                 |
| ProcessBack:UpsertPq      | 29.720 ms                 | 49.082 ms                 |
| ProcessOneStep            | 48.113 ms                 | 175.578 ms                |
| BlockToStepN              | 11.256 ms                 | 20.008 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:08:21.607013 13303 parallel_pq_v2.h:79] insert failed, size(hashtable)=8849
W20240204 10:08:22.030414 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end3
W20240204 10:08:22.286092 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=374, pq.top=374
E20240204 10:08:22.607026 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=1261
W20240204 10:08:23.033706 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 10:08:23.321358 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=385, pq.top=385
E20240204 10:08:23.607033 13299 parallel_pq_v2.h:79] insert failed, size(hashtable)=10469
W20240204 10:08:24.039191 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:08:24.343235 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=395, pq.top=395
E20240204 10:08:24.608163 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
[proc 1] 400 steps, total: 9.219, sample: 0.343, forward: 0.509, backward: 0.371, update: 0.167
[proc 0] 400 steps, total: 9.219, sample: 0.518, forward: 0.470, backward: 0.370, update: 0.175
[proc 5] 400 steps, total: 9.219, sample: 0.314, forward: 0.480, backward: 0.520, update: 0.172
[proc 6] 400 steps, total: 9.219, sample: 0.336, forward: 0.470, backward: 0.520, update: 0.164
[proc 4] 400 steps, total: 9.219, sample: 0.303, forward: 0.471, backward: 0.408, update: 0.154
[proc 7] 400 steps, total: 9.219, sample: 0.351, forward: 0.491, backward: 0.450, update: 0.173
[proc 2] 400 steps, total: 9.219, sample: 0.400, forward: 0.506, backward: 0.430, update: 0.182
[proc 3] 400 steps, total: 9.219, sample: 0.344, forward: 0.464, backward: 0.457, update: 0.163
W20240204 10:08:25.041862 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 10:08:25.343679 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=404, pq.top=404
E20240204 10:08:25.608157 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.914 ms                  | 28.245 ms                 |
| Forward                   | 4.844 ms                  | 9.078 ms                  |
| Backward                  | 3.725 ms                  | 8.664 ms                  |
| Optimize                  | 1.946 ms                  | 3.390 ms                  |
| BarrierTimeBeforeRank0    | 2.722 ms                  | 26.511 ms                 |
| AfterBackward             | 48.235 ms                 | 187.568 ms                |
| BlockToStepN              | 11.037 ms                 | 20.123 ms                 |
| OneStep                   | 85.331 ms                 | 215.760 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:26.045817 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:26.429795 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=413, pq.top=413
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 378.636 us                | 10.850 ms                 |
| ProcessBack:Shuffle       | 7.923 ms                  | 14.594 ms                 |
| ProcessBack:UpdateCache   | 8.923 ms                  | 14.634 ms                 |
| ProcessBack:UpsertPq      | 29.864 ms                 | 52.005 ms                 |
| ProcessOneStep            | 48.301 ms                 | 187.522 ms                |
| BlockToStepN              | 10.993 ms                 | 20.008 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:08:26.608016 13284 parallel_pq_v2.h:79] insert failed, size(hashtable)=10233
W20240204 10:08:27.049665 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 10:08:27.459170 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=421, pq.top=421
E20240204 10:08:27.608016 13292 parallel_pq_v2.h:79] insert failed, size(hashtable)=9282
W20240204 10:08:28.055869 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240204 10:08:28.333585 12679 grad_async_v2.h:404] Stalled in ProcessBackward: rank=6, step_no=430, sample_step_cpp_seen_[rank]=429
W20240204 10:08:28.503177 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=431, pq.top=431
E20240204 10:08:28.608026 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=22
W20240204 10:08:29.073774 13273 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
W20240204 10:08:29.565676 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=442, pq.top=442
E20240204 10:08:29.608007 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=277
W20240204 10:08:30.082433 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240204 10:08:30.591344 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=452, pq.top=452
E20240204 10:08:30.608009 13273 parallel_pq_v2.h:79] insert failed, size(hashtable)=582
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.946 ms                  | 30.988 ms                 |
| Forward                   | 4.837 ms                  | 8.950 ms                  |
| Backward                  | 3.740 ms                  | 8.641 ms                  |
| Optimize                  | 1.961 ms                  | 3.389 ms                  |
| BarrierTimeBeforeRank0    | 2.722 ms                  | 26.662 ms                 |
| AfterBackward             | 48.330 ms                 | 187.568 ms                |
| BlockToStepN              | 10.794 ms                 | 20.089 ms                 |
| OneStep                   | 85.825 ms                 | 215.760 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:08:31.086280 13273 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 484.443 us                | 11.733 ms                 |
| ProcessBack:Shuffle       | 7.976 ms                  | 14.640 ms                 |
| ProcessBack:UpdateCache   | 8.969 ms                  | 14.840 ms                 |
| ProcessBack:UpsertPq      | 29.691 ms                 | 66.879 ms                 |
| ProcessOneStep            | 48.204 ms                 | 187.522 ms                |
| BlockToStepN              | 10.621 ms                 | 19.995 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:08:31.608011 12135 parallel_pq_v2.h:79] insert failed, size(hashtable)=3069
W20240204 10:08:31.623934 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=465, pq.top=465
W20240204 10:08:32.095149 13273 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end3
E20240204 10:08:32.608038 13276 parallel_pq_v2.h:79] insert failed, size(hashtable)=7277
W20240204 10:08:32.697822 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=478, pq.top=478
W20240204 10:08:33.102771 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240204 10:08:33.608009 12679 parallel_pq_v2.h:79] insert failed, size(hashtable)=201
W20240204 10:08:33.718400 12135 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=490, pq.top=490
W20240204 10:08:34.110414 13273 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
[proc 5] 500 steps, total: 9.659, sample: 0.361, forward: 0.485, backward: 0.496, update: 0.175
[proc 4] 500 steps, total: 9.659, sample: 0.356, forward: 0.468, backward: 0.395, update: 0.167
[proc 0] 500 steps, total: 9.659, sample: 0.547, forward: 0.478, backward: 0.393, update: 0.176
[proc 2] 500 steps, total: 9.659, sample: 0.336, forward: 0.471, backward: 0.452, update: 0.169
[proc 6] 500 steps, total: 9.659, sample: 0.339, forward: 0.477, backward: 0.640, update: 0.164
[proc 3] 500 steps, total: 9.659, sample: 0.342, forward: 0.483, backward: 0.442, update: 0.165
Successfully xmh. training takes 47.304627895355225 seconds
[proc 1] 500 steps, total: 9.659, sample: 0.306, forward: 0.461, backward: 0.369, update: 0.152
[proc 7] 500 steps, total: 9.659, sample: 0.358, forward: 0.468, backward: 0.444, update: 0.175
before call kg_cache_controller.StopThreads()
W20240204 10:08:34.546394 12135 grad_async_v2.h:84] call StopThreads. PID = 11320
W20240204 10:08:34.546442 12135 grad_base.h:212] before processOneStepNegThread_.join();
W20240204 10:08:34.546901 12135 grad_base.h:214] after processOneStepNegThread_.join();
W20240204 10:08:34.546916 12135 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240204 10:08:34.556143 12135 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fcf96d34450>

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240204 10:37:22.739274  5800 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_122', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=8, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [5800 sampler.py:454] Start PreSampling
WARNING [5800 sampler.py:532] Before construct renumbering_dict
WARNING [5800 sampler.py:555] PreSampling done
W20240204 10:37:28.425925  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240204 10:37:28.426121  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240204 10:37:28.426174  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240204 10:37:28.426221  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240204 10:37:28.426270  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240204 10:37:28.426316  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240204 10:37:28.426362  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240204 10:37:28.426414  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240204 10:37:28.426455  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240204 10:37:28.426502  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240204 10:37:28.426550  5800 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240204 10:37:28.426592  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240204 10:37:28.426635  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240204 10:37:28.426770  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240204 10:37:28.426828  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240204 10:37:28.426875  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240204 10:37:28.426927  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240204 10:37:28.426977  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240204 10:37:28.427028  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240204 10:37:28.427078  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240204 10:37:28.427125  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240204 10:37:28.427177  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240204 10:37:28.427215  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240204 10:37:28.427258  5800 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240204 10:37:28.427291  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240204 10:37:28.427330  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240204 10:37:28.427402  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240204 10:37:28.427444  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240204 10:37:28.427489  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240204 10:37:28.427533  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240204 10:37:28.427579  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240204 10:37:28.427624  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240204 10:37:28.427664  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240204 10:37:28.427709  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240204 10:37:28.427753  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240204 10:37:28.427806  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240204 10:37:28.427845  5800 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240204 10:37:28.427878  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240204 10:37:28.427911  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240204 10:37:28.427980  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240204 10:37:28.428022  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240204 10:37:28.428076  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240204 10:37:28.428117  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240204 10:37:28.428156  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240204 10:37:28.428205  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240204 10:37:28.428243  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240204 10:37:28.428293  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240204 10:37:28.428344  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240204 10:37:28.428386  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240204 10:37:28.428426  5800 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240204 10:37:28.428459  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240204 10:37:28.428500  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240204 10:37:28.428577  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240204 10:37:28.428627  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240204 10:37:28.428669  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240204 10:37:28.428709  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240204 10:37:28.428750  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240204 10:37:28.428797  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240204 10:37:28.428844  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240204 10:37:28.428884  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240204 10:37:28.428925  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240204 10:37:28.428963  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240204 10:37:28.429013  5800 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240204 10:37:28.429046  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240204 10:37:28.429080  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240204 10:37:28.429149  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240204 10:37:28.429195  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240204 10:37:28.429246  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240204 10:37:28.429293  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240204 10:37:28.429334  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240204 10:37:28.429389  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240204 10:37:28.429438  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240204 10:37:28.429478  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240204 10:37:28.429518  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240204 10:37:28.429559  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240204 10:37:28.429603  5800 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240204 10:37:28.429637  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240204 10:37:28.429672  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240204 10:37:28.429741  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x10001ca5a000 7.629 MB
W20240204 10:37:28.429795  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x10001d1fd000 7.629 MB
W20240204 10:37:28.429839  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_2 [1000000]0x10001d9a0000 7.629 MB
W20240204 10:37:28.429885  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_3 [1000000]0x10001e143000 7.629 MB
W20240204 10:37:28.429926  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_4 [1000000]0x10001e8e6000 7.629 MB
W20240204 10:37:28.429975  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_5 [1000000]0x10001f089000 7.629 MB
W20240204 10:37:28.430018  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_6 [1000000]0x10001f82c000 7.629 MB
W20240204 10:37:28.430063  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_7 [1000000]0x10001ffcf000 7.629 MB
W20240204 10:37:28.430109  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_8 [1000000]0x100020772000 7.629 MB
W20240204 10:37:28.430148  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_9 [1000000]0x100020f15000 7.629 MB
W20240204 10:37:28.430197  5800 IPCTensor.h:369] NewIPCTensor: step_r6 [10]0x1000216b8000 80 B 
W20240204 10:37:28.430230  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x1000216ba000 8 B 
W20240204 10:37:28.430270  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x1000216bc000 8 B 
W20240204 10:37:28.430343  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_0 [1000000]0x1000216be000 7.629 MB
W20240204 10:37:28.430392  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_1 [1000000]0x100021e61000 7.629 MB
W20240204 10:37:28.430434  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_2 [1000000]0x100022604000 7.629 MB
W20240204 10:37:28.430476  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_3 [1000000]0x100022da7000 7.629 MB
W20240204 10:37:28.430516  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_4 [1000000]0x10002354a000 7.629 MB
W20240204 10:37:28.430558  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_5 [1000000]0x100023ced000 7.629 MB
W20240204 10:37:28.430609  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_6 [1000000]0x100024490000 7.629 MB
W20240204 10:37:28.430650  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_7 [1000000]0x100024c33000 7.629 MB
W20240204 10:37:28.430699  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_8 [1000000]0x1000253d6000 7.629 MB
W20240204 10:37:28.430742  5800 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_9 [1000000]0x100025b79000 7.629 MB
W20240204 10:37:28.430789  5800 IPCTensor.h:369] NewIPCTensor: step_r7 [10]0x10002631c000 80 B 
W20240204 10:37:28.430824  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r7 [1]0x10002631e000 8 B 
W20240204 10:37:28.430858  5800 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100026320000 8 B 
W20240204 10:37:28.672643  5800 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100026322000 22.81 MB
W20240204 10:37:28.760784  5800 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000279f4000 58.4 kB
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([ 745,  985, 1316,  ..., 9690, 7256, 7290]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 6.117 seconds
[Rank1] pid = 6384
[Rank2] pid = 6421
[Rank3] pid = 6512
[Rank4] pid = 6576
[Rank5] pid = 6577
[Rank6] pid = 6705
INFO [5800 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [6384 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [6421 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [6512 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [6576 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [6577 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [6757 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [6705 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [6576 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [6757 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [5800 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [6577 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [6705 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [6421 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [6384 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [6512 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240204 10:37:31.438674  6770 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240204 10:37:31.439725  6598 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240204 10:37:31.439791  6771 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_7 [747, 400]; dev=7; size=1.14 MB
W20240204 10:37:31.439792  6706 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_6 [747, 400]; dev=6; size=1.14 MB
W20240204 10:37:31.439790  6578 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
W20240204 10:37:31.439877  6449 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240204 10:37:31.439904  6513 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240204 10:37:31.439910  6385 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240204 10:37:31.467494  6598 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x100027a06000 7.629 MB
W20240204 10:37:31.467677  6598 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x1000281ad000 7.629 MB
W20240204 10:37:31.467797  6598 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x100028954000 1.49 GB
W20240204 10:37:31.467839  6598 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x100087f37000 1.49 GB
W20240204 10:37:31.467877  6513 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x1000e751a000 7.629 MB
W20240204 10:37:31.467883  6771 IPCTensor.h:369] NewIPCTensor: input_keys_7 [1000000]0x1000e7cbd000 7.629 MB
W20240204 10:37:31.467898  6598 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 10:37:31.467921  6578 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x1000e8460000 7.629 MB
W20240204 10:37:31.467967  6706 IPCTensor.h:369] NewIPCTensor: input_keys_6 [1000000]0x1000e8c05000 7.629 MB
W20240204 10:37:31.468042  6513 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1000e93a8000 7.629 MB
W20240204 10:37:31.468099  6771 IPCTensor.h:369] NewIPCTensor: input_keys_neg_7 [1000000]0x1000e9b4b000 7.629 MB
W20240204 10:37:31.468102  6578 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x1000ea2ee000 7.629 MB
W20240204 10:37:31.468154  6770 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000eaa91000 7.629 MB
W20240204 10:37:31.468178  6513 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1000eb234000 1.49 GB
W20240204 10:37:31.468194  6706 IPCTensor.h:369] NewIPCTensor: input_keys_neg_6 [1000000]0x10014a817000 7.629 MB
W20240204 10:37:31.468212  6771 IPCTensor.h:369] NewIPCTensor: backward_grads_7 [1000000, 400]0x10014afba000 1.49 GB
W20240204 10:37:31.468220  6578 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x1001aa59d000 1.49 GB
W20240204 10:37:31.468252  6513 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x100209b80000 1.49 GB
W20240204 10:37:31.468283  6578 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x100269163000 1.49 GB
W20240204 10:37:31.468292  6771 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_7 [1000000, 400]0x1002c8746000 1.49 GB
W20240204 10:37:31.468295  6770 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100327d29000 7.629 MB
W20240204 10:37:31.468319  6706 IPCTensor.h:369] NewIPCTensor: backward_grads_6 [1000000, 400]0x1003284cc000 1.49 GB
W20240204 10:37:31.468333  6513 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240204 10:37:31.468350  6578 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 10:37:31.468367  6706 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_6 [1000000, 400]0x100387aaf000 1.49 GB
W20240204 10:37:31.468370  6770 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1003e7092000 1.49 GB
W20240204 10:37:31.468394  6771 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 10:37:31.468420  6770 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100446675000 1.49 GB
W20240204 10:37:31.468431  6706 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 10:37:31.468478  6770 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 10:37:31.477835  6449 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1004a5c5c000 7.629 MB
W20240204 10:37:31.477921  6385 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1004a63ff000 7.629 MB
W20240204 10:37:31.477983  6449 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1004a6ba2000 7.629 MB
W20240204 10:37:31.478047  6385 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1004a7345000 7.629 MB
W20240204 10:37:31.478060  6449 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1004a7ae8000 1.49 GB
W20240204 10:37:31.478102  6449 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1005070cb000 1.49 GB
W20240204 10:37:31.478121  6385 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1005666ae000 1.49 GB
W20240204 10:37:31.478155  6449 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 10:37:31.478185  6385 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1005c5c97000 1.49 GB
W20240204 10:37:31.478235  6385 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240204 10:37:31.478299  6706 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 10:37:31.478307  6770 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 10:37:31.478323  6771 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 10:37:31.478344  6578 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 10:37:31.478380  6513 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240204 10:37:31.478411  6598 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 10:37:31.491267  6449 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 10:37:31.491319  6385 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100026322000
2: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100026322000
3: KnownLocalCachedEmbedding init done
WARNING [6421 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [6512 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
1: KnownLocalCachedEmbedding init done
WARNING [6384 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
4: KnownLocalCachedEmbedding init done
WARNING [6576 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
6: KnownLocalCachedEmbedding init done
WARNING [6705 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
5: KnownLocalCachedEmbedding init done
WARNING [6577 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
7: KnownLocalCachedEmbedding init done
WARNING [6757 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank7] pid = 6757
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
cudaHostRegister 0x100026322000
0: KnownLocalCachedEmbedding init done
WARNING [5800 DistTensor.py:59] The tensor name already exists in the kvstore
I20240204 10:37:33.706429  6770 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240204 10:37:33.706516  6598 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:37:33.706588  6771 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:37:33.706707  6449 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:37:33.706867  6578 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:37:33.706945  6385 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:37:33.707063  6706 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:37:33.707203  6513 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240204 10:37:33.709643  6770 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 8,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240204 10:37:33.709786  6770 grad_base.h:184] Init GradProcessingBase done
I20240204 10:37:33.714381  6770 grad_async_v2.h:42] Use main thread to update emb.
W20240204 10:37:33.714430  6770 kg_controller.h:78] after init GradAsyncProcessingV2
I20240204 10:37:33.714439  6770 kg_controller.h:84] Construct KGCacheController done
E20240204 10:37:35.476547  6513 recstore.cc:66] init folly done
E20240204 10:37:35.477002  6578 recstore.cc:66] init folly done
E20240204 10:37:35.477051  6449 recstore.cc:66] init folly done
E20240204 10:37:35.477033  6770 recstore.cc:66] init folly done
E20240204 10:37:35.477066  6598 recstore.cc:66] init folly done
E20240204 10:37:35.477064  6706 recstore.cc:66] init folly done
E20240204 10:37:35.477103  6771 recstore.cc:66] init folly done
E20240204 10:37:35.477208  6385 recstore.cc:66] init folly done
I20240204 10:37:35.478695  6770 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240204 10:37:36.241669  8101 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:37:36.242069  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240204 10:37:36.265882  6385 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240204 10:37:36.276822  6513 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:37:36.278523  6598 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:37:36.278957  6706 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:37:36.279628  6449 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:37:36.281903  6771 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:37:36.302611  6770 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:37:36.311468  6578 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 747.715 us                | 747.715 us                |
| Forward                   | 656.452 ms                | 656.452 ms                |
| Backward                  | 230.139 ms                | 230.139 ms                |
| Optimize                  | 2.079 ms                  | 2.079 ms                  |
| BarrierTimeBeforeRank0    | 84.998 ms                 | 84.998 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:37:38.777884  7467 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240204 10:37:38.815622  8101 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240204 10:37:38.856607  6770 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=1, sample_step_cpp_seen_[rank]=0
W20240204 10:37:39.191529  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=7, pq.top=7
E20240204 10:37:39.777289  8107 parallel_pq_v2.h:79] insert failed, size(hashtable)=13536
W20240204 10:37:39.879526  8101 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 246.731 us                | 500.205 us                |
| ProcessBack:Shuffle       | 7.783 ms                  | 458.127 ms                |
| ProcessBack:UpdateCache   | 9.094 ms                  | 768.418 ms                |
| ProcessBack:UpsertPq      | 19.030 ms                 | 31.787 ms                 |
| ProcessOneStep            | 37.464 ms                 | 1.524 s                   |
| BlockToStepN              | 73.388 us                 | 11.015 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 10:37:40.590520  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=20, pq.top=20
E20240204 10:37:40.777048  7467 parallel_pq_v2.h:79] insert failed, size(hashtable)=261
W20240204 10:37:40.881294  8101 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240204 10:37:41.635833  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=36, pq.top=36
E20240204 10:37:41.777015  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=149
W20240204 10:37:41.888063  8101 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end0
W20240204 10:37:42.650460  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=51, pq.top=51
E20240204 10:37:42.777029  8100 parallel_pq_v2.h:79] insert failed, size(hashtable)=5100
W20240204 10:37:42.891882  8101 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end5
W20240204 10:37:43.677753  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=67, pq.top=67
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.500 ms                  | 20.449 ms                 |
| Forward                   | 5.051 ms                  | 10.257 ms                 |
| Backward                  | 4.239 ms                  | 7.834 ms                  |
| Optimize                  | 2.126 ms                  | 3.337 ms                  |
| BarrierTimeBeforeRank0    | 2.089 ms                  | 11.199 ms                 |
| AfterBackward             | 45.333 ms                 | 650.801 ms                |
| BlockToStepN              | 430.081 us                | 6.395 ms                  |
| OneStep                   | 62.824 ms                 | 670.921 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:37:43.777027  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=12734
W20240204 10:37:43.895345  8101 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end1
W20240204 10:37:44.693023  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=80, pq.top=80
E20240204 10:37:44.777043  8105 parallel_pq_v2.h:79] insert failed, size(hashtable)=9853
W20240204 10:37:44.898814  8101 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 353.632 us                | 7.360 ms                  |
| ProcessBack:Shuffle       | 8.592 ms                  | 13.154 ms                 |
| ProcessBack:UpdateCache   | 11.303 ms                 | 15.275 ms                 |
| ProcessBack:UpsertPq      | 25.222 ms                 | 51.332 ms                 |
| ProcessOneStep            | 46.480 ms                 | 650.649 ms                |
| BlockToStepN              | 411.913 us                | 6.153 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240204 10:37:45.777020  8107 parallel_pq_v2.h:79] insert failed, size(hashtable)=8458
W20240204 10:37:45.901988  8101 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 9.818, sample: 0.316, forward: 1.122, backward: 0.612, update: 0.164
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 9.813, sample: 0.319, forward: 1.123, backward: 0.710, update: 0.181
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 9.817, sample: 0.321, forward: 1.126, backward: 0.748, update: 0.172
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 9.784, sample: 0.319, forward: 1.198, backward: 0.746, update: 0.170
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 9.816, sample: 0.347, forward: 1.144, backward: 0.728, update: 0.176
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 9.816, sample: 0.343, forward: 1.132, backward: 0.761, update: 0.172
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 9.829, sample: 0.316, forward: 1.100, backward: 0.811, update: 0.176
train_sampler.Prefill()
-------Step 0-------
tensor([ 2151,    44,  3691,  3488, 12510, 12812,  1145,   409, 13313, 12376]) tensor([ 1316, 10463,  6262, 13016, 12346,   940,   571,  5032,   531, 12972])
-------Step 1-------
tensor([ 2151,    44,  3691,  3488, 12510, 12812,  1145,   409, 13313, 12376]) tensor([ 4465, 10321, 14916,  1334,  1008,  9169,  9782, 10054,  3753,  9777])
-------Step 2-------
tensor([ 5647, 11823,  6001,  4230,  6916,  9448,  7269,    90, 11038,   929]) tensor([ 2431,  4000,  2979,  6913,  6779,  8848,  9237, 10548,  9176,  9877])
-------Step 3-------
tensor([ 5647, 11823,  6001,  4230,  6916,  9448,  7269,    90, 11038,   929]) tensor([ 5852,  7720,  7609, 11249,  7750,   711,  6015,  2352, 12378,  2115])
-------Step 4-------
tensor([   44,  7193, 11402,  5508,  3680,  3727,    74,  4990,  8160,  1057]) tensor([ 606, 1151, 3126, 3426, 2552, 2820,  409, 7532, 6272, 1800])
-------Step 5-------
tensor([   44,  7193, 11402,  5508,  3680,  3727,    74,  4990,  8160,  1057]) tensor([11876,  5771,  6629,  1767,  3564,   826,   792,  1295,  7018,  4492])
-------Step 6-------
tensor([ 1463,  8936,    20,    72,  5053,  2913,  9374,  8169, 13696, 13401]) tensor([11823,  3256,  9015,  4654,  9400, 10413,  4822,  9526, 10355, 12379])
-------Step 7-------
tensor([ 1463,  8936,    20,    72,  5053,  2913,  9374,  8169, 13696, 13401]) tensor([12721, 13343,  3604,  7621,  1385,  8960,  7953,  2448,   140, 13431])
-------Step 8-------
tensor([ 2764,  8490,  5968, 12426,    84,    76, 10601, 13256,    67,  1766]) tensor([ 6044,  5565,  5033,  8550,  3136, 10685, 10632,  1555,  5816,  2703])
-------Step 9-------
tensor([ 2764,  8490,  5968, 12426,    84,    76, 10601, 13256,    67,  1766]) tensor([12615,  3948, 13523,  9609, 14466, 14355, 14142, 10054,   681, 13328])
before start barrier
start train
[proc 0] 100 steps, total: 9.793, sample: 0.386, forward: 1.170, backward: 0.661, update: 0.218
W20240204 10:37:46.224004  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=102, pq.top=102
E20240204 10:37:46.777141  8104 parallel_pq_v2.h:79] insert failed, size(hashtable)=7370
W20240204 10:37:46.904357  8101 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end3
W20240204 10:37:47.353149  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=119, pq.top=119
E20240204 10:37:47.777138  8112 parallel_pq_v2.h:79] insert failed, size(hashtable)=9923
W20240204 10:37:47.936425  8101 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end8
W20240204 10:37:48.354961  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=134, pq.top=134
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.702 ms                  | 25.871 ms                 |
| Forward                   | 4.990 ms                  | 10.257 ms                 |
| Backward                  | 4.271 ms                  | 7.834 ms                  |
| Optimize                  | 2.202 ms                  | 3.396 ms                  |
| BarrierTimeBeforeRank0    | 1.960 ms                  | 20.166 ms                 |
| AfterBackward             | 46.641 ms                 | 650.801 ms                |
| BlockToStepN              | 625.778 us                | 6.395 ms                  |
| OneStep                   | 63.958 ms                 | 670.921 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:37:48.779821  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=65
W20240204 10:37:49.005448  8101 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
W20240204 10:37:49.406157  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=147, pq.top=147
E20240204 10:37:49.779042  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=84
W20240204 10:37:50.030798  8101 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
E20240204 10:37:50.134850  7467 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=155, sample_step_cpp_seen_[rank]=154
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 352.652 us                | 7.036 ms                  |
| ProcessBack:Shuffle       | 8.502 ms                  | 13.602 ms                 |
| ProcessBack:UpdateCache   | 11.192 ms                 | 16.746 ms                 |
| ProcessBack:UpsertPq      | 26.000 ms                 | 43.817 ms                 |
| ProcessOneStep            | 46.947 ms                 | 247.273 ms                |
| BlockToStepN              | 583.684 us                | 4.039 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240204 10:37:50.533771  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=158, pq.top=158
E20240204 10:37:50.779021  7467 parallel_pq_v2.h:79] insert failed, size(hashtable)=1376
W20240204 10:37:51.036479  8101 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240204 10:37:51.599007  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=171, pq.top=171
E20240204 10:37:51.779023  8120 parallel_pq_v2.h:79] insert failed, size(hashtable)=5255
W20240204 10:37:52.050096  8101 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end8
W20240204 10:37:52.599880  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=184, pq.top=184
E20240204 10:37:52.779063  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=8
W20240204 10:37:53.079466  8101 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.832 ms                  | 25.871 ms                 |
| Forward                   | 4.941 ms                  | 10.257 ms                 |
| Backward                  | 4.285 ms                  | 9.231 ms                  |
| Optimize                  | 2.193 ms                  | 3.396 ms                  |
| BarrierTimeBeforeRank0    | 2.182 ms                  | 30.914 ms                 |
| AfterBackward             | 47.010 ms                 | 247.320 ms                |
| BlockToStepN              | 738.279 us                | 4.118 ms                  |
| OneStep                   | 66.655 ms                 | 274.561 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:37:53.779012  8104 parallel_pq_v2.h:79] insert failed, size(hashtable)=9679
W20240204 10:37:53.836858  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=200, pq.top=200
[proc 3] 200 steps, total: 7.743, sample: 0.362, forward: 0.459, backward: 0.445, update: 0.161
[proc 0] 200 steps, total: 7.743, sample: 0.479, forward: 0.484, backward: 0.432, update: 0.213
[proc 5] 200 steps, total: 7.744, sample: 0.434, forward: 0.508, backward: 0.517, update: 0.179
[proc 6] 200 steps, total: 7.744, sample: 0.359, forward: 0.466, backward: 0.456, update: 0.171
[proc 2] 200 steps, total: 7.744, sample: 0.387, forward: 0.507, backward: 0.443, update: 0.172
[proc 7] 200 steps, total: 7.744, sample: 0.422, forward: 0.510, backward: 0.560, update: 0.182
[proc 4] 200 steps, total: 7.744, sample: 0.364, forward: 0.487, backward: 0.457, update: 0.174
[proc 1] 200 steps, total: 7.744, sample: 0.355, forward: 0.495, backward: 0.582, update: 0.187
W20240204 10:37:54.099418  8101 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end4
E20240204 10:37:54.779101  8133 parallel_pq_v2.h:79] insert failed, size(hashtable)=3765
W20240204 10:37:54.840303  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=213, pq.top=213
W20240204 10:37:55.101219  8101 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 416.156 us                | 9.789 ms                  |
| ProcessBack:Shuffle       | 8.543 ms                  | 14.877 ms                 |
| ProcessBack:UpdateCache   | 10.851 ms                 | 16.420 ms                 |
| ProcessBack:UpsertPq      | 25.899 ms                 | 43.703 ms                 |
| ProcessOneStep            | 46.915 ms                 | 247.273 ms                |
| BlockToStepN              | 741.334 us                | 5.831 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240204 10:37:55.779034  8122 parallel_pq_v2.h:79] insert failed, size(hashtable)=12973
W20240204 10:37:56.118494  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240204 10:37:56.643855  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=234, pq.top=234
E20240204 10:37:56.779203  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=34
W20240204 10:37:57.122402  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240204 10:37:57.752648  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=247, pq.top=247
E20240204 10:37:57.779028  8124 parallel_pq_v2.h:79] insert failed, size(hashtable)=11071
W20240204 10:37:58.131399  8101 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.950 ms                  | 26.835 ms                 |
| Forward                   | 4.891 ms                  | 10.045 ms                 |
| Backward                  | 4.297 ms                  | 9.217 ms                  |
| Optimize                  | 2.182 ms                  | 3.396 ms                  |
| BarrierTimeBeforeRank0    | 2.402 ms                  | 30.914 ms                 |
| AfterBackward             | 47.010 ms                 | 108.453 ms                |
| BlockToStepN              | 937.002 us                | 5.904 ms                  |
| OneStep                   | 71.265 ms                 | 128.440 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:37:58.779009  7467 parallel_pq_v2.h:79] insert failed, size(hashtable)=1616
W20240204 10:37:58.785997  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=261, pq.top=261
W20240204 10:37:59.154158  8101 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end7
E20240204 10:37:59.779008  6770 parallel_pq_v2.h:79] insert failed, size(hashtable)=213
W20240204 10:37:59.804201  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=275, pq.top=275
W20240204 10:38:00.175669  8101 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 495.039 us                | 8.326 ms                  |
| ProcessBack:Shuffle       | 8.556 ms                  | 13.724 ms                 |
| ProcessBack:UpdateCache   | 10.819 ms                 | 15.215 ms                 |
| ProcessBack:UpsertPq      | 26.020 ms                 | 51.196 ms                 |
| ProcessOneStep            | 46.907 ms                 | 108.383 ms                |
| BlockToStepN              | 933.694 us                | 5.831 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240204 10:38:00.779181  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=169
W20240204 10:38:00.850345  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=289, pq.top=289
W20240204 10:38:01.209633  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
[proc 6] 300 steps, total: 7.868, sample: 0.301, forward: 0.442, backward: 0.452, update: 0.162
[proc 7] 300 steps, total: 7.868, sample: 0.340, forward: 0.459, backward: 0.517, update: 0.169
[proc 0] 300 steps, total: 7.868, sample: 0.463, forward: 0.465, backward: 0.471, update: 0.208
[proc 1] 300 steps, total: 7.868, sample: 0.346, forward: 0.450, backward: 0.522, update: 0.172
[proc 3] 300 steps, total: 7.868, sample: 0.351, forward: 0.465, backward: 0.468, update: 0.163
[proc 5] 300 steps, total: 7.868, sample: 0.370, forward: 0.481, backward: 0.442, update: 0.182
[proc 4] 300 steps, total: 7.868, sample: 0.316, forward: 0.456, backward: 0.481, update: 0.168
[proc 2] 300 steps, total: 7.868, sample: 0.315, forward: 0.447, backward: 0.464, update: 0.154
E20240204 10:38:01.779007  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=1770
W20240204 10:38:01.888921  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=302, pq.top=302
E20240204 10:38:02.019901  7467 grad_async_v2.h:404] Stalled in ProcessBackward: rank=5, step_no=303, sample_step_cpp_seen_[rank]=302
W20240204 10:38:02.241750  8101 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
E20240204 10:38:02.779075  8115 parallel_pq_v2.h:79] insert failed, size(hashtable)=5067
W20240204 10:38:02.955085  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=309, pq.top=309
W20240204 10:38:03.244957  8101 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.057 ms                  | 26.835 ms                 |
| Forward                   | 4.796 ms                  | 10.045 ms                 |
| Backward                  | 4.308 ms                  | 9.217 ms                  |
| Optimize                  | 2.152 ms                  | 3.396 ms                  |
| BarrierTimeBeforeRank0    | 2.625 ms                  | 30.914 ms                 |
| AfterBackward             | 47.275 ms                 | 247.320 ms                |
| BlockToStepN              | 1.084 ms                  | 5.904 ms                  |
| OneStep                   | 73.668 ms                 | 274.561 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:38:03.779011  6770 parallel_pq_v2.h:79] insert failed, size(hashtable)=589
W20240204 10:38:04.054412  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=322, pq.top=322
W20240204 10:38:04.247298  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end5
E20240204 10:38:04.779052  8114 parallel_pq_v2.h:79] insert failed, size(hashtable)=12390
W20240204 10:38:05.091058  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=335, pq.top=335
W20240204 10:38:05.291406  8101 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 398.926 us                | 8.116 ms                  |
| ProcessBack:Shuffle       | 8.547 ms                  | 14.231 ms                 |
| ProcessBack:UpdateCache   | 10.774 ms                 | 14.828 ms                 |
| ProcessBack:UpsertPq      | 26.375 ms                 | 50.682 ms                 |
| ProcessOneStep            | 47.129 ms                 | 247.273 ms                |
| BlockToStepN              | 1.083 ms                  | 5.831 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240204 10:38:05.779573  8121 parallel_pq_v2.h:79] insert failed, size(hashtable)=5414
W20240204 10:38:06.125792  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=348, pq.top=348
W20240204 10:38:06.298027  8101 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:38:06.779009  7467 parallel_pq_v2.h:79] insert failed, size(hashtable)=1953
W20240204 10:38:07.152611  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=361, pq.top=361
W20240204 10:38:07.308468  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
E20240204 10:38:07.779016  6770 parallel_pq_v2.h:79] insert failed, size(hashtable)=1713
W20240204 10:38:08.294047  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=373, pq.top=373
W20240204 10:38:08.320643  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.152 ms                  | 30.317 ms                 |
| Forward                   | 4.762 ms                  | 8.925 ms                  |
| Backward                  | 4.326 ms                  | 9.048 ms                  |
| Optimize                  | 2.167 ms                  | 3.570 ms                  |
| BarrierTimeBeforeRank0    | 3.077 ms                  | 34.877 ms                 |
| AfterBackward             | 47.170 ms                 | 108.453 ms                |
| BlockToStepN              | 1.285 ms                  | 5.653 ms                  |
| OneStep                   | 75.977 ms                 | 128.440 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:38:08.779016  8107 parallel_pq_v2.h:79] insert failed, size(hashtable)=5820
W20240204 10:38:09.365875  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=385, pq.top=385
W20240204 10:38:09.417663  8101 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end6
E20240204 10:38:09.779022  8119 parallel_pq_v2.h:79] insert failed, size(hashtable)=8973
E20240204 10:38:09.839273  6770 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=390, sample_step_cpp_seen_[rank]=389
W20240204 10:38:10.367522  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=392, pq.top=392
W20240204 10:38:10.418241  8101 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 372.175 us                | 7.867 ms                  |
| ProcessBack:Shuffle       | 8.590 ms                  | 13.724 ms                 |
| ProcessBack:UpdateCache   | 10.639 ms                 | 14.615 ms                 |
| ProcessBack:UpsertPq      | 26.400 ms                 | 50.376 ms                 |
| ProcessOneStep            | 47.129 ms                 | 247.273 ms                |
| BlockToStepN              | 1.202 ms                  | 5.831 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240204 10:38:10.779047  8123 parallel_pq_v2.h:79] insert failed, size(hashtable)=12157
[proc 5] 400 steps, total: 9.294, sample: 0.355, forward: 0.459, backward: 0.521, update: 0.171
[proc 7] 400 steps, total: 9.294, sample: 0.407, forward: 0.524, backward: 0.447, update: 0.199
[proc 1] 400 steps, total: 9.294, sample: 0.392, forward: 0.468, backward: 0.538, update: 0.183
[proc 2] 400 steps, total: 9.294, sample: 0.384, forward: 0.487, backward: 0.453, update: 0.171
[proc 4] 400 steps, total: 9.294, sample: 0.458, forward: 0.527, backward: 0.510, update: 0.192
[proc 3] 400 steps, total: 9.294, sample: 0.361, forward: 0.471, backward: 0.431, update: 0.172
[proc 6] 400 steps, total: 9.294, sample: 0.422, forward: 0.500, backward: 0.524, update: 0.184
[proc 0] 400 steps, total: 9.294, sample: 0.485, forward: 0.469, backward: 0.454, update: 0.219
W20240204 10:38:11.454278  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end6
E20240204 10:38:11.779024  6770 parallel_pq_v2.h:79] insert failed, size(hashtable)=373
W20240204 10:38:12.272377  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=414, pq.top=414
W20240204 10:38:12.467285  8101 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end7
E20240204 10:38:12.779012  7467 parallel_pq_v2.h:79] insert failed, size(hashtable)=1824
W20240204 10:38:13.330375  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=428, pq.top=428
W20240204 10:38:13.467406  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.208 ms                  | 33.960 ms                 |
| Forward                   | 4.733 ms                  | 8.925 ms                  |
| Backward                  | 4.318 ms                  | 9.048 ms                  |
| Optimize                  | 2.174 ms                  | 3.570 ms                  |
| BarrierTimeBeforeRank0    | 3.077 ms                  | 34.877 ms                 |
| AfterBackward             | 47.154 ms                 | 247.320 ms                |
| BlockToStepN              | 1.447 ms                  | 5.904 ms                  |
| OneStep                   | 76.447 ms                 | 274.561 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:38:13.779011  8119 parallel_pq_v2.h:79] insert failed, size(hashtable)=5531
W20240204 10:38:14.473657  8101 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240204 10:38:14.626780  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=443, pq.top=443
E20240204 10:38:14.779012  6770 parallel_pq_v2.h:79] insert failed, size(hashtable)=1502
W20240204 10:38:15.474851  8101 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 369.170 us                | 8.137 ms                  |
| ProcessBack:Shuffle       | 8.611 ms                  | 13.724 ms                 |
| ProcessBack:UpdateCache   | 10.619 ms                 | 14.828 ms                 |
| ProcessBack:UpsertPq      | 26.492 ms                 | 50.376 ms                 |
| ProcessOneStep            | 47.180 ms                 | 108.383 ms                |
| BlockToStepN              | 1.413 ms                  | 5.781 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240204 10:38:15.685663  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=457, pq.top=457
E20240204 10:38:15.779202  8101 parallel_pq_v2.h:79] insert failed, size(hashtable)=37
W20240204 10:38:16.479008  8101 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
E20240204 10:38:16.782635  6770 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 10:38:16.816020  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=471, pq.top=471
W20240204 10:38:17.485036  8101 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240204 10:38:17.782696  8113 parallel_pq_v2.h:79] insert failed, size(hashtable)=14433
W20240204 10:38:17.836974  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=484, pq.top=484
W20240204 10:38:18.485749  8101 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.246 ms                  | 34.109 ms                 |
| Forward                   | 4.676 ms                  | 8.354 ms                  |
| Backward                  | 4.336 ms                  | 8.862 ms                  |
| Optimize                  | 2.167 ms                  | 3.478 ms                  |
| BarrierTimeBeforeRank0    | 3.040 ms                  | 34.271 ms                 |
| AfterBackward             | 47.338 ms                 | 108.453 ms                |
| BlockToStepN              | 1.751 ms                  | 6.395 ms                  |
| OneStep                   | 76.493 ms                 | 129.849 ms                |
+---------------------------+---------------------------+---------------------------+
E20240204 10:38:18.782017  8110 parallel_pq_v2.h:79] insert failed, size(hashtable)=7509
W20240204 10:38:18.836503  6770 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=497, pq.top=497
[proc 1] 500 steps, total: 8.090, sample: 0.332, forward: 0.481, backward: 0.452, update: 0.187
[proc 7] 500 steps, total: 8.090, sample: 0.364, forward: 0.495, backward: 0.458, update: 0.179
[proc 0] 500 steps, total: 8.089, sample: 0.535, forward: 0.463, backward: 0.483, update: 0.213
[proc 3] 500 steps, total: 8.090, sample: 0.320, forward: 0.468, backward: 0.440, update: 0.167
[proc 2] 500 steps, total: 8.090, sample: 0.451, forward: 0.534, backward: 0.405, update: 0.194
[proc 6] 500 steps, total: 8.090, sample: 0.308, forward: 0.459, backward: 0.423, update: 0.175
[proc 5] 500 steps, total: 8.090, sample: 0.362, forward: 0.508, backward: 0.437, update: 0.197
Successfully xmh. training takes 42.78815841674805 seconds
before call kg_cache_controller.StopThreads()
[proc 4] 500 steps, total: 8.090, sample: 0.358, forward: 0.498, backward: 0.457, update: 0.183
W20240204 10:38:19.090819  6770 grad_async_v2.h:84] call StopThreads. PID = 5800
W20240204 10:38:19.090870  6770 grad_base.h:212] before processOneStepNegThread_.join();
W20240204 10:38:19.091436  6770 grad_base.h:214] after processOneStepNegThread_.join();
W20240204 10:38:19.091452  6770 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240204 10:38:19.141716  6770 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7faa3264c510>
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 418.338 us                | 10.192 ms                 |
| ProcessBack:Shuffle       | 8.598 ms                  | 13.724 ms                 |
| ProcessBack:UpdateCache   | 10.578 ms                 | 14.615 ms                 |
| ProcessBack:UpsertPq      | 26.841 ms                 | 48.882 ms                 |
| ProcessOneStep            | 47.308 ms                 | 108.383 ms                |
| BlockToStepN              | 1.699 ms                  | 6.167 ms                  |
+---------------------------+---------------------------+---------------------------+

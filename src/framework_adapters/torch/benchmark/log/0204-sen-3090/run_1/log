WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240204 10:06:05.682366  1874 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_107', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=2, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1874 sampler.py:454] Start PreSampling
WARNING [1874 sampler.py:532] Before construct renumbering_dict
WARNING [1874 sampler.py:555] PreSampling done
W20240204 10:06:11.304751  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240204 10:06:11.305143  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240204 10:06:11.305222  1874 IPCTensor.h:369] NewIPCTensor: step_r0 [2]0x100000f48000 16 B 
W20240204 10:06:11.305258  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100000f4a000 8 B 
W20240204 10:06:11.305307  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100000f4c000 8 B 
W20240204 10:06:11.305538  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100000f4e000 7.629 MB
W20240204 10:06:11.305583  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x1000016f1000 7.629 MB
W20240204 10:06:11.305653  1874 IPCTensor.h:369] NewIPCTensor: step_r1 [2]0x100001e94000 16 B 
W20240204 10:06:11.305684  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x100001e96000 8 B 
W20240204 10:06:11.305718  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100001e98000 8 B 
W20240204 10:06:11.305817  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x100001e9a000 7.629 MB
W20240204 10:06:11.305867  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000263d000 7.629 MB
W20240204 10:06:11.305910  1874 IPCTensor.h:369] NewIPCTensor: step_r2 [2]0x100002de0000 16 B 
W20240204 10:06:11.305941  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x100002de2000 8 B 
W20240204 10:06:11.305989  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100002de4000 8 B 
W20240204 10:06:11.306077  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x100002de6000 7.629 MB
W20240204 10:06:11.306145  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x100003589000 7.629 MB
W20240204 10:06:11.306238  1874 IPCTensor.h:369] NewIPCTensor: step_r3 [2]0x100003d2c000 16 B 
W20240204 10:06:11.306270  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x100003d2e000 8 B 
W20240204 10:06:11.306329  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100003d30000 8 B 
W20240204 10:06:11.306428  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100003d32000 7.629 MB
W20240204 10:06:11.306481  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x1000044d5000 7.629 MB
W20240204 10:06:11.306524  1874 IPCTensor.h:369] NewIPCTensor: step_r4 [2]0x100004c78000 16 B 
W20240204 10:06:11.306555  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100004c7a000 8 B 
W20240204 10:06:11.306602  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100004c7c000 8 B 
W20240204 10:06:11.306668  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100004c7e000 7.629 MB
W20240204 10:06:11.306746  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100005421000 7.629 MB
W20240204 10:06:11.306783  1874 IPCTensor.h:369] NewIPCTensor: step_r5 [2]0x100005bc4000 16 B 
W20240204 10:06:11.306814  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x100005bc6000 8 B 
W20240204 10:06:11.306845  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100005bc8000 8 B 
W20240204 10:06:11.306908  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x100005bca000 7.629 MB
W20240204 10:06:11.306952  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x10000636d000 7.629 MB
W20240204 10:06:11.307039  1874 IPCTensor.h:369] NewIPCTensor: step_r6 [2]0x100006b10000 16 B 
W20240204 10:06:11.307071  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x100006b12000 8 B 
W20240204 10:06:11.307101  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x100006b14000 8 B 
W20240204 10:06:11.307168  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_0 [1000000]0x100006b16000 7.629 MB
W20240204 10:06:11.307206  1874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_1 [1000000]0x1000072b9000 7.629 MB
W20240204 10:06:11.307262  1874 IPCTensor.h:369] NewIPCTensor: step_r7 [2]0x100007a5c000 16 B 
W20240204 10:06:11.307293  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r7 [1]0x100007a5e000 8 B 
W20240204 10:06:11.307324  1874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100007a60000 8 B 
W20240204 10:06:11.562608  1874 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100007a62000 22.81 MB
W20240204 10:06:11.653797  1874 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100009134000 58.4 kB
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([  755,  1201,  1733,  ..., 10116, 10195,  9262]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 6.057 seconds
[Rank1] pid = 2310
[Rank2] pid = 2335
[Rank3] pid = 2439
[Rank4] pid = 2440
[Rank5] pid = 2441
[Rank6] pid = 2632
INFO [1874 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [2310 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [2335 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [2439 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [2441 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [2632 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [2440 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [2441 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [2633 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [2632 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [2440 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [2633 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [2335 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [2310 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [2439 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [1874 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240204 10:06:14.198709  2452 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
W20240204 10:06:14.198678  2568 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240204 10:06:14.198817  2767 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_7 [747, 400]; dev=7; size=1.14 MB
W20240204 10:06:14.199206  2634 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_6 [747, 400]; dev=6; size=1.14 MB
W20240204 10:06:14.199370  2697 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240204 10:06:14.199714  2375 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240204 10:06:14.199824  2442 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240204 10:06:14.200539  2311 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240204 10:06:14.226835  2568 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x10000914a000 7.629 MB
W20240204 10:06:14.226995  2452 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x1000098ed000 7.629 MB
W20240204 10:06:14.227001  2767 IPCTensor.h:369] NewIPCTensor: input_keys_7 [1000000]0x10000a090000 7.629 MB
W20240204 10:06:14.227093  2568 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x10000a833000 7.629 MB
W20240204 10:06:14.227177  2568 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x10000afd6000 1.49 GB
W20240204 10:06:14.227193  2452 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x10006a5b9000 7.629 MB
W20240204 10:06:14.227202  2767 IPCTensor.h:369] NewIPCTensor: input_keys_neg_7 [1000000]0x10006ad5c000 7.629 MB
W20240204 10:06:14.227247  2568 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x10006b4ff000 1.49 GB
W20240204 10:06:14.227290  2452 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x1000caae2000 1.49 GB
W20240204 10:06:14.227308  2568 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 10:06:14.227324  2767 IPCTensor.h:369] NewIPCTensor: backward_grads_7 [1000000, 400]0x10012a0c5000 1.49 GB
W20240204 10:06:14.227383  2767 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_7 [1000000, 400]0x1001896a8000 1.49 GB
W20240204 10:06:14.227391  2452 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x1001e8c8b000 1.49 GB
W20240204 10:06:14.227448  2452 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 10:06:14.227450  2767 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 10:06:14.233110  2568 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240204 10:06:14.233304  2452 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240204 10:06:14.233361  2767 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240204 10:06:14.233479  2375 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x100248278000 7.629 MB
W20240204 10:06:14.233536  2442 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x100248a1b000 7.629 MB
W20240204 10:06:14.233640  2375 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1002491be000 7.629 MB
W20240204 10:06:14.233711  2442 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x100249961000 7.629 MB
W20240204 10:06:14.233745  2375 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x10024a104000 1.49 GB
W20240204 10:06:14.233814  2442 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1002a96e7000 1.49 GB
W20240204 10:06:14.233824  2375 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x100308cca000 1.49 GB
W20240204 10:06:14.233889  2442 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1003682ad000 1.49 GB
W20240204 10:06:14.233902  2375 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 10:06:14.233948  2442 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240204 10:06:14.235009  2697 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1003c7896000 7.629 MB
W20240204 10:06:14.235190  2311 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1003c87dc000 7.629 MB
W20240204 10:06:14.235188  2634 IPCTensor.h:369] NewIPCTensor: input_keys_6 [1000000]0x1003c8039000 7.629 MB
W20240204 10:06:14.235225  2697 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1003c8f7f000 7.629 MB
W20240204 10:06:14.235339  2697 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1003c9722000 1.49 GB
W20240204 10:06:14.235388  2697 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100428d05000 1.49 GB
W20240204 10:06:14.235431  2311 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1004882e8000 7.629 MB
W20240204 10:06:14.235441  2634 IPCTensor.h:369] NewIPCTensor: input_keys_neg_6 [1000000]0x100488a8b000 7.629 MB
W20240204 10:06:14.235455  2697 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 10:06:14.235527  2311 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10048922e000 1.49 GB
W20240204 10:06:14.235554  2634 IPCTensor.h:369] NewIPCTensor: backward_grads_6 [1000000, 400]0x1004e8811000 1.49 GB
W20240204 10:06:14.235615  2311 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x100547df4000 1.49 GB
W20240204 10:06:14.235654  2634 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_6 [1000000, 400]0x1005a73d7000 1.49 GB
W20240204 10:06:14.235698  2311 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240204 10:06:14.235715  2634 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 10:06:14.248440  2697 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240204 10:06:14.248445  2634 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240204 10:06:14.248445  2311 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240204 10:06:14.248474  2375 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240204 10:06:14.248517  2442 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
cudaHostRegister 0x100007a62000
5: KnownLocalCachedEmbedding init done
WARNING [2441 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100007a62000
3: KnownLocalCachedEmbedding init done
WARNING [2439 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100007a62000
1: KnownLocalCachedEmbedding init done
WARNING [2310 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100007a62000
4: KnownLocalCachedEmbedding init done
WARNING [2440 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100007a62000
2: KnownLocalCachedEmbedding init done
WARNING [2335 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100007a62000
6: KnownLocalCachedEmbedding init done
WARNING [2632 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank7] pid = 2633
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
cudaHostRegister 0x100007a62000
0: KnownLocalCachedEmbedding init done
WARNING [1874 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100007a62000
7: KnownLocalCachedEmbedding init done
WARNING [2633 DistTensor.py:59] The tensor name already exists in the kvstore
I20240204 10:06:16.903993  2767 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240204 10:06:16.904466  2697 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:06:16.904610  2442 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:06:16.904708  2311 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:06:16.904785  2375 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:06:16.904853  2568 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:06:16.904932  2634 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240204 10:06:16.905004  2452 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240204 10:06:16.907855  2697 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 2,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240204 10:06:16.908190  2697 grad_base.h:184] Init GradProcessingBase done
I20240204 10:06:16.920574  2697 grad_async_v2.h:42] Use main thread to update emb.
W20240204 10:06:16.920698  2697 kg_controller.h:78] after init GradAsyncProcessingV2
I20240204 10:06:16.920725  2697 kg_controller.h:84] Construct KGCacheController done
E20240204 10:06:17.694049  2634 recstore.cc:66] init folly done
E20240204 10:06:17.694157  2697 recstore.cc:66] init folly done
E20240204 10:06:17.694168  2375 recstore.cc:66] init folly done
E20240204 10:06:17.694242  2452 recstore.cc:66] init folly done
E20240204 10:06:17.694262  2442 recstore.cc:66] init folly done
E20240204 10:06:17.694375  2311 recstore.cc:66] init folly done
E20240204 10:06:17.694360  2568 recstore.cc:66] init folly done
E20240204 10:06:17.694489  2767 recstore.cc:66] init folly done
I20240204 10:06:17.695648  2697 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240204 10:06:18.536348  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:06:18.536783  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240204 10:06:18.556041  2452 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240204 10:06:18.564893  2311 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:06:18.565510  2375 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:06:18.568449  2634 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:06:18.572198  2442 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:06:18.573642  2697 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:06:18.573758  2568 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240204 10:06:18.590749  2767 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240204 10:06:20.866261  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 10:06:20.908526  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240204 10:06:20.914068  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240204 10:06:20.952751  2697 grad_async_v2.h:404] Stalled in ProcessBackward: rank=7, step_no=1, sample_step_cpp_seen_[rank]=0
E20240204 10:06:21.866042  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.653 ms                  | 7.777 ms                  |
| Forward                   | 5.082 ms                  | 635.185 ms                |
| Backward                  | 6.426 ms                  | 253.745 ms                |
| Optimize                  | 2.030 ms                  | 5.977 ms                  |
| BarrierTimeBeforeRank0    | 1.322 ms                  | 27.069 ms                 |
| AfterBackward             | 42.424 ms                 | 1.415 s                   |
| BlockToStepN              | 751.717 us                | 10.192 ms                 |
| OneStep                   | 65.068 ms                 | 2.321 s                   |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:21.942718  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=13, pq.top=13
W20240204 10:06:21.944236  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 386.738 us                | 5.843 ms                  |
| ProcessBack:Shuffle       | 8.183 ms                  | 362.534 ms                |
| ProcessBack:UpdateCache   | 10.629 ms                 | 761.319 ms                |
| ProcessBack:UpsertPq      | 15.474 ms                 | 38.297 ms                 |
| ProcessOneStep            | 43.811 ms                 | 1.415 s                   |
| BlockToStepN              | 539.933 us                | 10.125 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:06:22.866065  3963 parallel_pq_v2.h:79] insert failed, size(hashtable)=14048
W20240204 10:06:22.958590  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:22.991185  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=25, pq.top=25
E20240204 10:06:23.866094  3969 parallel_pq_v2.h:79] insert failed, size(hashtable)=12142
W20240204 10:06:23.961508  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:24.012172  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=38, pq.top=38
E20240204 10:06:24.866053  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 10:06:24.966657  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:25.053998  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=51, pq.top=51
E20240204 10:06:25.866091  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=6
W20240204 10:06:25.971868  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:06:26.001214  3368 grad_async_v2.h:404] Stalled in ProcessBackward: rank=4, step_no=61, sample_step_cpp_seen_[rank]=60
W20240204 10:06:26.057446  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=62, pq.top=62
E20240204 10:06:26.866011  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=154
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.135 ms                  | 23.373 ms                 |
| Forward                   | 4.856 ms                  | 21.259 ms                 |
| Backward                  | 4.467 ms                  | 9.820 ms                  |
| Optimize                  | 1.913 ms                  | 4.086 ms                  |
| BarrierTimeBeforeRank0    | 1.322 ms                  | 16.232 ms                 |
| AfterBackward             | 46.386 ms                 | 157.750 ms                |
| BlockToStepN              | 1.208 ms                  | 14.576 ms                 |
| OneStep                   | 75.184 ms                 | 173.882 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:26.987366  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:27.094448  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=78, pq.top=78
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 488.941 us                | 7.669 ms                  |
| ProcessBack:Shuffle       | 7.921 ms                  | 13.817 ms                 |
| ProcessBack:UpdateCache   | 9.196 ms                  | 25.833 ms                 |
| ProcessBack:UpsertPq      | 15.474 ms                 | 47.153 ms                 |
| ProcessOneStep            | 45.389 ms                 | 157.215 ms                |
| BlockToStepN              | 1.020 ms                  | 14.513 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:06:27.866151  3978 parallel_pq_v2.h:79] insert failed, size(hashtable)=13293
W20240204 10:06:28.002729  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:28.121517  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=94, pq.top=94
train_sampler.Prefill()
-------Step 0-------
tensor([ 2046,    74,  4195,  2620, 13688, 14249,  1205,   438, 13586, 12771]) tensor([ 1733,  8154,  6453,  9770, 13572,   997,   582,  3226,   515, 10897])
-------Step 1-------
tensor([ 2046,    74,  4195,  2620, 13688, 14249,  1205,   438, 13586, 12771]) tensor([ 5000,  9144, 14334,  1363,  1113,  8431, 12423,  8861,  4711, 10697])
before start barrier
start train
[proc 0] 100 steps, total: 9.932, sample: 0.427, forward: 1.146, backward: 0.747, update: 0.192
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 9.937, sample: 0.337, forward: 1.065, backward: 0.735, update: 0.175
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 9.932, sample: 0.363, forward: 1.159, backward: 0.708, update: 0.191
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 9.950, sample: 0.346, forward: 1.092, backward: 0.703, update: 0.169
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 9.933, sample: 0.341, forward: 1.141, backward: 0.674, update: 0.173
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 9.941, sample: 0.347, forward: 1.118, backward: 0.690, update: 0.180
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 9.940, sample: 0.377, forward: 1.111, backward: 0.670, update: 0.184
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 9.915, sample: 0.339, forward: 1.103, backward: 0.733, update: 0.171
E20240204 10:06:28.866015  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=510
W20240204 10:06:29.010841  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:29.154795  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=111, pq.top=111
E20240204 10:06:29.866022  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=10
W20240204 10:06:30.018846  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:30.230141  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=126, pq.top=126
E20240204 10:06:30.870085  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240204 10:06:31.019960  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240204 10:06:31.061370  2697 grad_async_v2.h:404] Stalled in ProcessBackward: rank=5, step_no=138, sample_step_cpp_seen_[rank]=137
W20240204 10:06:31.249163  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=142, pq.top=142
E20240204 10:06:31.870008  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=423
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.712 ms                  | 31.333 ms                 |
| Forward                   | 4.836 ms                  | 21.259 ms                 |
| Backward                  | 4.327 ms                  | 18.772 ms                 |
| Optimize                  | 1.941 ms                  | 4.086 ms                  |
| BarrierTimeBeforeRank0    | 1.723 ms                  | 17.334 ms                 |
| AfterBackward             | 44.024 ms                 | 157.750 ms                |
| BlockToStepN              | 1.067 ms                  | 14.576 ms                 |
| OneStep                   | 68.878 ms                 | 173.882 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:32.023856  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:32.249086  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=153, pq.top=153
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 444.446 us                | 11.496 ms                 |
| ProcessBack:Shuffle       | 8.111 ms                  | 13.195 ms                 |
| ProcessBack:UpdateCache   | 10.130 ms                 | 25.833 ms                 |
| ProcessBack:UpsertPq      | 15.692 ms                 | 47.218 ms                 |
| ProcessOneStep            | 45.257 ms                 | 151.248 ms                |
| BlockToStepN              | 1.103 ms                  | 14.513 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:06:32.870095  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240204 10:06:33.023588  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:33.266856  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=164, pq.top=164
E20240204 10:06:33.870010  3969 parallel_pq_v2.h:79] insert failed, size(hashtable)=11544
W20240204 10:06:34.027735  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:34.278679  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=176, pq.top=176
E20240204 10:06:34.870011  2697 parallel_pq_v2.h:79] insert failed, size(hashtable)=2577
W20240204 10:06:35.035898  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:35.454068  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=188, pq.top=188
E20240204 10:06:35.870012  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=1010
W20240204 10:06:36.036139  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:06:36.255003  2697 grad_async_v2.h:404] Stalled in ProcessBackward: rank=5, step_no=197, sample_step_cpp_seen_[rank]=196
[proc 4] 200 steps, total: 7.907, sample: 0.324, forward: 0.464, backward: 0.506, update: 0.164
[proc 3] 200 steps, total: 7.908, sample: 0.416, forward: 0.546, backward: 0.481, update: 0.186
[proc 7] 200 steps, total: 7.907, sample: 0.405, forward: 0.511, backward: 0.501, update: 0.182
[proc 6] 200 steps, total: 7.907, sample: 0.433, forward: 0.514, backward: 0.388, update: 0.205
[proc 1] 200 steps, total: 7.907, sample: 0.365, forward: 0.476, backward: 0.457, update: 0.173
[proc 0] 200 steps, total: 7.907, sample: 0.444, forward: 0.521, backward: 0.472, update: 0.193
[proc 2] 200 steps, total: 7.907, sample: 0.408, forward: 0.504, backward: 0.428, update: 0.171
[proc 5] 200 steps, total: 7.908, sample: 0.344, forward: 0.464, backward: 0.483, update: 0.165
W20240204 10:06:36.482735  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=201, pq.top=201
E20240204 10:06:36.870008  2697 parallel_pq_v2.h:79] insert failed, size(hashtable)=2642
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.007 ms                  | 27.224 ms                 |
| Forward                   | 4.914 ms                  | 11.856 ms                 |
| Backward                  | 4.285 ms                  | 12.809 ms                 |
| Optimize                  | 1.936 ms                  | 3.345 ms                  |
| BarrierTimeBeforeRank0    | 2.281 ms                  | 31.865 ms                 |
| AfterBackward             | 46.497 ms                 | 151.292 ms                |
| BlockToStepN              | 1.572 ms                  | 15.990 ms                 |
| OneStep                   | 74.295 ms                 | 165.636 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:37.046265  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:37.531793  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=214, pq.top=214
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 579.033 us                | 12.474 ms                 |
| ProcessBack:Shuffle       | 8.120 ms                  | 13.161 ms                 |
| ProcessBack:UpdateCache   | 9.796 ms                  | 14.467 ms                 |
| ProcessBack:UpsertPq      | 17.963 ms                 | 47.218 ms                 |
| ProcessOneStep            | 46.470 ms                 | 151.248 ms                |
| BlockToStepN              | 1.530 ms                  | 15.907 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:06:37.870007  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=4936
W20240204 10:06:38.046756  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:38.591491  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=226, pq.top=226
E20240204 10:06:38.870018  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=98
W20240204 10:06:39.046483  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:39.648607  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=237, pq.top=237
E20240204 10:06:39.872642  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240204 10:06:40.048240  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:40.705876  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=249, pq.top=249
E20240204 10:06:40.872007  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=2151
W20240204 10:06:41.054769  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:41.731650  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=261, pq.top=261
E20240204 10:06:41.835516  3368 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=262, sample_step_cpp_seen_[rank]=261
E20240204 10:06:41.872005  3368 parallel_pq_v2.h:79] insert failed, size(hashtable)=2192
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.204 ms                  | 23.373 ms                 |
| Forward                   | 4.986 ms                  | 11.856 ms                 |
| Backward                  | 4.224 ms                  | 11.018 ms                 |
| Optimize                  | 1.923 ms                  | 3.106 ms                  |
| BarrierTimeBeforeRank0    | 2.469 ms                  | 30.819 ms                 |
| AfterBackward             | 47.961 ms                 | 130.287 ms                |
| BlockToStepN              | 2.368 ms                  | 17.763 ms                 |
| OneStep                   | 78.605 ms                 | 150.183 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:42.060423  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 565.881 us                | 13.742 ms                 |
| ProcessBack:Shuffle       | 8.128 ms                  | 13.161 ms                 |
| ProcessBack:UpdateCache   | 9.782 ms                  | 14.454 ms                 |
| ProcessBack:UpsertPq      | 20.019 ms                 | 47.153 ms                 |
| ProcessOneStep            | 47.735 ms                 | 130.235 ms                |
| BlockToStepN              | 2.308 ms                  | 17.621 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:42.802508  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=275, pq.top=275
E20240204 10:06:42.872009  2697 parallel_pq_v2.h:79] insert failed, size(hashtable)=9292
W20240204 10:06:43.062639  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:06:43.872007  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=117
W20240204 10:06:43.893955  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=289, pq.top=289
W20240204 10:06:44.067051  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
[proc 7] 300 steps, total: 8.373, sample: 0.323, forward: 0.439, backward: 0.470, update: 0.153
[proc 2] 300 steps, total: 8.372, sample: 0.310, forward: 0.460, backward: 0.424, update: 0.157
[proc 1] 300 steps, total: 8.373, sample: 0.425, forward: 0.539, backward: 0.474, update: 0.185
[proc 5] 300 steps, total: 8.372, sample: 0.381, forward: 0.487, backward: 0.392, update: 0.167
[proc 6] 300 steps, total: 8.373, sample: 0.371, forward: 0.448, backward: 0.448, update: 0.170
[proc 3] 300 steps, total: 8.373, sample: 0.348, forward: 0.485, backward: 0.429, update: 0.167
[proc 0] 300 steps, total: 8.373, sample: 0.447, forward: 0.522, backward: 0.429, update: 0.179
[proc 4] 300 steps, total: 8.373, sample: 0.385, forward: 0.475, backward: 0.594, update: 0.166
E20240204 10:06:44.872081  3980 parallel_pq_v2.h:79] insert failed, size(hashtable)=14430
W20240204 10:06:44.922027  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=302, pq.top=302
W20240204 10:06:45.074311  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240204 10:06:45.872006  2697 parallel_pq_v2.h:79] insert failed, size(hashtable)=181
W20240204 10:06:45.953318  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=316, pq.top=316
W20240204 10:06:46.088966  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240204 10:06:46.872007  2697 parallel_pq_v2.h:79] insert failed, size(hashtable)=9214
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.131 ms                  | 23.373 ms                 |
| Forward                   | 5.059 ms                  | 11.856 ms                 |
| Backward                  | 4.212 ms                  | 11.480 ms                 |
| Optimize                  | 1.916 ms                  | 3.106 ms                  |
| BarrierTimeBeforeRank0    | 2.852 ms                  | 32.231 ms                 |
| AfterBackward             | 46.417 ms                 | 130.287 ms                |
| BlockToStepN              | 2.604 ms                  | 17.763 ms                 |
| OneStep                   | 77.455 ms                 | 150.183 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:46.954375  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=330, pq.top=330
E20240204 10:06:47.001314  3368 grad_async_v2.h:404] Stalled in ProcessBackward: rank=6, step_no=330, sample_step_cpp_seen_[rank]=329
W20240204 10:06:47.105731  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 790.844 us                | 11.067 ms                 |
| ProcessBack:Shuffle       | 8.076 ms                  | 12.428 ms                 |
| ProcessBack:UpdateCache   | 9.836 ms                  | 14.336 ms                 |
| ProcessBack:UpsertPq      | 19.904 ms                 | 47.007 ms                 |
| ProcessOneStep            | 46.355 ms                 | 138.135 ms                |
| BlockToStepN              | 2.610 ms                  | 17.621 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:06:47.872021  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=88
W20240204 10:06:48.107657  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:48.406045  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=344, pq.top=344
E20240204 10:06:48.872043  3972 parallel_pq_v2.h:79] insert failed, size(hashtable)=14892
W20240204 10:06:49.119477  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:49.433081  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=356, pq.top=356
E20240204 10:06:49.872016  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240204 10:06:50.127313  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:50.437398  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=369, pq.top=369
E20240204 10:06:50.872103  3971 parallel_pq_v2.h:79] insert failed, size(hashtable)=7815
W20240204 10:06:51.131856  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:51.535154  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=380, pq.top=380
E20240204 10:06:51.872042  3990 parallel_pq_v2.h:79] insert failed, size(hashtable)=8359
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.130 ms                  | 23.373 ms                 |
| Forward                   | 5.039 ms                  | 10.194 ms                 |
| Backward                  | 4.222 ms                  | 11.480 ms                 |
| Optimize                  | 1.912 ms                  | 3.106 ms                  |
| BarrierTimeBeforeRank0    | 2.998 ms                  | 31.865 ms                 |
| AfterBackward             | 46.525 ms                 | 130.287 ms                |
| BlockToStepN              | 2.976 ms                  | 17.727 ms                 |
| OneStep                   | 78.198 ms                 | 155.739 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:52.136648  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:52.559646  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=389, pq.top=389
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 476.141 us                | 13.767 ms                 |
| ProcessBack:Shuffle       | 8.061 ms                  | 12.303 ms                 |
| ProcessBack:UpdateCache   | 9.928 ms                  | 14.301 ms                 |
| ProcessBack:UpsertPq      | 20.250 ms                 | 50.862 ms                 |
| ProcessOneStep            | 46.817 ms                 | 130.235 ms                |
| BlockToStepN              | 2.942 ms                  | 17.610 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:06:52.872057  3974 parallel_pq_v2.h:79] insert failed, size(hashtable)=1892
W20240204 10:06:53.140422  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:53.591984  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=399, pq.top=399
[proc 6] 400 steps, total: 8.913, sample: 0.306, forward: 0.422, backward: 0.458, update: 0.160
[proc 0] 400 steps, total: 8.913, sample: 0.503, forward: 0.529, backward: 0.447, update: 0.193
[proc 7] 400 steps, total: 8.913, sample: 0.300, forward: 0.423, backward: 0.405, update: 0.157
[proc 5] 400 steps, total: 8.913, sample: 0.332, forward: 0.478, backward: 0.467, update: 0.165
[proc 3] 400 steps, total: 8.913, sample: 0.368, forward: 0.484, backward: 0.427, update: 0.168
[proc 4] 400 steps, total: 8.913, sample: 0.318, forward: 0.461, backward: 0.549, update: 0.155
[proc 1] 400 steps, total: 8.913, sample: 0.328, forward: 0.463, backward: 0.462, update: 0.164
[proc 2] 400 steps, total: 8.913, sample: 0.339, forward: 0.464, backward: 0.463, update: 0.160
E20240204 10:06:53.872016  3961 parallel_pq_v2.h:79] insert failed, size(hashtable)=8774
W20240204 10:06:54.144415  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:54.632555  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=410, pq.top=410
E20240204 10:06:54.872035  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=140
W20240204 10:06:55.149180  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
W20240204 10:06:55.679711  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=421, pq.top=421
E20240204 10:06:55.872062  3975 parallel_pq_v2.h:79] insert failed, size(hashtable)=11070
W20240204 10:06:56.152447  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:56.716317  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=432, pq.top=432
E20240204 10:06:56.872009  3963 parallel_pq_v2.h:79] insert failed, size(hashtable)=2541
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.336 ms                  | 27.224 ms                 |
| Forward                   | 5.008 ms                  | 10.194 ms                 |
| Backward                  | 4.224 ms                  | 11.480 ms                 |
| Optimize                  | 1.904 ms                  | 3.106 ms                  |
| BarrierTimeBeforeRank0    | 2.879 ms                  | 31.865 ms                 |
| AfterBackward             | 48.066 ms                 | 130.287 ms                |
| BlockToStepN              | 4.005 ms                  | 18.901 ms                 |
| OneStep                   | 81.091 ms                 | 155.739 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:57.153756  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 596.815 us                | 16.689 ms                 |
| ProcessBack:Shuffle       | 7.983 ms                  | 12.302 ms                 |
| ProcessBack:UpdateCache   | 9.698 ms                  | 14.291 ms                 |
| ProcessBack:UpsertPq      | 22.405 ms                 | 51.625 ms                 |
| ProcessOneStep            | 48.120 ms                 | 130.235 ms                |
| BlockToStepN              | 4.132 ms                  | 18.970 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240204 10:06:57.810530  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=443, pq.top=443
E20240204 10:06:57.872057  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=6
W20240204 10:06:58.159458  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240204 10:06:58.814266  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=453, pq.top=453
E20240204 10:06:58.872009  2697 parallel_pq_v2.h:79] insert failed, size(hashtable)=821
W20240204 10:06:59.167646  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:06:59.872010  2697 parallel_pq_v2.h:79] insert failed, size(hashtable)=4256
W20240204 10:06:59.886580  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=464, pq.top=464
W20240204 10:07:00.167249  3959 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240204 10:07:00.872113  3979 parallel_pq_v2.h:79] insert failed, size(hashtable)=9861
W20240204 10:07:00.959059  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=475, pq.top=475
W20240204 10:07:01.172788  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240204 10:07:01.872042  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=31
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.516 ms                  | 26.725 ms                 |
| Forward                   | 4.908 ms                  | 9.904 ms                  |
| Backward                  | 4.215 ms                  | 11.480 ms                 |
| Optimize                  | 1.879 ms                  | 3.106 ms                  |
| BarrierTimeBeforeRank0    | 2.998 ms                  | 31.865 ms                 |
| AfterBackward             | 49.587 ms                 | 129.938 ms                |
| BlockToStepN              | 5.908 ms                  | 19.679 ms                 |
| OneStep                   | 83.216 ms                 | 150.183 ms                |
+---------------------------+---------------------------+---------------------------+
W20240204 10:07:02.016918  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=486, pq.top=486
W20240204 10:07:02.172428  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 604.394 us                | 16.674 ms                 |
| ProcessBack:Shuffle       | 7.978 ms                  | 12.303 ms                 |
| ProcessBack:UpdateCache   | 9.482 ms                  | 14.289 ms                 |
| ProcessBack:UpsertPq      | 23.930 ms                 | 50.953 ms                 |
| ProcessOneStep            | 49.926 ms                 | 129.897 ms                |
| BlockToStepN              | 6.013 ms                  | 19.541 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240204 10:07:02.872397  3959 parallel_pq_v2.h:79] insert failed, size(hashtable)=13
W20240204 10:07:03.036780  2697 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=496, pq.top=496
W20240204 10:07:03.177013  3959 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
[proc 3] 500 steps, total: 9.722, sample: 0.313, forward: 0.439, backward: 0.428, update: 0.161
[proc 5] 500 steps, total: 9.723, sample: 0.365, forward: 0.464, backward: 0.422, update: 0.165
[proc 6] 500 steps, total: 9.723, sample: 0.312, forward: 0.425, backward: 0.479, update: 0.158
[proc 2] 500 steps, total: 9.722, sample: 0.361, forward: 0.505, backward: 0.439, update: 0.186
[proc 1] 500 steps, total: 9.722, sample: 0.447, forward: 0.524, backward: 0.453, update: 0.193
[proc 4] 500 steps, total: 9.722, sample: 0.401, forward: 0.477, backward: 0.531, update: 0.172
[proc 0] 500 steps, total: 9.723, sample: 0.535, forward: 0.425, backward: 0.527, update: 0.161
[proc 7] 500 steps, total: 9.723, sample: 0.325, forward: 0.431, backward: 0.444, update: 0.154
Successfully xmh. training takes 44.849419355392456 seconds
before call kg_cache_controller.StopThreads()
W20240204 10:07:03.423207  2697 grad_async_v2.h:84] call StopThreads. PID = 1874
W20240204 10:07:03.423249  2697 grad_base.h:212] before processOneStepNegThread_.join();
W20240204 10:07:03.423662  2697 grad_base.h:214] after processOneStepNegThread_.join();
W20240204 10:07:03.423677  2697 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240204 10:07:03.427948  2697 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7faca27d1010>

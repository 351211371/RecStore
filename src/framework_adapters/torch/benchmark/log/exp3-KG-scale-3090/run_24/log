WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 01:59:37.056895 34584 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_39', no_save_emb=True, max_step=500, batch_size=800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [34584 sampler.py:454] Start PreSampling
WARNING [34584 sampler.py:532] Before construct renumbering_dict
WARNING [34584 sampler.py:555] PreSampling done
W20240123 01:59:40.482801 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240123 01:59:40.483090 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240123 01:59:40.483117 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240123 01:59:40.483146 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240123 01:59:40.483186 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240123 01:59:40.483211 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240123 01:59:40.483237 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240123 01:59:40.483269 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240123 01:59:40.483300 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240123 01:59:40.483328 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240123 01:59:40.483383 34584 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240123 01:59:40.483404 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240123 01:59:40.483422 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240123 01:59:40.483572 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240123 01:59:40.483613 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240123 01:59:40.483639 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240123 01:59:40.483675 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240123 01:59:40.483706 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240123 01:59:40.483755 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240123 01:59:40.483776 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240123 01:59:40.483796 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240123 01:59:40.483816 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240123 01:59:40.483837 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240123 01:59:40.483857 34584 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240123 01:59:40.483875 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240123 01:59:40.483892 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240123 01:59:40.483942 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240123 01:59:40.483965 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240123 01:59:40.483991 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240123 01:59:40.484019 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240123 01:59:40.484038 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240123 01:59:40.484067 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240123 01:59:40.484092 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240123 01:59:40.484112 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240123 01:59:40.484138 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240123 01:59:40.484163 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240123 01:59:40.484203 34584 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240123 01:59:40.484221 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240123 01:59:40.484243 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240123 01:59:40.484293 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240123 01:59:40.484316 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240123 01:59:40.484336 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240123 01:59:40.484357 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240123 01:59:40.484388 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240123 01:59:40.484422 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240123 01:59:40.484448 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240123 01:59:40.484472 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240123 01:59:40.484496 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240123 01:59:40.484526 34584 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240123 01:59:40.484547 34584 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240123 01:59:40.484563 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240123 01:59:40.484580 34584 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240123 01:59:40.700026 34584 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100001ee2000
W20240123 01:59:40.700158 34584 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000035b4000
{0: Graph(num_nodes=9703, num_edges=161860,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11374, num_edges=168961,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=10715, num_edges=190828,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=11184, num_edges=240046,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9703 N 161860 E
MertisPartition: part 1 has 11374 N 168961 E
MertisPartition: part 2 has 10715 N 190828 E
MertisPartition: part 3 has 11184 N 240046 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([   6,   10,   11,  ..., 5824, 6189, 2559]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 874,  968, 1002,  ..., 8168, 4814, 7137]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 3.683 seconds
[Rank1] pid = 34874
[Rank2] pid = 34914
INFO [34584 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [34874 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [34914 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [35002 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [34584 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [34874 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [35002 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [34914 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [34584 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [34874 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [35002 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [34914 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 01:59:43.005489 34939 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240123 01:59:43.005548 34875 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 01:59:43.005597 35004 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 01:59:43.005635 35003 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 01:59:43.490144 34939 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240123 01:59:43.491132 34875 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240123 01:59:43.491808 35004 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240123 01:59:43.492525 35003 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.727 ms                  | 23.001 ms                 |
| bucket keys               | 1.065 ms                  | 126.204 ms                |
| forward: a2a keys         | 1.231 ms                  | 707.657 ms                |
| forward: search cache     | 215.383 us                | 18.967 ms                 |
| forward: a2a values       | 1.592 ms                  | 3.932 ms                  |
| forward: join             | 1.434 ms                  | 2.116 ms                  |
| Forward                   | 18.062 ms                 | 1.476 s                   |
| back: aggr dram keys      | 24.664 ms                 | 366.754 ms                |
| back: set dram grad       | 1.656 ms                  | 3.866 ms                  |
| back: a2a grad            | 2.861 ms                  | 4.461 ms                  |
| back: grad sum & grad cache  | 1.330 ms                  | 2.919 ms                  |
| Backward                  | 68.647 ms                 | 565.383 ms                |
| Optimize                  | 12.344 ms                 | 20.230 ms                 |
| BarrierTimeBeforeRank0    | 62.430 us                 | 284.242 us                |
| BlockToStepN              | 20.702 us                 | 64.236 us                 |
| OneStep                   | 103.655 ms                | 2.056 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.516 ms                  | 17.509 ms                 |
| bucket keys               | 1.199 ms                  | 2.077 ms                  |
| forward: a2a keys         | 1.488 ms                  | 7.401 ms                  |
| forward: search cache     | 221.517 us                | 369.822 us                |
| forward: a2a values       | 1.661 ms                  | 3.359 ms                  |
| forward: join             | 1.446 ms                  | 2.116 ms                  |
| Forward                   | 18.411 ms                 | 26.801 ms                 |
| back: aggr dram keys      | 23.977 ms                 | 38.250 ms                 |
| back: set dram grad       | 1.614 ms                  | 3.587 ms                  |
| back: a2a grad            | 2.832 ms                  | 4.367 ms                  |
| back: grad sum & grad cache  | 1.397 ms                  | 2.556 ms                  |
| Backward                  | 67.362 ms                 | 77.585 ms                 |
| Optimize                  | 12.273 ms                 | 20.089 ms                 |
| BarrierTimeBeforeRank0    | 54.000 us                 | 212.053 us                |
| BlockToStepN              | 24.895 us                 | 64.236 us                 |
| OneStep                   | 101.722 ms                | 131.727 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 12.109, sample: 0.246, forward: 3.335, backward: 7.099, update: 0.166
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 12.110, sample: 0.306, forward: 3.303, backward: 7.074, update: 0.202
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 12.108, sample: 0.294, forward: 3.301, backward: 7.080, update: 0.186
[Rank3] pid = 35002
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 6475,  8433, 12795,  2046,   129,  5893,  9469,    52,    71, 11185]) tensor([ 1002, 10564,  2901, 11966,  2479,  7385,  4518,  6706,  3371, 14143])
-------Step 1-------
tensor([ 6475,  8433, 12795,  2046,   129,  5893,  9469,    52,    71, 11185]) tensor([ 7000, 12785,  5287, 11620,  4967, 13246,  2922, 14506,  6029,  5517])
-------Step 2-------
tensor([ 1962,  2932,  2585,  5355,  7758,    53,  6088,  1395, 10119,  1594]) tensor([ 6602,  5715,  2062,  5296, 10597,  1656, 10910,  8718,   476,  7047])
-------Step 3-------
tensor([ 1962,  2932,  2585,  5355,  7758,    53,  6088,  1395, 10119,  1594]) tensor([11078,  8039,  6030,  9518, 14226,  6334,  8995,  7661,  8341,  2572])
-------Step 4-------
tensor([ 4270,    22, 13556,  6204, 14821,  3930,  8704,  7613,  3053, 10399]) tensor([ 6463,  7953, 12132, 13528,  8214, 14170,  1854, 10963,  1515,  2650])
-------Step 5-------
tensor([ 4270,    22, 13556,  6204, 14821,  3930,  8704,  7613,  3053, 10399]) tensor([ 2447,  7522,  9991,   553,  6619, 12254,  5672,  8074, 10405, 12745])
-------Step 6-------
tensor([13116,  7224,  5356,  2719,  6124, 10829,  9342, 14597,    35, 10413]) tensor([  687,  5737, 11928,  9698,  3336,    45,  2534,  3742, 11095,  7167])
-------Step 7-------
tensor([13116,  7224,  5356,  2719,  6124, 10829,  9342, 14597,    35, 10413]) tensor([ 4332,  3118,  7492, 14565,  5575,  4387,  2084, 12235, 14148,   578])
-------Step 8-------
tensor([11735, 14013, 12372,  8736,   258,  3660, 10384,  7651,  4955,    58]) tensor([  982, 12160, 10686,  3539,  3822,   251,  7560, 12240, 12922,  5425])
-------Step 9-------
tensor([11735, 14013, 12372,  8736,   258,  3660, 10384,  7651,  4955,    58]) tensor([ 3585, 10408,  9310,  7860,   272, 11302, 10492,  2150,  6282, 10364])
before start barrier
start train
[proc 0] 100 steps, total: 12.108, sample: 0.328, forward: 3.278, backward: 7.162, update: 1.248
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.521 ms                  | 17.762 ms                 |
| bucket keys               | 1.214 ms                  | 2.111 ms                  |
| forward: a2a keys         | 1.413 ms                  | 6.269 ms                  |
| forward: search cache     | 221.658 us                | 361.132 us                |
| forward: a2a values       | 1.654 ms                  | 3.359 ms                  |
| forward: join             | 1.443 ms                  | 2.036 ms                  |
| Forward                   | 18.211 ms                 | 26.801 ms                 |
| back: aggr dram keys      | 23.752 ms                 | 37.059 ms                 |
| back: set dram grad       | 1.595 ms                  | 3.108 ms                  |
| back: a2a grad            | 2.799 ms                  | 4.213 ms                  |
| back: grad sum & grad cache  | 1.397 ms                  | 2.533 ms                  |
| Backward                  | 66.439 ms                 | 77.585 ms                 |
| Optimize                  | 12.221 ms                 | 20.089 ms                 |
| BarrierTimeBeforeRank0    | 52.537 us                 | 212.053 us                |
| BlockToStepN              | 23.805 us                 | 64.236 us                 |
| OneStep                   | 99.700 ms                 | 131.727 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.501 ms                  | 17.509 ms                 |
| bucket keys               | 1.222 ms                  | 2.114 ms                  |
| forward: a2a keys         | 1.394 ms                  | 6.038 ms                  |
| forward: search cache     | 223.631 us                | 369.822 us                |
| forward: a2a values       | 1.629 ms                  | 2.642 ms                  |
| forward: join             | 1.447 ms                  | 2.441 ms                  |
| Forward                   | 18.044 ms                 | 23.776 ms                 |
| back: aggr dram keys      | 23.682 ms                 | 36.255 ms                 |
| back: set dram grad       | 1.609 ms                  | 3.108 ms                  |
| back: a2a grad            | 2.788 ms                  | 4.213 ms                  |
| back: grad sum & grad cache  | 1.785 ms                  | 2.381 ms                  |
| Backward                  | 66.412 ms                 | 76.273 ms                 |
| Optimize                  | 12.216 ms                 | 19.454 ms                 |
| BarrierTimeBeforeRank0    | 52.328 us                 | 208.620 us                |
| BlockToStepN              | 22.942 us                 | 64.236 us                 |
| OneStep                   | 99.667 ms                 | 117.435 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 200 steps, total: 10.025, sample: 0.299, forward: 1.768, backward: 6.529, update: 0.175
[proc 1] 200 steps, total: 10.025, sample: 0.179, forward: 1.860, backward: 6.569, update: 0.125
[proc 0] 200 steps, total: 10.025, sample: 0.333, forward: 1.748, backward: 6.620, update: 1.232
[proc 2] 200 steps, total: 10.025, sample: 0.313, forward: 1.754, backward: 6.542, update: 0.180
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.544 ms                  | 17.509 ms                 |
| bucket keys               | 1.222 ms                  | 2.114 ms                  |
| forward: a2a keys         | 1.384 ms                  | 6.003 ms                  |
| forward: search cache     | 221.822 us                | 372.545 us                |
| forward: a2a values       | 1.629 ms                  | 2.508 ms                  |
| forward: join             | 1.455 ms                  | 2.441 ms                  |
| Forward                   | 18.038 ms                 | 23.862 ms                 |
| back: aggr dram keys      | 23.682 ms                 | 36.255 ms                 |
| back: set dram grad       | 1.641 ms                  | 3.110 ms                  |
| back: a2a grad            | 2.808 ms                  | 3.878 ms                  |
| back: grad sum & grad cache  | 1.785 ms                  | 2.556 ms                  |
| Backward                  | 66.989 ms                 | 76.273 ms                 |
| Optimize                  | 12.240 ms                 | 19.454 ms                 |
| BarrierTimeBeforeRank0    | 52.396 us                 | 208.620 us                |
| BlockToStepN              | 22.543 us                 | 94.251 us                 |
| OneStep                   | 100.030 ms                | 119.350 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.501 ms                  | 16.995 ms                 |
| bucket keys               | 1.214 ms                  | 2.114 ms                  |
| forward: a2a keys         | 1.379 ms                  | 5.135 ms                  |
| forward: search cache     | 224.740 us                | 393.338 us                |
| forward: a2a values       | 1.621 ms                  | 2.582 ms                  |
| forward: join             | 1.464 ms                  | 2.441 ms                  |
| Forward                   | 17.956 ms                 | 23.862 ms                 |
| back: aggr dram keys      | 23.682 ms                 | 36.207 ms                 |
| back: set dram grad       | 1.650 ms                  | 3.108 ms                  |
| back: a2a grad            | 2.799 ms                  | 3.812 ms                  |
| back: grad sum & grad cache  | 1.785 ms                  | 2.556 ms                  |
| Backward                  | 66.706 ms                 | 76.029 ms                 |
| Optimize                  | 12.240 ms                 | 20.089 ms                 |
| BarrierTimeBeforeRank0    | 52.501 us                 | 194.119 us                |
| BlockToStepN              | 22.473 us                 | 81.032 us                 |
| OneStep                   | 99.667 ms                 | 119.350 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 300 steps, total: 10.099, sample: 0.275, forward: 1.777, backward: 6.604, update: 0.183
[proc 3] 300 steps, total: 10.100, sample: 0.270, forward: 1.787, backward: 6.592, update: 0.179
[proc 1] 300 steps, total: 10.100, sample: 0.289, forward: 1.772, backward: 6.605, update: 0.193
[proc 0] 300 steps, total: 10.100, sample: 0.311, forward: 1.757, backward: 6.695, update: 1.244
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.516 ms                  | 16.995 ms                 |
| bucket keys               | 1.215 ms                  | 2.202 ms                  |
| forward: a2a keys         | 1.380 ms                  | 5.135 ms                  |
| forward: search cache     | 223.162 us                | 377.151 us                |
| forward: a2a values       | 1.608 ms                  | 2.582 ms                  |
| forward: join             | 1.465 ms                  | 2.441 ms                  |
| Forward                   | 17.931 ms                 | 24.881 ms                 |
| back: aggr dram keys      | 23.936 ms                 | 36.207 ms                 |
| back: set dram grad       | 1.649 ms                  | 3.110 ms                  |
| back: a2a grad            | 2.796 ms                  | 4.213 ms                  |
| back: grad sum & grad cache  | 1.785 ms                  | 2.901 ms                  |
| Backward                  | 66.774 ms                 | 76.067 ms                 |
| Optimize                  | 12.240 ms                 | 20.089 ms                 |
| BarrierTimeBeforeRank0    | 52.657 us                 | 208.620 us                |
| BlockToStepN              | 22.681 us                 | 86.027 us                 |
| OneStep                   | 99.671 ms                 | 119.350 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.516 ms                  | 16.972 ms                 |
| bucket keys               | 1.222 ms                  | 2.213 ms                  |
| forward: a2a keys         | 1.364 ms                  | 4.979 ms                  |
| forward: search cache     | 224.684 us                | 376.468 us                |
| forward: a2a values       | 1.591 ms                  | 2.549 ms                  |
| forward: join             | 1.469 ms                  | 2.439 ms                  |
| Forward                   | 17.926 ms                 | 23.862 ms                 |
| back: aggr dram keys      | 23.977 ms                 | 36.117 ms                 |
| back: set dram grad       | 1.652 ms                  | 3.108 ms                  |
| back: a2a grad            | 2.792 ms                  | 3.878 ms                  |
| back: grad sum & grad cache  | 1.785 ms                  | 2.901 ms                  |
| Backward                  | 67.141 ms                 | 76.029 ms                 |
| Optimize                  | 12.221 ms                 | 19.454 ms                 |
| BarrierTimeBeforeRank0    | 52.657 us                 | 194.119 us                |
| BlockToStepN              | 22.681 us                 | 86.027 us                 |
| OneStep                   | 99.870 ms                 | 119.350 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 10.196, sample: 0.264, forward: 1.828, backward: 6.691, update: 0.180
[proc 3] 400 steps, total: 10.196, sample: 0.281, forward: 1.812, backward: 6.671, update: 0.174
[proc 0] 400 steps, total: 10.196, sample: 0.348, forward: 1.756, backward: 6.777, update: 1.220
[proc 1] 400 steps, total: 10.196, sample: 0.298, forward: 1.797, backward: 6.688, update: 0.196
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.496 ms                  | 17.762 ms                 |
| bucket keys               | 1.221 ms                  | 2.202 ms                  |
| forward: a2a keys         | 1.367 ms                  | 6.467 ms                  |
| forward: search cache     | 222.688 us                | 376.468 us                |
| forward: a2a values       | 1.575 ms                  | 2.549 ms                  |
| forward: join             | 1.465 ms                  | 2.427 ms                  |
| Forward                   | 17.928 ms                 | 26.801 ms                 |
| back: aggr dram keys      | 23.977 ms                 | 36.207 ms                 |
| back: set dram grad       | 1.656 ms                  | 3.077 ms                  |
| back: a2a grad            | 2.786 ms                  | 4.213 ms                  |
| back: grad sum & grad cache  | 1.790 ms                  | 2.885 ms                  |
| Backward                  | 67.217 ms                 | 76.273 ms                 |
| Optimize                  | 12.210 ms                 | 20.089 ms                 |
| BarrierTimeBeforeRank0    | 52.539 us                 | 194.119 us                |
| BlockToStepN              | 22.714 us                 | 182.534 us                |
| OneStep                   | 99.874 ms                 | 123.308 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.533 ms                  | 17.509 ms                 |
| bucket keys               | 1.217 ms                  | 2.213 ms                  |
| forward: a2a keys         | 1.370 ms                  | 12.736 ms                 |
| forward: search cache     | 218.986 us                | 374.640 us                |
| forward: a2a values       | 1.569 ms                  | 2.508 ms                  |
| forward: join             | 1.464 ms                  | 2.408 ms                  |
| Forward                   | 17.967 ms                 | 28.904 ms                 |
| back: aggr dram keys      | 23.999 ms                 | 36.255 ms                 |
| back: set dram grad       | 1.664 ms                  | 3.108 ms                  |
| back: a2a grad            | 2.787 ms                  | 4.213 ms                  |
| back: grad sum & grad cache  | 1.790 ms                  | 2.840 ms                  |
| Backward                  | 67.245 ms                 | 77.585 ms                 |
| Optimize                  | 12.213 ms                 | 19.454 ms                 |
| BarrierTimeBeforeRank0    | 52.724 us                 | 194.119 us                |
| BlockToStepN              | 22.751 us                 | 111.389 us                |
| OneStep                   | 100.103 ms                | 123.308 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 500 steps, total: 10.424, sample: 0.279, forward: 2.074, backward: 6.612, update: 0.178
[proc 1] 500 steps, total: 10.424, sample: 0.318, forward: 2.039, backward: 6.623, update: 0.192
[proc 2] 500 steps, total: 10.424, sample: 0.319, forward: 2.035, backward: 6.625, update: 0.183
[proc 0] 500 steps, total: 10.424, sample: 0.329, forward: 2.035, backward: 6.708, update: 1.257
Successfully xmh. training takes 52.85264611244202 seconds
before call kg_cache_controller.StopThreads()
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
INFO [34584 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.533 ms                  | 17.509 ms                 |
| bucket keys               | 1.217 ms                  | 2.202 ms                  |
| forward: a2a keys         | 1.367 ms                  | 13.413 ms                 |
| forward: search cache     | 216.794 us                | 372.545 us                |
| forward: a2a values       | 1.572 ms                  | 2.508 ms                  |
| forward: join             | 1.462 ms                  | 2.400 ms                  |
| Forward                   | 17.974 ms                 | 28.904 ms                 |
| back: aggr dram keys      | 24.117 ms                 | 36.255 ms                 |
| back: set dram grad       | 1.665 ms                  | 3.077 ms                  |
| back: a2a grad            | 2.790 ms                  | 4.157 ms                  |
| back: grad sum & grad cache  | 1.790 ms                  | 2.648 ms                  |
| Backward                  | 67.180 ms                 | 77.585 ms                 |
| Optimize                  | 12.210 ms                 | 19.454 ms                 |
| BarrierTimeBeforeRank0    | 52.724 us                 | 194.119 us                |
| BlockToStepN              | 22.778 us                 | 111.389 us                |
| OneStep                   | 100.190 ms                | 123.308 ms                |
+---------------------------+---------------------------+---------------------------+

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 20:39:16.230937 61996 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_32', no_save_emb=True, max_step=500, batch_size=1600, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [61996 sampler.py:454] Start PreSampling
WARNING [61996 sampler.py:532] Before construct renumbering_dict
WARNING [61996 sampler.py:555] PreSampling done
W20240123 20:52:10.867755 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240123 20:52:10.867975 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240123 20:52:10.868000 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240123 20:52:10.868033 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240123 20:52:10.868055 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240123 20:52:10.868075 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240123 20:52:10.868096 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240123 20:52:10.868142 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240123 20:52:10.868173 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240123 20:52:10.868196 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240123 20:52:10.868218 61996 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240123 20:52:10.868242 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240123 20:52:10.868259 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240123 20:52:10.868392 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240123 20:52:10.868419 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240123 20:52:10.868438 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240123 20:52:10.868469 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240123 20:52:10.868491 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240123 20:52:10.868520 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240123 20:52:10.868539 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240123 20:52:10.868566 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240123 20:52:10.868582 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240123 20:52:10.868602 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240123 20:52:10.868623 61996 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240123 20:52:10.868638 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240123 20:52:10.868656 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240123 20:52:10.868702 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240123 20:52:10.868721 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240123 20:52:10.868747 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240123 20:52:10.868767 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240123 20:52:10.868788 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240123 20:52:10.868831 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240123 20:52:10.868857 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240123 20:52:10.868878 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240123 20:52:10.868904 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240123 20:52:10.868932 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240123 20:52:10.868949 61996 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240123 20:52:10.868963 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240123 20:52:10.868983 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240123 20:52:10.869027 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240123 20:52:10.869045 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240123 20:52:10.869074 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240123 20:52:10.869092 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240123 20:52:10.869113 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240123 20:52:10.869138 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240123 20:52:10.869156 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240123 20:52:10.869177 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240123 20:52:10.869202 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240123 20:52:10.869222 61996 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240123 20:52:10.869244 61996 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240123 20:52:10.869258 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240123 20:52:10.869277 61996 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240123 20:52:11.207540 61996 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100001ee2000 128.2 GB
W20240123 20:52:11.207710 61996 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102010b1a000 328.3 MB
{0: Graph(num_nodes=27256011, num_edges=100992629,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23779591, num_edges=94535774,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=26463902, num_edges=75890617,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=25398646, num_edges=93789131,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27256011 N 100992629 E
MertisPartition: part 1 has 23779591 N 94535774 E
MertisPartition: part 2 has 26463902 N 75890617 E
MertisPartition: part 3 has 25398646 N 93789131 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 4302752,  4302783,   293500,  ...,  3563065, 16048501, 71223477]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 3, 3])}
part_g: DGLGraph(num_nodes=27256011, num_edges=100992629,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27256011, num_edges=100992629,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 950.258 seconds
[Rank1] pid = 21165
[Rank2] pid = 21265
INFO [61996 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [21265 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [21265 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [21333 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [21165 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [21333 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [21165 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [61996 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240123 20:55:10.222934 21366 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240123 20:55:10.223088 21266 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240123 20:55:10.223570 21334 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240123 20:55:10.223620 21166 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240123 20:55:10.287786 21366 IPCTensor.h:365] NewIPCTensor: input_keys_0 [100000]0x102025369000 781.2 kB
W20240123 20:55:10.287791 21166 IPCTensor.h:365] NewIPCTensor: input_keys_1 [100000]0x10202542e000 781.2 kB
W20240123 20:55:10.287812 21266 IPCTensor.h:365] NewIPCTensor: input_keys_2 [100000]0x1020254f3000 781.2 kB
W20240123 20:55:10.287817 21334 IPCTensor.h:365] NewIPCTensor: input_keys_3 [100000]0x1020255b8000 781.2 kB
W20240123 20:55:10.288081 21334 IPCTensor.h:365] NewIPCTensor: input_keys_neg_3 [100000]0x10202567d000 781.2 kB
W20240123 20:55:10.288105 21366 IPCTensor.h:365] NewIPCTensor: input_keys_neg_0 [100000]0x102025742000 781.2 kB
W20240123 20:55:10.288120 21266 IPCTensor.h:365] NewIPCTensor: input_keys_neg_2 [100000]0x102025807000 781.2 kB
W20240123 20:55:10.288125 21166 IPCTensor.h:365] NewIPCTensor: input_keys_neg_1 [100000]0x1020258cc000 781.2 kB
W20240123 20:55:10.288180 21334 IPCTensor.h:365] NewIPCTensor: backward_grads_3 [100000, 400]0x102025991000 152.6 MB
W20240123 20:55:10.288185 21366 IPCTensor.h:365] NewIPCTensor: backward_grads_0 [100000, 400]0x10202f229000 152.6 MB
W20240123 20:55:10.288213 21266 IPCTensor.h:365] NewIPCTensor: backward_grads_2 [100000, 400]0x102038ac1000 152.6 MB
W20240123 20:55:10.288221 21166 IPCTensor.h:365] NewIPCTensor: backward_grads_1 [100000, 400]0x102042359000 152.6 MB
W20240123 20:55:10.288223 21366 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x10204bbf1000 152.6 MB
W20240123 20:55:10.288259 21334 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x102055489000 152.6 MB
W20240123 20:55:10.288275 21266 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x10205ed21000 152.6 MB
W20240123 20:55:10.288282 21166 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x1020685b9000 152.6 MB
W20240123 20:55:10.288286 21366 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 20:55:10.288331 21166 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 20:55:10.288345 21266 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 20:55:10.288350 21334 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 20:55:10.290222 21166 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 20:55:10.290246 21266 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 20:55:10.290251 21366 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 20:55:10.290289 21334 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
[Rank3] pid = 21333
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100001ee2000
0: KnownLocalCachedEmbedding init done
WARNING [61996 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
2: KnownLocalCachedEmbedding init done
WARNING [21265 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
1: KnownLocalCachedEmbedding init done
WARNING [21165 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
3: KnownLocalCachedEmbedding init done
WARNING [21333 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 20:55:38.498720 21334 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240123 20:55:38.498754 21366 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 20:55:38.498800 21266 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 20:55:38.498834 21166 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240123 20:55:38.499841 21366 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240123 20:55:38.499939 21366 grad_base.h:172] Init GradProcessingBase done
I20240123 20:55:48.504895 21366 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240123 20:55:48.505246 21366 kg_controller.h:78] after init GradAsyncProcessingV2
I20240123 20:55:48.505254 21366 kg_controller.h:84] Construct KGCacheController done
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
I20240123 20:55:49.944700 21366 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240123 20:56:02.906625 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 20:56:02.906888 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 20:56:05.684026 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 20:56:05.684185 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 20:56:07.920876 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 20:56:07.921028 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 20:56:10.130877 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 20:56:10.138300 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240123 20:56:10.390841 21366 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240123 20:56:10.943578 21166 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240123 20:56:11.138023 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 20:56:11.158179 22722 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end0
W20240123 20:56:15.207597 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 20:56:15.222615 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240123 20:56:15.310267 21266 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240123 20:56:19.570777 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 20:56:19.584400 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240123 20:56:19.670351 21334 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240123 20:56:21.133531 21366 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 20:56:21.187379 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240123 20:56:21.206699 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 20:56:22.133483 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=704
W20240123 20:56:22.200657 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=13, pq.top=13
W20240123 20:56:22.209815 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
E20240123 20:56:23.139079 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=2017
W20240123 20:56:23.200011 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=25, pq.top=25
W20240123 20:56:23.382766 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.085 ms                  | 88.153 ms                 |
| Forward                   | 4.415 ms                  | 792.855 ms                |
| Backward                  | 3.938 ms                  | 204.940 ms                |
| Optimize                  | 1.671 ms                  | 2.155 ms                  |
| BarrierTimeBeforeRank0    | 2.562 ms                  | 48.006 ms                 |
| AfterBackward             | 25.755 ms                 | 487.170 ms                |
| BlockToStepN              | 14.095 ms                 | 66.998 ms                 |
| OneStep                   | 94.581 ms                 | 1.532 s                   |
+---------------------------+---------------------------+---------------------------+
E20240123 20:56:24.139698 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=17
W20240123 20:56:24.452617 22722 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end9
W20240123 20:56:24.640357 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=39, pq.top=39
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.998 ms                  | 120.531 ms                |
| ProcessBack:UpdateCache   | 2.433 ms                  | 308.965 ms                |
| ProcessBack:UpsertPq      | 10.723 ms                 | 39.842 ms                 |
| ProcessOneStep            | 25.727 ms                 | 486.989 ms                |
| BlockToStepN              | 14.041 ms                 | 66.916 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 20:56:25.139104 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=125
W20240123 20:56:25.499936 22722 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end2
W20240123 20:56:25.738833 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=55, pq.top=55
E20240123 20:56:26.139014 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=6
W20240123 20:56:26.525908 22722 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end3
W20240123 20:56:26.803131 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=67, pq.top=67
E20240123 20:56:27.139010 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=10717
W20240123 20:56:27.576001 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end7
E20240123 20:56:28.139019 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=21
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.499 ms                  | 88.153 ms                 |
| Forward                   | 4.581 ms                  | 6.733 ms                  |
| Backward                  | 4.103 ms                  | 6.845 ms                  |
| Optimize                  | 1.806 ms                  | 4.990 ms                  |
| BarrierTimeBeforeRank0    | 1.462 ms                  | 37.955 ms                 |
| AfterBackward             | 25.065 ms                 | 487.170 ms                |
| BlockToStepN              | 13.658 ms                 | 64.165 ms                 |
| OneStep                   | 70.884 ms                 | 819.578 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:28.515328 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=79, pq.top=79
W20240123 20:56:28.610594 22722 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end1
E20240123 20:56:29.139027 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=7797
W20240123 20:56:29.576849 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=91, pq.top=91
W20240123 20:56:29.611194 22722 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.043 ms                  | 12.281 ms                 |
| ProcessBack:UpdateCache   | 2.386 ms                  | 26.939 ms                 |
| ProcessBack:UpsertPq      | 12.295 ms                 | 50.239 ms                 |
| ProcessOneStep            | 26.225 ms                 | 486.989 ms                |
| BlockToStepN              | 11.930 ms                 | 64.105 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 20:56:30.139532 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=1048
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 15.035, sample: 1.033, forward: 1.362, backward: 0.637, update: 0.187
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 10.675, sample: 0.921, forward: 1.257, backward: 0.601, update: 0.178
train_sampler.Prefill()
-------Step 0-------
tensor([  727473,  4492601,   727496,   727526,   727552,   727574, 56708764,
          185079,  4308496,   727603]) tensor([ 4764512, 32068141, 19268389, 40746986, 57001085, 30913378, 76750524,
        59157725, 62741486, 35837895])
-------Step 1-------
tensor([  727473,  4492601,   727496,   727526,   727552,   727574, 56708764,
          185079,  4308496,   727603]) tensor([23504175, 28328677, 26498267, 84914963, 76532033, 37686547, 56573426,
        41645833, 18729595, 49059278])
-------Step 2-------
tensor([  790118,   790144,   790180,   790211,   790242, 21374769,   379879,
          574429,   790276,   790300]) tensor([ 9696698, 42097743, 48440393, 65190594, 53308223,  6283445,  7113036,
        50590216, 77673776, 79934094])
-------Step 3-------
tensor([  790118,   790144,   790180,   790211,   790242, 21374769,   379879,
          574429,   790276,   790300]) tensor([59998298, 47721827, 61301336, 43346070,  9465582, 27535713, 52236213,
         2078569, 47485901, 20081507])
-------Step 4-------
tensor([852258, 852286, 852309, 852353, 852380, 852402, 852436, 861733, 852465,
        577488]) tensor([84234171, 64389300, 84029502, 49619411, 79441810, 20919504, 19477695,
         4941142, 53087019,  5070475])
-------Step 5-------
tensor([852258, 852286, 852309, 852353, 852380, 852402, 852436, 861733, 852465,
        577488]) tensor([30902035, 76863321, 20596751, 23164294, 31549349, 17551793, 41119037,
        76878681,   912808, 76330106])
-------Step 6-------
tensor([  914720,   914744,   914775, 74257539,   382752,   914804,   914839,
          914866,   914893,   914919]) tensor([12169515, 81513300, 62375045, 68736507, 71245263, 48180160, 48189242,
         1046098, 73290481, 42725825])
-------Step 7-------
tensor([  914720,   914744,   914775, 74257539,   382752,   914804,   914839,
          914866,   914893,   914919]) tensor([20563435, 80477430, 70227564, 84347121, 76514254, 38430259, 79561403,
        81684421, 85134109, 54179602])
-------Step 8-------
tensor([  976181,   976206,   976226,   976247, 49325127,   583311,   976275,
          583326,   530736,   976304]) tensor([  443857, 32690417, 68286311, 70035298, 12098109,  1429179, 45455094,
        32602790, 32761141, 61947264])
-------Step 9-------
tensor([  976181,   976206,   976226,   976247, 49325127,   583311,   976275,
          583326,   530736,   976304]) tensor([51324799, 60756744,  4597446, 19665358, 49321717, 38030885, 29011989,
        13637250, 10434652, 10691739])
before start barrier
start train
[proc 0] 100 steps, total: 19.955, sample: 1.482, forward: 1.253, backward: 0.617, update: 0.178
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 19.402, sample: 1.123, forward: 1.326, backward: 0.629, update: 0.217
W20240123 20:56:30.699378 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=103, pq.top=103
W20240123 20:56:30.742391 22722 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end3
E20240123 20:56:31.139014 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1109
W20240123 20:56:31.760514 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=113, pq.top=113
W20240123 20:56:31.888698 22722 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end5
E20240123 20:56:32.139024 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1796
W20240123 20:56:32.796268 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=124, pq.top=123
W20240123 20:56:33.024507 22722 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end7
E20240123 20:56:33.139012 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=3128
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.211 ms                  | 126.806 ms                |
| Forward                   | 4.631 ms                  | 19.147 ms                 |
| Backward                  | 3.941 ms                  | 15.776 ms                 |
| Optimize                  | 1.763 ms                  | 4.990 ms                  |
| BarrierTimeBeforeRank0    | 756.608 us                | 48.006 ms                 |
| AfterBackward             | 27.845 ms                 | 487.170 ms                |
| BlockToStepN              | 13.851 ms                 | 64.165 ms                 |
| OneStep                   | 76.060 ms                 | 819.578 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:33.938419 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=137, pq.top=137
E20240123 20:56:34.139062 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=2436
W20240123 20:56:34.176620 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.078 ms                  | 6.509 ms                  |
| ProcessBack:UpdateCache   | 2.324 ms                  | 26.425 ms                 |
| ProcessBack:UpsertPq      | 12.755 ms                 | 51.555 ms                 |
| ProcessOneStep            | 27.871 ms                 | 486.989 ms                |
| BlockToStepN              | 14.622 ms                 | 64.105 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:34.970758 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=150, pq.top=150
E20240123 20:56:35.139011 21366 parallel_pq_v2.h:76] insert failed, size(hashtable)=1614
W20240123 20:56:35.230355 22722 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end1
W20240123 20:56:35.970252 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=159, pq.top=159
E20240123 20:56:36.139014 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=46958
W20240123 20:56:36.394152 22722 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end3
W20240123 20:56:37.063571 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=169, pq.top=169
E20240123 20:56:37.139010 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=2219
W20240123 20:56:37.432653 22722 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end4
W20240123 20:56:38.063267 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=181, pq.top=181
E20240123 20:56:38.139014 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=34889
W20240123 20:56:38.481853 22722 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.681 ms                  | 123.484 ms                |
| Forward                   | 4.628 ms                  | 10.344 ms                 |
| Backward                  | 3.894 ms                  | 7.258 ms                  |
| Optimize                  | 1.790 ms                  | 4.114 ms                  |
| BarrierTimeBeforeRank0    | 49.813 us                 | 37.955 ms                 |
| AfterBackward             | 28.561 ms                 | 395.791 ms                |
| BlockToStepN              | 18.437 ms                 | 79.617 ms                 |
| OneStep                   | 86.467 ms                 | 502.886 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 20:56:39.139010 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=965
W20240123 20:56:39.508507 22722 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 20:56:39.548748 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=193, pq.top=193
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.091 ms                  | 6.509 ms                  |
| ProcessBack:UpdateCache   | 2.233 ms                  | 5.430 ms                  |
| ProcessBack:UpsertPq      | 12.725 ms                 | 61.288 ms                 |
| ProcessOneStep            | 29.187 ms                 | 395.730 ms                |
| BlockToStepN              | 17.563 ms                 | 79.968 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 20:56:40.139012 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=666
[proc 2] 200 steps, total: 10.036, sample: 1.097, forward: 0.433, backward: 0.464, update: 0.179
[proc 3] 200 steps, total: 10.036, sample: 1.133, forward: 0.452, backward: 0.418, update: 0.173
[proc 1] 200 steps, total: 10.036, sample: 1.173, forward: 0.405, backward: 0.491, update: 0.169
[proc 0] 200 steps, total: 10.036, sample: 2.051, forward: 0.495, backward: 0.379, update: 0.202
W20240123 20:56:40.519732 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240123 20:56:40.639726 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=203, pq.top=203
E20240123 20:56:41.139009 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1399
W20240123 20:56:41.566181 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
W20240123 20:56:41.639097 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=213, pq.top=213
E20240123 20:56:42.139011 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=27063
W20240123 20:56:42.598242 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240123 20:56:42.773423 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=223, pq.top=223
E20240123 20:56:43.139012 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=8266
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.302 ms                  | 123.484 ms                |
| Forward                   | 4.760 ms                  | 19.147 ms                 |
| Backward                  | 3.918 ms                  | 7.258 ms                  |
| Optimize                  | 1.873 ms                  | 4.990 ms                  |
| BarrierTimeBeforeRank0    | 35.518 us                 | 37.955 ms                 |
| AfterBackward             | 29.651 ms                 | 395.791 ms                |
| BlockToStepN              | 18.437 ms                 | 81.064 ms                 |
| OneStep                   | 93.320 ms                 | 502.886 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:43.612362 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240123 20:56:43.951651 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=233, pq.top=233
E20240123 20:56:44.139009 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=19892
W20240123 20:56:44.612239 22722 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.174 ms                  | 6.515 ms                  |
| ProcessBack:UpdateCache   | 2.279 ms                  | 5.200 ms                  |
| ProcessBack:UpsertPq      | 12.774 ms                 | 71.456 ms                 |
| ProcessOneStep            | 29.827 ms                 | 395.730 ms                |
| BlockToStepN              | 17.760 ms                 | 80.987 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:44.951754 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=243, pq.top=243
E20240123 20:56:45.139010 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=18593
W20240123 20:56:45.668274 22722 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 20:56:46.098392 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=251, pq.top=251
E20240123 20:56:46.139021 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=29678
W20240123 20:56:46.764142 22722 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end8
W20240123 20:56:47.131024 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=262, pq.top=262
E20240123 20:56:47.139009 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=2550
W20240123 20:56:47.764536 22722 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end7
E20240123 20:56:48.139051 21366 parallel_pq_v2.h:76] insert failed, size(hashtable)=180
W20240123 20:56:48.210011 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=271, pq.top=271
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.450 ms                  | 109.095 ms                |
| Forward                   | 4.947 ms                  | 12.382 ms                 |
| Backward                  | 3.894 ms                  | 6.845 ms                  |
| Optimize                  | 1.968 ms                  | 4.990 ms                  |
| BarrierTimeBeforeRank0    | 34.105 us                 | 34.108 ms                 |
| AfterBackward             | 30.501 ms                 | 350.947 ms                |
| BlockToStepN              | 17.579 ms                 | 80.366 ms                 |
| OneStep                   | 93.724 ms                 | 393.210 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:48.887379 22722 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end8
E20240123 20:56:49.139014 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=7801
W20240123 20:56:49.263353 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=283, pq.top=283
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.209 ms                  | 6.515 ms                  |
| ProcessBack:UpdateCache   | 2.324 ms                  | 5.200 ms                  |
| ProcessBack:UpsertPq      | 12.934 ms                 | 87.886 ms                 |
| ProcessOneStep            | 30.104 ms                 | 350.883 ms                |
| BlockToStepN              | 17.512 ms                 | 80.987 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:49.951148 22722 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end9
E20240123 20:56:50.139010 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=25884
W20240123 20:56:50.306591 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=292, pq.top=292
W20240123 20:56:51.004297 22722 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end9
[proc 1] 300 steps, total: 10.666, sample: 0.692, forward: 0.397, backward: 0.431, update: 0.172
[proc 3] 300 steps, total: 10.666, sample: 0.901, forward: 0.430, backward: 0.394, update: 0.174
[proc 0] 300 steps, total: 10.666, sample: 1.659, forward: 0.586, backward: 0.390, update: 0.237
[proc 2] 300 steps, total: 10.666, sample: 1.000, forward: 0.434, backward: 0.417, update: 0.178
E20240123 20:56:51.139010 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=16849
W20240123 20:56:51.346480 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=305, pq.top=305
W20240123 20:56:52.021044 22722 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end3
E20240123 20:56:52.139009 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=37870
W20240123 20:56:52.767953 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=319, pq.top=319
W20240123 20:56:53.096909 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end4
E20240123 20:56:53.139010 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=11530
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.830 ms                  | 109.095 ms                |
| Forward                   | 4.876 ms                  | 12.382 ms                 |
| Backward                  | 3.962 ms                  | 7.258 ms                  |
| Optimize                  | 1.950 ms                  | 4.990 ms                  |
| BarrierTimeBeforeRank0    | 35.518 us                 | 34.108 ms                 |
| AfterBackward             | 28.986 ms                 | 425.071 ms                |
| BlockToStepN              | 17.833 ms                 | 86.249 ms                 |
| OneStep                   | 92.548 ms                 | 479.736 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:53.815794 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=333, pq.top=333
W20240123 20:56:54.102376 22722 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end8
E20240123 20:56:54.139008 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=73803
W20240123 20:56:54.821074 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=345, pq.top=345
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.209 ms                  | 6.509 ms                  |
| ProcessBack:UpdateCache   | 2.377 ms                  | 4.631 ms                  |
| ProcessBack:UpsertPq      | 12.129 ms                 | 77.455 ms                 |
| ProcessOneStep            | 28.920 ms                 | 425.028 ms                |
| BlockToStepN              | 17.574 ms                 | 88.710 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 20:56:55.139006 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=46305
W20240123 20:56:55.193603 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240123 20:56:55.835714 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=355, pq.top=355
E20240123 20:56:56.139010 21366 parallel_pq_v2.h:76] insert failed, size(hashtable)=1284
W20240123 20:56:56.204093 22722 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 20:56:56.874275 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=367, pq.top=367
E20240123 20:56:57.139011 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=12703
W20240123 20:56:57.249745 22722 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end3
W20240123 20:56:57.886598 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=381, pq.top=381
E20240123 20:56:58.139011 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=706
W20240123 20:56:58.329267 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.211 ms                  | 108.258 ms                |
| Forward                   | 4.899 ms                  | 12.382 ms                 |
| Backward                  | 4.001 ms                  | 7.258 ms                  |
| Optimize                  | 1.948 ms                  | 4.638 ms                  |
| BarrierTimeBeforeRank0    | 33.808 us                 | 28.321 ms                 |
| AfterBackward             | 29.223 ms                 | 425.071 ms                |
| BlockToStepN              | 18.433 ms                 | 88.671 ms                 |
| OneStep                   | 82.401 ms                 | 465.974 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:56:58.898417 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=389, pq.top=389
E20240123 20:56:59.139011 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=16488
W20240123 20:56:59.339915 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
[proc 0] 400 steps, total: 8.802, sample: 1.100, forward: 0.487, backward: 0.411, update: 0.194
[proc 1] 400 steps, total: 8.802, sample: 0.786, forward: 0.379, backward: 0.420, update: 0.181
[proc 2] 400 steps, total: 8.802, sample: 0.978, forward: 0.458, backward: 0.410, update: 0.197
[proc 3] 400 steps, total: 8.802, sample: 0.807, forward: 0.435, backward: 0.383, update: 0.175
W20240123 20:56:59.898201 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=401, pq.top=401
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.223 ms                  | 6.515 ms                  |
| ProcessBack:UpdateCache   | 2.365 ms                  | 4.410 ms                  |
| ProcessBack:UpsertPq      | 11.949 ms                 | 73.182 ms                 |
| ProcessOneStep            | 29.040 ms                 | 425.028 ms                |
| BlockToStepN              | 18.386 ms                 | 92.796 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 20:57:00.139384 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=143860
W20240123 20:57:00.364454 22722 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end7
W20240123 20:57:00.898873 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=407, pq.top=407
E20240123 20:57:01.139009 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=102547
W20240123 20:57:01.395275 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end3
W20240123 20:57:01.898669 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=416, pq.top=416
E20240123 20:57:02.139008 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=37291
W20240123 20:57:02.422082 22722 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240123 20:57:02.916177 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=423, pq.top=423
E20240123 20:57:03.139009 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=7766
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.784 ms                  | 109.095 ms                |
| Forward                   | 4.930 ms                  | 12.382 ms                 |
| Backward                  | 4.030 ms                  | 7.715 ms                  |
| Optimize                  | 1.965 ms                  | 4.638 ms                  |
| BarrierTimeBeforeRank0    | 33.279 us                 | 28.321 ms                 |
| AfterBackward             | 29.127 ms                 | 425.071 ms                |
| BlockToStepN              | 19.403 ms                 | 115.097 ms                |
| OneStep                   | 83.064 ms                 | 502.886 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:57:03.504730 22722 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end9
W20240123 20:57:03.916496 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=433, pq.top=433
E20240123 20:57:04.139011 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=7900
W20240123 20:57:04.513223 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.228 ms                  | 6.562 ms                  |
| ProcessBack:UpdateCache   | 2.347 ms                  | 4.101 ms                  |
| ProcessBack:UpsertPq      | 12.295 ms                 | 72.233 ms                 |
| ProcessOneStep            | 29.186 ms                 | 425.028 ms                |
| BlockToStepN              | 19.314 ms                 | 144.886 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 20:57:05.139029 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=3049
W20240123 20:57:05.331499 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=441, pq.top=441
W20240123 20:57:05.530787 22722 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
E20240123 20:57:06.139081 21366 parallel_pq_v2.h:76] insert failed, size(hashtable)=3506
W20240123 20:57:06.429096 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=451, pq.top=451
W20240123 20:57:06.562811 22722 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end3
E20240123 20:57:07.139027 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=1116
W20240123 20:57:07.429380 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=455, pq.top=455
W20240123 20:57:07.609933 22722 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240123 20:57:08.139075 22721 parallel_pq_v2.h:76] insert failed, size(hashtable)=24420
W20240123 20:57:08.473553 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=462, pq.top=462
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.085 ms                  | 126.806 ms                |
| Forward                   | 4.967 ms                  | 10.997 ms                 |
| Backward                  | 4.043 ms                  | 7.367 ms                  |
| Optimize                  | 1.974 ms                  | 4.605 ms                  |
| BarrierTimeBeforeRank0    | 33.166 us                 | 24.671 ms                 |
| AfterBackward             | 29.384 ms                 | 425.071 ms                |
| BlockToStepN              | 19.630 ms                 | 145.028 ms                |
| OneStep                   | 84.880 ms                 | 507.319 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:57:08.647234 22722 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240123 20:57:09.139014 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=7172
W20240123 20:57:09.480054 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=470, pq.top=470
W20240123 20:57:09.930644 22722 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.246 ms                  | 6.562 ms                  |
| ProcessBack:UpdateCache   | 2.362 ms                  | 4.631 ms                  |
| ProcessBack:UpsertPq      | 12.710 ms                 | 72.233 ms                 |
| ProcessOneStep            | 29.456 ms                 | 425.028 ms                |
| BlockToStepN              | 19.568 ms                 | 144.886 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 20:57:10.144248 22049 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 20:57:10.480321 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=475, pq.top=475
W20240123 20:57:10.954547 22722 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240123 20:57:11.149250 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=31478
W20240123 20:57:11.480430 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=483, pq.top=483
W20240123 20:57:12.147759 22722 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240123 20:57:12.149003 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=219
W20240123 20:57:12.480383 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=489, pq.top=489
E20240123 20:57:13.149016 22722 parallel_pq_v2.h:76] insert failed, size(hashtable)=12638
W20240123 20:57:13.151060 22722 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.681 ms                  | 144.477 ms                |
| Forward                   | 5.013 ms                  | 10.997 ms                 |
| Backward                  | 4.048 ms                  | 7.367 ms                  |
| Optimize                  | 2.004 ms                  | 4.605 ms                  |
| BarrierTimeBeforeRank0    | 33.644 us                 | 24.671 ms                 |
| AfterBackward             | 29.651 ms                 | 425.071 ms                |
| BlockToStepN              | 20.013 ms                 | 145.028 ms                |
| OneStep                   | 86.181 ms                 | 558.317 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 20:57:13.527978 21366 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=499, pq.top=499
[proc 2] 500 steps, total: 13.823, sample: 0.865, forward: 0.439, backward: 0.437, update: 0.176
[proc 3] 500 steps, total: 13.823, sample: 0.880, forward: 0.452, backward: 0.398, update: 0.172
[proc 1] 500 steps, total: 13.823, sample: 0.812, forward: 0.422, backward: 0.469, update: 0.178
[proc 0] 500 steps, total: 13.823, sample: 3.954, forward: 0.585, backward: 0.416, update: 0.235
Successfully xmh. training takes 63.281816482543945 seconds
before call kg_cache_controller.StopThreads()
W20240123 20:57:13.672659 21366 grad_async_v2.h:71] call StopThreads. PID = 61996
W20240123 20:57:13.672701 21366 grad_base.h:210] before processOneStepNegThread_.join();
W20240123 20:57:13.674057 21366 grad_base.h:212] after processOneStepNegThread_.join();
W20240123 20:57:13.674088 21366 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240123 20:57:13.747660 21366 grad_async_v2.h:91] StopThreads done.

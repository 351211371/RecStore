WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240124 04:51:02.674948 44518 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_56', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [44518 sampler.py:454] Start PreSampling
WARNING [44518 sampler.py:532] Before construct renumbering_dict
WARNING [44518 sampler.py:555] PreSampling done
W20240124 05:04:48.014024 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240124 05:04:48.014235 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240124 05:04:48.014266 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240124 05:04:48.014290 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240124 05:04:48.014308 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240124 05:04:48.014333 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240124 05:04:48.014357 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240124 05:04:48.014384 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240124 05:04:48.014411 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240124 05:04:48.014431 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240124 05:04:48.014457 44518 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240124 05:04:48.014477 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240124 05:04:48.014499 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240124 05:04:48.014644 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240124 05:04:48.014672 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240124 05:04:48.014689 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240124 05:04:48.014725 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240124 05:04:48.014747 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240124 05:04:48.014767 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240124 05:04:48.014797 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240124 05:04:48.014824 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240124 05:04:48.014847 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240124 05:04:48.014870 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240124 05:04:48.014894 44518 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240124 05:04:48.014907 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240124 05:04:48.014925 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240124 05:04:48.014969 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240124 05:04:48.014997 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240124 05:04:48.015022 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240124 05:04:48.015043 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240124 05:04:48.015061 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240124 05:04:48.015079 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240124 05:04:48.015098 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240124 05:04:48.015115 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240124 05:04:48.015136 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240124 05:04:48.015154 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240124 05:04:48.015172 44518 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240124 05:04:48.015187 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240124 05:04:48.015204 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240124 05:04:48.015251 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240124 05:04:48.015273 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240124 05:04:48.015296 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240124 05:04:48.015318 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240124 05:04:48.015338 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240124 05:04:48.015362 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240124 05:04:48.015385 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240124 05:04:48.015416 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240124 05:04:48.015436 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240124 05:04:48.015455 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240124 05:04:48.015472 44518 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240124 05:04:48.015486 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240124 05:04:48.015499 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240124 05:04:48.015548 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000 781.2 kB
W20240124 05:04:48.015573 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000 781.2 kB
W20240124 05:04:48.015591 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000 781.2 kB
W20240124 05:04:48.015614 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000 781.2 kB
W20240124 05:04:48.015630 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000 781.2 kB
W20240124 05:04:48.015651 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000 781.2 kB
W20240124 05:04:48.015669 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000 781.2 kB
W20240124 05:04:48.015694 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000 781.2 kB
W20240124 05:04:48.015717 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000 781.2 kB
W20240124 05:04:48.015735 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000 781.2 kB
W20240124 05:04:48.015753 44518 IPCTensor.h:365] NewIPCTensor: step_r4 [10]0x100002694000 80 B 
W20240124 05:04:48.015765 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000 8 B 
W20240124 05:04:48.015784 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000 8 B 
W20240124 05:04:48.015820 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000 781.2 kB
W20240124 05:04:48.015848 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000 781.2 kB
W20240124 05:04:48.015868 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000 781.2 kB
W20240124 05:04:48.015892 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000 781.2 kB
W20240124 05:04:48.015909 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000 781.2 kB
W20240124 05:04:48.015933 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000 781.2 kB
W20240124 05:04:48.015954 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000 781.2 kB
W20240124 05:04:48.015974 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000 781.2 kB
W20240124 05:04:48.015992 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000 781.2 kB
W20240124 05:04:48.016013 44518 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000 781.2 kB
W20240124 05:04:48.016029 44518 IPCTensor.h:365] NewIPCTensor: step_r5 [10]0x100002e4c000 80 B 
W20240124 05:04:48.016045 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000 8 B 
W20240124 05:04:48.016062 44518 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000 8 B 
W20240124 05:04:48.330549 44518 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100002e52000 128.2 GB
W20240124 05:04:48.330715 44518 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102011a8a000 328.3 MB
{0: Graph(num_nodes=16364881, num_edges=60475646,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22851247, num_edges=75085053,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16469571, num_edges=67497598,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17544490, num_edges=53244935,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=18090773, num_edges=55134734,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=20615225, num_edges=67664913,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16364881 N 60475646 E
MertisPartition: part 1 has 22851247 N 75085053 E
MertisPartition: part 2 has 16469571 N 67497598 E
MertisPartition: part 3 has 17544490 N 53244935 E
MertisPartition: part 4 has 18090773 N 55134734 E
MertisPartition: part 5 has 20615225 N 67664913 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,        6,  ..., 37713888,  7166588, 11887902]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
After renumbering graph:  {'_ID': tensor([ 4302852,  4302881,  4302909,  ...,  5872825, 58475976, 36775678]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1003.523 seconds
[Rank1] pid = 5105
[Rank2] pid = 5198
[Rank3] pid = 5282
[Rank4] pid = 5364
INFO [44518 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [5105 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [5198 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [5364 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [5435 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [5282 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [5282 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5435 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5198 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5364 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [44518 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5105 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
WARNING [5364 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5435 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5105 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [44518 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5282 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5198 DistTensor.py:56] The tensor name already exists in the kvstore
I20240124 05:08:00.329959  5199 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240124 05:08:00.330391  5436 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 05:08:00.330565  5500 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 05:08:00.330740  5283 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 05:08:00.330947  5365 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 05:08:00.331055  5106 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 05:08:08.920270  5283 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240124 05:08:09.049254  5365 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 05:08:09.910923  5436 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 05:08:10.796654  5199 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 05:08:11.904139  5106 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 05:08:11.969121  5500 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.461 ms                  | 15.708 ms                 |
| bucket keys               | 1.378 ms                  | 103.129 ms                |
| forward: a2a keys         | 2.437 ms                  | 1.002 s                   |
| forward: search cache     | 265.639 us                | 20.489 ms                 |
| forward: a2a values       | 4.350 ms                  | 32.008 ms                 |
| forward: join             | 1.670 ms                  | 2.320 ms                  |
| Forward                   | 38.759 ms                 | 1.583 s                   |
| back: aggr dram keys      | 18.795 ms                 | 802.672 ms                |
| back: set dram grad       | 1.530 ms                  | 9.924 ms                  |
| back: a2a grad            | 8.014 ms                  | 36.762 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 77.296 ms                 |
| Backward                  | 197.844 ms                | 1.105 s                   |
| Optimize                  | 30.612 ms                 | 33.608 ms                 |
| BarrierTimeBeforeRank0    | 59.746 us                 | 61.512 us                 |
| BlockToStepN              | 21.663 us                 | 36.047 us                 |
| OneStep                   | 280.646 ms                | 2.730 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.480 ms                  | 66.910 ms                 |
| bucket keys               | 1.488 ms                  | 103.129 ms                |
| forward: a2a keys         | 3.164 ms                  | 1.002 s                   |
| forward: search cache     | 255.695 us                | 20.489 ms                 |
| forward: a2a values       | 4.865 ms                  | 32.008 ms                 |
| forward: join             | 1.670 ms                  | 26.055 ms                 |
| Forward                   | 39.414 ms                 | 1.583 s                   |
| back: aggr dram keys      | 37.313 ms                 | 802.672 ms                |
| back: set dram grad       | 1.564 ms                  | 9.924 ms                  |
| back: a2a grad            | 17.965 ms                 | 36.762 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 100.303 ms                |
| Backward                  | 171.259 ms                | 1.105 s                   |
| Optimize                  | 21.380 ms                 | 33.608 ms                 |
| BarrierTimeBeforeRank0    | 49.737 us                 | 114.953 us                |
| BlockToStepN              | 23.420 us                 | 12.648 ms                 |
| OneStep                   | 249.016 ms                | 2.730 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.480 ms                  | 66.910 ms                 |
| bucket keys               | 1.485 ms                  | 2.751 ms                  |
| forward: a2a keys         | 2.941 ms                  | 38.660 ms                 |
| forward: search cache     | 256.367 us                | 330.653 us                |
| forward: a2a values       | 4.865 ms                  | 31.060 ms                 |
| forward: join             | 1.670 ms                  | 2.726 ms                  |
| Forward                   | 38.759 ms                 | 1.583 s                   |
| back: aggr dram keys      | 38.425 ms                 | 71.891 ms                 |
| back: set dram grad       | 1.756 ms                  | 9.328 ms                  |
| back: a2a grad            | 17.965 ms                 | 31.231 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 95.935 ms                 |
| Backward                  | 166.261 ms                | 1.105 s                   |
| Optimize                  | 21.156 ms                 | 48.264 ms                 |
| BarrierTimeBeforeRank0    | 44.166 us                 | 114.953 us                |
| BlockToStepN              | 22.321 us                 | 18.473 ms                 |
| OneStep                   | 244.408 ms                | 2.730 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.992 ms                  | 66.910 ms                 |
| bucket keys               | 1.485 ms                  | 2.751 ms                  |
| forward: a2a keys         | 3.168 ms                  | 38.660 ms                 |
| forward: search cache     | 258.844 us                | 330.653 us                |
| forward: a2a values       | 4.865 ms                  | 31.060 ms                 |
| forward: join             | 1.670 ms                  | 2.726 ms                  |
| Forward                   | 39.329 ms                 | 84.935 ms                 |
| back: aggr dram keys      | 38.425 ms                 | 71.891 ms                 |
| back: set dram grad       | 1.756 ms                  | 9.328 ms                  |
| back: a2a grad            | 17.917 ms                 | 36.762 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 95.935 ms                 |
| Backward                  | 161.353 ms                | 217.051 ms                |
| Optimize                  | 21.086 ms                 | 47.916 ms                 |
| BarrierTimeBeforeRank0    | 38.852 us                 | 91.577 us                 |
| BlockToStepN              | 24.910 us                 | 16.187 ms                 |
| OneStep                   | 238.945 ms                | 331.459 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.996 ms                  | 69.449 ms                 |
| bucket keys               | 1.486 ms                  | 2.472 ms                  |
| forward: a2a keys         | 2.961 ms                  | 38.172 ms                 |
| forward: search cache     | 259.447 us                | 361.617 us                |
| forward: a2a values       | 4.865 ms                  | 30.096 ms                 |
| forward: join             | 1.670 ms                  | 2.765 ms                  |
| Forward                   | 38.759 ms                 | 84.935 ms                 |
| back: aggr dram keys      | 38.425 ms                 | 70.669 ms                 |
| back: set dram grad       | 2.125 ms                  | 9.056 ms                  |
| back: a2a grad            | 17.917 ms                 | 34.771 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 91.398 ms                 |
| Backward                  | 157.229 ms                | 217.051 ms                |
| Optimize                  | 20.972 ms                 | 47.916 ms                 |
| BarrierTimeBeforeRank0    | 37.501 us                 | 91.577 us                 |
| BlockToStepN              | 23.898 us                 | 16.187 ms                 |
| OneStep                   | 231.177 ms                | 331.459 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 27.594, sample: 0.975, forward: 6.226, backward: 11.797, update: 0.320
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 29.471, sample: 0.784, forward: 6.469, backward: 11.704, update: 0.335
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 26.422, sample: 0.869, forward: 6.363, backward: 11.749, update: 0.331
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 26.487, sample: 0.844, forward: 6.378, backward: 12.175, update: 0.298
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 29.342, sample: 0.903, forward: 6.370, backward: 11.423, update: 0.295
[Rank5] pid = 5435
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242)]
train_sampler.Prefill()
-------Step 0-------
tensor([    5818,   245750,  4356546,   344552,   344573, 66503694,  7813470,
          344583,   344606,   344622]) tensor([ 4829170, 41305886, 40801161,  4477575, 63828159, 22990893, 44977479,
        17044174, 73123281,  8028092])
-------Step 1-------
tensor([    5818,   245750,  4356546,   344552,   344573, 66503694,  7813470,
          344583,   344606,   344622]) tensor([40800895, 15298565,  8650450, 81371764,  1707541, 51094954, 20965717,
        16440521, 66865964, 74084093])
-------Step 2-------
tensor([  266965,  4469015,   337155,    87374, 73070312,    87416,    87447,
           87492,    87556, 26470659]) tensor([39260927, 21097362, 20628608,   211940,   349241, 34979485, 11786356,
         7855572, 20472356, 53876742])
-------Step 3-------
tensor([  266965,  4469015,   337155,    87374, 73070312,    87416,    87447,
           87492,    87556, 26470659]) tensor([65169038, 79940037, 12053483, 84046345, 53975118, 50289224, 71459032,
          499533,  1978162, 46510138])
-------Step 4-------
tensor([4313907,  200479,   45444,  200528,  200579,  200630,  200686, 4518905,
         200728,  287240]) tensor([14689999, 30538958, 39944450, 68477633, 70223277, 27572159,   607456,
        78416460, 78873120,  7291859])
-------Step 5-------
tensor([4313907,  200479,   45444,  200528,  200579,  200630,  200686, 4518905,
         200728,  287240]) tensor([72453540, 70827159,   295809, 20693147, 32569275,   410392, 14007217,
        63640288, 68666966, 83030819])
-------Step 6-------
tensor([  315113,   315180,   315217,   315263,   315313,   315348, 66902358,
           64825,   315403,  4498787]) tensor([50880990, 34729964, 37134590, 51879346, 20005380,  5901136, 71931373,
        23185170, 23196595, 85519164])
-------Step 7-------
tensor([  315113,   315180,   315217,   315263,   315313,   315348, 66902358,
           64825,   315403,  4498787]) tensor([ 9686339, 60406566, 75984002, 63960868, 68034535,  1745739, 74440962,
        43773273, 24961953,   278837])
-------Step 8-------
tensor([  401488, 13154977,   401507,   401541,   401574, 20175340,    83822,
          401595,   401627, 39082545]) tensor([23222533, 29821172, 79931839, 23993199, 41198672, 47665769, 57531278,
        58711511, 49292977, 37148870])
-------Step 9-------
tensor([  401488, 13154977,   401507,   401541,   401574, 20175340,    83822,
          401595,   401627, 39082545]) tensor([69901364, 62417500, 79137435, 78134399, 32623754, 14765850, 14003334,
        32717776, 37452235, 55427386])
before start barrier
start train
[proc 0] 100 steps, total: 28.480, sample: 0.995, forward: 5.712, backward: 17.380, update: 2.172
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.405 ms                  | 69.449 ms                 |
| bucket keys               | 1.486 ms                  | 2.472 ms                  |
| forward: a2a keys         | 2.939 ms                  | 38.172 ms                 |
| forward: search cache     | 259.636 us                | 361.617 us                |
| forward: a2a values       | 4.865 ms                  | 31.083 ms                 |
| forward: join             | 2.113 ms                  | 3.263 ms                  |
| Forward                   | 38.641 ms                 | 84.935 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 75.400 ms                 |
| back: set dram grad       | 2.125 ms                  | 9.056 ms                  |
| back: a2a grad            | 17.917 ms                 | 35.129 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 91.398 ms                 |
| Backward                  | 159.519 ms                | 217.051 ms                |
| Optimize                  | 20.809 ms                 | 47.916 ms                 |
| BarrierTimeBeforeRank0    | 36.935 us                 | 91.577 us                 |
| BlockToStepN              | 25.760 us                 | 16.187 ms                 |
| OneStep                   | 231.177 ms                | 331.459 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.395 ms                  | 69.449 ms                 |
| bucket keys               | 1.486 ms                  | 2.471 ms                  |
| forward: a2a keys         | 2.941 ms                  | 38.172 ms                 |
| forward: search cache     | 259.041 us                | 361.617 us                |
| forward: a2a values       | 4.865 ms                  | 31.671 ms                 |
| forward: join             | 2.115 ms                  | 3.263 ms                  |
| Forward                   | 38.641 ms                 | 88.635 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 71.891 ms                 |
| back: set dram grad       | 2.125 ms                  | 9.035 ms                  |
| back: a2a grad            | 17.963 ms                 | 34.771 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 78.804 ms                 |
| Backward                  | 158.875 ms                | 217.051 ms                |
| Optimize                  | 20.777 ms                 | 47.916 ms                 |
| BarrierTimeBeforeRank0    | 36.727 us                 | 91.577 us                 |
| BlockToStepN              | 26.347 us                 | 16.187 ms                 |
| OneStep                   | 232.903 ms                | 331.459 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.405 ms                  | 69.449 ms                 |
| bucket keys               | 1.487 ms                  | 2.471 ms                  |
| forward: a2a keys         | 3.097 ms                  | 38.172 ms                 |
| forward: search cache     | 259.447 us                | 361.617 us                |
| forward: a2a values       | 4.865 ms                  | 31.671 ms                 |
| forward: join             | 2.115 ms                  | 3.263 ms                  |
| Forward                   | 38.714 ms                 | 88.635 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 71.891 ms                 |
| back: set dram grad       | 2.184 ms                  | 9.035 ms                  |
| back: a2a grad            | 17.965 ms                 | 34.771 ms                 |
| back: grad sum & grad cache  | 3.997 ms                  | 78.804 ms                 |
| Backward                  | 157.777 ms                | 217.051 ms                |
| Optimize                  | 20.809 ms                 | 47.916 ms                 |
| BarrierTimeBeforeRank0    | 36.727 us                 | 91.577 us                 |
| BlockToStepN              | 26.691 us                 | 16.187 ms                 |
| OneStep                   | 231.509 ms                | 331.459 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.395 ms                  | 69.449 ms                 |
| bucket keys               | 1.487 ms                  | 2.471 ms                  |
| forward: a2a keys         | 3.164 ms                  | 38.172 ms                 |
| forward: search cache     | 259.340 us                | 380.139 us                |
| forward: a2a values       | 4.865 ms                  | 31.671 ms                 |
| forward: join             | 2.113 ms                  | 3.263 ms                  |
| Forward                   | 38.817 ms                 | 84.935 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 71.891 ms                 |
| back: set dram grad       | 2.184 ms                  | 9.035 ms                  |
| back: a2a grad            | 18.008 ms                 | 35.129 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 78.804 ms                 |
| Backward                  | 156.548 ms                | 212.721 ms                |
| Optimize                  | 20.809 ms                 | 34.437 ms                 |
| BarrierTimeBeforeRank0    | 36.516 us                 | 86.833 us                 |
| BlockToStepN              | 26.424 us                 | 12.648 ms                 |
| OneStep                   | 230.758 ms                | 325.135 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.009 ms                  | 69.449 ms                 |
| bucket keys               | 1.487 ms                  | 2.471 ms                  |
| forward: a2a keys         | 3.190 ms                  | 31.797 ms                 |
| forward: search cache     | 258.395 us                | 361.617 us                |
| forward: a2a values       | 7.753 ms                  | 31.083 ms                 |
| forward: join             | 2.113 ms                  | 3.203 ms                  |
| Forward                   | 38.886 ms                 | 84.935 ms                 |
| back: aggr dram keys      | 46.153 ms                 | 70.955 ms                 |
| back: set dram grad       | 3.208 ms                  | 8.749 ms                  |
| back: a2a grad            | 17.917 ms                 | 34.771 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 77.296 ms                 |
| Backward                  | 155.267 ms                | 212.721 ms                |
| Optimize                  | 20.791 ms                 | 34.437 ms                 |
| BarrierTimeBeforeRank0    | 36.364 us                 | 86.833 us                 |
| BlockToStepN              | 26.347 us                 | 12.648 ms                 |
| OneStep                   | 228.230 ms                | 325.135 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 200 steps, total: 23.260, sample: 0.808, forward: 4.827, backward: 10.663, update: 0.306
[proc 5] 200 steps, total: 23.260, sample: 1.091, forward: 4.577, backward: 10.722, update: 0.316
[proc 0] 200 steps, total: 23.260, sample: 0.937, forward: 4.277, backward: 15.864, update: 2.079
[proc 4] 200 steps, total: 23.260, sample: 0.872, forward: 4.780, backward: 10.435, update: 0.250
[proc 2] 200 steps, total: 23.260, sample: 1.018, forward: 4.621, backward: 10.710, update: 0.304
[proc 1] 200 steps, total: 23.260, sample: 0.784, forward: 4.857, backward: 11.082, update: 0.297
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.158 ms                  | 71.155 ms                 |
| bucket keys               | 1.486 ms                  | 2.471 ms                  |
| forward: a2a keys         | 3.173 ms                  | 31.797 ms                 |
| forward: search cache     | 257.720 us                | 380.139 us                |
| forward: a2a values       | 7.753 ms                  | 31.083 ms                 |
| forward: join             | 2.083 ms                  | 3.203 ms                  |
| Forward                   | 38.759 ms                 | 84.935 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.955 ms                 |
| back: set dram grad       | 2.184 ms                  | 9.035 ms                  |
| back: a2a grad            | 17.917 ms                 | 34.771 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 77.296 ms                 |
| Backward                  | 155.165 ms                | 212.721 ms                |
| Optimize                  | 20.793 ms                 | 34.437 ms                 |
| BarrierTimeBeforeRank0    | 36.331 us                 | 86.833 us                 |
| BlockToStepN              | 25.750 us                 | 12.648 ms                 |
| OneStep                   | 226.894 ms                | 325.135 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.158 ms                  | 71.155 ms                 |
| bucket keys               | 1.474 ms                  | 2.461 ms                  |
| forward: a2a keys         | 3.053 ms                  | 31.568 ms                 |
| forward: search cache     | 257.157 us                | 361.617 us                |
| forward: a2a values       | 7.753 ms                  | 31.060 ms                 |
| forward: join             | 2.068 ms                  | 2.765 ms                  |
| Forward                   | 38.731 ms                 | 84.935 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.669 ms                 |
| back: set dram grad       | 2.184 ms                  | 8.749 ms                  |
| back: a2a grad            | 17.917 ms                 | 34.168 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 75.323 ms                 |
| Backward                  | 154.764 ms                | 212.721 ms                |
| Optimize                  | 20.795 ms                 | 34.437 ms                 |
| BarrierTimeBeforeRank0    | 36.373 us                 | 86.833 us                 |
| BlockToStepN              | 25.021 us                 | 17.227 ms                 |
| OneStep                   | 226.635 ms                | 325.135 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.948 ms                  | 69.449 ms                 |
| bucket keys               | 1.474 ms                  | 2.461 ms                  |
| forward: a2a keys         | 3.124 ms                  | 31.797 ms                 |
| forward: search cache     | 256.806 us                | 361.617 us                |
| forward: a2a values       | 7.753 ms                  | 31.083 ms                 |
| forward: join             | 2.061 ms                  | 2.848 ms                  |
| Forward                   | 38.913 ms                 | 78.122 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.955 ms                 |
| back: set dram grad       | 2.184 ms                  | 8.749 ms                  |
| back: a2a grad            | 17.917 ms                 | 34.168 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 75.323 ms                 |
| Backward                  | 154.817 ms                | 207.761 ms                |
| Optimize                  | 20.849 ms                 | 34.437 ms                 |
| BarrierTimeBeforeRank0    | 36.464 us                 | 86.833 us                 |
| BlockToStepN              | 25.700 us                 | 16.187 ms                 |
| OneStep                   | 225.931 ms                | 323.093 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.879 ms                  | 69.449 ms                 |
| bucket keys               | 1.474 ms                  | 2.461 ms                  |
| forward: a2a keys         | 3.137 ms                  | 31.568 ms                 |
| forward: search cache     | 256.383 us                | 361.617 us                |
| forward: a2a values       | 7.753 ms                  | 31.060 ms                 |
| forward: join             | 2.061 ms                  | 2.848 ms                  |
| Forward                   | 38.945 ms                 | 78.122 ms                 |
| back: aggr dram keys      | 46.153 ms                 | 70.669 ms                 |
| back: set dram grad       | 3.208 ms                  | 8.580 ms                  |
| back: a2a grad            | 17.917 ms                 | 34.131 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 74.702 ms                 |
| Backward                  | 154.764 ms                | 207.761 ms                |
| Optimize                  | 20.849 ms                 | 37.299 ms                 |
| BarrierTimeBeforeRank0    | 36.385 us                 | 86.833 us                 |
| BlockToStepN              | 25.760 us                 | 16.187 ms                 |
| OneStep                   | 225.720 ms                | 323.093 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 22.798, sample: 0.641, forward: 4.749, backward: 10.953, update: 0.289
[proc 4] 300 steps, total: 22.798, sample: 0.715, forward: 4.691, backward: 10.252, update: 0.280
[proc 2] 300 steps, total: 22.798, sample: 0.884, forward: 4.493, backward: 10.579, update: 0.340
[proc 5] 300 steps, total: 22.798, sample: 0.927, forward: 4.482, backward: 10.526, update: 0.327
[proc 0] 300 steps, total: 22.798, sample: 0.902, forward: 4.117, backward: 15.521, update: 2.133
[proc 3] 300 steps, total: 22.798, sample: 0.684, forward: 4.700, backward: 10.511, update: 0.325
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.948 ms                  | 71.121 ms                 |
| bucket keys               | 1.474 ms                  | 2.461 ms                  |
| forward: a2a keys         | 3.114 ms                  | 31.568 ms                 |
| forward: search cache     | 256.304 us                | 380.139 us                |
| forward: a2a values       | 7.753 ms                  | 31.060 ms                 |
| forward: join             | 2.061 ms                  | 3.203 ms                  |
| Forward                   | 38.886 ms                 | 78.122 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.669 ms                 |
| back: set dram grad       | 2.184 ms                  | 8.580 ms                  |
| back: a2a grad            | 17.935 ms                 | 34.131 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 74.702 ms                 |
| Backward                  | 154.272 ms                | 207.761 ms                |
| Optimize                  | 20.871 ms                 | 40.300 ms                 |
| BarrierTimeBeforeRank0    | 36.364 us                 | 86.833 us                 |
| BlockToStepN              | 25.700 us                 | 16.187 ms                 |
| OneStep                   | 224.780 ms                | 323.093 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.948 ms                  | 71.121 ms                 |
| bucket keys               | 1.473 ms                  | 2.429 ms                  |
| forward: a2a keys         | 3.097 ms                  | 31.568 ms                 |
| forward: search cache     | 256.044 us                | 361.617 us                |
| forward: a2a values       | 7.753 ms                  | 30.595 ms                 |
| forward: join             | 2.061 ms                  | 2.848 ms                  |
| Forward                   | 38.882 ms                 | 78.122 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.028 ms                 |
| back: set dram grad       | 2.184 ms                  | 8.579 ms                  |
| back: a2a grad            | 17.935 ms                 | 34.168 ms                 |
| back: grad sum & grad cache  | 5.086 ms                  | 72.593 ms                 |
| Backward                  | 154.097 ms                | 207.761 ms                |
| Optimize                  | 20.865 ms                 | 40.300 ms                 |
| BarrierTimeBeforeRank0    | 36.373 us                 | 86.833 us                 |
| BlockToStepN              | 25.141 us                 | 16.187 ms                 |
| OneStep                   | 223.525 ms                | 323.093 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.879 ms                  | 71.121 ms                 |
| bucket keys               | 1.467 ms                  | 2.461 ms                  |
| forward: a2a keys         | 3.088 ms                  | 31.797 ms                 |
| forward: search cache     | 256.285 us                | 380.139 us                |
| forward: a2a values       | 7.753 ms                  | 30.595 ms                 |
| forward: join             | 2.061 ms                  | 2.848 ms                  |
| Forward                   | 38.886 ms                 | 78.122 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.028 ms                 |
| back: set dram grad       | 2.987 ms                  | 8.579 ms                  |
| back: a2a grad            | 17.917 ms                 | 35.129 ms                 |
| back: grad sum & grad cache  | 21.314 ms                 | 72.593 ms                 |
| Backward                  | 153.949 ms                | 207.761 ms                |
| Optimize                  | 20.881 ms                 | 40.300 ms                 |
| BarrierTimeBeforeRank0    | 36.356 us                 | 86.833 us                 |
| BlockToStepN              | 24.910 us                 | 16.187 ms                 |
| OneStep                   | 223.357 ms                | 323.093 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.794 ms                  | 69.449 ms                 |
| bucket keys               | 1.457 ms                  | 2.469 ms                  |
| forward: a2a keys         | 3.078 ms                  | 31.797 ms                 |
| forward: search cache     | 256.102 us                | 385.771 us                |
| forward: a2a values       | 12.458 ms                 | 30.595 ms                 |
| forward: join             | 2.061 ms                  | 2.856 ms                  |
| Forward                   | 38.817 ms                 | 77.750 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.028 ms                 |
| back: set dram grad       | 2.987 ms                  | 8.580 ms                  |
| back: a2a grad            | 17.153 ms                 | 36.205 ms                 |
| back: grad sum & grad cache  | 29.369 ms                 | 72.593 ms                 |
| Backward                  | 153.975 ms                | 204.542 ms                |
| Optimize                  | 20.906 ms                 | 40.300 ms                 |
| BarrierTimeBeforeRank0    | 36.352 us                 | 86.833 us                 |
| BlockToStepN              | 24.759 us                 | 12.648 ms                 |
| OneStep                   | 223.388 ms                | 319.976 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.805 ms                  | 71.121 ms                 |
| bucket keys               | 1.446 ms                  | 2.469 ms                  |
| forward: a2a keys         | 3.089 ms                  | 31.568 ms                 |
| forward: search cache     | 255.523 us                | 384.330 us                |
| forward: a2a values       | 11.167 ms                 | 30.096 ms                 |
| forward: join             | 2.082 ms                  | 2.867 ms                  |
| Forward                   | 38.817 ms                 | 77.750 ms                 |
| back: aggr dram keys      | 45.801 ms                 | 70.028 ms                 |
| back: set dram grad       | 3.208 ms                  | 8.579 ms                  |
| back: a2a grad            | 16.205 ms                 | 35.260 ms                 |
| back: grad sum & grad cache  | 23.603 ms                 | 69.670 ms                 |
| Backward                  | 153.539 ms                | 204.542 ms                |
| Optimize                  | 20.950 ms                 | 40.300 ms                 |
| BarrierTimeBeforeRank0    | 36.308 us                 | 86.833 us                 |
| BlockToStepN              | 24.443 us                 | 12.648 ms                 |
| OneStep                   | 222.969 ms                | 319.976 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 5] 400 steps, total: 22.455, sample: 0.844, forward: 4.404, backward: 10.791, update: 0.312
[proc 2] 400 steps, total: 22.455, sample: 0.812, forward: 4.367, backward: 10.902, update: 0.339
[proc 3] 400 steps, total: 22.455, sample: 0.664, forward: 4.533, backward: 10.837, update: 0.363
[proc 1] 400 steps, total: 22.455, sample: 0.705, forward: 4.507, backward: 11.252, update: 0.310
[proc 0] 400 steps, total: 22.455, sample: 0.827, forward: 4.036, backward: 15.218, update: 2.262
[proc 4] 400 steps, total: 22.455, sample: 0.758, forward: 4.455, backward: 10.696, update: 0.313
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.784 ms                  | 71.121 ms                 |
| bucket keys               | 1.446 ms                  | 2.471 ms                  |
| forward: a2a keys         | 3.089 ms                  | 31.568 ms                 |
| forward: search cache     | 255.519 us                | 385.771 us                |
| forward: a2a values       | 11.167 ms                 | 30.096 ms                 |
| forward: join             | 2.119 ms                  | 3.000 ms                  |
| Forward                   | 38.761 ms                 | 77.750 ms                 |
| back: aggr dram keys      | 46.867 ms                 | 70.669 ms                 |
| back: set dram grad       | 3.208 ms                  | 8.579 ms                  |
| back: a2a grad            | 14.871 ms                 | 35.260 ms                 |
| back: grad sum & grad cache  | 22.507 ms                 | 69.670 ms                 |
| Backward                  | 153.227 ms                | 204.542 ms                |
| Optimize                  | 21.002 ms                 | 40.365 ms                 |
| BarrierTimeBeforeRank0    | 36.190 us                 | 86.833 us                 |
| BlockToStepN              | 23.810 us                 | 12.648 ms                 |
| OneStep                   | 222.507 ms                | 319.976 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.666 ms                  | 71.121 ms                 |
| bucket keys               | 1.441 ms                  | 2.469 ms                  |
| forward: a2a keys         | 3.103 ms                  | 30.446 ms                 |
| forward: search cache     | 255.574 us                | 385.771 us                |
| forward: a2a values       | 9.459 ms                  | 29.148 ms                 |
| forward: join             | 2.131 ms                  | 3.203 ms                  |
| Forward                   | 38.817 ms                 | 77.750 ms                 |
| back: aggr dram keys      | 47.278 ms                 | 70.028 ms                 |
| back: set dram grad       | 3.225 ms                  | 8.579 ms                  |
| back: a2a grad            | 14.607 ms                 | 35.260 ms                 |
| back: grad sum & grad cache  | 19.218 ms                 | 68.605 ms                 |
| Backward                  | 152.886 ms                | 204.542 ms                |
| Optimize                  | 21.033 ms                 | 42.966 ms                 |
| BarrierTimeBeforeRank0    | 36.148 us                 | 86.833 us                 |
| BlockToStepN              | 22.605 us                 | 12.648 ms                 |
| OneStep                   | 222.179 ms                | 323.093 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.628 ms                  | 69.449 ms                 |
| bucket keys               | 1.422 ms                  | 2.469 ms                  |
| forward: a2a keys         | 3.073 ms                  | 30.446 ms                 |
| forward: search cache     | 254.943 us                | 393.530 us                |
| forward: a2a values       | 8.018 ms                  | 29.148 ms                 |
| forward: join             | 2.145 ms                  | 3.460 ms                  |
| Forward                   | 38.651 ms                 | 74.013 ms                 |
| back: aggr dram keys      | 47.278 ms                 | 70.688 ms                 |
| back: set dram grad       | 3.331 ms                  | 8.579 ms                  |
| back: a2a grad            | 12.979 ms                 | 36.205 ms                 |
| back: grad sum & grad cache  | 15.989 ms                 | 68.605 ms                 |
| Backward                  | 152.565 ms                | 203.909 ms                |
| Optimize                  | 21.079 ms                 | 42.966 ms                 |
| BarrierTimeBeforeRank0    | 36.060 us                 | 86.540 us                 |
| BlockToStepN              | 21.663 us                 | 12.648 ms                 |
| OneStep                   | 221.999 ms                | 319.976 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.598 ms                  | 69.449 ms                 |
| bucket keys               | 1.413 ms                  | 2.461 ms                  |
| forward: a2a keys         | 3.014 ms                  | 27.421 ms                 |
| forward: search cache     | 254.456 us                | 385.771 us                |
| forward: a2a values       | 5.794 ms                  | 28.640 ms                 |
| forward: join             | 2.151 ms                  | 3.460 ms                  |
| Forward                   | 38.358 ms                 | 74.013 ms                 |
| back: aggr dram keys      | 47.678 ms                 | 70.669 ms                 |
| back: set dram grad       | 3.414 ms                  | 8.370 ms                  |
| back: a2a grad            | 10.865 ms                 | 35.260 ms                 |
| back: grad sum & grad cache  | 12.901 ms                 | 66.103 ms                 |
| Backward                  | 152.109 ms                | 203.909 ms                |
| Optimize                  | 21.136 ms                 | 42.966 ms                 |
| BarrierTimeBeforeRank0    | 35.984 us                 | 86.540 us                 |
| BlockToStepN              | 21.656 us                 | 14.551 ms                 |
| OneStep                   | 221.038 ms                | 319.976 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 500 steps, total: 21.605, sample: 0.680, forward: 3.961, backward: 12.042, update: 0.320
[proc 2] 500 steps, total: 21.605, sample: 0.728, forward: 3.889, backward: 12.179, update: 0.328
[proc 1] 500 steps, total: 21.605, sample: 0.731, forward: 3.888, backward: 12.386, update: 0.299
[proc 3] 500 steps, total: 21.605, sample: 0.658, forward: 3.965, backward: 12.168, update: 0.328
[proc 5] 500 steps, total: 21.605, sample: 0.731, forward: 3.860, backward: 12.141, update: 0.218
[proc 0] 500 steps, total: 21.605, sample: 0.739, forward: 3.611, backward: 14.077, update: 3.034
Successfully xmh. training takes 118.59845685958862 seconds
before call kg_cache_controller.StopThreads()
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
INFO [44518 controller_process.py:380] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.552 ms                  | 69.449 ms                 |
| bucket keys               | 1.414 ms                  | 2.469 ms                  |
| forward: a2a keys         | 3.032 ms                  | 27.421 ms                 |
| forward: search cache     | 254.373 us                | 432.999 us                |
| forward: a2a values       | 5.773 ms                  | 28.640 ms                 |
| forward: join             | 2.154 ms                  | 3.698 ms                  |
| Forward                   | 38.237 ms                 | 74.013 ms                 |
| back: aggr dram keys      | 48.278 ms                 | 70.669 ms                 |
| back: set dram grad       | 3.434 ms                  | 8.370 ms                  |
| back: a2a grad            | 9.974 ms                  | 35.260 ms                 |
| back: grad sum & grad cache  | 12.817 ms                 | 66.103 ms                 |
| Backward                  | 151.846 ms                | 203.909 ms                |
| Optimize                  | 21.192 ms                 | 45.131 ms                 |
| BarrierTimeBeforeRank0    | 35.915 us                 | 86.540 us                 |
| BlockToStepN              | 21.107 us                 | 14.551 ms                 |
| OneStep                   | 220.511 ms                | 319.976 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

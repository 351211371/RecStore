WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 21:57:24.486860 62963 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_36', no_save_emb=True, max_step=500, batch_size=1600, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [62963 sampler.py:454] Start PreSampling
WARNING [62963 sampler.py:532] Before construct renumbering_dict
WARNING [62963 sampler.py:555] PreSampling done
W20240123 22:10:20.284039 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240123 22:10:20.284271 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240123 22:10:20.284309 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240123 22:10:20.284338 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240123 22:10:20.284363 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240123 22:10:20.284392 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240123 22:10:20.284418 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240123 22:10:20.284463 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240123 22:10:20.284493 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240123 22:10:20.284518 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240123 22:10:20.284560 62963 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240123 22:10:20.284581 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240123 22:10:20.284611 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240123 22:10:20.284761 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240123 22:10:20.284790 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240123 22:10:20.284862 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240123 22:10:20.284898 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240123 22:10:20.284922 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240123 22:10:20.284950 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240123 22:10:20.284978 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240123 22:10:20.285008 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240123 22:10:20.285030 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240123 22:10:20.285055 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240123 22:10:20.285079 62963 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240123 22:10:20.285097 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240123 22:10:20.285117 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240123 22:10:20.285168 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240123 22:10:20.285195 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240123 22:10:20.285216 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240123 22:10:20.285248 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240123 22:10:20.285269 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240123 22:10:20.285301 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240123 22:10:20.285329 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240123 22:10:20.285358 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240123 22:10:20.285382 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240123 22:10:20.285413 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240123 22:10:20.285439 62963 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240123 22:10:20.285457 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240123 22:10:20.285476 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240123 22:10:20.285526 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240123 22:10:20.285548 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240123 22:10:20.285571 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240123 22:10:20.285594 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240123 22:10:20.285616 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240123 22:10:20.285641 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240123 22:10:20.285665 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240123 22:10:20.285689 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240123 22:10:20.285718 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240123 22:10:20.285742 62963 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240123 22:10:20.285763 62963 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240123 22:10:20.285780 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240123 22:10:20.285799 62963 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240123 22:10:20.617061 62963 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100001ee2000 128.2 GB
W20240123 22:10:20.617250 62963 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102010b1a000 328.3 MB
{0: Graph(num_nodes=27256011, num_edges=100992629,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23779591, num_edges=94535774,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=26463902, num_edges=75890617,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=25398646, num_edges=93789131,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27256011 N 100992629 E
MertisPartition: part 1 has 23779591 N 94535774 E
MertisPartition: part 2 has 26463902 N 75890617 E
MertisPartition: part 3 has 25398646 N 93789131 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 4302715,  4302733,   232891,  ...,  3566174, 12177993, 72408235]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 3, 3])}
part_g: DGLGraph(num_nodes=27256011, num_edges=100992629,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27256011, num_edges=100992629,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 954.141 seconds
[Rank1] pid = 22199
[Rank2] pid = 22298
INFO [62963 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [22199 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [22298 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [22446 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [22446 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [22298 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [62963 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [22199 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [22298 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [62963 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [22446 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [22199 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 22:13:30.700309 22200 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240123 22:13:30.700459 22456 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 22:13:30.700618 22299 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 22:13:30.700744 22532 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 22:13:42.045130 22299 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240123 22:13:44.858979 22532 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240123 22:13:45.581800 22200 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240123 22:13:46.072193 22456 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.899 ms                  | 145.037 ms                |
| bucket keys               | 1.075 ms                  | 135.329 ms                |
| forward: a2a keys         | 2.148 ms                  | 845.228 ms                |
| forward: search cache     | 172.793 us                | 18.759 ms                 |
| forward: a2a values       | 1.847 ms                  | 15.430 ms                 |
| forward: join             | 1.328 ms                  | 2.008 ms                  |
| Forward                   | 28.227 ms                 | 1.422 s                   |
| back: aggr dram keys      | 41.094 ms                 | 449.144 ms                |
| back: set dram grad       | 2.614 ms                  | 15.764 ms                 |
| back: a2a grad            | 8.632 ms                  | 35.135 ms                 |
| back: grad sum & grad cache  | 2.777 ms                  | 58.015 ms                 |
| Backward                  | 101.854 ms                | 693.296 ms                |
| Optimize                  | 15.128 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 55.597 us                 | 120.619 us                |
| BlockToStepN              | 12.124 us                 | 26.665 ms                 |
| OneStep                   | 162.787 ms                | 2.140 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.477 ms                  | 145.037 ms                |
| bucket keys               | 1.075 ms                  | 22.769 ms                 |
| forward: a2a keys         | 1.575 ms                  | 63.101 ms                 |
| forward: search cache     | 169.991 us                | 299.832 us                |
| forward: a2a values       | 2.685 ms                  | 10.173 ms                 |
| forward: join             | 1.328 ms                  | 2.115 ms                  |
| Forward                   | 24.929 ms                 | 1.422 s                   |
| back: aggr dram keys      | 40.000 ms                 | 57.718 ms                 |
| back: set dram grad       | 2.614 ms                  | 4.996 ms                  |
| back: a2a grad            | 8.650 ms                  | 26.179 ms                 |
| back: grad sum & grad cache  | 2.777 ms                  | 36.329 ms                 |
| Backward                  | 103.001 ms                | 693.296 ms                |
| Optimize                  | 14.960 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 52.804 us                 | 120.619 us                |
| BlockToStepN              | 12.957 us                 | 26.665 ms                 |
| OneStep                   | 159.912 ms                | 2.140 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.260 ms                  | 135.658 ms                |
| bucket keys               | 1.072 ms                  | 2.084 ms                  |
| forward: a2a keys         | 1.373 ms                  | 20.337 ms                 |
| forward: search cache     | 171.154 us                | 301.156 us                |
| forward: a2a values       | 2.758 ms                  | 9.038 ms                  |
| forward: join             | 1.328 ms                  | 2.074 ms                  |
| Forward                   | 23.888 ms                 | 84.888 ms                 |
| back: aggr dram keys      | 40.000 ms                 | 55.493 ms                 |
| back: set dram grad       | 2.682 ms                  | 4.254 ms                  |
| back: a2a grad            | 8.650 ms                  | 20.320 ms                 |
| back: grad sum & grad cache  | 2.777 ms                  | 32.751 ms                 |
| Backward                  | 104.175 ms                | 143.059 ms                |
| Optimize                  | 15.122 ms                 | 23.954 ms                 |
| BarrierTimeBeforeRank0    | 50.717 us                 | 82.136 us                 |
| BlockToStepN              | 18.407 us                 | 16.710 ms                 |
| OneStep                   | 150.843 ms                | 325.552 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 21.989, sample: 0.927, forward: 4.704, backward: 8.432, update: 0.265
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 18.452, sample: 1.027, forward: 4.600, backward: 8.692, update: 0.234
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 19.175, sample: 0.954, forward: 4.699, backward: 8.420, update: 0.263
[Rank3] pid = 22446
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
train_sampler.Prefill()
-------Step 0-------
tensor([  753422,  4594204,   753465,   753509,   753548,   753594, 47881301,
          146250,  4309487,   753645]) tensor([ 5024686, 33435328, 18461149, 59680176, 61958103, 31159360, 69055781,
        80172396, 43066292, 42405848])
-------Step 1-------
tensor([  753422,  4594204,   753465,   753509,   753548,   753594, 47881301,
          146250,  4309487,   753645]) tensor([24671037, 35379310, 18960206, 75794193, 56193853, 37349526, 67536476,
        28998372, 18816668, 52203201])
-------Step 2-------
tensor([  839214,   839246,   839284,   839325,   839360, 30604165,   312155,
          923320,   839387,   839424]) tensor([ 9999237, 29276298, 40200078, 67098392, 53098178,  5816558,  7100278,
        42754863, 57785300, 78301967])
-------Step 3-------
tensor([  839214,   839246,   839284,   839325,   839360, 30604165,   312155,
          923320,   839387,   839424]) tensor([61618376, 46581703, 62777792, 42894995, 11827867, 19603572, 35997100,
         1834560, 32794505, 14690983])
-------Step 4-------
tensor([915599, 915623, 915647, 915670, 915691, 915714, 915735, 967397, 915758,
        929203]) tensor([64501914, 52363058, 82469190, 33773743, 81415072, 15616141, 19441525,
         5413998, 36571782,  4725434])
-------Step 5-------
tensor([915599, 915623, 915647, 915670, 915691, 915714, 915735, 967397, 915758,
        929203]) tensor([30446305, 78614494, 21155187, 32827452, 46221750, 17305600, 44948287,
        78626148,   961843, 81449991])
-------Step 6-------
tensor([  959251,   959272,   959292, 66415208,   317721,   959309,   959326,
          959342,   959356,   959375]) tensor([ 9581724, 77269823, 80664815, 64828784, 73631730, 33357985, 68228346,
          853587, 49274867, 56525948])
-------Step 7-------
tensor([  959251,   959272,   959292, 66415208,   317721,   959309,   959326,
          959342,   959356,   959375]) tensor([15071067, 76196221, 85345730, 83065023, 56193545, 37841404, 61990765,
        80878519, 67946822, 54373494])
-------Step 8-------
tensor([  996322,   996339,   996354,   996371, 49107986,   940517,   996385,
          940540,   769500,   996401]) tensor([  415038, 32231617, 68951432, 47648143, 11901459,  2000778, 40174563,
        47920762, 23482967, 81928521])
-------Step 9-------
tensor([  996322,   996339,   996354,   996371, 49107986,   940517,   996385,
          940540,   769500,   996401]) tensor([72824442, 80731710,  4484351, 20751427, 49284146, 26411693, 41937608,
        19316170, 10648189, 13280584])
before start barrier
start train
[proc 0] 100 steps, total: 17.962, sample: 1.173, forward: 3.990, backward: 11.132, update: 1.530
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.686 ms                  | 135.658 ms                |
| bucket keys               | 1.072 ms                  | 2.084 ms                  |
| forward: a2a keys         | 1.274 ms                  | 20.337 ms                 |
| forward: search cache     | 171.154 us                | 301.156 us                |
| forward: a2a values       | 2.758 ms                  | 9.080 ms                  |
| forward: join             | 1.328 ms                  | 2.074 ms                  |
| Forward                   | 23.647 ms                 | 84.888 ms                 |
| back: aggr dram keys      | 36.545 ms                 | 58.129 ms                 |
| back: set dram grad       | 2.640 ms                  | 4.254 ms                  |
| back: a2a grad            | 8.650 ms                  | 20.320 ms                 |
| back: grad sum & grad cache  | 2.777 ms                  | 32.751 ms                 |
| Backward                  | 102.828 ms                | 143.059 ms                |
| Optimize                  | 15.175 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 47.567 us                 | 82.321 us                 |
| BlockToStepN              | 14.851 us                 | 16.710 ms                 |
| OneStep                   | 149.807 ms                | 325.552 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.611 ms                  | 135.658 ms                |
| bucket keys               | 1.089 ms                  | 2.082 ms                  |
| forward: a2a keys         | 1.243 ms                  | 16.315 ms                 |
| forward: search cache     | 171.892 us                | 301.156 us                |
| forward: a2a values       | 2.758 ms                  | 9.080 ms                  |
| forward: join             | 1.328 ms                  | 2.115 ms                  |
| Forward                   | 23.663 ms                 | 84.888 ms                 |
| back: aggr dram keys      | 36.545 ms                 | 58.290 ms                 |
| back: set dram grad       | 2.665 ms                  | 4.807 ms                  |
| back: a2a grad            | 8.650 ms                  | 22.733 ms                 |
| back: grad sum & grad cache  | 2.777 ms                  | 32.751 ms                 |
| Backward                  | 103.831 ms                | 151.135 ms                |
| Optimize                  | 15.267 ms                 | 33.826 ms                 |
| BarrierTimeBeforeRank0    | 47.242 us                 | 82.321 us                 |
| BlockToStepN              | 17.239 us                 | 16.710 ms                 |
| OneStep                   | 150.843 ms                | 325.552 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.658 ms                  | 93.883 ms                 |
| bucket keys               | 1.088 ms                  | 2.082 ms                  |
| forward: a2a keys         | 1.239 ms                  | 16.315 ms                 |
| forward: search cache     | 171.935 us                | 301.156 us                |
| forward: a2a values       | 2.758 ms                  | 9.080 ms                  |
| forward: join             | 1.328 ms                  | 2.201 ms                  |
| Forward                   | 23.587 ms                 | 61.530 ms                 |
| back: aggr dram keys      | 36.545 ms                 | 60.935 ms                 |
| back: set dram grad       | 2.666 ms                  | 4.996 ms                  |
| back: a2a grad            | 8.660 ms                  | 26.179 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 34.557 ms                 |
| Backward                  | 103.289 ms                | 143.059 ms                |
| Optimize                  | 15.265 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 46.628 us                 | 82.321 us                 |
| BlockToStepN              | 16.433 us                 | 11.089 ms                 |
| OneStep                   | 150.510 ms                | 285.140 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 15.685, sample: 0.842, forward: 3.168, backward: 8.177, update: 0.230
[proc 3] 200 steps, total: 15.686, sample: 0.726, forward: 3.313, backward: 7.889, update: 0.291
[proc 2] 200 steps, total: 15.686, sample: 0.871, forward: 3.189, backward: 7.851, update: 0.263
[proc 0] 200 steps, total: 15.685, sample: 1.210, forward: 2.415, backward: 10.440, update: 1.524
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.686 ms                  | 93.883 ms                 |
| bucket keys               | 1.089 ms                  | 2.082 ms                  |
| forward: a2a keys         | 1.222 ms                  | 15.976 ms                 |
| forward: search cache     | 172.793 us                | 301.156 us                |
| forward: a2a values       | 2.758 ms                  | 9.080 ms                  |
| forward: join             | 1.328 ms                  | 2.149 ms                  |
| Forward                   | 23.492 ms                 | 61.530 ms                 |
| back: aggr dram keys      | 36.545 ms                 | 59.361 ms                 |
| back: set dram grad       | 2.648 ms                  | 4.807 ms                  |
| back: a2a grad            | 8.660 ms                  | 22.733 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 32.751 ms                 |
| Backward                  | 102.134 ms                | 143.059 ms                |
| Optimize                  | 15.207 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 45.624 us                 | 83.298 us                 |
| BlockToStepN              | 14.964 us                 | 11.089 ms                 |
| OneStep                   | 149.371 ms                | 285.140 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.828 ms                  | 93.883 ms                 |
| bucket keys               | 1.088 ms                  | 2.077 ms                  |
| forward: a2a keys         | 1.206 ms                  | 15.976 ms                 |
| forward: search cache     | 172.180 us                | 303.138 us                |
| forward: a2a values       | 2.758 ms                  | 9.038 ms                  |
| forward: join             | 1.328 ms                  | 2.115 ms                  |
| Forward                   | 23.383 ms                 | 61.530 ms                 |
| back: aggr dram keys      | 38.721 ms                 | 59.361 ms                 |
| back: set dram grad       | 2.628 ms                  | 4.807 ms                  |
| back: a2a grad            | 8.650 ms                  | 20.320 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 34.557 ms                 |
| Backward                  | 101.363 ms                | 143.059 ms                |
| Optimize                  | 15.192 ms                 | 27.616 ms                 |
| BarrierTimeBeforeRank0    | 45.227 us                 | 83.298 us                 |
| BlockToStepN              | 14.041 us                 | 11.089 ms                 |
| OneStep                   | 148.909 ms                | 285.140 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.962 ms                  | 85.332 ms                 |
| bucket keys               | 1.083 ms                  | 2.082 ms                  |
| forward: a2a keys         | 1.199 ms                  | 16.315 ms                 |
| forward: search cache     | 171.935 us                | 303.138 us                |
| forward: a2a values       | 2.758 ms                  | 9.038 ms                  |
| forward: join             | 1.328 ms                  | 2.160 ms                  |
| Forward                   | 23.273 ms                 | 56.553 ms                 |
| back: aggr dram keys      | 36.545 ms                 | 59.906 ms                 |
| back: set dram grad       | 2.623 ms                  | 4.996 ms                  |
| back: a2a grad            | 8.660 ms                  | 22.733 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 34.557 ms                 |
| Backward                  | 101.102 ms                | 140.422 ms                |
| Optimize                  | 15.193 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 45.111 us                 | 82.321 us                 |
| BlockToStepN              | 13.599 us                 | 5.468 ms                  |
| OneStep                   | 148.858 ms                | 261.228 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 300 steps, total: 15.359, sample: 0.570, forward: 3.397, backward: 7.765, update: 0.259
[proc 2] 300 steps, total: 15.359, sample: 0.576, forward: 3.395, backward: 7.714, update: 0.252
[proc 1] 300 steps, total: 15.359, sample: 0.642, forward: 3.352, backward: 7.953, update: 0.226
[proc 0] 300 steps, total: 15.359, sample: 1.199, forward: 2.414, backward: 10.184, update: 1.463
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.201 ms                  | 94.955 ms                 |
| bucket keys               | 1.086 ms                  | 2.082 ms                  |
| forward: a2a keys         | 1.190 ms                  | 15.976 ms                 |
| forward: search cache     | 172.936 us                | 303.138 us                |
| forward: a2a values       | 2.758 ms                  | 9.080 ms                  |
| forward: join             | 1.486 ms                  | 2.160 ms                  |
| Forward                   | 23.196 ms                 | 61.530 ms                 |
| back: aggr dram keys      | 36.545 ms                 | 59.906 ms                 |
| back: set dram grad       | 2.623 ms                  | 4.807 ms                  |
| back: a2a grad            | 8.660 ms                  | 22.733 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 33.845 ms                 |
| Backward                  | 100.255 ms                | 140.422 ms                |
| Optimize                  | 15.141 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 44.942 us                 | 83.298 us                 |
| BlockToStepN              | 13.162 us                 | 11.089 ms                 |
| OneStep                   | 148.640 ms                | 261.228 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.210 ms                  | 94.955 ms                 |
| bucket keys               | 1.088 ms                  | 2.083 ms                  |
| forward: a2a keys         | 1.200 ms                  | 15.179 ms                 |
| forward: search cache     | 172.701 us                | 303.138 us                |
| forward: a2a values       | 2.758 ms                  | 9.038 ms                  |
| forward: join             | 1.486 ms                  | 2.149 ms                  |
| Forward                   | 23.292 ms                 | 61.530 ms                 |
| back: aggr dram keys      | 36.545 ms                 | 59.906 ms                 |
| back: set dram grad       | 2.619 ms                  | 4.254 ms                  |
| back: a2a grad            | 8.660 ms                  | 22.733 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 33.845 ms                 |
| Backward                  | 100.064 ms                | 140.422 ms                |
| Optimize                  | 15.124 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 44.840 us                 | 83.298 us                 |
| BlockToStepN              | 13.113 us                 | 11.089 ms                 |
| OneStep                   | 147.869 ms                | 261.228 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.210 ms                  | 93.883 ms                 |
| bucket keys               | 1.086 ms                  | 2.083 ms                  |
| forward: a2a keys         | 1.213 ms                  | 15.179 ms                 |
| forward: search cache     | 171.892 us                | 305.957 us                |
| forward: a2a values       | 2.758 ms                  | 9.038 ms                  |
| forward: join             | 1.486 ms                  | 2.160 ms                  |
| Forward                   | 23.331 ms                 | 56.553 ms                 |
| back: aggr dram keys      | 37.162 ms                 | 60.935 ms                 |
| back: set dram grad       | 2.614 ms                  | 4.254 ms                  |
| back: a2a grad            | 8.660 ms                  | 22.733 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 33.845 ms                 |
| Backward                  | 99.789 ms                 | 137.390 ms                |
| Optimize                  | 15.097 ms                 | 27.616 ms                 |
| BarrierTimeBeforeRank0    | 44.830 us                 | 82.321 us                 |
| BlockToStepN              | 13.001 us                 | 8.813 ms                  |
| OneStep                   | 147.072 ms                | 260.669 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 400 steps, total: 15.543, sample: 0.714, forward: 3.259, backward: 8.163, update: 0.216
[proc 3] 400 steps, total: 15.543, sample: 0.622, forward: 3.371, backward: 7.883, update: 0.267
[proc 0] 400 steps, total: 15.543, sample: 1.185, forward: 2.449, backward: 10.284, update: 1.507
[proc 2] 400 steps, total: 15.543, sample: 0.677, forward: 3.311, backward: 7.879, update: 0.246
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.260 ms                  | 93.883 ms                 |
| bucket keys               | 1.088 ms                  | 2.084 ms                  |
| forward: a2a keys         | 1.214 ms                  | 14.852 ms                 |
| forward: search cache     | 171.035 us                | 305.957 us                |
| forward: a2a values       | 2.758 ms                  | 9.038 ms                  |
| forward: join             | 1.486 ms                  | 2.160 ms                  |
| Forward                   | 23.381 ms                 | 56.553 ms                 |
| back: aggr dram keys      | 37.911 ms                 | 59.906 ms                 |
| back: set dram grad       | 2.612 ms                  | 4.254 ms                  |
| back: a2a grad            | 8.660 ms                  | 20.320 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 32.751 ms                 |
| Backward                  | 99.583 ms                 | 140.422 ms                |
| Optimize                  | 15.093 ms                 | 27.616 ms                 |
| BarrierTimeBeforeRank0    | 44.575 us                 | 83.298 us                 |
| BlockToStepN              | 12.959 us                 | 11.089 ms                 |
| OneStep                   | 147.197 ms                | 261.228 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.265 ms                  | 96.654 ms                 |
| bucket keys               | 1.089 ms                  | 2.084 ms                  |
| forward: a2a keys         | 1.212 ms                  | 15.179 ms                 |
| forward: search cache     | 171.230 us                | 305.957 us                |
| forward: a2a values       | 2.758 ms                  | 8.923 ms                  |
| forward: join             | 1.486 ms                  | 2.149 ms                  |
| Forward                   | 23.369 ms                 | 56.553 ms                 |
| back: aggr dram keys      | 37.769 ms                 | 59.906 ms                 |
| back: set dram grad       | 2.608 ms                  | 4.090 ms                  |
| back: a2a grad            | 8.678 ms                  | 20.320 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 32.235 ms                 |
| Backward                  | 99.259 ms                 | 140.422 ms                |
| Optimize                  | 15.098 ms                 | 27.616 ms                 |
| BarrierTimeBeforeRank0    | 44.575 us                 | 87.834 us                 |
| BlockToStepN              | 12.959 us                 | 11.089 ms                 |
| OneStep                   | 147.036 ms                | 261.228 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.229 ms                  | 94.955 ms                 |
| bucket keys               | 1.092 ms                  | 2.084 ms                  |
| forward: a2a keys         | 1.210 ms                  | 15.179 ms                 |
| forward: search cache     | 170.983 us                | 305.957 us                |
| forward: a2a values       | 6.123 ms                  | 9.080 ms                  |
| forward: join             | 1.486 ms                  | 2.149 ms                  |
| Forward                   | 23.329 ms                 | 53.451 ms                 |
| back: aggr dram keys      | 37.769 ms                 | 60.935 ms                 |
| back: set dram grad       | 2.602 ms                  | 4.090 ms                  |
| back: a2a grad            | 8.695 ms                  | 25.480 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 33.845 ms                 |
| Backward                  | 99.114 ms                 | 140.422 ms                |
| Optimize                  | 15.079 ms                 | 27.408 ms                 |
| BarrierTimeBeforeRank0    | 44.441 us                 | 85.811 us                 |
| BlockToStepN              | 12.957 us                 | 11.089 ms                 |
| OneStep                   | 146.954 ms                | 260.669 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.229 ms                  | 94.955 ms                 |
| bucket keys               | 1.088 ms                  | 2.083 ms                  |
| forward: a2a keys         | 1.214 ms                  | 15.179 ms                 |
| forward: search cache     | 170.964 us                | 305.957 us                |
| forward: a2a values       | 6.180 ms                  | 9.038 ms                  |
| forward: join             | 1.486 ms                  | 2.160 ms                  |
| Forward                   | 23.391 ms                 | 53.451 ms                 |
| back: aggr dram keys      | 37.769 ms                 | 59.906 ms                 |
| back: set dram grad       | 2.596 ms                  | 3.528 ms                  |
| back: a2a grad            | 8.723 ms                  | 22.782 ms                 |
| back: grad sum & grad cache  | 2.982 ms                  | 33.845 ms                 |
| Backward                  | 99.107 ms                 | 140.422 ms                |
| Optimize                  | 15.082 ms                 | 27.616 ms                 |
| BarrierTimeBeforeRank0    | 44.534 us                 | 85.811 us                 |
| BlockToStepN              | 13.029 us                 | 11.984 ms                 |
| OneStep                   | 147.006 ms                | 260.669 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 500 steps, total: 15.333, sample: 1.156, forward: 2.453, backward: 10.160, update: 1.448
[proc 2] 500 steps, total: 15.333, sample: 0.583, forward: 3.347, backward: 7.699, update: 0.257
[proc 1] 500 steps, total: 15.333, sample: 0.784, forward: 3.136, backward: 8.006, update: 0.163
[proc 3] 500 steps, total: 15.333, sample: 0.626, forward: 3.338, backward: 7.686, update: 0.260
Successfully xmh. training takes 79.88281869888306 seconds
before call kg_cache_controller.StopThreads()
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads
INFO [62963 controller_process.py:380] call rank0 to StopThreads

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 17:18:50.849992 45841 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_22', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [45841 sampler.py:454] Start PreSampling
WARNING [45841 sampler.py:532] Before construct renumbering_dict
WARNING [45841 sampler.py:555] PreSampling done
W20240123 17:31:43.078528 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240123 17:31:43.078744 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240123 17:31:43.078781 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240123 17:31:43.078819 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240123 17:31:43.078846 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240123 17:31:43.078869 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240123 17:31:43.078896 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240123 17:31:43.078927 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240123 17:31:43.078955 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240123 17:31:43.078979 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240123 17:31:43.079012 45841 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240123 17:31:43.079038 45841 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240123 17:31:43.079061 45841 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240123 17:31:43.079185 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240123 17:31:43.079221 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240123 17:31:43.079244 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240123 17:31:43.079283 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240123 17:31:43.079305 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240123 17:31:43.079337 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240123 17:31:43.079363 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240123 17:31:43.079389 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240123 17:31:43.079411 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240123 17:31:43.079434 45841 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240123 17:31:43.079457 45841 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240123 17:31:43.079474 45841 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240123 17:31:43.079497 45841 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240123 17:31:43.390914 45841 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100000f72000 128.2 GB
W20240123 17:31:43.391090 45841 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10200fbaa000 328.3 MB
{0: Graph(num_nodes=43196088, num_edges=182879791,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=47371617, num_edges=163853044,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 43196088 N 182879791 E
MertisPartition: part 1 has 47371617 N 163853044 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 24862891, 27748820, 20932263]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4302709,  4302725,   583387,  ..., 22756956, 27769384, 76126565]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 949.337 seconds
INFO [5150 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [45841 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [45841 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [5150 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240123 17:34:42.723492  5151 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240123 17:34:42.723924  5214 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240123 17:34:42.767052  5214 IPCTensor.h:365] NewIPCTensor: input_keys_1 [100000]0x1020243f5000 781.2 kB
W20240123 17:34:42.767098  5151 IPCTensor.h:365] NewIPCTensor: input_keys_0 [100000]0x1020244ba000 781.2 kB
W20240123 17:34:42.767223  5151 IPCTensor.h:365] NewIPCTensor: input_keys_neg_0 [100000]0x10202457f000 781.2 kB
W20240123 17:34:42.767233  5214 IPCTensor.h:365] NewIPCTensor: input_keys_neg_1 [100000]0x102024644000 781.2 kB
W20240123 17:34:42.767292  5151 IPCTensor.h:365] NewIPCTensor: backward_grads_0 [100000, 400]0x102024709000 152.6 MB
W20240123 17:34:42.767324  5214 IPCTensor.h:365] NewIPCTensor: backward_grads_1 [100000, 400]0x10202dfa1000 152.6 MB
W20240123 17:34:42.767336  5151 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x102037839000 152.6 MB
W20240123 17:34:42.767376  5214 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x1020410d1000 152.6 MB
W20240123 17:34:42.767390  5151 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 17:34:42.767412  5214 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 17:34:42.768525  5214 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 17:34:42.768525  5151 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
cudaHostRegister 0x100000f72000
1: KnownLocalCachedEmbedding init done
WARNING [5150 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank1] pid = 5150
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414)]
cudaHostRegister 0x100000f72000
0: KnownLocalCachedEmbedding init done
WARNING [45841 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 17:34:57.231933  5151 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240123 17:34:57.231976  5214 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240123 17:34:57.232823  5151 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240123 17:34:57.232914  5151 grad_base.h:172] Init GradProcessingBase done
I20240123 17:35:06.345028  5151 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240123 17:35:06.345170  5151 kg_controller.h:78] after init GradAsyncProcessingV2
I20240123 17:35:06.345176  5151 kg_controller.h:84] Construct KGCacheController done
I20240123 17:35:06.622057  5151 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240123 17:35:31.393002  5983 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 17:35:31.393484  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 17:35:33.567428  5983 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 17:35:33.567538  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 17:35:46.927109  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 17:35:46.938105  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240123 17:35:47.004427  5151 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
W20240123 17:35:52.495110  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 17:35:52.504318  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240123 17:35:52.554891  5214 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
E20240123 17:35:53.655210  5151 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 17:35:53.680848  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240123 17:35:53.697335  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240123 17:35:53.926440  5151 grad_async_v2.h:236] pq is empty
W20240123 17:35:54.258615  5151 grad_async_v2.h:236] pq is empty
E20240123 17:35:54.655010  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 17:35:54.680017  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=21, pq.top=21
W20240123 17:35:54.728760  5983 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end2
E20240123 17:35:55.656663  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 17:35:55.685178  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=41, pq.top=41
W20240123 17:35:55.740741  5983 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 794.613 us                | 56.277 ms                 |
| ProcessBack:UpdateCache   | 747.740 us                | 105.948 ms                |
| ProcessBack:UpsertPq      | 4.546 ms                  | 21.061 ms                 |
| ProcessOneStep            | 15.240 ms                 | 22.667 ms                 |
| BlockToStepN              | 710.635 us                | 20.135 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 17:35:56.656188  5982 parallel_pq_v2.h:76] insert failed, size(hashtable)=137
W20240123 17:35:56.685036  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=65, pq.top=65
W20240123 17:35:56.769428  5983 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.404 ms                  | 98.781 ms                 |
| Forward                   | 4.542 ms                  | 6.628 ms                  |
| Backward                  | 4.241 ms                  | 10.489 ms                 |
| Optimize                  | 2.191 ms                  | 4.292 ms                  |
| BarrierTimeBeforeRank0    | 27.940 us                 | 10.060 ms                 |
| AfterBackward             | 13.122 ms                 | 22.699 ms                 |
| BlockToStepN              | 769.683 us                | 20.352 ms                 |
| OneStep                   | 51.079 ms                 | 158.229 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 17:35:57.656201  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 17:35:57.685066  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=87, pq.top=87
W20240123 17:35:57.788581  5983 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 5.650, sample: 0.961, forward: 1.041, backward: 0.735, update: 0.188
train_sampler.Prefill()
-------Step 0-------
tensor([1650298, 1650308, 1650325, 1729047, 1650340, 1650358, 1650373,   19695,
        1650392, 1650409]) tensor([  268377,  4731056, 18713202, 53386050, 31994613, 14955088, 78940141,
         8220069, 41517314, 70222936])
-------Step 1-------
tensor([1650298, 1650308, 1650325, 1729047, 1650340, 1650358, 1650373,   19695,
        1650392, 1650409]) tensor([62592500, 71078458, 72926219, 44506083, 42033265,   233087, 27014090,
        49127315, 72057051, 72307788])
-------Step 2-------
tensor([1692964, 1692978, 1692994, 1693009, 1693025, 1693052, 1693066, 1693085,
        1736545, 1693101]) tensor([16204024, 14626299, 43917580, 65793330, 31720015,  2031518, 34468605,
        53962964, 57578451, 12240044])
-------Step 3-------
tensor([1692964, 1692978, 1692994, 1693009, 1693025, 1693052, 1693066, 1693085,
        1736545, 1693101]) tensor([42898390, 75925222,  2355355, 30402287, 47740976, 37193694, 35738839,
        43847362, 61510220, 25071332])
-------Step 4-------
tensor([ 1734022,  1734038,   317140,  1734047,   317168, 46771578,   895097,
         1734065,  1734076,  1734091]) tensor([ 1128741, 75156460, 28582480, 38704518, 84986274, 60722077, 56878622,
        32729512, 24091694, 42417980])
-------Step 5-------
tensor([ 1734022,  1734038,   317140,  1734047,   317168, 46771578,   895097,
         1734065,  1734076,  1734091]) tensor([56229377, 34522887, 48932836, 16474282, 26206697, 64042533, 46640984,
        10562875, 67631745, 83967790])
-------Step 6-------
tensor([ 1774455,  1774466,  1774474,   448994,  1774485,  1774506,  1774520,
        16048160,  1774536,  4340241]) tensor([16454365, 34909244,  5989283,  1656986, 18560030, 17992877,  2801947,
         1233729, 82975261, 23906669])
-------Step 7-------
tensor([ 1774455,  1774466,  1774474,   448994,  1774485,  1774506,  1774520,
        16048160,  1774536,  4340241]) tensor([63318579, 63442331, 72924552,  1396609,  8838071, 42640588, 75398367,
        72091494, 58478029,  9238519])
-------Step 8-------
tensor([1810390, 1810397, 1810410,  450951, 1810423, 1810432, 1810442,  319080,
        1810457, 1810467]) tensor([81177917, 83434145,   522710,  4347732, 42640297, 27766479, 76587485,
        69893939, 33564712, 22776234])
-------Step 9-------
tensor([1810390, 1810397, 1810410,  450951, 1810423, 1810432, 1810442,  319080,
        1810457, 1810467]) tensor([  772759, 42558013, 18082042, 61269053, 30711649,  1976374, 21981011,
        34643171, 26037043, 63900317])
before start barrier
start train
[proc 0] 100 steps, total: 11.201, sample: 1.251, forward: 1.004, backward: 0.656, update: 0.230
E20240123 17:35:58.660426  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 17:35:58.701035  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=111, pq.top=111
W20240123 17:35:58.797771  5983 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240123 17:35:59.660008  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=647
W20240123 17:35:59.771504  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=135, pq.top=135
W20240123 17:35:59.818686  5983 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
E20240123 17:36:00.660007  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=3734
W20240123 17:36:00.771247  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=157, pq.top=157
W20240123 17:36:00.857973  5983 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 774.605 us                | 934.930 us                |
| ProcessBack:UpdateCache   | 668.931 us                | 856.587 us                |
| ProcessBack:UpsertPq      | 4.637 ms                  | 18.020 ms                 |
| ProcessOneStep            | 13.093 ms                 | 22.275 ms                 |
| BlockToStepN              | 4.019 ms                  | 31.748 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 17:36:01.660007  5982 parallel_pq_v2.h:76] insert failed, size(hashtable)=14198
W20240123 17:36:01.785264  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=181, pq.top=181
W20240123 17:36:01.863590  5983 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.281 ms                  | 93.170 ms                 |
| Forward                   | 4.591 ms                  | 6.491 ms                  |
| Backward                  | 4.150 ms                  | 7.608 ms                  |
| Optimize                  | 2.159 ms                  | 4.376 ms                  |
| BarrierTimeBeforeRank0    | 25.108 us                 | 10.060 ms                 |
| AfterBackward             | 13.963 ms                 | 22.699 ms                 |
| BlockToStepN              | 12.210 ms                 | 31.811 ms                 |
| OneStep                   | 51.079 ms                 | 145.140 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 17:36:02.660006  5982 parallel_pq_v2.h:76] insert failed, size(hashtable)=11462
[proc 1] 200 steps, total: 4.515, sample: 0.719, forward: 0.412, backward: 0.400, update: 0.185
[proc 0] 200 steps, total: 4.515, sample: 1.060, forward: 0.461, backward: 0.401, update: 0.218
W20240123 17:36:02.803418  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=202, pq.top=202
W20240123 17:36:03.039088  5983 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end8
E20240123 17:36:03.660007  5151 parallel_pq_v2.h:76] insert failed, size(hashtable)=6149
W20240123 17:36:03.803889  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=225, pq.top=225
W20240123 17:36:04.096218  5983 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end1
E20240123 17:36:04.660044  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=11446
W20240123 17:36:04.810403  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=245, pq.top=245
W20240123 17:36:05.270388  5983 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end4
E20240123 17:36:05.660009  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1276
W20240123 17:36:05.810544  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=265, pq.top=265
W20240123 17:36:06.342734  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 782.409 us                | 2.150 ms                  |
| ProcessBack:UpdateCache   | 692.940 us                | 851.458 us                |
| ProcessBack:UpsertPq      | 4.710 ms                  | 20.594 ms                 |
| ProcessOneStep            | 13.875 ms                 | 33.350 ms                 |
| BlockToStepN              | 10.187 ms                 | 42.016 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 17:36:06.660068  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=4542
W20240123 17:36:06.834192  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=285, pq.top=285
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.824 ms                  | 87.610 ms                 |
| Forward                   | 4.659 ms                  | 6.456 ms                  |
| Backward                  | 4.196 ms                  | 7.608 ms                  |
| Optimize                  | 2.165 ms                  | 4.376 ms                  |
| BarrierTimeBeforeRank0    | 24.896 us                 | 10.452 ms                 |
| AfterBackward             | 13.963 ms                 | 33.376 ms                 |
| BlockToStepN              | 10.370 ms                 | 42.114 ms                 |
| OneStep                   | 51.061 ms                 | 139.343 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 17:36:07.456090  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end6
E20240123 17:36:07.660008  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1303
[proc 0] 300 steps, total: 4.947, sample: 0.947, forward: 0.469, backward: 0.430, update: 0.221
[proc 1] 300 steps, total: 4.947, sample: 0.637, forward: 0.437, backward: 0.452, update: 0.189
W20240123 17:36:07.874838  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=305, pq.top=305
W20240123 17:36:08.470722  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 17:36:08.660009  5151 parallel_pq_v2.h:76] insert failed, size(hashtable)=3
W20240123 17:36:08.884251  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=320, pq.top=319
W20240123 17:36:09.511309  5983 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end2
E20240123 17:36:09.660012  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=4623
W20240123 17:36:09.884136  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=339, pq.top=339
E20240123 17:36:10.661594  5151 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 17:36:10.714327  5983 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end4
W20240123 17:36:10.899829  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=355, pq.top=355
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 783.958 us                | 11.475 ms                 |
| ProcessBack:UpdateCache   | 684.229 us                | 851.458 us                |
| ProcessBack:UpsertPq      | 4.884 ms                  | 24.887 ms                 |
| ProcessOneStep            | 14.122 ms                 | 40.415 ms                 |
| BlockToStepN              | 9.765 ms                  | 56.097 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 17:36:11.661010  5982 parallel_pq_v2.h:76] insert failed, size(hashtable)=10500
W20240123 17:36:11.748770  5983 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end9
W20240123 17:36:11.899521  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=372, pq.top=372
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.894 ms                  | 93.170 ms                 |
| Forward                   | 4.706 ms                  | 6.491 ms                  |
| Backward                  | 4.230 ms                  | 7.341 ms                  |
| Optimize                  | 2.177 ms                  | 4.400 ms                  |
| BarrierTimeBeforeRank0    | 25.113 us                 | 10.060 ms                 |
| AfterBackward             | 14.147 ms                 | 40.442 ms                 |
| BlockToStepN              | 10.370 ms                 | 56.176 ms                 |
| OneStep                   | 51.087 ms                 | 158.229 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 17:36:12.661008  5982 parallel_pq_v2.h:76] insert failed, size(hashtable)=23120
W20240123 17:36:12.850121  5983 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end9
W20240123 17:36:12.899713  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=389, pq.top=389
[proc 1] 400 steps, total: 5.903, sample: 0.845, forward: 0.423, backward: 0.424, update: 0.192
[proc 0] 400 steps, total: 5.903, sample: 1.381, forward: 0.492, backward: 0.468, update: 0.234
E20240123 17:36:13.661010  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=2615
W20240123 17:36:13.891561  5983 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end6
W20240123 17:36:14.007936  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=407, pq.top=407
E20240123 17:36:14.661078  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=8
W20240123 17:36:14.897933  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
W20240123 17:36:15.013146  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=424, pq.top=424
E20240123 17:36:15.661010  5982 parallel_pq_v2.h:76] insert failed, size(hashtable)=11163
W20240123 17:36:15.935840  5983 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end1
W20240123 17:36:16.014583  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=443, pq.top=443
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 782.807 us                | 2.142 ms                  |
| ProcessBack:UpdateCache   | 648.703 us                | 841.199 us                |
| ProcessBack:UpsertPq      | 4.901 ms                  | 24.645 ms                 |
| ProcessOneStep            | 14.212 ms                 | 34.930 ms                 |
| BlockToStepN              | 11.646 ms                 | 58.673 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 17:36:16.672111  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 17:36:16.935432  5983 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end0
W20240123 17:36:17.014986  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=462, pq.top=462
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.033 ms                  | 90.945 ms                 |
| Forward                   | 4.770 ms                  | 6.456 ms                  |
| Backward                  | 4.247 ms                  | 7.267 ms                  |
| Optimize                  | 2.193 ms                  | 4.818 ms                  |
| BarrierTimeBeforeRank0    | 25.298 us                 | 1.729 ms                  |
| AfterBackward             | 14.282 ms                 | 34.955 ms                 |
| BlockToStepN              | 12.186 ms                 | 64.062 ms                 |
| OneStep                   | 51.412 ms                 | 145.140 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 17:36:17.672117  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=15484
W20240123 17:36:17.960546  5983 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240123 17:36:18.024027  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=477, pq.top=477
E20240123 17:36:18.672012  5983 parallel_pq_v2.h:76] insert failed, size(hashtable)=18103
W20240123 17:36:19.022711  5983 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
W20240123 17:36:19.051286  5151 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=494, pq.top=493
[proc 0] 500 steps, total: 5.810, sample: 1.207, forward: 0.488, backward: 0.433, update: 0.229
[proc 1] 500 steps, total: 5.810, sample: 0.688, forward: 0.430, backward: 0.430, update: 0.190
Successfully xmh. training takes 32.37625169754028 seconds
before call kg_cache_controller.StopThreads()
W20240123 17:36:19.380664  5151 grad_async_v2.h:71] call StopThreads. PID = 45841
W20240123 17:36:19.380697  5151 grad_base.h:210] before processOneStepNegThread_.join();
W20240123 17:36:19.380966  5151 grad_base.h:212] after processOneStepNegThread_.join();
W20240123 17:36:19.380991  5151 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240123 17:36:19.507889  5151 grad_async_v2.h:91] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 782.807 us                | 2.142 ms                  |
| ProcessBack:UpdateCache   | 626.572 us                | 829.129 us                |
| ProcessBack:UpsertPq      | 4.908 ms                  | 25.095 ms                 |
| ProcessOneStep            | 14.285 ms                 | 34.930 ms                 |
| BlockToStepN              | 13.551 ms                 | 75.092 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.063 ms                  | 90.945 ms                 |
| Forward                   | 4.792 ms                  | 6.456 ms                  |
| Backward                  | 4.264 ms                  | 7.267 ms                  |
| Optimize                  | 2.199 ms                  | 4.874 ms                  |
| BarrierTimeBeforeRank0    | 25.378 us                 | 1.729 ms                  |
| AfterBackward             | 14.311 ms                 | 34.955 ms                 |
| BlockToStepN              | 13.626 ms                 | 75.196 ms                 |
| OneStep                   | 51.507 ms                 | 152.242 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

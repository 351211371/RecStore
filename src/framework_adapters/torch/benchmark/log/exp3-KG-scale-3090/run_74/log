WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 17:00:52.678529 16154 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_21', no_save_emb=True, max_step=500, batch_size=1600, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [16154 sampler.py:454] Start PreSampling
WARNING [16154 sampler.py:532] Before construct renumbering_dict
WARNING [16154 sampler.py:555] PreSampling done
W20240123 17:13:53.280638 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240123 17:13:53.280862 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240123 17:13:53.280900 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240123 17:13:53.280920 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240123 17:13:53.280939 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240123 17:13:53.280965 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240123 17:13:53.280984 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240123 17:13:53.281013 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240123 17:13:53.281044 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240123 17:13:53.281064 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240123 17:13:53.281095 16154 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240123 17:13:53.281113 16154 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240123 17:13:53.281132 16154 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240123 17:13:53.281247 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240123 17:13:53.281278 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240123 17:13:53.281302 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240123 17:13:53.281319 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240123 17:13:53.281352 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240123 17:13:53.281378 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240123 17:13:53.281401 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240123 17:13:53.281425 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240123 17:13:53.281445 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240123 17:13:53.281467 16154 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240123 17:13:53.281492 16154 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240123 17:13:53.281507 16154 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240123 17:13:53.281522 16154 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240123 17:13:53.645404 16154 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100000f72000 128.2 GB
W20240123 17:13:53.645570 16154 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10200fbaa000 328.3 MB
{0: Graph(num_nodes=43196088, num_edges=182879791,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=47371617, num_edges=163853044,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 43196088 N 182879791 E
MertisPartition: part 1 has 47371617 N 163853044 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 24862891, 27748820, 20932263]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4302707,  4302712,   542270,  ..., 22247355, 27507823, 61895035]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 958.274 seconds
INFO [41577 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [16154 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [16154 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [41577 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
WARNING [16154 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [41577 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 17:17:00.266175 41642 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240123 17:17:00.266517 41578 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
I20240123 17:17:25.994136 41642 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240123 17:17:28.770527 41578 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.879 ms                  | 5.879 ms                  |
| bucket keys               | 811.914 us                | 191.305 ms                |
| forward: a2a keys         | 3.067 ms                  | 530.812 ms                |
| forward: search cache     | 120.808 us                | 17.357 ms                 |
| forward: a2a values       | 674.681 us                | 4.965 ms                  |
| forward: join             | 857.365 us                | 1.937 ms                  |
| Forward                   | 1.118 s                   | 1.118 s                   |
| back: aggr dram keys      | 14.161 ms                 | 200.636 ms                |
| back: set dram grad       | 2.459 ms                  | 2.459 ms                  |
| back: a2a grad            | 1.627 ms                  | 1.627 ms                  |
| back: grad sum & grad cache  | 777.962 us                | 777.962 us                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.133 ms                  | 70.374 ms                 |
| bucket keys               | 964.747 us                | 2.187 ms                  |
| forward: a2a keys         | 749.071 us                | 139.322 ms                |
| forward: search cache     | 139.284 us                | 247.089 us                |
| forward: a2a values       | 859.922 us                | 4.965 ms                  |
| forward: join             | 857.365 us                | 2.089 ms                  |
| Forward                   | 17.733 ms                 | 1.118 s                   |
| back: aggr dram keys      | 18.670 ms                 | 39.617 ms                 |
| back: set dram grad       | 1.538 ms                  | 2.133 ms                  |
| back: a2a grad            | 1.780 ms                  | 4.023 ms                  |
| back: grad sum & grad cache  | 794.676 us                | 10.794 ms                 |
| Backward                  | 67.997 ms                 | 389.262 ms                |
| Optimize                  | 9.823 ms                  | 10.992 ms                 |
| BarrierTimeBeforeRank0    | 54.582 us                 | 85.031 us                 |
| BlockToStepN              | 15.068 us                 | 67.711 us                 |
| OneStep                   | 103.318 ms                | 1.525 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.084 ms                  | 67.616 ms                 |
| bucket keys               | 1.054 ms                  | 2.489 ms                  |
| forward: a2a keys         | 754.908 us                | 134.991 ms                |
| forward: search cache     | 140.249 us                | 258.247 us                |
| forward: a2a values       | 3.242 ms                  | 6.599 ms                  |
| forward: join             | 918.940 us                | 2.189 ms                  |
| Forward                   | 17.883 ms                 | 153.593 ms                |
| back: aggr dram keys      | 26.993 ms                 | 40.923 ms                 |
| back: set dram grad       | 1.575 ms                  | 2.179 ms                  |
| back: a2a grad            | 3.343 ms                  | 5.466 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 10.857 ms                 |
| Backward                  | 70.915 ms                 | 96.947 ms                 |
| Optimize                  | 10.041 ms                 | 10.992 ms                 |
| BarrierTimeBeforeRank0    | 51.898 us                 | 79.373 us                 |
| BlockToStepN              | 14.955 us                 | 67.711 us                 |
| OneStep                   | 104.665 ms                | 305.726 ms                |
+---------------------------+---------------------------+---------------------------+
[Rank1] pid = 41577
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414)]
train_sampler.Prefill()
-------Step 0-------
tensor([1953524, 1953542, 1953558, 1953575, 1953591, 1953602, 1953618,   24744,
        1953634, 1953650]) tensor([ 1190161,  4705107, 15833954, 55088882, 31390375, 15197427, 79165658,
         8847838, 50373043, 72683055])
-------Step 1-------
tensor([1953524, 1953542, 1953558, 1953575, 1953591, 1953602, 1953618,   24744,
        1953634, 1953650]) tensor([85813807, 72076445, 44488045, 53542150, 79080152, 60578888, 25778942,
        52804474, 67727983, 49746769])
-------Step 2-------
tensor([6618602, 1993900,  105142, 1993916,  841734, 1993931, 1993947,  454311,
        1993962, 1993981]) tensor([47589614,  2026200, 55279321,  1818652, 66100511, 76122703, 36800195,
        17459403, 62621769, 15446368])
-------Step 3-------
tensor([6618602, 1993900,  105142, 1993916,  841734, 1993931, 1993947,  454311,
        1993962, 1993981]) tensor([41073095, 81757773, 43393063, 44420820, 37732541, 40978672,   949470,
        29363067, 64221379, 79626982])
-------Step 4-------
tensor([   32732, 24475468,   142048,  2034464,  2034482,  2034501,   851400,
         2034520,  2034536,  2034556]) tensor([57661148, 31661680, 17529750, 35305646, 13869377, 10966556, 73537238,
        75479682, 22864205, 69857818])
-------Step 5-------
tensor([   32732, 24475468,   142048,  2034464,  2034482,  2034501,   851400,
         2034520,  2034536,  2034556]) tensor([63389189, 56236980, 74908159, 36912631, 38425889,   568241, 26452774,
        47453587, 67553773, 71238774])
-------Step 6-------
tensor([2075311, 2075331,  356757, 2075349, 2075369, 2075381, 2075404, 2075414,
        2075432, 2075450]) tensor([13894847, 19393565, 49889351,  5647660, 81904014, 16958918, 48005314,
        40775182, 76936865, 42731943])
-------Step 7-------
tensor([2075311, 2075331,  356757, 2075349, 2075369, 2075381, 2075404, 2075414,
        2075432, 2075450]) tensor([80649221,  7926761, 44269860, 80315207,  2077732, 42708292, 11407586,
        56119880, 66847703, 62362625])
-------Step 8-------
tensor([2114737, 2114756, 2114769, 2114780,  873868,  873911, 2114797, 2114811,
        2114826, 2114841]) tensor([60409599, 84445412,  1623434, 46983942, 14430448,  7001728, 62126077,
        74866764,  6189897, 44222736])
-------Step 9-------
tensor([2114737, 2114756, 2114769, 2114780,  873868,  873911, 2114797, 2114811,
        2114826, 2114841]) tensor([23170029, 18721223, 43668496,  9861527,  9757796, 21819287, 37249106,
        35394159, 23317155, 78034375])
before start barrier
start train
[proc 0] 100 steps, total: 13.313, sample: 1.096, forward: 3.702, backward: 7.441, update: 0.999
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 16.089, sample: 1.820, forward: 3.439, backward: 6.266, update: 0.206
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.686 ms                  | 70.374 ms                 |
| bucket keys               | 997.552 us                | 2.489 ms                  |
| forward: a2a keys         | 726.409 us                | 134.991 ms                |
| forward: search cache     | 141.639 us                | 308.866 us                |
| forward: a2a values       | 3.242 ms                  | 17.995 ms                 |
| forward: join             | 1.133 ms                  | 2.828 ms                  |
| Forward                   | 17.845 ms                 | 153.593 ms                |
| back: aggr dram keys      | 27.215 ms                 | 61.985 ms                 |
| back: set dram grad       | 1.582 ms                  | 2.179 ms                  |
| back: a2a grad            | 3.343 ms                  | 5.466 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 18.373 ms                 |
| Backward                  | 71.352 ms                 | 99.769 ms                 |
| Optimize                  | 10.054 ms                 | 15.459 ms                 |
| BarrierTimeBeforeRank0    | 51.530 us                 | 80.613 us                 |
| BlockToStepN              | 14.926 us                 | 67.711 us                 |
| OneStep                   | 106.583 ms                | 305.726 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.810 ms                  | 85.084 ms                 |
| bucket keys               | 1.004 ms                  | 2.466 ms                  |
| forward: a2a keys         | 710.629 us                | 124.639 ms                |
| forward: search cache     | 140.249 us                | 304.609 us                |
| forward: a2a values       | 3.242 ms                  | 6.599 ms                  |
| forward: join             | 1.133 ms                  | 2.705 ms                  |
| Forward                   | 17.730 ms                 | 149.497 ms                |
| back: aggr dram keys      | 26.216 ms                 | 58.145 ms                 |
| back: set dram grad       | 1.692 ms                  | 2.378 ms                  |
| back: a2a grad            | 3.343 ms                  | 4.516 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 10.857 ms                 |
| Backward                  | 70.867 ms                 | 97.973 ms                 |
| Optimize                  | 10.061 ms                 | 13.924 ms                 |
| BarrierTimeBeforeRank0    | 51.745 us                 | 95.602 us                 |
| BlockToStepN              | 14.965 us                 | 33.358 us                 |
| OneStep                   | 106.403 ms                | 298.146 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 11.859, sample: 1.730, forward: 2.559, backward: 5.786, update: 0.205
[proc 0] 200 steps, total: 11.859, sample: 1.631, forward: 2.245, backward: 6.904, update: 1.002
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.820 ms                  | 85.084 ms                 |
| bucket keys               | 1.003 ms                  | 2.361 ms                  |
| forward: a2a keys         | 707.388 us                | 123.030 ms                |
| forward: search cache     | 140.086 us                | 290.650 us                |
| forward: a2a values       | 3.242 ms                  | 4.965 ms                  |
| forward: join             | 1.133 ms                  | 2.663 ms                  |
| Forward                   | 17.630 ms                 | 149.497 ms                |
| back: aggr dram keys      | 25.561 ms                 | 52.508 ms                 |
| back: set dram grad       | 1.733 ms                  | 2.459 ms                  |
| back: a2a grad            | 3.355 ms                  | 4.516 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 10.794 ms                 |
| Backward                  | 69.950 ms                 | 97.973 ms                 |
| Optimize                  | 10.063 ms                 | 15.459 ms                 |
| BarrierTimeBeforeRank0    | 51.039 us                 | 95.602 us                 |
| BlockToStepN              | 14.951 us                 | 33.358 us                 |
| OneStep                   | 104.774 ms                | 298.146 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.810 ms                  | 78.307 ms                 |
| bucket keys               | 1.004 ms                  | 2.412 ms                  |
| forward: a2a keys         | 710.629 us                | 122.972 ms                |
| forward: search cache     | 140.553 us                | 290.650 us                |
| forward: a2a values       | 3.242 ms                  | 4.242 ms                  |
| forward: join             | 1.133 ms                  | 2.463 ms                  |
| Forward                   | 17.582 ms                 | 139.391 ms                |
| back: aggr dram keys      | 25.771 ms                 | 47.740 ms                 |
| back: set dram grad       | 1.741 ms                  | 2.487 ms                  |
| back: a2a grad            | 3.382 ms                  | 4.516 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 10.794 ms                 |
| Backward                  | 69.527 ms                 | 96.947 ms                 |
| Optimize                  | 10.060 ms                 | 15.459 ms                 |
| BarrierTimeBeforeRank0    | 50.520 us                 | 85.031 us                 |
| BlockToStepN              | 14.953 us                 | 33.358 us                 |
| OneStep                   | 104.203 ms                | 292.268 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 11.230, sample: 1.277, forward: 2.497, backward: 5.647, update: 0.183
[proc 0] 300 steps, total: 11.230, sample: 1.385, forward: 2.050, backward: 6.694, update: 1.027
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.944 ms                  | 85.445 ms                 |
| bucket keys               | 1.004 ms                  | 2.410 ms                  |
| forward: a2a keys         | 708.327 us                | 110.927 ms                |
| forward: search cache     | 140.019 us                | 290.427 us                |
| forward: a2a values       | 3.242 ms                  | 4.242 ms                  |
| forward: join             | 1.133 ms                  | 2.453 ms                  |
| Forward                   | 17.537 ms                 | 139.391 ms                |
| back: aggr dram keys      | 25.561 ms                 | 49.471 ms                 |
| back: set dram grad       | 1.741 ms                  | 2.459 ms                  |
| back: a2a grad            | 3.382 ms                  | 4.448 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 10.794 ms                 |
| Backward                  | 68.964 ms                 | 96.947 ms                 |
| Optimize                  | 10.060 ms                 | 15.459 ms                 |
| BarrierTimeBeforeRank0    | 50.232 us                 | 97.834 us                 |
| BlockToStepN              | 14.951 us                 | 33.358 us                 |
| OneStep                   | 104.030 ms                | 292.268 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.977 ms                  | 95.563 ms                 |
| bucket keys               | 1.004 ms                  | 2.361 ms                  |
| forward: a2a keys         | 708.327 us                | 103.252 ms                |
| forward: search cache     | 139.904 us                | 290.427 us                |
| forward: a2a values       | 3.251 ms                  | 4.024 ms                  |
| forward: join             | 1.133 ms                  | 2.334 ms                  |
| Forward                   | 17.514 ms                 | 139.391 ms                |
| back: aggr dram keys      | 25.471 ms                 | 47.740 ms                 |
| back: set dram grad       | 1.737 ms                  | 2.443 ms                  |
| back: a2a grad            | 3.382 ms                  | 4.366 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 10.623 ms                 |
| Backward                  | 68.374 ms                 | 96.947 ms                 |
| Optimize                  | 10.062 ms                 | 15.459 ms                 |
| BarrierTimeBeforeRank0    | 50.033 us                 | 97.834 us                 |
| BlockToStepN              | 14.953 us                 | 94.776 us                 |
| OneStep                   | 103.831 ms                | 292.268 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.047 ms                  | 95.263 ms                 |
| bucket keys               | 997.768 us                | 2.412 ms                  |
| forward: a2a keys         | 701.425 us                | 86.392 ms                 |
| forward: search cache     | 139.638 us                | 288.621 us                |
| forward: a2a values       | 3.251 ms                  | 4.024 ms                  |
| forward: join             | 1.133 ms                  | 2.334 ms                  |
| Forward                   | 17.485 ms                 | 137.454 ms                |
| back: aggr dram keys      | 24.754 ms                 | 46.976 ms                 |
| back: set dram grad       | 1.733 ms                  | 2.421 ms                  |
| back: a2a grad            | 3.382 ms                  | 4.280 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 9.967 ms                  |
| Backward                  | 68.220 ms                 | 95.764 ms                 |
| Optimize                  | 10.060 ms                 | 15.459 ms                 |
| BarrierTimeBeforeRank0    | 49.981 us                 | 95.602 us                 |
| BlockToStepN              | 14.953 us                 | 67.711 us                 |
| OneStep                   | 103.715 ms                | 289.261 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 10.903, sample: 1.355, forward: 1.873, backward: 6.590, update: 1.012
[proc 1] 400 steps, total: 10.903, sample: 1.358, forward: 2.176, backward: 5.601, update: 0.190
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.123 ms                  | 101.353 ms                |
| bucket keys               | 997.768 us                | 2.410 ms                  |
| forward: a2a keys         | 699.023 us                | 79.897 ms                 |
| forward: search cache     | 139.470 us                | 287.861 us                |
| forward: a2a values       | 3.251 ms                  | 4.068 ms                  |
| forward: join             | 1.133 ms                  | 2.453 ms                  |
| Forward                   | 17.441 ms                 | 137.454 ms                |
| back: aggr dram keys      | 24.754 ms                 | 45.297 ms                 |
| back: set dram grad       | 1.728 ms                  | 2.424 ms                  |
| back: a2a grad            | 3.382 ms                  | 4.277 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 9.902 ms                  |
| Backward                  | 67.964 ms                 | 95.764 ms                 |
| Optimize                  | 10.063 ms                 | 15.459 ms                 |
| BarrierTimeBeforeRank0    | 49.861 us                 | 97.834 us                 |
| BlockToStepN              | 14.956 us                 | 67.711 us                 |
| OneStep                   | 103.399 ms                | 289.261 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.319 ms                  | 103.689 ms                |
| bucket keys               | 1.003 ms                  | 2.410 ms                  |
| forward: a2a keys         | 698.864 us                | 79.388 ms                 |
| forward: search cache     | 139.466 us                | 287.291 us                |
| forward: a2a values       | 3.289 ms                  | 4.024 ms                  |
| forward: join             | 1.133 ms                  | 2.334 ms                  |
| Forward                   | 17.422 ms                 | 137.216 ms                |
| back: aggr dram keys      | 25.264 ms                 | 44.324 ms                 |
| back: set dram grad       | 1.728 ms                  | 2.424 ms                  |
| back: a2a grad            | 3.382 ms                  | 4.207 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 9.409 ms                  |
| Backward                  | 68.140 ms                 | 90.732 ms                 |
| Optimize                  | 10.063 ms                 | 14.535 ms                 |
| BarrierTimeBeforeRank0    | 49.851 us                 | 97.834 us                 |
| BlockToStepN              | 14.973 us                 | 67.711 us                 |
| OneStep                   | 103.565 ms                | 284.161 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 11.167, sample: 1.113, forward: 2.535, backward: 5.758, update: 0.188
[proc 0] 500 steps, total: 11.167, sample: 1.613, forward: 1.749, backward: 6.724, update: 0.993
Successfully xmh. training takes 58.47190308570862 seconds
before call kg_cache_controller.StopThreads()
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
INFO [16154 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.319 ms                  | 109.934 ms                |
| bucket keys               | 1.001 ms                  | 2.410 ms                  |
| forward: a2a keys         | 698.774 us                | 79.388 ms                 |
| forward: search cache     | 139.466 us                | 287.291 us                |
| forward: a2a values       | 3.285 ms                  | 4.068 ms                  |
| forward: join             | 1.133 ms                  | 2.453 ms                  |
| Forward                   | 17.422 ms                 | 137.216 ms                |
| back: aggr dram keys      | 25.471 ms                 | 44.324 ms                 |
| back: set dram grad       | 1.727 ms                  | 2.424 ms                  |
| back: a2a grad            | 3.390 ms                  | 4.277 ms                  |
| back: grad sum & grad cache  | 6.921 ms                  | 9.902 ms                  |
| Backward                  | 67.997 ms                 | 95.764 ms                 |
| Optimize                  | 10.062 ms                 | 14.535 ms                 |
| BarrierTimeBeforeRank0    | 49.819 us                 | 97.834 us                 |
| BlockToStepN              | 14.992 us                 | 67.711 us                 |
| OneStep                   | 103.363 ms                | 284.161 ms                |
+---------------------------+---------------------------+---------------------------+

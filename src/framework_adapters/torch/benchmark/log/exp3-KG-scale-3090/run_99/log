WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240124 01:24:26.531356 24058 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_46', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [24058 sampler.py:454] Start PreSampling
WARNING [24058 sampler.py:532] Before construct renumbering_dict
WARNING [24058 sampler.py:555] PreSampling done
W20240124 01:37:14.236009 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240124 01:37:14.236202 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240124 01:37:14.236233 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240124 01:37:14.236258 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240124 01:37:14.236286 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240124 01:37:14.236312 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240124 01:37:14.236346 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240124 01:37:14.236377 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240124 01:37:14.236413 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240124 01:37:14.236442 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240124 01:37:14.236477 24058 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240124 01:37:14.236503 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240124 01:37:14.236524 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240124 01:37:14.236647 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240124 01:37:14.236673 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240124 01:37:14.236694 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240124 01:37:14.236739 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240124 01:37:14.236760 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240124 01:37:14.236788 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240124 01:37:14.236827 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240124 01:37:14.236847 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240124 01:37:14.236876 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240124 01:37:14.236905 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240124 01:37:14.236927 24058 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240124 01:37:14.236944 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240124 01:37:14.236963 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240124 01:37:14.237013 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240124 01:37:14.237043 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240124 01:37:14.237063 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240124 01:37:14.237083 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240124 01:37:14.237115 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240124 01:37:14.237135 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240124 01:37:14.237161 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240124 01:37:14.237190 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240124 01:37:14.237210 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240124 01:37:14.237238 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240124 01:37:14.237262 24058 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240124 01:37:14.237279 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240124 01:37:14.237296 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240124 01:37:14.237352 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240124 01:37:14.237377 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240124 01:37:14.237406 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240124 01:37:14.237426 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240124 01:37:14.237448 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240124 01:37:14.237469 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240124 01:37:14.237491 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240124 01:37:14.237517 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240124 01:37:14.237540 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240124 01:37:14.237571 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240124 01:37:14.237591 24058 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240124 01:37:14.237608 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240124 01:37:14.237627 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240124 01:37:14.237676 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000 781.2 kB
W20240124 01:37:14.237711 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000 781.2 kB
W20240124 01:37:14.237738 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000 781.2 kB
W20240124 01:37:14.237759 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000 781.2 kB
W20240124 01:37:14.237780 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000 781.2 kB
W20240124 01:37:14.237803 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000 781.2 kB
W20240124 01:37:14.237828 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000 781.2 kB
W20240124 01:37:14.237854 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000 781.2 kB
W20240124 01:37:14.237874 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000 781.2 kB
W20240124 01:37:14.237897 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000 781.2 kB
W20240124 01:37:14.237918 24058 IPCTensor.h:365] NewIPCTensor: step_r4 [10]0x100002694000 80 B 
W20240124 01:37:14.237938 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000 8 B 
W20240124 01:37:14.237955 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000 8 B 
W20240124 01:37:14.238005 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000 781.2 kB
W20240124 01:37:14.238034 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000 781.2 kB
W20240124 01:37:14.238056 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000 781.2 kB
W20240124 01:37:14.238080 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000 781.2 kB
W20240124 01:37:14.238101 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000 781.2 kB
W20240124 01:37:14.238126 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000 781.2 kB
W20240124 01:37:14.238158 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000 781.2 kB
W20240124 01:37:14.238179 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000 781.2 kB
W20240124 01:37:14.238206 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000 781.2 kB
W20240124 01:37:14.238237 24058 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000 781.2 kB
W20240124 01:37:14.238263 24058 IPCTensor.h:365] NewIPCTensor: step_r5 [10]0x100002e4c000 80 B 
W20240124 01:37:14.238281 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000 8 B 
W20240124 01:37:14.238305 24058 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000 8 B 
W20240124 01:37:14.577234 24058 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100002e52000 128.2 GB
W20240124 01:37:14.577409 24058 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102011a8a000 328.3 MB
{0: Graph(num_nodes=16364881, num_edges=60475646,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22851247, num_edges=75085053,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16469571, num_edges=67497598,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17544490, num_edges=53244935,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=18090773, num_edges=55134734,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=20615225, num_edges=67664913,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16364881 N 60475646 E
MertisPartition: part 1 has 22851247 N 75085053 E
MertisPartition: part 2 has 16469571 N 67497598 E
MertisPartition: part 3 has 17544490 N 53244935 E
MertisPartition: part 4 has 18090773 N 55134734 E
MertisPartition: part 5 has 20615225 N 67664913 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,        6,  ..., 37713888,  7166588, 11887902]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
After renumbering graph:  {'_ID': tensor([ 4302830,  4302847,  4302869,  ...,  6885677, 61487954, 41875029]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 943.948 seconds
[Rank1] pid = 48053
[Rank2] pid = 48154
[Rank3] pid = 48293
[Rank4] pid = 48462
INFO [24058 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [48053 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [48154 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [48462 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [48293 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [48576 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [48462 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [48293 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [48576 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [48154 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [48053 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [24058 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
WARNING [48576 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [48462 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [48154 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [48053 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [24058 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [48293 DistTensor.py:56] The tensor name already exists in the kvstore
I20240124 01:40:23.861644 48294 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240124 01:40:23.861938 48463 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 01:40:23.862164 48640 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 01:40:23.862370 48577 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 01:40:23.862507 48155 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 01:40:23.862622 48054 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 01:40:32.351222 48463 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240124 01:40:32.559041 48294 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 01:40:33.175873 48577 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 01:40:34.835587 48640 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 01:40:35.050607 48155 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 01:40:35.256448 48054 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.818 ms                  | 15.990 ms                 |
| bucket keys               | 1.184 ms                  | 182.008 ms                |
| forward: a2a keys         | 3.157 ms                  | 1.086 s                   |
| forward: search cache     | 232.425 us                | 19.695 ms                 |
| forward: a2a values       | 8.853 ms                  | 30.412 ms                 |
| forward: join             | 1.273 ms                  | 1.882 ms                  |
| Forward                   | 32.714 ms                 | 1.731 s                   |
| back: aggr dram keys      | 33.217 ms                 | 774.001 ms                |
| back: set dram grad       | 3.021 ms                  | 6.439 ms                  |
| back: a2a grad            | 10.716 ms                 | 21.745 ms                 |
| back: grad sum & grad cache  | 3.264 ms                  | 64.487 ms                 |
| Backward                  | 129.161 ms                | 1.072 s                   |
| Optimize                  | 15.312 ms                 | 15.399 ms                 |
| BarrierTimeBeforeRank0    | 73.209 us                 | 77.105 us                 |
| BlockToStepN              | 72.241 us                 | 180.864 us                |
| OneStep                   | 189.296 ms                | 2.836 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.404 ms                  | 59.117 ms                 |
| bucket keys               | 1.247 ms                  | 2.310 ms                  |
| forward: a2a keys         | 2.032 ms                  | 7.016 ms                  |
| forward: search cache     | 242.619 us                | 465.420 us                |
| forward: a2a values       | 2.701 ms                  | 12.428 ms                 |
| forward: join             | 1.273 ms                  | 1.841 ms                  |
| Forward                   | 27.563 ms                 | 1.731 s                   |
| back: aggr dram keys      | 33.217 ms                 | 53.173 ms                 |
| back: set dram grad       | 2.972 ms                  | 4.129 ms                  |
| back: a2a grad            | 10.716 ms                 | 13.513 ms                 |
| back: grad sum & grad cache  | 3.264 ms                  | 39.117 ms                 |
| Backward                  | 115.815 ms                | 1.072 s                   |
| Optimize                  | 15.149 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 57.741 us                 | 82.697 us                 |
| BlockToStepN              | 19.501 us                 | 180.864 us                |
| OneStep                   | 169.227 ms                | 2.836 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.306 ms                  | 51.101 ms                 |
| bucket keys               | 1.205 ms                  | 2.310 ms                  |
| forward: a2a keys         | 1.947 ms                  | 15.648 ms                 |
| forward: search cache     | 233.606 us                | 465.420 us                |
| forward: a2a values       | 8.526 ms                  | 21.099 ms                 |
| forward: join             | 1.273 ms                  | 1.882 ms                  |
| Forward                   | 27.850 ms                 | 50.163 ms                 |
| back: aggr dram keys      | 37.519 ms                 | 61.767 ms                 |
| back: set dram grad       | 2.915 ms                  | 4.129 ms                  |
| back: a2a grad            | 10.877 ms                 | 26.279 ms                 |
| back: grad sum & grad cache  | 3.264 ms                  | 49.936 ms                 |
| Backward                  | 117.170 ms                | 164.216 ms                |
| Optimize                  | 15.063 ms                 | 23.215 ms                 |
| BarrierTimeBeforeRank0    | 55.794 us                 | 82.697 us                 |
| BlockToStepN              | 19.772 us                 | 10.417 ms                 |
| OneStep                   | 170.777 ms                | 220.050 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.303 ms                  | 57.763 ms                 |
| bucket keys               | 1.473 ms                  | 2.633 ms                  |
| forward: a2a keys         | 1.973 ms                  | 15.579 ms                 |
| forward: search cache     | 268.245 us                | 465.420 us                |
| forward: a2a values       | 8.526 ms                  | 21.099 ms                 |
| forward: join             | 1.548 ms                  | 2.369 ms                  |
| Forward                   | 28.613 ms                 | 65.698 ms                 |
| back: aggr dram keys      | 37.519 ms                 | 61.864 ms                 |
| back: set dram grad       | 2.915 ms                  | 4.129 ms                  |
| back: a2a grad            | 10.980 ms                 | 24.989 ms                 |
| back: grad sum & grad cache  | 3.264 ms                  | 45.907 ms                 |
| Backward                  | 117.411 ms                | 164.216 ms                |
| Optimize                  | 14.996 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 54.513 us                 | 86.870 us                 |
| BlockToStepN              | 22.734 us                 | 10.417 ms                 |
| OneStep                   | 173.846 ms                | 224.017 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 20.811, sample: 0.581, forward: 5.585, backward: 10.029, update: 0.214
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 23.303, sample: 0.651, forward: 5.455, backward: 10.072, update: 0.190
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 20.606, sample: 0.608, forward: 5.535, backward: 10.362, update: 0.210
[Rank5] pid = 48576
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242)]
train_sampler.Prefill()
-------Step 0-------
tensor([  66439,  587209, 4334491,   66476,   66519,   66567,   42137,   66592,
          66625,   66664]) tensor([ 4612326, 44120679, 43978624,  4615483, 71171781, 20002292, 45138981,
        17437344, 72792333,  5998456])
-------Step 1-------
tensor([  66439,  587209, 4334491,   66476,   66519,   66567,   42137,   66592,
          66625,   66664]) tensor([64754058, 67894735, 45944389, 69966448,  4409743, 68229913, 35273199,
        63506050, 30534092, 80705785])
-------Step 2-------
tensor([  117145,   117176,  5258048,   350291,   350315,   117205,   117229,
        68333069,   350332, 78094165]) tensor([81460500, 21533384, 19013763, 55882033, 30374196, 77982755, 78362826,
        21470974, 70306498, 45502422])
-------Step 3-------
tensor([  117145,   117176,  5258048,   350291,   350315,   117205,   117229,
        68333069,   350332, 78094165]) tensor([42719033,  2750651, 15439912, 13947610, 51404026, 49475955, 65218518,
        45050923, 75389408, 47440236])
-------Step 4-------
tensor([  173031,   173072,   173108,  5155354,   173144, 16759051,   173180,
          173211,  4452909,   173253]) tensor([47783780, 22321567, 35547112, 67137166, 72132655,   122232, 10852748,
        23981211, 40997798, 11877559])
-------Step 5-------
tensor([  173031,   173072,   173108,  5155354,   173144, 16759051,   173180,
          173211,  4452909,   173253]) tensor([ 9302313, 81156055, 21770447,  1872010, 18743165, 25116941, 23136529,
         7764731, 76753583, 67505539])
-------Step 6-------
tensor([  226128,   605030,   226161,   226191,   605060,   226225, 16759051,
          226257,   226297,   226329]) tensor([36292254, 11953403, 53255579, 33269784, 36954811, 41163112, 12135054,
        83550278, 53018205, 45808705])
-------Step 7-------
tensor([  226128,   605030,   226161,   226191,   605060,   226225, 16759051,
          226257,   226297,   226329]) tensor([ 7555837,   677164, 72327976, 39271926,  4607705, 28507573, 13275985,
        71207090, 15584458, 72835275])
-------Step 8-------
tensor([  277712,      454,   277761,   277784,   277830,   358417, 16759051,
          277866, 13121416,   277897]) tensor([68179608, 12459765, 16241310, 38466726,  7739685,  3359836, 45125284,
        10715984, 28535013, 33234118])
-------Step 9-------
tensor([  277712,      454,   277761,   277784,   277830,   358417, 16759051,
          277866, 13121416,   277897]) tensor([74168260, 48627277, 34452751, 56504096, 46239446, 37426432, 31582796,
        16004203, 12236600, 63582922])
before start barrier
start train
[proc 0] 100 steps, total: 22.686, sample: 1.041, forward: 4.780, backward: 13.164, update: 1.496
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 23.511, sample: 0.629, forward: 5.507, backward: 9.895, update: 0.209
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 21.026, sample: 0.640, forward: 5.561, backward: 10.016, update: 0.234
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.303 ms                  | 57.763 ms                 |
| bucket keys               | 1.505 ms                  | 2.816 ms                  |
| forward: a2a keys         | 1.969 ms                  | 16.937 ms                 |
| forward: search cache     | 295.496 us                | 569.332 us                |
| forward: a2a values       | 8.526 ms                  | 21.099 ms                 |
| forward: join             | 1.561 ms                  | 2.793 ms                  |
| Forward                   | 28.889 ms                 | 65.698 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 63.589 ms                 |
| back: set dram grad       | 2.926 ms                  | 4.129 ms                  |
| back: a2a grad            | 11.028 ms                 | 24.989 ms                 |
| back: grad sum & grad cache  | 3.264 ms                  | 45.907 ms                 |
| Backward                  | 117.498 ms                | 164.216 ms                |
| Optimize                  | 15.157 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 56.713 us                 | 92.777 us                 |
| BlockToStepN              | 22.970 us                 | 10.417 ms                 |
| OneStep                   | 173.703 ms                | 231.775 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.734 ms                  | 59.117 ms                 |
| bucket keys               | 1.495 ms                  | 2.885 ms                  |
| forward: a2a keys         | 1.903 ms                  | 15.648 ms                 |
| forward: search cache     | 303.534 us                | 550.038 us                |
| forward: a2a values       | 8.334 ms                  | 12.428 ms                 |
| forward: join             | 1.561 ms                  | 2.793 ms                  |
| Forward                   | 28.644 ms                 | 65.698 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 61.864 ms                 |
| back: set dram grad       | 2.931 ms                  | 3.648 ms                  |
| back: a2a grad            | 10.877 ms                 | 24.989 ms                 |
| back: grad sum & grad cache  | 3.264 ms                  | 49.303 ms                 |
| Backward                  | 117.254 ms                | 164.216 ms                |
| Optimize                  | 15.223 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 54.513 us                 | 92.777 us                 |
| BlockToStepN              | 21.064 us                 | 10.417 ms                 |
| OneStep                   | 171.556 ms                | 231.775 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.058 ms                  | 57.763 ms                 |
| bucket keys               | 1.435 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.833 ms                  | 15.579 ms                 |
| forward: search cache     | 303.256 us                | 548.171 us                |
| forward: a2a values       | 8.296 ms                  | 12.428 ms                 |
| forward: join             | 1.561 ms                  | 2.369 ms                  |
| Forward                   | 28.398 ms                 | 58.962 ms                 |
| back: aggr dram keys      | 38.090 ms                 | 61.864 ms                 |
| back: set dram grad       | 2.939 ms                  | 4.129 ms                  |
| back: a2a grad            | 10.882 ms                 | 26.279 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 49.303 ms                 |
| Backward                  | 117.740 ms                | 156.616 ms                |
| Optimize                  | 15.127 ms                 | 23.885 ms                 |
| BarrierTimeBeforeRank0    | 52.556 us                 | 86.870 us                 |
| BlockToStepN              | 21.064 us                 | 9.164 ms                  |
| OneStep                   | 171.507 ms                | 228.264 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 200 steps, total: 17.486, sample: 0.622, forward: 3.512, backward: 9.031, update: 0.238
[proc 3] 200 steps, total: 17.486, sample: 0.585, forward: 3.554, backward: 8.974, update: 0.238
[proc 4] 200 steps, total: 17.486, sample: 0.570, forward: 3.578, backward: 8.876, update: 0.222
[proc 5] 200 steps, total: 17.486, sample: 0.587, forward: 3.561, backward: 9.015, update: 0.240
[proc 1] 200 steps, total: 17.486, sample: 0.623, forward: 3.539, backward: 9.252, update: 0.217
[proc 0] 200 steps, total: 17.486, sample: 0.837, forward: 3.082, backward: 12.070, update: 1.365
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.507 ms                  | 57.763 ms                 |
| bucket keys               | 1.492 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.796 ms                  | 20.330 ms                 |
| forward: search cache     | 312.397 us                | 548.171 us                |
| forward: a2a values       | 8.296 ms                  | 18.237 ms                 |
| forward: join             | 1.561 ms                  | 2.374 ms                  |
| Forward                   | 28.394 ms                 | 76.386 ms                 |
| back: aggr dram keys      | 38.090 ms                 | 61.767 ms                 |
| back: set dram grad       | 2.937 ms                  | 4.125 ms                  |
| back: a2a grad            | 10.900 ms                 | 24.989 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 45.907 ms                 |
| Backward                  | 117.966 ms                | 156.616 ms                |
| Optimize                  | 15.036 ms                 | 23.885 ms                 |
| BarrierTimeBeforeRank0    | 52.337 us                 | 86.870 us                 |
| BlockToStepN              | 21.372 us                 | 11.864 ms                 |
| OneStep                   | 170.777 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.778 ms                  | 57.763 ms                 |
| bucket keys               | 1.505 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.815 ms                  | 16.937 ms                 |
| forward: search cache     | 323.224 us                | 555.804 us                |
| forward: a2a values       | 8.296 ms                  | 18.237 ms                 |
| forward: join             | 1.561 ms                  | 2.369 ms                  |
| Forward                   | 28.769 ms                 | 76.386 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 61.203 ms                 |
| back: set dram grad       | 2.915 ms                  | 3.999 ms                  |
| back: a2a grad            | 10.900 ms                 | 26.279 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 44.951 ms                 |
| Backward                  | 118.190 ms                | 163.825 ms                |
| Optimize                  | 15.055 ms                 | 23.885 ms                 |
| BarrierTimeBeforeRank0    | 52.513 us                 | 86.870 us                 |
| BlockToStepN              | 21.794 us                 | 11.864 ms                 |
| OneStep                   | 171.337 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.142 ms                  | 53.387 ms                 |
| bucket keys               | 1.513 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.848 ms                  | 20.330 ms                 |
| forward: search cache     | 324.313 us                | 555.804 us                |
| forward: a2a values       | 8.288 ms                  | 18.237 ms                 |
| forward: join             | 1.561 ms                  | 2.369 ms                  |
| Forward                   | 28.954 ms                 | 66.675 ms                 |
| back: aggr dram keys      | 38.837 ms                 | 61.203 ms                 |
| back: set dram grad       | 2.915 ms                  | 3.999 ms                  |
| back: a2a grad            | 10.877 ms                 | 26.743 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 45.907 ms                 |
| Backward                  | 117.578 ms                | 156.616 ms                |
| Optimize                  | 15.095 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 52.337 us                 | 86.823 us                 |
| BlockToStepN              | 21.875 us                 | 11.777 ms                 |
| OneStep                   | 171.062 ms                | 246.612 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.120 ms                  | 53.387 ms                 |
| bucket keys               | 1.509 ms                  | 2.816 ms                  |
| forward: a2a keys         | 1.833 ms                  | 20.168 ms                 |
| forward: search cache     | 324.796 us                | 550.038 us                |
| forward: a2a values       | 8.288 ms                  | 18.046 ms                 |
| forward: join             | 1.561 ms                  | 2.327 ms                  |
| Forward                   | 28.935 ms                 | 66.675 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 60.699 ms                 |
| back: set dram grad       | 2.915 ms                  | 3.999 ms                  |
| back: a2a grad            | 10.869 ms                 | 26.743 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 45.907 ms                 |
| Backward                  | 116.766 ms                | 156.616 ms                |
| Optimize                  | 15.132 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 52.612 us                 | 86.823 us                 |
| BlockToStepN              | 22.961 us                 | 11.777 ms                 |
| OneStep                   | 170.119 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 17.274, sample: 0.534, forward: 3.571, backward: 9.070, update: 0.216
[proc 4] 300 steps, total: 17.274, sample: 0.498, forward: 3.609, backward: 8.613, update: 0.219
[proc 2] 300 steps, total: 17.274, sample: 0.644, forward: 3.477, backward: 8.767, update: 0.250
[proc 3] 300 steps, total: 17.274, sample: 0.536, forward: 3.567, backward: 8.733, update: 0.220
[proc 5] 300 steps, total: 17.274, sample: 0.703, forward: 3.410, backward: 8.769, update: 0.237
[proc 0] 300 steps, total: 17.274, sample: 0.791, forward: 3.128, backward: 11.690, update: 1.525
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.066 ms                  | 53.387 ms                 |
| bucket keys               | 1.509 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.827 ms                  | 20.168 ms                 |
| forward: search cache     | 324.660 us                | 555.804 us                |
| forward: a2a values       | 8.288 ms                  | 18.237 ms                 |
| forward: join             | 1.561 ms                  | 2.327 ms                  |
| Forward                   | 28.821 ms                 | 66.675 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 60.699 ms                 |
| back: set dram grad       | 2.911 ms                  | 4.125 ms                  |
| back: a2a grad            | 10.854 ms                 | 26.743 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 45.907 ms                 |
| Backward                  | 116.325 ms                | 156.616 ms                |
| Optimize                  | 15.127 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 52.981 us                 | 86.870 us                 |
| BlockToStepN              | 23.529 us                 | 11.777 ms                 |
| OneStep                   | 169.329 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.848 ms                  | 53.387 ms                 |
| bucket keys               | 1.505 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.827 ms                  | 18.088 ms                 |
| forward: search cache     | 324.515 us                | 550.038 us                |
| forward: a2a values       | 8.288 ms                  | 18.046 ms                 |
| forward: join             | 1.561 ms                  | 2.277 ms                  |
| Forward                   | 28.774 ms                 | 66.675 ms                 |
| back: aggr dram keys      | 38.495 ms                 | 60.699 ms                 |
| back: set dram grad       | 2.911 ms                  | 4.125 ms                  |
| back: a2a grad            | 10.849 ms                 | 26.743 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 44.951 ms                 |
| Backward                  | 116.445 ms                | 156.616 ms                |
| Optimize                  | 15.144 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 52.988 us                 | 86.870 us                 |
| BlockToStepN              | 25.570 us                 | 11.777 ms                 |
| OneStep                   | 169.460 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.672 ms                  | 52.234 ms                 |
| bucket keys               | 1.505 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.820 ms                  | 18.088 ms                 |
| forward: search cache     | 324.796 us                | 555.804 us                |
| forward: a2a values       | 8.288 ms                  | 14.193 ms                 |
| forward: join             | 1.569 ms                  | 2.277 ms                  |
| Forward                   | 28.774 ms                 | 66.675 ms                 |
| back: aggr dram keys      | 38.495 ms                 | 60.699 ms                 |
| back: set dram grad       | 2.911 ms                  | 5.320 ms                  |
| back: a2a grad            | 10.849 ms                 | 27.943 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 45.907 ms                 |
| Backward                  | 116.509 ms                | 156.616 ms                |
| Optimize                  | 15.165 ms                 | 24.029 ms                 |
| BarrierTimeBeforeRank0    | 53.052 us                 | 86.823 us                 |
| BlockToStepN              | 35.222 us                 | 11.864 ms                 |
| OneStep                   | 169.971 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 17.504, sample: 0.415, forward: 3.544, backward: 9.074, update: 0.241
[proc 5] 400 steps, total: 17.504, sample: 0.530, forward: 3.442, backward: 9.153, update: 0.228
[proc 2] 400 steps, total: 17.504, sample: 0.517, forward: 3.457, backward: 9.092, update: 0.231
[proc 0] 400 steps, total: 17.504, sample: 0.737, forward: 3.024, backward: 12.089, update: 1.504
[proc 1] 400 steps, total: 17.504, sample: 0.493, forward: 3.520, backward: 9.436, update: 0.209
[proc 4] 400 steps, total: 17.504, sample: 0.493, forward: 3.481, backward: 8.980, update: 0.229
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.736 ms                  | 52.234 ms                 |
| bucket keys               | 1.513 ms                  | 2.885 ms                  |
| forward: a2a keys         | 1.833 ms                  | 20.168 ms                 |
| forward: search cache     | 324.504 us                | 555.804 us                |
| forward: a2a values       | 8.187 ms                  | 14.193 ms                 |
| forward: join             | 1.574 ms                  | 2.369 ms                  |
| Forward                   | 28.776 ms                 | 66.675 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 60.699 ms                 |
| back: set dram grad       | 2.911 ms                  | 4.543 ms                  |
| back: a2a grad            | 10.849 ms                 | 26.743 ms                 |
| back: grad sum & grad cache  | 5.208 ms                  | 44.951 ms                 |
| Backward                  | 116.123 ms                | 157.244 ms                |
| Optimize                  | 15.158 ms                 | 24.417 ms                 |
| BarrierTimeBeforeRank0    | 52.998 us                 | 86.823 us                 |
| BlockToStepN              | 37.800 us                 | 11.907 ms                 |
| OneStep                   | 169.460 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.670 ms                  | 52.234 ms                 |
| bucket keys               | 1.504 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.827 ms                  | 20.168 ms                 |
| forward: search cache     | 323.666 us                | 550.038 us                |
| forward: a2a values       | 8.030 ms                  | 12.858 ms                 |
| forward: join             | 1.569 ms                  | 2.369 ms                  |
| Forward                   | 28.644 ms                 | 66.675 ms                 |
| back: aggr dram keys      | 38.837 ms                 | 59.699 ms                 |
| back: set dram grad       | 2.911 ms                  | 4.543 ms                  |
| back: a2a grad            | 10.854 ms                 | 26.279 ms                 |
| back: grad sum & grad cache  | 14.506 ms                 | 44.293 ms                 |
| Backward                  | 115.557 ms                | 157.244 ms                |
| Optimize                  | 15.125 ms                 | 24.550 ms                 |
| BarrierTimeBeforeRank0    | 52.988 us                 | 86.823 us                 |
| BlockToStepN              | 33.465 us                 | 11.907 ms                 |
| OneStep                   | 168.811 ms                | 248.677 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.542 ms                  | 51.101 ms                 |
| bucket keys               | 1.494 ms                  | 2.850 ms                  |
| forward: a2a keys         | 1.806 ms                  | 20.168 ms                 |
| forward: search cache     | 322.391 us                | 550.038 us                |
| forward: a2a values       | 8.014 ms                  | 17.534 ms                 |
| forward: join             | 1.569 ms                  | 2.369 ms                  |
| Forward                   | 28.487 ms                 | 65.698 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 60.649 ms                 |
| back: set dram grad       | 2.912 ms                  | 5.320 ms                  |
| back: a2a grad            | 10.856 ms                 | 26.279 ms                 |
| back: grad sum & grad cache  | 14.506 ms                 | 44.951 ms                 |
| Backward                  | 115.219 ms                | 156.616 ms                |
| Optimize                  | 15.066 ms                 | 24.550 ms                 |
| BarrierTimeBeforeRank0    | 52.645 us                 | 86.751 us                 |
| BlockToStepN              | 30.415 us                 | 11.864 ms                 |
| OneStep                   | 168.086 ms                | 246.612 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.479 ms                  | 51.101 ms                 |
| bucket keys               | 1.475 ms                  | 2.816 ms                  |
| forward: a2a keys         | 1.791 ms                  | 20.168 ms                 |
| forward: search cache     | 309.745 us                | 548.171 us                |
| forward: a2a values       | 7.941 ms                  | 17.534 ms                 |
| forward: join             | 1.569 ms                  | 2.369 ms                  |
| Forward                   | 28.394 ms                 | 65.698 ms                 |
| back: aggr dram keys      | 38.751 ms                 | 59.699 ms                 |
| back: set dram grad       | 2.912 ms                  | 4.543 ms                  |
| back: a2a grad            | 10.856 ms                 | 26.279 ms                 |
| back: grad sum & grad cache  | 14.506 ms                 | 44.293 ms                 |
| Backward                  | 115.187 ms                | 156.616 ms                |
| Optimize                  | 15.034 ms                 | 24.550 ms                 |
| BarrierTimeBeforeRank0    | 52.478 us                 | 86.823 us                 |
| BlockToStepN              | 28.291 us                 | 11.907 ms                 |
| OneStep                   | 167.966 ms                | 246.612 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 16.541, sample: 0.495, forward: 3.194, backward: 8.930, update: 0.214
[proc 4] 500 steps, total: 16.541, sample: 0.441, forward: 3.247, backward: 8.473, update: 0.223
[proc 5] 500 steps, total: 16.541, sample: 0.450, forward: 3.224, backward: 8.628, update: 0.168
[proc 2] 500 steps, total: 16.541, sample: 0.473, forward: 3.228, backward: 8.636, update: 0.236
[proc 0] 500 steps, total: 16.541, sample: 0.680, forward: 2.770, backward: 11.570, update: 1.418
[proc 3] 500 steps, total: 16.541, sample: 0.489, forward: 3.196, backward: 8.608, update: 0.224
Successfully xmh. training takes 91.49192810058594 seconds
before call kg_cache_controller.StopThreads()
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
INFO [24058 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.479 ms                  | 51.101 ms                 |
| bucket keys               | 1.479 ms                  | 2.816 ms                  |
| forward: a2a keys         | 1.793 ms                  | 20.168 ms                 |
| forward: search cache     | 309.341 us                | 548.171 us                |
| forward: a2a values       | 8.009 ms                  | 17.534 ms                 |
| forward: join             | 1.569 ms                  | 2.369 ms                  |
| Forward                   | 28.394 ms                 | 65.698 ms                 |
| back: aggr dram keys      | 38.837 ms                 | 59.699 ms                 |
| back: set dram grad       | 2.912 ms                  | 4.543 ms                  |
| back: a2a grad            | 10.856 ms                 | 26.279 ms                 |
| back: grad sum & grad cache  | 14.506 ms                 | 44.293 ms                 |
| Backward                  | 115.130 ms                | 156.616 ms                |
| Optimize                  | 15.025 ms                 | 24.550 ms                 |
| BarrierTimeBeforeRank0    | 52.478 us                 | 86.823 us                 |
| BlockToStepN              | 27.958 us                 | 11.907 ms                 |
| OneStep                   | 167.801 ms                | 246.612 ms                |
+---------------------------+---------------------------+---------------------------+

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 02:11:42.981222  5231 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_48', no_save_emb=True, max_step=500, batch_size=400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='TorchNativeStdEmb', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [5231 sampler.py:454] Start PreSampling
WARNING [5231 sampler.py:532] Before construct renumbering_dict
WARNING [5231 sampler.py:555] PreSampling done
W20240123 02:11:47.974932  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240123 02:11:47.975129  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240123 02:11:47.975169  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240123 02:11:47.975209  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240123 02:11:47.975245  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240123 02:11:47.975279  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240123 02:11:47.975323  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240123 02:11:47.975368  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240123 02:11:47.975399  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240123 02:11:47.975435  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240123 02:11:47.975478  5231 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240123 02:11:47.975508  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240123 02:11:47.975536  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240123 02:11:47.975652  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240123 02:11:47.975689  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240123 02:11:47.975720  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240123 02:11:47.975747  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240123 02:11:47.975778  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240123 02:11:47.975826  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240123 02:11:47.975862  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240123 02:11:47.975898  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240123 02:11:47.975936  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240123 02:11:47.975973  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240123 02:11:47.976009  5231 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240123 02:11:47.976033  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240123 02:11:47.976058  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240123 02:11:47.976126  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240123 02:11:47.976169  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240123 02:11:47.976197  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240123 02:11:47.976236  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240123 02:11:47.976266  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240123 02:11:47.976298  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240123 02:11:47.976325  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240123 02:11:47.976362  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240123 02:11:47.976389  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240123 02:11:47.976423  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240123 02:11:47.976452  5231 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240123 02:11:47.976475  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240123 02:11:47.976500  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240123 02:11:47.976567  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240123 02:11:47.976598  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240123 02:11:47.976627  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240123 02:11:47.976661  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240123 02:11:47.976694  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240123 02:11:47.976728  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240123 02:11:47.976758  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240123 02:11:47.976809  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240123 02:11:47.976859  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240123 02:11:47.976897  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240123 02:11:47.976927  5231 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240123 02:11:47.976949  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240123 02:11:47.976979  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240123 02:11:47.977046  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000
W20240123 02:11:47.977075  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000
W20240123 02:11:47.977108  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000
W20240123 02:11:47.977144  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000
W20240123 02:11:47.977180  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000
W20240123 02:11:47.977216  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000
W20240123 02:11:47.977248  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000
W20240123 02:11:47.977293  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000
W20240123 02:11:47.977326  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000
W20240123 02:11:47.977366  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000
W20240123 02:11:47.977393  5231 IPCTensor.h:367] NewIPCTensor: step_r4 [10]0x100002694000
W20240123 02:11:47.977417  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000
W20240123 02:11:47.977449  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000
W20240123 02:11:47.977510  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000
W20240123 02:11:47.977540  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000
W20240123 02:11:47.977573  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000
W20240123 02:11:47.977602  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000
W20240123 02:11:47.977634  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000
W20240123 02:11:47.977667  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000
W20240123 02:11:47.977708  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000
W20240123 02:11:47.977746  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000
W20240123 02:11:47.977782  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000
W20240123 02:11:47.977809  5231 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000
W20240123 02:11:47.977846  5231 IPCTensor.h:367] NewIPCTensor: step_r5 [10]0x100002e4c000
W20240123 02:11:47.977869  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000
W20240123 02:11:47.977896  5231 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000
W20240123 02:11:48.185750  5231 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100002e52000
W20240123 02:11:48.185902  5231 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100004524000
{0: Graph(num_nodes=9651, num_edges=125221,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10501, num_edges=116771,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=7364, num_edges=103565,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=9587, num_edges=131823,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=8718, num_edges=169929,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=9639, num_edges=154972,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9651 N 125221 E
MertisPartition: part 1 has 10501 N 116771 E
MertisPartition: part 2 has 7364 N 103565 E
MertisPartition: part 3 has 9587 N 131823 E
MertisPartition: part 4 has 8718 N 169929 E
MertisPartition: part 5 has 9639 N 154972 E
Rank0: cached key size 124
Rank1: cached key size 124
Rank2: cached key size 124
Rank3: cached key size 124
Rank4: cached key size 124
Rank5: cached key size 124
Before renumbering graph:  {'_ID': tensor([    7,    16,    24,  ..., 10345,  3788,  5916]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
After renumbering graph:  {'_ID': tensor([ 1002,  1311,  1544,  ...,  3146,  1714, 10326]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.238 seconds
[Rank1] pid = 5652
[Rank2] pid = 5716
[Rank3] pid = 5718
[Rank4] pid = 5781
INFO [5231 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [5652 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [5716 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [5718 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [5846 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [5781 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [5781 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5718 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5846 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5231 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5652 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5716 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [5781 cache_common.py:123] TorchNativeStdEmb: weight.shape torch.Size([14951, 400])
INFO [5231 cache_common.py:123] TorchNativeStdEmb: weight.shape torch.Size([14951, 400])
INFO [5716 cache_common.py:123] TorchNativeStdEmb: weight.shape torch.Size([14951, 400])
INFO [5652 cache_common.py:123] TorchNativeStdEmb: weight.shape torch.Size([14951, 400])
INFO [5718 cache_common.py:123] TorchNativeStdEmb: weight.shape torch.Size([14951, 400])
INFO [5846 cache_common.py:123] TorchNativeStdEmb: weight.shape torch.Size([14951, 400])
INFO [5231 cache_common.py:137] TorchNativeStdEmb construct done
INFO [5781 cache_common.py:137] TorchNativeStdEmb construct done
INFO [5716 cache_common.py:137] TorchNativeStdEmb construct done
INFO [5652 cache_common.py:137] TorchNativeStdEmb construct done
INFO [5718 cache_common.py:137] TorchNativeStdEmb construct done
INFO [5846 cache_common.py:137] TorchNativeStdEmb construct done
WARNING [5231 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5781 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5652 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5716 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5846 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [5718 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 02:11:50.394852  5909 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240123 02:11:50.394944  5910 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:50.395068  5845 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:50.395159  5782 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:50.395256  5717 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:50.395354  5653 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:51.015228  5717 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240123 02:11:51.017868  5653 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:51.019080  5909 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:51.019279  5782 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:51.019325  5845 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:51.019461  5910 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 747.179 us                | 7.385 ms                  |
| Forward                   | 3.453 ms                  | 10.002 ms                 |
| Backward                  | 42.234 ms                 | 95.956 ms                 |
| Optimize                  | 955.830 us                | 1.460 ms                  |
| BarrierTimeBeforeRank0    | 1.494 ms                  | 22.054 ms                 |
| BlockToStepN              | 10.396 us                 | 98.518 us                 |
| OneStep                   | 48.245 ms                 | 101.601 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 6.550, sample: 0.141, forward: 0.884, backward: 4.795, update: 0.083
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 6.551, sample: 0.147, forward: 0.889, backward: 4.750, update: 0.095
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 6.550, sample: 0.151, forward: 0.821, backward: 4.521, update: 0.085
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 6.549, sample: 0.143, forward: 0.904, backward: 4.512, update: 0.087
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 6.554, sample: 0.146, forward: 0.863, backward: 4.260, update: 0.097
[Rank5] pid = 5846
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=TorchNativeStdEmb
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482)]
train_sampler.Prefill()
-------Step 0-------
tensor([    5,  5290, 10455,   912, 13490,  5708,   113,  7650, 11993,  3376]) tensor([ 1544,    21,  6003,  5279,   104, 12725,  8982, 14706,  1654, 10530])
-------Step 1-------
tensor([    5,  5290, 10455,   912, 13490,  5708,   113,  7650, 11993,  3376]) tensor([11211, 11407,  1958, 10097, 13175,  5902, 12210, 12053, 13626, 13045])
-------Step 2-------
tensor([ 3703,   114, 12209, 11029, 13452,     0,  4907,  5206, 10781, 10052]) tensor([11599,    95,  3439,  4525,  1537,   295,  7639,  1661, 12405, 12556])
-------Step 3-------
tensor([ 3703,   114, 12209, 11029, 13452,     0,  4907,  5206, 10781, 10052]) tensor([ 1435,  2476,  9906, 11428,  5258,  3234,  8592,  8651, 12995,  6693])
-------Step 4-------
tensor([13001, 12172, 13745,  4768, 10494,  3880, 11893, 11040, 14265, 13030]) tensor([ 2456,  2357,  4087, 14807,  3225,  9465, 12907, 14308,  8839,  4676])
-------Step 5-------
tensor([13001, 12172, 13745,  4768, 10494,  3880, 11893, 11040, 14265, 13030]) tensor([ 3423,  2870,  2393,  1674, 13983, 13095,  7831, 12916, 13581,  2992])
-------Step 6-------
tensor([14453,     0,    18,    65,  8917,  5262, 13431,  8364,  4155,  2967]) tensor([ 7834,  1944,  1275,  8598,  3373, 10712, 12952,  7906,  8169,  7877])
-------Step 7-------
tensor([14453,     0,    18,    65,  8917,  5262, 13431,  8364,  4155,  2967]) tensor([9362, 2706, 5321, 8844, 1999, 7312, 8758, 3410, 4649, 3775])
-------Step 8-------
tensor([ 2078, 13490, 14919, 14783, 12118,  8917,     0,    99, 10053, 12189]) tensor([ 5282,  2873,   425,  6922, 13647,  5387, 13484,  8976, 10956, 11586])
-------Step 9-------
tensor([ 2078, 13490, 14919, 14783, 12118,  8917,     0,    99, 10053, 12189]) tensor([ 3421,  2891,  5885,  3055,  5871,  5132,  5904,  6714, 11515,  2437])
before start barrier
start train
[proc 0] 100 steps, total: 6.550, sample: 0.154, forward: 0.888, backward: 4.949, update: 0.090
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 748.761 us                | 7.878 ms                  |
| Forward                   | 3.424 ms                  | 10.002 ms                 |
| Backward                  | 60.657 ms                 | 142.950 ms                |
| Optimize                  | 959.073 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 1.798 ms                  | 34.064 ms                 |
| BlockToStepN              | 10.326 us                 | 202.439 us                |
| OneStep                   | 69.785 ms                 | 148.331 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 751.793 us                | 7.385 ms                  |
| Forward                   | 3.416 ms                  | 5.774 ms                  |
| Backward                  | 77.684 ms                 | 178.271 ms                |
| Optimize                  | 953.896 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 1.981 ms                  | 40.358 ms                 |
| BlockToStepN              | 10.192 us                 | 98.518 us                 |
| OneStep                   | 87.321 ms                 | 183.567 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 756.433 us                | 7.923 ms                  |
| Forward                   | 3.427 ms                  | 10.002 ms                 |
| Backward                  | 88.008 ms                 | 200.392 ms                |
| Optimize                  | 960.831 us                | 2.052 ms                  |
| BarrierTimeBeforeRank0    | 2.465 ms                  | 42.255 ms                 |
| BlockToStepN              | 10.282 us                 | 98.518 us                 |
| OneStep                   | 100.840 ms                | 225.551 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 200 steps, total: 15.439, sample: 0.169, forward: 0.329, backward: 13.911, update: 0.084
[proc 1] 200 steps, total: 15.439, sample: 0.159, forward: 0.356, backward: 12.894, update: 0.106
[proc 5] 200 steps, total: 15.439, sample: 0.147, forward: 0.352, backward: 13.436, update: 0.082
[proc 3] 200 steps, total: 15.439, sample: 0.151, forward: 0.362, backward: 13.641, update: 0.080
[proc 0] 200 steps, total: 15.439, sample: 0.176, forward: 0.348, backward: 13.916, update: 0.090
[proc 2] 200 steps, total: 15.439, sample: 0.159, forward: 0.320, backward: 13.117, update: 0.101
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 761.698 us                | 7.923 ms                  |
| Forward                   | 3.417 ms                  | 10.002 ms                 |
| Backward                  | 99.450 ms                 | 237.090 ms                |
| Optimize                  | 962.656 us                | 2.052 ms                  |
| BarrierTimeBeforeRank0    | 2.697 ms                  | 59.417 ms                 |
| BlockToStepN              | 10.559 us                 | 98.518 us                 |
| OneStep                   | 110.194 ms                | 251.291 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 763.680 us                | 7.923 ms                  |
| Forward                   | 3.417 ms                  | 10.002 ms                 |
| Backward                  | 107.734 ms                | 245.820 ms                |
| Optimize                  | 965.867 us                | 2.052 ms                  |
| BarrierTimeBeforeRank0    | 2.925 ms                  | 59.417 ms                 |
| BlockToStepN              | 10.663 us                 | 98.518 us                 |
| OneStep                   | 120.396 ms                | 257.957 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 761.715 us                | 7.878 ms                  |
| Forward                   | 3.414 ms                  | 6.553 ms                  |
| Backward                  | 114.835 ms                | 254.463 ms                |
| Optimize                  | 968.286 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.178 ms                  | 47.877 ms                 |
| BlockToStepN              | 10.792 us                 | 95.140 us                 |
| OneStep                   | 132.813 ms                | 269.175 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 763.795 us                | 7.878 ms                  |
| Forward                   | 3.416 ms                  | 7.378 ms                  |
| Backward                  | 125.840 ms                | 254.463 ms                |
| Optimize                  | 968.983 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.516 ms                  | 59.417 ms                 |
| BlockToStepN              | 10.871 us                 | 109.661 us                |
| OneStep                   | 142.662 ms                | 289.625 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 763.963 us                | 7.878 ms                  |
| Forward                   | 3.424 ms                  | 7.378 ms                  |
| Backward                  | 131.474 ms                | 292.454 ms                |
| Optimize                  | 970.469 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.592 ms                  | 64.725 ms                 |
| BlockToStepN              | 10.978 us                 | 109.661 us                |
| OneStep                   | 147.264 ms                | 311.091 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 300 steps, total: 24.441, sample: 0.140, forward: 0.320, backward: 22.446, update: 0.086
[proc 0] 300 steps, total: 24.441, sample: 0.153, forward: 0.349, backward: 22.692, update: 0.093
[proc 2] 300 steps, total: 24.441, sample: 0.138, forward: 0.319, backward: 21.424, update: 0.102
[proc 3] 300 steps, total: 24.441, sample: 0.144, forward: 0.383, backward: 22.110, update: 0.089
[proc 5] 300 steps, total: 24.441, sample: 0.141, forward: 0.351, backward: 21.833, update: 0.085
[proc 1] 300 steps, total: 24.441, sample: 0.136, forward: 0.344, backward: 20.720, update: 0.107
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 764.314 us                | 7.878 ms                  |
| Forward                   | 3.425 ms                  | 7.378 ms                  |
| Backward                  | 142.950 ms                | 304.741 ms                |
| Optimize                  | 971.401 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.623 ms                  | 64.725 ms                 |
| BlockToStepN              | 11.044 us                 | 109.661 us                |
| OneStep                   | 159.700 ms                | 327.785 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 766.693 us                | 7.878 ms                  |
| Forward                   | 3.428 ms                  | 7.378 ms                  |
| Backward                  | 147.299 ms                | 316.161 ms                |
| Optimize                  | 978.722 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.624 ms                  | 64.725 ms                 |
| BlockToStepN              | 11.054 us                 | 109.661 us                |
| OneStep                   | 167.214 ms                | 334.395 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 767.937 us                | 7.878 ms                  |
| Forward                   | 3.426 ms                  | 7.378 ms                  |
| Backward                  | 156.800 ms                | 317.986 ms                |
| Optimize                  | 983.422 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.714 ms                  | 64.725 ms                 |
| BlockToStepN              | 11.054 us                 | 109.661 us                |
| OneStep                   | 175.537 ms                | 341.919 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 766.019 us                | 7.385 ms                  |
| Forward                   | 3.426 ms                  | 6.553 ms                  |
| Backward                  | 166.319 ms                | 329.024 ms                |
| Optimize                  | 985.222 us                | 1.874 ms                  |
| BarrierTimeBeforeRank0    | 3.735 ms                  | 64.725 ms                 |
| BlockToStepN              | 11.158 us                 | 109.089 us                |
| OneStep                   | 181.732 ms                | 348.488 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 767.937 us                | 7.385 ms                  |
| Forward                   | 3.427 ms                  | 7.136 ms                  |
| Backward                  | 170.841 ms                | 338.656 ms                |
| Optimize                  | 987.063 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.891 ms                  | 64.725 ms                 |
| BlockToStepN              | 11.179 us                 | 109.089 us                |
| OneStep                   | 184.382 ms                | 361.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 768.623 us                | 7.385 ms                  |
| Forward                   | 3.427 ms                  | 7.136 ms                  |
| Backward                  | 178.271 ms                | 362.500 ms                |
| Optimize                  | 987.476 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 3.936 ms                  | 65.587 ms                 |
| BlockToStepN              | 11.225 us                 | 109.089 us                |
| OneStep                   | 194.741 ms                | 388.293 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 771.436 us                | 7.385 ms                  |
| Forward                   | 3.431 ms                  | 7.136 ms                  |
| Backward                  | 182.509 ms                | 382.200 ms                |
| Optimize                  | 989.078 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.023 ms                  | 65.587 ms                 |
| BlockToStepN              | 11.254 us                 | 109.089 us                |
| OneStep                   | 201.609 ms                | 404.969 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 5] 400 steps, total: 33.135, sample: 0.133, forward: 0.349, backward: 29.961, update: 0.089
[proc 1] 400 steps, total: 33.135, sample: 0.133, forward: 0.351, backward: 28.639, update: 0.107
[proc 4] 400 steps, total: 33.135, sample: 0.135, forward: 0.321, backward: 31.229, update: 0.087
[proc 2] 400 steps, total: 33.135, sample: 0.135, forward: 0.322, backward: 29.482, update: 0.107
[proc 3] 400 steps, total: 33.135, sample: 0.138, forward: 0.384, backward: 30.584, update: 0.092
[proc 0] 400 steps, total: 33.135, sample: 0.148, forward: 0.348, backward: 31.251, update: 0.097
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 773.184 us                | 7.385 ms                  |
| Forward                   | 3.434 ms                  | 7.136 ms                  |
| Backward                  | 186.944 ms                | 391.978 ms                |
| Optimize                  | 992.117 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.055 ms                  | 65.587 ms                 |
| BlockToStepN              | 11.281 us                 | 109.089 us                |
| OneStep                   | 206.594 ms                | 412.813 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 771.436 us                | 7.594 ms                  |
| Forward                   | 3.436 ms                  | 7.136 ms                  |
| Backward                  | 195.103 ms                | 401.583 ms                |
| Optimize                  | 993.175 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.110 ms                  | 65.685 ms                 |
| BlockToStepN              | 11.291 us                 | 109.661 us                |
| OneStep                   | 214.198 ms                | 422.194 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 771.436 us                | 7.594 ms                  |
| Forward                   | 3.439 ms                  | 7.136 ms                  |
| Backward                  | 199.343 ms                | 416.566 ms                |
| Optimize                  | 995.026 us                | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.118 ms                  | 65.685 ms                 |
| BlockToStepN              | 11.314 us                 | 109.661 us                |
| OneStep                   | 218.468 ms                | 427.824 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 773.706 us                | 7.594 ms                  |
| Forward                   | 3.441 ms                  | 7.378 ms                  |
| Backward                  | 206.407 ms                | 422.435 ms                |
| Optimize                  | 998.971 us                | 2.052 ms                  |
| BarrierTimeBeforeRank0    | 4.207 ms                  | 70.870 ms                 |
| BlockToStepN              | 11.375 us                 | 116.366 us                |
| OneStep                   | 221.854 ms                | 443.847 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 774.244 us                | 7.585 ms                  |
| Forward                   | 3.440 ms                  | 7.136 ms                  |
| Backward                  | 212.156 ms                | 424.102 ms                |
| Optimize                  | 1.001 ms                  | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.276 ms                  | 70.870 ms                 |
| BlockToStepN              | 11.375 us                 | 109.661 us                |
| OneStep                   | 225.204 ms                | 453.050 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 774.734 us                | 7.585 ms                  |
| Forward                   | 3.445 ms                  | 7.136 ms                  |
| Backward                  | 215.903 ms                | 425.776 ms                |
| Optimize                  | 1.003 ms                  | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.365 ms                  | 70.870 ms                 |
| BlockToStepN              | 11.390 us                 | 109.661 us                |
| OneStep                   | 229.433 ms                | 458.777 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 774.244 us                | 7.585 ms                  |
| Forward                   | 3.447 ms                  | 7.136 ms                  |
| Backward                  | 219.595 ms                | 447.903 ms                |
| Optimize                  | 1.004 ms                  | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.365 ms                  | 71.530 ms                 |
| BlockToStepN              | 11.436 us                 | 109.661 us                |
| OneStep                   | 234.707 ms                | 471.513 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 776.006 us                | 7.585 ms                  |
| Forward                   | 3.449 ms                  | 7.136 ms                  |
| Backward                  | 225.611 ms                | 472.113 ms                |
| Optimize                  | 1.005 ms                  | 2.049 ms                  |
| BarrierTimeBeforeRank0    | 4.365 ms                  | 71.530 ms                 |
| BlockToStepN              | 11.435 us                 | 109.661 us                |
| OneStep                   | 239.199 ms                | 480.582 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 500 steps, total: 42.176, sample: 0.146, forward: 0.383, backward: 39.048, update: 0.091
[proc 5] 500 steps, total: 42.176, sample: 0.135, forward: 0.349, backward: 38.196, update: 0.088
[proc 4] 500 steps, total: 42.176, sample: 0.139, forward: 0.323, backward: 39.887, update: 0.088
[proc 2] 500 steps, total: 42.176, sample: 0.139, forward: 0.324, backward: 37.537, update: 0.100
[proc 1] 500 steps, total: 42.176, sample: 0.145, forward: 0.361, backward: 36.439, update: 0.108
[proc 0] 500 steps, total: 42.176, sample: 0.161, forward: 0.358, backward: 40.166, update: 0.104
Successfully xmh. training takes 121.74173259735107 seconds
before call kg_cache_controller.StopThreads()
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
INFO [5231 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 02:38:59.159919  7414 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_65', no_save_emb=True, max_step=500, batch_size=800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [7414 sampler.py:454] Start PreSampling
WARNING [7414 sampler.py:532] Before construct renumbering_dict
WARNING [7414 sampler.py:555] PreSampling done
W20240123 02:39:02.855051  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240123 02:39:02.855209  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240123 02:39:02.855233  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240123 02:39:02.855257  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240123 02:39:02.855283  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240123 02:39:02.855305  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240123 02:39:02.855331  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240123 02:39:02.855353  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240123 02:39:02.855378  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240123 02:39:02.855408  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240123 02:39:02.855437  7414 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240123 02:39:02.855455  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240123 02:39:02.855476  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240123 02:39:02.855579  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240123 02:39:02.855600  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240123 02:39:02.855624  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240123 02:39:02.855643  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240123 02:39:02.855669  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240123 02:39:02.855712  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240123 02:39:02.855741  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240123 02:39:02.855768  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240123 02:39:02.855791  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240123 02:39:02.855814  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240123 02:39:02.855839  7414 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240123 02:39:02.855855  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240123 02:39:02.855870  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240123 02:39:02.855908  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240123 02:39:02.855938  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240123 02:39:02.855962  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240123 02:39:02.855979  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240123 02:39:02.855998  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240123 02:39:02.856024  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240123 02:39:02.856046  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240123 02:39:02.856070  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240123 02:39:02.856091  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240123 02:39:02.856114  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240123 02:39:02.856135  7414 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240123 02:39:02.856150  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240123 02:39:02.856171  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240123 02:39:02.856211  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240123 02:39:02.856231  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240123 02:39:02.856249  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240123 02:39:02.856267  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240123 02:39:02.856287  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240123 02:39:02.856309  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240123 02:39:02.856339  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240123 02:39:02.856359  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240123 02:39:02.856385  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240123 02:39:02.856403  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240123 02:39:02.856423  7414 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240123 02:39:02.856441  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240123 02:39:02.856456  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240123 02:39:02.856491  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000
W20240123 02:39:02.856515  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000
W20240123 02:39:02.856537  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000
W20240123 02:39:02.856556  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000
W20240123 02:39:02.856575  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000
W20240123 02:39:02.856597  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000
W20240123 02:39:02.856619  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000
W20240123 02:39:02.856642  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000
W20240123 02:39:02.856662  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000
W20240123 02:39:02.856680  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000
W20240123 02:39:02.856702  7414 IPCTensor.h:367] NewIPCTensor: step_r4 [10]0x100002694000
W20240123 02:39:02.856719  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000
W20240123 02:39:02.856736  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000
W20240123 02:39:02.856773  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000
W20240123 02:39:02.856806  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000
W20240123 02:39:02.856829  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000
W20240123 02:39:02.856864  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000
W20240123 02:39:02.856889  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000
W20240123 02:39:02.856909  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000
W20240123 02:39:02.856936  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000
W20240123 02:39:02.856961  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000
W20240123 02:39:02.856985  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000
W20240123 02:39:02.857005  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000
W20240123 02:39:02.857024  7414 IPCTensor.h:367] NewIPCTensor: step_r5 [10]0x100002e4c000
W20240123 02:39:02.857041  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000
W20240123 02:39:02.857056  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000
W20240123 02:39:02.857100  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_0 [100000]0x100002e52000
W20240123 02:39:02.857121  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_1 [100000]0x100002f17000
W20240123 02:39:02.857141  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_2 [100000]0x100002fdc000
W20240123 02:39:02.857160  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_3 [100000]0x1000030a1000
W20240123 02:39:02.857184  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_4 [100000]0x100003166000
W20240123 02:39:02.857204  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_5 [100000]0x10000322b000
W20240123 02:39:02.857228  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_6 [100000]0x1000032f0000
W20240123 02:39:02.857246  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_7 [100000]0x1000033b5000
W20240123 02:39:02.857266  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_8 [100000]0x10000347a000
W20240123 02:39:02.857288  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_9 [100000]0x10000353f000
W20240123 02:39:02.857312  7414 IPCTensor.h:367] NewIPCTensor: step_r6 [10]0x100003604000
W20240123 02:39:02.857328  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r6 [1]0x100003606000
W20240123 02:39:02.857349  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x100003608000
W20240123 02:39:02.857388  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_0 [100000]0x10000360a000
W20240123 02:39:02.857414  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_1 [100000]0x1000036cf000
W20240123 02:39:02.857440  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_2 [100000]0x100003794000
W20240123 02:39:02.857460  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_3 [100000]0x100003859000
W20240123 02:39:02.857486  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_4 [100000]0x10000391e000
W20240123 02:39:02.857510  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_5 [100000]0x1000039e3000
W20240123 02:39:02.857537  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_6 [100000]0x100003aa8000
W20240123 02:39:02.857561  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_7 [100000]0x100003b6d000
W20240123 02:39:02.857586  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_8 [100000]0x100003c32000
W20240123 02:39:02.857609  7414 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_9 [100000]0x100003cf7000
W20240123 02:39:02.857630  7414 IPCTensor.h:367] NewIPCTensor: step_r7 [10]0x100003dbc000
W20240123 02:39:02.857646  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r7 [1]0x100003dbe000
W20240123 02:39:02.857661  7414 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100003dc0000
W20240123 02:39:03.056814  7414 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100003dc2000
W20240123 02:39:03.056993  7414 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100005494000
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([ 744,  879, 1046,  ..., 9173, 9614, 7255]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 3.931 seconds
[Rank1] pid = 7819
[Rank2] pid = 7883
[Rank3] pid = 7947
[Rank4] pid = 7948
[Rank5] pid = 8075
[Rank6] pid = 8076
INFO [7414 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [7819 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [7883 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [7947 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [7948 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [8076 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [8076 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [8075 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [8080 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [8075 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [8080 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [7947 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [7948 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240123 02:39:06.778348  8147 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_6 [747, 400]; dev=6; size=1.14 MB
INFO [7883 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240123 02:39:06.780053  8079 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240123 02:39:06.780166  8148 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_7 [747, 400]; dev=7; size=1.14 MB
W20240123 02:39:06.780334  7949 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240123 02:39:06.780380  7981 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
INFO [7819 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240123 02:39:06.781312  7884 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240123 02:39:06.783391  7820 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
INFO [7414 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240123 02:39:06.785723  8081 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240123 02:39:06.791041  8147 IPCTensor.h:367] NewIPCTensor: input_keys_6 [100000]0x1000054a6000
W20240123 02:39:06.791146  8147 IPCTensor.h:367] NewIPCTensor: input_keys_neg_6 [100000]0x10000556b000
W20240123 02:39:06.791191  8147 IPCTensor.h:367] NewIPCTensor: backward_grads_6 [100000, 400]0x100005630000
W20240123 02:39:06.791221  8147 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_6 [100000, 400]0x10000eec8000
W20240123 02:39:06.791260  8147 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_6_gpu [100000, 400]; dev=6; size=152.6 MB
W20240123 02:39:06.791669  8147 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_6_gpu [100000, 400]; dev=6; size=152.6 MB
W20240123 02:39:06.806164  7981 IPCTensor.h:367] NewIPCTensor: input_keys_4 [100000]0x10001876e000
W20240123 02:39:06.806169  7949 IPCTensor.h:367] NewIPCTensor: input_keys_3 [100000]0x100018833000
W20240123 02:39:06.806226  8079 IPCTensor.h:367] NewIPCTensor: input_keys_5 [100000]0x1000188f8000
W20240123 02:39:06.806263  8148 IPCTensor.h:367] NewIPCTensor: input_keys_7 [100000]0x1000189bd000
W20240123 02:39:06.806316  7949 IPCTensor.h:367] NewIPCTensor: input_keys_neg_3 [100000]0x100018a82000
W20240123 02:39:06.806322  7981 IPCTensor.h:367] NewIPCTensor: input_keys_neg_4 [100000]0x100018b47000
W20240123 02:39:06.806351  8079 IPCTensor.h:367] NewIPCTensor: input_keys_neg_5 [100000]0x100018c0c000
W20240123 02:39:06.806382  8148 IPCTensor.h:367] NewIPCTensor: input_keys_neg_7 [100000]0x100018cd1000
W20240123 02:39:06.806392  7949 IPCTensor.h:367] NewIPCTensor: backward_grads_3 [100000, 400]0x100018d96000
W20240123 02:39:06.806406  7981 IPCTensor.h:367] NewIPCTensor: backward_grads_4 [100000, 400]0x10002262e000
W20240123 02:39:06.806427  8079 IPCTensor.h:367] NewIPCTensor: backward_grads_5 [100000, 400]0x10002bec6000
W20240123 02:39:06.806452  7949 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x10003575e000
W20240123 02:39:06.806459  7981 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_4 [100000, 400]0x10003eff6000
W20240123 02:39:06.806466  8148 IPCTensor.h:367] NewIPCTensor: backward_grads_7 [100000, 400]0x10004888e000
W20240123 02:39:06.806488  8079 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_5 [100000, 400]0x100052126000
W20240123 02:39:06.806509  7949 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 02:39:06.806519  8079 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240123 02:39:06.806524  7981 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240123 02:39:06.806535  8148 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_7 [100000, 400]0x10005b9be000
W20240123 02:39:06.806576  8148 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_7_gpu [100000, 400]; dev=7; size=152.6 MB
W20240123 02:39:06.806573  7884 IPCTensor.h:367] NewIPCTensor: input_keys_2 [100000]0x100065256000
W20240123 02:39:06.806772  7884 IPCTensor.h:367] NewIPCTensor: input_keys_neg_2 [100000]0x10006531b000
W20240123 02:39:06.806890  7884 IPCTensor.h:367] NewIPCTensor: backward_grads_2 [100000, 400]0x1000653e0000
W20240123 02:39:06.806978  7884 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x10006ec78000
W20240123 02:39:06.807049  7884 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 02:39:06.807826  7820 IPCTensor.h:367] NewIPCTensor: input_keys_1 [100000]0x100078512000
W20240123 02:39:06.807953  7820 IPCTensor.h:367] NewIPCTensor: input_keys_neg_1 [100000]0x1000785d7000
W20240123 02:39:06.808009  7820 IPCTensor.h:367] NewIPCTensor: backward_grads_1 [100000, 400]0x10007869c000
W20240123 02:39:06.808060  7820 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x100081f34000
W20240123 02:39:06.808101  7820 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 02:39:06.808447  7949 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 02:39:06.808686  7981 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240123 02:39:06.808753  8079 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240123 02:39:06.808758  8148 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_7_gpu [100000, 400]; dev=7; size=152.6 MB
W20240123 02:39:06.809070  7884 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 02:39:06.810508  7820 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 02:39:06.811581  8081 IPCTensor.h:367] NewIPCTensor: input_keys_0 [100000]0x10008b7e6000
W20240123 02:39:06.811686  8081 IPCTensor.h:367] NewIPCTensor: input_keys_neg_0 [100000]0x10008b8ab000
W20240123 02:39:06.811741  8081 IPCTensor.h:367] NewIPCTensor: backward_grads_0 [100000, 400]0x10008b970000
W20240123 02:39:06.811790  8081 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x100095208000
W20240123 02:39:06.811841  8081 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 02:39:06.812484  8081 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
cudaHostRegister 0x100003dc2000
2: KnownLocalCachedEmbedding init done
WARNING [7883 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank7] pid = 8080
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
cudaHostRegister 0x100003dc2000
0: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100003dc2000
3: KnownLocalCachedEmbedding init done
WARNING [7414 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [7947 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
1: KnownLocalCachedEmbedding init done
WARNING [7819 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
4: KnownLocalCachedEmbedding init done
WARNING [7948 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
5: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100003dc2000
7: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100003dc2000
6: KnownLocalCachedEmbedding init done
WARNING [8075 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [8076 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [8080 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 02:39:06.983026  8148 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240123 02:39:06.983063  7981 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:39:06.983086  8147 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:39:06.983107  7820 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:39:06.983134  8079 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:39:06.983163  7884 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:39:06.983198  8081 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:39:06.983222  7949 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240123 02:39:06.984436  8081 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240123 02:39:06.984611  8081 grad_base.h:172] Init GradProcessingBase done
I20240123 02:39:06.993781  8081 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240123 02:39:06.994006  8081 kg_controller.h:78] after init GradAsyncProcessingV2
I20240123 02:39:06.994022  8081 kg_controller.h:84] Construct KGCacheController done
I20240123 02:39:07.783504  8081 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240123 02:39:08.871909  8890 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 02:39:08.872629  8890 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240123 02:39:08.898983  7884 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240123 02:39:08.913830  8081 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:39:08.922083  7820 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:39:08.924948  7949 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:39:08.927213  8147 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:39:08.929139  7981 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:39:08.936429  8079 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:39:08.938412  8148 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
E20240123 02:39:11.505044  8081 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 02:39:11.524897  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240123 02:39:11.537432  8890 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.789 ms                  | 16.680 ms                 |
| Forward                   | 4.651 ms                  | 682.777 ms                |
| Backward                  | 4.135 ms                  | 321.161 ms                |
| Optimize                  | 1.596 ms                  | 2.163 ms                  |
| BarrierTimeBeforeRank0    | 2.323 ms                  | 101.942 ms                |
| AfterBackward             | 36.387 ms                 | 1.476 s                   |
| BlockToStepN              | 4.835 ms                  | 49.072 ms                 |
| OneStep                   | 62.485 ms                 | 2.594 s                   |
+---------------------------+---------------------------+---------------------------+
E20240123 02:39:12.505012  8890 parallel_pq_v2.h:76] insert failed, size(hashtable)=1145
W20240123 02:39:12.542858  8890 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end7
W20240123 02:39:12.580679  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=17, pq.top=17
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.218 ms                  | 419.832 ms                |
| ProcessBack:UpdateCache   | 8.213 ms                  | 1.027 s                   |
| ProcessBack:UpsertPq      | 16.708 ms                 | 28.711 ms                 |
| ProcessOneStep            | 35.873 ms                 | 1.476 s                   |
| BlockToStepN              | 3.713 ms                  | 49.006 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:39:13.505050  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=10439
W20240123 02:39:13.542059  8890 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:39:13.585171  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=33, pq.top=33
E20240123 02:39:14.505640  8460 parallel_pq_v2.h:76] insert failed, size(hashtable)=398
W20240123 02:39:14.548473  8890 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:39:14.636211  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=50, pq.top=50
E20240123 02:39:15.505010  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=5977
W20240123 02:39:15.550139  8890 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240123 02:39:15.706216  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=67, pq.top=67
E20240123 02:39:16.505021  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=9044
W20240123 02:39:16.552403  8890 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240123 02:39:16.745581  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=84, pq.top=84
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.396 ms                  | 18.517 ms                 |
| Forward                   | 4.425 ms                  | 15.002 ms                 |
| Backward                  | 4.073 ms                  | 16.049 ms                 |
| Optimize                  | 1.552 ms                  | 2.341 ms                  |
| BarrierTimeBeforeRank0    | 1.401 ms                  | 31.180 ms                 |
| AfterBackward             | 38.235 ms                 | 59.008 ms                 |
| BlockToStepN              | 2.760 ms                  | 43.685 ms                 |
| OneStep                   | 57.431 ms                 | 111.425 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 02:39:17.505015  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=4808
W20240123 02:39:17.562742  8890 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240123 02:39:17.782048  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=100, pq.top=100
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.776 ms                  | 11.997 ms                 |
| ProcessBack:UpdateCache   | 11.294 ms                 | 22.520 ms                 |
| ProcessBack:UpsertPq      | 17.788 ms                 | 29.830 ms                 |
| ProcessOneStep            | 37.765 ms                 | 58.969 ms                 |
| BlockToStepN              | 2.691 ms                  | 43.546 ms                 |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 8.864, sample: 0.345, forward: 1.175, backward: 0.617, update: 0.148
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 8.865, sample: 0.327, forward: 1.213, backward: 0.622, update: 0.143
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 8.854, sample: 0.283, forward: 1.168, backward: 0.635, update: 0.132
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 8.894, sample: 0.294, forward: 1.118, backward: 0.661, update: 0.135
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 8.856, sample: 0.364, forward: 1.378, backward: 0.568, update: 0.163
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 8.871, sample: 0.304, forward: 1.284, backward: 0.575, update: 0.143
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 8.868, sample: 0.346, forward: 1.220, backward: 0.652, update: 0.137
train_sampler.Prefill()
-------Step 0-------
tensor([ 2111,    57,  3676,  3325, 12305, 12874,  1115,   377, 13177, 11770]) tensor([ 1046,  9882,  6009, 11288, 11946,  1110,   631,  5297,  5328, 12938])
-------Step 1-------
tensor([ 2111,    57,  3676,  3325, 12305, 12874,  1115,   377, 13177, 11770]) tensor([ 1076,  2558,   546,  4533,  7077,  7997, 14203,  1082,  1920,  1129])
-------Step 2-------
tensor([ 7101,  4166,  2690, 12445,  8756,    19,   876,     7,  9491,  5634]) tensor([ 9076,  6471,  3270, 10835,  8049, 13432, 12706,   439, 11326,  7903])
-------Step 3-------
tensor([ 7101,  4166,  2690, 12445,  8756,    19,   876,     7,  9491,  5634]) tensor([14552,  5976,  9667, 12092,  5971,  4091,  3594,  6145,   846,  4742])
-------Step 4-------
tensor([ 7631,  5394,  6693,     7, 10371,  6291, 14846,    19,  5603,    36]) tensor([11039,  7879, 11066,  1051,  6573,  1708,  1378,  1317, 10096,  1986])
-------Step 5-------
tensor([ 7631,  5394,  6693,     7, 10371,  6291, 14846,    19,  5603,    36]) tensor([ 2904,  9923,  1702,  5356,  9748, 12311,  3634,  6544, 12623,  5262])
-------Step 6-------
tensor([   57,  4184, 10943,  5809,  2332,  3438,    88,  7323,  7734,  1027]) tensor([ 639, 1208, 4359, 3273, 3255, 2773,  377, 6479, 5975, 1846])
-------Step 7-------
tensor([   57,  4184, 10943,  5809,  2332,  3438,    88,  7323,  7734,  1027]) tensor([ 6175,  6177,  8778, 10954,  9623,  2537, 11169, 10345,  7770, 11557])
-------Step 8-------
tensor([11718,  1288,     3,  4233, 13351,    13, 10285,    19,  1127,  3172]) tensor([ 5822, 10838,  2089,  9075, 10575, 13544, 11436,  2160, 14256,  6142])
-------Step 9-------
tensor([11718,  1288,     3,  4233, 13351,    13, 10285,    19,  1127,  3172]) tensor([ 4078, 10193, 14404,  1593,  1025,  7703, 14691,  9918,  5800, 13093])
before start barrier
start train
[proc 0] 100 steps, total: 8.879, sample: 0.356, forward: 1.154, backward: 0.762, update: 0.155
E20240123 02:39:18.505012  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=5890
W20240123 02:39:18.564424  8890 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:39:18.782162  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=116, pq.top=116
E20240123 02:39:19.505009  8460 parallel_pq_v2.h:76] insert failed, size(hashtable)=807
W20240123 02:39:19.573143  8890 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240123 02:39:19.789773  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=133, pq.top=133
E20240123 02:39:20.505064  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=5613
W20240123 02:39:20.574791  8890 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end6
W20240123 02:39:20.824621  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=150, pq.top=150
E20240123 02:39:21.505008  8460 parallel_pq_v2.h:76] insert failed, size(hashtable)=948
W20240123 02:39:21.581269  8890 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240123 02:39:21.885162  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=168, pq.top=168
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.368 ms                  | 18.517 ms                 |
| Forward                   | 4.379 ms                  | 11.704 ms                 |
| Backward                  | 4.065 ms                  | 8.559 ms                  |
| Optimize                  | 1.599 ms                  | 2.446 ms                  |
| BarrierTimeBeforeRank0    | 1.004 ms                  | 31.180 ms                 |
| AfterBackward             | 37.571 ms                 | 55.861 ms                 |
| BlockToStepN              | 3.774 ms                  | 43.685 ms                 |
| OneStep                   | 57.190 ms                 | 114.298 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 02:39:22.505007  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=7435
W20240123 02:39:22.620297  8890 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.738 ms                  | 10.288 ms                 |
| ProcessBack:UpdateCache   | 11.229 ms                 | 16.022 ms                 |
| ProcessBack:UpsertPq      | 17.448 ms                 | 29.272 ms                 |
| ProcessOneStep            | 37.567 ms                 | 55.816 ms                 |
| BlockToStepN              | 3.986 ms                  | 44.245 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:22.911697  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=183, pq.top=183
E20240123 02:39:23.505008  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=6946
W20240123 02:39:23.629627  8890 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end5
W20240123 02:39:23.914844  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=199, pq.top=199
[proc 7] 200 steps, total: 6.258, sample: 0.328, forward: 0.406, backward: 0.437, update: 0.141
[proc 6] 200 steps, total: 6.258, sample: 0.320, forward: 0.407, backward: 0.432, update: 0.144
[proc 1] 200 steps, total: 6.258, sample: 0.357, forward: 0.445, backward: 0.437, update: 0.159
[proc 2] 200 steps, total: 6.258, sample: 0.316, forward: 0.405, backward: 0.406, update: 0.134
[proc 4] 200 steps, total: 6.258, sample: 0.343, forward: 0.423, backward: 0.421, update: 0.141
[proc 3] 200 steps, total: 6.258, sample: 0.393, forward: 0.465, backward: 0.421, update: 0.146
[proc 5] 200 steps, total: 6.258, sample: 0.355, forward: 0.442, backward: 0.382, update: 0.158
[proc 0] 200 steps, total: 6.258, sample: 0.337, forward: 0.433, backward: 0.403, update: 0.159
E20240123 02:39:24.508888  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=4578
W20240123 02:39:24.636989  8890 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:39:24.930338  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=213, pq.top=213
E20240123 02:39:25.508031  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=5977
W20240123 02:39:25.661736  8890 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:39:25.956035  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=225, pq.top=225
E20240123 02:39:26.508038  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=7976
W20240123 02:39:26.661088  8890 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240123 02:39:26.968827  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=239, pq.top=239
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.375 ms                  | 21.571 ms                 |
| Forward                   | 4.363 ms                  | 11.704 ms                 |
| Backward                  | 4.069 ms                  | 8.559 ms                  |
| Optimize                  | 1.601 ms                  | 2.598 ms                  |
| BarrierTimeBeforeRank0    | 1.008 ms                  | 31.180 ms                 |
| AfterBackward             | 37.813 ms                 | 62.726 ms                 |
| BlockToStepN              | 4.802 ms                  | 56.808 ms                 |
| OneStep                   | 58.704 ms                 | 136.000 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 02:39:27.508010  8890 parallel_pq_v2.h:76] insert failed, size(hashtable)=95
W20240123 02:39:27.663255  8890 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.757 ms                  | 10.151 ms                 |
| ProcessBack:UpdateCache   | 11.226 ms                 | 14.279 ms                 |
| ProcessBack:UpsertPq      | 17.700 ms                 | 39.645 ms                 |
| ProcessOneStep            | 37.821 ms                 | 62.661 ms                 |
| BlockToStepN              | 4.877 ms                  | 56.582 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:27.997248  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=253, pq.top=253
E20240123 02:39:28.508010  8890 parallel_pq_v2.h:76] insert failed, size(hashtable)=137
W20240123 02:39:28.668718  8890 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:39:29.018937  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=265, pq.top=265
E20240123 02:39:29.508008  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=6491
W20240123 02:39:29.672462  8890 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240123 02:39:30.065584  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=279, pq.top=279
E20240123 02:39:30.508013  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=8301
W20240123 02:39:30.676955  8890 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240123 02:39:31.074530  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=291, pq.top=291
E20240123 02:39:31.508009  8081 parallel_pq_v2.h:76] insert failed, size(hashtable)=215
W20240123 02:39:31.682438  8890 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
[proc 2] 300 steps, total: 7.662, sample: 0.305, forward: 0.410, backward: 0.417, update: 0.136
[proc 0] 300 steps, total: 7.662, sample: 0.330, forward: 0.431, backward: 0.406, update: 0.149
[proc 1] 300 steps, total: 7.663, sample: 0.314, forward: 0.441, backward: 0.368, update: 0.156
[proc 6] 300 steps, total: 7.663, sample: 0.335, forward: 0.421, backward: 0.403, update: 0.134
[proc 5] 300 steps, total: 7.662, sample: 0.269, forward: 0.405, backward: 0.391, update: 0.139
[proc 3] 300 steps, total: 7.662, sample: 0.312, forward: 0.406, backward: 0.415, update: 0.133
[proc 4] 300 steps, total: 7.663, sample: 0.293, forward: 0.411, backward: 0.365, update: 0.135
[proc 7] 300 steps, total: 7.663, sample: 0.262, forward: 0.383, backward: 0.414, update: 0.131
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.382 ms                  | 21.410 ms                 |
| Forward                   | 4.341 ms                  | 10.545 ms                 |
| Backward                  | 4.052 ms                  | 7.729 ms                  |
| Optimize                  | 1.589 ms                  | 2.446 ms                  |
| BarrierTimeBeforeRank0    | 1.094 ms                  | 31.180 ms                 |
| AfterBackward             | 37.704 ms                 | 61.442 ms                 |
| BlockToStepN              | 5.672 ms                  | 70.383 ms                 |
| OneStep                   | 59.553 ms                 | 150.150 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:32.115120  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=307, pq.top=307
E20240123 02:39:32.508010  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=8274
W20240123 02:39:32.685173  8890 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.734 ms                  | 9.981 ms                  |
| ProcessBack:UpdateCache   | 11.178 ms                 | 14.171 ms                 |
| ProcessBack:UpsertPq      | 17.726 ms                 | 39.537 ms                 |
| ProcessOneStep            | 37.709 ms                 | 61.391 ms                 |
| BlockToStepN              | 5.700 ms                  | 70.290 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:33.131148  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=320, pq.top=320
E20240123 02:39:33.508018  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=10962
W20240123 02:39:33.688169  8890 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:39:34.151829  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=335, pq.top=335
E20240123 02:39:34.508010  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=5066
W20240123 02:39:34.719336  8890 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240123 02:39:35.187697  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=350, pq.top=350
E20240123 02:39:35.508013  8081 parallel_pq_v2.h:76] insert failed, size(hashtable)=1835
W20240123 02:39:35.724970  8890 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:39:36.219681  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=365, pq.top=365
E20240123 02:39:36.508011  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=5010
W20240123 02:39:36.757419  8890 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.394 ms                  | 20.824 ms                 |
| Forward                   | 4.326 ms                  | 9.836 ms                  |
| Backward                  | 4.038 ms                  | 7.729 ms                  |
| Optimize                  | 1.559 ms                  | 2.457 ms                  |
| BarrierTimeBeforeRank0    | 1.282 ms                  | 31.180 ms                 |
| AfterBackward             | 38.060 ms                 | 61.389 ms                 |
| BlockToStepN              | 6.918 ms                  | 63.363 ms                 |
| OneStep                   | 61.009 ms                 | 138.751 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:37.219467  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=379, pq.top=379
E20240123 02:39:37.508009  8460 parallel_pq_v2.h:76] insert failed, size(hashtable)=798
W20240123 02:39:37.767598  8890 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.757 ms                  | 9.939 ms                  |
| ProcessBack:UpdateCache   | 11.213 ms                 | 14.061 ms                 |
| ProcessBack:UpsertPq      | 17.832 ms                 | 39.437 ms                 |
| ProcessOneStep            | 37.910 ms                 | 61.348 ms                 |
| BlockToStepN              | 6.971 ms                  | 63.278 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:38.236244  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=395, pq.top=395
E20240123 02:39:38.508031  8890 parallel_pq_v2.h:76] insert failed, size(hashtable)=52
[proc 7] 400 steps, total: 6.841, sample: 0.348, forward: 0.419, backward: 0.432, update: 0.139
[proc 4] 400 steps, total: 6.841, sample: 0.268, forward: 0.399, backward: 0.431, update: 0.131
[proc 0] 400 steps, total: 6.841, sample: 0.340, forward: 0.418, backward: 0.402, update: 0.149
[proc 6] 400 steps, total: 6.841, sample: 0.259, forward: 0.394, backward: 0.403, update: 0.134
[proc 2] 400 steps, total: 6.841, sample: 0.302, forward: 0.407, backward: 0.383, update: 0.131
[proc 3] 400 steps, total: 6.841, sample: 0.307, forward: 0.391, backward: 0.418, update: 0.129
[proc 5] 400 steps, total: 6.841, sample: 0.294, forward: 0.417, backward: 0.463, update: 0.130
[proc 1] 400 steps, total: 6.841, sample: 0.244, forward: 0.393, backward: 0.348, update: 0.137
W20240123 02:39:38.782581  8890 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240123 02:39:39.237212  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=411, pq.top=411
E20240123 02:39:39.508020  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=8173
W20240123 02:39:39.784981  8890 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240123 02:39:40.238888  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=427, pq.top=427
E20240123 02:39:40.508009  8081 parallel_pq_v2.h:76] insert failed, size(hashtable)=80
W20240123 02:39:40.791801  8890 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240123 02:39:41.262987  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=442, pq.top=442
E20240123 02:39:41.508024  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=3889
W20240123 02:39:41.792474  8890 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.405 ms                  | 19.977 ms                 |
| Forward                   | 4.306 ms                  | 8.526 ms                  |
| Backward                  | 4.029 ms                  | 7.585 ms                  |
| Optimize                  | 1.539 ms                  | 2.457 ms                  |
| BarrierTimeBeforeRank0    | 1.451 ms                  | 30.517 ms                 |
| AfterBackward             | 37.433 ms                 | 61.248 ms                 |
| BlockToStepN              | 7.307 ms                  | 56.808 ms                 |
| OneStep                   | 62.068 ms                 | 136.367 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:42.322911  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=459, pq.top=459
E20240123 02:39:42.508014  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=3109
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.660 ms                  | 9.692 ms                  |
| ProcessBack:UpdateCache   | 11.050 ms                 | 13.966 ms                 |
| ProcessBack:UpsertPq      | 17.605 ms                 | 38.459 ms                 |
| ProcessOneStep            | 37.337 ms                 | 61.209 ms                 |
| BlockToStepN              | 7.344 ms                  | 56.582 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 02:39:42.794484  8890 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240123 02:39:43.339040  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=475, pq.top=475
E20240123 02:39:43.508009  8889 parallel_pq_v2.h:76] insert failed, size(hashtable)=7711
W20240123 02:39:43.795771  8890 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
W20240123 02:39:44.340688  8081 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=488, pq.top=488
E20240123 02:39:44.508013  8890 parallel_pq_v2.h:76] insert failed, size(hashtable)=106
W20240123 02:39:44.822198  8890 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
[proc 1] 500 steps, total: 6.586, sample: 0.289, forward: 0.382, backward: 0.371, update: 0.127
[proc 0] 500 steps, total: 6.587, sample: 0.314, forward: 0.414, backward: 0.388, update: 0.140
[proc 7] 500 steps, total: 6.587, sample: 0.273, forward: 0.399, backward: 0.457, update: 0.132
[proc 3] 500 steps, total: 6.587, sample: 0.265, forward: 0.395, backward: 0.404, update: 0.132
[proc 5] 500 steps, total: 6.586, sample: 0.259, forward: 0.386, backward: 0.401, update: 0.122
[proc 4] 500 steps, total: 6.587, sample: 0.270, forward: 0.387, backward: 0.390, update: 0.124
Successfully xmh. training takes 36.22834348678589 seconds
before call kg_cache_controller.StopThreads()
[proc 2] 500 steps, total: 6.587, sample: 0.269, forward: 0.393, backward: 0.392, update: 0.126
W20240123 02:39:45.142637  8081 grad_async_v2.h:71] call StopThreads. PID = 7414
W20240123 02:39:45.142673  8081 grad_base.h:210] before processOneStepNegThread_.join();
[proc 6] 500 steps, total: 6.587, sample: 0.272, forward: 0.397, backward: 0.412, update: 0.129
W20240123 02:39:45.143059  8081 grad_base.h:212] after processOneStepNegThread_.join();
W20240123 02:39:45.143070  8081 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240123 02:39:45.154595  8081 grad_async_v2.h:91] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7faf4c097c10>

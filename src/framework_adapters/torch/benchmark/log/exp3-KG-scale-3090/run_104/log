WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240124 03:05:06.944098 56351 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_51', no_save_emb=True, max_step=500, batch_size=1600, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [56351 sampler.py:454] Start PreSampling
WARNING [56351 sampler.py:532] Before construct renumbering_dict
WARNING [56351 sampler.py:555] PreSampling done
W20240124 03:18:33.835695 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240124 03:18:33.835976 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240124 03:18:33.836015 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240124 03:18:33.836042 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240124 03:18:33.836071 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240124 03:18:33.836094 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240124 03:18:33.836122 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240124 03:18:33.836151 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240124 03:18:33.836180 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240124 03:18:33.836205 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240124 03:18:33.836237 56351 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240124 03:18:33.836263 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240124 03:18:33.836287 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240124 03:18:33.836455 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240124 03:18:33.836485 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240124 03:18:33.836510 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240124 03:18:33.836552 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240124 03:18:33.836582 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240124 03:18:33.836609 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240124 03:18:33.836633 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240124 03:18:33.836654 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240124 03:18:33.836680 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240124 03:18:33.836707 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240124 03:18:33.836732 56351 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240124 03:18:33.836751 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240124 03:18:33.836772 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240124 03:18:33.836839 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240124 03:18:33.836881 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240124 03:18:33.836903 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240124 03:18:33.836930 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240124 03:18:33.836956 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240124 03:18:33.836982 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240124 03:18:33.837008 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240124 03:18:33.837038 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240124 03:18:33.837059 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240124 03:18:33.837083 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240124 03:18:33.837105 56351 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240124 03:18:33.837121 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240124 03:18:33.837142 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240124 03:18:33.837189 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240124 03:18:33.837217 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240124 03:18:33.837240 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240124 03:18:33.837263 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240124 03:18:33.837286 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240124 03:18:33.837311 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240124 03:18:33.837335 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240124 03:18:33.837356 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240124 03:18:33.837386 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240124 03:18:33.837414 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240124 03:18:33.837438 56351 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240124 03:18:33.837456 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240124 03:18:33.837474 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240124 03:18:33.837518 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000 781.2 kB
W20240124 03:18:33.837546 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000 781.2 kB
W20240124 03:18:33.837567 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000 781.2 kB
W20240124 03:18:33.837597 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000 781.2 kB
W20240124 03:18:33.837618 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000 781.2 kB
W20240124 03:18:33.837642 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000 781.2 kB
W20240124 03:18:33.837669 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000 781.2 kB
W20240124 03:18:33.837692 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000 781.2 kB
W20240124 03:18:33.837714 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000 781.2 kB
W20240124 03:18:33.837738 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000 781.2 kB
W20240124 03:18:33.837765 56351 IPCTensor.h:365] NewIPCTensor: step_r4 [10]0x100002694000 80 B 
W20240124 03:18:33.837785 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000 8 B 
W20240124 03:18:33.837805 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000 8 B 
W20240124 03:18:33.837854 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000 781.2 kB
W20240124 03:18:33.837877 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000 781.2 kB
W20240124 03:18:33.837899 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000 781.2 kB
W20240124 03:18:33.837926 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000 781.2 kB
W20240124 03:18:33.837952 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000 781.2 kB
W20240124 03:18:33.837977 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000 781.2 kB
W20240124 03:18:33.838003 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000 781.2 kB
W20240124 03:18:33.838032 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000 781.2 kB
W20240124 03:18:33.838059 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000 781.2 kB
W20240124 03:18:33.838081 56351 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000 781.2 kB
W20240124 03:18:33.838101 56351 IPCTensor.h:365] NewIPCTensor: step_r5 [10]0x100002e4c000 80 B 
W20240124 03:18:33.838119 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000 8 B 
W20240124 03:18:33.838137 56351 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000 8 B 
W20240124 03:18:34.153780 56351 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100002e52000 128.2 GB
W20240124 03:18:34.153954 56351 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102011a8a000 328.3 MB
{0: Graph(num_nodes=16364881, num_edges=60475646,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22851247, num_edges=75085053,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16469571, num_edges=67497598,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17544490, num_edges=53244935,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=18090773, num_edges=55134734,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=20615225, num_edges=67664913,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16364881 N 60475646 E
MertisPartition: part 1 has 22851247 N 75085053 E
MertisPartition: part 2 has 16469571 N 67497598 E
MertisPartition: part 3 has 17544490 N 53244935 E
MertisPartition: part 4 has 18090773 N 55134734 E
MertisPartition: part 5 has 20615225 N 67664913 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,        6,  ..., 37713888,  7166588, 11887902]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
After renumbering graph:  {'_ID': tensor([ 4302861,  4302890,  4302907,  ...,  5617641, 54461443, 40090785]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 984.241 seconds
[Rank1] pid = 22426
[Rank2] pid = 22527
[Rank3] pid = 22660
[Rank4] pid = 22785
INFO [56351 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [22426 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [22527 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [22660 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [22870 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [22785 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [22660 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [22527 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [22870 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [22785 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [56351 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [22426 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
WARNING [22870 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [22785 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [56351 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [22426 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [22527 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [22660 DistTensor.py:56] The tensor name already exists in the kvstore
I20240124 03:21:44.815549 22682 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240124 03:21:44.815760 22871 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 03:21:44.815879 22427 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 03:21:44.815970 22528 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 03:21:44.816130 22934 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 03:21:44.816323 22786 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
I20240124 03:21:54.211755 22682 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240124 03:21:54.780812 22786 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 03:21:54.890935 22871 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 03:21:55.959830 22528 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 03:21:56.675604 22934 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 03:21:57.997433 22427 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.973 ms                  | 6.973 ms                  |
| bucket keys               | 1.270 ms                  | 125.035 ms                |
| forward: a2a keys         | 6.413 ms                  | 985.517 ms                |
| forward: search cache     | 231.633 us                | 18.715 ms                 |
| forward: a2a values       | 3.736 ms                  | 20.876 ms                 |
| forward: join             | 1.303 ms                  | 1.961 ms                  |
| Forward                   | 1.625 s                   | 1.625 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.411 ms                  | 64.036 ms                 |
| bucket keys               | 1.319 ms                  | 125.035 ms                |
| forward: a2a keys         | 2.924 ms                  | 985.517 ms                |
| forward: search cache     | 235.465 us                | 18.715 ms                 |
| forward: a2a values       | 12.943 ms                 | 31.775 ms                 |
| forward: join             | 1.303 ms                  | 2.251 ms                  |
| Forward                   | 34.728 ms                 | 1.625 s                   |
| back: aggr dram keys      | 37.844 ms                 | 627.329 ms                |
| back: set dram grad       | 1.542 ms                  | 20.507 ms                 |
| back: a2a grad            | 15.947 ms                 | 39.350 ms                 |
| back: grad sum & grad cache  | 3.544 ms                  | 87.449 ms                 |
| Backward                  | 173.790 ms                | 900.485 ms                |
| Optimize                  | 18.771 ms                 | 28.026 ms                 |
| BarrierTimeBeforeRank0    | 48.706 us                 | 79.785 us                 |
| BlockToStepN              | 14.948 us                 | 9.813 ms                  |
| OneStep                   | 238.087 ms                | 2.561 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.353 ms                  | 64.036 ms                 |
| bucket keys               | 1.275 ms                  | 4.774 ms                  |
| forward: a2a keys         | 2.289 ms                  | 41.603 ms                 |
| forward: search cache     | 232.326 us                | 363.431 us                |
| forward: a2a values       | 13.005 ms                 | 30.824 ms                 |
| forward: join             | 1.303 ms                  | 2.349 ms                  |
| Forward                   | 34.510 ms                 | 1.625 s                   |
| back: aggr dram keys      | 38.648 ms                 | 80.550 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.989 ms                  |
| back: a2a grad            | 15.735 ms                 | 36.412 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 61.813 ms                 |
| Backward                  | 169.472 ms                | 900.485 ms                |
| Optimize                  | 18.876 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 45.508 us                 | 79.785 us                 |
| BlockToStepN              | 27.119 us                 | 11.258 ms                 |
| OneStep                   | 237.591 ms                | 2.561 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.089 ms                  | 60.164 ms                 |
| bucket keys               | 1.278 ms                  | 5.469 ms                  |
| forward: a2a keys         | 2.137 ms                  | 41.603 ms                 |
| forward: search cache     | 238.123 us                | 422.804 us                |
| forward: a2a values       | 12.943 ms                 | 30.824 ms                 |
| forward: join             | 1.408 ms                  | 2.929 ms                  |
| Forward                   | 34.510 ms                 | 96.574 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 80.550 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.989 ms                  |
| back: a2a grad            | 15.735 ms                 | 36.412 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 61.813 ms                 |
| Backward                  | 160.878 ms                | 223.129 ms                |
| Optimize                  | 18.781 ms                 | 28.559 ms                 |
| BarrierTimeBeforeRank0    | 45.014 us                 | 79.785 us                 |
| BlockToStepN              | 26.109 us                 | 9.813 ms                  |
| OneStep                   | 228.635 ms                | 380.779 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.353 ms                  | 60.164 ms                 |
| bucket keys               | 1.280 ms                  | 4.774 ms                  |
| forward: a2a keys         | 2.160 ms                  | 35.251 ms                 |
| forward: search cache     | 239.139 us                | 386.448 us                |
| forward: a2a values       | 12.791 ms                 | 30.772 ms                 |
| forward: join             | 1.408 ms                  | 2.349 ms                  |
| Forward                   | 34.595 ms                 | 96.574 ms                 |
| back: aggr dram keys      | 37.844 ms                 | 78.640 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.903 ms                  |
| back: a2a grad            | 15.709 ms                 | 36.412 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 61.813 ms                 |
| Backward                  | 154.179 ms                | 223.129 ms                |
| Optimize                  | 18.774 ms                 | 28.559 ms                 |
| BarrierTimeBeforeRank0    | 41.257 us                 | 79.785 us                 |
| BlockToStepN              | 25.342 us                 | 9.813 ms                  |
| OneStep                   | 217.564 ms                | 380.779 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 25.838, sample: 0.738, forward: 5.880, backward: 11.104, update: 0.289
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 28.302, sample: 0.840, forward: 5.773, backward: 11.088, update: 0.307
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 26.554, sample: 0.768, forward: 5.836, backward: 11.115, update: 0.281
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 24.516, sample: 0.737, forward: 5.923, backward: 11.449, update: 0.263
[Rank5] pid = 22870
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 274415,  318655, 4341841,  196835,  196883,  196919, 7285470,  196956,
         196984,  197027]) tensor([ 4684971, 43884273, 46707177,  4584974, 62005054, 23154513, 43639499,
        16519873, 67544490,  6836988])
-------Step 1-------
tensor([ 274415,  318655, 4341841,  196835,  196883,  196919, 7285470,  196956,
         196984,  197027]) tensor([77476439, 47832739, 69863790, 43837512, 39981564, 22987307, 76766800,
         8907947, 19697852, 75422483])
-------Step 2-------
tensor([  262778,   262807,   262838,   262866,   262891, 75115803,   399707,
          262922,   262950,   262978]) tensor([32414618, 66126993, 35650817, 24848129, 12075176,  9705143, 80573779,
        50687085, 48906917,   142312])
-------Step 3-------
tensor([  262778,   262807,   262838,   262866,   262891, 75115803,   399707,
          262922,   262950,   262978]) tensor([75381333, 46497950, 33219065, 50317649, 49120103, 35719261, 29914560,
        12911476,  8816238, 58278710])
-------Step 4-------
tensor([  320941,   291338,   291364,   320962,   320994,   291402, 20441302,
          321015,   321050,  4537904]) tensor([75502662, 70445021, 16139043, 61374048, 83219292, 55933621, 64661911,
         9105853, 47690710, 26983826])
-------Step 5-------
tensor([  320941,   291338,   291364,   320962,   320994,   291402, 20441302,
          321015,   321050,  4537904]) tensor([39592831, 15254156, 10086130, 76461815,  1977586, 58745723, 20689286,
        16303967, 64924789, 66997721])
-------Step 6-------
tensor([  377511, 11640470,   377545,   377574,   377606,   299270, 20441302,
          377633, 14317227,   377665]) tensor([62004802, 15510091, 16919918, 37895099,  7288093,  3516579, 49400615,
         9140772, 26461406, 30828610])
-------Step 7-------
tensor([  377511, 11640470,   377545,   377574,   377606,   299270, 20441302,
          377633, 14317227,   377665]) tensor([47927746, 33702674, 36765771, 50162971, 49368129, 37572363, 39924063,
        22248168, 34488854, 41394448])
-------Step 8-------
tensor([72525916,   439529,    41504,   439558,   439602,   439634,   439665,
          439696,   439723,   380295]) tensor([  672572,   307299,  3127970, 46139963, 61881073, 67727715, 29918271,
        29840918, 79049840, 51260549])
-------Step 9-------
tensor([72525916,   439529,    41504,   439558,   439602,   439634,   439665,
          439696,   439723,   380295]) tensor([39806333, 16035867, 69972778, 25914568, 46342656,  6264703, 43866374,
        34180273, 58740311, 48923744])
before start barrier
start train
[proc 0] 100 steps, total: 27.622, sample: 0.890, forward: 5.337, backward: 16.224, update: 1.933
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 27.733, sample: 0.711, forward: 5.917, backward: 10.860, update: 0.248
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.972 ms                  | 60.164 ms                 |
| bucket keys               | 1.289 ms                  | 5.469 ms                  |
| forward: a2a keys         | 2.454 ms                  | 35.251 ms                 |
| forward: search cache     | 248.630 us                | 395.468 us                |
| forward: a2a values       | 11.536 ms                 | 30.772 ms                 |
| forward: join             | 1.408 ms                  | 2.349 ms                  |
| Forward                   | 34.728 ms                 | 96.574 ms                 |
| back: aggr dram keys      | 36.589 ms                 | 78.640 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.903 ms                  |
| back: a2a grad            | 15.428 ms                 | 36.412 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 76.512 ms                 |
| Backward                  | 149.735 ms                | 223.129 ms                |
| Optimize                  | 18.766 ms                 | 28.559 ms                 |
| BarrierTimeBeforeRank0    | 38.568 us                 | 79.785 us                 |
| BlockToStepN              | 28.865 us                 | 9.813 ms                  |
| OneStep                   | 214.221 ms                | 380.779 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.972 ms                  | 60.164 ms                 |
| bucket keys               | 1.360 ms                  | 4.774 ms                  |
| forward: a2a keys         | 2.416 ms                  | 34.110 ms                 |
| forward: search cache     | 252.305 us                | 395.468 us                |
| forward: a2a values       | 11.536 ms                 | 26.157 ms                 |
| forward: join             | 1.555 ms                  | 2.512 ms                  |
| Forward                   | 34.646 ms                 | 96.574 ms                 |
| back: aggr dram keys      | 36.589 ms                 | 74.908 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.728 ms                  |
| back: a2a grad            | 15.441 ms                 | 34.713 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 61.813 ms                 |
| Backward                  | 144.181 ms                | 223.129 ms                |
| Optimize                  | 18.759 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 37.427 us                 | 79.977 us                 |
| BlockToStepN              | 29.077 us                 | 14.077 ms                 |
| OneStep                   | 212.325 ms                | 380.779 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.137 ms                  | 59.230 ms                 |
| bucket keys               | 1.360 ms                  | 4.774 ms                  |
| forward: a2a keys         | 2.693 ms                  | 35.251 ms                 |
| forward: search cache     | 255.014 us                | 395.468 us                |
| forward: a2a values       | 11.536 ms                 | 26.157 ms                 |
| forward: join             | 1.555 ms                  | 2.512 ms                  |
| Forward                   | 34.892 ms                 | 78.899 ms                 |
| back: aggr dram keys      | 37.844 ms                 | 74.908 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.728 ms                  |
| back: a2a grad            | 15.017 ms                 | 34.713 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 61.813 ms                 |
| Backward                  | 142.640 ms                | 202.864 ms                |
| Optimize                  | 18.607 ms                 | 28.559 ms                 |
| BarrierTimeBeforeRank0    | 36.908 us                 | 79.785 us                 |
| BlockToStepN              | 28.793 us                 | 11.313 ms                 |
| OneStep                   | 208.287 ms                | 310.953 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.138 ms                  | 59.230 ms                 |
| bucket keys               | 1.360 ms                  | 2.432 ms                  |
| forward: a2a keys         | 2.790 ms                  | 34.110 ms                 |
| forward: search cache     | 253.426 us                | 386.448 us                |
| forward: a2a values       | 11.536 ms                 | 23.852 ms                 |
| forward: join             | 1.555 ms                  | 2.510 ms                  |
| Forward                   | 35.101 ms                 | 78.899 ms                 |
| back: aggr dram keys      | 37.844 ms                 | 69.607 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.720 ms                  |
| back: a2a grad            | 15.008 ms                 | 33.951 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 61.480 ms                 |
| Backward                  | 140.858 ms                | 202.864 ms                |
| Optimize                  | 18.564 ms                 | 30.294 ms                 |
| BarrierTimeBeforeRank0    | 36.295 us                 | 79.785 us                 |
| BlockToStepN              | 27.554 us                 | 11.313 ms                 |
| OneStep                   | 204.062 ms                | 310.953 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 200 steps, total: 20.623, sample: 0.817, forward: 4.328, backward: 9.929, update: 0.274
[proc 4] 200 steps, total: 20.623, sample: 0.684, forward: 4.474, backward: 9.689, update: 0.247
[proc 1] 200 steps, total: 20.623, sample: 0.857, forward: 4.314, backward: 10.260, update: 0.214
[proc 5] 200 steps, total: 20.623, sample: 0.745, forward: 4.400, backward: 9.899, update: 0.237
[proc 0] 200 steps, total: 20.623, sample: 0.917, forward: 3.875, backward: 13.783, update: 1.923
[proc 3] 200 steps, total: 20.623, sample: 1.027, forward: 4.111, backward: 9.896, update: 0.287
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.188 ms                  | 60.164 ms                 |
| bucket keys               | 1.361 ms                  | 2.432 ms                  |
| forward: a2a keys         | 2.709 ms                  | 34.110 ms                 |
| forward: search cache     | 252.360 us                | 391.866 us                |
| forward: a2a values       | 11.536 ms                 | 23.852 ms                 |
| forward: join             | 1.555 ms                  | 2.510 ms                  |
| Forward                   | 34.809 ms                 | 78.899 ms                 |
| back: aggr dram keys      | 38.648 ms                 | 69.607 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.720 ms                  |
| back: a2a grad            | 15.008 ms                 | 33.951 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 61.480 ms                 |
| Backward                  | 140.511 ms                | 202.864 ms                |
| Optimize                  | 18.558 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 36.112 us                 | 79.785 us                 |
| BlockToStepN              | 27.056 us                 | 11.313 ms                 |
| OneStep                   | 204.013 ms                | 310.953 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.334 ms                  | 73.074 ms                 |
| bucket keys               | 1.363 ms                  | 2.429 ms                  |
| forward: a2a keys         | 2.708 ms                  | 31.392 ms                 |
| forward: search cache     | 253.579 us                | 386.448 us                |
| forward: a2a values       | 11.536 ms                 | 20.890 ms                 |
| forward: join             | 1.555 ms                  | 2.483 ms                  |
| Forward                   | 34.795 ms                 | 78.899 ms                 |
| back: aggr dram keys      | 38.648 ms                 | 69.607 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.651 ms                  |
| back: a2a grad            | 15.027 ms                 | 33.901 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 60.611 ms                 |
| Backward                  | 139.666 ms                | 202.864 ms                |
| Optimize                  | 18.600 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 35.493 us                 | 79.785 us                 |
| BlockToStepN              | 27.661 us                 | 11.313 ms                 |
| OneStep                   | 203.972 ms                | 310.953 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.334 ms                  | 64.036 ms                 |
| bucket keys               | 1.363 ms                  | 2.432 ms                  |
| forward: a2a keys         | 2.728 ms                  | 31.392 ms                 |
| forward: search cache     | 253.581 us                | 391.866 us                |
| forward: a2a values       | 11.536 ms                 | 20.890 ms                 |
| forward: join             | 1.555 ms                  | 2.483 ms                  |
| Forward                   | 34.795 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 38.648 ms                 | 69.607 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.651 ms                  |
| back: a2a grad            | 15.027 ms                 | 33.951 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 60.611 ms                 |
| Backward                  | 138.973 ms                | 201.964 ms                |
| Optimize                  | 18.600 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 35.437 us                 | 72.155 us                 |
| BlockToStepN              | 27.661 us                 | 11.258 ms                 |
| OneStep                   | 203.160 ms                | 309.450 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.353 ms                  | 64.036 ms                 |
| bucket keys               | 1.363 ms                  | 2.429 ms                  |
| forward: a2a keys         | 2.750 ms                  | 29.735 ms                 |
| forward: search cache     | 254.258 us                | 387.285 us                |
| forward: a2a values       | 11.536 ms                 | 20.876 ms                 |
| forward: join             | 1.555 ms                  | 2.458 ms                  |
| Forward                   | 34.813 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 68.440 ms                 |
| back: set dram grad       | 2.557 ms                  | 7.651 ms                  |
| back: a2a grad            | 14.749 ms                 | 33.901 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 58.865 ms                 |
| Backward                  | 137.570 ms                | 201.964 ms                |
| Optimize                  | 18.612 ms                 | 34.894 ms                 |
| BarrierTimeBeforeRank0    | 35.338 us                 | 72.155 us                 |
| BlockToStepN              | 27.466 us                 | 11.258 ms                 |
| OneStep                   | 202.072 ms                | 309.450 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 5] 300 steps, total: 20.112, sample: 0.631, forward: 4.354, backward: 9.713, update: 0.236
[proc 3] 300 steps, total: 20.112, sample: 0.739, forward: 4.306, backward: 9.628, update: 0.275
[proc 1] 300 steps, total: 20.112, sample: 0.733, forward: 4.268, backward: 10.082, update: 0.210
[proc 0] 300 steps, total: 20.112, sample: 0.942, forward: 3.710, backward: 13.443, update: 1.912
[proc 2] 300 steps, total: 20.112, sample: 0.696, forward: 4.264, backward: 9.803, update: 0.258
[proc 4] 300 steps, total: 20.112, sample: 0.699, forward: 4.289, backward: 9.546, update: 0.266
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.453 ms                  | 64.036 ms                 |
| bucket keys               | 1.363 ms                  | 2.438 ms                  |
| forward: a2a keys         | 2.728 ms                  | 29.735 ms                 |
| forward: search cache     | 255.317 us                | 387.285 us                |
| forward: a2a values       | 11.536 ms                 | 20.876 ms                 |
| forward: join             | 1.555 ms                  | 2.458 ms                  |
| Forward                   | 34.801 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 38.648 ms                 | 68.440 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.651 ms                  |
| back: a2a grad            | 14.697 ms                 | 33.901 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 58.865 ms                 |
| Backward                  | 136.662 ms                | 201.964 ms                |
| Optimize                  | 18.637 ms                 | 34.894 ms                 |
| BarrierTimeBeforeRank0    | 35.411 us                 | 72.155 us                 |
| BlockToStepN              | 27.431 us                 | 11.258 ms                 |
| OneStep                   | 199.913 ms                | 309.450 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.453 ms                  | 64.036 ms                 |
| bucket keys               | 1.361 ms                  | 2.438 ms                  |
| forward: a2a keys         | 2.721 ms                  | 28.622 ms                 |
| forward: search cache     | 255.475 us                | 386.448 us                |
| forward: a2a values       | 11.549 ms                 | 20.876 ms                 |
| forward: join             | 1.555 ms                  | 2.423 ms                  |
| Forward                   | 34.658 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 68.346 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.641 ms                  |
| back: a2a grad            | 14.629 ms                 | 33.281 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 58.445 ms                 |
| Backward                  | 136.260 ms                | 201.964 ms                |
| Optimize                  | 18.642 ms                 | 34.894 ms                 |
| BarrierTimeBeforeRank0    | 35.408 us                 | 72.155 us                 |
| BlockToStepN              | 27.431 us                 | 11.313 ms                 |
| OneStep                   | 199.666 ms                | 309.450 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.496 ms                  | 60.989 ms                 |
| bucket keys               | 1.368 ms                  | 2.447 ms                  |
| forward: a2a keys         | 2.689 ms                  | 28.622 ms                 |
| forward: search cache     | 256.368 us                | 387.285 us                |
| forward: a2a values       | 11.559 ms                 | 21.497 ms                 |
| forward: join             | 1.555 ms                  | 2.423 ms                  |
| Forward                   | 34.652 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 69.607 ms                 |
| back: set dram grad       | 1.980 ms                  | 7.641 ms                  |
| back: a2a grad            | 14.626 ms                 | 33.901 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 58.445 ms                 |
| Backward                  | 136.127 ms                | 201.154 ms                |
| Optimize                  | 18.680 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 35.411 us                 | 69.752 us                 |
| BlockToStepN              | 27.407 us                 | 11.258 ms                 |
| OneStep                   | 199.583 ms                | 308.771 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.498 ms                  | 60.989 ms                 |
| bucket keys               | 1.406 ms                  | 2.863 ms                  |
| forward: a2a keys         | 2.690 ms                  | 27.357 ms                 |
| forward: search cache     | 258.107 us                | 391.866 us                |
| forward: a2a values       | 11.559 ms                 | 21.497 ms                 |
| forward: join             | 1.555 ms                  | 2.483 ms                  |
| Forward                   | 34.801 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 69.607 ms                 |
| back: set dram grad       | 2.547 ms                  | 7.575 ms                  |
| back: a2a grad            | 14.626 ms                 | 33.281 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 57.965 ms                 |
| Backward                  | 135.253 ms                | 201.154 ms                |
| Optimize                  | 18.686 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 35.643 us                 | 69.752 us                 |
| BlockToStepN              | 26.192 us                 | 11.258 ms                 |
| OneStep                   | 198.852 ms                | 308.771 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 20.049, sample: 0.587, forward: 4.233, backward: 9.867, update: 0.264
[proc 5] 400 steps, total: 20.050, sample: 0.606, forward: 4.232, backward: 9.784, update: 0.284
[proc 3] 400 steps, total: 20.050, sample: 0.674, forward: 4.194, backward: 9.723, update: 0.250
[proc 4] 400 steps, total: 20.049, sample: 0.691, forward: 4.180, backward: 9.558, update: 0.274
[proc 1] 400 steps, total: 20.050, sample: 0.706, forward: 4.142, backward: 10.130, update: 0.226
[proc 0] 400 steps, total: 20.049, sample: 0.856, forward: 3.732, backward: 13.420, update: 1.894
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.545 ms                  | 62.518 ms                 |
| bucket keys               | 1.422 ms                  | 2.922 ms                  |
| forward: a2a keys         | 2.611 ms                  | 27.357 ms                 |
| forward: search cache     | 259.702 us                | 395.468 us                |
| forward: a2a values       | 11.543 ms                 | 21.497 ms                 |
| forward: join             | 1.824 ms                  | 2.512 ms                  |
| Forward                   | 34.734 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 69.607 ms                 |
| back: set dram grad       | 2.547 ms                  | 7.575 ms                  |
| back: a2a grad            | 14.588 ms                 | 33.281 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 57.965 ms                 |
| Backward                  | 134.800 ms                | 201.154 ms                |
| Optimize                  | 18.746 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 35.867 us                 | 76.908 us                 |
| BlockToStepN              | 25.342 us                 | 11.258 ms                 |
| OneStep                   | 197.991 ms                | 308.771 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.569 ms                  | 62.518 ms                 |
| bucket keys               | 1.419 ms                  | 2.899 ms                  |
| forward: a2a keys         | 2.555 ms                  | 27.041 ms                 |
| forward: search cache     | 259.476 us                | 392.762 us                |
| forward: a2a values       | 11.486 ms                 | 21.497 ms                 |
| forward: join             | 1.824 ms                  | 2.510 ms                  |
| Forward                   | 34.646 ms                 | 73.003 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 68.440 ms                 |
| back: set dram grad       | 2.547 ms                  | 7.432 ms                  |
| back: a2a grad            | 14.588 ms                 | 30.177 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 57.359 ms                 |
| Backward                  | 134.152 ms                | 201.154 ms                |
| Optimize                  | 18.689 ms                 | 31.448 ms                 |
| BarrierTimeBeforeRank0    | 35.957 us                 | 76.908 us                 |
| BlockToStepN              | 23.840 us                 | 11.258 ms                 |
| OneStep                   | 197.369 ms                | 308.771 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.453 ms                  | 60.989 ms                 |
| bucket keys               | 1.435 ms                  | 2.899 ms                  |
| forward: a2a keys         | 2.469 ms                  | 27.041 ms                 |
| forward: search cache     | 260.434 us                | 395.468 us                |
| forward: a2a values       | 11.486 ms                 | 21.497 ms                 |
| forward: join             | 1.824 ms                  | 2.510 ms                  |
| Forward                   | 34.595 ms                 | 71.033 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 68.440 ms                 |
| back: set dram grad       | 2.570 ms                  | 7.651 ms                  |
| back: a2a grad            | 14.588 ms                 | 30.177 ms                 |
| back: grad sum & grad cache  | 4.934 ms                  | 57.359 ms                 |
| Backward                  | 134.152 ms                | 196.618 ms                |
| Optimize                  | 18.689 ms                 | 31.285 ms                 |
| BarrierTimeBeforeRank0    | 36.155 us                 | 73.146 us                 |
| BlockToStepN              | 23.625 us                 | 11.092 ms                 |
| OneStep                   | 197.086 ms                | 285.502 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.496 ms                  | 60.989 ms                 |
| bucket keys               | 1.456 ms                  | 2.897 ms                  |
| forward: a2a keys         | 2.416 ms                  | 26.362 ms                 |
| forward: search cache     | 263.180 us                | 395.361 us                |
| forward: a2a values       | 11.487 ms                 | 20.890 ms                 |
| forward: join             | 1.824 ms                  | 2.512 ms                  |
| Forward                   | 34.543 ms                 | 71.033 ms                 |
| back: aggr dram keys      | 40.144 ms                 | 68.346 ms                 |
| back: set dram grad       | 2.570 ms                  | 7.641 ms                  |
| back: a2a grad            | 14.588 ms                 | 33.281 ms                 |
| back: grad sum & grad cache  | 7.459 ms                  | 56.410 ms                 |
| Backward                  | 134.064 ms                | 196.618 ms                |
| Optimize                  | 18.698 ms                 | 31.285 ms                 |
| BarrierTimeBeforeRank0    | 36.295 us                 | 76.908 us                 |
| BlockToStepN              | 22.541 us                 | 11.092 ms                 |
| OneStep                   | 196.976 ms                | 285.502 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 500 steps, total: 19.508, sample: 0.592, forward: 3.900, backward: 9.540, update: 0.249
[proc 3] 500 steps, total: 19.508, sample: 0.641, forward: 3.835, backward: 9.674, update: 0.287
[proc 2] 500 steps, total: 19.508, sample: 0.532, forward: 3.939, backward: 9.749, update: 0.278
[proc 5] 500 steps, total: 19.508, sample: 0.621, forward: 3.855, backward: 9.722, update: 0.286
[proc 1] 500 steps, total: 19.508, sample: 0.616, forward: 3.871, backward: 10.047, update: 0.254
[proc 0] 500 steps, total: 19.508, sample: 0.813, forward: 3.442, backward: 13.278, update: 1.859
Successfully xmh. training takes 107.91580533981323 seconds
before call kg_cache_controller.StopThreads()
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
INFO [56351 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.496 ms                  | 60.989 ms                 |
| bucket keys               | 1.460 ms                  | 2.897 ms                  |
| forward: a2a keys         | 2.394 ms                  | 26.362 ms                 |
| forward: search cache     | 265.976 us                | 397.160 us                |
| forward: a2a values       | 11.492 ms                 | 20.890 ms                 |
| forward: join             | 1.824 ms                  | 2.512 ms                  |
| Forward                   | 34.460 ms                 | 71.033 ms                 |
| back: aggr dram keys      | 42.613 ms                 | 68.346 ms                 |
| back: set dram grad       | 2.572 ms                  | 7.641 ms                  |
| back: a2a grad            | 14.574 ms                 | 33.281 ms                 |
| back: grad sum & grad cache  | 7.459 ms                  | 56.410 ms                 |
| Backward                  | 133.942 ms                | 196.618 ms                |
| Optimize                  | 18.698 ms                 | 31.285 ms                 |
| BarrierTimeBeforeRank0    | 36.451 us                 | 76.908 us                 |
| BlockToStepN              | 21.614 us                 | 11.092 ms                 |
| OneStep                   | 196.704 ms                | 285.502 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

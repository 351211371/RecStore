WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 02:11:01.073952  3048 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_47', no_save_emb=True, max_step=500, batch_size=400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [3048 sampler.py:454] Start PreSampling
WARNING [3048 sampler.py:532] Before construct renumbering_dict
WARNING [3048 sampler.py:555] PreSampling done
W20240123 02:11:06.075860  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240123 02:11:06.076051  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240123 02:11:06.076093  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240123 02:11:06.076131  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240123 02:11:06.076156  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240123 02:11:06.076184  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240123 02:11:06.076208  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240123 02:11:06.076248  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240123 02:11:06.076273  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240123 02:11:06.076303  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240123 02:11:06.076337  3048 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240123 02:11:06.076360  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240123 02:11:06.076385  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240123 02:11:06.076529  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240123 02:11:06.076562  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240123 02:11:06.076587  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240123 02:11:06.076610  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240123 02:11:06.076634  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240123 02:11:06.076680  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240123 02:11:06.076704  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240123 02:11:06.076731  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240123 02:11:06.076763  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240123 02:11:06.076792  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240123 02:11:06.076824  3048 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240123 02:11:06.076843  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240123 02:11:06.076862  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240123 02:11:06.076917  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240123 02:11:06.076946  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240123 02:11:06.076967  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240123 02:11:06.077001  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240123 02:11:06.077025  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240123 02:11:06.077045  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240123 02:11:06.077072  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240123 02:11:06.077104  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240123 02:11:06.077131  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240123 02:11:06.077159  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240123 02:11:06.077186  3048 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240123 02:11:06.077203  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240123 02:11:06.077224  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240123 02:11:06.077272  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240123 02:11:06.077301  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240123 02:11:06.077327  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240123 02:11:06.077347  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240123 02:11:06.077370  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240123 02:11:06.077391  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240123 02:11:06.077417  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240123 02:11:06.077447  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240123 02:11:06.077472  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240123 02:11:06.077499  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240123 02:11:06.077519  3048 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240123 02:11:06.077538  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240123 02:11:06.077554  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240123 02:11:06.077605  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000
W20240123 02:11:06.077627  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000
W20240123 02:11:06.077651  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000
W20240123 02:11:06.077683  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000
W20240123 02:11:06.077718  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000
W20240123 02:11:06.077754  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000
W20240123 02:11:06.077775  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000
W20240123 02:11:06.077803  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000
W20240123 02:11:06.077826  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000
W20240123 02:11:06.077853  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000
W20240123 02:11:06.077874  3048 IPCTensor.h:367] NewIPCTensor: step_r4 [10]0x100002694000
W20240123 02:11:06.077893  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000
W20240123 02:11:06.077912  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000
W20240123 02:11:06.077960  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000
W20240123 02:11:06.077984  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000
W20240123 02:11:06.078009  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000
W20240123 02:11:06.078029  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000
W20240123 02:11:06.078068  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000
W20240123 02:11:06.078099  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000
W20240123 02:11:06.078120  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000
W20240123 02:11:06.078145  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000
W20240123 02:11:06.078166  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000
W20240123 02:11:06.078186  3048 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000
W20240123 02:11:06.078215  3048 IPCTensor.h:367] NewIPCTensor: step_r5 [10]0x100002e4c000
W20240123 02:11:06.078233  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000
W20240123 02:11:06.078253  3048 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000
W20240123 02:11:06.308678  3048 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100002e52000
W20240123 02:11:06.308913  3048 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100004524000
{0: Graph(num_nodes=9651, num_edges=125221,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10501, num_edges=116771,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=7364, num_edges=103565,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=9587, num_edges=131823,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=8718, num_edges=169929,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=9639, num_edges=154972,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9651 N 125221 E
MertisPartition: part 1 has 10501 N 116771 E
MertisPartition: part 2 has 7364 N 103565 E
MertisPartition: part 3 has 9587 N 131823 E
MertisPartition: part 4 has 8718 N 169929 E
MertisPartition: part 5 has 9639 N 154972 E
Rank0: cached key size 124
Rank1: cached key size 124
Rank2: cached key size 124
Rank3: cached key size 124
Rank4: cached key size 124
Rank5: cached key size 124
Before renumbering graph:  {'_ID': tensor([    7,    16,    24,  ..., 10345,  3788,  5916]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
After renumbering graph:  {'_ID': tensor([ 983, 1272, 1529,  ..., 2838, 2989, 6965]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.271 seconds
[Rank1] pid = 3480
[Rank2] pid = 3545
[Rank3] pid = 3604
[Rank4] pid = 3613
INFO [3048 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3480 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3545 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [3604 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [3480 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [3545 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [3604 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [3613 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [3681 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [3613 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [3681 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [3048 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
WARNING [3604 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [3545 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [3480 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [3613 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [3681 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [3048 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 02:11:09.396405  3744 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240123 02:11:09.396525  3614 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:09.396625  3481 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:09.396735  3813 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:09.396890  3546 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:09.396999  3615 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:11:10.142402  3481 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240123 02:11:10.142710  3546 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:10.146219  3615 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:10.148792  3813 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:10.154327  3614 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:11:10.159519  3744 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.498 ms                  | 14.800 ms                 |
| Forward                   | 6.864 ms                  | 11.471 ms                 |
| Backward                  | 23.488 ms                 | 42.387 ms                 |
| Optimize                  | 1.458 ms                  | 2.441 ms                  |
| BarrierTimeBeforeRank0    | 2.379 ms                  | 13.898 ms                 |
| BlockToStepN              | 26.790 us                 | 464.874 us                |
| OneStep                   | 36.536 ms                 | 69.166 ms                 |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 4.667, sample: 0.302, forward: 1.173, backward: 2.671, update: 0.134
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 4.673, sample: 0.310, forward: 1.191, backward: 2.595, update: 0.141
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 4.675, sample: 0.281, forward: 1.065, backward: 2.673, update: 0.135
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 4.679, sample: 0.284, forward: 1.054, backward: 2.598, update: 0.128
[Rank5] pid = 3681
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482)]
train_sampler.Prefill()
-------Step 0-------
tensor([    1,  5561, 12864,   861, 12259,  5193,    93,  5137, 12191,  3291]) tensor([ 1529,    35,  5464, 10927,    56, 12578,  8062, 14927,  1287, 10577])
-------Step 1-------
tensor([    1,  5561, 12864,   861, 12259,  5193,    93,  5137, 12191,  3291]) tensor([10095, 11892,  2033,  6800, 11708,  6155, 12682, 10778,  8656, 11625])
-------Step 2-------
tensor([ 4973,    74,  9435,  9995, 14423,     0,  4759,  5125,  7393, 12581]) tensor([12264,    86,  2777,  3037,  1582,   321,  4988,  1923, 14716,  9833])
-------Step 3-------
tensor([ 4973,    74,  9435,  9995, 14423,     0,  4759,  5125,  7393, 12581]) tensor([ 1144,  2424, 10097,  7896,  3458,  5597,  7984, 11192, 12557,  9227])
-------Step 4-------
tensor([11532, 11232, 12549,  4860, 10809,  2621,  8605, 10444, 13265, 12829]) tensor([ 3289,  3404,  5923, 14483,  3867, 13876, 11214,  9593,  9263,  3091])
-------Step 5-------
tensor([11532, 11232, 12549,  4860, 10809,  2621,  8605, 10444, 13265, 12829]) tensor([ 3378,  2969,  2444,  1303,  9978, 12327,  7990, 11755, 13847,  4591])
-------Step 6-------
tensor([13803,     0,    39,    23, 12520,  4083, 13131,  6337,  5781,  3556]) tensor([ 5180,  3487,  1106,  8823,  5894,  9783, 12010, 11033,  7561, 11536])
-------Step 7-------
tensor([13803,     0,    39,    23, 12520,  4083, 13131,  6337,  5781,  3556]) tensor([9375, 5050, 7427, 8629, 1480, 4851, 5693, 2504, 3121, 2555])
-------Step 8-------
tensor([ 2162, 12259, 14810, 12771, 10853, 12520,     0,   122, 13111, 14623]) tensor([ 6461,  2801,   411, 11811, 13875,  3810, 14435,  5891, 14041, 11243])
-------Step 9-------
tensor([ 2162, 12259, 14810, 12771, 10853, 12520,     0,   122, 13111, 14623]) tensor([ 7160,  2102,  3892,  2230, 10675,  3352,  6343,  9554, 10982,  2465])
before start barrier
start train
[proc 0] 100 steps, total: 4.662, sample: 0.317, forward: 1.220, backward: 2.589, update: 0.134
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 4.679, sample: 0.297, forward: 1.084, backward: 2.546, update: 0.135
[proc 1] 200 steps, total: 3.755, sample: 0.281, forward: 0.543, backward: 2.304, update: 0.124
[proc 3] 200 steps, total: 3.755, sample: 0.322, forward: 0.602, backward: 2.377, update: 0.132
[proc 5] 200 steps, total: 3.755, sample: 0.318, forward: 0.660, backward: 2.354, update: 0.138
[proc 0] 200 steps, total: 3.755, sample: 0.318, forward: 0.650, backward: 2.361, update: 0.130
[proc 4] 200 steps, total: 3.755, sample: 0.316, forward: 0.588, backward: 2.422, update: 0.129
[proc 2] 200 steps, total: 3.755, sample: 0.305, forward: 0.532, backward: 2.259, update: 0.130
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.491 ms                  | 15.189 ms                 |
| Forward                   | 6.878 ms                  | 11.471 ms                 |
| Backward                  | 23.398 ms                 | 38.121 ms                 |
| Optimize                  | 1.465 ms                  | 2.530 ms                  |
| BarrierTimeBeforeRank0    | 1.792 ms                  | 13.792 ms                 |
| BlockToStepN              | 26.216 us                 | 181.053 us                |
| OneStep                   | 35.755 ms                 | 61.880 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 5] 300 steps, total: 3.726, sample: 0.294, forward: 0.650, backward: 2.364, update: 0.137
[proc 2] 300 steps, total: 3.726, sample: 0.265, forward: 0.515, backward: 2.223, update: 0.127
[proc 0] 300 steps, total: 3.726, sample: 0.290, forward: 0.646, backward: 2.327, update: 0.130
[proc 4] 300 steps, total: 3.726, sample: 0.289, forward: 0.603, backward: 2.441, update: 0.131
[proc 1] 300 steps, total: 3.726, sample: 0.286, forward: 0.546, backward: 2.307, update: 0.126
[proc 3] 300 steps, total: 3.726, sample: 0.294, forward: 0.595, backward: 2.377, update: 0.130
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.486 ms                  | 15.321 ms                 |
| Forward                   | 6.872 ms                  | 11.471 ms                 |
| Backward                  | 23.616 ms                 | 40.368 ms                 |
| Optimize                  | 1.471 ms                  | 2.602 ms                  |
| BarrierTimeBeforeRank0    | 1.612 ms                  | 13.202 ms                 |
| BlockToStepN              | 26.001 us                 | 181.053 us                |
| OneStep                   | 35.951 ms                 | 61.384 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 1] 400 steps, total: 4.461, sample: 0.198, forward: 0.425, backward: 2.449, update: 0.107
[proc 3] 400 steps, total: 4.461, sample: 0.214, forward: 0.458, backward: 2.489, update: 0.112
[proc 4] 400 steps, total: 4.461, sample: 0.233, forward: 0.480, backward: 2.614, update: 0.118
[proc 2] 400 steps, total: 4.461, sample: 0.160, forward: 0.354, backward: 2.286, update: 0.106
[proc 0] 400 steps, total: 4.461, sample: 0.308, forward: 0.670, backward: 3.213, update: 0.140
[proc 5] 400 steps, total: 4.461, sample: 0.242, forward: 0.511, backward: 2.464, update: 0.123
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.485 ms                  | 15.189 ms                 |
| Forward                   | 6.859 ms                  | 9.461 ms                  |
| Backward                  | 24.524 ms                 | 40.431 ms                 |
| Optimize                  | 1.457 ms                  | 2.530 ms                  |
| BarrierTimeBeforeRank0    | 1.454 ms                  | 14.996 ms                 |
| BlockToStepN              | 25.188 us                 | 105.822 us                |
| OneStep                   | 38.042 ms                 | 61.966 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 5] 500 steps, total: 4.801, sample: 0.176, forward: 0.429, backward: 2.468, update: 0.101
[proc 1] 500 steps, total: 4.801, sample: 0.148, forward: 0.361, backward: 2.382, update: 0.095
[proc 0] 500 steps, total: 4.801, sample: 0.233, forward: 0.537, backward: 2.639, update: 0.118
[proc 3] 500 steps, total: 4.801, sample: 0.233, forward: 0.478, backward: 2.784, update: 0.118
[proc 4] 500 steps, total: 4.801, sample: 0.275, forward: 0.591, backward: 3.379, update: 0.129
[proc 2] 500 steps, total: 4.801, sample: 0.174, forward: 0.379, backward: 2.312, update: 0.108
Successfully xmh. training takes 21.406254053115845 seconds
before call kg_cache_controller.StopThreads()
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
INFO [3048 controller_process.py:380] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

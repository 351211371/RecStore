WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240124 04:03:39.344383 33629 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_54', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [33629 sampler.py:454] Start PreSampling
WARNING [33629 sampler.py:532] Before construct renumbering_dict
WARNING [33629 sampler.py:555] PreSampling done
W20240124 04:17:07.745330 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240124 04:17:07.745568 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240124 04:17:07.745611 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240124 04:17:07.745640 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240124 04:17:07.745679 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240124 04:17:07.745721 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240124 04:17:07.745759 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240124 04:17:07.745807 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240124 04:17:07.745846 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240124 04:17:07.745878 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240124 04:17:07.745918 33629 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240124 04:17:07.745950 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240124 04:17:07.745975 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240124 04:17:07.746157 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240124 04:17:07.746198 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240124 04:17:07.746227 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240124 04:17:07.746299 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240124 04:17:07.746330 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240124 04:17:07.746374 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240124 04:17:07.746416 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240124 04:17:07.746454 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240124 04:17:07.746495 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240124 04:17:07.746527 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240124 04:17:07.746560 33629 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240124 04:17:07.746585 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240124 04:17:07.746611 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240124 04:17:07.746690 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240124 04:17:07.746730 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240124 04:17:07.746767 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240124 04:17:07.746796 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240124 04:17:07.746830 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240124 04:17:07.746867 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240124 04:17:07.746901 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240124 04:17:07.746934 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240124 04:17:07.746964 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240124 04:17:07.746997 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240124 04:17:07.747025 33629 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240124 04:17:07.747048 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240124 04:17:07.747079 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240124 04:17:07.747150 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240124 04:17:07.747193 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240124 04:17:07.747224 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240124 04:17:07.747256 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240124 04:17:07.747298 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240124 04:17:07.747337 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240124 04:17:07.747368 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240124 04:17:07.747401 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240124 04:17:07.747438 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240124 04:17:07.747478 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240124 04:17:07.747512 33629 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240124 04:17:07.747535 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240124 04:17:07.747562 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240124 04:17:07.747629 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000 781.2 kB
W20240124 04:17:07.747673 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000 781.2 kB
W20240124 04:17:07.747705 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000 781.2 kB
W20240124 04:17:07.747732 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000 781.2 kB
W20240124 04:17:07.747768 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000 781.2 kB
W20240124 04:17:07.747799 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000 781.2 kB
W20240124 04:17:07.747830 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000 781.2 kB
W20240124 04:17:07.747869 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000 781.2 kB
W20240124 04:17:07.747901 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000 781.2 kB
W20240124 04:17:07.747932 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000 781.2 kB
W20240124 04:17:07.747963 33629 IPCTensor.h:365] NewIPCTensor: step_r4 [10]0x100002694000 80 B 
W20240124 04:17:07.747987 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000 8 B 
W20240124 04:17:07.748010 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000 8 B 
W20240124 04:17:07.748071 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000 781.2 kB
W20240124 04:17:07.748107 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000 781.2 kB
W20240124 04:17:07.748143 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000 781.2 kB
W20240124 04:17:07.748183 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000 781.2 kB
W20240124 04:17:07.748215 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000 781.2 kB
W20240124 04:17:07.748247 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000 781.2 kB
W20240124 04:17:07.748277 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000 781.2 kB
W20240124 04:17:07.748311 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000 781.2 kB
W20240124 04:17:07.748338 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000 781.2 kB
W20240124 04:17:07.748373 33629 IPCTensor.h:365] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000 781.2 kB
W20240124 04:17:07.748399 33629 IPCTensor.h:365] NewIPCTensor: step_r5 [10]0x100002e4c000 80 B 
W20240124 04:17:07.748422 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000 8 B 
W20240124 04:17:07.748445 33629 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000 8 B 
W20240124 04:17:08.066427 33629 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100002e52000 128.2 GB
W20240124 04:17:08.066627 33629 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102011a8a000 328.3 MB
{0: Graph(num_nodes=16364881, num_edges=60475646,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22851247, num_edges=75085053,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16469571, num_edges=67497598,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17544490, num_edges=53244935,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=18090773, num_edges=55134734,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=20615225, num_edges=67664913,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16364881 N 60475646 E
MertisPartition: part 1 has 22851247 N 75085053 E
MertisPartition: part 2 has 16469571 N 67497598 E
MertisPartition: part 3 has 17544490 N 53244935 E
MertisPartition: part 4 has 18090773 N 55134734 E
MertisPartition: part 5 has 20615225 N 67664913 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,        6,  ..., 37713888,  7166588, 11887902]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
After renumbering graph:  {'_ID': tensor([ 4302851,  4302885,  4302926,  ...,  7000821, 47451393, 32982261]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 1])}
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16364881, num_edges=60475646,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 985.193 seconds
[Rank1] pid = 58816
[Rank2] pid = 58914
[Rank3] pid = 58996
[Rank4] pid = 59081
INFO [33629 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [58816 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [58914 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [58996 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [59163 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [59081 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [58914 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [59163 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [58996 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [59081 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [33629 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [58816 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
WARNING [58996 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [33629 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [59163 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [58914 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [59081 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [58816 DistTensor.py:56] The tensor name already exists in the kvstore
I20240124 04:20:10.862763 58817 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240124 04:20:10.862903 58915 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 04:20:10.863045 59082 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 04:20:10.863171 58997 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 04:20:10.863298 59164 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240124 04:20:10.863411 59170 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
I20240124 04:20:20.072299 59082 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240124 04:20:20.093829 58997 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 04:20:21.192946 59170 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 04:20:22.229399 59164 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 04:20:22.262907 58915 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240124 04:20:24.116546 58817 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.898 ms                  | 22.612 ms                 |
| Forward                   | 9.157 ms                  | 627.231 ms                |
| Backward                  | 105.761 ms                | 294.903 ms                |
| Optimize                  | 1.988 ms                  | 2.043 ms                  |
| BarrierTimeBeforeRank0    | 29.838 ms                 | 39.764 ms                 |
| BlockToStepN              | 27.583 us                 | 319.757 us                |
| OneStep                   | 168.103 ms                | 969.302 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.574 ms                  | 88.979 ms                 |
| Forward                   | 8.931 ms                  | 627.231 ms                |
| Backward                  | 103.684 ms                | 294.903 ms                |
| Optimize                  | 1.983 ms                  | 2.896 ms                  |
| BarrierTimeBeforeRank0    | 35.287 ms                 | 128.085 ms                |
| BlockToStepN              | 24.454 us                 | 4.127 ms                  |
| OneStep                   | 156.060 ms                | 969.302 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.439 ms                  | 82.327 ms                 |
| Forward                   | 8.907 ms                  | 11.134 ms                 |
| Backward                  | 103.684 ms                | 290.060 ms                |
| Optimize                  | 1.955 ms                  | 2.717 ms                  |
| BarrierTimeBeforeRank0    | 28.291 ms                 | 194.967 ms                |
| BlockToStepN              | 25.828 us                 | 2.897 ms                  |
| OneStep                   | 149.393 ms                | 320.815 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.650 ms                  | 82.327 ms                 |
| Forward                   | 8.947 ms                  | 11.134 ms                 |
| Backward                  | 103.896 ms                | 290.060 ms                |
| Optimize                  | 1.960 ms                  | 2.717 ms                  |
| BarrierTimeBeforeRank0    | 28.225 ms                 | 209.274 ms                |
| BlockToStepN              | 25.828 us                 | 6.596 ms                  |
| OneStep                   | 147.993 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 21.108, sample: 0.962, forward: 2.364, backward: 11.379, update: 0.258
[Rank5] pid = 59163
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242)]
train_sampler.Prefill()
-------Step 0-------
tensor([    2799,   243276,  4376706,   686550,   686568, 74929165,  9150038,
          686582,   686598,   686612]) tensor([ 5108138, 52900875, 48335636,  4570106, 76857255, 29787885, 56054702,
        19734705, 79623638,  8942669])
-------Step 1-------
tensor([    2799,   243276,  4376706,   686550,   686568, 74929165,  9150038,
          686582,   686598,   686612]) tensor([50788862, 18885340, 10534458, 83324170,  1723219, 58040867, 26882146,
        20758437, 78357696, 59268127])
-------Step 2-------
tensor([  265995,  4548697,   403897,    50992, 81474396,    51023,    51049,
           51108,    51146, 34661693]) tensor([30207927, 17009535, 16675554,   554105,   296798, 42883200, 13893161,
         7364419, 17937798, 43136293])
-------Step 3-------
tensor([  265995,  4548697,   403897,    50992, 81474396,    51023,    51049,
           51108,    51146, 34661693]) tensor([74577222, 82710141, 10410019, 69290504, 41938970, 57281627, 64510271,
          284226,  2033704, 57405438])
-------Step 4-------
tensor([4316092,  109298,   22295,  109323,  109342,  109379,  109403, 4628594,
         109422,  288435]) tensor([17865594, 24997278, 51164202, 73842735, 74534025, 22636942,   639412,
        85048351, 83396126,  7340547])
-------Step 5-------
tensor([4316092,  109298,   22295,  109323,  109342,  109379,  109403, 4628594,
         109422,  288435]) tensor([63642738, 77102946,   634095, 24595729, 27720827,   214922, 15778478,
        73724862, 59099615, 66406015])
-------Step 6-------
tensor([  174268,   174292,   174309,   174328,   174350,   174367, 54776647,
           31915,   174403,  4596948]) tensor([64844526, 44830380, 46405583, 60814824, 23580672,  6889144, 80862061,
        30059482, 30075840, 84842308])
-------Step 7-------
tensor([  174268,   174292,   174309,   174328,   174350,   174367, 54776647,
           31915,   174403,  4596948]) tensor([11279858, 54115193, 83752481, 51093304, 75902126,  1818147, 76704394,
        33654702, 22076330,   618921])
-------Step 8-------
tensor([  231010, 15791812,   231030,   231047,   231068, 25931676,    41353,
          231088,   231113, 51368346]) tensor([20528775, 36984321, 81664604, 21199366, 32218434, 38911834, 49380070,
        68509176, 39128405, 45466507])
-------Step 9-------
tensor([  231010, 15791812,   231030,   231047,   231068, 25931676,    41353,
          231088,   231113, 51368346]) tensor([76014763, 75452815, 72111135, 78434029, 40784226, 12372908, 17389524,
        41907875, 30253297, 63550141])
before start barrier
start train
[proc 0] 100 steps, total: 20.009, sample: 1.091, forward: 1.505, backward: 10.534, update: 0.187
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 18.972, sample: 0.946, forward: 2.276, backward: 10.957, update: 0.265
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 17.085, sample: 1.541, forward: 2.538, backward: 10.983, update: 0.292
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 21.129, sample: 1.477, forward: 2.473, backward: 11.254, update: 0.288
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 18.939, sample: 1.081, forward: 2.476, backward: 11.894, update: 0.273
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.020 ms                  | 82.327 ms                 |
| Forward                   | 8.983 ms                  | 12.743 ms                 |
| Backward                  | 104.159 ms                | 290.060 ms                |
| Optimize                  | 1.961 ms                  | 2.885 ms                  |
| BarrierTimeBeforeRank0    | 27.549 ms                 | 209.274 ms                |
| BlockToStepN              | 24.315 us                 | 9.983 ms                  |
| OneStep                   | 147.751 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.230 ms                  | 70.781 ms                 |
| Forward                   | 8.947 ms                  | 12.743 ms                 |
| Backward                  | 104.047 ms                | 191.280 ms                |
| Optimize                  | 1.950 ms                  | 2.822 ms                  |
| BarrierTimeBeforeRank0    | 28.278 ms                 | 194.967 ms                |
| BlockToStepN              | 25.994 us                 | 11.421 ms                 |
| OneStep                   | 147.942 ms                | 320.815 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.380 ms                  | 70.781 ms                 |
| Forward                   | 8.931 ms                  | 12.743 ms                 |
| Backward                  | 104.347 ms                | 234.373 ms                |
| Optimize                  | 1.955 ms                  | 3.248 ms                  |
| BarrierTimeBeforeRank0    | 29.482 ms                 | 194.967 ms                |
| BlockToStepN              | 25.462 us                 | 11.421 ms                 |
| OneStep                   | 149.349 ms                | 320.815 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 17.833, sample: 0.913, forward: 0.902, backward: 10.781, update: 0.204
[proc 2] 200 steps, total: 17.833, sample: 0.920, forward: 1.632, backward: 11.855, update: 0.267
[proc 3] 200 steps, total: 17.833, sample: 0.833, forward: 1.531, backward: 11.397, update: 0.243
[proc 4] 200 steps, total: 17.833, sample: 0.991, forward: 1.691, backward: 11.280, update: 0.269
[proc 1] 200 steps, total: 17.833, sample: 1.542, forward: 1.779, backward: 12.885, update: 0.263
[proc 5] 200 steps, total: 17.833, sample: 0.812, forward: 1.501, backward: 10.579, update: 0.272
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.948 ms                  | 70.781 ms                 |
| Forward                   | 8.973 ms                  | 12.946 ms                 |
| Backward                  | 104.855 ms                | 234.373 ms                |
| Optimize                  | 1.973 ms                  | 3.394 ms                  |
| BarrierTimeBeforeRank0    | 29.482 ms                 | 209.274 ms                |
| BlockToStepN              | 24.285 us                 | 11.421 ms                 |
| OneStep                   | 150.370 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.875 ms                  | 70.781 ms                 |
| Forward                   | 8.985 ms                  | 13.319 ms                 |
| Backward                  | 105.244 ms                | 234.373 ms                |
| Optimize                  | 1.987 ms                  | 3.463 ms                  |
| BarrierTimeBeforeRank0    | 28.795 ms                 | 209.274 ms                |
| BlockToStepN              | 23.953 us                 | 12.672 ms                 |
| OneStep                   | 150.370 ms                | 357.391 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.948 ms                  | 71.682 ms                 |
| Forward                   | 9.018 ms                  | 13.319 ms                 |
| Backward                  | 105.675 ms                | 201.786 ms                |
| Optimize                  | 2.005 ms                  | 3.463 ms                  |
| BarrierTimeBeforeRank0    | 28.225 ms                 | 194.967 ms                |
| BlockToStepN              | 24.285 us                 | 12.672 ms                 |
| OneStep                   | 153.459 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.637 ms                  | 71.682 ms                 |
| Forward                   | 9.019 ms                  | 13.319 ms                 |
| Backward                  | 105.930 ms                | 229.719 ms                |
| Optimize                  | 2.024 ms                  | 3.583 ms                  |
| BarrierTimeBeforeRank0    | 28.185 ms                 | 209.274 ms                |
| BlockToStepN              | 24.220 us                 | 12.672 ms                 |
| OneStep                   | 153.459 ms                | 357.391 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 300 steps, total: 18.326, sample: 0.905, forward: 0.963, backward: 12.659, update: 0.276
[proc 3] 300 steps, total: 18.326, sample: 0.708, forward: 1.427, backward: 11.357, update: 0.229
[proc 2] 300 steps, total: 18.326, sample: 0.759, forward: 1.522, backward: 11.465, update: 0.258
[proc 5] 300 steps, total: 18.326, sample: 0.753, forward: 1.437, backward: 10.803, update: 0.266
[proc 1] 300 steps, total: 18.326, sample: 1.710, forward: 1.667, backward: 12.916, update: 0.280
[proc 4] 300 steps, total: 18.326, sample: 1.265, forward: 1.567, backward: 10.727, update: 0.251
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.421 ms                  | 71.682 ms                 |
| Forward                   | 9.032 ms                  | 13.319 ms                 |
| Backward                  | 106.494 ms                | 229.719 ms                |
| Optimize                  | 2.041 ms                  | 3.635 ms                  |
| BarrierTimeBeforeRank0    | 28.802 ms                 | 209.274 ms                |
| BlockToStepN              | 24.220 us                 | 12.672 ms                 |
| OneStep                   | 158.585 ms                | 357.391 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.414 ms                  | 71.682 ms                 |
| Forward                   | 9.034 ms                  | 13.319 ms                 |
| Backward                  | 106.932 ms                | 229.719 ms                |
| Optimize                  | 2.064 ms                  | 3.635 ms                  |
| BarrierTimeBeforeRank0    | 31.103 ms                 | 209.274 ms                |
| BlockToStepN              | 23.953 us                 | 12.672 ms                 |
| OneStep                   | 165.065 ms                | 357.391 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.414 ms                  | 70.781 ms                 |
| Forward                   | 9.047 ms                  | 12.946 ms                 |
| Backward                  | 107.531 ms                | 227.959 ms                |
| Optimize                  | 2.105 ms                  | 3.831 ms                  |
| BarrierTimeBeforeRank0    | 28.704 ms                 | 194.967 ms                |
| BlockToStepN              | 24.285 us                 | 11.421 ms                 |
| OneStep                   | 158.585 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 400 steps, total: 17.994, sample: 0.824, forward: 1.458, backward: 10.976, update: 0.273
[proc 0] 400 steps, total: 17.994, sample: 0.815, forward: 0.945, backward: 11.394, update: 0.257
[proc 2] 400 steps, total: 17.994, sample: 0.766, forward: 1.654, backward: 11.732, update: 0.254
[proc 1] 400 steps, total: 17.994, sample: 1.226, forward: 1.606, backward: 13.687, update: 0.279
[proc 3] 400 steps, total: 17.994, sample: 0.790, forward: 1.483, backward: 11.122, update: 0.284
[proc 5] 400 steps, total: 17.994, sample: 0.789, forward: 1.358, backward: 11.030, update: 0.287
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.349 ms                  | 70.781 ms                 |
| Forward                   | 9.076 ms                  | 13.319 ms                 |
| Backward                  | 107.723 ms                | 227.959 ms                |
| Optimize                  | 2.158 ms                  | 3.831 ms                  |
| BarrierTimeBeforeRank0    | 28.225 ms                 | 194.967 ms                |
| BlockToStepN              | 24.315 us                 | 11.421 ms                 |
| OneStep                   | 156.060 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.349 ms                  | 70.781 ms                 |
| Forward                   | 9.113 ms                  | 15.554 ms                 |
| Backward                  | 108.366 ms                | 229.719 ms                |
| Optimize                  | 2.237 ms                  | 3.831 ms                  |
| BarrierTimeBeforeRank0    | 27.090 ms                 | 194.967 ms                |
| BlockToStepN              | 24.285 us                 | 12.672 ms                 |
| OneStep                   | 160.210 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.367 ms                  | 68.011 ms                 |
| Forward                   | 9.178 ms                  | 15.554 ms                 |
| Backward                  | 108.510 ms                | 227.959 ms                |
| Optimize                  | 2.303 ms                  | 3.831 ms                  |
| BarrierTimeBeforeRank0    | 27.066 ms                 | 179.354 ms                |
| BlockToStepN              | 24.220 us                 | 11.421 ms                 |
| OneStep                   | 161.143 ms                | 320.815 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.338 ms                  | 68.011 ms                 |
| Forward                   | 9.194 ms                  | 15.554 ms                 |
| Backward                  | 108.938 ms                | 229.719 ms                |
| Optimize                  | 2.305 ms                  | 3.831 ms                  |
| BarrierTimeBeforeRank0    | 26.642 ms                 | 183.533 ms                |
| BlockToStepN              | 23.997 us                 | 12.672 ms                 |
| OneStep                   | 166.596 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 5] 500 steps, total: 19.148, sample: 0.679, forward: 1.333, backward: 11.087, update: 0.269
[proc 1] 500 steps, total: 19.148, sample: 0.846, forward: 1.624, backward: 11.852, update: 0.250
[proc 2] 500 steps, total: 19.148, sample: 0.729, forward: 1.602, backward: 11.781, update: 0.280
[proc 3] 500 steps, total: 19.148, sample: 0.682, forward: 1.480, backward: 11.572, update: 0.270
[proc 4] 500 steps, total: 19.148, sample: 0.817, forward: 1.450, backward: 12.185, update: 0.270
[proc 0] 500 steps, total: 19.148, sample: 0.958, forward: 1.133, backward: 14.759, update: 0.268
Successfully xmh. training takes 93.3098726272583 seconds
before call kg_cache_controller.StopThreads()
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
INFO [33629 controller_process.py:380] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.338 ms                  | 68.011 ms                 |
| Forward                   | 9.202 ms                  | 17.852 ms                 |
| Backward                  | 109.350 ms                | 229.719 ms                |
| Optimize                  | 2.328 ms                  | 3.831 ms                  |
| BarrierTimeBeforeRank0    | 25.012 ms                 | 183.533 ms                |
| BlockToStepN              | 23.953 us                 | 12.672 ms                 |
| OneStep                   | 173.654 ms                | 325.197 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

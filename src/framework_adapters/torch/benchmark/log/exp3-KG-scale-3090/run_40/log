WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 02:23:01.498052 31669 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_55', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [31669 sampler.py:454] Start PreSampling
WARNING [31669 sampler.py:532] Before construct renumbering_dict
WARNING [31669 sampler.py:555] PreSampling done
W20240123 02:23:04.637457 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240123 02:23:04.637804 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240123 02:23:04.637845 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240123 02:23:04.637894 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240123 02:23:04.637939 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240123 02:23:04.637987 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240123 02:23:04.638033 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240123 02:23:04.638095 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240123 02:23:04.638134 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240123 02:23:04.638195 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240123 02:23:04.638250 31669 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240123 02:23:04.638283 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240123 02:23:04.638319 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240123 02:23:04.638468 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240123 02:23:04.638516 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240123 02:23:04.638547 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240123 02:23:04.638578 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240123 02:23:04.638619 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240123 02:23:04.638689 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240123 02:23:04.638731 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240123 02:23:04.638769 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240123 02:23:04.638823 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240123 02:23:04.638871 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240123 02:23:04.638919 31669 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240123 02:23:04.638947 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240123 02:23:04.638980 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240123 02:23:04.639045 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240123 02:23:04.639086 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240123 02:23:04.639125 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240123 02:23:04.639174 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240123 02:23:04.639247 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240123 02:23:04.639293 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240123 02:23:04.639325 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240123 02:23:04.639361 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240123 02:23:04.639393 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240123 02:23:04.639443 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240123 02:23:04.639475 31669 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240123 02:23:04.639503 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240123 02:23:04.639528 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240123 02:23:04.639590 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240123 02:23:04.639629 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240123 02:23:04.639662 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240123 02:23:04.639698 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240123 02:23:04.639729 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240123 02:23:04.639766 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240123 02:23:04.639798 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240123 02:23:04.639830 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240123 02:23:04.639861 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240123 02:23:04.639899 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240123 02:23:04.639938 31669 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240123 02:23:04.639964 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240123 02:23:04.639999 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240123 02:23:04.640060 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000
W20240123 02:23:04.640094 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000
W20240123 02:23:04.640130 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000
W20240123 02:23:04.640169 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000
W20240123 02:23:04.640211 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000
W20240123 02:23:04.640273 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000
W20240123 02:23:04.640319 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000
W20240123 02:23:04.640357 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000
W20240123 02:23:04.640390 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000
W20240123 02:23:04.640439 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000
W20240123 02:23:04.640486 31669 IPCTensor.h:367] NewIPCTensor: step_r4 [10]0x100002694000
W20240123 02:23:04.640514 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000
W20240123 02:23:04.640540 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000
W20240123 02:23:04.640604 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000
W20240123 02:23:04.640650 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000
W20240123 02:23:04.640686 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000
W20240123 02:23:04.640745 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000
W20240123 02:23:04.640779 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000
W20240123 02:23:04.640823 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000
W20240123 02:23:04.640873 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000
W20240123 02:23:04.640911 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000
W20240123 02:23:04.640949 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000
W20240123 02:23:04.640990 31669 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000
W20240123 02:23:04.641022 31669 IPCTensor.h:367] NewIPCTensor: step_r5 [10]0x100002e4c000
W20240123 02:23:04.641049 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000
W20240123 02:23:04.641080 31669 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000
W20240123 02:23:04.850219 31669 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100002e52000
W20240123 02:23:04.850380 31669 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100004524000
{0: Graph(num_nodes=9651, num_edges=125221,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10501, num_edges=116771,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=7364, num_edges=103565,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=9587, num_edges=131823,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=8718, num_edges=169929,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=9639, num_edges=154972,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9651 N 125221 E
MertisPartition: part 1 has 10501 N 116771 E
MertisPartition: part 2 has 7364 N 103565 E
MertisPartition: part 3 has 9587 N 131823 E
MertisPartition: part 4 has 8718 N 169929 E
MertisPartition: part 5 has 9639 N 154972 E
Rank0: cached key size 124
Rank1: cached key size 124
Rank2: cached key size 124
Rank3: cached key size 124
Rank4: cached key size 124
Rank5: cached key size 124
Before renumbering graph:  {'_ID': tensor([    7,    16,    24,  ..., 10345,  3788,  5916]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
After renumbering graph:  {'_ID': tensor([ 1027,  1424,  1721,  ...,  2883,  2274, 13410]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 3.387 seconds
[Rank1] pid = 32063
[Rank2] pid = 32093
[Rank3] pid = 32192
[Rank4] pid = 32256
INFO [31669 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [32063 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [32093 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [32256 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [32192 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [32257 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [32192 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [31669 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [32257 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [32093 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [32063 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [32256 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
W20240123 02:23:07.959391 32258 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240123 02:23:07.959839 32349 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240123 02:23:07.959897 32321 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
W20240123 02:23:07.959988 32064 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240123 02:23:07.960333 32193 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240123 02:23:07.960333 32129 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240123 02:23:07.989041 32349 IPCTensor.h:367] NewIPCTensor: input_keys_5 [100000]0x100004536000
W20240123 02:23:07.989207 32349 IPCTensor.h:367] NewIPCTensor: input_keys_neg_5 [100000]0x1000045fb000
W20240123 02:23:07.989269 32349 IPCTensor.h:367] NewIPCTensor: backward_grads_5 [100000, 400]0x1000046c0000
W20240123 02:23:07.989307 32349 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_5 [100000, 400]0x10000df58000
W20240123 02:23:07.989354 32349 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240123 02:23:07.989903 32349 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240123 02:23:07.991580 32258 IPCTensor.h:367] NewIPCTensor: input_keys_0 [100000]0x1000177f6000
W20240123 02:23:07.991765 32258 IPCTensor.h:367] NewIPCTensor: input_keys_neg_0 [100000]0x1000178bd000
W20240123 02:23:07.991837 32258 IPCTensor.h:367] NewIPCTensor: backward_grads_0 [100000, 400]0x100017982000
W20240123 02:23:07.991890 32258 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x10002121a000
W20240123 02:23:07.991921 32321 IPCTensor.h:367] NewIPCTensor: input_keys_4 [100000]0x10002aab2000
W20240123 02:23:07.991938 32258 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 02:23:07.992072 32321 IPCTensor.h:367] NewIPCTensor: input_keys_neg_4 [100000]0x10002ab79000
W20240123 02:23:07.992130 32321 IPCTensor.h:367] NewIPCTensor: backward_grads_4 [100000, 400]0x10002ac3e000
W20240123 02:23:07.992164 32321 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_4 [100000, 400]0x1000344d6000
W20240123 02:23:07.992205 32321 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240123 02:23:07.992215 32064 IPCTensor.h:367] NewIPCTensor: input_keys_1 [100000]0x10003dd6e000
W20240123 02:23:07.992359 32064 IPCTensor.h:367] NewIPCTensor: input_keys_neg_1 [100000]0x10003de33000
W20240123 02:23:07.992431 32064 IPCTensor.h:367] NewIPCTensor: backward_grads_1 [100000, 400]0x10003def8000
W20240123 02:23:07.992463 32064 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x100047790000
W20240123 02:23:07.992494 32064 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 02:23:07.993518 32258 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 02:23:07.993578 32321 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240123 02:23:07.993655 32064 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 02:23:07.996125 32129 IPCTensor.h:367] NewIPCTensor: input_keys_2 [100000]0x1000510fd000
W20240123 02:23:07.996125 32193 IPCTensor.h:367] NewIPCTensor: input_keys_3 [100000]0x100051038000
W20240123 02:23:07.996279 32129 IPCTensor.h:367] NewIPCTensor: input_keys_neg_2 [100000]0x1000511c2000
W20240123 02:23:07.996287 32193 IPCTensor.h:367] NewIPCTensor: input_keys_neg_3 [100000]0x100051287000
W20240123 02:23:07.996347 32193 IPCTensor.h:367] NewIPCTensor: backward_grads_3 [100000, 400]0x10005134c000
W20240123 02:23:07.996358 32129 IPCTensor.h:367] NewIPCTensor: backward_grads_2 [100000, 400]0x10005abe4000
W20240123 02:23:07.996400 32193 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x10006447c000
W20240123 02:23:07.996405 32129 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x10006dd14000
W20240123 02:23:07.996459 32129 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 02:23:07.996464 32193 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 02:23:07.998059 32193 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 02:23:07.998059 32129 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
cudaHostRegister 0x100002e52000
4: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100002e52000
5: KnownLocalCachedEmbedding init done
WARNING [32256 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [32257 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100002e52000
1: KnownLocalCachedEmbedding init done
WARNING [32063 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank5] pid = 32257
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482)]
cudaHostRegister 0x100002e52000
0: KnownLocalCachedEmbedding init done
WARNING [31669 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100002e52000
3: KnownLocalCachedEmbedding init done
WARNING [32192 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100002e52000
2: KnownLocalCachedEmbedding init done
WARNING [32093 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 02:23:08.173203 32129 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240123 02:23:08.173243 32193 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:23:08.173367 32064 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:23:08.173569 32258 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:23:08.173635 32349 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240123 02:23:08.173682 32321 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
W20240123 02:23:08.175637 32258 grad_base.h:55] KGCacheController, config={
        "num_gpus": 6,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240123 02:23:08.175827 32258 grad_base.h:172] Init GradProcessingBase done
I20240123 02:23:08.184356 32258 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240123 02:23:08.184561 32258 kg_controller.h:78] after init GradAsyncProcessingV2
I20240123 02:23:08.184578 32258 kg_controller.h:84] Construct KGCacheController done
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
I20240123 02:23:09.822906 32258 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240123 02:23:10.440232 32889 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 02:23:10.440538 32889 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240123 02:23:10.472818 32129 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240123 02:23:10.482231 32258 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:23:10.484259 32064 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:23:10.485527 32193 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:23:10.497082 32349 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240123 02:23:10.500475 32321 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
E20240123 02:23:12.587443 32547 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 02:23:12.608963 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240123 02:23:12.616546 32889 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.345 ms                  | 19.984 ms                 |
| Forward                   | 4.860 ms                  | 710.790 ms                |
| Backward                  | 4.062 ms                  | 203.541 ms                |
| Optimize                  | 1.667 ms                  | 3.295 ms                  |
| BarrierTimeBeforeRank0    | 2.927 ms                  | 215.135 ms                |
| AfterBackward             | 29.274 ms                 | 973.194 ms                |
| BlockToStepN              | 109.927 us                | 17.110 ms                 |
| OneStep                   | 54.704 ms                 | 2.114 s                   |
+---------------------------+---------------------------+---------------------------+
E20240123 02:23:13.587018 32547 parallel_pq_v2.h:76] insert failed, size(hashtable)=7825
W20240123 02:23:13.608026 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=20, pq.top=20
W20240123 02:23:13.636086 32889 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end1
E20240123 02:23:14.587013 32547 parallel_pq_v2.h:76] insert failed, size(hashtable)=358
W20240123 02:23:14.664363 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=37, pq.top=37
W20240123 02:23:14.675704 32889 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 4.906 ms                  | 349.455 ms                |
| ProcessBack:UpdateCache   | 6.233 ms                  | 593.259 ms                |
| ProcessBack:UpsertPq      | 17.339 ms                 | 40.287 ms                 |
| ProcessOneStep            | 29.548 ms                 | 972.515 ms                |
| BlockToStepN              | 2.091 ms                  | 19.105 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:23:15.587282 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=5254
W20240123 02:23:15.700577 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=56, pq.top=56
W20240123 02:23:15.711735 32889 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end7
E20240123 02:23:16.587021 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=8170
W20240123 02:23:16.700038 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=73, pq.top=73
W20240123 02:23:16.732213 32889 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
E20240123 02:23:17.587010 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=3983
W20240123 02:23:17.700024 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=89, pq.top=89
W20240123 02:23:17.735317 32889 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.286 ms                  | 20.046 ms                 |
| Forward                   | 4.634 ms                  | 10.608 ms                 |
| Backward                  | 4.656 ms                  | 7.888 ms                  |
| Optimize                  | 1.751 ms                  | 8.648 ms                  |
| BarrierTimeBeforeRank0    | 1.460 ms                  | 15.224 ms                 |
| AfterBackward             | 25.708 ms                 | 53.576 ms                 |
| BlockToStepN              | 8.606 ms                  | 33.756 ms                 |
| OneStep                   | 58.826 ms                 | 90.937 ms                 |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 7.886, sample: 0.332, forward: 1.342, backward: 0.662, update: 0.158
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 7.890, sample: 0.331, forward: 1.339, backward: 0.630, update: 0.159
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 7.914, sample: 0.300, forward: 1.209, backward: 0.641, update: 0.167
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.903, sample: 0.306, forward: 1.208, backward: 0.635, update: 0.161
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 7.901, sample: 0.353, forward: 1.141, backward: 0.675, update: 0.194
train_sampler.Prefill()
-------Step 0-------
tensor([   97,  6308,  8694,  1054,  6974,  3994,   110, 11209, 12124,  3892]) tensor([ 1721,    60,  5556, 10659,   106, 12796, 14010, 12647,  1596, 12777])
-------Step 1-------
tensor([   97,  6308,  8694,  1054,  6974,  3994,   110, 11209, 12124,  3892]) tensor([13497,  1842,  5073,  5764,  2565,  4317, 12067,  8090, 10895, 12360])
-------Step 2-------
tensor([14260,    25,    76,    47, 11628,  6203,  9001,  8670,  8353,  2879]) tensor([ 6960,  2595,  1014,  5785,  3890,  8887, 12111,  7032,  8530, 10612])
-------Step 3-------
tensor([14260,    25,    76,    47, 11628,  6203,  9001,  8670,  8353,  2879]) tensor([14059, 10785,  9739,  7083, 10570, 12708, 14915, 11208,  9323, 14399])
-------Step 4-------
tensor([12081,  6023, 12440, 13594, 10044,  4829,   119,  9370,  6974, 13193]) tensor([ 6218,  2306,  7590,  1061,  1311,  1508, 12790, 14627,  3791,  3447])
-------Step 5-------
tensor([12081,  6023, 12440, 13594, 10044,  4829,   119,  9370,  6974, 13193]) tensor([ 3642,  8016,  9950,  8988,  7926,  4407,  3027, 13590, 12082, 10684])
-------Step 6-------
tensor([ 7686,  3185, 12912,   750,  6323,  6201,  9576, 14418,    67,  8281]) tensor([ 1368,  1521,  6559, 13963,  3060,  3727,  6030, 13460,  8627, 11795])
-------Step 7-------
tensor([ 7686,  3185, 12912,   750,  6323,  6201,  9576, 14418,    67,  8281]) tensor([ 5433,  2299,  8761, 12245,  4555, 13123,  6048,  8516,  2310,  9824])
-------Step 8-------
tensor([ 5984, 10307,  7913, 10485,  8007, 11130, 13970, 11487,  1896, 13445]) tensor([ 4849,  4770,  3384,  1921,  6988,  7955,  7119,  5948, 10892,  1826])
-------Step 9-------
tensor([ 5984, 10307,  7913, 10485,  8007, 11130, 13970, 11487,  1896, 13445]) tensor([ 1583,  4077,  7575,  7125,  6728, 14328,  1385,  1891, 10895,  5986])
before start barrier
start train
[proc 0] 100 steps, total: 7.904, sample: 0.320, forward: 1.166, backward: 0.683, update: 0.191
E20240123 02:23:18.587010 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=5591
W20240123 02:23:18.700050 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=105, pq.top=105
W20240123 02:23:18.768633 32889 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240123 02:23:19.587013 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=4829
W20240123 02:23:19.700215 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=121, pq.top=121
W20240123 02:23:19.793619 32889 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 3.546 ms                  | 7.665 ms                  |
| ProcessBack:UpdateCache   | 4.445 ms                  | 9.626 ms                  |
| ProcessBack:UpsertPq      | 13.358 ms                 | 35.050 ms                 |
| ProcessOneStep            | 24.174 ms                 | 53.529 ms                 |
| BlockToStepN              | 11.804 ms                 | 39.368 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:23:20.587028 32547 parallel_pq_v2.h:76] insert failed, size(hashtable)=235
W20240123 02:23:20.700129 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=136, pq.top=136
W20240123 02:23:20.808698 32889 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240123 02:23:21.587016 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=5985
W20240123 02:23:21.718442 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=149, pq.top=149
W20240123 02:23:21.811082 32889 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 02:23:22.587013 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=7273
W20240123 02:23:22.834769 32889 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end3
W20240123 02:23:22.865442 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=163, pq.top=163
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.418 ms                  | 20.112 ms                 |
| Forward                   | 4.675 ms                  | 9.939 ms                  |
| Backward                  | 4.324 ms                  | 7.814 ms                  |
| Optimize                  | 1.770 ms                  | 4.596 ms                  |
| BarrierTimeBeforeRank0    | 1.431 ms                  | 15.224 ms                 |
| AfterBackward             | 27.439 ms                 | 57.070 ms                 |
| BlockToStepN              | 9.521 ms                  | 41.216 ms                 |
| OneStep                   | 62.441 ms                 | 172.396 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 02:23:23.587252 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=8773
W20240123 02:23:23.865272 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=177, pq.top=177
W20240123 02:23:23.880498 32889 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end7
E20240123 02:23:24.589013 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=4867
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 4.457 ms                  | 6.987 ms                  |
| ProcessBack:UpdateCache   | 5.015 ms                  | 8.490 ms                  |
| ProcessBack:UpsertPq      | 15.737 ms                 | 41.762 ms                 |
| ProcessOneStep            | 27.705 ms                 | 57.029 ms                 |
| BlockToStepN              | 10.632 ms                 | 131.880 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:24.889467 32889 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240123 02:23:24.925187 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=180, pq.top=180
E20240123 02:23:25.589018 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=6839
W20240123 02:23:25.925359 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=196, pq.top=196
W20240123 02:23:25.958683 32889 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end6
[proc 3] 200 steps, total: 8.076, sample: 0.368, forward: 0.422, backward: 0.446, update: 0.161
[proc 4] 200 steps, total: 8.076, sample: 0.378, forward: 0.421, backward: 0.492, update: 0.161
[proc 1] 200 steps, total: 8.076, sample: 0.355, forward: 0.431, backward: 0.495, update: 0.157
[proc 5] 200 steps, total: 8.076, sample: 0.429, forward: 0.494, backward: 0.450, update: 0.195
[proc 2] 200 steps, total: 8.076, sample: 0.349, forward: 0.443, backward: 0.481, update: 0.170
[proc 0] 200 steps, total: 8.076, sample: 0.402, forward: 0.492, backward: 0.419, update: 0.210
E20240123 02:23:26.589007 32258 parallel_pq_v2.h:76] insert failed, size(hashtable)=1816
W20240123 02:23:26.925076 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=208, pq.top=208
W20240123 02:23:26.971511 32889 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end9
E20240123 02:23:27.589038 32547 parallel_pq_v2.h:76] insert failed, size(hashtable)=1041
W20240123 02:23:27.925279 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=219, pq.top=219
W20240123 02:23:28.047834 32889 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.433 ms                  | 26.082 ms                 |
| Forward                   | 4.732 ms                  | 9.939 ms                  |
| Backward                  | 4.237 ms                  | 7.814 ms                  |
| Optimize                  | 1.817 ms                  | 8.648 ms                  |
| BarrierTimeBeforeRank0    | 1.460 ms                  | 22.673 ms                 |
| AfterBackward             | 27.052 ms                 | 64.000 ms                 |
| BlockToStepN              | 9.901 ms                  | 147.313 ms                |
| OneStep                   | 62.736 ms                 | 436.035 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 02:23:28.589025 32889 parallel_pq_v2.h:76] insert failed, size(hashtable)=72
W20240123 02:23:28.929597 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=229, pq.top=229
W20240123 02:23:29.065888 32889 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end2
E20240123 02:23:29.589020 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=10297
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 4.307 ms                  | 6.035 ms                  |
| ProcessBack:UpdateCache   | 4.609 ms                  | 9.626 ms                  |
| ProcessBack:UpsertPq      | 15.485 ms                 | 41.473 ms                 |
| ProcessOneStep            | 26.287 ms                 | 381.958 ms                |
| BlockToStepN              | 9.124 ms                  | 147.202 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:29.980201 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=247, pq.top=247
W20240123 02:23:30.185564 32889 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end0
E20240123 02:23:30.589010 32258 parallel_pq_v2.h:76] insert failed, size(hashtable)=755
W20240123 02:23:31.068646 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=259, pq.top=259
W20240123 02:23:31.187673 32889 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end2
E20240123 02:23:31.589006 32258 parallel_pq_v2.h:76] insert failed, size(hashtable)=1508
W20240123 02:23:32.263716 32889 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end6
W20240123 02:23:32.519469 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=277, pq.top=277
E20240123 02:23:32.589012 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=5660
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.426 ms                  | 25.740 ms                 |
| Forward                   | 4.737 ms                  | 9.662 ms                  |
| Backward                  | 4.179 ms                  | 7.799 ms                  |
| Optimize                  | 1.839 ms                  | 9.529 ms                  |
| BarrierTimeBeforeRank0    | 1.295 ms                  | 23.936 ms                 |
| AfterBackward             | 26.465 ms                 | 382.013 ms                |
| BlockToStepN              | 8.180 ms                  | 131.975 ms                |
| OneStep                   | 62.272 ms                 | 436.035 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:33.268590 32889 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end0
W20240123 02:23:33.572436 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=294, pq.top=294
E20240123 02:23:33.589005 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=5848
[proc 4] 300 steps, total: 7.553, sample: 0.326, forward: 0.426, backward: 0.451, update: 0.169
[proc 1] 300 steps, total: 7.553, sample: 0.355, forward: 0.411, backward: 0.411, update: 0.150
[proc 2] 300 steps, total: 7.553, sample: 0.372, forward: 0.496, backward: 0.422, update: 0.199
[proc 3] 300 steps, total: 7.553, sample: 0.356, forward: 0.423, backward: 0.454, update: 0.169
[proc 5] 300 steps, total: 7.553, sample: 0.353, forward: 0.419, backward: 0.495, update: 0.162
[proc 0] 300 steps, total: 7.553, sample: 0.356, forward: 0.467, backward: 0.400, update: 0.214
W20240123 02:23:34.273375 32889 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240123 02:23:34.589015 32547 parallel_pq_v2.h:76] insert failed, size(hashtable)=4893
W20240123 02:23:34.602413 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=308, pq.top=308
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 4.457 ms                  | 6.008 ms                  |
| ProcessBack:UpdateCache   | 4.732 ms                  | 8.490 ms                  |
| ProcessBack:UpsertPq      | 15.795 ms                 | 41.426 ms                 |
| ProcessOneStep            | 27.198 ms                 | 381.958 ms                |
| BlockToStepN              | 7.461 ms                  | 131.880 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:35.276698 32889 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
E20240123 02:23:35.589010 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=4667
W20240123 02:23:35.648568 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=323, pq.top=323
W20240123 02:23:36.282368 32889 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 02:23:36.589015 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=7691
W20240123 02:23:36.709406 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=337, pq.top=337
W20240123 02:23:37.284909 32889 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240123 02:23:37.589006 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=7704
W20240123 02:23:37.709196 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=350, pq.top=350
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.392 ms                  | 20.883 ms                 |
| Forward                   | 4.724 ms                  | 8.187 ms                  |
| Backward                  | 4.133 ms                  | 7.761 ms                  |
| Optimize                  | 1.833 ms                  | 9.232 ms                  |
| BarrierTimeBeforeRank0    | 1.599 ms                  | 24.004 ms                 |
| AfterBackward             | 28.705 ms                 | 336.016 ms                |
| BlockToStepN              | 7.913 ms                  | 83.318 ms                 |
| OneStep                   | 64.053 ms                 | 420.525 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:38.285027 32889 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240123 02:23:38.589010 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=6733
W20240123 02:23:38.712857 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=363, pq.top=363
W20240123 02:23:39.288763 32889 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 02:23:39.589007 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=8641
W20240123 02:23:39.751610 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=377, pq.top=377
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 4.609 ms                  | 5.976 ms                  |
| ProcessBack:UpdateCache   | 5.214 ms                  | 8.181 ms                  |
| ProcessBack:UpsertPq      | 16.813 ms                 | 41.273 ms                 |
| ProcessOneStep            | 28.673 ms                 | 335.950 ms                |
| BlockToStepN              | 8.404 ms                  | 83.236 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:40.294018 32889 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
E20240123 02:23:40.589025 32889 parallel_pq_v2.h:76] insert failed, size(hashtable)=70
W20240123 02:23:40.759488 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=391, pq.top=391
W20240123 02:23:41.295235 32889 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
[proc 3] 400 steps, total: 7.405, sample: 0.361, forward: 0.446, backward: 0.441, update: 0.183
[proc 5] 400 steps, total: 7.405, sample: 0.347, forward: 0.459, backward: 0.461, update: 0.183
[proc 4] 400 steps, total: 7.405, sample: 0.347, forward: 0.443, backward: 0.498, update: 0.174
[proc 2] 400 steps, total: 7.405, sample: 0.388, forward: 0.466, backward: 0.431, update: 0.179
[proc 1] 400 steps, total: 7.405, sample: 0.378, forward: 0.458, backward: 0.417, update: 0.172
[proc 0] 400 steps, total: 7.405, sample: 0.345, forward: 0.446, backward: 0.409, update: 0.197
E20240123 02:23:41.589007 32258 parallel_pq_v2.h:76] insert failed, size(hashtable)=1201
W20240123 02:23:41.773324 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=406, pq.top=406
W20240123 02:23:42.300127 32889 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240123 02:23:42.589010 32258 parallel_pq_v2.h:76] insert failed, size(hashtable)=1619
W20240123 02:23:42.773798 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=419, pq.top=419
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.421 ms                  | 26.082 ms                 |
| Forward                   | 4.714 ms                  | 8.187 ms                  |
| Backward                  | 4.131 ms                  | 7.761 ms                  |
| Optimize                  | 1.836 ms                  | 10.435 ms                 |
| BarrierTimeBeforeRank0    | 1.668 ms                  | 24.745 ms                 |
| AfterBackward             | 28.325 ms                 | 336.016 ms                |
| BlockToStepN              | 8.787 ms                  | 83.318 ms                 |
| OneStep                   | 65.858 ms                 | 420.525 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:43.303632 32889 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240123 02:23:43.589011 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=2746
W20240123 02:23:43.783783 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=435, pq.top=435
W20240123 02:23:44.307049 32889 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 02:23:44.594172 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=2643
W20240123 02:23:44.813282 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=448, pq.top=448
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 4.684 ms                  | 5.966 ms                  |
| ProcessBack:UpdateCache   | 5.636 ms                  | 8.127 ms                  |
| ProcessBack:UpsertPq      | 16.944 ms                 | 41.261 ms                 |
| ProcessOneStep            | 28.696 ms                 | 335.950 ms                |
| BlockToStepN              | 9.046 ms                  | 109.904 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 02:23:45.341487 32889 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240123 02:23:45.594008 32258 parallel_pq_v2.h:76] insert failed, size(hashtable)=913
W20240123 02:23:45.866947 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=464, pq.top=464
W20240123 02:23:46.353101 32889 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 02:23:46.594015 32547 parallel_pq_v2.h:76] insert failed, size(hashtable)=1558
W20240123 02:23:46.897712 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=480, pq.top=480
W20240123 02:23:47.358101 32889 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240123 02:23:47.594008 32888 parallel_pq_v2.h:76] insert failed, size(hashtable)=4224
W20240123 02:23:47.924995 32258 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=496, pq.top=496
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.441 ms                  | 25.740 ms                 |
| Forward                   | 4.744 ms                  | 8.081 ms                  |
| Backward                  | 4.132 ms                  | 7.759 ms                  |
| Optimize                  | 1.834 ms                  | 9.529 ms                  |
| BarrierTimeBeforeRank0    | 1.733 ms                  | 24.745 ms                 |
| AfterBackward             | 28.780 ms                 | 68.323 ms                 |
| BlockToStepN              | 9.524 ms                  | 83.318 ms                 |
| OneStep                   | 65.858 ms                 | 369.661 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 6.819, sample: 0.305, forward: 0.415, backward: 0.438, update: 0.146
[proc 5] 500 steps, total: 6.819, sample: 0.351, forward: 0.474, backward: 0.450, update: 0.190
[proc 1] 500 steps, total: 6.819, sample: 0.296, forward: 0.425, backward: 0.428, update: 0.168
[proc 3] 500 steps, total: 6.819, sample: 0.299, forward: 0.387, backward: 0.445, update: 0.155
[proc 0] 500 steps, total: 6.819, sample: 0.375, forward: 0.468, backward: 0.401, update: 0.172
[proc 4] 500 steps, total: 6.819, sample: 0.384, forward: 0.470, backward: 0.459, update: 0.190
Successfully xmh. training takes 37.75913667678833 seconds
before call kg_cache_controller.StopThreads()
W20240123 02:23:48.241382 32258 grad_async_v2.h:71] call StopThreads. PID = 31669
W20240123 02:23:48.241415 32258 grad_base.h:210] before processOneStepNegThread_.join();
W20240123 02:23:48.241772 32258 grad_base.h:212] after processOneStepNegThread_.join();
W20240123 02:23:48.241801 32258 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240123 02:23:48.252085 32258 grad_async_v2.h:91] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

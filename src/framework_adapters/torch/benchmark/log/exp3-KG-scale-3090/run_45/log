WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 02:33:00.378649 54668 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_60', no_save_emb=True, max_step=500, batch_size=400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [54668 sampler.py:454] Start PreSampling
WARNING [54668 sampler.py:532] Before construct renumbering_dict
WARNING [54668 sampler.py:555] PreSampling done
W20240123 02:33:05.226810 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000
W20240123 02:33:05.227128 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000
W20240123 02:33:05.227177 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000
W20240123 02:33:05.227203 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000
W20240123 02:33:05.227229 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000
W20240123 02:33:05.227249 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000
W20240123 02:33:05.227277 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000
W20240123 02:33:05.227308 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000
W20240123 02:33:05.227327 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000
W20240123 02:33:05.227357 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000
W20240123 02:33:05.227428 54668 IPCTensor.h:367] NewIPCTensor: step_r0 [10]0x1000007b4000
W20240123 02:33:05.227449 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000
W20240123 02:33:05.227466 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000
W20240123 02:33:05.227612 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000
W20240123 02:33:05.227643 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000
W20240123 02:33:05.227663 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000
W20240123 02:33:05.227687 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000
W20240123 02:33:05.227730 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000
W20240123 02:33:05.227764 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000
W20240123 02:33:05.227787 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000
W20240123 02:33:05.227804 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000
W20240123 02:33:05.227823 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000
W20240123 02:33:05.227851 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000
W20240123 02:33:05.227875 54668 IPCTensor.h:367] NewIPCTensor: step_r1 [10]0x100000f6c000
W20240123 02:33:05.227891 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000
W20240123 02:33:05.227912 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000
W20240123 02:33:05.227953 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000
W20240123 02:33:05.227974 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000
W20240123 02:33:05.227993 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000
W20240123 02:33:05.228025 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000
W20240123 02:33:05.228044 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000
W20240123 02:33:05.228080 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000
W20240123 02:33:05.228111 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000
W20240123 02:33:05.228134 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000
W20240123 02:33:05.228152 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000
W20240123 02:33:05.228176 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000
W20240123 02:33:05.228212 54668 IPCTensor.h:367] NewIPCTensor: step_r2 [10]0x100001724000
W20240123 02:33:05.228229 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000
W20240123 02:33:05.228250 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000
W20240123 02:33:05.228294 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000
W20240123 02:33:05.228314 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000
W20240123 02:33:05.228335 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000
W20240123 02:33:05.228374 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000
W20240123 02:33:05.228394 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000
W20240123 02:33:05.228423 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000
W20240123 02:33:05.228456 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000
W20240123 02:33:05.228480 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000
W20240123 02:33:05.228502 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000
W20240123 02:33:05.228523 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000
W20240123 02:33:05.228555 54668 IPCTensor.h:367] NewIPCTensor: step_r3 [10]0x100001edc000
W20240123 02:33:05.228571 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000
W20240123 02:33:05.228586 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000
W20240123 02:33:05.228623 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_0 [100000]0x100001ee2000
W20240123 02:33:05.228653 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_1 [100000]0x100001fa7000
W20240123 02:33:05.228672 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_2 [100000]0x10000206c000
W20240123 02:33:05.228693 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_3 [100000]0x100002131000
W20240123 02:33:05.228724 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_4 [100000]0x1000021f6000
W20240123 02:33:05.228749 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_5 [100000]0x1000022bb000
W20240123 02:33:05.228781 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_6 [100000]0x100002380000
W20240123 02:33:05.228808 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_7 [100000]0x100002445000
W20240123 02:33:05.228854 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_8 [100000]0x10000250a000
W20240123 02:33:05.228904 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r4_9 [100000]0x1000025cf000
W20240123 02:33:05.228930 54668 IPCTensor.h:367] NewIPCTensor: step_r4 [10]0x100002694000
W20240123 02:33:05.228946 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r4 [1]0x100002696000
W20240123 02:33:05.228965 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100002698000
W20240123 02:33:05.229015 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_0 [100000]0x10000269a000
W20240123 02:33:05.229043 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_1 [100000]0x10000275f000
W20240123 02:33:05.229061 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_2 [100000]0x100002824000
W20240123 02:33:05.229103 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_3 [100000]0x1000028e9000
W20240123 02:33:05.229130 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_4 [100000]0x1000029ae000
W20240123 02:33:05.229156 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_5 [100000]0x100002a73000
W20240123 02:33:05.229182 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_6 [100000]0x100002b38000
W20240123 02:33:05.229205 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_7 [100000]0x100002bfd000
W20240123 02:33:05.229224 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_8 [100000]0x100002cc2000
W20240123 02:33:05.229243 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r5_9 [100000]0x100002d87000
W20240123 02:33:05.229269 54668 IPCTensor.h:367] NewIPCTensor: step_r5 [10]0x100002e4c000
W20240123 02:33:05.229285 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r5 [1]0x100002e4e000
W20240123 02:33:05.229300 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x100002e50000
W20240123 02:33:05.229338 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_0 [100000]0x100002e52000
W20240123 02:33:05.229359 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_1 [100000]0x100002f17000
W20240123 02:33:05.229377 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_2 [100000]0x100002fdc000
W20240123 02:33:05.229404 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_3 [100000]0x1000030a1000
W20240123 02:33:05.229431 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_4 [100000]0x100003166000
W20240123 02:33:05.229460 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_5 [100000]0x10000322b000
W20240123 02:33:05.229483 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_6 [100000]0x1000032f0000
W20240123 02:33:05.229506 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_7 [100000]0x1000033b5000
W20240123 02:33:05.229540 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_8 [100000]0x10000347a000
W20240123 02:33:05.229576 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r6_9 [100000]0x10000353f000
W20240123 02:33:05.229609 54668 IPCTensor.h:367] NewIPCTensor: step_r6 [10]0x100003604000
W20240123 02:33:05.229625 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r6 [1]0x100003606000
W20240123 02:33:05.229646 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x100003608000
W20240123 02:33:05.229686 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_0 [100000]0x10000360a000
W20240123 02:33:05.229713 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_1 [100000]0x1000036cf000
W20240123 02:33:05.229737 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_2 [100000]0x100003794000
W20240123 02:33:05.229759 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_3 [100000]0x100003859000
W20240123 02:33:05.229782 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_4 [100000]0x10000391e000
W20240123 02:33:05.229807 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_5 [100000]0x1000039e3000
W20240123 02:33:05.229831 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_6 [100000]0x100003aa8000
W20240123 02:33:05.229851 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_7 [100000]0x100003b6d000
W20240123 02:33:05.229871 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_8 [100000]0x100003c32000
W20240123 02:33:05.229893 54668 IPCTensor.h:367] NewIPCTensor: cached_sampler_r7_9 [100000]0x100003cf7000
W20240123 02:33:05.229912 54668 IPCTensor.h:367] NewIPCTensor: step_r7 [10]0x100003dbc000
W20240123 02:33:05.229928 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_r7 [1]0x100003dbe000
W20240123 02:33:05.229943 54668 IPCTensor.h:367] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100003dc0000
W20240123 02:33:05.433439 54668 IPCTensor.h:367] NewIPCTensor: full_emb [14951, 400]0x100003dc2000
W20240123 02:33:05.433598 54668 IPCTensor.h:367] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100005494000
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([  744,  1066,  1496,  ..., 11771,  8964,  9356]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.088 seconds
[Rank1] pid = 55085
[Rank2] pid = 55132
[Rank3] pid = 55170
[Rank4] pid = 55280
[Rank5] pid = 55344
[Rank6] pid = 55372
INFO [54668 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [55085 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [55132 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [55170 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [55280 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [55372 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [55344 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [55410 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [55372 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [55280 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [55410 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [55344 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [55170 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [55085 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [55132 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240123 02:33:09.125427 55086 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240123 02:33:09.125541 55150 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240123 02:33:09.125555 55411 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_6 [747, 400]; dev=6; size=1.14 MB
W20240123 02:33:09.125543 55216 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240123 02:33:09.125541 55345 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240123 02:33:09.125555 55528 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_7 [747, 400]; dev=7; size=1.14 MB
W20240123 02:33:09.125564 55281 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
INFO [54668 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240123 02:33:09.146044 55412 IPCTensor.h:406] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240123 02:33:09.149629 55345 IPCTensor.h:367] NewIPCTensor: input_keys_5 [100000]0x1000054aa000
W20240123 02:33:09.149631 55528 IPCTensor.h:367] NewIPCTensor: input_keys_7 [100000]0x10000556f000
W20240123 02:33:09.149643 55411 IPCTensor.h:367] NewIPCTensor: input_keys_6 [100000]0x100005634000
W20240123 02:33:09.149828 55411 IPCTensor.h:367] NewIPCTensor: input_keys_neg_6 [100000]0x1000056f9000
W20240123 02:33:09.149837 55528 IPCTensor.h:367] NewIPCTensor: input_keys_neg_7 [100000]0x1000057be000
W20240123 02:33:09.149853 55345 IPCTensor.h:367] NewIPCTensor: input_keys_neg_5 [100000]0x100005883000
W20240123 02:33:09.149912 55528 IPCTensor.h:367] NewIPCTensor: backward_grads_7 [100000, 400]0x100005948000
W20240123 02:33:09.149919 55345 IPCTensor.h:367] NewIPCTensor: backward_grads_5 [100000, 400]0x10000f1e0000
W20240123 02:33:09.149925 55411 IPCTensor.h:367] NewIPCTensor: backward_grads_6 [100000, 400]0x100018a78000
W20240123 02:33:09.149967 55345 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_5 [100000, 400]0x100022310000
W20240123 02:33:09.149973 55528 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_7 [100000, 400]0x10002bba8000
W20240123 02:33:09.149979 55411 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_6 [100000, 400]0x100035440000
W20240123 02:33:09.150043 55345 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240123 02:33:09.150048 55411 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_6_gpu [100000, 400]; dev=6; size=152.6 MB
W20240123 02:33:09.150048 55528 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_7_gpu [100000, 400]; dev=7; size=152.6 MB
W20240123 02:33:09.151258 55086 IPCTensor.h:367] NewIPCTensor: input_keys_1 [100000]0x10003ecdc000
W20240123 02:33:09.151392 55150 IPCTensor.h:367] NewIPCTensor: input_keys_2 [100000]0x10003eda1000
W20240123 02:33:09.151418 55086 IPCTensor.h:367] NewIPCTensor: input_keys_neg_1 [100000]0x10003ee66000
W20240123 02:33:09.151484 55086 IPCTensor.h:367] NewIPCTensor: backward_grads_1 [100000, 400]0x10003ef2b000
W20240123 02:33:09.151531 55086 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x1000487c3000
W20240123 02:33:09.151559 55150 IPCTensor.h:367] NewIPCTensor: input_keys_neg_2 [100000]0x10005205b000
W20240123 02:33:09.151587 55086 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 02:33:09.151629 55150 IPCTensor.h:367] NewIPCTensor: backward_grads_2 [100000, 400]0x100052120000
W20240123 02:33:09.151674 55150 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x10005b9b8000
W20240123 02:33:09.151731 55150 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 02:33:09.151885 55345 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_5_gpu [100000, 400]; dev=5; size=152.6 MB
W20240123 02:33:09.152043 55216 IPCTensor.h:367] NewIPCTensor: input_keys_3 [100000]0x100065254000
W20240123 02:33:09.152192 55216 IPCTensor.h:367] NewIPCTensor: input_keys_neg_3 [100000]0x10006531d000
W20240123 02:33:09.152228 55411 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_6_gpu [100000, 400]; dev=6; size=152.6 MB
W20240123 02:33:09.152261 55216 IPCTensor.h:367] NewIPCTensor: backward_grads_3 [100000, 400]0x1000653e2000
W20240123 02:33:09.152269 55528 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_7_gpu [100000, 400]; dev=7; size=152.6 MB
W20240123 02:33:09.152303 55216 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x10006ec7a000
W20240123 02:33:09.152366 55216 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 02:33:09.154147 55086 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 02:33:09.154362 55150 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 02:33:09.154740 55216 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 02:33:09.156643 55281 IPCTensor.h:367] NewIPCTensor: input_keys_4 [100000]0x100078526000
W20240123 02:33:09.156814 55281 IPCTensor.h:367] NewIPCTensor: input_keys_neg_4 [100000]0x1000785eb000
W20240123 02:33:09.156910 55281 IPCTensor.h:367] NewIPCTensor: backward_grads_4 [100000, 400]0x1000786b0000
W20240123 02:33:09.156955 55281 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_4 [100000, 400]0x100081f48000
W20240123 02:33:09.157009 55281 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240123 02:33:09.159960 55281 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_4_gpu [100000, 400]; dev=4; size=152.6 MB
W20240123 02:33:09.163100 55412 IPCTensor.h:367] NewIPCTensor: input_keys_0 [100000]0x10008b7e6000
W20240123 02:33:09.163287 55412 IPCTensor.h:367] NewIPCTensor: input_keys_neg_0 [100000]0x10008b8ab000
W20240123 02:33:09.163360 55412 IPCTensor.h:367] NewIPCTensor: backward_grads_0 [100000, 400]0x10008b970000
W20240123 02:33:09.163403 55412 IPCTensor.h:367] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x100095208000
W20240123 02:33:09.163447 55412 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 02:33:09.164450 55412 IPCTensor.h:406] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
[Rank7] pid = 55410
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
cudaHostRegister 0x100003dc2000
0: KnownLocalCachedEmbedding init done
WARNING [54668 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
3: KnownLocalCachedEmbedding init done
WARNING [55170 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
2: KnownLocalCachedEmbedding init done
WARNING [55132 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
1: KnownLocalCachedEmbedding init done
WARNING [55085 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
6: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100003dc2000
7: KnownLocalCachedEmbedding init done
WARNING [55372 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
4: KnownLocalCachedEmbedding init done
WARNING [55410 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [55280 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100003dc2000
5: KnownLocalCachedEmbedding init done
WARNING [55344 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 02:33:09.332728 55345 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240123 02:33:09.332767 55411 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:33:09.332805 55086 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:33:09.332847 55281 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:33:09.332870 55528 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:33:09.332898 55412 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:33:09.332940 55216 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240123 02:33:09.333088 55150 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
W20240123 02:33:09.334278 55412 grad_base.h:55] KGCacheController, config={
        "num_gpus": 8,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240123 02:33:09.334391 55412 grad_base.h:172] Init GradProcessingBase done
I20240123 02:33:09.340234 55412 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240123 02:33:09.340406 55412 kg_controller.h:78] after init GradAsyncProcessingV2
I20240123 02:33:09.340418 55412 kg_controller.h:84] Construct KGCacheController done
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
[W socket.cpp:601] [c10d] The client socket has failed to connect to [localhost]:29500 (errno: 101 - Network is unreachable).
I20240123 02:33:11.087920 55412 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240123 02:33:12.200668 56170 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 02:33:12.201184 56170 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
I20240123 02:33:12.231637 55412 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240123 02:33:12.247156 55086 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:33:12.250892 55216 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:33:12.252154 55150 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:33:12.252986 55345 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:33:12.253502 55281 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:33:12.253753 55528 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240123 02:33:12.258841 55411 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 683.314 us                | 683.314 us                |
| Forward                   | 675.448 ms                | 675.448 ms                |
| Backward                  | 214.984 ms                | 214.984 ms                |
| Optimize                  | 1.391 ms                  | 1.391 ms                  |
| BarrierTimeBeforeRank0    | 274.219 ms                | 274.219 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:14.528415 55737 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 02:33:14.540947 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240123 02:33:14.552135 56170 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 02:33:15.535672 55737 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 02:33:15.544652 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=23, pq.top=23
W20240123 02:33:15.554224 56170 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.198 ms                  | 353.257 ms                |
| ProcessBack:UpdateCache   | 10.795 ms                 | 740.549 ms                |
| ProcessBack:UpsertPq      | 8.111 ms                  | 12.649 ms                 |
| ProcessOneStep            | 27.666 ms                 | 1.113 s                   |
| BlockToStepN              | 546.198 us                | 47.562 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:16.535459 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=6793
W20240123 02:33:16.558965 56170 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240123 02:33:16.576264 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=45, pq.top=45
E20240123 02:33:17.535179 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=12730
W20240123 02:33:17.565892 56170 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:33:17.609515 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=70, pq.top=70
E20240123 02:33:18.535017 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=3629
W20240123 02:33:18.568343 56170 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240123 02:33:18.609079 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=90, pq.top=90
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 6.856, sample: 0.227, forward: 1.031, backward: 0.691, update: 0.087
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 6.865, sample: 0.231, forward: 1.072, backward: 0.612, update: 0.091
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 6.861, sample: 0.227, forward: 1.133, backward: 0.563, update: 0.087
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 6.862, sample: 0.226, forward: 1.078, backward: 0.582, update: 0.083
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 6.868, sample: 0.236, forward: 1.231, backward: 0.681, update: 0.095
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 6.861, sample: 0.225, forward: 1.015, backward: 0.583, update: 0.090
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 6.861, sample: 0.228, forward: 1.084, backward: 0.703, update: 0.094
train_sampler.Prefill()
-------Step 0-------
tensor([   73,    27,  2715,  4160, 11662, 14256,  1090,   379, 10018,  9057]) tensor([ 1496, 11741,  7792, 10970,  9001,  1216,   650,  4978,  6736, 13975])
-------Step 1-------
tensor([   73,    27,  2715,  4160, 11662, 14256,  1090,   379, 10018,  9057]) tensor([ 7736,  8566,  1651, 11694, 11920, 12705, 13685,  2621, 14809,  8114])
-------Step 2-------
tensor([11520,  5179,  9949,  1310,  2078, 13433,  7831, 13438,    62,  8572]) tensor([ 5940,  3095, 12853,  8650, 13117,  7526,  7938,  1937,  6441,  7739])
-------Step 3-------
tensor([11520,  5179,  9949,  1310,  2078, 13433,  7831, 13438,    62,  8572]) tensor([ 8402,  2384,  6941,  5156, 11855,  7260,  3937,  8503,  9702, 13896])
-------Step 4-------
tensor([ 8268, 10172,  3150,  9447, 11308,    19,   832,     6, 12219,  6407]) tensor([ 6827,  6328,  4082, 10408,  9395, 14546, 14184,   448, 12512, 10492])
-------Step 5-------
tensor([ 8268, 10172,  3150,  9447, 11308,    19,   832,     6, 12219,  6407]) tensor([10201,  9654,   518,  8813, 10236,   397, 13704,  3117,  9079,   444])
-------Step 6-------
tensor([ 8472,  8402,  4217,  3059, 12859,  6525, 12915,    10, 13198,   976]) tensor([ 3024,  4929,  4230,  6650,  7986,  8633, 12641,  7291, 14524,  7397])
-------Step 7-------
tensor([ 8472,  8402,  4217,  3059, 12859,  6525, 12915,    10, 13198,   976]) tensor([11534, 11612,  9013,  3820, 12368,  9272, 11775,  2224, 11651, 10334])
-------Step 8-------
tensor([ 7067,  4914,  4995,     6, 12918,  5986, 11599,    19,  7093,    30]) tensor([ 8402,  5717, 13508,  1174,  6167,  1582,  1233,  1566,  9495,  1886])
-------Step 9-------
tensor([ 7067,  4914,  4995,     6, 12918,  5986, 11599,    19,  7093,    30]) tensor([ 8210,  5388,  4482,  5974,  2939, 13090,  7422,  1269,  7373,  3289])
before start barrier
start train
[proc 0] 100 steps, total: 6.883, sample: 0.242, forward: 1.068, backward: 0.560, update: 0.102
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.214 ms                  | 11.275 ms                 |
| Forward                   | 3.821 ms                  | 10.403 ms                 |
| Backward                  | 3.460 ms                  | 7.424 ms                  |
| Optimize                  | 1.072 ms                  | 2.120 ms                  |
| BarrierTimeBeforeRank0    | 1.730 ms                  | 10.405 ms                 |
| AfterBackward             | 27.981 ms                 | 40.820 ms                 |
| BlockToStepN              | 3.775 ms                  | 19.878 ms                 |
| OneStep                   | 45.358 ms                 | 98.714 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:19.535007 55737 parallel_pq_v2.h:76] insert failed, size(hashtable)=82
W20240123 02:33:19.591804 56170 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240123 02:33:19.632091 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=110, pq.top=110
E20240123 02:33:20.535013 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=4238
W20240123 02:33:20.614838 56170 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240123 02:33:20.654364 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=132, pq.top=132
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.093 ms                  | 17.276 ms                 |
| ProcessBack:UpdateCache   | 10.018 ms                 | 12.279 ms                 |
| ProcessBack:UpsertPq      | 8.902 ms                  | 13.786 ms                 |
| ProcessOneStep            | 28.291 ms                 | 40.382 ms                 |
| BlockToStepN              | 3.901 ms                  | 19.773 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:21.535545 55412 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 02:33:21.618165 56170 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:33:21.656884 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=153, pq.top=153
E20240123 02:33:22.535017 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=8515
W20240123 02:33:22.620045 56170 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:33:22.656294 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=173, pq.top=173
E20240123 02:33:23.535008 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=5431
W20240123 02:33:23.636466 56170 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:33:23.679255 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=193, pq.top=193
[proc 1] 200 steps, total: 5.038, sample: 0.216, forward: 0.360, backward: 0.350, update: 0.090
[proc 5] 200 steps, total: 5.038, sample: 0.250, forward: 0.359, backward: 0.351, update: 0.094
[proc 2] 200 steps, total: 5.038, sample: 0.221, forward: 0.335, backward: 0.355, update: 0.090
[proc 6] 200 steps, total: 5.039, sample: 0.227, forward: 0.352, backward: 0.380, update: 0.092
[proc 7] 200 steps, total: 5.038, sample: 0.256, forward: 0.342, backward: 0.373, update: 0.090
[proc 3] 200 steps, total: 5.039, sample: 0.229, forward: 0.367, backward: 0.367, update: 0.096
[proc 4] 200 steps, total: 5.038, sample: 0.245, forward: 0.363, backward: 0.367, update: 0.098
[proc 0] 200 steps, total: 5.038, sample: 0.285, forward: 0.410, backward: 0.356, update: 0.113
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.391 ms                  | 12.707 ms                 |
| Forward                   | 3.895 ms                  | 10.268 ms                 |
| Backward                  | 3.574 ms                  | 7.194 ms                  |
| Optimize                  | 1.101 ms                  | 2.393 ms                  |
| BarrierTimeBeforeRank0    | 729.941 us                | 10.405 ms                 |
| AfterBackward             | 28.256 ms                 | 45.004 ms                 |
| BlockToStepN              | 5.181 ms                  | 23.573 ms                 |
| OneStep                   | 46.307 ms                 | 78.570 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:24.535012 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=10461
W20240123 02:33:24.636855 56170 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:33:24.712900 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=210, pq.top=210
E20240123 02:33:25.535008 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=11808
W20240123 02:33:25.636126 56170 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240123 02:33:25.723918 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=229, pq.top=229
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.118 ms                  | 11.863 ms                 |
| ProcessBack:UpdateCache   | 10.024 ms                 | 13.163 ms                 |
| ProcessBack:UpsertPq      | 9.733 ms                  | 21.272 ms                 |
| ProcessOneStep            | 28.638 ms                 | 44.967 ms                 |
| BlockToStepN              | 5.814 ms                  | 28.218 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:26.535009 55412 parallel_pq_v2.h:76] insert failed, size(hashtable)=104
W20240123 02:33:26.638005 56170 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end6
W20240123 02:33:26.724691 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=247, pq.top=247
E20240123 02:33:27.535053 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=7366
W20240123 02:33:27.643573 56170 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240123 02:33:27.738729 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=265, pq.top=265
E20240123 02:33:28.535012 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=5601
W20240123 02:33:28.651135 56170 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240123 02:33:28.748458 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=283, pq.top=283
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.515 ms                  | 12.478 ms                 |
| Forward                   | 3.945 ms                  | 7.401 ms                  |
| Backward                  | 3.636 ms                  | 6.042 ms                  |
| Optimize                  | 1.117 ms                  | 2.120 ms                  |
| BarrierTimeBeforeRank0    | 368.716 us                | 10.002 ms                 |
| AfterBackward             | 29.405 ms                 | 44.536 ms                 |
| BlockToStepN              | 6.755 ms                  | 23.573 ms                 |
| OneStep                   | 49.631 ms                 | 75.461 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:29.535010 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=3406
W20240123 02:33:29.653707 56170 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:33:29.767961 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=300, pq.top=300
[proc 6] 300 steps, total: 5.623, sample: 0.207, forward: 0.349, backward: 0.364, update: 0.089
[proc 1] 300 steps, total: 5.623, sample: 0.222, forward: 0.355, backward: 0.374, update: 0.094
[proc 0] 300 steps, total: 5.622, sample: 0.295, forward: 0.427, backward: 0.362, update: 0.116
[proc 4] 300 steps, total: 5.623, sample: 0.221, forward: 0.355, backward: 0.372, update: 0.093
[proc 7] 300 steps, total: 5.623, sample: 0.207, forward: 0.346, backward: 0.370, update: 0.093
[proc 3] 300 steps, total: 5.623, sample: 0.226, forward: 0.360, backward: 0.391, update: 0.096
[proc 2] 300 steps, total: 5.623, sample: 0.215, forward: 0.352, backward: 0.374, update: 0.088
[proc 5] 300 steps, total: 5.623, sample: 0.211, forward: 0.335, backward: 0.381, update: 0.086
E20240123 02:33:30.535018 55412 parallel_pq_v2.h:76] insert failed, size(hashtable)=77
W20240123 02:33:30.676380 56170 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240123 02:33:30.784571 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=318, pq.top=318
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.212 ms                  | 11.848 ms                 |
| ProcessBack:UpdateCache   | 10.143 ms                 | 12.767 ms                 |
| ProcessBack:UpsertPq      | 10.183 ms                 | 21.272 ms                 |
| ProcessOneStep            | 29.599 ms                 | 44.495 ms                 |
| BlockToStepN              | 7.050 ms                  | 23.482 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:31.535010 55412 parallel_pq_v2.h:76] insert failed, size(hashtable)=24
W20240123 02:33:31.681375 56170 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240123 02:33:31.784019 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=335, pq.top=335
E20240123 02:33:32.535010 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=7393
W20240123 02:33:32.711254 56170 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240123 02:33:32.827953 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=353, pq.top=353
E20240123 02:33:33.535012 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=7018
W20240123 02:33:33.739188 56170 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end0
W20240123 02:33:33.829907 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=371, pq.top=371
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.624 ms                  | 12.478 ms                 |
| Forward                   | 4.110 ms                  | 6.919 ms                  |
| Backward                  | 3.664 ms                  | 6.058 ms                  |
| Optimize                  | 1.141 ms                  | 1.983 ms                  |
| BarrierTimeBeforeRank0    | 158.425 us                | 8.724 ms                  |
| AfterBackward             | 29.941 ms                 | 43.672 ms                 |
| BlockToStepN              | 7.553 ms                  | 23.573 ms                 |
| OneStep                   | 51.602 ms                 | 76.525 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:34.535010 55737 parallel_pq_v2.h:76] insert failed, size(hashtable)=135
W20240123 02:33:34.740273 56170 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
W20240123 02:33:34.829074 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=389, pq.top=389
[proc 7] 400 steps, total: 5.642, sample: 0.221, forward: 0.354, backward: 0.364, update: 0.095
[proc 3] 400 steps, total: 5.642, sample: 0.192, forward: 0.336, backward: 0.373, update: 0.090
[proc 0] 400 steps, total: 5.642, sample: 0.302, forward: 0.429, backward: 0.405, update: 0.113
[proc 1] 400 steps, total: 5.642, sample: 0.198, forward: 0.324, backward: 0.345, update: 0.086
[proc 6] 400 steps, total: 5.642, sample: 0.170, forward: 0.302, backward: 0.368, update: 0.081
[proc 5] 400 steps, total: 5.642, sample: 0.195, forward: 0.327, backward: 0.363, update: 0.088
[proc 4] 400 steps, total: 5.642, sample: 0.201, forward: 0.337, backward: 0.355, update: 0.088
[proc 2] 400 steps, total: 5.642, sample: 0.219, forward: 0.366, backward: 0.340, update: 0.094
E20240123 02:33:35.535012 56170 parallel_pq_v2.h:76] insert failed, size(hashtable)=107
W20240123 02:33:35.744642 56170 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240123 02:33:35.854740 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=408, pq.top=408
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.177 ms                  | 11.220 ms                 |
| ProcessBack:UpdateCache   | 10.216 ms                 | 12.767 ms                 |
| ProcessBack:UpsertPq      | 10.331 ms                 | 21.137 ms                 |
| ProcessOneStep            | 29.851 ms                 | 43.627 ms                 |
| BlockToStepN              | 7.611 ms                  | 27.988 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:36.535080 55412 parallel_pq_v2.h:76] insert failed, size(hashtable)=2585
W20240123 02:33:36.773468 56170 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240123 02:33:36.884621 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=426, pq.top=426
E20240123 02:33:37.535009 55412 parallel_pq_v2.h:76] insert failed, size(hashtable)=297
W20240123 02:33:37.788022 56170 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 02:33:37.884253 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=444, pq.top=444
E20240123 02:33:38.535024 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=1212
W20240123 02:33:38.817868 56170 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240123 02:33:38.918686 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=463, pq.top=463
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.642 ms                  | 12.624 ms                 |
| Forward                   | 3.945 ms                  | 6.732 ms                  |
| Backward                  | 3.677 ms                  | 6.073 ms                  |
| Optimize                  | 1.119 ms                  | 1.983 ms                  |
| BarrierTimeBeforeRank0    | 200.200 us                | 10.272 ms                 |
| AfterBackward             | 29.765 ms                 | 43.672 ms                 |
| BlockToStepN              | 8.098 ms                  | 28.066 ms                 |
| OneStep                   | 52.364 ms                 | 76.525 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240123 02:33:39.535863 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=5104
W20240123 02:33:39.817198 56170 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 02:33:39.945528 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=481, pq.top=481
E20240123 02:33:40.535017 56169 parallel_pq_v2.h:76] insert failed, size(hashtable)=7875
W20240123 02:33:40.817826 56170 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240123 02:33:40.977135 55412 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=499, pq.top=499
[proc 6] 500 steps, total: 5.622, sample: 0.198, forward: 0.333, backward: 0.367, update: 0.084
[proc 2] 500 steps, total: 5.622, sample: 0.204, forward: 0.338, backward: 0.324, update: 0.084
[proc 3] 500 steps, total: 5.622, sample: 0.205, forward: 0.326, backward: 0.365, update: 0.082
[proc 1] 500 steps, total: 5.622, sample: 0.219, forward: 0.334, backward: 0.340, update: 0.091
[proc 5] 500 steps, total: 5.622, sample: 0.202, forward: 0.334, backward: 0.373, update: 0.094
[proc 0] 500 steps, total: 5.622, sample: 0.282, forward: 0.383, backward: 0.376, update: 0.105
[proc 4] 500 steps, total: 5.622, sample: 0.199, forward: 0.330, backward: 0.358, update: 0.085
[proc 7] 500 steps, total: 5.623, sample: 0.179, forward: 0.316, backward: 0.350, update: 0.083
Successfully xmh. training takes 28.80959415435791 seconds
before call kg_cache_controller.StopThreads()
W20240123 02:33:41.041219 55412 grad_async_v2.h:71] call StopThreads. PID = 54668
W20240123 02:33:41.041249 55412 grad_base.h:210] before processOneStepNegThread_.join();
W20240123 02:33:41.041581 55412 grad_base.h:212] after processOneStepNegThread_.join();
W20240123 02:33:41.041587 55412 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240123 02:33:41.048691 55412 grad_async_v2.h:91] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 7.133 ms                  | 10.573 ms                 |
| ProcessBack:UpdateCache   | 10.251 ms                 | 12.767 ms                 |
| ProcessBack:UpsertPq      | 10.432 ms                 | 21.272 ms                 |
| ProcessOneStep            | 29.814 ms                 | 43.631 ms                 |
| BlockToStepN              | 8.215 ms                  | 28.218 ms                 |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7fa0a7a49b50>

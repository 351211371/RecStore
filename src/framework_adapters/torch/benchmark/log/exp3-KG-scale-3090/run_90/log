WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240123 22:15:27.666992 27230 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_37', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [27230 sampler.py:454] Start PreSampling
WARNING [27230 sampler.py:532] Before construct renumbering_dict
WARNING [27230 sampler.py:555] PreSampling done
W20240123 22:28:58.862684 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_0 [100000]0x100000002000 781.2 kB
W20240123 22:28:58.862883 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_1 [100000]0x1000000c7000 781.2 kB
W20240123 22:28:58.862907 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_2 [100000]0x10000018c000 781.2 kB
W20240123 22:28:58.862929 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_3 [100000]0x100000251000 781.2 kB
W20240123 22:28:58.862958 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_4 [100000]0x100000316000 781.2 kB
W20240123 22:28:58.862979 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_5 [100000]0x1000003db000 781.2 kB
W20240123 22:28:58.863003 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_6 [100000]0x1000004a0000 781.2 kB
W20240123 22:28:58.863039 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_7 [100000]0x100000565000 781.2 kB
W20240123 22:28:58.863063 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_8 [100000]0x10000062a000 781.2 kB
W20240123 22:28:58.863087 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r0_9 [100000]0x1000006ef000 781.2 kB
W20240123 22:28:58.863114 27230 IPCTensor.h:365] NewIPCTensor: step_r0 [10]0x1000007b4000 80 B 
W20240123 22:28:58.863135 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r0 [1]0x1000007b6000 8 B 
W20240123 22:28:58.863157 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x1000007b8000 8 B 
W20240123 22:28:58.863296 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_0 [100000]0x1000007ba000 781.2 kB
W20240123 22:28:58.863325 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_1 [100000]0x10000087f000 781.2 kB
W20240123 22:28:58.863344 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_2 [100000]0x100000944000 781.2 kB
W20240123 22:28:58.863381 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_3 [100000]0x100000a09000 781.2 kB
W20240123 22:28:58.863399 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_4 [100000]0x100000ace000 781.2 kB
W20240123 22:28:58.863422 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_5 [100000]0x100000b93000 781.2 kB
W20240123 22:28:58.863445 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_6 [100000]0x100000c58000 781.2 kB
W20240123 22:28:58.863468 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_7 [100000]0x100000d1d000 781.2 kB
W20240123 22:28:58.863494 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_8 [100000]0x100000de2000 781.2 kB
W20240123 22:28:58.863514 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r1_9 [100000]0x100000ea7000 781.2 kB
W20240123 22:28:58.863534 27230 IPCTensor.h:365] NewIPCTensor: step_r1 [10]0x100000f6c000 80 B 
W20240123 22:28:58.863548 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r1 [1]0x100000f6e000 8 B 
W20240123 22:28:58.863562 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100000f70000 8 B 
W20240123 22:28:58.863605 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_0 [100000]0x100000f72000 781.2 kB
W20240123 22:28:58.863623 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_1 [100000]0x100001037000 781.2 kB
W20240123 22:28:58.863638 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_2 [100000]0x1000010fc000 781.2 kB
W20240123 22:28:58.863662 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_3 [100000]0x1000011c1000 781.2 kB
W20240123 22:28:58.863682 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_4 [100000]0x100001286000 781.2 kB
W20240123 22:28:58.863703 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_5 [100000]0x10000134b000 781.2 kB
W20240123 22:28:58.863732 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_6 [100000]0x100001410000 781.2 kB
W20240123 22:28:58.863755 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_7 [100000]0x1000014d5000 781.2 kB
W20240123 22:28:58.863776 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_8 [100000]0x10000159a000 781.2 kB
W20240123 22:28:58.863792 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r2_9 [100000]0x10000165f000 781.2 kB
W20240123 22:28:58.863811 27230 IPCTensor.h:365] NewIPCTensor: step_r2 [10]0x100001724000 80 B 
W20240123 22:28:58.863823 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r2 [1]0x100001726000 8 B 
W20240123 22:28:58.863842 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x100001728000 8 B 
W20240123 22:28:58.863885 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_0 [100000]0x10000172a000 781.2 kB
W20240123 22:28:58.863909 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_1 [100000]0x1000017ef000 781.2 kB
W20240123 22:28:58.863927 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_2 [100000]0x1000018b4000 781.2 kB
W20240123 22:28:58.863945 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_3 [100000]0x100001979000 781.2 kB
W20240123 22:28:58.863963 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_4 [100000]0x100001a3e000 781.2 kB
W20240123 22:28:58.863986 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_5 [100000]0x100001b03000 781.2 kB
W20240123 22:28:58.864009 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_6 [100000]0x100001bc8000 781.2 kB
W20240123 22:28:58.864033 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_7 [100000]0x100001c8d000 781.2 kB
W20240123 22:28:58.864055 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_8 [100000]0x100001d52000 781.2 kB
W20240123 22:28:58.864076 27230 IPCTensor.h:365] NewIPCTensor: cached_sampler_r3_9 [100000]0x100001e17000 781.2 kB
W20240123 22:28:58.864092 27230 IPCTensor.h:365] NewIPCTensor: step_r3 [10]0x100001edc000 80 B 
W20240123 22:28:58.864105 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_r3 [1]0x100001ede000 8 B 
W20240123 22:28:58.864120 27230 IPCTensor.h:365] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100001ee0000 8 B 
W20240123 22:28:59.160566 27230 IPCTensor.h:365] NewIPCTensor: full_emb [86054151, 400]0x100001ee2000 128.2 GB
W20240123 22:28:59.160750 27230 IPCTensor.h:365] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102010b1a000 328.3 MB
{0: Graph(num_nodes=27256011, num_edges=100992629,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23779591, num_edges=94535774,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=26463902, num_edges=75890617,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=25398646, num_edges=93789131,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27256011 N 100992629 E
MertisPartition: part 1 has 23779591 N 94535774 E
MertisPartition: part 2 has 26463902 N 75890617 E
MertisPartition: part 3 has 25398646 N 93789131 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 4302718,  4302753,   358724,  ...,  3845696, 15031583, 84944112]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 3, 3, 3])}
part_g: DGLGraph(num_nodes=27256011, num_edges=100992629,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27256011, num_edges=100992629,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 988.978 seconds
[Rank1] pid = 55509
[Rank2] pid = 55606
INFO [27230 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [55509 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [55606 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [55680 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [55680 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [55606 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [27230 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [55509 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240123 22:32:00.080924 55744 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240123 22:32:00.080961 55608 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240123 22:32:00.082041 55681 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240123 22:32:00.082986 55510 IPCTensor.h:405] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240123 22:32:00.143535 55681 IPCTensor.h:365] NewIPCTensor: input_keys_0 [100000]0x102025369000 781.2 kB
W20240123 22:32:00.143559 55608 IPCTensor.h:365] NewIPCTensor: input_keys_2 [100000]0x10202542e000 781.2 kB
W20240123 22:32:00.143565 55744 IPCTensor.h:365] NewIPCTensor: input_keys_3 [100000]0x1020254f3000 781.2 kB
W20240123 22:32:00.143620 55510 IPCTensor.h:365] NewIPCTensor: input_keys_1 [100000]0x1020255b8000 781.2 kB
W20240123 22:32:00.143760 55681 IPCTensor.h:365] NewIPCTensor: input_keys_neg_0 [100000]0x10202567d000 781.2 kB
W20240123 22:32:00.143844 55681 IPCTensor.h:365] NewIPCTensor: backward_grads_0 [100000, 400]0x102025807000 152.6 MB
W20240123 22:32:00.143841 55510 IPCTensor.h:365] NewIPCTensor: input_keys_neg_1 [100000]0x102025742000 781.2 kB
W20240123 22:32:00.143865 55608 IPCTensor.h:365] NewIPCTensor: input_keys_neg_2 [100000]0x10202f09f000 781.2 kB
W20240123 22:32:00.143882 55744 IPCTensor.h:365] NewIPCTensor: input_keys_neg_3 [100000]0x10202f164000 781.2 kB
W20240123 22:32:00.143891 55681 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_0 [100000, 400]0x10202f229000 152.6 MB
W20240123 22:32:00.143951 55510 IPCTensor.h:365] NewIPCTensor: backward_grads_1 [100000, 400]0x102038ac1000 152.6 MB
W20240123 22:32:00.143970 55681 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 22:32:00.143997 55608 IPCTensor.h:365] NewIPCTensor: backward_grads_2 [100000, 400]0x102042359000 152.6 MB
W20240123 22:32:00.144007 55744 IPCTensor.h:365] NewIPCTensor: backward_grads_3 [100000, 400]0x10204bbf1000 152.6 MB
W20240123 22:32:00.144022 55510 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_1 [100000, 400]0x102055489000 152.6 MB
W20240123 22:32:00.144088 55608 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_2 [100000, 400]0x10205ed21000 152.6 MB
W20240123 22:32:00.144094 55744 IPCTensor.h:365] NewIPCTensor: backward_grads_neg_3 [100000, 400]0x1020685b9000 152.6 MB
W20240123 22:32:00.144104 55510 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 22:32:00.144168 55608 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 22:32:00.144182 55744 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_3_gpu [100000, 400]; dev=3; size=152.6 MB
W20240123 22:32:00.146322 55681 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_0_gpu [100000, 400]; dev=0; size=152.6 MB
W20240123 22:32:00.146346 55608 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_2_gpu [100000, 400]; dev=2; size=152.6 MB
W20240123 22:32:00.146349 55510 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_1_gpu [100000, 400]; dev=1; size=152.6 MB
W20240123 22:32:00.146370 55744 IPCTensor.h:405] NewIPCGPUTensor: backward_grads_neg_3_gpu [100000, 400]; dev=3; size=152.6 MB
cudaHostRegister 0x100001ee2000
2: KnownLocalCachedEmbedding init done
WARNING [55606 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
1: KnownLocalCachedEmbedding init done
WARNING [55509 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100001ee2000
3: KnownLocalCachedEmbedding init done
[Rank3] pid = 55680
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100001ee2000
0: KnownLocalCachedEmbedding init done
WARNING [55680 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [27230 DistTensor.py:56] The tensor name already exists in the kvstore
I20240123 22:32:28.539924 55681 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240123 22:32:28.539985 55744 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 22:32:28.540035 55510 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240123 22:32:28.540123 55608 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240123 22:32:28.541301 55681 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05
        }
W20240123 22:32:28.541404 55681 grad_base.h:172] Init GradProcessingBase done
I20240123 22:32:37.603847 55681 grad_async_v2.h:32] Use background thread to update emb. nr_background_threads=32
W20240123 22:32:37.603986 55681 kg_controller.h:78] after init GradAsyncProcessingV2
I20240123 22:32:37.603993 55681 kg_controller.h:84] Construct KGCacheController done
I20240123 22:32:38.042678 55681 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240123 22:32:49.596940 57410 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 22:32:49.597283 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 22:32:50.953995 57410 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 22:32:50.954102 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 22:32:54.314602 57410 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end1
E20240123 22:32:54.314816 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 22:32:55.799918 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 22:32:55.815534 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240123 22:32:55.843453 55608 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
W20240123 22:32:58.107751 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 22:32:58.125520 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240123 22:32:58.175050 55510 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240123 22:32:58.385617 55681 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240123 22:33:05.843076 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 22:33:05.866547 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
I20240123 22:33:05.907044 55744 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240123 22:33:07.657174 55681 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 22:33:07.714708 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240123 22:33:07.734973 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.510 ms                  | 193.761 ms                |
| ProcessBack:UpdateCache   | 2.652 ms                  | 292.946 ms                |
| ProcessBack:UpsertPq      | 21.077 ms                 | 57.257 ms                 |
| ProcessOneStep            | 43.239 ms                 | 549.968 ms                |
| BlockToStepN              | 16.055 ms                 | 33.229 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.585 ms                  | 104.756 ms                |
| Forward                   | 5.279 ms                  | 646.466 ms                |
| Backward                  | 5.296 ms                  | 160.469 ms                |
| Optimize                  | 2.208 ms                  | 2.354 ms                  |
| BarrierTimeBeforeRank0    | 3.744 ms                  | 430.500 ms                |
| AfterBackward             | 43.269 ms                 | 550.230 ms                |
| BlockToStepN              | 16.557 ms                 | 62.589 ms                 |
| OneStep                   | 99.670 ms                 | 1.824 s                   |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:08.657032 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=14969
W20240123 22:33:08.725457 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=12, pq.top=12
W20240123 22:33:08.912544 57410 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end5
E20240123 22:33:09.657019 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=23
W20240123 22:33:09.738103 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=21, pq.top=21
W20240123 22:33:10.070207 57410 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end3
E20240123 22:33:10.657008 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=9281
W20240123 22:33:10.784677 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=30, pq.top=30
W20240123 22:33:11.119161 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end2
E20240123 22:33:11.657027 56637 parallel_pq_v2.h:76] insert failed, size(hashtable)=1556
W20240123 22:33:12.188330 57410 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end8
E20240123 22:33:12.657011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=53
W20240123 22:33:12.812525 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=42, pq.top=42
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.629 ms                  | 192.830 ms                |
| ProcessBack:UpdateCache   | 2.790 ms                  | 292.876 ms                |
| ProcessBack:UpsertPq      | 21.077 ms                 | 99.158 ms                 |
| ProcessOneStep            | 47.718 ms                 | 565.648 ms                |
| BlockToStepN              | 312.016 us                | 80.009 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:13.308977 57410 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.708 ms                  | 104.756 ms                |
| Forward                   | 5.532 ms                  | 6.691 ms                  |
| Backward                  | 5.083 ms                  | 6.164 ms                  |
| Optimize                  | 2.274 ms                  | 4.411 ms                  |
| BarrierTimeBeforeRank0    | 2.372 ms                  | 34.018 ms                 |
| AfterBackward             | 43.269 ms                 | 550.230 ms                |
| BlockToStepN              | 485.874 us                | 80.080 ms                 |
| OneStep                   | 112.168 ms                | 1.824 s                   |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:13.657011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=24
W20240123 22:33:13.812062 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=53, pq.top=53
W20240123 22:33:14.330433 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end6
E20240123 22:33:14.657016 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=1489
W20240123 22:33:15.370108 57410 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end0
E20240123 22:33:15.657019 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=143
W20240123 22:33:16.030925 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=65, pq.top=65
W20240123 22:33:16.504340 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end0
E20240123 22:33:16.657014 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=925
W20240123 22:33:17.059906 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=76, pq.top=76
E20240123 22:33:17.657014 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=10878
W20240123 22:33:17.751510 57410 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.869 ms                  | 3.913 ms                  |
| ProcessBack:UpdateCache   | 2.736 ms                  | 4.246 ms                  |
| ProcessBack:UpsertPq      | 20.843 ms                 | 131.976 ms                |
| ProcessOneStep            | 43.239 ms                 | 565.648 ms                |
| BlockToStepN              | 419.975 us                | 79.929 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:18.186161 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=85, pq.top=85
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.015 ms                  | 107.655 ms                |
| Forward                   | 5.491 ms                  | 10.291 ms                 |
| Backward                  | 5.088 ms                  | 6.164 ms                  |
| Optimize                  | 2.320 ms                  | 9.498 ms                  |
| BarrierTimeBeforeRank0    | 84.469 us                 | 34.018 ms                 |
| AfterBackward             | 43.269 ms                 | 565.709 ms                |
| BlockToStepN              | 679.630 us                | 79.996 ms                 |
| OneStep                   | 106.710 ms                | 697.856 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:18.657017 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=20078
W20240123 22:33:19.069029 57410 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end4
E20240123 22:33:19.657012 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=158
W20240123 22:33:20.028391 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=97, pq.top=97
W20240123 22:33:20.075856 57410 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end8
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 14.431, sample: 1.227, forward: 1.301, backward: 0.722, update: 0.220
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 24.494, sample: 1.239, forward: 1.545, backward: 0.812, update: 0.220
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 22.163, sample: 1.527, forward: 1.382, backward: 0.713, update: 0.289
train_sampler.Prefill()
-------Step 0-------
tensor([  768110,  4579000,   768158,   768203,   768238,   768283, 45475092,
          236583,  4310448,   768327]) tensor([ 4986866, 26773945, 21069141, 52344535, 49430639, 26487399, 83851104,
        76946360, 49269334, 40042047])
-------Step 1-------
tensor([  768110,  4579000,   768158,   768203,   768238,   768283, 45475092,
          236583,  4310448,   768327]) tensor([39181838, 75028318, 17048726, 26660762, 39915817, 15593892, 42894829,
        75052457,   225006, 74588006])
-------Step 2-------
tensor([ 871777,  871805,   83591, 7897413,  871823, 4573144,  871851,  219508,
         871871,  871888]) tensor([16326635, 49264575, 25900187, 34078302, 77319178, 51082407, 10085059,
        14861393, 12497538, 61615369])
-------Step 3-------
tensor([ 871777,  871805,   83591, 7897413,  871823, 4573144,  871851,  219508,
         871871,  871888]) tensor([61414852, 43753938, 68249122,   107679, 54646210, 36851436, 55666913,
        36533453, 70772529, 26881842])
-------Step 4-------
tensor([  928514,   928534,   928554,   928575,   928597, 75694085,    98397,
        41731625,   928612,   928632]) tensor([ 1003948,   520918, 62547052, 58818202, 53270003, 36735735, 16159238,
        10880652, 43029295, 42037284])
-------Step 5-------
tensor([  928514,   928534,   928554,   928575,   928597, 75694085,    98397,
        41731625,   928612,   928632]) tensor([ 7303993, 13278192, 44515685, 40790503, 66574610,  1408087, 42724176,
        23079304,  6186238, 59861915])
-------Step 6-------
tensor([978025, 978043, 978054, 964877, 978069, 978089, 978102, 978124, 978141,
        978155]) tensor([ 9067450, 80869064, 27275335,  8736964, 14391488, 24836518,   414478,
        25592190, 19737274, 67112979])
-------Step 7-------
tensor([978025, 978043, 978054, 964877, 978069, 978089, 978102, 978124, 978141,
        978155]) tensor([44238149, 76475232, 58217168, 61151212, 44911628, 44556757, 67513033,
        65539148, 45439982, 69409951])
-------Step 8-------
tensor([  136929,   128263, 69444114,   518372,  1022752,   128299,  1014068,
         1022776,  1022795,   128342]) tensor([31925279, 34165288, 21982111,  2089740,  5734918, 26055760, 12657935,
        56680312, 57929986, 44125962])
-------Step 9-------
tensor([  136929,   128263, 69444114,   518372,  1022752,   128299,  1014068,
         1022776,  1022795,   128342]) tensor([  837898, 48125093, 72935640,  5899156, 81199013, 25036287, 85977927,
        16305187, 68896375, 44119051])
before start barrier
start train
[proc 0] 100 steps, total: 21.952, sample: 1.582, forward: 1.198, backward: 0.672, update: 0.255
E20240123 22:33:20.657011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=49
W20240123 22:33:21.028162 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=107, pq.top=107
W20240123 22:33:21.300698 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end0
E20240123 22:33:21.657033 56637 parallel_pq_v2.h:76] insert failed, size(hashtable)=191
W20240123 22:33:22.188068 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=115, pq.top=115
W20240123 22:33:22.324687 57410 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end7
E20240123 22:33:22.658389 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.906 ms                  | 13.854 ms                 |
| ProcessBack:UpdateCache   | 2.664 ms                  | 4.246 ms                  |
| ProcessBack:UpsertPq      | 15.941 ms                 | 131.976 ms                |
| ProcessOneStep            | 32.803 ms                 | 632.653 ms                |
| BlockToStepN              | 7.851 ms                  | 80.009 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:23.188254 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=124, pq.top=124
W20240123 22:33:23.425210 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.167 ms                  | 115.182 ms                |
| Forward                   | 5.464 ms                  | 10.291 ms                 |
| Backward                  | 5.296 ms                  | 7.374 ms                  |
| Optimize                  | 2.287 ms                  | 9.498 ms                  |
| BarrierTimeBeforeRank0    | 53.138 us                 | 70.334 ms                 |
| AfterBackward             | 32.575 ms                 | 632.715 ms                |
| BlockToStepN              | 13.973 ms                 | 80.080 ms                 |
| OneStep                   | 102.318 ms                | 799.271 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:23.658007 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=19282
W20240123 22:33:24.512840 57410 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end4
E20240123 22:33:24.658011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=378
W20240123 22:33:24.914049 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=135, pq.top=135
W20240123 22:33:25.571985 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end2
E20240123 22:33:25.658116 56637 parallel_pq_v2.h:76] insert failed, size(hashtable)=1501
W20240123 22:33:25.927923 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=146, pq.top=146
W20240123 22:33:26.576166 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end1
E20240123 22:33:26.658018 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=23218
W20240123 22:33:26.936859 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=154, pq.top=154
E20240123 22:33:27.658013 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=300
W20240123 22:33:27.685374 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
W20240123 22:33:27.936180 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=165, pq.top=165
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.898 ms                  | 6.050 ms                  |
| ProcessBack:UpdateCache   | 2.591 ms                  | 4.246 ms                  |
| ProcessBack:UpsertPq      | 14.106 ms                 | 127.600 ms                |
| ProcessOneStep            | 32.333 ms                 | 632.653 ms                |
| BlockToStepN              | 15.359 ms                 | 82.168 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.169 ms                  | 117.584 ms                |
| Forward                   | 5.458 ms                  | 13.797 ms                 |
| Backward                  | 5.359 ms                  | 7.374 ms                  |
| Optimize                  | 2.287 ms                  | 6.519 ms                  |
| BarrierTimeBeforeRank0    | 45.598 us                 | 70.334 ms                 |
| AfterBackward             | 32.391 ms                 | 632.715 ms                |
| BlockToStepN              | 16.199 ms                 | 82.280 ms                 |
| OneStep                   | 99.670 ms                 | 697.856 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:28.658011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=3598
W20240123 22:33:28.788213 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
W20240123 22:33:28.952241 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=174, pq.top=174
E20240123 22:33:29.658206 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=4
W20240123 22:33:30.108898 57410 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end4
W20240123 22:33:30.223462 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=185, pq.top=185
E20240123 22:33:30.658007 55681 parallel_pq_v2.h:76] insert failed, size(hashtable)=5331
W20240123 22:33:31.247853 57410 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
W20240123 22:33:31.314266 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=195, pq.top=195
E20240123 22:33:31.658035 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=2248
[proc 3] 200 steps, total: 11.575, sample: 1.036, forward: 0.469, backward: 0.577, update: 0.210
[proc 0] 200 steps, total: 11.574, sample: 1.745, forward: 0.567, backward: 0.606, update: 0.236
[proc 1] 200 steps, total: 11.575, sample: 1.558, forward: 0.532, backward: 0.598, update: 0.249
[proc 2] 200 steps, total: 11.575, sample: 1.402, forward: 0.539, backward: 0.515, update: 0.216
W20240123 22:33:32.274504 57410 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end4
W20240123 22:33:32.333379 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=204, pq.top=204
E20240123 22:33:32.658011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=29391
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.996 ms                  | 6.050 ms                  |
| ProcessBack:UpdateCache   | 2.646 ms                  | 4.560 ms                  |
| ProcessBack:UpsertPq      | 15.163 ms                 | 121.348 ms                |
| ProcessOneStep            | 32.385 ms                 | 632.653 ms                |
| BlockToStepN              | 19.256 ms                 | 100.148 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:33.377683 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=214, pq.top=213
W20240123 22:33:33.382145 57410 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.167 ms                  | 117.584 ms                |
| Forward                   | 5.437 ms                  | 13.797 ms                 |
| Backward                  | 5.375 ms                  | 32.023 ms                 |
| Optimize                  | 2.296 ms                  | 6.519 ms                  |
| BarrierTimeBeforeRank0    | 37.621 us                 | 70.334 ms                 |
| AfterBackward             | 32.391 ms                 | 632.715 ms                |
| BlockToStepN              | 19.340 ms                 | 104.674 ms                |
| OneStep                   | 98.023 ms                 | 697.856 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:33.658011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=14
W20240123 22:33:34.428436 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=225, pq.top=225
W20240123 22:33:34.553289 57410 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end7
E20240123 22:33:34.658007 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=2885
W20240123 22:33:35.562434 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=233, pq.top=233
W20240123 22:33:35.597728 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end4
E20240123 22:33:35.658005 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=2288
W20240123 22:33:36.588150 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=243, pq.top=243
W20240123 22:33:36.652832 57410 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end4
E20240123 22:33:36.658176 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=1
W20240123 22:33:37.588021 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=251, pq.top=251
E20240123 22:33:37.658010 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=21
W20240123 22:33:37.670454 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 3.004 ms                  | 7.368 ms                  |
| ProcessBack:UpdateCache   | 2.748 ms                  | 4.322 ms                  |
| ProcessBack:UpsertPq      | 14.609 ms                 | 109.612 ms                |
| ProcessOneStep            | 32.333 ms                 | 565.648 ms                |
| BlockToStepN              | 19.256 ms                 | 109.693 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.167 ms                  | 115.182 ms                |
| Forward                   | 5.395 ms                  | 10.291 ms                 |
| Backward                  | 5.359 ms                  | 7.374 ms                  |
| Optimize                  | 2.296 ms                  | 4.882 ms                  |
| BarrierTimeBeforeRank0    | 50.247 us                 | 48.091 ms                 |
| AfterBackward             | 32.302 ms                 | 565.709 ms                |
| BlockToStepN              | 19.389 ms                 | 117.238 ms                |
| OneStep                   | 98.703 ms                 | 697.342 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:38.634968 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=263, pq.top=263
E20240123 22:33:38.658016 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=21289
W20240123 22:33:38.816663 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end4
W20240123 22:33:39.634507 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=271, pq.top=271
E20240123 22:33:39.658015 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=11560
W20240123 22:33:39.940703 57410 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end3
W20240123 22:33:40.634425 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=281, pq.top=281
E20240123 22:33:40.658004 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=14956
W20240123 22:33:40.942773 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end5
E20240123 22:33:41.659178 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=3491
W20240123 22:33:41.741782 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=289, pq.top=289
W20240123 22:33:41.998967 57410 grad_async_v2.h:120] Detect new sample comes, old_end0, new_end3
E20240123 22:33:42.659009 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=51433
[proc 1] 300 steps, total: 10.795, sample: 1.196, forward: 0.512, backward: 0.546, update: 0.255
[proc 2] 300 steps, total: 10.795, sample: 1.310, forward: 0.513, backward: 0.555, update: 0.233
[proc 3] 300 steps, total: 10.795, sample: 1.188, forward: 0.603, backward: 0.659, update: 0.268
[proc 0] 300 steps, total: 10.795, sample: 1.484, forward: 0.514, backward: 0.533, update: 0.229
W20240123 22:33:42.768311 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=301, pq.top=301
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 3.009 ms                  | 6.982 ms                  |
| ProcessBack:UpdateCache   | 2.874 ms                  | 4.264 ms                  |
| ProcessBack:UpsertPq      | 14.091 ms                 | 105.173 ms                |
| ProcessOneStep            | 32.377 ms                 | 565.648 ms                |
| BlockToStepN              | 20.299 ms                 | 145.420 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:43.128403 57410 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.416 ms                  | 115.182 ms                |
| Forward                   | 5.367 ms                  | 10.291 ms                 |
| Backward                  | 5.357 ms                  | 7.374 ms                  |
| Optimize                  | 2.296 ms                  | 4.882 ms                  |
| BarrierTimeBeforeRank0    | 56.168 us                 | 48.091 ms                 |
| AfterBackward             | 32.418 ms                 | 565.709 ms                |
| BlockToStepN              | 21.350 ms                 | 145.568 ms                |
| OneStep                   | 98.023 ms                 | 697.342 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:43.659010 55681 parallel_pq_v2.h:76] insert failed, size(hashtable)=0
W20240123 22:33:44.027988 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=311, pq.top=311
W20240123 22:33:44.142725 57410 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end2
E20240123 22:33:44.659008 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=38174
W20240123 22:33:45.154156 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=323, pq.top=323
W20240123 22:33:45.351509 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end5
E20240123 22:33:45.659020 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=2471
W20240123 22:33:46.184250 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=335, pq.top=335
W20240123 22:33:46.434989 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240123 22:33:46.659186 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=36354
W20240123 22:33:47.184154 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=342, pq.top=342
W20240123 22:33:47.449700 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end3
E20240123 22:33:47.659010 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=3104
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.994 ms                  | 7.394 ms                  |
| ProcessBack:UpdateCache   | 2.830 ms                  | 4.246 ms                  |
| ProcessBack:UpsertPq      | 13.873 ms                 | 99.158 ms                 |
| ProcessOneStep            | 32.510 ms                 | 565.648 ms                |
| BlockToStepN              | 21.493 ms                 | 178.340 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:48.224720 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=351, pq.top=351
W20240123 22:33:48.481736 57410 grad_async_v2.h:120] Detect new sample comes, old_end9, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.594 ms                  | 108.685 ms                |
| Forward                   | 5.338 ms                  | 10.291 ms                 |
| Backward                  | 5.372 ms                  | 10.501 ms                 |
| Optimize                  | 2.287 ms                  | 4.770 ms                  |
| BarrierTimeBeforeRank0    | 55.607 us                 | 48.091 ms                 |
| AfterBackward             | 32.471 ms                 | 550.230 ms                |
| BlockToStepN              | 22.093 ms                 | 147.029 ms                |
| OneStep                   | 96.663 ms                 | 618.681 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:48.659013 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=5170
W20240123 22:33:49.270321 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=361, pq.top=361
W20240123 22:33:49.619498 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end5
E20240123 22:33:49.659008 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=19580
E20240123 22:33:50.659011 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=6462
W20240123 22:33:50.662598 57410 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
W20240123 22:33:50.735428 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=369, pq.top=369
E20240123 22:33:51.659009 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=16286
W20240123 22:33:51.735311 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=377, pq.top=377
W20240123 22:33:51.745558 57410 grad_async_v2.h:120] Detect new sample comes, old_end5, new_end7
E20240123 22:33:52.659009 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=110293
W20240123 22:33:52.753428 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=387, pq.top=387
W20240123 22:33:52.890570 57410 grad_async_v2.h:120] Detect new sample comes, old_end2, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.975 ms                  | 7.394 ms                  |
| ProcessBack:UpdateCache   | 2.774 ms                  | 4.246 ms                  |
| ProcessBack:UpsertPq      | 14.060 ms                 | 97.584 ms                 |
| ProcessOneStep            | 32.510 ms                 | 565.648 ms                |
| BlockToStepN              | 22.465 ms                 | 151.384 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.594 ms                  | 113.079 ms                |
| Forward                   | 5.338 ms                  | 10.291 ms                 |
| Backward                  | 5.372 ms                  | 10.501 ms                 |
| Optimize                  | 2.294 ms                  | 4.882 ms                  |
| BarrierTimeBeforeRank0    | 52.719 us                 | 48.091 ms                 |
| AfterBackward             | 32.544 ms                 | 565.709 ms                |
| BlockToStepN              | 22.540 ms                 | 151.560 ms                |
| OneStep                   | 98.477 ms                 | 660.095 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:53.659010 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=60222
W20240123 22:33:53.753293 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=391, pq.top=391
W20240123 22:33:53.915773 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end2
E20240123 22:33:54.659015 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=31309
W20240123 22:33:54.773365 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=398, pq.top=398
W20240123 22:33:54.922600 57410 grad_async_v2.h:120] Detect new sample comes, old_end8, new_end9
[proc 3] 400 steps, total: 12.310, sample: 0.835, forward: 0.499, backward: 0.556, update: 0.209
[proc 0] 400 steps, total: 12.310, sample: 1.592, forward: 0.546, backward: 0.551, update: 0.240
[proc 2] 400 steps, total: 12.310, sample: 1.485, forward: 0.522, backward: 0.589, update: 0.240
[proc 1] 400 steps, total: 12.310, sample: 1.249, forward: 0.495, backward: 0.588, update: 0.216
E20240123 22:33:55.659018 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=74257
W20240123 22:33:55.867535 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=407, pq.top=407
W20240123 22:33:56.055032 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240123 22:33:56.659009 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=19280
W20240123 22:33:56.867835 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=415, pq.top=415
W20240123 22:33:57.092459 57410 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
E20240123 22:33:57.659009 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=26021
W20240123 22:33:57.899657 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=423, pq.top=423
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.932 ms                  | 7.394 ms                  |
| ProcessBack:UpdateCache   | 2.793 ms                  | 4.246 ms                  |
| ProcessBack:UpsertPq      | 14.000 ms                 | 97.584 ms                 |
| ProcessOneStep            | 32.377 ms                 | 565.648 ms                |
| BlockToStepN              | 22.667 ms                 | 208.784 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 22:33:58.118952 57410 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.391 ms                  | 113.079 ms                |
| Forward                   | 5.357 ms                  | 10.291 ms                 |
| Backward                  | 5.399 ms                  | 10.501 ms                 |
| Optimize                  | 2.307 ms                  | 4.882 ms                  |
| BarrierTimeBeforeRank0    | 40.874 us                 | 48.091 ms                 |
| AfterBackward             | 32.391 ms                 | 565.709 ms                |
| BlockToStepN              | 22.719 ms                 | 208.929 ms                |
| OneStep                   | 98.764 ms                 | 697.342 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:33:58.659011 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=32231
W20240123 22:33:58.976310 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=433, pq.top=433
W20240123 22:33:59.195959 57410 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end5
E20240123 22:33:59.659013 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=86989
W20240123 22:34:00.004335 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=440, pq.top=440
W20240123 22:34:00.245105 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end3
E20240123 22:34:00.659577 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=98134
W20240123 22:34:01.023806 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=452, pq.top=452
W20240123 22:34:01.296275 57410 grad_async_v2.h:120] Detect new sample comes, old_end1, new_end5
E20240123 22:34:01.659031 57409 parallel_pq_v2.h:76] insert failed, size(hashtable)=55995
W20240123 22:34:02.095924 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=456, pq.top=456
W20240123 22:34:02.301069 57410 grad_async_v2.h:120] Detect new sample comes, old_end7, new_end8
E20240123 22:34:02.659013 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=721
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.904 ms                  | 7.394 ms                  |
| ProcessBack:UpdateCache   | 2.715 ms                  | 4.239 ms                  |
| ProcessBack:UpsertPq      | 13.933 ms                 | 97.584 ms                 |
| ProcessOneStep            | 32.260 ms                 | 549.968 ms                |
| BlockToStepN              | 22.626 ms                 | 219.143 ms                |
+---------------------------+---------------------------+---------------------------+
W20240123 22:34:03.099680 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=467, pq.top=467
W20240123 22:34:03.463258 57410 grad_async_v2.h:120] Detect new sample comes, old_end4, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.178 ms                  | 108.685 ms                |
| Forward                   | 5.343 ms                  | 10.291 ms                 |
| Backward                  | 5.400 ms                  | 8.004 ms                  |
| Optimize                  | 2.296 ms                  | 4.770 ms                  |
| BarrierTimeBeforeRank0    | 38.303 us                 | 43.356 ms                 |
| AfterBackward             | 32.302 ms                 | 550.230 ms                |
| BlockToStepN              | 22.819 ms                 | 219.270 ms                |
| OneStep                   | 98.773 ms                 | 697.342 ms                |
+---------------------------+---------------------------+---------------------------+
E20240123 22:34:03.659009 55681 parallel_pq_v2.h:76] insert failed, size(hashtable)=1375
W20240123 22:34:04.099987 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=476, pq.top=476
E20240123 22:34:04.659013 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=57926
W20240123 22:34:04.670374 57410 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end2
W20240123 22:34:05.564355 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=486, pq.top=486
E20240123 22:34:05.659026 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=7629
W20240123 22:34:05.674151 57410 grad_async_v2.h:120] Detect new sample comes, old_end6, new_end7
W20240123 22:34:06.576323 55681 grad_async_v2.h:249] Sleep in <BlockToStepN>, step_no=495, pq.top=495
E20240123 22:34:06.659015 57410 parallel_pq_v2.h:76] insert failed, size(hashtable)=61872
W20240123 22:34:06.788242 57410 grad_async_v2.h:120] Detect new sample comes, old_end3, new_end7
[proc 1] 500 steps, total: 12.020, sample: 0.996, forward: 0.527, backward: 0.614, update: 0.225
[proc 2] 500 steps, total: 12.020, sample: 1.120, forward: 0.517, backward: 0.557, update: 0.234
[proc 0] 500 steps, total: 12.020, sample: 1.410, forward: 0.519, backward: 0.562, update: 0.232
[proc 3] 500 steps, total: 12.020, sample: 1.019, forward: 0.512, backward: 0.559, update: 0.225
Successfully xmh. training takes 68.65197896957397 seconds
before call kg_cache_controller.StopThreads()
W20240123 22:34:07.037592 55681 grad_async_v2.h:71] call StopThreads. PID = 27230
W20240123 22:34:07.037622 55681 grad_base.h:210] before processOneStepNegThread_.join();
W20240123 22:34:07.037961 55681 grad_base.h:212] after processOneStepNegThread_.join();
W20240123 22:34:07.037987 55681 grad_async_v2.h:73] call GradProcessingBase::StopThreads.
W20240123 22:34:07.333016 55681 grad_async_v2.h:91] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.878 ms                  | 7.492 ms                  |
| ProcessBack:UpdateCache   | 2.694 ms                  | 4.239 ms                  |
| ProcessBack:UpsertPq      | 13.825 ms                 | 96.468 ms                 |
| ProcessOneStep            | 32.377 ms                 | 565.648 ms                |
| BlockToStepN              | 23.040 ms                 | 219.143 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.123 ms                  | 108.685 ms                |
| Forward                   | 5.313 ms                  | 10.291 ms                 |
| Backward                  | 5.409 ms                  | 10.501 ms                 |
| Optimize                  | 2.296 ms                  | 4.770 ms                  |
| BarrierTimeBeforeRank0    | 38.436 us                 | 43.356 ms                 |
| AfterBackward             | 32.418 ms                 | 565.709 ms                |
| BlockToStepN              | 23.131 ms                 | 219.270 ms                |
| OneStep                   | 99.153 ms                 | 697.342 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240129 02:42:41.848939 1152098 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_97', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [1152098 sampler.py:454] Start PreSampling
WARNING [1152098 sampler.py:532] Before construct renumbering_dict
WARNING [1152098 sampler.py:555] PreSampling done
W20240129 02:42:44.274585 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240129 02:42:44.274757 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240129 02:42:44.274786 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240129 02:42:44.274811 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240129 02:42:44.274830 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240129 02:42:44.274852 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240129 02:42:44.274874 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240129 02:42:44.274904 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240129 02:42:44.274925 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240129 02:42:44.274946 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240129 02:42:44.274971 1152098 IPCTensor.h:368] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240129 02:42:44.274991 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240129 02:42:44.275005 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240129 02:42:44.275106 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240129 02:42:44.275136 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240129 02:42:44.275154 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240129 02:42:44.275185 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240129 02:42:44.275202 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240129 02:42:44.275223 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240129 02:42:44.275250 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240129 02:42:44.275277 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240129 02:42:44.275295 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240129 02:42:44.275313 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240129 02:42:44.275334 1152098 IPCTensor.h:368] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240129 02:42:44.275348 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240129 02:42:44.275363 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240129 02:42:44.275399 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240129 02:42:44.275421 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240129 02:42:44.275444 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240129 02:42:44.275465 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240129 02:42:44.275487 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240129 02:42:44.275506 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240129 02:42:44.275524 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240129 02:42:44.275542 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240129 02:42:44.275558 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240129 02:42:44.275575 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240129 02:42:44.275591 1152098 IPCTensor.h:368] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240129 02:42:44.275606 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240129 02:42:44.275621 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240129 02:42:44.275655 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240129 02:42:44.275673 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240129 02:42:44.275693 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240129 02:42:44.275717 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240129 02:42:44.275733 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240129 02:42:44.275764 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240129 02:42:44.275786 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240129 02:42:44.275812 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240129 02:42:44.275833 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240129 02:42:44.275857 1152098 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240129 02:42:44.275877 1152098 IPCTensor.h:368] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240129 02:42:44.275892 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240129 02:42:44.275910 1152098 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240129 02:42:44.445441 1152098 IPCTensor.h:368] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240129 02:42:44.445564 1152098 IPCTensor.h:368] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 849, 1039, 1112,  ..., 1623, 5979, 7169]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.631 seconds
[Rank1] pid = 1152310
[Rank2] pid = 1152374
INFO [1152098 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [1152310 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [1152439 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [1152374 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [1152098 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1152374 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1152439 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [1152310 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240129 02:42:47.952859 1152440 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240129 02:42:47.953655 1152376 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240129 02:42:47.953724 1152440 IPCTensor.h:368] NewIPCTensor: input_keys_0 [1000000]0x100014876000 7.629 MB
W20240129 02:42:47.953867 1152311 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240129 02:42:47.953949 1152440 IPCTensor.h:368] NewIPCTensor: input_keys_neg_0 [1000000]0x100015019000 7.629 MB
W20240129 02:42:47.954042 1152440 IPCTensor.h:368] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000157bc000 1.49 GB
W20240129 02:42:47.954098 1152440 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100074d9f000 1.49 GB
W20240129 02:42:47.954216 1152440 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 02:42:47.954310 1152376 IPCTensor.h:368] NewIPCTensor: input_keys_2 [1000000]0x1000d4386000 7.629 MB
W20240129 02:42:47.954461 1152311 IPCTensor.h:368] NewIPCTensor: input_keys_1 [1000000]0x1000d4b29000 7.629 MB
W20240129 02:42:47.954612 1152311 IPCTensor.h:368] NewIPCTensor: input_keys_neg_1 [1000000]0x1000d52cc000 7.629 MB
W20240129 02:42:47.954654 1152311 IPCTensor.h:368] NewIPCTensor: backward_grads_1 [1000000, 400]0x1000d5a6f000 1.49 GB
W20240129 02:42:47.954685 1152311 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x100135052000 1.49 GB
W20240129 02:42:47.954725 1152311 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 02:42:47.957490 1152441 IPCTensor.h:408] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240129 02:42:47.960988 1152376 IPCTensor.h:368] NewIPCTensor: input_keys_neg_2 [1000000]0x100194635000 7.629 MB
W20240129 02:42:47.961076 1152376 IPCTensor.h:368] NewIPCTensor: backward_grads_2 [1000000, 400]0x100194dd8000 1.49 GB
W20240129 02:42:47.961109 1152376 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1001f43bb000 1.49 GB
W20240129 02:42:47.961160 1152376 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 02:42:47.961360 1152440 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240129 02:42:47.962723 1152311 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240129 02:42:47.962821 1152441 IPCTensor.h:368] NewIPCTensor: input_keys_3 [1000000]0x1002539a4000 7.629 MB
W20240129 02:42:47.962955 1152441 IPCTensor.h:368] NewIPCTensor: input_keys_neg_3 [1000000]0x100254147000 7.629 MB
W20240129 02:42:47.963007 1152441 IPCTensor.h:368] NewIPCTensor: backward_grads_3 [1000000, 400]0x1002548ea000 1.49 GB
W20240129 02:42:47.963047 1152441 IPCTensor.h:368] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1002b3ecd000 1.49 GB
W20240129 02:42:47.963085 1152441 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240129 02:42:47.969403 1152376 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240129 02:42:47.975698 1152441 IPCTensor.h:408] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [1152374 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [1152439 DistTensor.py:56] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [1152310 DistTensor.py:56] The tensor name already exists in the kvstore
[Rank3] pid = 1152439
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [1152098 DistTensor.py:56] The tensor name already exists in the kvstore
I20240129 02:42:49.629233 1152440 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240129 02:42:49.629398 1152441 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 02:42:49.629593 1152376 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240129 02:42:49.629658 1152311 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240129 02:42:49.631284 1152440 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 1,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240129 02:42:49.631417 1152440 grad_base.h:184] Init GradProcessingBase done
I20240129 02:42:49.633595 1152440 grad_async_v1.h:199] Use main thread to update emb.
W20240129 02:42:49.633633 1152440 kg_controller.h:75] after init GradAsyncProcessing
I20240129 02:42:49.633638 1152440 kg_controller.h:84] Construct KGCacheController done
E20240129 02:42:50.971490 1152376 recstore.cc:66] init folly done
E20240129 02:42:50.971525 1152441 recstore.cc:66] init folly done
E20240129 02:42:50.971547 1152440 recstore.cc:66] init folly done
E20240129 02:42:50.971616 1152311 recstore.cc:66] init folly done
I20240129 02:42:50.972431 1152440 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240129 02:42:51.622437 1152824 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
I20240129 02:42:51.646718 1152440 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240129 02:42:51.647639 1152376 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 02:42:51.651219 1152311 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240129 02:42:51.682543 1152441 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240129 02:42:54.052876 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240129 02:42:54.074453 1152824 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 800.963 us                | 14.561 ms                 |
| Forward                   | 3.014 ms                  | 917.004 ms                |
| Backward                  | 4.905 ms                  | 302.444 ms                |
| Optimize                  | 1.059 ms                  | 3.923 ms                  |
| BarrierTimeBeforeRank0    | 29.790 us                 | 5.037 ms                  |
| AfterBackward             | 7.175 ms                  | 1.141 s                   |
| BlockToStepN              | 994.145 us                | 19.569 ms                 |
| OneStep                   | 22.944 ms                 | 2.391 s                   |
+---------------------------+---------------------------+---------------------------+
W20240129 02:42:55.052008 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=35, pq.top=35
W20240129 02:42:55.097290 1152824 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.729 ms                  | 196.465 ms                |
| ProcessBack:UpdateCache   | 1.323 ms                  | 285.014 ms                |
| ProcessBack:UpsertPq      | 3.678 ms                  | 9.497 ms                  |
| ProcessOneStep            | 7.380 ms                  | 13.263 ms                 |
| BlockToStepN              | 17.839 ms                 | 37.052 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:42:56.052023 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=55, pq.top=55
W20240129 02:42:56.124872 1152824 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 02:42:57.063725 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=72, pq.top=72
W20240129 02:42:57.126648 1152824 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 02:42:58.063335 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=87, pq.top=87
W20240129 02:42:58.130733 1152824 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 7.387, sample: 0.137, forward: 1.136, backward: 0.666, update: 0.092
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 7.352, sample: 0.166, forward: 1.164, backward: 0.788, update: 0.099
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.383, sample: 0.149, forward: 1.169, backward: 0.773, update: 0.096
train_sampler.Prefill()
-------Step 0-------
tensor([ 7755,  3575,  9273,  7365,  8380,  4009,   713,  4489, 11801,  9974]) tensor([ 1112,  7777,  9346,   665,  7609,  7328, 12637,  7632,  7825,  7896])
-------Step 1-------
tensor([ 7755,  3575,  9273,  7365,  8380,  4009,   713,  4489, 11801,  9974]) tensor([ 7620, 11432, 12125, 14904,  6609,  8984,  6251,  1636,  2104,  8922])
-------Step 2-------
tensor([ 8425,  2241,  3480,    49, 10074,  9132,  4721, 10068, 10886,  7417]) tensor([10891,  3657,  3371, 13731,  1675,  2078, 12109,  5776, 12251,  6377])
-------Step 3-------
tensor([ 8425,  2241,  3480,    49, 10074,  9132,  4721, 10068, 10886,  7417]) tensor([ 4911, 12316,  6653, 13336,  2236,  7495,  1657, 12577,  5070,   144])
-------Step 4-------
tensor([  158, 14153, 10075, 10062,  4944,  5840, 13021,  6781,  3724,  1431]) tensor([14542,  5216,  9893, 11174,  3624, 10035,  6343,   552,  9065, 13687])
-------Step 5-------
tensor([  158, 14153, 10075, 10062,  4944,  5840, 13021,  6781,  3724,  1431]) tensor([ 6443,  6136,  8341, 14352,  9348, 12340,  2002, 14062,  7768,  5761])
-------Step 6-------
tensor([12295,  4258,   376,    50, 11791, 11939, 14679, 10075,  8489,  6890]) tensor([ 2775,  8499,  6639, 11537,  9503, 12427,  1259,  2155, 12542, 14525])
-------Step 7-------
tensor([12295,  4258,   376,    50, 11791, 11939, 14679, 10075,  8489,  6890]) tensor([ 4421, 13831,  9918,  7042,  5045,   468,  4793,  7610, 11108, 13581])
-------Step 8-------
tensor([ 9217,  9087, 14272,  9314,  4744,  7097,  1026,  5437,  4300, 11120]) tensor([  376, 11189, 14774,  1040, 11368, 10751,  1684,  9948,  7828,  7697])
-------Step 9-------
tensor([ 9217,  9087, 14272,  9314,  4744,  7097,  1026,  5437,  4300, 11120]) tensor([10597, 11188,   983,  3317,  1786, 11217,  6372,  2404,  2104, 13297])
before start barrier
start train
[proc 0] 100 steps, total: 7.388, sample: 0.225, forward: 1.226, backward: 0.786, update: 0.118
W20240129 02:42:59.063007 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=101, pq.top=101
W20240129 02:42:59.131722 1152824 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.107 ms                  | 13.190 ms                 |
| Forward                   | 2.982 ms                  | 11.134 ms                 |
| Backward                  | 5.085 ms                  | 5.503 ms                  |
| Optimize                  | 993.864 us                | 3.310 ms                  |
| BarrierTimeBeforeRank0    | 19.272 us                 | 1.170 ms                  |
| AfterBackward             | 8.170 ms                  | 13.314 ms                 |
| BlockToStepN              | 34.681 ms                 | 58.069 ms                 |
| OneStep                   | 55.953 ms                 | 83.269 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:00.077749 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=115, pq.top=115
W20240129 02:43:00.134729 1152824 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.753 ms                  | 2.786 ms                  |
| ProcessBack:UpdateCache   | 1.363 ms                  | 2.248 ms                  |
| ProcessBack:UpsertPq      | 4.076 ms                  | 7.585 ms                  |
| ProcessOneStep            | 8.059 ms                  | 13.263 ms                 |
| BlockToStepN              | 38.924 ms                 | 63.860 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:01.089527 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=128, pq.top=128
W20240129 02:43:01.162283 1152824 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 02:43:02.093587 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240129 02:43:02.167131 1152824 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 02:43:03.107411 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=152, pq.top=152
W20240129 02:43:03.173182 1152824 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 02:43:04.107007 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=164, pq.top=164
W20240129 02:43:04.177620 1152824 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.044 ms                  | 10.822 ms                 |
| Forward                   | 2.910 ms                  | 7.543 ms                  |
| Backward                  | 5.087 ms                  | 5.503 ms                  |
| Optimize                  | 958.509 us                | 3.092 ms                  |
| BarrierTimeBeforeRank0    | 19.047 us                 | 1.166 ms                  |
| AfterBackward             | 7.804 ms                  | 12.967 ms                 |
| BlockToStepN              | 47.186 ms                 | 74.948 ms                 |
| OneStep                   | 67.423 ms                 | 94.227 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:05.107012 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=175, pq.top=175
W20240129 02:43:05.206986 1152824 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.721 ms                  | 2.483 ms                  |
| ProcessBack:UpdateCache   | 1.331 ms                  | 1.899 ms                  |
| ProcessBack:UpsertPq      | 4.073 ms                  | 7.411 ms                  |
| ProcessOneStep            | 7.688 ms                  | 12.948 ms                 |
| BlockToStepN              | 49.498 ms                 | 76.880 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:06.107007 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=187, pq.top=187
W20240129 02:43:06.249075 1152824 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 02:43:07.107012 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=198, pq.top=198
[proc 0] 200 steps, total: 8.275, sample: 0.220, forward: 0.268, backward: 0.504, update: 0.085
[proc 1] 200 steps, total: 8.275, sample: 0.172, forward: 0.270, backward: 0.496, update: 0.084
[proc 3] 200 steps, total: 8.275, sample: 0.146, forward: 0.218, backward: 0.501, update: 0.084
[proc 2] 200 steps, total: 8.275, sample: 0.140, forward: 0.207, backward: 0.347, update: 0.087
W20240129 02:43:07.310124 1152824 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 02:43:08.107012 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=210, pq.top=210
W20240129 02:43:08.326298 1152824 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 02:43:09.107007 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=221, pq.top=221
W20240129 02:43:09.329794 1152824 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.102 ms                  | 10.822 ms                 |
| Forward                   | 2.853 ms                  | 7.543 ms                  |
| Backward                  | 5.089 ms                  | 6.147 ms                  |
| Optimize                  | 940.505 us                | 3.092 ms                  |
| BarrierTimeBeforeRank0    | 18.926 us                 | 1.166 ms                  |
| AfterBackward             | 7.634 ms                  | 12.967 ms                 |
| BlockToStepN              | 56.997 ms                 | 77.691 ms                 |
| OneStep                   | 76.384 ms                 | 99.171 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:10.122771 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=233, pq.top=233
W20240129 02:43:10.364966 1152824 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.662 ms                  | 2.480 ms                  |
| ProcessBack:UpdateCache   | 1.318 ms                  | 1.867 ms                  |
| ProcessBack:UpsertPq      | 4.076 ms                  | 7.372 ms                  |
| ProcessOneStep            | 7.586 ms                  | 12.948 ms                 |
| BlockToStepN              | 58.037 ms                 | 80.116 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:11.122009 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=244, pq.top=244
W20240129 02:43:11.364518 1152824 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 02:43:12.122010 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=255, pq.top=255
W20240129 02:43:12.426587 1152824 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 02:43:13.122005 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=266, pq.top=266
W20240129 02:43:13.437609 1152824 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 02:43:14.122011 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=277, pq.top=277
W20240129 02:43:14.438300 1152824 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.117 ms                  | 10.556 ms                 |
| Forward                   | 2.767 ms                  | 5.392 ms                  |
| Backward                  | 5.084 ms                  | 5.980 ms                  |
| Optimize                  | 919.388 us                | 3.064 ms                  |
| BarrierTimeBeforeRank0    | 18.804 us                 | 5.037 ms                  |
| AfterBackward             | 7.563 ms                  | 11.632 ms                 |
| BlockToStepN              | 61.217 ms                 | 82.030 ms                 |
| OneStep                   | 80.192 ms                 | 101.935 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:15.122011 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=288, pq.top=288
W20240129 02:43:15.490813 1152824 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.642 ms                  | 2.480 ms                  |
| ProcessBack:UpdateCache   | 1.308 ms                  | 1.838 ms                  |
| ProcessBack:UpsertPq      | 4.114 ms                  | 6.610 ms                  |
| ProcessOneStep            | 7.540 ms                  | 11.592 ms                 |
| BlockToStepN              | 61.783 ms                 | 81.995 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:16.122006 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=299, pq.top=299
[proc 0] 300 steps, total: 8.922, sample: 0.207, forward: 0.255, backward: 0.503, update: 0.085
[proc 1] 300 steps, total: 8.922, sample: 0.150, forward: 0.265, backward: 0.495, update: 0.084
[proc 2] 300 steps, total: 8.922, sample: 0.129, forward: 0.208, backward: 0.477, update: 0.091
[proc 3] 300 steps, total: 8.922, sample: 0.139, forward: 0.217, backward: 0.501, update: 0.086
W20240129 02:43:16.497726 1152824 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 02:43:17.122009 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=310, pq.top=310
W20240129 02:43:17.503353 1152824 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 02:43:18.141448 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=322, pq.top=322
W20240129 02:43:18.576025 1152824 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 02:43:19.141005 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=333, pq.top=333
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.125 ms                  | 10.775 ms                 |
| Forward                   | 2.732 ms                  | 5.392 ms                  |
| Backward                  | 5.084 ms                  | 6.028 ms                  |
| Optimize                  | 913.293 us                | 3.064 ms                  |
| BarrierTimeBeforeRank0    | 18.762 us                 | 6.404 ms                  |
| AfterBackward             | 7.523 ms                  | 11.632 ms                 |
| BlockToStepN              | 62.948 ms                 | 82.566 ms                 |
| OneStep                   | 81.822 ms                 | 103.087 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:19.651036 1152824 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 02:43:20.161659 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=344, pq.top=344
W20240129 02:43:20.684556 1152824 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.637 ms                  | 2.342 ms                  |
| ProcessBack:UpdateCache   | 1.303 ms                  | 1.780 ms                  |
| ProcessBack:UpsertPq      | 4.097 ms                  | 6.610 ms                  |
| ProcessOneStep            | 7.499 ms                  | 10.886 ms                 |
| BlockToStepN              | 63.391 ms                 | 82.500 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:21.161010 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=355, pq.top=355
W20240129 02:43:21.688503 1152824 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
W20240129 02:43:22.161005 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=366, pq.top=366
W20240129 02:43:22.749748 1152824 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 02:43:23.161006 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=377, pq.top=377
W20240129 02:43:23.776664 1152824 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 02:43:24.169526 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=388, pq.top=388
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.142 ms                  | 10.742 ms                 |
| Forward                   | 2.704 ms                  | 5.268 ms                  |
| Backward                  | 5.080 ms                  | 6.028 ms                  |
| Optimize                  | 907.836 us                | 2.702 ms                  |
| BarrierTimeBeforeRank0    | 18.762 us                 | 6.289 ms                  |
| AfterBackward             | 7.501 ms                  | 10.910 ms                 |
| BlockToStepN              | 64.507 ms                 | 84.367 ms                 |
| OneStep                   | 83.898 ms                 | 104.482 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:24.781415 1152824 grad_async_v1.h:280] Detect new sample comes, old_end4, new_end5
W20240129 02:43:25.169574 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=399, pq.top=399
[proc 1] 400 steps, total: 9.111, sample: 0.161, forward: 0.260, backward: 0.497, update: 0.081
[proc 0] 400 steps, total: 9.111, sample: 0.213, forward: 0.252, backward: 0.502, update: 0.086
[proc 2] 400 steps, total: 9.111, sample: 0.126, forward: 0.203, backward: 0.477, update: 0.090
[proc 3] 400 steps, total: 9.111, sample: 0.132, forward: 0.216, backward: 0.498, update: 0.089
W20240129 02:43:25.784844 1152824 grad_async_v1.h:280] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.631 ms                  | 2.218 ms                  |
| ProcessBack:UpdateCache   | 1.299 ms                  | 1.722 ms                  |
| ProcessBack:UpsertPq      | 4.116 ms                  | 6.610 ms                  |
| ProcessOneStep            | 7.471 ms                  | 10.886 ms                 |
| BlockToStepN              | 64.767 ms                 | 84.335 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:26.169008 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=410, pq.top=410
W20240129 02:43:26.784507 1152824 grad_async_v1.h:280] Detect new sample comes, old_end6, new_end7
W20240129 02:43:27.169010 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=421, pq.top=421
W20240129 02:43:27.788542 1152824 grad_async_v1.h:280] Detect new sample comes, old_end7, new_end8
W20240129 02:43:28.169005 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=432, pq.top=432
W20240129 02:43:28.793557 1152824 grad_async_v1.h:280] Detect new sample comes, old_end8, new_end9
W20240129 02:43:29.184298 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=443, pq.top=443
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.153 ms                  | 10.742 ms                 |
| Forward                   | 2.678 ms                  | 5.268 ms                  |
| Backward                  | 5.084 ms                  | 6.028 ms                  |
| Optimize                  | 902.894 us                | 2.702 ms                  |
| BarrierTimeBeforeRank0    | 18.665 us                 | 6.902 ms                  |
| AfterBackward             | 7.481 ms                  | 11.292 ms                 |
| BlockToStepN              | 65.737 ms                 | 84.367 ms                 |
| OneStep                   | 85.876 ms                 | 104.482 ms                |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:29.805284 1152824 grad_async_v1.h:280] Detect new sample comes, old_end9, new_end0
W20240129 02:43:30.186954 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=454, pq.top=454
W20240129 02:43:30.818509 1152824 grad_async_v1.h:280] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.628 ms                  | 2.218 ms                  |
| ProcessBack:UpdateCache   | 1.295 ms                  | 1.686 ms                  |
| ProcessBack:UpsertPq      | 4.114 ms                  | 6.783 ms                  |
| ProcessOneStep            | 7.462 ms                  | 10.886 ms                 |
| BlockToStepN              | 65.793 ms                 | 84.335 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240129 02:43:31.197427 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=465, pq.top=465
W20240129 02:43:31.828634 1152824 grad_async_v1.h:280] Detect new sample comes, old_end1, new_end2
W20240129 02:43:32.214759 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=476, pq.top=476
W20240129 02:43:32.861349 1152824 grad_async_v1.h:280] Detect new sample comes, old_end2, new_end3
W20240129 02:43:33.214010 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=486, pq.top=486
W20240129 02:43:33.861385 1152824 grad_async_v1.h:280] Detect new sample comes, old_end3, new_end4
W20240129 02:43:34.228642 1152440 grad_async_v1.h:406] Sleep in <BlockToStepN>, step_no=498, pq.top=498
[proc 3] 500 steps, total: 9.140, sample: 0.135, forward: 0.213, backward: 0.498, update: 0.086
[proc 2] 500 steps, total: 9.141, sample: 0.141, forward: 0.206, backward: 0.476, update: 0.094
[proc 0] 500 steps, total: 9.141, sample: 0.214, forward: 0.250, backward: 0.501, update: 0.083
[proc 1] 500 steps, total: 9.141, sample: 0.149, forward: 0.262, backward: 0.496, update: 0.082
Successfully xmh. training takes 42.83752942085266 seconds
before call kg_cache_controller.StopThreads()
W20240129 02:43:34.484251 1152440 grad_async_v1.h:230] call StopThreads. PID = 1152098
W20240129 02:43:34.484272 1152440 grad_base.h:212] before processOneStepNegThread_.join();
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
W20240129 02:43:34.493745 1152440 grad_base.h:214] after processOneStepNegThread_.join();
W20240129 02:43:34.493767 1152440 grad_async_v1.h:232] call GradProcessingBase::StopThreads.
W20240129 02:43:34.525529 1152440 grad_async_v1.h:251] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.165 ms                  | 10.556 ms                 |
| Forward                   | 2.654 ms                  | 4.572 ms                  |
| Backward                  | 5.082 ms                  | 5.980 ms                  |
| Optimize                  | 896.957 us                | 2.108 ms                  |
| BarrierTimeBeforeRank0    | 18.718 us                 | 6.902 ms                  |
| AfterBackward             | 7.468 ms                  | 10.910 ms                 |
| BlockToStepN              | 66.309 ms                 | 85.509 ms                 |
| OneStep                   | 86.487 ms                 | 104.725 ms                |
+---------------------------+---------------------------+---------------------------+
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f8fb2fee250>
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 1.626 ms                  | 2.218 ms                  |
| ProcessBack:UpdateCache   | 1.294 ms                  | 1.654 ms                  |
| ProcessBack:UpsertPq      | 4.114 ms                  | 6.610 ms                  |
| ProcessOneStep            | 7.450 ms                  | 10.886 ms                 |
| BlockToStepN              | 66.272 ms                 | 85.467 ms                 |
+---------------------------+---------------------------+---------------------------+

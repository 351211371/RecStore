WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240131 22:46:39.443209 3106952 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
W20240131 22:46:39.445124 3106952 IPCTensor.h:369] NewIPCTensor: full_emb [33762578, 32]0x100000002000 4.025 GB
/home/xieminhui/RecStore/src/framework_adapters/torch/python/perf_rec_model.py:152: DeprecationWarning: The 'warn' function is deprecated, use 'warning' instead
  XLOG.warn("After init DistEmbedding")
WARNING [3106952 perf_rec_model.py:152] After init DistEmbedding
========== Running Perf with routine <function routine_local_cache_helper at 0x7f45334391c0>==========
Worker 1 pid=3107298
Worker 2 pid=3107300
INFO [3106952 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3107298 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [3107302 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [3107300 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [3107302 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3107300 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
E20240131 22:46:48.095805 3107300 IPCTensor.h:348] IPCTensor full_emb already exists
E20240131 22:46:48.098106 3107302 IPCTensor.h:348] IPCTensor full_emb already exists
INFO [3107298 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [3106952 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
E20240131 22:46:48.104244 3107298 IPCTensor.h:348] IPCTensor full_emb already exists
E20240131 22:46:48.104365 3106952 IPCTensor.h:348] IPCTensor full_emb already exists
W20240131 22:46:58.553385 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10010196c000 7.629 MB
W20240131 22:46:58.553654 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10010210f000 7.629 MB
W20240131 22:46:58.553706 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x1001028b2000 7.629 MB
W20240131 22:46:58.553748 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x100103055000 7.629 MB
W20240131 22:46:58.553768 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1001037f8000 7.629 MB
W20240131 22:46:58.553792 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100103f9b000 7.629 MB
W20240131 22:46:58.553826 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x10010473e000 7.629 MB
W20240131 22:46:58.553882 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100104ee1000 7.629 MB
W20240131 22:46:58.553937 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100105684000 7.629 MB
W20240131 22:46:58.553959 3107302 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x100105e27000 7.629 MB
W20240131 22:46:58.553979 3107302 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x1001065ca000 80 B 
W20240131 22:46:58.554000 3107302 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x1001065cc000 8 B 
W20240131 22:46:58.554013 3107302 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x1001065ce000 8 B 
Dataset:  /home/xieminhui/RecStoreDataset/criteo_binary
Dataset loaded
np.max =  33762577
np.min=  1
Construct RecModelSampler done
Construct KGCacheControllerWrapper done
E20240131 22:46:58.554621 3107302 recstore.cc:66] init folly done
W20240131 22:47:00.015666 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1001065d0000 7.629 MB
W20240131 22:47:00.015887 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x100106d73000 7.629 MB
W20240131 22:47:00.015921 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x100107516000 7.629 MB
W20240131 22:47:00.015946 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x100107cb9000 7.629 MB
W20240131 22:47:00.015978 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10010845c000 7.629 MB
W20240131 22:47:00.015998 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x100108bff000 7.629 MB
W20240131 22:47:00.016021 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x1001093a2000 7.629 MB
W20240131 22:47:00.016062 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x100109b45000 7.629 MB
W20240131 22:47:00.016093 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10010a2e8000 7.629 MB
W20240131 22:47:00.016117 3107300 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10010aa8b000 7.629 MB
W20240131 22:47:00.016139 3107300 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10010b22e000 80 B 
W20240131 22:47:00.016161 3107300 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10010b230000 8 B 
W20240131 22:47:00.016176 3107300 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10010b232000 8 B 
Dataset:  /home/xieminhui/RecStoreDataset/criteo_binary
Dataset loaded
np.max =  33762577
np.min=  1
Construct RecModelSampler done
Construct KGCacheControllerWrapper done
E20240131 22:47:00.016700 3107300 recstore.cc:66] init folly done
W20240131 22:47:00.017576 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x10010b234000 7.629 MB
W20240131 22:47:00.017688 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x10010b9d7000 7.629 MB
W20240131 22:47:00.017710 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x10010c17a000 7.629 MB
W20240131 22:47:00.017736 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x10010c91d000 7.629 MB
W20240131 22:47:00.017760 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x10010d0c0000 7.629 MB
W20240131 22:47:00.017787 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x10010d863000 7.629 MB
W20240131 22:47:00.017822 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x10010e006000 7.629 MB
W20240131 22:47:00.017858 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x10010e7a9000 7.629 MB
W20240131 22:47:00.017884 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x10010ef4c000 7.629 MB
W20240131 22:47:00.017910 3106952 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x10010f6ef000 7.629 MB
W20240131 22:47:00.017930 3106952 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x10010fe92000 80 B 
W20240131 22:47:00.017951 3106952 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x10010fe94000 8 B 
W20240131 22:47:00.017967 3106952 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x10010fe96000 8 B 
Worker 3 pid=3107302
New CachedEmbedding, name=full_emb, shape=(33762578, 32), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 1688128), (1688128, 3376256), (3376256, 5064384), (5064384, 6752512)]
Dataset:  /home/xieminhui/RecStoreDataset/criteo_binary
Dataset loaded
np.max =  33762577
np.min=  1
Construct RecModelSampler done
Construct KGCacheControllerWrapper done
E20240131 22:47:00.018457 3106952 recstore.cc:66] init folly done
W20240131 22:47:00.032634 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x10010fe98000 7.629 MB
W20240131 22:47:00.032790 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x10011063b000 7.629 MB
W20240131 22:47:00.032822 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100110dde000 7.629 MB
W20240131 22:47:00.032846 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x100111581000 7.629 MB
W20240131 22:47:00.032864 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100111d24000 7.629 MB
W20240131 22:47:00.032886 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x1001124c7000 7.629 MB
W20240131 22:47:00.032907 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100112c6a000 7.629 MB
W20240131 22:47:00.032938 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x10011340d000 7.629 MB
W20240131 22:47:00.032979 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x100113bb0000 7.629 MB
W20240131 22:47:00.033002 3107298 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100114353000 7.629 MB
W20240131 22:47:00.033021 3107298 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x100114af6000 80 B 
W20240131 22:47:00.033042 3107298 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x100114af8000 8 B 
W20240131 22:47:00.033057 3107298 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x100114afa000 8 B 
Dataset:  /home/xieminhui/RecStoreDataset/criteo_binary
Dataset loaded
np.max =  33762577
np.min=  1
Construct RecModelSampler done
Construct KGCacheControllerWrapper done
E20240131 22:47:00.033412 3107298 recstore.cc:66] init folly done
Before Training
Before Training
Before Training
I20240131 22:47:01.373030 3106952 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240131 22:47:01.373061 3107298 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240131 22:47:01.373080 3107300 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
Before Training
I20240131 22:47:01.373567 3107302 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
========== Step 0 ========== 
========== Step 1 ========== 
INFO [3106952 distributed.py:1140] Reducer buckets have been rebuilt in this iteration.
INFO [3107298 distributed.py:1140] Reducer buckets have been rebuilt in this iteration.
INFO [3107300 distributed.py:1140] Reducer buckets have been rebuilt in this iteration.
INFO [3107302 distributed.py:1140] Reducer buckets have been rebuilt in this iteration.
========== Step 2 ========== 
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput:CircleBuffer     | 208.190 us                | 424.964 us                |
| GenInput                  | 19.181 ms                 | 22.578 ms                 |
| NN                        | 1.969 ms                  | 158.328 ms                |
| Forward                   | 22.181 ms                 | 207.746 ms                |
| Backward                  | 1.086 s                   | 1.577 s                   |
| Optimize                  | 656.843 us                | 8.487 ms                  |
| OneStep                   | 1.347 s                   | 1.678 s                   |
+---------------------------+---------------------------+---------------------------+
========== Step 3 ========== 
========== Step 4 ========== 
========== Step 5 ========== 
========== Step 6 ========== 
========== Step 7 ========== 
========== Step 8 ========== 
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput:CircleBuffer     | 208.190 us                | 424.964 us                |
| GenInput                  | 19.860 ms                 | 23.588 ms                 |
| NN                        | 869.989 us                | 158.328 ms                |
| Forward                   | 20.033 ms                 | 207.746 ms                |
| Backward                  | 851.440 ms                | 1.577 s                   |
| Optimize                  | 501.871 us                | 8.487 ms                  |
| OneStep                   | 900.426 ms                | 1.678 s                   |
+---------------------------+---------------------------+---------------------------+
========== Step 9 ========== 
========== Step 10 ========== 
========== Step 11 ========== 
========== Step 12 ========== 
========== Step 13 ========== 
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput:CircleBuffer     | 204.302 us                | 629.145 us                |
| GenInput                  | 21.061 ms                 | 23.588 ms                 |
| NN                        | 820.398 us                | 158.328 ms                |
| Forward                   | 17.602 ms                 | 207.746 ms                |
| Backward                  | 851.440 ms                | 1.577 s                   |
| Optimize                  | 420.809 us                | 8.487 ms                  |
| OneStep                   | 981.554 ms                | 1.678 s                   |
+---------------------------+---------------------------+---------------------------+
========== Step 14 ========== 
========== Step 15 ========== 
========== Step 16 ========== 
========== Step 17 ========== 
========== Step 18 ========== 
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput:CircleBuffer     | 208.190 us                | 629.145 us                |
| GenInput                  | 21.061 ms                 | 23.588 ms                 |
| NN                        | 818.729 us                | 158.328 ms                |
| Forward                   | 17.606 ms                 | 207.746 ms                |
| Backward                  | 730.813 ms                | 1.577 s                   |
| Optimize                  | 426.292 us                | 8.487 ms                  |
| OneStep                   | 945.371 ms                | 1.678 s                   |
+---------------------------+---------------------------+---------------------------+
========== Step 19 ========== 
========== Step 20 ========== 
========== Step 21 ========== 
========== Step 22 ========== 
========== Step 23 ========== 

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240128 02:34:27.335992 4009430 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_13', no_save_emb=True, max_step=500, batch_size=1800, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [4009430 sampler.py:454] Start PreSampling
WARNING [4009430 sampler.py:532] Before construct renumbering_dict
WARNING [4009430 sampler.py:555] PreSampling done
W20240128 02:34:29.318650 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240128 02:34:29.318809 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240128 02:34:29.318840 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240128 02:34:29.318866 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240128 02:34:29.318886 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240128 02:34:29.318903 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240128 02:34:29.318926 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240128 02:34:29.318951 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240128 02:34:29.318974 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240128 02:34:29.319000 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240128 02:34:29.319027 4009430 IPCTensor.h:368] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240128 02:34:29.319048 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240128 02:34:29.319069 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240128 02:34:29.319162 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240128 02:34:29.319190 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240128 02:34:29.319217 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240128 02:34:29.319253 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240128 02:34:29.319272 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240128 02:34:29.319289 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240128 02:34:29.319307 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240128 02:34:29.319325 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240128 02:34:29.319346 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240128 02:34:29.319365 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240128 02:34:29.319383 4009430 IPCTensor.h:368] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240128 02:34:29.319399 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240128 02:34:29.319414 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240128 02:34:29.319455 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240128 02:34:29.319478 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240128 02:34:29.319494 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240128 02:34:29.319516 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240128 02:34:29.319538 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240128 02:34:29.319556 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240128 02:34:29.319576 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240128 02:34:29.319599 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240128 02:34:29.319622 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240128 02:34:29.319643 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240128 02:34:29.319662 4009430 IPCTensor.h:368] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240128 02:34:29.319677 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240128 02:34:29.319696 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240128 02:34:29.319732 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240128 02:34:29.319768 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240128 02:34:29.319792 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240128 02:34:29.319813 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240128 02:34:29.319834 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240128 02:34:29.319857 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240128 02:34:29.319882 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240128 02:34:29.319905 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240128 02:34:29.319928 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240128 02:34:29.319947 4009430 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240128 02:34:29.319964 4009430 IPCTensor.h:368] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240128 02:34:29.319980 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240128 02:34:29.320003 4009430 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240128 02:34:29.464265 4009430 IPCTensor.h:368] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240128 02:34:29.464404 4009430 IPCTensor.h:368] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 863, 1100, 1167,  ..., 1767, 6384, 7695]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.159 seconds
[Rank1] pid = 4009640
[Rank2] pid = 4009705
INFO [4009430 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [4009769 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [4009769 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4009705 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [4009640 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [4009705 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4009640 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4009430 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [4009769 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [4009430 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [4009705 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [4009640 DistTensor.py:56] The tensor name already exists in the kvstore
I20240128 02:34:33.065227 4009771 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240128 02:34:33.065342 4009706 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 02:34:33.065460 4009641 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 02:34:33.065548 4009770 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 02:34:34.539885 4009770 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240128 02:34:34.560827 4009706 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 02:34:34.561053 4009771 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 02:34:34.563889 4009641 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 749.254 us                | 749.254 us                |
| bucket keys               | 973.571 us                | 182.419 ms                |
| forward: a2a keys         | 1.586 ms                  | 1.725 s                   |
| forward: search cache     | 149.598 us                | 24.941 ms                 |
| forward: a2a values       | 2.804 ms                  | 3.878 ms                  |
| forward: join             | 1.577 ms                  | 2.996 ms                  |
| Forward                   | 2.750 s                   | 2.750 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.852 ms                  | 32.621 ms                 |
| bucket keys               | 2.157 ms                  | 2.489 ms                  |
| forward: a2a keys         | 1.822 ms                  | 4.529 ms                  |
| forward: search cache     | 329.737 us                | 404.939 us                |
| forward: a2a values       | 2.574 ms                  | 3.381 ms                  |
| forward: join             | 2.753 ms                  | 3.569 ms                  |
| Forward                   | 29.449 ms                 | 2.750 s                   |
| back: aggr dram keys      | 22.472 ms                 | 29.429 ms                 |
| back: set dram grad       | 1.789 ms                  | 3.871 ms                  |
| back: a2a grad            | 3.016 ms                  | 4.761 ms                  |
| back: grad sum & grad cache  | 1.314 ms                  | 2.558 ms                  |
| Backward                  | 58.955 ms                 | 2.420 s                   |
| Optimize                  | 14.222 ms                 | 35.980 ms                 |
| BarrierTimeBeforeRank0    | 69.655 us                 | 111.865 us                |
| BlockToStepN              | 23.867 us                 | 222.031 us                |
| OneStep                   | 105.210 ms                | 5.184 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.858 ms                  | 32.699 ms                 |
| bucket keys               | 2.167 ms                  | 2.481 ms                  |
| forward: a2a keys         | 1.816 ms                  | 4.529 ms                  |
| forward: search cache     | 355.857 us                | 453.245 us                |
| forward: a2a values       | 2.655 ms                  | 3.350 ms                  |
| forward: join             | 2.849 ms                  | 4.682 ms                  |
| Forward                   | 29.407 ms                 | 35.993 ms                 |
| back: aggr dram keys      | 22.306 ms                 | 26.498 ms                 |
| back: set dram grad       | 1.821 ms                  | 3.845 ms                  |
| back: a2a grad            | 3.018 ms                  | 3.538 ms                  |
| back: grad sum & grad cache  | 1.521 ms                  | 2.537 ms                  |
| Backward                  | 58.805 ms                 | 63.926 ms                 |
| Optimize                  | 14.180 ms                 | 30.229 ms                 |
| BarrierTimeBeforeRank0    | 59.200 us                 | 101.515 us                |
| BlockToStepN              | 23.335 us                 | 86.060 us                 |
| OneStep                   | 105.365 ms                | 135.483 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 16.018, sample: 0.425, forward: 5.536, backward: 8.326, update: 0.183
[Rank3] pid = 4009769
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 7794,  3883,  9378,  7473,  8373,  4223,   654,  1937, 14731, 10016]) tensor([ 1167, 10413,  9450,   670,  8027,  7404, 13780,  7687,  8336,  7906])
-------Step 1-------
tensor([ 7794,  3883,  9378,  7473,  8373,  4223,   654,  1937, 14731, 10016]) tensor([ 9936, 11042,  1011,  3471,  1847, 14384,  2520,  3217,  2000, 13888])
-------Step 2-------
tensor([10510,  6999,  6060,  6881,  1507,  6395,  8188,  2501, 13942,   176]) tensor([ 8059,  4299,  3118, 10279,  7774,   663,  3942, 13090,  9964,  3544])
-------Step 3-------
tensor([10510,  6999,  6060,  6881,  1507,  6395,  8188,  2501, 13942,   176]) tensor([ 8658,   260,  4396,   122, 11811, 10438, 14889,  9568, 14157,  5769])
-------Step 4-------
tensor([12417,  5826,   535,    82, 11810, 11372, 13734, 11712,  8559,  6971]) tensor([ 2859,  8606,  6836,  9017,  9431, 11570,  1269,  2089, 11876, 14447])
-------Step 5-------
tensor([12417,  5826,   535,    82, 11810, 11372, 13734, 11712,  8559,  6971]) tensor([12435,  8323, 11185,   575,  1445, 10721,  6261, 12364, 11441, 14364])
-------Step 6-------
tensor([  104,     4,  3074, 10295, 12060,    58,  8270,   136,  2727,   166]) tensor([ 7565, 12438,  8040, 11580,  6736,  1522, 10226, 11760, 11738, 12740])
-------Step 7-------
tensor([  104,     4,  3074, 10295, 12060,    58,  8270,   136,  2727,   166]) tensor([11502, 13866,  7420, 14479,  7826, 11768, 10806, 14697, 14007, 10260])
-------Step 8-------
tensor([ 5163,  7512, 10468, 11186,  3593, 12016,  8459, 10331,  5711,  6999]) tensor([ 9486, 11231, 13663,   441, 12928,  9828,  5881,  1717,  7093,  9639])
-------Step 9-------
tensor([ 5163,  7512, 10468, 11186,  3593, 12016,  8459, 10331,  5711,  6999]) tensor([ 8918, 12893,  5150,  2800,  4072,  6846, 14153,  7422,  6507, 13434])
before start barrier
start train
[proc 0] 100 steps, total: 16.042, sample: 0.530, forward: 5.585, backward: 8.241, update: 1.522
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 16.021, sample: 0.479, forward: 5.589, backward: 8.199, update: 0.192
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 16.021, sample: 0.451, forward: 5.621, backward: 8.207, update: 0.208
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.874 ms                  | 32.813 ms                 |
| bucket keys               | 2.171 ms                  | 2.559 ms                  |
| forward: a2a keys         | 1.835 ms                  | 4.974 ms                  |
| forward: search cache     | 356.660 us                | 453.245 us                |
| forward: a2a values       | 2.679 ms                  | 3.381 ms                  |
| forward: join             | 2.871 ms                  | 4.755 ms                  |
| Forward                   | 29.554 ms                 | 35.993 ms                 |
| back: aggr dram keys      | 22.472 ms                 | 27.994 ms                 |
| back: set dram grad       | 1.789 ms                  | 3.845 ms                  |
| back: a2a grad            | 3.048 ms                  | 4.761 ms                  |
| back: grad sum & grad cache  | 1.521 ms                  | 2.537 ms                  |
| Backward                  | 58.646 ms                 | 64.706 ms                 |
| Optimize                  | 14.282 ms                 | 30.229 ms                 |
| BarrierTimeBeforeRank0    | 58.659 us                 | 101.515 us                |
| BlockToStepN              | 24.163 us                 | 168.793 us                |
| OneStep                   | 105.964 ms                | 135.483 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.880 ms                  | 32.699 ms                 |
| bucket keys               | 2.175 ms                  | 2.525 ms                  |
| forward: a2a keys         | 1.845 ms                  | 29.988 ms                 |
| forward: search cache     | 356.651 us                | 453.245 us                |
| forward: a2a values       | 2.660 ms                  | 3.350 ms                  |
| forward: join             | 2.876 ms                  | 4.721 ms                  |
| Forward                   | 29.599 ms                 | 55.253 ms                 |
| back: aggr dram keys      | 22.581 ms                 | 27.723 ms                 |
| back: set dram grad       | 1.788 ms                  | 3.270 ms                  |
| back: a2a grad            | 3.081 ms                  | 3.621 ms                  |
| back: grad sum & grad cache  | 1.685 ms                  | 2.537 ms                  |
| Backward                  | 58.648 ms                 | 66.937 ms                 |
| Optimize                  | 14.331 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 58.983 us                 | 95.913 us                 |
| BlockToStepN              | 24.615 us                 | 194.400 us                |
| OneStep                   | 106.099 ms                | 142.341 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 11.329, sample: 0.574, forward: 3.160, backward: 5.953, update: 1.499
[proc 1] 200 steps, total: 11.329, sample: 0.510, forward: 3.170, backward: 5.957, update: 0.235
[proc 2] 200 steps, total: 11.329, sample: 0.576, forward: 3.126, backward: 5.919, update: 0.237
[proc 3] 200 steps, total: 11.329, sample: 0.435, forward: 3.183, backward: 5.994, update: 0.213
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.881 ms                  | 33.375 ms                 |
| bucket keys               | 2.171 ms                  | 2.525 ms                  |
| forward: a2a keys         | 1.849 ms                  | 30.550 ms                 |
| forward: search cache     | 355.208 us                | 416.415 us                |
| forward: a2a values       | 2.625 ms                  | 3.303 ms                  |
| forward: join             | 2.871 ms                  | 4.698 ms                  |
| Forward                   | 29.598 ms                 | 55.253 ms                 |
| back: aggr dram keys      | 22.646 ms                 | 27.339 ms                 |
| back: set dram grad       | 1.788 ms                  | 3.270 ms                  |
| back: a2a grad            | 3.085 ms                  | 3.538 ms                  |
| back: grad sum & grad cache  | 1.687 ms                  | 2.537 ms                  |
| Backward                  | 58.781 ms                 | 66.937 ms                 |
| Optimize                  | 14.331 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 58.659 us                 | 101.515 us                |
| BlockToStepN              | 25.323 us                 | 221.913 us                |
| OneStep                   | 106.261 ms                | 142.341 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.876 ms                  | 32.966 ms                 |
| bucket keys               | 2.167 ms                  | 2.550 ms                  |
| forward: a2a keys         | 1.849 ms                  | 29.988 ms                 |
| forward: search cache     | 352.108 us                | 408.083 us                |
| forward: a2a values       | 2.587 ms                  | 3.256 ms                  |
| forward: join             | 2.862 ms                  | 4.682 ms                  |
| Forward                   | 29.643 ms                 | 55.252 ms                 |
| back: aggr dram keys      | 22.673 ms                 | 27.339 ms                 |
| back: set dram grad       | 1.802 ms                  | 3.470 ms                  |
| back: a2a grad            | 3.085 ms                  | 3.511 ms                  |
| back: grad sum & grad cache  | 1.690 ms                  | 2.393 ms                  |
| Backward                  | 59.051 ms                 | 66.937 ms                 |
| Optimize                  | 14.352 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 58.194 us                 | 101.515 us                |
| BlockToStepN              | 24.603 us                 | 194.400 us                |
| OneStep                   | 106.935 ms                | 138.786 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.874 ms                  | 32.998 ms                 |
| bucket keys               | 2.164 ms                  | 2.550 ms                  |
| forward: a2a keys         | 1.870 ms                  | 30.984 ms                 |
| forward: search cache     | 350.475 us                | 416.415 us                |
| forward: a2a values       | 2.587 ms                  | 3.303 ms                  |
| forward: join             | 2.858 ms                  | 4.698 ms                  |
| Forward                   | 29.676 ms                 | 57.914 ms                 |
| back: aggr dram keys      | 22.750 ms                 | 27.339 ms                 |
| back: set dram grad       | 1.794 ms                  | 3.452 ms                  |
| back: a2a grad            | 3.095 ms                  | 3.511 ms                  |
| back: grad sum & grad cache  | 1.687 ms                  | 2.286 ms                  |
| Backward                  | 59.282 ms                 | 67.163 ms                 |
| Optimize                  | 14.307 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 57.912 us                 | 101.515 us                |
| BlockToStepN              | 25.216 us                 | 194.400 us                |
| OneStep                   | 107.210 ms                | 138.786 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 300 steps, total: 11.748, sample: 0.477, forward: 3.520, backward: 6.058, update: 0.232
[proc 1] 300 steps, total: 11.748, sample: 0.474, forward: 3.535, backward: 6.062, update: 0.226
[proc 0] 300 steps, total: 11.749, sample: 0.535, forward: 3.518, backward: 6.064, update: 1.494
[proc 3] 300 steps, total: 11.749, sample: 0.528, forward: 3.449, backward: 6.069, update: 0.236
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.874 ms                  | 32.998 ms                 |
| bucket keys               | 2.162 ms                  | 2.525 ms                  |
| forward: a2a keys         | 1.882 ms                  | 30.984 ms                 |
| forward: search cache     | 347.097 us                | 408.083 us                |
| forward: a2a values       | 2.575 ms                  | 3.257 ms                  |
| forward: join             | 2.852 ms                  | 4.682 ms                  |
| Forward                   | 29.717 ms                 | 57.914 ms                 |
| back: aggr dram keys      | 22.765 ms                 | 27.339 ms                 |
| back: set dram grad       | 1.797 ms                  | 3.452 ms                  |
| back: a2a grad            | 3.100 ms                  | 3.511 ms                  |
| back: grad sum & grad cache  | 1.663 ms                  | 2.286 ms                  |
| Backward                  | 59.410 ms                 | 67.686 ms                 |
| Optimize                  | 14.307 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 58.194 us                 | 101.515 us                |
| BlockToStepN              | 25.323 us                 | 194.400 us                |
| OneStep                   | 107.378 ms                | 142.341 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.871 ms                  | 32.966 ms                 |
| bucket keys               | 2.159 ms                  | 2.525 ms                  |
| forward: a2a keys         | 1.883 ms                  | 31.350 ms                 |
| forward: search cache     | 338.410 us                | 406.823 us                |
| forward: a2a values       | 2.557 ms                  | 3.256 ms                  |
| forward: join             | 2.845 ms                  | 4.674 ms                  |
| Forward                   | 29.756 ms                 | 57.914 ms                 |
| back: aggr dram keys      | 22.824 ms                 | 27.356 ms                 |
| back: set dram grad       | 1.799 ms                  | 3.466 ms                  |
| back: a2a grad            | 3.101 ms                  | 3.496 ms                  |
| back: grad sum & grad cache  | 1.663 ms                  | 2.276 ms                  |
| Backward                  | 59.572 ms                 | 67.163 ms                 |
| Optimize                  | 14.307 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 57.820 us                 | 101.515 us                |
| BlockToStepN              | 25.324 us                 | 173.929 us                |
| OneStep                   | 108.143 ms                | 141.722 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 11.931, sample: 0.535, forward: 3.560, backward: 6.056, update: 0.243
[proc 0] 400 steps, total: 11.931, sample: 0.573, forward: 3.565, backward: 6.098, update: 1.558
[proc 2] 400 steps, total: 11.931, sample: 0.466, forward: 3.629, backward: 6.074, update: 0.235
[proc 1] 400 steps, total: 11.931, sample: 0.485, forward: 3.631, backward: 6.069, update: 0.238
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.866 ms                  | 33.375 ms                 |
| bucket keys               | 2.156 ms                  | 2.525 ms                  |
| forward: a2a keys         | 1.877 ms                  | 31.638 ms                 |
| forward: search cache     | 331.689 us                | 409.180 us                |
| forward: a2a values       | 2.550 ms                  | 3.257 ms                  |
| forward: join             | 2.833 ms                  | 4.721 ms                  |
| Forward                   | 29.760 ms                 | 58.172 ms                 |
| back: aggr dram keys      | 22.859 ms                 | 27.356 ms                 |
| back: set dram grad       | 1.806 ms                  | 3.470 ms                  |
| back: a2a grad            | 3.100 ms                  | 3.569 ms                  |
| back: grad sum & grad cache  | 1.663 ms                  | 2.286 ms                  |
| Backward                  | 59.776 ms                 | 67.163 ms                 |
| Optimize                  | 14.292 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 57.831 us                 | 101.515 us                |
| BlockToStepN              | 25.339 us                 | 173.929 us                |
| OneStep                   | 108.425 ms                | 141.722 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.867 ms                  | 32.998 ms                 |
| bucket keys               | 2.154 ms                  | 2.522 ms                  |
| forward: a2a keys         | 1.875 ms                  | 31.350 ms                 |
| forward: search cache     | 333.232 us                | 409.095 us                |
| forward: a2a values       | 2.544 ms                  | 3.256 ms                  |
| forward: join             | 2.831 ms                  | 4.698 ms                  |
| Forward                   | 29.756 ms                 | 57.914 ms                 |
| back: aggr dram keys      | 22.883 ms                 | 27.339 ms                 |
| back: set dram grad       | 1.807 ms                  | 3.466 ms                  |
| back: a2a grad            | 3.098 ms                  | 3.538 ms                  |
| back: grad sum & grad cache  | 1.651 ms                  | 2.286 ms                  |
| Backward                  | 59.967 ms                 | 66.937 ms                 |
| Optimize                  | 14.290 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 57.831 us                 | 96.175 us                 |
| BlockToStepN              | 25.370 us                 | 173.929 us                |
| OneStep                   | 108.884 ms                | 141.626 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 11.681, sample: 0.582, forward: 3.409, backward: 6.006, update: 0.241
[proc 1] 500 steps, total: 11.681, sample: 0.517, forward: 3.481, backward: 6.012, update: 0.246
[proc 0] 500 steps, total: 11.681, sample: 0.539, forward: 3.478, backward: 6.042, update: 1.482
[proc 3] 500 steps, total: 11.681, sample: 0.519, forward: 3.460, backward: 6.001, update: 0.249
Successfully xmh. training takes 62.732577323913574 seconds
before call kg_cache_controller.StopThreads()
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
INFO [4009430 controller_process.py:414] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.866 ms                  | 32.998 ms                 |
| bucket keys               | 2.152 ms                  | 2.510 ms                  |
| forward: a2a keys         | 1.881 ms                  | 31.048 ms                 |
| forward: search cache     | 329.104 us                | 408.083 us                |
| forward: a2a values       | 2.540 ms                  | 3.236 ms                  |
| forward: join             | 2.823 ms                  | 4.721 ms                  |
| Forward                   | 29.756 ms                 | 57.914 ms                 |
| back: aggr dram keys      | 22.895 ms                 | 27.339 ms                 |
| back: set dram grad       | 1.802 ms                  | 3.455 ms                  |
| back: a2a grad            | 3.082 ms                  | 3.522 ms                  |
| back: grad sum & grad cache  | 1.651 ms                  | 2.286 ms                  |
| Backward                  | 59.968 ms                 | 66.937 ms                 |
| Optimize                  | 14.265 ms                 | 30.056 ms                 |
| BarrierTimeBeforeRank0    | 57.717 us                 | 96.175 us                 |
| BlockToStepN              | 25.523 us                 | 173.929 us                |
| OneStep                   | 108.842 ms                | 141.626 ms                |
+---------------------------+---------------------------+---------------------------+

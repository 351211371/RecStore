WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240128 02:46:02.954162 4018843 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_18', no_save_emb=True, max_step=500, batch_size=2400, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [4018843 sampler.py:454] Start PreSampling
WARNING [4018843 sampler.py:532] Before construct renumbering_dict
WARNING [4018843 sampler.py:555] PreSampling done
W20240128 02:46:04.952556 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240128 02:46:04.952741 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240128 02:46:04.952785 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240128 02:46:04.952811 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240128 02:46:04.952839 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240128 02:46:04.952868 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240128 02:46:04.952896 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240128 02:46:04.952929 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240128 02:46:04.952947 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240128 02:46:04.952989 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240128 02:46:04.953007 4018843 IPCTensor.h:368] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240128 02:46:04.953025 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240128 02:46:04.953040 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240128 02:46:04.953119 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240128 02:46:04.953141 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240128 02:46:04.953157 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240128 02:46:04.953187 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240128 02:46:04.953217 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240128 02:46:04.953233 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240128 02:46:04.953260 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240128 02:46:04.953289 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240128 02:46:04.953315 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240128 02:46:04.953332 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240128 02:46:04.953362 4018843 IPCTensor.h:368] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240128 02:46:04.953377 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240128 02:46:04.953390 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240128 02:46:04.953430 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240128 02:46:04.953461 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240128 02:46:04.953477 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240128 02:46:04.953500 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240128 02:46:04.953524 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240128 02:46:04.953554 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240128 02:46:04.953570 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240128 02:46:04.953585 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240128 02:46:04.953601 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240128 02:46:04.953616 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240128 02:46:04.953631 4018843 IPCTensor.h:368] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240128 02:46:04.953644 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240128 02:46:04.953667 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240128 02:46:04.953706 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240128 02:46:04.953738 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240128 02:46:04.953755 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240128 02:46:04.953771 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240128 02:46:04.953786 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240128 02:46:04.953814 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240128 02:46:04.953830 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240128 02:46:04.953876 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240128 02:46:04.953892 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240128 02:46:04.953913 4018843 IPCTensor.h:368] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240128 02:46:04.953931 4018843 IPCTensor.h:368] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240128 02:46:04.953944 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240128 02:46:04.953964 4018843 IPCTensor.h:368] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240128 02:46:05.120903 4018843 IPCTensor.h:368] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240128 02:46:05.121037 4018843 IPCTensor.h:368] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=10523, num_edges=182012,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10996, num_edges=244360,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=9404, num_edges=143355,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10954, num_edges=175447,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10523 N 182012 E
MertisPartition: part 1 has 10996 N 244360 E
MertisPartition: part 2 has 9404 N 143355 E
MertisPartition: part 3 has 10954 N 175447 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([    5,    14,    17,  ..., 11245,  2040,  3009]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
After renumbering graph:  {'_ID': tensor([ 945, 1276, 1372,  ..., 1780, 8350, 9676]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 3, 3])}
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10523, num_edges=182012,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2.200 seconds
[Rank1] pid = 4019053
[Rank2] pid = 4019118
INFO [4018843 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [4019053 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [4019182 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [4019118 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [4019053 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4019182 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4019118 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [4018843 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [4019182 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [4019118 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [4019053 DistTensor.py:56] The tensor name already exists in the kvstore
WARNING [4018843 DistTensor.py:56] The tensor name already exists in the kvstore
I20240128 02:46:08.099026 4019183 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240128 02:46:08.099176 4019119 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 02:46:08.099273 4019184 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 02:46:08.099376 4019054 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240128 02:46:08.540558 4019183 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240128 02:46:08.570665 4019119 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 02:46:08.572872 4019184 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240128 02:46:08.577452 4019054 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 676.327 us                | 676.327 us                |
| bucket keys               | 872.246 us                | 132.895 ms                |
| forward: a2a keys         | 135.837 ms                | 1.611 s                   |
| forward: search cache     | 134.428 us                | 19.481 ms                 |
| forward: a2a values       | 2.689 ms                  | 9.505 ms                  |
| forward: join             | 1.720 ms                  | 4.813 ms                  |
| Forward                   | 2.535 s                   | 2.535 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.659 ms                  | 36.585 ms                 |
| bucket keys               | 1.996 ms                  | 2.864 ms                  |
| forward: a2a keys         | 2.236 ms                  | 135.837 ms                |
| forward: search cache     | 295.419 us                | 400.409 us                |
| forward: a2a values       | 2.535 ms                  | 6.606 ms                  |
| forward: join             | 2.861 ms                  | 4.129 ms                  |
| Forward                   | 30.563 ms                 | 2.535 s                   |
| back: aggr dram keys      | 26.129 ms                 | 32.355 ms                 |
| back: set dram grad       | 2.599 ms                  | 5.805 ms                  |
| back: a2a grad            | 3.415 ms                  | 6.232 ms                  |
| back: grad sum & grad cache  | 1.910 ms                  | 2.508 ms                  |
| Backward                  | 72.640 ms                 | 2.469 s                   |
| Optimize                  | 18.476 ms                 | 38.810 ms                 |
| BarrierTimeBeforeRank0    | 55.398 us                 | 79.590 us                 |
| BlockToStepN              | 22.880 us                 | 42.983 us                 |
| OneStep                   | 127.852 ms                | 5.024 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.748 ms                  | 35.350 ms                 |
| bucket keys               | 2.056 ms                  | 2.752 ms                  |
| forward: a2a keys         | 2.197 ms                  | 8.528 ms                  |
| forward: search cache     | 304.050 us                | 387.000 us                |
| forward: a2a values       | 2.644 ms                  | 3.652 ms                  |
| forward: join             | 2.917 ms                  | 4.813 ms                  |
| Forward                   | 30.563 ms                 | 37.097 ms                 |
| back: aggr dram keys      | 24.869 ms                 | 32.355 ms                 |
| back: set dram grad       | 2.338 ms                  | 5.805 ms                  |
| back: a2a grad            | 3.280 ms                  | 5.165 ms                  |
| back: grad sum & grad cache  | 1.937 ms                  | 2.518 ms                  |
| Backward                  | 69.180 ms                 | 78.528 ms                 |
| Optimize                  | 17.606 ms                 | 36.853 ms                 |
| BarrierTimeBeforeRank0    | 53.960 us                 | 86.339 us                 |
| BlockToStepN              | 23.413 us                 | 35.451 us                 |
| OneStep                   | 125.271 ms                | 155.644 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 17.331, sample: 0.519, forward: 5.543, backward: 9.160, update: 0.293
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 17.336, sample: 0.555, forward: 5.611, backward: 9.050, update: 0.335
[Rank3] pid = 4019182
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
train_sampler.Prefill()
-------Step 0-------
tensor([11900,  4786, 10123,  7935,  6283,  6167,   722,  3476,  9366,  7356]) tensor([ 1372,  6180, 10216,  3051, 10549, 11507, 14006, 11813, 10460,  8723])
-------Step 1-------
tensor([11900,  4786, 10123,  7935,  6283,  6167,   722,  3476,  9366,  7356]) tensor([ 2272,   413,  7338,  4805, 13081,   106, 13313,  5625,  5532,  8111])
-------Step 2-------
tensor([   76, 14801, 13219, 12136,  4049,  6544, 14480,  4887,  2717,  1468]) tensor([13408,  5278, 11518, 11596,  3509,  7596,  4743,   385, 12604, 13351])
-------Step 3-------
tensor([   76, 14801, 13219, 12136,  4049,  6544, 14480,  4887,  2717,  1468]) tensor([ 9917, 13460,  4554,  5468,  3174,  6625, 13481,  5541,  7018, 10260])
-------Step 4-------
tensor([12736, 10615, 10977,  7389,  4978,  5179,  1042,  4172,  5368, 14481]) tensor([  378,  8273, 11537,  1066, 11457, 13189,  1414, 10664,  8182,  8995])
-------Step 5-------
tensor([12736, 10615, 10977,  7389,  4978,  5179,  1042,  4172,  5368, 14481]) tensor([ 4376, 12541,  3990, 11461,  7072, 12560,  3939,   879, 14209,  1309])
-------Step 6-------
tensor([ 4981, 11624,  9579,  8264,  2746, 12675,  6255, 10914,  6885,  7320]) tensor([10152, 11667, 14670,   525,  9631, 10640,  8901,  2096,  7736, 10339])
-------Step 7-------
tensor([ 4981, 11624,  9579,  8264,  2746, 12675,  6255, 10914,  6885,  7320]) tensor([ 5970,  4408,  7275, 13086,  7887, 10785,  5359, 13587, 10667,  4945])
-------Step 8-------
tensor([  370, 13138,  6097,  4758,  2222,  9101,  2684,  3385,   205,  7361]) tensor([ 5847, 13844, 14395, 11212,  8430,  9960,  4882,  1674,  2230,  6758])
-------Step 9-------
tensor([  370, 13138,  6097,  4758,  2222,  9101,  2684,  3385,   205,  7361]) tensor([ 2164, 12508,  3523, 14019,  2625,   298,  2866,  1053, 14329, 13213])
before start barrier
start train
[proc 0] 100 steps, total: 17.368, sample: 0.542, forward: 5.529, backward: 9.257, update: 1.878
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 17.338, sample: 0.557, forward: 5.572, backward: 9.105, update: 0.300
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.789 ms                  | 36.097 ms                 |
| bucket keys               | 2.139 ms                  | 2.864 ms                  |
| forward: a2a keys         | 2.130 ms                  | 35.340 ms                 |
| forward: search cache     | 311.881 us                | 396.275 us                |
| forward: a2a values       | 2.704 ms                  | 5.187 ms                  |
| forward: join             | 2.959 ms                  | 4.813 ms                  |
| Forward                   | 31.136 ms                 | 60.834 ms                 |
| back: aggr dram keys      | 24.438 ms                 | 32.355 ms                 |
| back: set dram grad       | 2.326 ms                  | 5.805 ms                  |
| back: a2a grad            | 3.319 ms                  | 5.165 ms                  |
| back: grad sum & grad cache  | 1.910 ms                  | 2.665 ms                  |
| Backward                  | 66.545 ms                 | 78.528 ms                 |
| Optimize                  | 16.743 ms                 | 36.853 ms                 |
| BarrierTimeBeforeRank0    | 53.746 us                 | 106.876 us                |
| BlockToStepN              | 24.651 us                 | 43.943 us                 |
| OneStep                   | 121.788 ms                | 155.644 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.803 ms                  | 36.111 ms                 |
| bucket keys               | 2.139 ms                  | 2.752 ms                  |
| forward: a2a keys         | 2.081 ms                  | 35.141 ms                 |
| forward: search cache     | 309.605 us                | 393.775 us                |
| forward: a2a values       | 2.663 ms                  | 4.095 ms                  |
| forward: join             | 2.959 ms                  | 4.695 ms                  |
| Forward                   | 31.335 ms                 | 60.834 ms                 |
| back: aggr dram keys      | 24.266 ms                 | 31.826 ms                 |
| back: set dram grad       | 2.279 ms                  | 5.668 ms                  |
| back: a2a grad            | 3.343 ms                  | 4.755 ms                  |
| back: grad sum & grad cache  | 1.904 ms                  | 2.665 ms                  |
| Backward                  | 65.702 ms                 | 77.866 ms                 |
| Optimize                  | 16.655 ms                 | 35.235 ms                 |
| BarrierTimeBeforeRank0    | 53.665 us                 | 86.339 us                 |
| BlockToStepN              | 24.310 us                 | 42.983 us                 |
| OneStep                   | 121.648 ms                | 155.644 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.790 ms                  | 36.111 ms                 |
| bucket keys               | 2.132 ms                  | 2.741 ms                  |
| forward: a2a keys         | 2.135 ms                  | 35.340 ms                 |
| forward: search cache     | 304.050 us                | 393.775 us                |
| forward: a2a values       | 2.656 ms                  | 3.652 ms                  |
| forward: join             | 2.951 ms                  | 4.813 ms                  |
| Forward                   | 31.371 ms                 | 61.977 ms                 |
| back: aggr dram keys      | 24.186 ms                 | 31.748 ms                 |
| back: set dram grad       | 2.262 ms                  | 5.612 ms                  |
| back: a2a grad            | 3.393 ms                  | 4.730 ms                  |
| back: grad sum & grad cache  | 1.901 ms                  | 2.637 ms                  |
| Backward                  | 65.495 ms                 | 77.866 ms                 |
| Optimize                  | 16.515 ms                 | 35.235 ms                 |
| BarrierTimeBeforeRank0    | 53.306 us                 | 86.339 us                 |
| BlockToStepN              | 23.855 us                 | 42.983 us                 |
| OneStep                   | 120.986 ms                | 155.644 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 200 steps, total: 12.411, sample: 0.610, forward: 3.582, backward: 6.414, update: 0.306
[proc 3] 200 steps, total: 12.412, sample: 0.567, forward: 3.629, backward: 6.398, update: 0.304
[proc 0] 200 steps, total: 12.412, sample: 0.585, forward: 3.597, backward: 6.499, update: 1.608
[proc 1] 200 steps, total: 12.412, sample: 0.631, forward: 3.554, backward: 6.420, update: 0.318
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.748 ms                  | 36.111 ms                 |
| bucket keys               | 1.984 ms                  | 2.719 ms                  |
| forward: a2a keys         | 2.374 ms                  | 38.953 ms                 |
| forward: search cache     | 281.491 us                | 387.044 us                |
| forward: a2a values       | 2.665 ms                  | 3.627 ms                  |
| forward: join             | 2.772 ms                  | 4.695 ms                  |
| Forward                   | 31.230 ms                 | 61.977 ms                 |
| back: aggr dram keys      | 24.283 ms                 | 31.748 ms                 |
| back: set dram grad       | 2.266 ms                  | 5.627 ms                  |
| back: a2a grad            | 3.398 ms                  | 4.730 ms                  |
| back: grad sum & grad cache  | 1.886 ms                  | 2.555 ms                  |
| Backward                  | 65.779 ms                 | 79.219 ms                 |
| Optimize                  | 16.030 ms                 | 35.235 ms                 |
| BarrierTimeBeforeRank0    | 51.131 us                 | 86.339 us                 |
| BlockToStepN              | 24.000 us                 | 42.983 us                 |
| OneStep                   | 120.821 ms                | 155.644 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.657 ms                  | 36.097 ms                 |
| bucket keys               | 1.823 ms                  | 2.696 ms                  |
| forward: a2a keys         | 2.954 ms                  | 39.399 ms                 |
| forward: search cache     | 258.663 us                | 387.000 us                |
| forward: a2a values       | 2.701 ms                  | 3.626 ms                  |
| forward: join             | 2.643 ms                  | 4.635 ms                  |
| Forward                   | 31.209 ms                 | 62.132 ms                 |
| back: aggr dram keys      | 24.405 ms                 | 31.748 ms                 |
| back: set dram grad       | 2.268 ms                  | 5.674 ms                  |
| back: a2a grad            | 3.399 ms                  | 4.388 ms                  |
| back: grad sum & grad cache  | 1.885 ms                  | 2.548 ms                  |
| Backward                  | 66.133 ms                 | 79.219 ms                 |
| Optimize                  | 15.173 ms                 | 34.303 ms                 |
| BarrierTimeBeforeRank0    | 48.444 us                 | 82.166 us                 |
| BlockToStepN              | 24.435 us                 | 42.983 us                 |
| OneStep                   | 120.546 ms                | 153.775 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 300 steps, total: 12.190, sample: 0.678, forward: 3.736, backward: 6.465, update: 0.309
[proc 2] 300 steps, total: 12.190, sample: 0.612, forward: 3.800, backward: 6.468, update: 0.313
[proc 1] 300 steps, total: 12.190, sample: 0.603, forward: 3.795, backward: 6.504, update: 0.318
[proc 0] 300 steps, total: 12.190, sample: 0.284, forward: 3.893, backward: 6.802, update: 1.117
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.594 ms                  | 36.097 ms                 |
| bucket keys               | 1.613 ms                  | 2.696 ms                  |
| forward: a2a keys         | 3.461 ms                  | 39.900 ms                 |
| forward: search cache     | 226.402 us                | 387.044 us                |
| forward: a2a values       | 2.704 ms                  | 3.626 ms                  |
| forward: join             | 2.522 ms                  | 4.695 ms                  |
| Forward                   | 31.175 ms                 | 63.253 ms                 |
| back: aggr dram keys      | 24.480 ms                 | 31.826 ms                 |
| back: set dram grad       | 2.279 ms                  | 5.705 ms                  |
| back: a2a grad            | 3.415 ms                  | 4.730 ms                  |
| back: grad sum & grad cache  | 1.885 ms                  | 2.555 ms                  |
| Backward                  | 66.296 ms                 | 79.219 ms                 |
| Optimize                  | 14.371 ms                 | 34.303 ms                 |
| BarrierTimeBeforeRank0    | 46.578 us                 | 82.166 us                 |
| BlockToStepN              | 24.653 us                 | 42.983 us                 |
| OneStep                   | 120.496 ms                | 153.775 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.499 ms                  | 35.350 ms                 |
| bucket keys               | 1.461 ms                  | 2.680 ms                  |
| forward: a2a keys         | 4.163 ms                  | 40.525 ms                 |
| forward: search cache     | 208.756 us                | 387.000 us                |
| forward: a2a values       | 2.707 ms                  | 3.424 ms                  |
| forward: join             | 2.387 ms                  | 4.635 ms                  |
| Forward                   | 31.209 ms                 | 64.946 ms                 |
| back: aggr dram keys      | 24.533 ms                 | 31.826 ms                 |
| back: set dram grad       | 2.277 ms                  | 5.728 ms                  |
| back: a2a grad            | 3.417 ms                  | 4.388 ms                  |
| back: grad sum & grad cache  | 1.881 ms                  | 2.665 ms                  |
| Backward                  | 66.276 ms                 | 79.219 ms                 |
| Optimize                  | 13.753 ms                 | 33.577 ms                 |
| BarrierTimeBeforeRank0    | 43.975 us                 | 81.608 us                 |
| BlockToStepN              | 24.902 us                 | 42.983 us                 |
| OneStep                   | 119.663 ms                | 153.775 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 12.129, sample: 0.250, forward: 3.930, backward: 6.745, update: 1.105
[proc 3] 400 steps, total: 12.129, sample: 0.579, forward: 3.848, backward: 6.386, update: 0.311
[proc 1] 400 steps, total: 12.129, sample: 0.659, forward: 3.738, backward: 6.438, update: 0.336
[proc 2] 400 steps, total: 12.129, sample: 0.622, forward: 3.811, backward: 6.369, update: 0.322
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.430 ms                  | 35.350 ms                 |
| bucket keys               | 1.124 ms                  | 2.674 ms                  |
| forward: a2a keys         | 4.731 ms                  | 40.511 ms                 |
| forward: search cache     | 173.814 us                | 386.232 us                |
| forward: a2a values       | 2.727 ms                  | 3.422 ms                  |
| forward: join             | 2.164 ms                  | 4.617 ms                  |
| Forward                   | 31.136 ms                 | 64.946 ms                 |
| back: aggr dram keys      | 24.582 ms                 | 31.826 ms                 |
| back: set dram grad       | 2.277 ms                  | 5.728 ms                  |
| back: a2a grad            | 3.418 ms                  | 4.123 ms                  |
| back: grad sum & grad cache  | 1.884 ms                  | 2.675 ms                  |
| Backward                  | 66.359 ms                 | 79.409 ms                 |
| Optimize                  | 13.038 ms                 | 33.577 ms                 |
| BarrierTimeBeforeRank0    | 40.983 us                 | 82.166 us                 |
| BlockToStepN              | 25.066 us                 | 49.057 us                 |
| OneStep                   | 119.244 ms                | 153.775 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.366 ms                  | 36.111 ms                 |
| bucket keys               | 1.067 ms                  | 2.670 ms                  |
| forward: a2a keys         | 4.779 ms                  | 40.199 ms                 |
| forward: search cache     | 158.145 us                | 386.232 us                |
| forward: a2a values       | 2.727 ms                  | 3.413 ms                  |
| forward: join             | 2.120 ms                  | 4.508 ms                  |
| Forward                   | 31.041 ms                 | 64.946 ms                 |
| back: aggr dram keys      | 24.584 ms                 | 31.821 ms                 |
| back: set dram grad       | 2.273 ms                  | 5.714 ms                  |
| back: a2a grad            | 3.422 ms                  | 4.092 ms                  |
| back: grad sum & grad cache  | 1.881 ms                  | 2.665 ms                  |
| Backward                  | 66.375 ms                 | 79.409 ms                 |
| Optimize                  | 12.780 ms                 | 33.577 ms                 |
| BarrierTimeBeforeRank0    | 39.908 us                 | 82.166 us                 |
| BlockToStepN              | 25.075 us                 | 140.182 us                |
| OneStep                   | 119.244 ms                | 153.775 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.451 ms                  | 36.441 ms                 |
| bucket keys               | 1.423 ms                  | 2.674 ms                  |
| forward: a2a keys         | 4.443 ms                  | 40.150 ms                 |
| forward: search cache     | 196.741 us                | 386.232 us                |
| forward: a2a values       | 2.711 ms                  | 3.499 ms                  |
| forward: join             | 2.266 ms                  | 4.635 ms                  |
| Forward                   | 31.459 ms                 | 63.253 ms                 |
| back: aggr dram keys      | 24.568 ms                 | 31.821 ms                 |
| back: set dram grad       | 2.271 ms                  | 5.705 ms                  |
| back: a2a grad            | 3.428 ms                  | 4.092 ms                  |
| back: grad sum & grad cache  | 1.881 ms                  | 2.698 ms                  |
| Backward                  | 66.296 ms                 | 79.219 ms                 |
| Optimize                  | 13.333 ms                 | 32.894 ms                 |
| BarrierTimeBeforeRank0    | 42.440 us                 | 81.608 us                 |
| BlockToStepN              | 24.859 us                 | 49.057 us                 |
| OneStep                   | 120.006 ms                | 153.641 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 500 steps, total: 12.393, sample: 0.558, forward: 3.743, backward: 6.436, update: 0.297
[proc 1] 500 steps, total: 12.393, sample: 0.476, forward: 3.749, backward: 6.523, update: 0.278
[proc 0] 500 steps, total: 12.394, sample: 0.490, forward: 3.706, backward: 6.657, update: 1.424
[proc 2] 500 steps, total: 12.393, sample: 0.578, forward: 3.721, backward: 6.446, update: 0.306
Successfully xmh. training takes 66.49298548698425 seconds
before call kg_cache_controller.StopThreads()
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
INFO [4018843 controller_process.py:414] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.456 ms                  | 36.585 ms                 |
| bucket keys               | 1.434 ms                  | 2.674 ms                  |
| forward: a2a keys         | 4.382 ms                  | 40.150 ms                 |
| forward: search cache     | 202.934 us                | 387.000 us                |
| forward: a2a values       | 2.704 ms                  | 3.537 ms                  |
| forward: join             | 2.296 ms                  | 4.695 ms                  |
| Forward                   | 31.510 ms                 | 63.253 ms                 |
| back: aggr dram keys      | 24.561 ms                 | 31.821 ms                 |
| back: set dram grad       | 2.271 ms                  | 5.705 ms                  |
| back: a2a grad            | 3.445 ms                  | 4.092 ms                  |
| back: grad sum & grad cache  | 1.881 ms                  | 2.710 ms                  |
| Backward                  | 66.280 ms                 | 79.219 ms                 |
| Optimize                  | 13.360 ms                 | 32.894 ms                 |
| BarrierTimeBeforeRank0    | 42.504 us                 | 81.608 us                 |
| BlockToStepN              | 24.653 us                 | 49.057 us                 |
| OneStep                   | 120.044 ms                | 153.641 ms                |
+---------------------------+---------------------------+---------------------------+

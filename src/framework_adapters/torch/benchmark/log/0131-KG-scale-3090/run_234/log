WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 10:07:23.057166 34898 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_36', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [34898 sampler.py:454] Start PreSampling
WARNING [34898 sampler.py:532] Before construct renumbering_dict
WARNING [34898 sampler.py:555] PreSampling done
W20240207 10:26:57.901671 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 10:26:57.901854 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 10:26:57.901893 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 10:26:57.901929 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 10:26:57.901965 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 10:26:57.902000 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 10:26:57.902037 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 10:26:57.902078 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 10:26:57.902110 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 10:26:57.902138 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 10:26:57.902168 34898 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 10:26:57.902197 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 10:26:57.902225 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 10:26:57.902386 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 10:26:57.902426 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 10:26:57.902462 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 10:26:57.902505 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 10:26:57.902539 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 10:26:57.902580 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 10:26:57.902617 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 10:26:57.902647 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 10:26:57.902676 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 10:26:57.902709 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 10:26:57.902737 34898 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 10:26:57.902760 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 10:26:57.902786 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 10:26:57.902845 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240207 10:26:57.902879 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240207 10:26:57.902912 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240207 10:26:57.902945 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240207 10:26:57.902972 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240207 10:26:57.902999 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240207 10:26:57.903031 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240207 10:26:57.903059 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240207 10:26:57.903097 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240207 10:26:57.903131 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240207 10:26:57.903162 34898 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240207 10:26:57.903184 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240207 10:26:57.903208 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240207 10:26:57.903271 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240207 10:26:57.903307 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240207 10:26:57.903342 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240207 10:26:57.903369 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240207 10:26:57.903398 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240207 10:26:57.903426 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240207 10:26:57.903465 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240207 10:26:57.903493 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240207 10:26:57.903525 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240207 10:26:57.903558 34898 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240207 10:26:57.903589 34898 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240207 10:26:57.903614 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240207 10:26:57.903638 34898 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240207 10:26:58.283275 34898 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240207 10:35:39.324862 34898 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302708,  4302738,   112178,  ..., 57542561, 12800124,  2595667]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2204.489 seconds
[Rank1] pid = 35990
[Rank2] pid = 36085
INFO [34898 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [35990 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [36085 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [36155 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [36085 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [36155 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [34898 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [35990 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240207 10:44:13.472487 36086 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240207 10:44:13.474440 36219 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240207 10:44:13.474858 35991 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240207 10:44:13.474920 36156 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240207 10:44:13.529896 36156 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036619000 7.629 MB
W20240207 10:44:13.529991 36219 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102036dbc000 7.629 MB
W20240207 10:44:13.530006 35991 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10203755f000 7.629 MB
W20240207 10:44:13.530023 36086 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x102037d02000 7.629 MB
W20240207 10:44:13.530122 36156 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1020384a5000 7.629 MB
W20240207 10:44:13.530220 36156 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102038c48000 1.49 GB
W20240207 10:44:13.530270 36219 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10209822b000 7.629 MB
W20240207 10:44:13.530293 36156 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1020989ce000 1.49 GB
W20240207 10:44:13.530325 35991 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1020f7fb1000 7.629 MB
W20240207 10:44:13.530331 36086 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020f8754000 7.629 MB
W20240207 10:44:13.530340 36219 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240207 10:44:13.530373 36156 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 10:44:13.530392 35991 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1021584da000 1.49 GB
W20240207 10:44:13.530395 36219 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1021b7abd000 1.49 GB
W20240207 10:44:13.530401 36086 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1022170a0000 1.49 GB
W20240207 10:44:13.530449 35991 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x102276683000 1.49 GB
W20240207 10:44:13.530481 36086 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1022d5c66000 1.49 GB
W20240207 10:44:13.532099 36086 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 10:44:13.532099 36219 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 10:44:13.532114 35991 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240207 10:44:13.532222 36156 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 10:44:13.538590 36086 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 10:44:13.538609 36219 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 10:44:13.538659 35991 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [36085 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [36155 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [35990 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 36155
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [34898 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 10:44:45.877903 36219 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240207 10:44:45.878407 36086 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 10:44:45.878526 36156 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 10:44:45.878827 35991 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240207 10:44:45.881191 36219 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240207 10:44:45.881428 36219 grad_base.h:184] Init GradProcessingBase done
I20240207 10:44:58.151619 36219 grad_async_v2.h:42] Use main thread to update emb.
W20240207 10:44:58.151801 36219 kg_controller.h:78] after init GradAsyncProcessingV2
I20240207 10:44:58.151811 36219 kg_controller.h:84] Construct KGCacheController done
E20240207 10:44:58.649344 35991 recstore.cc:66] init folly done
E20240207 10:44:58.649374 36219 recstore.cc:66] init folly done
E20240207 10:44:58.649399 36086 recstore.cc:66] init folly done
E20240207 10:44:58.649402 36156 recstore.cc:66] init folly done
I20240207 10:44:58.650336 36219 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240207 10:45:10.488647 36516 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 10:45:10.489189 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 10:45:11.708448 36516 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 10:45:11.708595 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 149.154 us                | 328.816 us                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:15.930995 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 10:45:15.945463 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 10:45:16.123921 36156 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 146.219 us                | 261.772 us                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:18.802203 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 10:45:18.817078 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 10:45:18.853539 36086 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240207 10:45:18.951210 35991 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240207 10:45:19.817024 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=7
I20240207 10:45:20.095777 36219 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240207 10:45:20.114696 36516 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 11.366 ms                 | 11.366 ms                 |
| Forward                   | 512.474 ms                | 512.474 ms                |
| Backward                  | 193.082 ms                | 193.082 ms                |
| Optimize                  | 44.163 ms                 | 44.163 ms                 |
| BarrierTimeBeforeRank0    | 66.799 us                 | 66.799 us                 |
+---------------------------+---------------------------+---------------------------+
E20240207 10:45:21.366420 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 10:45:21.436797 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 10:45:21.467471 36219 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=1, sample_step_cpp_seen_[rank]=0
W20240207 10:45:21.791877 36219 grad_async_v2.h:257] pq is empty
W20240207 10:45:21.908730 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=3, pq.top=3
W20240207 10:45:22.202131 36219 grad_async_v2.h:257] pq is empty
E20240207 10:45:22.370537 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 10:45:22.524763 36516 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end8
W20240207 10:45:22.589915 36219 grad_async_v2.h:257] pq is empty
W20240207 10:45:22.930397 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=12, pq.top=12
E20240207 10:45:23.370012 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=10
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 175.801 us                | 736.745 us                |
| ProcessBack:Shuffle       | 2.788 ms                  | 173.119 ms                |
| ProcessBack:UpdateCache   | 3.104 ms                  | 265.852 ms                |
| ProcessBack:UpsertPq      | 43.415 ms                 | 87.073 ms                 |
| ProcessOneStep            | 75.373 ms                 | 574.787 ms                |
| BlockToStepN              | 138.926 us                | 4.555 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:23.708973 36516 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end9
E20240207 10:45:24.370008 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=95
W20240207 10:45:24.797713 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=29, pq.top=29
W20240207 10:45:24.809927 36516 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
E20240207 10:45:25.375741 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 10:45:25.840124 36516 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
W20240207 10:45:25.840624 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=39, pq.top=39
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.130 ms                  | 132.345 ms                |
| Forward                   | 5.520 ms                  | 512.474 ms                |
| Backward                  | 5.377 ms                  | 193.082 ms                |
| Optimize                  | 2.408 ms                  | 44.163 ms                 |
| BarrierTimeBeforeRank0    | 57.080 us                 | 14.437 ms                 |
| AfterBackward             | 54.941 ms                 | 594.579 ms                |
| BlockToStepN              | 205.008 us                | 6.082 ms                  |
| OneStep                   | 79.151 ms                 | 1.338 s                   |
+---------------------------+---------------------------+---------------------------+
E20240207 10:45:26.375010 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=11
E20240207 10:45:26.729786 36219 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=53, sample_step_cpp_seen_[rank]=52
W20240207 10:45:26.940302 36516 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
E20240207 10:45:27.396093 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 10:45:27.963019 36516 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end3
W20240207 10:45:28.003834 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=63, pq.top=63
E20240207 10:45:28.396018 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=3782
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 376.445 us                | 4.730 ms                  |
| ProcessBack:Shuffle       | 2.710 ms                  | 137.480 ms                |
| ProcessBack:UpdateCache   | 2.855 ms                  | 263.289 ms                |
| ProcessBack:UpsertPq      | 14.966 ms                 | 86.563 ms                 |
| ProcessOneStep            | 47.901 ms                 | 594.463 ms                |
| BlockToStepN              | 274.011 us                | 7.848 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:29.057345 36516 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240207 10:45:29.396011 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=12834
W20240207 10:45:29.423305 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=77, pq.top=77
W20240207 10:45:30.135138 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
E20240207 10:45:30.396056 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=31815
W20240207 10:45:30.427276 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=92, pq.top=91
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.752 ms                  | 120.295 ms                |
| Forward                   | 5.776 ms                  | 9.066 ms                  |
| Backward                  | 5.299 ms                  | 16.045 ms                 |
| Optimize                  | 2.408 ms                  | 17.284 ms                 |
| BarrierTimeBeforeRank0    | 33.660 us                 | 14.437 ms                 |
| AfterBackward             | 46.458 ms                 | 594.579 ms                |
| BlockToStepN              | 736.791 us                | 10.538 ms                 |
| OneStep                   | 74.900 ms                 | 619.386 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:31.167557 36516 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240207 10:45:31.396013 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=24096
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 12.572, sample: 1.084, forward: 1.049, backward: 0.752, update: 0.266
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 12.474, sample: 1.016, forward: 0.989, backward: 0.731, update: 0.257
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 15.302, sample: 1.010, forward: 1.014, backward: 0.704, update: 0.253
train_sampler.Prefill()
-------Step 0-------
tensor([   74798,   513397, 45657044,   663163,   487865,   513419,   513443,
          231087,    74836,    74867]) tensor([ 4975952, 25159380, 20103970, 45621659, 60690044, 30544416, 78627326,
        65991344, 61611208, 79043226])
-------Step 1-------
tensor([   74798,   513397, 45657044,   663163,   487865,   513419,   513443,
          231087,    74836,    74867]) tensor([30944573, 75176670, 83037869,  9444989, 52653081,  9193774, 73952948,
        83921983, 19219154, 35043976])
-------Step 2-------
tensor([  583584,    88954, 79373144,    89001,   583610,   583628,   583654,
        44999850,   583675,   583687]) tensor([35097243,  5033601, 52519601, 11133638, 16694329, 13426432, 50820959,
        10376052, 47408888, 37216497])
-------Step 3-------
tensor([  583584,    88954, 79373144,    89001,   583610,   583628,   583654,
        44999850,   583675,   583687]) tensor([20677163, 42934188, 70951889, 39054573, 13502526, 58392139, 67438426,
        55599011, 25472769, 82085739])
-------Step 4-------
tensor([653292, 103433, 653310, 653341, 103474, 653363, 103520, 653391, 103555,
        653408]) tensor([73476038, 37564276, 18797350, 13826700, 55572874, 43252964, 83851785,
        53165788, 50169086,  9970549])
-------Step 5-------
tensor([653292, 103433, 653310, 653341, 103474, 653363, 103520, 653391, 103555,
        653408]) tensor([38434108, 43807114, 71949085,  8622700, 36077918, 27268405, 31341564,
        62792303, 76781989,   609245])
-------Step 6-------
tensor([81672696,   722004,   722031,   722053,  4309231,   722079,   722102,
          722125,   722147,   236890]) tensor([24305396, 36088289, 28268614, 17565232, 81691743, 50145150, 40446507,
        13800739, 66985101,  8456833])
-------Step 7-------
tensor([81672696,   722004,   722031,   722053,  4309231,   722079,   722102,
          722125,   722147,   236890]) tensor([42653760, 82092201, 47473302, 70027853, 56905421,  1567865, 19083836,
        52559086, 18136125, 16041496])
-------Step 8-------
tensor([  790321,   133813,   790344, 35138997,   696984,   790367,   790392,
          790424,   238566,   697004]) tensor([26648687, 56665389, 46731970, 85778949, 76937752, 70555849, 60588620,
        83538252,  9613565,  3241321])
-------Step 9-------
tensor([  790321,   133813,   790344, 35138997,   696984,   790367,   790392,
          790424,   238566,   697004]) tensor([73396530, 57175055, 22265327, 46064114, 12758992,  1042215, 19295358,
        12847105, 83913115, 50920769])
before start barrier
start train
[proc 0] 100 steps, total: 11.330, sample: 1.381, forward: 1.077, backward: 0.728, update: 0.329
W20240207 10:45:31.934177 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=105, pq.top=105
W20240207 10:45:32.197818 36516 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
E20240207 10:45:32.396019 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=32
E20240207 10:45:32.545477 36323 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=113, sample_step_cpp_seen_[rank]=112
W20240207 10:45:33.100733 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=114, pq.top=114
W20240207 10:45:33.227126 36516 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end6
E20240207 10:45:33.396028 36538 parallel_pq_v2.h:79] insert failed, size(hashtable)=6471
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 309.808 us                | 7.637 ms                  |
| ProcessBack:Shuffle       | 2.744 ms                  | 9.810 ms                  |
| ProcessBack:UpdateCache   | 2.787 ms                  | 4.361 ms                  |
| ProcessBack:UpsertPq      | 13.102 ms                 | 80.695 ms                 |
| ProcessOneStep            | 46.386 ms                 | 594.463 ms                |
| BlockToStepN              | 677.108 us                | 20.384 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:34.108665 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=127, pq.top=127
W20240207 10:45:34.302551 36516 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
E20240207 10:45:34.396010 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=4558
W20240207 10:45:35.302435 36516 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240207 10:45:35.396009 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=468
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.413 ms                  | 120.295 ms                |
| Forward                   | 5.881 ms                  | 11.755 ms                 |
| Backward                  | 5.278 ms                  | 16.045 ms                 |
| Optimize                  | 2.458 ms                  | 38.066 ms                 |
| BarrierTimeBeforeRank0    | 33.911 us                 | 39.698 ms                 |
| AfterBackward             | 45.846 ms                 | 594.579 ms                |
| BlockToStepN              | 739.186 us                | 20.463 ms                 |
| OneStep                   | 74.156 ms                 | 619.386 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:35.896132 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=143, pq.top=143
E20240207 10:45:36.396013 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=258
W20240207 10:45:36.527627 36516 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end9
W20240207 10:45:36.982748 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=151, pq.top=151
E20240207 10:45:37.396013 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=3415
W20240207 10:45:37.627233 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end4
W20240207 10:45:38.032080 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=158, pq.top=158
E20240207 10:45:38.396013 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1467
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 475.187 us                | 8.245 ms                  |
| ProcessBack:Shuffle       | 2.744 ms                  | 6.480 ms                  |
| ProcessBack:UpdateCache   | 2.704 ms                  | 4.323 ms                  |
| ProcessBack:UpsertPq      | 13.102 ms                 | 79.924 ms                 |
| ProcessOneStep            | 46.159 ms                 | 578.908 ms                |
| BlockToStepN              | 897.391 us                | 20.384 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:38.684993 36516 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end6
E20240207 10:45:38.864733 36323 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=166, sample_step_cpp_seen_[rank]=165
E20240207 10:45:39.396016 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1678
W20240207 10:45:39.732249 36516 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240207 10:45:40.396008 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=735
W20240207 10:45:40.475965 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=177, pq.top=177
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.010 ms                  | 174.782 ms                |
| Forward                   | 5.833 ms                  | 11.755 ms                 |
| Backward                  | 5.195 ms                  | 6.665 ms                  |
| Optimize                  | 2.426 ms                  | 17.284 ms                 |
| BarrierTimeBeforeRank0    | 35.325 us                 | 36.998 ms                 |
| AfterBackward             | 46.037 ms                 | 594.579 ms                |
| BlockToStepN              | 928.222 us                | 22.740 ms                 |
| OneStep                   | 75.679 ms                 | 619.386 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:40.917924 36516 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
E20240207 10:45:41.396009 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=758
W20240207 10:45:42.031359 36516 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end3
E20240207 10:45:42.396040 36515 parallel_pq_v2.h:79] insert failed, size(hashtable)=27106
W20240207 10:45:42.628818 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=197, pq.top=197
[proc 3] 200 steps, total: 11.595, sample: 1.706, forward: 0.545, backward: 0.520, update: 0.225
[proc 2] 200 steps, total: 11.595, sample: 2.002, forward: 0.503, backward: 0.501, update: 0.262
[proc 1] 200 steps, total: 11.595, sample: 1.995, forward: 0.497, backward: 0.542, update: 0.203
[proc 0] 200 steps, total: 11.594, sample: 3.042, forward: 0.591, backward: 0.505, update: 0.300
W20240207 10:45:43.033931 36516 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
E20240207 10:45:43.396009 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=3307
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 363.294 us                | 12.503 ms                 |
| ProcessBack:Shuffle       | 2.670 ms                  | 6.480 ms                  |
| ProcessBack:UpdateCache   | 2.695 ms                  | 4.143 ms                  |
| ProcessBack:UpsertPq      | 13.102 ms                 | 74.773 ms                 |
| ProcessOneStep            | 45.095 ms                 | 594.463 ms                |
| BlockToStepN              | 895.416 us                | 22.667 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 10:45:43.864006 36219 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=209, sample_step_cpp_seen_[rank]=208
W20240207 10:45:44.034355 36516 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240207 10:45:44.185379 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=211, pq.top=211
E20240207 10:45:44.396011 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=234
W20240207 10:45:45.261754 36516 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
W20240207 10:45:45.367475 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=227, pq.top=227
E20240207 10:45:45.396009 36323 parallel_pq_v2.h:79] insert failed, size(hashtable)=1305
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.088 ms                  | 174.782 ms                |
| Forward                   | 5.705 ms                  | 11.755 ms                 |
| Backward                  | 5.198 ms                  | 6.665 ms                  |
| Optimize                  | 2.423 ms                  | 17.284 ms                 |
| BarrierTimeBeforeRank0    | 36.324 us                 | 36.998 ms                 |
| AfterBackward             | 43.418 ms                 | 594.579 ms                |
| BlockToStepN              | 1.114 ms                  | 27.754 ms                 |
| OneStep                   | 75.257 ms                 | 619.386 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:46.358433 36516 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240207 10:45:46.396008 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=256
W20240207 10:45:46.724196 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=237, pq.top=237
E20240207 10:45:47.396014 36526 parallel_pq_v2.h:79] insert failed, size(hashtable)=5300
W20240207 10:45:47.531731 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end8
W20240207 10:45:47.754624 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=252, pq.top=252
E20240207 10:45:48.396013 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=484
W20240207 10:45:48.538333 36516 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 359.314 us                | 16.093 ms                 |
| ProcessBack:Shuffle       | 2.670 ms                  | 7.290 ms                  |
| ProcessBack:UpdateCache   | 2.739 ms                  | 4.323 ms                  |
| ProcessBack:UpsertPq      | 13.268 ms                 | 74.547 ms                 |
| ProcessOneStep            | 40.065 ms                 | 578.908 ms                |
| BlockToStepN              | 1.118 ms                  | 38.368 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:48.761556 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=264, pq.top=264
E20240207 10:45:49.127331 36323 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=269, sample_step_cpp_seen_[rank]=268
E20240207 10:45:49.399113 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 10:45:49.555025 36516 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240207 10:45:49.761476 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=273, pq.top=273
E20240207 10:45:50.399008 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=36921
W20240207 10:45:50.579623 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end4
W20240207 10:45:50.791596 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=287, pq.top=287
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.576 ms                  | 147.092 ms                |
| Forward                   | 5.549 ms                  | 9.879 ms                  |
| Backward                  | 5.250 ms                  | 8.875 ms                  |
| Optimize                  | 2.480 ms                  | 17.099 ms                 |
| BarrierTimeBeforeRank0    | 37.664 us                 | 36.998 ms                 |
| AfterBackward             | 38.992 ms                 | 578.957 ms                |
| BlockToStepN              | 1.261 ms                  | 38.449 ms                 |
| OneStep                   | 74.156 ms                 | 617.223 ms                |
+---------------------------+---------------------------+---------------------------+
E20240207 10:45:51.399016 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=3181
W20240207 10:45:51.754366 36516 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
[proc 1] 300 steps, total: 8.890, sample: 1.139, forward: 0.514, backward: 0.604, update: 0.236
[proc 2] 300 steps, total: 8.890, sample: 0.953, forward: 0.497, backward: 0.624, update: 0.263
[proc 0] 300 steps, total: 8.890, sample: 1.363, forward: 0.515, backward: 0.646, update: 0.268
[proc 3] 300 steps, total: 8.890, sample: 0.876, forward: 0.574, backward: 0.644, update: 0.231
W20240207 10:45:52.207425 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=304, pq.top=303
E20240207 10:45:52.399009 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 10:45:52.855316 36516 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240207 10:45:53.207587 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=313, pq.top=313
E20240207 10:45:53.399010 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=26997
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 405.060 us                | 18.289 ms                 |
| ProcessBack:Shuffle       | 2.659 ms                  | 7.290 ms                  |
| ProcessBack:UpdateCache   | 2.690 ms                  | 4.143 ms                  |
| ProcessBack:UpsertPq      | 13.584 ms                 | 74.076 ms                 |
| ProcessOneStep            | 38.437 ms                 | 578.908 ms                |
| BlockToStepN              | 1.358 ms                  | 39.925 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:53.969148 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 10:45:54.203030 36323 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=325, sample_step_cpp_seen_[rank]=324
E20240207 10:45:54.399013 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=4294
W20240207 10:45:54.928795 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=332, pq.top=332
W20240207 10:45:55.145201 36516 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end3
E20240207 10:45:55.407606 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.160 ms                  | 147.092 ms                |
| Forward                   | 5.436 ms                  | 9.879 ms                  |
| Backward                  | 5.317 ms                  | 13.183 ms                 |
| Optimize                  | 2.453 ms                  | 17.099 ms                 |
| BarrierTimeBeforeRank0    | 50.430 us                 | 46.472 ms                 |
| AfterBackward             | 38.472 ms                 | 578.957 ms                |
| BlockToStepN              | 1.538 ms                  | 39.992 ms                 |
| OneStep                   | 74.395 ms                 | 617.223 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:55.976064 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=341, pq.top=341
W20240207 10:45:56.200315 36516 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
E20240207 10:45:56.407014 36543 parallel_pq_v2.h:79] insert failed, size(hashtable)=10460
W20240207 10:45:57.089792 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=354, pq.top=354
W20240207 10:45:57.316200 36516 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240207 10:45:57.407455 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240207 10:45:58.125620 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=367, pq.top=367
E20240207 10:45:58.407014 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=41481
W20240207 10:45:58.586407 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 374.372 us                | 23.362 ms                 |
| ProcessBack:Shuffle       | 2.623 ms                  | 7.018 ms                  |
| ProcessBack:UpdateCache   | 2.670 ms                  | 4.135 ms                  |
| ProcessBack:UpsertPq      | 13.521 ms                 | 73.733 ms                 |
| ProcessOneStep            | 38.437 ms                 | 574.787 ms                |
| BlockToStepN              | 1.521 ms                  | 38.749 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 10:45:59.125319 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=378, pq.top=378
E20240207 10:45:59.205570 36219 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=378, sample_step_cpp_seen_[rank]=377
E20240207 10:45:59.407008 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=7092
W20240207 10:45:59.670919 36516 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
E20240207 10:46:00.407014 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=52475
W20240207 10:46:00.532864 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=389, pq.top=389
W20240207 10:46:00.684243 36516 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.035 ms                  | 132.345 ms                |
| Forward                   | 5.372 ms                  | 9.276 ms                  |
| Backward                  | 5.340 ms                  | 12.011 ms                 |
| Optimize                  | 2.423 ms                  | 15.487 ms                 |
| BarrierTimeBeforeRank0    | 55.007 us                 | 49.185 ms                 |
| AfterBackward             | 38.472 ms                 | 578.957 ms                |
| BlockToStepN              | 1.627 ms                  | 39.992 ms                 |
| OneStep                   | 73.267 ms                 | 617.223 ms                |
+---------------------------+---------------------------+---------------------------+
E20240207 10:46:01.407011 36323 parallel_pq_v2.h:79] insert failed, size(hashtable)=36084
W20240207 10:46:01.532605 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=399, pq.top=398
[proc 0] 400 steps, total: 9.733, sample: 1.025, forward: 0.515, backward: 0.618, update: 0.247
[proc 2] 400 steps, total: 9.733, sample: 1.267, forward: 0.504, backward: 0.520, update: 0.212
[proc 1] 400 steps, total: 9.733, sample: 1.233, forward: 0.654, backward: 0.664, update: 0.240
[proc 3] 400 steps, total: 9.733, sample: 1.088, forward: 0.518, backward: 0.518, update: 0.256
W20240207 10:46:01.946255 36516 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240207 10:46:02.407016 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=23563
W20240207 10:46:02.549007 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=409, pq.top=409
W20240207 10:46:02.969653 36516 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240207 10:46:03.407011 36323 parallel_pq_v2.h:79] insert failed, size(hashtable)=101069
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 419.970 us                | 23.169 ms                 |
| ProcessBack:Shuffle       | 2.618 ms                  | 7.382 ms                  |
| ProcessBack:UpdateCache   | 2.673 ms                  | 4.143 ms                  |
| ProcessBack:UpsertPq      | 13.841 ms                 | 73.733 ms                 |
| ProcessOneStep            | 38.437 ms                 | 578.908 ms                |
| BlockToStepN              | 1.614 ms                  | 42.249 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 10:46:03.734859 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=423, pq.top=423
W20240207 10:46:04.184722 36516 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
E20240207 10:46:04.407013 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=19647
E20240207 10:46:04.416344 36323 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=429, sample_step_cpp_seen_[rank]=428
W20240207 10:46:04.755636 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=434, pq.top=434
W20240207 10:46:05.380118 36516 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end8
E20240207 10:46:05.407006 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=2690
W20240207 10:46:05.822089 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=440, pq.top=440
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.889 ms                  | 132.345 ms                |
| Forward                   | 5.362 ms                  | 9.879 ms                  |
| Backward                  | 5.329 ms                  | 12.011 ms                 |
| Optimize                  | 2.408 ms                  | 15.487 ms                 |
| BarrierTimeBeforeRank0    | 71.394 us                 | 65.458 ms                 |
| AfterBackward             | 38.509 ms                 | 578.957 ms                |
| BlockToStepN              | 1.746 ms                  | 54.338 ms                 |
| OneStep                   | 74.156 ms                 | 617.223 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 10:46:06.387923 36516 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
E20240207 10:46:06.407016 36534 parallel_pq_v2.h:79] insert failed, size(hashtable)=1982
W20240207 10:46:07.037616 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=455, pq.top=455
E20240207 10:46:07.407011 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=7421
W20240207 10:46:07.491955 36516 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
W20240207 10:46:08.072388 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=463, pq.top=463
E20240207 10:46:08.407019 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=160
W20240207 10:46:08.564067 36516 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 413.767 us                | 20.409 ms                 |
| ProcessBack:Shuffle       | 2.617 ms                  | 8.056 ms                  |
| ProcessBack:UpdateCache   | 2.645 ms                  | 4.323 ms                  |
| ProcessBack:UpsertPq      | 13.849 ms                 | 73.733 ms                 |
| ProcessOneStep            | 38.437 ms                 | 578.908 ms                |
| BlockToStepN              | 1.751 ms                  | 54.227 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 10:46:09.378310 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=473, pq.top=473
E20240207 10:46:09.407019 36219 parallel_pq_v2.h:79] insert failed, size(hashtable)=33
W20240207 10:46:09.634615 36516 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end8
E20240207 10:46:10.408233 36533 parallel_pq_v2.h:79] insert failed, size(hashtable)=41540
W20240207 10:46:10.457518 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=488, pq.top=487
W20240207 10:46:10.675011 36516 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
E20240207 10:46:10.707777 36323 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=490, sample_step_cpp_seen_[rank]=489
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.742 ms                  | 131.630 ms                |
| Forward                   | 5.362 ms                  | 9.276 ms                  |
| Backward                  | 5.361 ms                  | 11.702 ms                 |
| Optimize                  | 2.385 ms                  | 9.218 ms                  |
| BarrierTimeBeforeRank0    | 71.394 us                 | 56.449 ms                 |
| AfterBackward             | 38.509 ms                 | 578.957 ms                |
| BlockToStepN              | 1.973 ms                  | 55.737 ms                 |
| OneStep                   | 74.156 ms                 | 610.271 ms                |
+---------------------------+---------------------------+---------------------------+
E20240207 10:46:11.408012 36516 parallel_pq_v2.h:79] insert failed, size(hashtable)=67820
W20240207 10:46:11.533215 36219 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=496, pq.top=496
W20240207 10:46:11.780485 36516 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end9
[proc 0] 500 steps, total: 10.237, sample: 1.072, forward: 0.534, backward: 0.596, update: 0.242
[proc 2] 500 steps, total: 10.237, sample: 1.031, forward: 0.500, backward: 0.564, update: 0.236
[proc 3] 500 steps, total: 10.237, sample: 1.037, forward: 0.526, backward: 0.515, update: 0.228
[proc 1] 500 steps, total: 10.237, sample: 1.455, forward: 0.528, backward: 0.565, update: 0.234
Successfully xmh. training takes 51.785725116729736 seconds
before call kg_cache_controller.StopThreads()
W20240207 10:46:11.881515 36219 grad_async_v2.h:84] call StopThreads. PID = 34898
W20240207 10:46:11.881546 36219 grad_base.h:212] before processOneStepNegThread_.join();
W20240207 10:46:11.881861 36219 grad_base.h:214] after processOneStepNegThread_.join();
W20240207 10:46:11.881870 36219 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240207 10:46:11.922565 36219 grad_async_v2.h:105] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 474.283 us                | 23.216 ms                 |
| ProcessBack:Shuffle       | 2.603 ms                  | 7.867 ms                  |
| ProcessBack:UpdateCache   | 2.623 ms                  | 4.143 ms                  |
| ProcessBack:UpsertPq      | 13.841 ms                 | 73.733 ms                 |
| ProcessOneStep            | 38.482 ms                 | 578.908 ms                |
| BlockToStepN              | 1.933 ms                  | 56.354 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.746 ms                  | 131.630 ms                |
| Forward                   | 5.347 ms                  | 9.276 ms                  |
| Backward                  | 5.362 ms                  | 11.702 ms                 |
| Optimize                  | 2.381 ms                  | 9.218 ms                  |
| BarrierTimeBeforeRank0    | 66.799 us                 | 56.449 ms                 |
| AfterBackward             | 38.509 ms                 | 578.957 ms                |
| BlockToStepN              | 2.035 ms                  | 56.499 ms                 |
| OneStep                   | 74.156 ms                 | 610.271 ms                |
+---------------------------+---------------------------+---------------------------+

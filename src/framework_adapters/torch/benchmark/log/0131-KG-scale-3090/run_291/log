WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240210 01:13:10.220788 62885 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_151', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [62885 sampler.py:454] Start PreSampling
WARNING [62885 sampler.py:532] Before construct renumbering_dict
WARNING [62885 sampler.py:555] PreSampling done
W20240210 01:33:10.143239 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240210 01:33:10.143420 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240210 01:33:10.143461 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240210 01:33:10.143497 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240210 01:33:10.143527 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240210 01:33:10.143554 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240210 01:33:10.143584 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240210 01:33:10.143623 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240210 01:33:10.143658 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240210 01:33:10.143700 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240210 01:33:10.143735 62885 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240210 01:33:10.143765 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240210 01:33:10.143791 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240210 01:33:10.143935 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240210 01:33:10.143980 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240210 01:33:10.144013 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240210 01:33:10.144075 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240210 01:33:10.144107 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240210 01:33:10.144141 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240210 01:33:10.144176 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240210 01:33:10.144207 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240210 01:33:10.144243 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240210 01:33:10.144276 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240210 01:33:10.144304 62885 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240210 01:33:10.144328 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240210 01:33:10.144358 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240210 01:33:10.144413 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240210 01:33:10.144454 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240210 01:33:10.144479 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240210 01:33:10.144508 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240210 01:33:10.144537 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240210 01:33:10.144577 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240210 01:33:10.144613 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240210 01:33:10.144642 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240210 01:33:10.144675 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240210 01:33:10.144706 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240210 01:33:10.144735 62885 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240210 01:33:10.144757 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240210 01:33:10.144785 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240210 01:33:10.144840 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240210 01:33:10.144876 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240210 01:33:10.144908 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240210 01:33:10.144937 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240210 01:33:10.144970 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240210 01:33:10.144997 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240210 01:33:10.145033 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240210 01:33:10.145061 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240210 01:33:10.145092 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240210 01:33:10.145117 62885 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240210 01:33:10.145149 62885 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240210 01:33:10.145172 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240210 01:33:10.145195 62885 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240210 01:33:10.600955 62885 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240210 01:38:34.846007 62885 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Rank2: cached key size 2151353
Rank3: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 8605423,  8605450,   105370,  ..., 52812337, 16678599,  4632112]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2025.741 seconds
[Rank1] pid = 63911
[Rank2] pid = 64008
INFO [62885 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [62885 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [64008 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [64075 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [63911 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
W20240210 01:47:01.774837 64076 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [8605415, 400]; dev=0; size=12.82 GB
INFO [64075 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [64008 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [63911 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240210 01:47:01.779719 64140 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [8605415, 400]; dev=3; size=12.82 GB
W20240210 01:47:01.779711 64009 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [8605415, 400]; dev=2; size=12.82 GB
W20240210 01:47:01.779709 63912 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [8605415, 400]; dev=1; size=12.82 GB
W20240210 01:47:01.865774 63912 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102036617000 7.629 MB
W20240210 01:47:01.865866 64009 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x102036dba000 7.629 MB
W20240210 01:47:01.865870 64140 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x10203755d000 7.629 MB
W20240210 01:47:01.866134 64140 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x102037d02000 7.629 MB
W20240210 01:47:01.866139 64076 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1020384a5000 7.629 MB
W20240210 01:47:01.866222 64140 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102038c48000 1.49 GB
W20240210 01:47:01.866242 64009 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10209822b000 7.629 MB
W20240210 01:47:01.866251 64076 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1020989ce000 7.629 MB
W20240210 01:47:01.866264 63912 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102099171000 7.629 MB
W20240210 01:47:01.866302 64140 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x102099914000 1.49 GB
W20240210 01:47:01.866324 64009 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240210 01:47:01.866335 64076 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1021584da000 1.49 GB
W20240210 01:47:01.866366 63912 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1021b7abd000 1.49 GB
W20240210 01:47:01.866389 64140 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240210 01:47:01.866390 64076 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1022170a0000 1.49 GB
W20240210 01:47:01.866408 64009 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x102276683000 1.49 GB
W20240210 01:47:01.866439 63912 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1022d5c66000 1.49 GB
W20240210 01:47:01.868013 63912 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240210 01:47:01.868019 64076 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240210 01:47:01.868023 64009 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240210 01:47:01.873381 64140 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240210 01:47:01.875067 64076 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240210 01:47:01.875073 63912 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240210 01:47:01.875085 64009 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
[Rank3] pid = 64075
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 8605415), (8605415, 17210830), (17210830, 25816245), (25816245, 34421660)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [62885 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [64075 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [63911 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [64008 DistTensor.py:59] The tensor name already exists in the kvstore
I20240210 01:47:36.816236 64009 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240210 01:47:36.816409 63912 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240210 01:47:36.816464 64140 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240210 01:47:36.816558 64076 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240210 01:47:38.240334 64009 recstore.cc:66] init folly done
E20240210 01:47:38.240353 63912 recstore.cc:66] init folly done
E20240210 01:47:38.242342 64076 recstore.cc:66] init folly done
E20240210 01:47:38.242352 64140 recstore.cc:66] init folly done
I20240210 01:47:49.243944 64140 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240210 01:47:52.128805 64009 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240210 01:47:52.952939 64076 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240210 01:47:52.998178 63912 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.136 ms                 | 22.136 ms                 |
| Forward                   | 615.635 ms                | 615.635 ms                |
| back: bucket keys         | 20.190 ms                 | 20.190 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 21.726 ms                 | 149.848 ms                |
| Forward                   | 4.680 ms                  | 615.635 ms                |
| back: bucket keys         | 377.893 us                | 20.190 ms                 |
| back: a2a                 | 8.657 ms                  | 40.890 s                  |
| back: cache               | 8.056 ms                  | 40.069 ms                 |
| back: aggr dram keys      | 25.412 ms                 | 487.502 ms                |
| back: set dram grad       | 2.702 ms                  | 14.090 ms                 |
| Backward                  | 115.074 ms                | 41.703 s                  |
| Optimize                  | 41.974 ms                 | 67.828 ms                 |
| BarrierTimeBeforeRank0    | 39.355 us                 | 90.258 us                 |
| BlockToStepN              | 16.844 us                 | 373.261 us                |
| OneStep                   | 185.611 ms                | 42.410 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.414 ms                  | 149.848 ms                |
| Forward                   | 4.607 ms                  | 615.635 ms                |
| back: bucket keys         | 387.192 us                | 1.066 ms                  |
| back: a2a                 | 8.698 ms                  | 11.374 ms                 |
| back: cache               | 19.270 ms                 | 26.549 ms                 |
| back: aggr dram keys      | 28.037 ms                 | 45.812 ms                 |
| back: set dram grad       | 3.590 ms                  | 20.013 ms                 |
| Backward                  | 118.829 ms                | 41.703 s                  |
| Optimize                  | 42.365 ms                 | 72.469 ms                 |
| BarrierTimeBeforeRank0    | 39.355 us                 | 91.708 us                 |
| BlockToStepN              | 17.157 us                 | 373.261 us                |
| OneStep                   | 184.695 ms                | 42.410 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.355 ms                  | 131.180 ms                |
| Forward                   | 4.629 ms                  | 6.691 ms                  |
| back: bucket keys         | 387.192 us                | 1.066 ms                  |
| back: a2a                 | 8.750 ms                  | 46.026 ms                 |
| back: cache               | 23.160 ms                 | 34.621 ms                 |
| back: aggr dram keys      | 28.106 ms                 | 66.269 ms                 |
| back: set dram grad       | 4.287 ms                  | 20.013 ms                 |
| Backward                  | 122.269 ms                | 168.021 ms                |
| Optimize                  | 40.759 ms                 | 71.287 ms                 |
| BarrierTimeBeforeRank0    | 36.365 us                 | 90.258 us                 |
| BlockToStepN              | 17.774 us                 | 11.972 ms                 |
| OneStep                   | 185.611 ms                | 306.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.404 ms                  | 131.180 ms                |
| Forward                   | 4.575 ms                  | 6.691 ms                  |
| back: bucket keys         | 383.615 us                | 1.066 ms                  |
| back: a2a                 | 8.869 ms                  | 33.121 ms                 |
| back: cache               | 22.805 ms                 | 34.621 ms                 |
| back: aggr dram keys      | 28.106 ms                 | 60.817 ms                 |
| back: set dram grad       | 4.256 ms                  | 14.090 ms                 |
| Backward                  | 121.612 ms                | 168.021 ms                |
| Optimize                  | 38.861 ms                 | 71.287 ms                 |
| BarrierTimeBeforeRank0    | 33.672 us                 | 90.258 us                 |
| BlockToStepN              | 18.682 us                 | 11.972 ms                 |
| OneStep                   | 180.304 ms                | 306.835 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 65.116, sample: 1.255, forward: 1.135, backward: 51.791, update: 0.427
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 62.231, sample: 1.384, forward: 1.069, backward: 51.743, update: 0.420
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 61.362, sample: 1.366, forward: 1.099, backward: 51.757, update: 0.424
train_sampler.Prefill()
-------Step 0-------
tensor([ 1291118,   713716, 40996925,  2052909,   434492,   713751,   713784,
          214517,  1291157,  1291195]) tensor([ 9246294, 34888094,  1152924, 45033864, 64077266,  2128874, 70361922,
        79252852, 65036789, 84376366])
-------Step 1-------
tensor([ 1291118,   713716, 40996925,  2052909,   434492,   713751,   713784,
          214517,  1291157,  1291195]) tensor([35201196, 66897890, 66171867, 13738127, 59196546, 13137373, 84172484,
        80935422, 23106189, 38464052])
-------Step 2-------
tensor([  816621,  1304032, 78727968,  1304084,   816663,   816697,   816745,
        48172000,   816782,   816826]) tensor([45093836,  9258699, 67435586, 15299590, 17369025, 14895587, 68199300,
        12909908, 67138172, 31472388])
-------Step 3-------
tensor([  816621,  1304032, 78727968,  1304084,   816663,   816697,   816745,
        48172000,   816782,   816826]) tensor([  400777, 55471959,  1752830, 35727501, 18489010, 76127787, 79248503,
        72616274, 23373526, 80945945])
-------Step 4-------
tensor([ 916480, 1317362,  916516,  916551, 1317404,  916584, 1317439,  916622,
        1317470,  916659]) tensor([ 3985832, 36696602, 22432772,  2010542, 66819399, 54386080, 82551609,
        58092326, 49453808, 12421272])
-------Step 5-------
tensor([ 916480, 1317362,  916516,  916551, 1317404,  916584, 1317439,  916622,
        1317470,  916659]) tensor([42234585, 55188608, 83138188, 12984167, 46429580,   559410, 34123211,
        77115639, 74429901,  1763675])
-------Step 6-------
tensor([78876386,  1017641,  1017689,  1017724,  8611397,  1017752,  1017797,
         1017832,  1017862,   219882]) tensor([33096469, 51428318, 32285996, 26032157, 80251988, 49433299, 52123136,
        18845561, 56942432, 12987158])
-------Step 7-------
tensor([78876386,  1017641,  1017689,  1017724,  8611397,  1017752,  1017797,
         1017832,  1017862,   219882]) tensor([47178900, 85845196, 53306883, 62682837, 76807733,  2548790, 22718874,
        54724760, 26540429, 17516664])
-------Step 8-------
tensor([ 1116610,  1344293,  1116654, 32385369,  2079044,  1116683,  1116722,
         1116759,   221541,  2079058]) tensor([30118990, 48358192, 56785525, 73416593, 68843651, 73748244, 51800051,
        66994572, 13897271,  7699229])
-------Step 9-------
tensor([ 1116610,  1344293,  1116654, 32385369,  2079044,  1116683,  1116722,
         1116759,   221541,  2079058]) tensor([65674584, 55754619, 31792683, 38220627, 14728282,  1872169, 24268761,
        17346968, 82622307, 54398362])
before start barrier
start train
[proc 0] 100 steps, total: 61.407, sample: 1.825, forward: 1.074, backward: 54.161, update: 4.177
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.491 ms                  | 131.180 ms                |
| Forward                   | 4.622 ms                  | 6.691 ms                  |
| back: bucket keys         | 374.317 us                | 1.066 ms                  |
| back: a2a                 | 9.840 ms                  | 36.474 ms                 |
| back: cache               | 22.805 ms                 | 34.621 ms                 |
| back: aggr dram keys      | 28.766 ms                 | 60.817 ms                 |
| back: set dram grad       | 4.256 ms                  | 14.090 ms                 |
| Backward                  | 123.228 ms                | 168.021 ms                |
| Optimize                  | 37.373 ms                 | 71.287 ms                 |
| BarrierTimeBeforeRank0    | 33.305 us                 | 90.258 us                 |
| BlockToStepN              | 19.002 us                 | 15.377 ms                 |
| OneStep                   | 177.845 ms                | 306.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.132 ms                  | 131.180 ms                |
| Forward                   | 4.644 ms                  | 6.763 ms                  |
| back: bucket keys         | 329.971 us                | 909.090 us                |
| back: a2a                 | 9.724 ms                  | 36.474 ms                 |
| back: cache               | 22.805 ms                 | 28.950 ms                 |
| back: aggr dram keys      | 28.106 ms                 | 54.831 ms                 |
| back: set dram grad       | 4.256 ms                  | 12.726 ms                 |
| Backward                  | 121.510 ms                | 168.021 ms                |
| Optimize                  | 36.329 ms                 | 71.287 ms                 |
| BarrierTimeBeforeRank0    | 32.799 us                 | 90.258 us                 |
| BlockToStepN              | 19.307 us                 | 15.377 ms                 |
| OneStep                   | 175.108 ms                | 306.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.700 ms                  | 130.435 ms                |
| Forward                   | 4.617 ms                  | 6.691 ms                  |
| back: bucket keys         | 332.355 us                | 909.090 us                |
| back: a2a                 | 9.402 ms                  | 46.026 ms                 |
| back: cache               | 22.805 ms                 | 34.621 ms                 |
| back: aggr dram keys      | 29.984 ms                 | 58.393 ms                 |
| back: set dram grad       | 4.256 ms                  | 20.013 ms                 |
| Backward                  | 121.921 ms                | 168.021 ms                |
| Optimize                  | 36.329 ms                 | 70.849 ms                 |
| BarrierTimeBeforeRank0    | 32.663 us                 | 83.548 us                 |
| BlockToStepN              | 19.175 us                 | 11.972 ms                 |
| OneStep                   | 175.108 ms                | 290.723 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.375 ms                  | 130.435 ms                |
| Forward                   | 4.571 ms                  | 6.691 ms                  |
| back: bucket keys         | 334.024 us                | 909.090 us                |
| back: a2a                 | 9.350 ms                  | 46.026 ms                 |
| back: cache               | 22.805 ms                 | 34.621 ms                 |
| back: aggr dram keys      | 30.177 ms                 | 55.717 ms                 |
| back: set dram grad       | 4.256 ms                  | 19.877 ms                 |
| Backward                  | 121.859 ms                | 171.240 ms                |
| Optimize                  | 36.314 ms                 | 70.849 ms                 |
| BarrierTimeBeforeRank0    | 32.136 us                 | 83.548 us                 |
| BlockToStepN              | 19.124 us                 | 15.504 ms                 |
| OneStep                   | 174.298 ms                | 302.950 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 18.141, sample: 1.251, forward: 0.451, backward: 12.700, update: 3.600
[proc 1] 200 steps, total: 18.141, sample: 1.358, forward: 0.475, backward: 9.793, update: 0.405
[proc 2] 200 steps, total: 18.141, sample: 1.209, forward: 0.464, backward: 9.921, update: 0.422
[proc 3] 200 steps, total: 18.141, sample: 1.221, forward: 0.489, backward: 9.897, update: 0.397
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.375 ms                  | 130.435 ms                |
| Forward                   | 4.549 ms                  | 6.691 ms                  |
| back: bucket keys         | 336.647 us                | 929.356 us                |
| back: a2a                 | 9.354 ms                  | 54.623 ms                 |
| back: cache               | 22.805 ms                 | 34.621 ms                 |
| back: aggr dram keys      | 30.320 ms                 | 55.717 ms                 |
| back: set dram grad       | 4.243 ms                  | 19.877 ms                 |
| Backward                  | 122.108 ms                | 171.240 ms                |
| Optimize                  | 36.339 ms                 | 70.849 ms                 |
| BarrierTimeBeforeRank0    | 32.139 us                 | 83.548 us                 |
| BlockToStepN              | 19.175 us                 | 15.504 ms                 |
| OneStep                   | 173.038 ms                | 303.750 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.924 ms                  | 120.556 ms                |
| Forward                   | 4.536 ms                  | 6.515 ms                  |
| back: bucket keys         | 337.839 us                | 909.328 us                |
| back: a2a                 | 9.351 ms                  | 53.225 ms                 |
| back: cache               | 22.805 ms                 | 31.534 ms                 |
| back: aggr dram keys      | 30.320 ms                 | 54.831 ms                 |
| back: set dram grad       | 4.241 ms                  | 16.990 ms                 |
| Backward                  | 121.921 ms                | 170.017 ms                |
| Optimize                  | 36.338 ms                 | 67.828 ms                 |
| BarrierTimeBeforeRank0    | 32.143 us                 | 75.715 us                 |
| BlockToStepN              | 18.806 us                 | 15.377 ms                 |
| OneStep                   | 171.573 ms                | 302.950 ms                |
+---------------------------+---------------------------+---------------------------+
Successfully xmh. training takes 90.05433988571167 seconds
before call kg_cache_controller.StopThreads()
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads
INFO [62885 controller_process.py:421] call rank0 to StopThreads

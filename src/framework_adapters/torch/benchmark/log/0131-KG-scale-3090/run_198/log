WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240206 10:21:00.747567 52299 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_0', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [52299 sampler.py:454] Start PreSampling
WARNING [52299 sampler.py:532] Before construct renumbering_dict
WARNING [52299 sampler.py:555] PreSampling done
W20240206 10:39:41.078708 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240206 10:39:41.078881 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240206 10:39:41.078927 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240206 10:39:41.078959 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240206 10:39:41.078990 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240206 10:39:41.079030 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240206 10:39:41.079068 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240206 10:39:41.079108 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240206 10:39:41.079144 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240206 10:39:41.079174 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240206 10:39:41.079214 52299 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240206 10:39:41.079245 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240206 10:39:41.079277 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240206 10:39:41.079408 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240206 10:39:41.079444 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240206 10:39:41.079476 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240206 10:39:41.079528 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240206 10:39:41.079560 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240206 10:39:41.079591 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240206 10:39:41.079624 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240206 10:39:41.079669 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240206 10:39:41.079708 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240206 10:39:41.079747 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240206 10:39:41.079777 52299 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240206 10:39:41.079802 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240206 10:39:41.079828 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240206 10:39:41.079895 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240206 10:39:41.079928 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240206 10:39:41.079960 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240206 10:39:41.079989 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240206 10:39:41.080017 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240206 10:39:41.080047 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240206 10:39:41.080092 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240206 10:39:41.080132 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240206 10:39:41.080165 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240206 10:39:41.080199 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240206 10:39:41.080235 52299 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240206 10:39:41.080260 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240206 10:39:41.080289 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240206 10:39:41.080348 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240206 10:39:41.080385 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240206 10:39:41.080417 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240206 10:39:41.080452 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240206 10:39:41.080487 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240206 10:39:41.080528 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240206 10:39:41.080562 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240206 10:39:41.080600 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240206 10:39:41.080631 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240206 10:39:41.080662 52299 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240206 10:39:41.080699 52299 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240206 10:39:41.080724 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240206 10:39:41.080752 52299 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240206 10:39:41.492755 52299 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240206 10:48:15.906687 52299 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302711,  4302728,   169913,  ..., 54104873, 13692989,  2454169]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2140.857 seconds
[Rank1] pid = 53379
[Rank2] pid = 53476
INFO [52299 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [53476 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [53379 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [53543 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [53476 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [53543 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [52299 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [53379 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240206 10:56:47.486400 53548 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240206 10:56:47.487254 53477 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240206 10:56:47.487462 53380 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240206 10:56:47.487470 53544 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240206 10:56:47.541498 53380 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102036619000 7.629 MB
W20240206 10:56:47.541561 53548 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10203755f000 7.629 MB
W20240206 10:56:47.541560 53477 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x102036dbc000 7.629 MB
W20240206 10:56:47.541577 53544 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102037d02000 7.629 MB
W20240206 10:56:47.541687 53548 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1020384a5000 7.629 MB
W20240206 10:56:47.541705 53380 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102038c48000 7.629 MB
W20240206 10:56:47.541731 53544 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1020393eb000 7.629 MB
W20240206 10:56:47.541735 53477 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x102039b8e000 7.629 MB
W20240206 10:56:47.541755 53548 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10203a331000 1.49 GB
W20240206 10:56:47.541780 53380 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x102099914000 1.49 GB
W20240206 10:56:47.541790 53548 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240206 10:56:47.541821 53544 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1021584da000 1.49 GB
W20240206 10:56:47.541828 53477 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1021b7abd000 1.49 GB
W20240206 10:56:47.541837 53380 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1022170a0000 1.49 GB
W20240206 10:56:47.541841 53548 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240206 10:56:47.541885 53477 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x102276683000 1.49 GB
W20240206 10:56:47.541893 53544 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1022d5c66000 1.49 GB
W20240206 10:56:47.541916 53380 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240206 10:56:47.541936 53477 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240206 10:56:47.541963 53544 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240206 10:56:47.548246 53548 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240206 10:56:47.548261 53380 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240206 10:56:47.548270 53477 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240206 10:56:47.548324 53544 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [53543 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 53543
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [52299 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [53379 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [53476 DistTensor.py:59] The tensor name already exists in the kvstore
I20240206 10:57:19.746981 53477 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240206 10:57:19.747138 53380 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240206 10:57:19.747185 53548 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240206 10:57:19.747313 53544 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240206 10:57:19.749032 53548 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240206 10:57:19.749325 53548 grad_base.h:184] Init GradProcessingBase done
I20240206 10:57:32.832664 53548 grad_async_v2.h:42] Use main thread to update emb.
W20240206 10:57:32.832845 53548 kg_controller.h:78] after init GradAsyncProcessingV2
I20240206 10:57:32.832855 53548 kg_controller.h:84] Construct KGCacheController done
E20240206 10:57:33.269076 53477 recstore.cc:66] init folly done
E20240206 10:57:33.269965 53380 recstore.cc:66] init folly done
E20240206 10:57:33.269989 53548 recstore.cc:66] init folly done
E20240206 10:57:33.269997 53544 recstore.cc:66] init folly done
I20240206 10:57:33.270866 53548 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240206 10:57:45.098412 53906 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240206 10:57:45.098946 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240206 10:57:46.541321 53906 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240206 10:57:46.541486 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 128.388 us                | 232.429 us                |
+---------------------------+---------------------------+---------------------------+
W20240206 10:57:51.207706 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240206 10:57:51.226712 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240206 10:57:51.428375 53544 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
W20240206 10:57:53.175081 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240206 10:57:53.193418 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240206 10:57:53.226837 53477 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 115.853 us                | 243.307 us                |
+---------------------------+---------------------------+---------------------------+
I20240206 10:57:53.330359 53380 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240206 10:57:54.193056 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 10:57:54.876042 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
I20240206 10:57:54.948534 53548 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240206 10:57:55.193044 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
E20240206 10:57:56.291617 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240206 10:57:56.343511 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240206 10:57:56.353225 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240206 10:57:57.291034 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240206 10:57:57.367174 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=11, pq.top=11
E20240206 10:57:57.574821 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=14, sample_step_cpp_seen_[rank]=13
W20240206 10:57:57.638073 53906 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 159.389 us                | 1.340 ms                  |
| ProcessBack:Shuffle       | 2.691 ms                  | 170.860 ms                |
| ProcessBack:UpdateCache   | 3.141 ms                  | 259.175 ms                |
| ProcessBack:UpsertPq      | 10.746 ms                 | 56.970 ms                 |
| ProcessOneStep            | 44.730 ms                 | 548.928 ms                |
| BlockToStepN              | 552.877 us                | 11.289 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 10:57:58.291013 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=3814
W20240206 10:57:58.878858 53906 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end5
W20240206 10:57:58.943873 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=25, pq.top=25
E20240206 10:57:59.291023 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=12
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.980 ms                  | 108.542 ms                |
| Forward                   | 5.183 ms                  | 550.873 ms                |
| Backward                  | 5.170 ms                  | 232.853 ms                |
| Optimize                  | 2.314 ms                  | 39.537 ms                 |
| BarrierTimeBeforeRank0    | 7.591 ms                  | 120.063 ms                |
| AfterBackward             | 54.852 ms                 | 549.182 ms                |
| BlockToStepN              | 514.440 us                | 11.342 ms                 |
| OneStep                   | 92.986 ms                 | 1.401 s                   |
+---------------------------+---------------------------+---------------------------+
W20240206 10:57:59.914119 53906 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end8
W20240206 10:58:00.003242 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=29, pq.top=29
E20240206 10:58:00.291011 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=2791
W20240206 10:58:00.957183 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
W20240206 10:58:01.171511 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=40, pq.top=40
E20240206 10:58:01.291007 53713 parallel_pq_v2.h:79] insert failed, size(hashtable)=6815
W20240206 10:58:02.004774 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end3
E20240206 10:58:02.299268 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=1632
W20240206 10:58:02.821501 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=55, pq.top=55
W20240206 10:58:03.008072 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 302.657 us                | 5.700 ms                  |
| ProcessBack:Shuffle       | 2.724 ms                  | 134.781 ms                |
| ProcessBack:UpdateCache   | 3.131 ms                  | 258.416 ms                |
| ProcessBack:UpsertPq      | 20.008 ms                 | 70.055 ms                 |
| ProcessOneStep            | 45.983 ms                 | 548.928 ms                |
| BlockToStepN              | 552.877 us                | 5.036 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:03.299013 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=889
E20240206 10:58:03.715140 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=68, sample_step_cpp_seen_[rank]=67
W20240206 10:58:03.840710 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=69, pq.top=69
W20240206 10:58:04.122536 53906 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
E20240206 10:58:04.299018 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=86
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.013 ms                  | 98.033 ms                 |
| Forward                   | 5.183 ms                  | 7.590 ms                  |
| Backward                  | 5.170 ms                  | 11.899 ms                 |
| Optimize                  | 2.454 ms                  | 9.965 ms                  |
| BarrierTimeBeforeRank0    | 1.009 ms                  | 120.063 ms                |
| AfterBackward             | 49.396 ms                 | 583.362 ms                |
| BlockToStepN              | 764.197 us                | 5.782 ms                  |
| OneStep                   | 79.972 ms                 | 828.614 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 10:58:05.006253 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=73, pq.top=73
W20240206 10:58:05.191601 53906 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end5
E20240206 10:58:05.299019 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=1901
E20240206 10:58:06.299028 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=2762
W20240206 10:58:06.435238 53906 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
W20240206 10:58:07.149291 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=96, pq.top=96
E20240206 10:58:07.301460 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=373
W20240206 10:58:07.437599 53906 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 14.259, sample: 1.181, forward: 0.994, backward: 0.676, update: 0.288
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 14.362, sample: 1.196, forward: 1.047, backward: 0.702, update: 0.268
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 16.161, sample: 2.458, forward: 1.023, backward: 0.803, update: 0.234
train_sampler.Prefill()
-------Step 0-------
tensor([   62360,   511205, 42064773,   692858,   507061,   511234,   511256,
          296289,    62413,    62459]) tensor([ 5030859, 26533834, 24022109, 45808854, 49789379, 28137813, 82669989,
        65947624, 48619183, 84779659])
-------Step 1-------
tensor([   62360,   511205, 42064773,   692858,   507061,   511234,   511256,
          296289,    62413,    62459]) tensor([24092903, 80434974, 64012469,  9350437, 48888005,  9448953, 85645161,
        66410863, 17460527, 32277652])
-------Step 2-------
tensor([  586127,    76436, 64439666,    76487,   586150,   586173,   586201,
        39437016,   586229,   586253]) tensor([41248902,  5057423, 69708432, 11005548, 15581894, 12345949, 70621135,
        10387140, 50889438, 37693586])
-------Step 3-------
tensor([  586127,    76436, 64439666,    76487,   586150,   586173,   586201,
        39437016,   586229,   586253]) tensor([18666577, 52553563, 63363829, 44234896, 13706050, 77743089, 64080683,
        55375460, 22376893, 60860093])
-------Step 4-------
tensor([659563,  91172, 659596, 659618,  91209, 659652,  91257, 659681,  91298,
        659706]) tensor([54594167, 45667349, 17263971, 13330161, 50509320, 51746182, 64035025,
        40413145, 66245865,  9898067])
-------Step 5-------
tensor([659563,  91172, 659596, 659618,  91209, 659652,  91257, 659681,  91298,
        659706]) tensor([32703368, 52640695, 85190462,  8487226, 42690266, 33943345, 41404075,
        78145292, 84580149,   589065])
-------Step 6-------
tensor([62482034,   732895,   732926,   732949,  4309917,   732969,   732999,
          733023,   733044,   303122]) tensor([29685251, 39697665, 24059791, 19980881, 66748374, 66212630, 48810051,
        13966007, 58461482,  8551658])
-------Step 7-------
tensor([62482034,   732895,   732926,   732949,  4309917,   732969,   732999,
          733023,   733044,   303122]) tensor([33672580, 75174207, 43779003, 77807641, 58298050,  1508563, 17485575,
        45446784, 20147356, 15212295])
-------Step 8-------
tensor([  802914,   121119,   802937, 38843378,   731641,   802959,   802975,
          803005,   305217,   731664]) tensor([24869161, 65344269, 43077919, 72055048, 60751197, 52853259, 70723546,
        64902305,  9565304,  3240392])
-------Step 9-------
tensor([  802914,   121119,   802937, 38843378,   731641,   802959,   802975,
          803005,   305217,   731664]) tensor([79545656, 74484764, 24196354, 47471532, 11067631,  1001444, 21308397,
        13537026, 64171932, 40393107])
before start barrier
start train
[proc 0] 100 steps, total: 12.640, sample: 1.374, forward: 1.107, backward: 0.763, update: 0.333
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 295.508 us                | 5.137 ms                  |
| ProcessBack:Shuffle       | 2.712 ms                  | 12.939 ms                 |
| ProcessBack:UpdateCache   | 3.082 ms                  | 22.544 ms                 |
| ProcessBack:UpsertPq      | 21.951 ms                 | 80.412 ms                 |
| ProcessOneStep            | 51.976 ms                 | 583.331 ms                |
| BlockToStepN              | 497.094 us                | 5.535 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:08.306704 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 10:58:08.446331 53906 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240206 10:58:09.061131 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=113, pq.top=113
E20240206 10:58:09.306047 53922 parallel_pq_v2.h:79] insert failed, size(hashtable)=16620
W20240206 10:58:09.547441 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
E20240206 10:58:09.646890 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=119, sample_step_cpp_seen_[rank]=118
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.123 ms                  | 100.826 ms                |
| Forward                   | 5.299 ms                  | 26.897 ms                 |
| Backward                  | 5.147 ms                  | 15.666 ms                 |
| Optimize                  | 2.474 ms                  | 14.206 ms                 |
| BarrierTimeBeforeRank0    | 2.577 ms                  | 120.063 ms                |
| AfterBackward             | 51.705 ms                 | 583.362 ms                |
| BlockToStepN              | 574.237 us                | 5.782 ms                  |
| OneStep                   | 84.163 ms                 | 828.614 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 10:58:10.117607 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=121, pq.top=121
E20240206 10:58:10.306006 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=15
W20240206 10:58:10.661845 53906 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
W20240206 10:58:11.120324 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=135, pq.top=135
E20240206 10:58:11.306015 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=31925
W20240206 10:58:11.766423 53906 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
W20240206 10:58:12.268862 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=146, pq.top=146
E20240206 10:58:12.306006 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=436
W20240206 10:58:12.777016 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 421.468 us                | 5.797 ms                  |
| ProcessBack:Shuffle       | 2.688 ms                  | 8.927 ms                  |
| ProcessBack:UpdateCache   | 3.066 ms                  | 22.449 ms                 |
| ProcessBack:UpsertPq      | 19.131 ms                 | 90.367 ms                 |
| ProcessOneStep            | 51.465 ms                 | 548.928 ms                |
| BlockToStepN              | 674.483 us                | 5.036 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:13.306011 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=26585
W20240206 10:58:13.338860 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=158, pq.top=158
W20240206 10:58:14.034689 53906 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
E20240206 10:58:14.306010 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=20793
W20240206 10:58:14.597652 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=170, pq.top=170
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.195 ms                  | 100.826 ms                |
| Forward                   | 5.409 ms                  | 15.717 ms                 |
| Backward                  | 5.064 ms                  | 11.899 ms                 |
| Optimize                  | 2.533 ms                  | 13.774 ms                 |
| BarrierTimeBeforeRank0    | 1.684 ms                  | 90.707 ms                 |
| AfterBackward             | 51.495 ms                 | 549.182 ms                |
| BlockToStepN              | 795.605 us                | 5.605 ms                  |
| OneStep                   | 82.809 ms                 | 604.896 ms                |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:14.993194 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=176, sample_step_cpp_seen_[rank]=175
W20240206 10:58:15.187037 53906 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
E20240206 10:58:15.306006 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=2027
W20240206 10:58:15.621901 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=178, pq.top=178
W20240206 10:58:16.222041 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
E20240206 10:58:16.306012 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=22932
W20240206 10:58:16.702647 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=193, pq.top=193
E20240206 10:58:17.313071 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 10:58:17.373867 53906 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
[proc 0] 200 steps, total: 9.790, sample: 1.384, forward: 0.584, backward: 0.485, update: 0.285
[proc 2] 200 steps, total: 9.791, sample: 1.306, forward: 0.581, backward: 0.522, update: 0.260
[proc 3] 200 steps, total: 9.791, sample: 1.020, forward: 0.518, backward: 0.573, update: 0.216
[proc 1] 200 steps, total: 9.791, sample: 1.168, forward: 0.517, backward: 0.483, update: 0.220
W20240206 10:58:18.212910 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=209, pq.top=209
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 284.886 us                | 9.983 ms                  |
| ProcessBack:Shuffle       | 2.654 ms                  | 7.912 ms                  |
| ProcessBack:UpdateCache   | 3.061 ms                  | 4.264 ms                  |
| ProcessBack:UpsertPq      | 17.731 ms                 | 93.801 ms                 |
| ProcessOneStep            | 49.368 ms                 | 583.331 ms                |
| BlockToStepN              | 864.748 us                | 13.082 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:18.313009 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=2600
W20240206 10:58:18.453018 53906 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end3
W20240206 10:58:19.233980 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=224, pq.top=223
E20240206 10:58:19.313010 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=13862
W20240206 10:58:19.485967 53906 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.707 ms                  | 100.826 ms                |
| Forward                   | 5.400 ms                  | 26.897 ms                 |
| Backward                  | 5.039 ms                  | 11.899 ms                 |
| Optimize                  | 2.521 ms                  | 13.774 ms                 |
| BarrierTimeBeforeRank0    | 1.426 ms                  | 90.707 ms                 |
| AfterBackward             | 47.645 ms                 | 583.362 ms                |
| BlockToStepN              | 962.461 us                | 20.635 ms                 |
| OneStep                   | 80.792 ms                 | 614.269 ms                |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:20.313059 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=10
W20240206 10:58:20.537405 53906 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end3
W20240206 10:58:20.686094 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=235, pq.top=234
E20240206 10:58:21.313010 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=68015
E20240206 10:58:21.495904 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=245, sample_step_cpp_seen_[rank]=244
W20240206 10:58:21.540791 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
W20240206 10:58:21.809469 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=247, pq.top=247
E20240206 10:58:22.313047 53926 parallel_pq_v2.h:79] insert failed, size(hashtable)=11742
W20240206 10:58:22.549170 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 350.205 us                | 8.773 ms                  |
| ProcessBack:Shuffle       | 2.644 ms                  | 7.194 ms                  |
| ProcessBack:UpdateCache   | 3.026 ms                  | 4.244 ms                  |
| ProcessBack:UpsertPq      | 16.904 ms                 | 93.329 ms                 |
| ProcessOneStep            | 49.368 ms                 | 548.928 ms                |
| BlockToStepN              | 997.473 us                | 31.631 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:23.322870 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=35785
W20240206 10:58:23.561669 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
W20240206 10:58:23.632225 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=267, pq.top=267
E20240206 10:58:24.322011 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=95
W20240206 10:58:24.655211 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.649 ms                  | 98.033 ms                 |
| Forward                   | 5.387 ms                  | 15.717 ms                 |
| Backward                  | 5.137 ms                  | 11.157 ms                 |
| Optimize                  | 2.469 ms                  | 9.965 ms                  |
| BarrierTimeBeforeRank0    | 657.136 us                | 84.534 ms                 |
| AfterBackward             | 48.873 ms                 | 549.182 ms                |
| BlockToStepN              | 1.087 ms                  | 33.374 ms                 |
| OneStep                   | 81.235 ms                 | 604.896 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 10:58:24.777097 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=281, pq.top=281
E20240206 10:58:25.322010 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=22152
W20240206 10:58:25.772338 53906 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
W20240206 10:58:25.982753 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=291, pq.top=291
E20240206 10:58:26.328620 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
[proc 0] 300 steps, total: 9.348, sample: 1.014, forward: 0.556, backward: 0.691, update: 0.271
[proc 3] 300 steps, total: 9.348, sample: 1.144, forward: 0.505, backward: 0.705, update: 0.197
[proc 2] 300 steps, total: 9.348, sample: 0.981, forward: 0.515, backward: 0.610, update: 0.226
[proc 1] 300 steps, total: 9.348, sample: 0.967, forward: 0.551, backward: 0.488, update: 0.237
W20240206 10:58:26.785825 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
W20240206 10:58:26.982499 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=302, pq.top=302
E20240206 10:58:27.328011 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=3503
E20240206 10:58:27.800793 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=312, sample_step_cpp_seen_[rank]=311
W20240206 10:58:27.960028 53906 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end3
W20240206 10:58:28.227650 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=313, pq.top=313
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 326.463 us                | 12.486 ms                 |
| ProcessBack:Shuffle       | 2.630 ms                  | 7.468 ms                  |
| ProcessBack:UpdateCache   | 2.981 ms                  | 4.264 ms                  |
| ProcessBack:UpsertPq      | 16.173 ms                 | 93.109 ms                 |
| ProcessOneStep            | 46.789 ms                 | 583.331 ms                |
| BlockToStepN              | 1.109 ms                  | 33.658 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:28.328011 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=449
W20240206 10:58:29.103029 53906 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end5
W20240206 10:58:29.319876 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=327, pq.top=327
E20240206 10:58:29.328140 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=66
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.688 ms                  | 98.033 ms                 |
| Forward                   | 5.387 ms                  | 15.717 ms                 |
| Backward                  | 5.251 ms                  | 11.157 ms                 |
| Optimize                  | 2.454 ms                  | 9.965 ms                  |
| BarrierTimeBeforeRank0    | 550.941 us                | 84.534 ms                 |
| AfterBackward             | 46.074 ms                 | 583.362 ms                |
| BlockToStepN              | 1.248 ms                  | 53.208 ms                 |
| OneStep                   | 82.023 ms                 | 614.269 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 10:58:30.185093 53906 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end5
E20240206 10:58:30.328183 53933 parallel_pq_v2.h:79] insert failed, size(hashtable)=6981
W20240206 10:58:30.730787 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=335, pq.top=335
W20240206 10:58:31.191336 53906 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
E20240206 10:58:31.328032 53920 parallel_pq_v2.h:79] insert failed, size(hashtable)=19271
W20240206 10:58:31.803114 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=345, pq.top=345
E20240206 10:58:32.328008 53920 parallel_pq_v2.h:79] insert failed, size(hashtable)=14730
W20240206 10:58:32.460294 53906 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240206 10:58:32.800009 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=357, sample_step_cpp_seen_[rank]=356
W20240206 10:58:33.025416 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=359, pq.top=359
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 366.592 us                | 17.474 ms                 |
| ProcessBack:Shuffle       | 2.630 ms                  | 7.912 ms                  |
| ProcessBack:UpdateCache   | 2.956 ms                  | 4.401 ms                  |
| ProcessBack:UpsertPq      | 16.173 ms                 | 93.329 ms                 |
| ProcessOneStep            | 46.693 ms                 | 583.331 ms                |
| BlockToStepN              | 1.260 ms                  | 38.246 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:33.328006 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=6008
W20240206 10:58:33.536609 53906 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end5
W20240206 10:58:34.233026 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=373, pq.top=373
E20240206 10:58:34.328011 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=7639
W20240206 10:58:34.670687 53906 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.549 ms                  | 96.323 ms                 |
| Forward                   | 5.395 ms                  | 13.519 ms                 |
| Backward                  | 5.412 ms                  | 11.119 ms                 |
| Optimize                  | 2.441 ms                  | 9.965 ms                  |
| BarrierTimeBeforeRank0    | 123.259 us                | 72.580 ms                 |
| AfterBackward             | 46.737 ms                 | 583.362 ms                |
| BlockToStepN              | 1.320 ms                  | 38.354 ms                 |
| OneStep                   | 81.235 ms                 | 614.269 ms                |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:35.328007 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=4555
W20240206 10:58:35.452904 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=385, pq.top=385
W20240206 10:58:35.718513 53906 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240206 10:58:36.328017 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=31
W20240206 10:58:36.548060 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=397, pq.top=397
[proc 0] 400 steps, total: 10.008, sample: 1.184, forward: 0.548, backward: 0.775, update: 0.285
[proc 1] 400 steps, total: 10.008, sample: 0.953, forward: 0.489, backward: 0.520, update: 0.219
[proc 2] 400 steps, total: 10.008, sample: 0.945, forward: 0.497, backward: 0.645, update: 0.210
[proc 3] 400 steps, total: 10.008, sample: 1.078, forward: 0.491, backward: 0.711, update: 0.206
W20240206 10:58:36.946725 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240206 10:58:37.328022 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=28
E20240206 10:58:37.800022 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=405, sample_step_cpp_seen_[rank]=404
W20240206 10:58:37.961788 53906 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
W20240206 10:58:38.172482 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=408, pq.top=408
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 320.070 us                | 12.700 ms                 |
| ProcessBack:Shuffle       | 2.644 ms                  | 7.912 ms                  |
| ProcessBack:UpdateCache   | 2.951 ms                  | 4.312 ms                  |
| ProcessBack:UpsertPq      | 17.181 ms                 | 93.329 ms                 |
| ProcessOneStep            | 46.693 ms                 | 583.331 ms                |
| BlockToStepN              | 1.334 ms                  | 38.246 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:38.328011 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=41153
W20240206 10:58:39.049466 53906 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
E20240206 10:58:39.334777 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=4969
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.476 ms                  | 98.033 ms                 |
| Forward                   | 5.393 ms                  | 13.519 ms                 |
| Backward                  | 5.809 ms                  | 11.119 ms                 |
| Optimize                  | 2.435 ms                  | 9.965 ms                  |
| BarrierTimeBeforeRank0    | 45.574 us                 | 72.580 ms                 |
| AfterBackward             | 46.100 ms                 | 583.362 ms                |
| BlockToStepN              | 1.424 ms                  | 42.283 ms                 |
| OneStep                   | 81.235 ms                 | 614.269 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 10:58:39.885630 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=423, pq.top=423
W20240206 10:58:40.063699 53906 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240206 10:58:40.334012 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=18397
W20240206 10:58:41.090471 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=439, pq.top=438
W20240206 10:58:41.222317 53906 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240206 10:58:41.334014 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=28919
W20240206 10:58:42.249778 53906 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240206 10:58:42.334033 53919 parallel_pq_v2.h:79] insert failed, size(hashtable)=29301
W20240206 10:58:43.179706 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=459, pq.top=459
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 407.561 us                | 9.821 ms                  |
| ProcessBack:Shuffle       | 2.650 ms                  | 8.038 ms                  |
| ProcessBack:UpdateCache   | 2.969 ms                  | 4.747 ms                  |
| ProcessBack:UpsertPq      | 16.582 ms                 | 93.109 ms                 |
| ProcessOneStep            | 45.746 ms                 | 551.190 ms                |
| BlockToStepN              | 1.376 ms                  | 38.246 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:43.334008 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=169
W20240206 10:58:43.372260 53906 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end3
E20240206 10:58:44.338214 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
E20240206 10:58:44.341850 53713 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=470, sample_step_cpp_seen_[rank]=469
W20240206 10:58:44.514081 53906 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
W20240206 10:58:44.693713 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=471, pq.top=471
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.533 ms                  | 100.826 ms                |
| Forward                   | 5.403 ms                  | 9.349 ms                  |
| Backward                  | 6.247 ms                  | 11.023 ms                 |
| Optimize                  | 2.436 ms                  | 8.790 ms                  |
| BarrierTimeBeforeRank0    | 43.849 us                 | 72.580 ms                 |
| AfterBackward             | 46.012 ms                 | 551.227 ms                |
| BlockToStepN              | 1.478 ms                  | 42.283 ms                 |
| OneStep                   | 80.988 ms                 | 604.896 ms                |
+---------------------------+---------------------------+---------------------------+
E20240206 10:58:45.338011 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=74121
W20240206 10:58:45.620298 53906 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
W20240206 10:58:45.750974 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=483, pq.top=483
E20240206 10:58:46.338007 53548 parallel_pq_v2.h:79] insert failed, size(hashtable)=1160
W20240206 10:58:46.714504 53906 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240206 10:58:46.796765 53548 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=495, pq.top=495
[proc 1] 500 steps, total: 10.519, sample: 0.971, forward: 0.514, backward: 0.574, update: 0.237
[proc 3] 500 steps, total: 10.519, sample: 1.811, forward: 0.538, backward: 0.548, update: 0.235
[proc 2] 500 steps, total: 10.519, sample: 1.052, forward: 0.546, backward: 0.632, update: 0.223
[proc 0] 500 steps, total: 10.519, sample: 1.306, forward: 0.538, backward: 0.712, update: 0.259
Successfully xmh. training takes 52.30680060386658 seconds
before call kg_cache_controller.StopThreads()
W20240206 10:58:47.255371 53548 grad_async_v2.h:84] call StopThreads. PID = 52299
W20240206 10:58:47.255403 53548 grad_base.h:212] before processOneStepNegThread_.join();
W20240206 10:58:47.255728 53548 grad_base.h:214] after processOneStepNegThread_.join();
W20240206 10:58:47.255738 53548 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
E20240206 10:58:47.338009 53906 parallel_pq_v2.h:79] insert failed, size(hashtable)=5750
W20240206 10:58:47.433705 53548 grad_async_v2.h:105] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 498.209 us                | 18.459 ms                 |
| ProcessBack:Shuffle       | 2.663 ms                  | 7.912 ms                  |
| ProcessBack:UpdateCache   | 2.995 ms                  | 4.640 ms                  |
| ProcessBack:UpsertPq      | 16.310 ms                 | 92.809 ms                 |
| ProcessOneStep            | 45.983 ms                 | 551.190 ms                |
| BlockToStepN              | 1.455 ms                  | 53.071 ms                 |
+---------------------------+---------------------------+---------------------------+

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240209 22:10:14.990074 44576 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_196', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [44576 sampler.py:454] Start PreSampling
WARNING [44576 sampler.py:532] Before construct renumbering_dict
WARNING [44576 sampler.py:555] PreSampling done
W20240209 22:10:20.115391 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240209 22:10:20.115572 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240209 22:10:20.115618 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240209 22:10:20.115658 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240209 22:10:20.115691 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240209 22:10:20.115728 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240209 22:10:20.115767 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240209 22:10:20.115805 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240209 22:10:20.115859 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240209 22:10:20.115898 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240209 22:10:20.115936 44576 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240209 22:10:20.115967 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240209 22:10:20.115998 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240209 22:10:20.116122 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240209 22:10:20.116163 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240209 22:10:20.116194 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240209 22:10:20.116261 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240209 22:10:20.116302 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240209 22:10:20.116341 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240209 22:10:20.116386 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240209 22:10:20.116429 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240209 22:10:20.116470 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240209 22:10:20.116520 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240209 22:10:20.116555 44576 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240209 22:10:20.116583 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240209 22:10:20.116612 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240209 22:10:20.116674 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240209 22:10:20.116710 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240209 22:10:20.116755 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240209 22:10:20.116789 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240209 22:10:20.116827 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240209 22:10:20.116868 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240209 22:10:20.116905 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240209 22:10:20.116940 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240209 22:10:20.116987 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240209 22:10:20.117038 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240209 22:10:20.117070 44576 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240209 22:10:20.117100 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240209 22:10:20.117127 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240209 22:10:20.117187 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240209 22:10:20.117229 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240209 22:10:20.117264 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240209 22:10:20.117297 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240209 22:10:20.117347 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240209 22:10:20.117384 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240209 22:10:20.117435 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240209 22:10:20.117470 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240209 22:10:20.117502 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240209 22:10:20.117542 44576 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240209 22:10:20.117581 44576 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240209 22:10:20.117610 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240209 22:10:20.117646 44576 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240209 22:10:20.364425 44576 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240209 22:10:20.456907 44576 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=9703, num_edges=161860,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11374, num_edges=168961,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=10715, num_edges=190828,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=11184, num_edges=240046,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9703 N 161860 E
MertisPartition: part 1 has 11374 N 168961 E
MertisPartition: part 2 has 10715 N 190828 E
MertisPartition: part 3 has 11184 N 240046 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([   6,   10,   11,  ..., 5824, 6189, 2559]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 990, 1137, 1176,  ..., 8363, 4557, 8923]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.567 seconds
[Rank1] pid = 44782
[Rank2] pid = 44808
INFO [44576 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [44782 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [44910 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [44808 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [44782 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [44808 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [44910 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [44576 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [44808 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [44782 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [44910 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [44576 DistTensor.py:59] The tensor name already exists in the kvstore
I20240209 22:10:23.171960 44911 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240209 22:10:23.172190 44847 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240209 22:10:23.172442 44783 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240209 22:10:23.172693 44974 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240209 22:10:24.625501 44783 recstore.cc:66] init folly done
E20240209 22:10:24.625586 44911 recstore.cc:66] init folly done
E20240209 22:10:24.625674 44847 recstore.cc:66] init folly done
E20240209 22:10:24.625679 44974 recstore.cc:66] init folly done
I20240209 22:10:24.712401 44783 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240209 22:10:24.715986 44847 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240209 22:10:24.717782 44974 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240209 22:10:24.718844 44911 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 734.916 us                | 734.916 us                |
| bucket keys               | 145.757 ms                | 145.757 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.126 ms                  | 2.636 ms                  |
| bucket keys               | 2.075 ms                  | 145.757 ms                |
| forward: a2a keys         | 1.439 ms                  | 41.649 s                  |
| forward: search cache     | 261.307 us                | 30.950 ms                 |
| forward: a2a values       | 1.697 ms                  | 6.292 ms                  |
| forward: join             | 3.058 ms                  | 4.323 ms                  |
| Forward                   | 22.740 ms                 | 42.293 s                  |
| back: aggr dram keys      | 36.877 ms                 | 517.002 ms                |
| back: set dram grad       | 3.463 ms                  | 7.455 ms                  |
| back: a2a grad            | 3.767 ms                  | 4.258 ms                  |
| back: grad sum & grad cache  | 2.502 ms                  | 3.133 ms                  |
| Backward                  | 96.875 ms                 | 738.602 ms                |
| Optimize                  | 35.122 ms                 | 39.835 ms                 |
| BarrierTimeBeforeRank0    | 43.865 us                 | 100.495 us                |
| BlockToStepN              | 25.116 us                 | 111.320 us                |
| OneStep                   | 162.186 ms                | 43.069 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.585 ms                  | 29.110 ms                 |
| bucket keys               | 2.058 ms                  | 3.552 ms                  |
| forward: a2a keys         | 1.998 ms                  | 7.003 ms                  |
| forward: search cache     | 259.876 us                | 354.767 us                |
| forward: a2a values       | 1.697 ms                  | 2.337 ms                  |
| forward: join             | 3.031 ms                  | 3.904 ms                  |
| Forward                   | 23.402 ms                 | 42.293 s                  |
| back: aggr dram keys      | 31.130 ms                 | 50.785 ms                 |
| back: set dram grad       | 3.174 ms                  | 7.232 ms                  |
| back: a2a grad            | 3.625 ms                  | 4.908 ms                  |
| back: grad sum & grad cache  | 2.823 ms                  | 5.889 ms                  |
| Backward                  | 91.240 ms                 | 738.602 ms                |
| Optimize                  | 26.223 ms                 | 39.835 ms                 |
| BarrierTimeBeforeRank0    | 46.581 us                 | 100.495 us                |
| BlockToStepN              | 19.154 us                 | 116.582 us                |
| OneStep                   | 147.133 ms                | 43.069 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.773 ms                  | 29.110 ms                 |
| bucket keys               | 2.073 ms                  | 3.552 ms                  |
| forward: a2a keys         | 1.856 ms                  | 7.003 ms                  |
| forward: search cache     | 260.592 us                | 354.767 us                |
| forward: a2a values       | 1.697 ms                  | 2.496 ms                  |
| forward: join             | 3.040 ms                  | 3.904 ms                  |
| Forward                   | 23.415 ms                 | 29.080 ms                 |
| back: aggr dram keys      | 32.493 ms                 | 50.785 ms                 |
| back: set dram grad       | 3.164 ms                  | 7.232 ms                  |
| back: a2a grad            | 3.643 ms                  | 6.488 ms                  |
| back: grad sum & grad cache  | 2.824 ms                  | 5.889 ms                  |
| Backward                  | 91.638 ms                 | 109.200 ms                |
| Optimize                  | 25.945 ms                 | 35.810 ms                 |
| BarrierTimeBeforeRank0    | 45.127 us                 | 81.931 us                 |
| BlockToStepN              | 18.423 us                 | 140.201 us                |
| OneStep                   | 145.817 ms                | 170.064 ms                |
+---------------------------+---------------------------+---------------------------+
[Rank3] pid = 44910
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 5133,  8327, 11093,  4396,   113,  4529,  8032,   130,  5814, 10787]) tensor([ 1176, 11177,  2813, 14378,  2855, 11392,  3989,  5195,  3756, 10889])
-------Step 1-------
tensor([ 5133,  8327, 11093,  4396,   113,  4529,  8032,   130,  5814, 10787]) tensor([ 2319, 14155,  7188,  6502, 11106,  6576,   919, 11398,   812,  6293])
-------Step 2-------
tensor([ 8038,   149,  2423,   166,  8706,  3044, 13760,   860, 11203,  3898]) tensor([ 5209,  5500,  6025,  7431,  6856,  5021, 13516, 14273,  7420,  8649])
-------Step 3-------
tensor([ 8038,   149,  2423,   166,  8706,  3044, 13760,   860, 11203,  3898]) tensor([11901,  9810,  8419,  6057,   732,  6849,  9263,  5184,  5097, 13527])
-------Step 4-------
tensor([   58,  5669, 13640, 13145,  6218, 11511,  8677,  1495, 14937,  4335]) tensor([ 7895,  1012,  1929,  1322,  7377, 10885,   821,  1417,  4978,  5362])
-------Step 5-------
tensor([   58,  5669, 13640, 13145,  6218, 11511,  8677,  1495, 14937,  4335]) tensor([ 1542, 12548,  1216,  2835,  4716,    82, 14760,  3934,  3047,  6936])
-------Step 6-------
tensor([10113, 10925, 10521,   144,  1080, 11427,    30, 14300,  7618,   121]) tensor([ 8461, 14227,   756,  2819,  2353,  2745,  1095,  2123,  3765, 11604])
-------Step 7-------
tensor([10113, 10925, 10521,   144,  1080, 11427,    30, 14300,  7618,   121]) tensor([ 8888,  9602, 12302,  9441,  8388,  1187, 13147,  5410,  3118,  8727])
-------Step 8-------
tensor([ 6769,  8599,  5485, 10558,  2504, 10646, 12919, 12546,    64, 10600]) tensor([ 2395,  9455, 11867,   502,  6407, 11378,  8334,  6371, 12382, 13109])
-------Step 9-------
tensor([ 6769,  8599,  5485, 10558,  2504, 10646, 12919, 12546,    64, 10600]) tensor([ 2746,   547,  6408,  6638,  2287,  2442, 10765,  4815,   478, 11779])
before start barrier
start train
[proc 0] 100 steps, total: 57.709, sample: 0.462, forward: 44.613, backward: 9.924, update: 2.621
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 57.712, sample: 0.458, forward: 44.619, backward: 9.794, update: 0.464
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 57.716, sample: 0.456, forward: 44.618, backward: 9.809, update: 0.495
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 57.711, sample: 0.451, forward: 44.609, backward: 9.809, update: 0.480
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.774 ms                  | 29.110 ms                 |
| bucket keys               | 2.075 ms                  | 3.448 ms                  |
| forward: a2a keys         | 1.767 ms                  | 6.488 ms                  |
| forward: search cache     | 261.068 us                | 354.767 us                |
| forward: a2a values       | 1.697 ms                  | 2.464 ms                  |
| forward: join             | 3.036 ms                  | 3.904 ms                  |
| Forward                   | 23.340 ms                 | 29.080 ms                 |
| back: aggr dram keys      | 31.769 ms                 | 50.336 ms                 |
| back: set dram grad       | 3.174 ms                  | 7.061 ms                  |
| back: a2a grad            | 3.653 ms                  | 6.488 ms                  |
| back: grad sum & grad cache  | 2.857 ms                  | 4.810 ms                  |
| Backward                  | 91.224 ms                 | 109.200 ms                |
| Optimize                  | 25.945 ms                 | 36.966 ms                 |
| BarrierTimeBeforeRank0    | 43.963 us                 | 81.931 us                 |
| BlockToStepN              | 18.553 us                 | 171.635 us                |
| OneStep                   | 145.325 ms                | 179.486 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.716 ms                  | 29.110 ms                 |
| bucket keys               | 2.075 ms                  | 3.306 ms                  |
| forward: a2a keys         | 1.715 ms                  | 5.524 ms                  |
| forward: search cache     | 260.830 us                | 354.767 us                |
| forward: a2a values       | 1.697 ms                  | 2.337 ms                  |
| forward: join             | 3.050 ms                  | 3.827 ms                  |
| Forward                   | 23.340 ms                 | 29.080 ms                 |
| back: aggr dram keys      | 32.493 ms                 | 49.931 ms                 |
| back: set dram grad       | 3.174 ms                  | 6.377 ms                  |
| back: a2a grad            | 3.670 ms                  | 6.217 ms                  |
| back: grad sum & grad cache  | 2.857 ms                  | 4.602 ms                  |
| Backward                  | 91.032 ms                 | 109.200 ms                |
| Optimize                  | 25.920 ms                 | 39.931 ms                 |
| BarrierTimeBeforeRank0    | 42.118 us                 | 81.931 us                 |
| BlockToStepN              | 18.553 us                 | 207.602 us                |
| OneStep                   | 145.325 ms                | 192.576 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.716 ms                  | 31.402 ms                 |
| bucket keys               | 2.068 ms                  | 3.324 ms                  |
| forward: a2a keys         | 1.770 ms                  | 8.664 ms                  |
| forward: search cache     | 260.115 us                | 354.767 us                |
| forward: a2a values       | 1.701 ms                  | 2.464 ms                  |
| forward: join             | 3.029 ms                  | 4.000 ms                  |
| Forward                   | 23.420 ms                 | 49.619 ms                 |
| back: aggr dram keys      | 32.505 ms                 | 50.336 ms                 |
| back: set dram grad       | 3.180 ms                  | 6.377 ms                  |
| back: a2a grad            | 3.684 ms                  | 6.217 ms                  |
| back: grad sum & grad cache  | 2.826 ms                  | 4.602 ms                  |
| Backward                  | 90.655 ms                 | 108.625 ms                |
| Optimize                  | 25.146 ms                 | 39.835 ms                 |
| BarrierTimeBeforeRank0    | 41.266 us                 | 76.780 us                 |
| BlockToStepN              | 19.208 us                 | 232.991 us                |
| OneStep                   | 145.042 ms                | 181.263 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 14.982, sample: 0.518, forward: 2.630, backward: 9.216, update: 2.529
[proc 3] 200 steps, total: 14.982, sample: 0.515, forward: 2.629, backward: 9.071, update: 0.473
[proc 2] 200 steps, total: 14.982, sample: 0.530, forward: 2.604, backward: 9.099, update: 0.506
[proc 1] 200 steps, total: 14.982, sample: 0.505, forward: 2.618, backward: 9.123, update: 0.494
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.716 ms                  | 31.402 ms                 |
| bucket keys               | 2.067 ms                  | 3.448 ms                  |
| forward: a2a keys         | 1.853 ms                  | 28.043 ms                 |
| forward: search cache     | 259.399 us                | 353.098 us                |
| forward: a2a values       | 1.704 ms                  | 2.496 ms                  |
| forward: join             | 3.023 ms                  | 3.904 ms                  |
| Forward                   | 23.561 ms                 | 52.854 ms                 |
| back: aggr dram keys      | 32.900 ms                 | 50.336 ms                 |
| back: set dram grad       | 3.174 ms                  | 6.303 ms                  |
| back: a2a grad            | 3.703 ms                  | 6.217 ms                  |
| back: grad sum & grad cache  | 2.824 ms                  | 4.602 ms                  |
| Backward                  | 90.756 ms                 | 108.625 ms                |
| Optimize                  | 24.911 ms                 | 39.835 ms                 |
| BarrierTimeBeforeRank0    | 41.111 us                 | 76.780 us                 |
| BlockToStepN              | 19.692 us                 | 242.088 us                |
| OneStep                   | 145.587 ms                | 181.263 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.696 ms                  | 31.430 ms                 |
| bucket keys               | 2.068 ms                  | 3.324 ms                  |
| forward: a2a keys         | 1.830 ms                  | 27.864 ms                 |
| forward: search cache     | 259.399 us                | 352.144 us                |
| forward: a2a values       | 1.713 ms                  | 3.445 ms                  |
| forward: join             | 3.011 ms                  | 3.904 ms                  |
| Forward                   | 23.561 ms                 | 52.854 ms                 |
| back: aggr dram keys      | 33.945 ms                 | 49.931 ms                 |
| back: set dram grad       | 3.162 ms                  | 6.285 ms                  |
| back: a2a grad            | 3.677 ms                  | 6.217 ms                  |
| back: grad sum & grad cache  | 2.823 ms                  | 4.684 ms                  |
| Backward                  | 90.651 ms                 | 108.625 ms                |
| Optimize                  | 24.867 ms                 | 39.835 ms                 |
| BarrierTimeBeforeRank0    | 39.784 us                 | 76.780 us                 |
| BlockToStepN              | 19.722 us                 | 242.088 us                |
| OneStep                   | 145.817 ms                | 181.263 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.716 ms                  | 31.402 ms                 |
| bucket keys               | 2.068 ms                  | 3.448 ms                  |
| forward: a2a keys         | 1.808 ms                  | 28.929 ms                 |
| forward: search cache     | 259.638 us                | 353.098 us                |
| forward: a2a values       | 1.717 ms                  | 3.633 ms                  |
| forward: join             | 3.004 ms                  | 4.000 ms                  |
| Forward                   | 23.561 ms                 | 52.854 ms                 |
| back: aggr dram keys      | 33.945 ms                 | 49.931 ms                 |
| back: set dram grad       | 3.155 ms                  | 6.285 ms                  |
| back: a2a grad            | 3.667 ms                  | 6.217 ms                  |
| back: grad sum & grad cache  | 2.805 ms                  | 4.745 ms                  |
| Backward                  | 90.439 ms                 | 108.191 ms                |
| Optimize                  | 25.023 ms                 | 38.742 ms                 |
| BarrierTimeBeforeRank0    | 39.987 us                 | 73.336 us                 |
| BlockToStepN              | 19.208 us                 | 232.991 us                |
| OneStep                   | 146.532 ms                | 181.023 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 15.165, sample: 0.456, forward: 2.937, backward: 9.110, update: 0.438
[proc 0] 300 steps, total: 15.165, sample: 0.446, forward: 2.988, backward: 9.171, update: 2.472
[proc 2] 300 steps, total: 15.165, sample: 0.460, forward: 2.981, backward: 9.047, update: 0.406
[proc 3] 300 steps, total: 15.165, sample: 0.373, forward: 2.996, backward: 9.097, update: 0.368
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.699 ms                  | 31.402 ms                 |
| bucket keys               | 2.051 ms                  | 3.552 ms                  |
| forward: a2a keys         | 1.893 ms                  | 29.017 ms                 |
| forward: search cache     | 259.161 us                | 352.144 us                |
| forward: a2a values       | 1.741 ms                  | 3.445 ms                  |
| forward: join             | 2.988 ms                  | 4.037 ms                  |
| Forward                   | 23.608 ms                 | 54.827 ms                 |
| back: aggr dram keys      | 34.692 ms                 | 49.931 ms                 |
| back: set dram grad       | 3.152 ms                  | 6.206 ms                  |
| back: a2a grad            | 3.677 ms                  | 6.217 ms                  |
| back: grad sum & grad cache  | 2.803 ms                  | 4.684 ms                  |
| Backward                  | 90.413 ms                 | 109.200 ms                |
| Optimize                  | 24.867 ms                 | 38.742 ms                 |
| BarrierTimeBeforeRank0    | 40.500 us                 | 76.780 us                 |
| BlockToStepN              | 19.887 us                 | 253.566 us                |
| OneStep                   | 146.532 ms                | 191.941 ms                |
+---------------------------+---------------------------+---------------------------+
Successfully xmh. training takes 90.90994882583618 seconds
before call kg_cache_controller.StopThreads()
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads
INFO [44576 controller_process.py:421] call rank0 to StopThreads

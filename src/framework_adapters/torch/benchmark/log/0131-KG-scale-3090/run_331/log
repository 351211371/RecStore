WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240213 00:57:38.583627 62595 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_134', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [62595 sampler.py:454] Start PreSampling
WARNING [62595 sampler.py:532] Before construct renumbering_dict
WARNING [62595 sampler.py:555] PreSampling done
W20240213 00:57:44.197088 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240213 00:57:44.197284 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240213 00:57:44.197321 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240213 00:57:44.197360 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240213 00:57:44.197407 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240213 00:57:44.197438 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240213 00:57:44.197482 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240213 00:57:44.197564 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240213 00:57:44.197600 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240213 00:57:44.197633 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240213 00:57:44.197672 62595 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240213 00:57:44.197703 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240213 00:57:44.197737 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240213 00:57:44.197926 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240213 00:57:44.197973 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240213 00:57:44.198004 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240213 00:57:44.198051 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240213 00:57:44.198096 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240213 00:57:44.198130 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240213 00:57:44.198169 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240213 00:57:44.198211 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240213 00:57:44.198271 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240213 00:57:44.198318 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240213 00:57:44.198359 62595 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240213 00:57:44.198385 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240213 00:57:44.198412 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240213 00:57:44.198475 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240213 00:57:44.198513 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240213 00:57:44.198550 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240213 00:57:44.198583 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240213 00:57:44.198629 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240213 00:57:44.198669 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240213 00:57:44.198712 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240213 00:57:44.198761 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240213 00:57:44.198801 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240213 00:57:44.198837 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240213 00:57:44.198868 62595 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240213 00:57:44.198894 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240213 00:57:44.198920 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240213 00:57:44.198978 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240213 00:57:44.199012 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240213 00:57:44.199043 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240213 00:57:44.199074 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240213 00:57:44.199112 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240213 00:57:44.199149 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240213 00:57:44.199189 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240213 00:57:44.199223 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240213 00:57:44.199258 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240213 00:57:44.199291 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240213 00:57:44.199322 62595 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240213 00:57:44.199348 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240213 00:57:44.199381 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240213 00:57:44.199446 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240213 00:57:44.199502 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240213 00:57:44.199537 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240213 00:57:44.199579 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240213 00:57:44.199610 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240213 00:57:44.199651 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240213 00:57:44.199693 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240213 00:57:44.199724 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240213 00:57:44.199766 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240213 00:57:44.199801 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240213 00:57:44.199839 62595 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240213 00:57:44.199867 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240213 00:57:44.199892 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240213 00:57:44.199949 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240213 00:57:44.199985 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240213 00:57:44.200016 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240213 00:57:44.200047 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240213 00:57:44.200090 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240213 00:57:44.200126 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240213 00:57:44.200163 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240213 00:57:44.200198 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240213 00:57:44.200232 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240213 00:57:44.200268 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240213 00:57:44.200297 62595 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240213 00:57:44.200325 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240213 00:57:44.200349 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240213 00:57:44.200405 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x10001ca5a000 7.629 MB
W20240213 00:57:44.200453 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x10001d1fd000 7.629 MB
W20240213 00:57:44.200486 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_2 [1000000]0x10001d9a0000 7.629 MB
W20240213 00:57:44.200522 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_3 [1000000]0x10001e143000 7.629 MB
W20240213 00:57:44.200562 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_4 [1000000]0x10001e8e6000 7.629 MB
W20240213 00:57:44.200598 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_5 [1000000]0x10001f089000 7.629 MB
W20240213 00:57:44.200637 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_6 [1000000]0x10001f82c000 7.629 MB
W20240213 00:57:44.200676 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_7 [1000000]0x10001ffcf000 7.629 MB
W20240213 00:57:44.200713 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_8 [1000000]0x100020772000 7.629 MB
W20240213 00:57:44.200749 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_9 [1000000]0x100020f15000 7.629 MB
W20240213 00:57:44.200793 62595 IPCTensor.h:369] NewIPCTensor: step_r6 [10]0x1000216b8000 80 B 
W20240213 00:57:44.200820 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x1000216ba000 8 B 
W20240213 00:57:44.200846 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x1000216bc000 8 B 
W20240213 00:57:44.200906 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_0 [1000000]0x1000216be000 7.629 MB
W20240213 00:57:44.200938 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_1 [1000000]0x100021e61000 7.629 MB
W20240213 00:57:44.200969 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_2 [1000000]0x100022604000 7.629 MB
W20240213 00:57:44.201000 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_3 [1000000]0x100022da7000 7.629 MB
W20240213 00:57:44.201031 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_4 [1000000]0x10002354a000 7.629 MB
W20240213 00:57:44.201062 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_5 [1000000]0x100023ced000 7.629 MB
W20240213 00:57:44.201094 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_6 [1000000]0x100024490000 7.629 MB
W20240213 00:57:44.201133 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_7 [1000000]0x100024c33000 7.629 MB
W20240213 00:57:44.201167 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_8 [1000000]0x1000253d6000 7.629 MB
W20240213 00:57:44.201203 62595 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_9 [1000000]0x100025b79000 7.629 MB
W20240213 00:57:44.201233 62595 IPCTensor.h:369] NewIPCTensor: step_r7 [10]0x10002631c000 80 B 
W20240213 00:57:44.201260 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r7 [1]0x10002631e000 8 B 
W20240213 00:57:44.201292 62595 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100026320000 8 B 
W20240213 00:57:44.429620 62595 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100026322000 22.81 MB
W20240213 00:57:44.520812 62595 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000279f4000 58.4 kB
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([ 750, 1120, 1644,  ..., 9693, 8791, 6655]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 6.033 seconds
[Rank1] pid = 62800
[Rank2] pid = 62864
[Rank3] pid = 62865
[Rank4] pid = 62993
[Rank5] pid = 63058
[Rank6] pid = 63093
INFO [62595 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [62864 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [62800 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [62865 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [63058 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [62993 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [63093 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [63193 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [63093 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [63193 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [63058 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [62864 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [62993 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [62595 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [62800 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240213 00:57:47.154085 62994 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [747, 400]; dev=4; size=1.14 MB
INFO [62865 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
W20240213 00:57:47.154222 63195 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_7 [747, 400]; dev=7; size=1.14 MB
W20240213 00:57:47.154222 62866 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240213 00:57:47.154242 63060 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [747, 400]; dev=5; size=1.14 MB
W20240213 00:57:47.154244 63130 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_6 [747, 400]; dev=6; size=1.14 MB
W20240213 00:57:47.155572 63194 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240213 00:57:47.157147 62869 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240213 00:57:47.157611 62801 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240213 00:57:47.181108 63130 IPCTensor.h:369] NewIPCTensor: input_keys_6 [1000000]0x100027a08000 7.629 MB
W20240213 00:57:47.181113 63195 IPCTensor.h:369] NewIPCTensor: input_keys_7 [1000000]0x1000281ab000 7.629 MB
W20240213 00:57:47.181324 63195 IPCTensor.h:369] NewIPCTensor: input_keys_neg_7 [1000000]0x10002894e000 7.629 MB
W20240213 00:57:47.181339 63130 IPCTensor.h:369] NewIPCTensor: input_keys_neg_6 [1000000]0x1000290f1000 7.629 MB
W20240213 00:57:47.181391 63195 IPCTensor.h:369] NewIPCTensor: backward_grads_7 [1000000, 400]0x100029894000 1.49 GB
W20240213 00:57:47.181411 63130 IPCTensor.h:369] NewIPCTensor: backward_grads_6 [1000000, 400]0x100088e77000 1.49 GB
W20240213 00:57:47.181454 63195 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_7 [1000000, 400]0x1000e845a000 1.49 GB
W20240213 00:57:47.181473 63130 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_6 [1000000, 400]0x100147a3d000 1.49 GB
W20240213 00:57:47.181519 63195 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240213 00:57:47.181524 63130 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240213 00:57:47.185444 63130 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_6_gpu [1000000, 400]; dev=6; size=1.49 GB
W20240213 00:57:47.185658 63195 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_7_gpu [1000000, 400]; dev=7; size=1.49 GB
W20240213 00:57:47.185812 62994 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x1001a7028000 7.629 MB
W20240213 00:57:47.185838 63060 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x1001a77cb000 7.629 MB
W20240213 00:57:47.185985 62994 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x1001a7f6e000 7.629 MB
W20240213 00:57:47.186012 63060 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x1001a8711000 7.629 MB
W20240213 00:57:47.186072 62994 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x1001a8eb4000 1.49 GB
W20240213 00:57:47.186096 63060 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x100208497000 1.49 GB
W20240213 00:57:47.186146 62994 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x100267a7a000 1.49 GB
W20240213 00:57:47.186169 63060 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x1002c705d000 1.49 GB
W20240213 00:57:47.186231 63060 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240213 00:57:47.186231 62994 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240213 00:57:47.187177 63194 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x100326642000 7.629 MB
W20240213 00:57:47.187332 63194 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100326de5000 7.629 MB
W20240213 00:57:47.187412 63194 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x100327588000 1.49 GB
W20240213 00:57:47.187460 63194 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100386b6b000 1.49 GB
W20240213 00:57:47.187525 63194 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240213 00:57:47.192199 62866 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1003e6150000 7.629 MB
W20240213 00:57:47.192328 62866 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1003e68f3000 7.629 MB
W20240213 00:57:47.192394 62866 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1003e7096000 1.49 GB
W20240213 00:57:47.192458 62866 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x100446679000 1.49 GB
W20240213 00:57:47.192516 62866 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240213 00:57:47.195631 63060 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240213 00:57:47.195634 63194 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240213 00:57:47.195675 62994 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240213 00:57:47.195711 62866 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240213 00:57:47.195806 62869 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x1004a5c6a000 7.629 MB
W20240213 00:57:47.195919 62801 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1004a640d000 7.629 MB
W20240213 00:57:47.195942 62869 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1004a6bb0000 7.629 MB
W20240213 00:57:47.196002 62869 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1004a7353000 1.49 GB
W20240213 00:57:47.196066 62869 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x100506936000 1.49 GB
W20240213 00:57:47.196116 62869 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240213 00:57:47.196123 62801 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100565f19000 7.629 MB
W20240213 00:57:47.196198 62801 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1005666bc000 1.49 GB
W20240213 00:57:47.196254 62801 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1005c5c9f000 1.49 GB
W20240213 00:57:47.196300 62801 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240213 00:57:47.206276 62869 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240213 00:57:47.206596 62801 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100026322000
1: KnownLocalCachedEmbedding init done
WARNING [62800 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
2: KnownLocalCachedEmbedding init done
WARNING [62864 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
3: KnownLocalCachedEmbedding init done
WARNING [62865 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
6: KnownLocalCachedEmbedding init done
WARNING [63093 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
7: KnownLocalCachedEmbedding init done
WARNING [63193 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100026322000
5: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100026322000
4: KnownLocalCachedEmbedding init done
WARNING [62993 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [63058 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank7] pid = 63193
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
cudaHostRegister 0x100026322000
0: KnownLocalCachedEmbedding init done
WARNING [62595 DistTensor.py:59] The tensor name already exists in the kvstore
I20240213 00:57:49.825057 63194 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240213 00:57:49.825170 62869 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240213 00:57:49.825273 63130 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240213 00:57:49.825433 62801 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240213 00:57:49.825577 63195 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240213 00:57:49.825829 62994 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240213 00:57:49.826130 63060 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240213 00:57:49.826318 62866 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
E20240213 00:57:50.585043 63194 recstore.cc:66] init folly done
E20240213 00:57:50.585055 63195 recstore.cc:66] init folly done
E20240213 00:57:50.585093 62869 recstore.cc:66] init folly done
E20240213 00:57:50.585368 62994 recstore.cc:66] init folly done
E20240213 00:57:50.585381 62866 recstore.cc:66] init folly done
E20240213 00:57:50.585386 63130 recstore.cc:66] init folly done
E20240213 00:57:50.585389 62801 recstore.cc:66] init folly done
E20240213 00:57:50.585492 63060 recstore.cc:66] init folly done
I20240213 00:57:50.655689 62801 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240213 00:57:50.657450 63130 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240213 00:57:50.659037 62994 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240213 00:57:50.660215 63195 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240213 00:57:50.666891 63194 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240213 00:57:50.668864 62869 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240213 00:57:50.669477 62866 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240213 00:57:50.669505 63060 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.138 ms                  | 1.138 ms                  |
| Forward                   | 455.781 ms                | 455.781 ms                |
| back: bucket keys         | 21.511 ms                 | 21.511 ms                 |
| back: a2a                 | 47.603 s                  | 47.603 s                  |
| back: cache               | 11.589 ms                 | 11.589 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.564 ms                  | 20.107 ms                 |
| Forward                   | 5.269 ms                  | 455.781 ms                |
| back: bucket keys         | 666.142 us                | 2.004 ms                  |
| back: a2a                 | 9.777 ms                  | 19.196 ms                 |
| back: cache               | 4.934 ms                  | 9.320 ms                  |
| back: aggr dram keys      | 43.411 ms                 | 73.826 ms                 |
| back: set dram grad       | 2.360 ms                  | 8.132 ms                  |
| Backward                  | 134.129 ms                | 49.100 s                  |
| Optimize                  | 30.974 ms                 | 66.179 ms                 |
| BarrierTimeBeforeRank0    | 58.793 us                 | 136.878 us                |
| BlockToStepN              | 105.240 us                | 1.666 ms                  |
| OneStep                   | 176.617 ms                | 49.625 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.564 ms                  | 19.035 ms                 |
| Forward                   | 5.224 ms                  | 9.710 ms                  |
| back: bucket keys         | 1.245 ms                  | 2.004 ms                  |
| back: a2a                 | 10.192 ms                 | 19.196 ms                 |
| back: cache               | 4.952 ms                  | 10.946 ms                 |
| back: aggr dram keys      | 42.972 ms                 | 73.826 ms                 |
| back: set dram grad       | 2.495 ms                  | 8.572 ms                  |
| Backward                  | 133.788 ms                | 164.153 ms                |
| Optimize                  | 30.740 ms                 | 58.039 ms                 |
| BarrierTimeBeforeRank0    | 54.027 us                 | 102.810 us                |
| BlockToStepN              | 113.076 us                | 1.666 ms                  |
| OneStep                   | 175.833 ms                | 215.177 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.479 ms                  | 19.188 ms                 |
| Forward                   | 5.085 ms                  | 9.710 ms                  |
| back: bucket keys         | 966.549 us                | 1.849 ms                  |
| back: a2a                 | 10.350 ms                 | 19.196 ms                 |
| back: cache               | 4.957 ms                  | 10.729 ms                 |
| back: aggr dram keys      | 43.329 ms                 | 67.906 ms                 |
| back: set dram grad       | 2.370 ms                  | 8.132 ms                  |
| Backward                  | 134.129 ms                | 167.040 ms                |
| Optimize                  | 30.683 ms                 | 58.039 ms                 |
| BarrierTimeBeforeRank0    | 51.110 us                 | 102.810 us                |
| BlockToStepN              | 98.008 us                 | 1.666 ms                  |
| OneStep                   | 176.283 ms                | 215.177 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 67.193, sample: 0.335, forward: 0.887, backward: 59.141, update: 0.400
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 67.202, sample: 0.323, forward: 0.885, backward: 59.151, update: 0.403
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 67.203, sample: 0.331, forward: 0.869, backward: 59.208, update: 0.381
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 67.206, sample: 0.327, forward: 0.870, backward: 59.175, update: 0.396
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 67.193, sample: 0.334, forward: 0.866, backward: 59.198, update: 0.395
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 67.193, sample: 0.336, forward: 0.862, backward: 59.186, update: 0.393
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 67.205, sample: 0.329, forward: 0.863, backward: 59.185, update: 0.380
train_sampler.Prefill()
-------Step 0-------
tensor([ 2144,    58,  3234,  3044, 11917, 12321,  1085,   443, 12558, 11547]) tensor([ 1644,  8956,  6395, 10779, 11575,   990,   566,  5168,   524, 12183])
-------Step 1-------
tensor([ 2144,    58,  3234,  3044, 11917, 12321,  1085,   443, 12558, 11547]) tensor([ 3864, 10873, 13978,  1477,  1013,  6949, 13080, 10596,  4407, 12957])
-------Step 2-------
tensor([ 7263, 10785,  5253,  3697,  8755,  8032, 10797,    63, 10171,   916]) tensor([ 3544,  4760,  3759,  8009,  5846,  8915, 14645,  9069, 12017,  9013])
-------Step 3-------
tensor([ 7263, 10785,  5253,  3697,  8755,  8032, 10797,    63, 10171,   916]) tensor([ 7254,  6638,  6918, 10403,  6834,   710,  5236,  2094, 11769,  2020])
-------Step 4-------
tensor([   58, 13011, 10033,  5335,  5787,  3297,    37,  7300,  7296,  1014]) tensor([ 596, 1159, 3952, 2994, 2949, 2568,  443, 6512, 5588, 1739])
-------Step 5-------
tensor([   58, 13011, 10033,  5335,  5787,  3297,    37,  7300,  7296,  1014]) tensor([10692,  4502,  5785,  1870,  3157,   816,   820,  1278,  6012,  7179])
-------Step 6-------
tensor([ 1668,  8967,     9,    74,  8497,  2840,  8212, 12069, 14710, 12665]) tensor([10785,  2894,  6838,  3995,  8563,  9201,  3826,  8179, 10062, 12738])
-------Step 7-------
tensor([ 1668,  8967,     9,    74,  8497,  2840,  8212, 12069, 14710, 12665]) tensor([12217, 12623,  4195,  6550,  1302,  8131,  7023,  3575,   146, 12550])
-------Step 8-------
tensor([ 3452,  7321,  4644, 11838,    33,    90,  9187, 12341,    31,  2005]) tensor([ 6603,  5409,  4331,  7461,  2704, 13846,  9388,  1449, 10024,  3223])
-------Step 9-------
tensor([ 3452,  7321,  4644, 11838,    33,    90,  9187, 12341,    31,  2005]) tensor([12043,  3810, 14093,  7324, 14382, 13764, 13988, 10596,   663, 12798])
before start barrier
start train
[proc 0] 100 steps, total: 67.195, sample: 0.356, forward: 0.950, backward: 62.505, update: 3.258
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.452 ms                  | 19.351 ms                 |
| Forward                   | 5.082 ms                  | 10.726 ms                 |
| back: bucket keys         | 787.258 us                | 2.131 ms                  |
| back: a2a                 | 10.350 ms                 | 19.196 ms                 |
| back: cache               | 4.936 ms                  | 10.729 ms                 |
| back: aggr dram keys      | 42.823 ms                 | 67.906 ms                 |
| back: set dram grad       | 2.350 ms                  | 8.132 ms                  |
| Backward                  | 133.064 ms                | 167.040 ms                |
| Optimize                  | 30.458 ms                 | 58.039 ms                 |
| BarrierTimeBeforeRank0    | 48.904 us                 | 102.810 us                |
| BlockToStepN              | 110.787 us                | 1.666 ms                  |
| OneStep                   | 174.633 ms                | 215.177 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.453 ms                  | 23.062 ms                 |
| Forward                   | 5.101 ms                  | 10.726 ms                 |
| back: bucket keys         | 940.800 us                | 2.004 ms                  |
| back: a2a                 | 11.148 ms                 | 20.097 ms                 |
| back: cache               | 4.937 ms                  | 9.373 ms                  |
| back: aggr dram keys      | 42.829 ms                 | 67.533 ms                 |
| back: set dram grad       | 2.335 ms                  | 8.139 ms                  |
| Backward                  | 133.064 ms                | 168.174 ms                |
| Optimize                  | 30.473 ms                 | 58.039 ms                 |
| BarrierTimeBeforeRank0    | 49.260 us                 | 109.207 us                |
| BlockToStepN              | 113.076 us                | 1.666 ms                  |
| OneStep                   | 174.633 ms                | 225.837 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.473 ms                  | 20.107 ms                 |
| Forward                   | 5.082 ms                  | 9.710 ms                  |
| back: bucket keys         | 940.800 us                | 2.004 ms                  |
| back: a2a                 | 11.148 ms                 | 26.978 ms                 |
| back: cache               | 4.936 ms                  | 9.373 ms                  |
| back: aggr dram keys      | 42.991 ms                 | 67.533 ms                 |
| back: set dram grad       | 2.311 ms                  | 8.139 ms                  |
| Backward                  | 133.465 ms                | 167.332 ms                |
| Optimize                  | 30.420 ms                 | 53.592 ms                 |
| BarrierTimeBeforeRank0    | 49.728 us                 | 102.810 us                |
| BlockToStepN              | 109.058 us                | 1.354 ms                  |
| OneStep                   | 174.329 ms                | 220.171 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.479 ms                  | 20.107 ms                 |
| Forward                   | 5.101 ms                  | 10.726 ms                 |
| back: bucket keys         | 797.033 us                | 1.849 ms                  |
| back: a2a                 | 11.076 ms                 | 34.070 ms                 |
| back: cache               | 4.932 ms                  | 9.320 ms                  |
| back: aggr dram keys      | 42.823 ms                 | 64.725 ms                 |
| back: set dram grad       | 2.311 ms                  | 8.132 ms                  |
| Backward                  | 134.329 ms                | 167.332 ms                |
| Optimize                  | 30.420 ms                 | 53.592 ms                 |
| BarrierTimeBeforeRank0    | 49.260 us                 | 102.810 us                |
| BlockToStepN              | 110.783 us                | 1.354 ms                  |
| OneStep                   | 175.648 ms                | 220.171 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 5] 200 steps, total: 17.930, sample: 0.357, forward: 0.437, backward: 10.602, update: 0.357
[proc 2] 200 steps, total: 17.930, sample: 0.347, forward: 0.430, backward: 10.573, update: 0.294
[proc 6] 200 steps, total: 17.930, sample: 0.377, forward: 0.439, backward: 10.547, update: 0.306
[proc 4] 200 steps, total: 17.930, sample: 0.367, forward: 0.434, backward: 10.554, update: 0.301
[proc 3] 200 steps, total: 17.930, sample: 0.374, forward: 0.438, backward: 10.583, update: 0.311
[proc 0] 200 steps, total: 17.930, sample: 0.401, forward: 0.517, backward: 13.773, update: 3.114
[proc 7] 200 steps, total: 17.930, sample: 0.370, forward: 0.443, backward: 10.562, update: 0.346
[proc 1] 200 steps, total: 17.930, sample: 0.342, forward: 0.447, backward: 10.629, update: 0.337
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.473 ms                  | 20.107 ms                 |
| Forward                   | 5.101 ms                  | 10.726 ms                 |
| back: bucket keys         | 940.800 us                | 1.923 ms                  |
| back: a2a                 | 11.279 ms                 | 35.324 ms                 |
| back: cache               | 4.925 ms                  | 9.373 ms                  |
| back: aggr dram keys      | 42.674 ms                 | 64.725 ms                 |
| back: set dram grad       | 2.300 ms                  | 8.139 ms                  |
| Backward                  | 135.061 ms                | 168.174 ms                |
| Optimize                  | 30.286 ms                 | 53.592 ms                 |
| BarrierTimeBeforeRank0    | 49.260 us                 | 102.810 us                |
| BlockToStepN              | 106.248 us                | 1.354 ms                  |
| OneStep                   | 175.215 ms                | 220.171 ms                |
+---------------------------+---------------------------+---------------------------+
Successfully xmh. training takes 90.36848449707031 seconds
before call kg_cache_controller.StopThreads()
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads
INFO [62595 controller_process.py:421] call rank0 to StopThreads

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240206 19:46:13.690490 27609 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_12', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [27609 sampler.py:454] Start PreSampling
WARNING [27609 sampler.py:532] Before construct renumbering_dict
WARNING [27609 sampler.py:555] PreSampling done
W20240206 20:05:53.952790 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240206 20:05:53.952980 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240206 20:05:53.953015 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240206 20:05:53.953051 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240206 20:05:53.953088 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240206 20:05:53.953121 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240206 20:05:53.953153 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240206 20:05:53.953186 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240206 20:05:53.953220 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240206 20:05:53.953254 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240206 20:05:53.953295 27609 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240206 20:05:53.953325 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240206 20:05:53.953353 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240206 20:05:53.953505 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240206 20:05:53.953545 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240206 20:05:53.953574 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240206 20:05:53.953614 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240206 20:05:53.953648 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240206 20:05:53.953681 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240206 20:05:53.953709 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240206 20:05:53.953740 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240206 20:05:53.953773 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240206 20:05:53.953804 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240206 20:05:53.953833 27609 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240206 20:05:53.953855 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240206 20:05:53.953884 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240206 20:05:53.953944 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240206 20:05:53.953979 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240206 20:05:53.954017 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240206 20:05:53.954051 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240206 20:05:53.954079 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240206 20:05:53.954111 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240206 20:05:53.954144 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240206 20:05:53.954175 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240206 20:05:53.954208 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240206 20:05:53.954238 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240206 20:05:53.954272 27609 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240206 20:05:53.954294 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240206 20:05:53.954317 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240206 20:05:53.954378 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240206 20:05:53.954407 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240206 20:05:53.954440 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240206 20:05:53.954473 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240206 20:05:53.954501 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240206 20:05:53.954538 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240206 20:05:53.954569 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240206 20:05:53.954599 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240206 20:05:53.954627 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240206 20:05:53.954659 27609 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240206 20:05:53.954686 27609 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240206 20:05:53.954710 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240206 20:05:53.954732 27609 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240206 20:05:54.376065 27609 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240206 20:14:25.748457 27609 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Rank2: cached key size 2151353
Rank3: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 8605419,  8605440,   145530,  ..., 59244312, 18758466,  4595167]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2195.725 seconds
[Rank1] pid = 28703
[Rank2] pid = 28801
INFO [27609 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [28801 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [28868 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [28703 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [28801 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [28868 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [28703 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [27609 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240206 20:22:54.693931 28869 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [8605415, 400]; dev=0; size=12.82 GB
W20240206 20:22:54.694875 28802 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [8605415, 400]; dev=2; size=12.82 GB
W20240206 20:22:54.694978 28932 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [8605415, 400]; dev=3; size=12.82 GB
W20240206 20:22:54.694983 28704 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [8605415, 400]; dev=1; size=12.82 GB
W20240206 20:22:54.775036 28869 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102036619000 7.629 MB
W20240206 20:22:54.775051 28932 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036dbc000 7.629 MB
W20240206 20:22:54.775058 28802 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10203755f000 7.629 MB
W20240206 20:22:54.775065 28704 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102037d02000 7.629 MB
W20240206 20:22:54.775175 28869 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1020384a5000 7.629 MB
W20240206 20:22:54.775225 28932 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x102038c48000 7.629 MB
W20240206 20:22:54.775231 28869 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x102039b8e000 1.49 GB
W20240206 20:22:54.775229 28704 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1020393eb000 7.629 MB
W20240206 20:22:54.775249 28802 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x102099171000 7.629 MB
W20240206 20:22:54.775270 28869 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x102099914000 1.49 GB
W20240206 20:22:54.775314 28932 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240206 20:22:54.775318 28869 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240206 20:22:54.775336 28704 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1021584da000 1.49 GB
W20240206 20:22:54.775343 28802 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1021b7abd000 1.49 GB
W20240206 20:22:54.775370 28932 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1022170a0000 1.49 GB
W20240206 20:22:54.775394 28704 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x102276683000 1.49 GB
W20240206 20:22:54.775406 28802 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1022d5c66000 1.49 GB
W20240206 20:22:54.775418 28932 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240206 20:22:54.775436 28704 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240206 20:22:54.775445 28802 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240206 20:22:54.782692 28869 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240206 20:22:54.782697 28932 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240206 20:22:54.783161 28704 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240206 20:22:54.783170 28802 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [28801 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 28868
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 8605415), (8605415, 17210830), (17210830, 25816245), (25816245, 34421660)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [27609 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [28703 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [28868 DistTensor.py:59] The tensor name already exists in the kvstore
I20240206 20:23:28.895061 28932 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240206 20:23:28.895179 28704 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240206 20:23:28.895334 28869 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240206 20:23:28.895427 28802 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240206 20:23:28.897509 28869 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.1,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240206 20:23:28.897804 28869 grad_base.h:184] Init GradProcessingBase done
I20240206 20:23:42.169775 28869 grad_async_v2.h:42] Use main thread to update emb.
W20240206 20:23:42.170094 28869 kg_controller.h:78] after init GradAsyncProcessingV2
I20240206 20:23:42.170104 28869 kg_controller.h:84] Construct KGCacheController done
E20240206 20:23:43.621129 28932 recstore.cc:66] init folly done
E20240206 20:23:43.621152 28704 recstore.cc:66] init folly done
E20240206 20:23:43.621330 28802 recstore.cc:66] init folly done
E20240206 20:23:43.621331 28869 recstore.cc:66] init folly done
I20240206 20:23:43.622390 28869 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240206 20:23:55.646641 29232 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240206 20:23:55.647007 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 20:23:57.150647 29232 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240206 20:23:57.151032 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 147.134 us                | 322.370 us                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:01.520118 29232 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240206 20:24:01.534986 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240206 20:24:01.699167 28932 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 142.623 us                | 297.557 us                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:03.851186 29232 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240206 20:24:03.866654 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240206 20:24:03.948901 28704 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240206 20:24:04.789332 28802 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240206 20:24:04.863147 28869 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240206 20:24:04.866024 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 20:24:04.870834 29232 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
E20240206 20:24:05.869421 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240206 20:24:06.757737 29232 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240206 20:24:06.787259 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
E20240206 20:24:06.869024 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=5
W20240206 20:24:07.822710 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=11, pq.top=11
E20240206 20:24:07.872709 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
E20240206 20:24:07.904783 28869 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=11, sample_step_cpp_seen_[rank]=10
W20240206 20:24:08.053650 29232 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 222.191 us                | 3.072 ms                  |
| ProcessBack:Shuffle       | 2.675 ms                  | 217.923 ms                |
| ProcessBack:UpdateCache   | 3.007 ms                  | 527.694 ms                |
| ProcessBack:UpsertPq      | 12.781 ms                 | 65.119 ms                 |
| ProcessOneStep            | 48.464 ms                 | 990.480 ms                |
| BlockToStepN              | 426.750 us                | 25.651 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:08.873088 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.567 ms                  | 126.467 ms                |
| Forward                   | 5.795 ms                  | 564.329 ms                |
| Backward                  | 5.652 ms                  | 286.084 ms                |
| Optimize                  | 2.580 ms                  | 72.626 ms                 |
| BarrierTimeBeforeRank0    | 8.223 ms                  | 72.830 ms                 |
| AfterBackward             | 48.518 ms                 | 990.913 ms                |
| BlockToStepN              | 600.611 us                | 25.704 ms                 |
| OneStep                   | 97.503 ms                 | 1.925 s                   |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:09.693445 29232 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240206 20:24:09.874727 28869 parallel_pq_v2.h:79] insert failed, size(hashtable)=9342
W20240206 20:24:10.309127 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=27, pq.top=27
E20240206 20:24:10.874100 29039 parallel_pq_v2.h:79] insert failed, size(hashtable)=3
W20240206 20:24:10.895444 29232 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
E20240206 20:24:11.874008 28869 parallel_pq_v2.h:79] insert failed, size(hashtable)=3703
W20240206 20:24:12.109520 29232 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end9
E20240206 20:24:12.874959 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=199
E20240206 20:24:12.904007 29039 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=44, sample_step_cpp_seen_[rank]=43
W20240206 20:24:13.435892 29232 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 308.384 us                | 4.923 ms                  |
| ProcessBack:Shuffle       | 2.794 ms                  | 217.921 ms                |
| ProcessBack:UpdateCache   | 3.037 ms                  | 527.687 ms                |
| ProcessBack:UpsertPq      | 27.593 ms                 | 107.286 ms                |
| ProcessOneStep            | 59.232 ms                 | 990.480 ms                |
| BlockToStepN              | 311.925 us                | 25.651 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:13.874025 28869 parallel_pq_v2.h:79] insert failed, size(hashtable)=215
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.571 ms                  | 176.221 ms                |
| Forward                   | 5.944 ms                  | 11.488 ms                 |
| Backward                  | 5.392 ms                  | 6.758 ms                  |
| Optimize                  | 2.741 ms                  | 25.357 ms                 |
| BarrierTimeBeforeRank0    | 89.400 us                 | 72.830 ms                 |
| AfterBackward             | 59.260 ms                 | 583.365 ms                |
| BlockToStepN              | 405.746 us                | 1.725 ms                  |
| OneStep                   | 97.503 ms                 | 603.144 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:14.166678 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=55, pq.top=55
W20240206 20:24:14.504974 29232 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240206 20:24:14.874013 29039 parallel_pq_v2.h:79] insert failed, size(hashtable)=4301
W20240206 20:24:15.265817 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=65, pq.top=65
W20240206 20:24:15.704844 29232 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
E20240206 20:24:15.874107 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 20:24:16.287101 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=72, pq.top=72
W20240206 20:24:16.757460 29232 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end9
E20240206 20:24:16.877560 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 20:24:17.390129 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=87, pq.top=87
E20240206 20:24:17.877012 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1907
E20240206 20:24:17.904004 29039 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=91, sample_step_cpp_seen_[rank]=90
W20240206 20:24:17.932720 29232 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240206 20:24:18.496613 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=99, pq.top=99
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 13.762, sample: 1.434, forward: 1.016, backward: 0.764, update: 0.273
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 14.602, sample: 1.549, forward: 0.990, backward: 0.769, update: 0.273
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 16.852, sample: 2.038, forward: 0.943, backward: 0.763, update: 0.239
train_sampler.Prefill()
-------Step 0-------
tensor([ 1642087,   870597, 45517425,  1717847,   614143,   870645,   870692,
          294777,  1642111,  1642136]) tensor([ 9191153, 29154491,  1641070, 56277467, 59575822,  1392911, 84294469,
        79396752, 60786301, 74152680])
-------Step 1-------
tensor([ 1642087,   870597, 45517425,  1717847,   614143,   870645,   870692,
          294777,  1642111,  1642136]) tensor([31886504, 70856152, 78181364, 14847903, 52050694, 12418924, 76510495,
        78244460, 21822819, 33424134])
-------Step 2-------
tensor([  990978,  1650609, 76953790,  1650654,   991021,   991065,   991102,
        42003023,   991155,   991202]) tensor([35661924,  9125856, 53470552, 14472822, 18451470, 16412294, 55812195,
        13477473, 54113300, 33582116])
-------Step 3-------
tensor([  990978,  1650609, 76953790,  1650654,   991021,   991065,   991102,
        42003023,   991155,   991202]) tensor([  619771, 43248658,  1010849, 43052501, 17030933, 62543845, 65898397,
        67600071, 25897175, 80404173])
-------Step 4-------
tensor([1109321, 1659377, 1109351, 1109399, 1659404, 1109444, 1659431, 1109485,
        1659450, 1109539]) tensor([ 3854714, 39424091, 21440750,  1236703, 51022616, 41819950, 82610607,
        52998616, 63385447, 13361618])
-------Step 5-------
tensor([1109321, 1659377, 1109351, 1109399, 1659404, 1109444, 1659431, 1109485,
        1659450, 1109539]) tensor([39146429, 42427801, 74585054, 13817651, 36692813,   324932, 41593148,
        62113059, 85473529,  1825141])
-------Step 6-------
tensor([73638483,  1226687,  1226724,  1226776,  8611020,  1226821,  1226867,
         1226912,  1226961,   302101]) tensor([28599427, 41788119, 29935040, 23475082, 79479449, 63357178, 41011742,
        17285138, 63013018, 12253233])
-------Step 7-------
tensor([73638483,  1226687,  1226724,  1226776,  8611020,  1226821,  1226867,
         1226912,  1226961,   302101]) tensor([43303502, 78561706, 46658812, 66750351, 63673597,  2695936, 21696635,
        48602553, 22504910, 19915922])
-------Step 8-------
tensor([ 1341416,  1677028,  1341447, 39008471,  1732833,  1341487,  1341528,
         1341578,   304357,  1732844]) tensor([26546727, 60311594, 44250958, 83312552, 81615914, 62491402, 64901745,
        78939224, 15055447,  7655341])
-------Step 9-------
tensor([ 1341416,  1677028,  1341447, 39008471,  1732833,  1341487,  1341528,
         1341578,   304357,  1732844]) tensor([69470998, 71868911, 26056951, 37522405, 16223979,  2127442, 25014056,
        18733068, 82688020, 50768210])
before start barrier
start train
[proc 0] 100 steps, total: 13.688, sample: 1.804, forward: 1.142, backward: 0.854, update: 0.383
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 324.367 us                | 5.802 ms                  |
| ProcessBack:Shuffle       | 2.797 ms                  | 24.916 ms                 |
| ProcessBack:UpdateCache   | 2.868 ms                  | 21.902 ms                 |
| ProcessBack:UpsertPq      | 22.562 ms                 | 100.995 ms                |
| ProcessOneStep            | 52.036 ms                 | 583.333 ms                |
| BlockToStepN              | 399.606 us                | 3.060 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:18.877009 28869 parallel_pq_v2.h:79] insert failed, size(hashtable)=321
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.424 ms                  | 176.221 ms                |
| Forward                   | 5.457 ms                  | 11.488 ms                 |
| Backward                  | 5.392 ms                  | 12.474 ms                 |
| Optimize                  | 2.455 ms                  | 25.357 ms                 |
| BarrierTimeBeforeRank0    | 2.333 ms                  | 72.830 ms                 |
| AfterBackward             | 52.064 ms                 | 583.365 ms                |
| BlockToStepN              | 479.190 us                | 9.332 ms                  |
| OneStep                   | 88.244 ms                 | 603.144 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:19.032606 29232 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
W20240206 20:24:19.580842 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=111, pq.top=111
E20240206 20:24:19.877012 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=3674
W20240206 20:24:20.057616 29232 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end5
W20240206 20:24:20.755944 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=119, pq.top=119
E20240206 20:24:20.877010 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=5576
W20240206 20:24:21.077847 29232 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end3
E20240206 20:24:21.877041 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=3197
W20240206 20:24:21.963958 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=133, pq.top=133
W20240206 20:24:22.175913 29232 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end5
E20240206 20:24:22.877012 29039 parallel_pq_v2.h:79] insert failed, size(hashtable)=30502
W20240206 20:24:23.254033 29232 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 376.474 us                | 4.927 ms                  |
| ProcessBack:Shuffle       | 2.821 ms                  | 16.411 ms                 |
| ProcessBack:UpdateCache   | 2.912 ms                  | 15.027 ms                 |
| ProcessBack:UpsertPq      | 21.515 ms                 | 93.964 ms                 |
| ProcessOneStep            | 52.036 ms                 | 583.333 ms                |
| BlockToStepN              | 566.090 us                | 9.278 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:23.871220 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=149, pq.top=149
E20240206 20:24:23.877009 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=21851
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.855 ms                  | 176.221 ms                |
| Forward                   | 5.606 ms                  | 11.488 ms                 |
| Backward                  | 5.283 ms                  | 12.474 ms                 |
| Optimize                  | 2.551 ms                  | 25.357 ms                 |
| BarrierTimeBeforeRank0    | 4.175 ms                  | 72.830 ms                 |
| AfterBackward             | 52.585 ms                 | 583.365 ms                |
| BlockToStepN              | 663.610 us                | 9.332 ms                  |
| OneStep                   | 89.850 ms                 | 603.144 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:24.446296 29232 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
E20240206 20:24:24.778957 29039 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=157, sample_step_cpp_seen_[rank]=156
E20240206 20:24:24.877008 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=217
W20240206 20:24:25.335688 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=159, pq.top=159
W20240206 20:24:25.481779 29232 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end1
E20240206 20:24:25.877009 29039 parallel_pq_v2.h:79] insert failed, size(hashtable)=3643
W20240206 20:24:26.421891 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=171, pq.top=171
W20240206 20:24:26.619968 29232 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end5
E20240206 20:24:26.877123 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=32771
W20240206 20:24:27.523830 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=185, pq.top=185
W20240206 20:24:27.656590 29232 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end7
E20240206 20:24:27.877013 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=10911
W20240206 20:24:28.535526 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=196, pq.top=195
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 318.903 us                | 9.185 ms                  |
| ProcessBack:Shuffle       | 2.817 ms                  | 7.230 ms                  |
| ProcessBack:UpdateCache   | 2.983 ms                  | 6.486 ms                  |
| ProcessBack:UpsertPq      | 19.723 ms                 | 97.435 ms                 |
| ProcessOneStep            | 52.036 ms                 | 533.119 ms                |
| BlockToStepN              | 959.720 us                | 25.651 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:28.698925 29232 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end8
E20240206 20:24:28.877012 29039 parallel_pq_v2.h:79] insert failed, size(hashtable)=10080
[proc 3] 200 steps, total: 10.335, sample: 0.945, forward: 0.503, backward: 0.627, update: 0.196
[proc 2] 200 steps, total: 10.335, sample: 1.643, forward: 0.611, backward: 0.771, update: 0.270
[proc 0] 200 steps, total: 10.334, sample: 1.362, forward: 0.589, backward: 0.496, update: 0.318
[proc 1] 200 steps, total: 10.335, sample: 1.321, forward: 0.465, backward: 0.559, update: 0.211
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.546 ms                  | 126.467 ms                |
| Forward                   | 5.605 ms                  | 11.215 ms                 |
| Backward                  | 5.099 ms                  | 12.224 ms                 |
| Optimize                  | 2.564 ms                  | 16.351 ms                 |
| BarrierTimeBeforeRank0    | 2.244 ms                  | 63.567 ms                 |
| AfterBackward             | 51.333 ms                 | 533.156 ms                |
| BlockToStepN              | 1.026 ms                  | 25.704 ms                 |
| OneStep                   | 87.915 ms                 | 560.335 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:29.670295 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=211, pq.top=211
E20240206 20:24:29.802583 29039 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=213, sample_step_cpp_seen_[rank]=212
W20240206 20:24:29.822494 29232 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240206 20:24:29.877007 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=13946
W20240206 20:24:30.685482 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=225, pq.top=225
W20240206 20:24:30.828151 29232 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
E20240206 20:24:30.877013 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=7387
W20240206 20:24:31.725415 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=235, pq.top=235
E20240206 20:24:31.877010 28869 parallel_pq_v2.h:79] insert failed, size(hashtable)=2314
W20240206 20:24:31.904956 29232 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end8
W20240206 20:24:32.869701 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=245, pq.top=245
E20240206 20:24:32.877107 29242 parallel_pq_v2.h:79] insert failed, size(hashtable)=32164
W20240206 20:24:32.921306 29232 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 301.480 us                | 6.510 ms                  |
| ProcessBack:Shuffle       | 2.775 ms                  | 7.168 ms                  |
| ProcessBack:UpdateCache   | 3.079 ms                  | 6.170 ms                  |
| ProcessBack:UpsertPq      | 18.019 ms                 | 96.569 ms                 |
| ProcessOneStep            | 49.659 ms                 | 495.284 ms                |
| BlockToStepN              | 1.052 ms                  | 29.430 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:33.878367 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.788 ms                  | 113.627 ms                |
| Forward                   | 5.340 ms                  | 11.099 ms                 |
| Backward                  | 5.128 ms                  | 11.069 ms                 |
| Optimize                  | 2.431 ms                  | 16.138 ms                 |
| BarrierTimeBeforeRank0    | 1.994 ms                  | 54.519 ms                 |
| AfterBackward             | 49.675 ms                 | 495.321 ms                |
| BlockToStepN              | 1.142 ms                  | 29.491 ms                 |
| OneStep                   | 83.029 ms                 | 530.935 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:33.902493 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=260, pq.top=260
W20240206 20:24:33.941378 29232 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
E20240206 20:24:34.878038 29240 parallel_pq_v2.h:79] insert failed, size(hashtable)=21246
W20240206 20:24:35.007038 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=269, pq.top=269
W20240206 20:24:35.011333 29232 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
E20240206 20:24:35.878012 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=4982
W20240206 20:24:36.085291 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=281, pq.top=281
W20240206 20:24:36.192672 29232 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
E20240206 20:24:36.673157 28869 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=288, sample_step_cpp_seen_[rank]=287
E20240206 20:24:36.878010 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=4
W20240206 20:24:37.227862 29232 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
E20240206 20:24:37.878008 28869 parallel_pq_v2.h:79] insert failed, size(hashtable)=1678
W20240206 20:24:37.890189 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=299, pq.top=299
[proc 3] 300 steps, total: 9.055, sample: 1.307, forward: 0.569, backward: 0.562, update: 0.242
[proc 0] 300 steps, total: 9.055, sample: 0.849, forward: 0.505, backward: 0.543, update: 0.252
[proc 1] 300 steps, total: 9.055, sample: 0.980, forward: 0.456, backward: 0.698, update: 0.224
[proc 2] 300 steps, total: 9.055, sample: 1.036, forward: 0.555, backward: 0.771, update: 0.232
W20240206 20:24:38.329984 29232 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 364.004 us                | 18.539 ms                 |
| ProcessBack:Shuffle       | 2.765 ms                  | 6.907 ms                  |
| ProcessBack:UpdateCache   | 3.082 ms                  | 5.827 ms                  |
| ProcessBack:UpsertPq      | 16.364 ms                 | 93.964 ms                 |
| ProcessOneStep            | 48.464 ms                 | 495.284 ms                |
| BlockToStepN              | 1.163 ms                  | 32.876 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:38.878556 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=29477
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.276 ms                  | 113.627 ms                |
| Forward                   | 5.300 ms                  | 11.099 ms                 |
| Backward                  | 5.102 ms                  | 11.069 ms                 |
| Optimize                  | 2.392 ms                  | 16.138 ms                 |
| BarrierTimeBeforeRank0    | 2.301 ms                  | 72.830 ms                 |
| AfterBackward             | 48.517 ms                 | 495.321 ms                |
| BlockToStepN              | 1.246 ms                  | 32.951 ms                 |
| OneStep                   | 82.810 ms                 | 530.935 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:38.923882 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=312, pq.top=311
W20240206 20:24:39.476884 29232 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240206 20:24:39.890851 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 20:24:40.282805 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=324, pq.top=324
W20240206 20:24:40.564750 29232 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
E20240206 20:24:40.890260 28869 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240206 20:24:41.284567 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=338, pq.top=338
W20240206 20:24:41.573212 29232 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
E20240206 20:24:41.891183 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=12562
W20240206 20:24:42.284307 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=349, pq.top=349
W20240206 20:24:42.589010 29232 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end4
E20240206 20:24:42.891011 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=22495
W20240206 20:24:43.529961 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=365, pq.top=365
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 410.346 us                | 29.037 ms                 |
| ProcessBack:Shuffle       | 2.747 ms                  | 7.230 ms                  |
| ProcessBack:UpdateCache   | 2.997 ms                  | 5.246 ms                  |
| ProcessBack:UpsertPq      | 15.419 ms                 | 92.296 ms                 |
| ProcessOneStep            | 46.511 ms                 | 463.106 ms                |
| BlockToStepN              | 1.261 ms                  | 42.938 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:43.749439 29232 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
E20240206 20:24:43.891008 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=40551
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.951 ms                  | 113.154 ms                |
| Forward                   | 5.355 ms                  | 10.683 ms                 |
| Backward                  | 5.091 ms                  | 11.069 ms                 |
| Optimize                  | 2.388 ms                  | 10.950 ms                 |
| BarrierTimeBeforeRank0    | 2.213 ms                  | 67.214 ms                 |
| AfterBackward             | 46.427 ms                 | 463.138 ms                |
| BlockToStepN              | 1.335 ms                  | 43.066 ms                 |
| OneStep                   | 81.660 ms                 | 530.087 ms                |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:44.053078 29039 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=371, sample_step_cpp_seen_[rank]=370
W20240206 20:24:44.572516 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=375, pq.top=375
W20240206 20:24:44.831645 29232 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end9
E20240206 20:24:44.891012 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=10784
W20240206 20:24:45.606315 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=390, pq.top=390
E20240206 20:24:45.891013 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=42567
W20240206 20:24:46.054842 29232 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
[proc 0] 400 steps, total: 8.625, sample: 0.861, forward: 0.558, backward: 0.595, update: 0.251
[proc 2] 400 steps, total: 8.625, sample: 0.974, forward: 0.524, backward: 0.496, update: 0.227
[proc 1] 400 steps, total: 8.625, sample: 1.051, forward: 0.443, backward: 0.697, update: 0.195
[proc 3] 400 steps, total: 8.625, sample: 0.932, forward: 0.490, backward: 0.501, update: 0.221
W20240206 20:24:46.620158 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=401, pq.top=401
E20240206 20:24:46.891008 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=10782
W20240206 20:24:47.151687 29232 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
W20240206 20:24:47.768884 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=409, pq.top=409
E20240206 20:24:47.891014 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=54889
W20240206 20:24:48.262110 29232 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 367.330 us                | 19.999 ms                 |
| ProcessBack:Shuffle       | 2.735 ms                  | 7.408 ms                  |
| ProcessBack:UpdateCache   | 2.959 ms                  | 5.013 ms                  |
| ProcessBack:UpsertPq      | 14.985 ms                 | 90.769 ms                 |
| ProcessOneStep            | 45.283 ms                 | 463.106 ms                |
| BlockToStepN              | 1.424 ms                  | 53.531 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:48.793469 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=423, pq.top=423
E20240206 20:24:48.891036 29265 parallel_pq_v2.h:79] insert failed, size(hashtable)=7563
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.797 ms                  | 113.154 ms                |
| Forward                   | 5.327 ms                  | 11.099 ms                 |
| Backward                  | 5.077 ms                  | 11.069 ms                 |
| Optimize                  | 2.372 ms                  | 16.138 ms                 |
| BarrierTimeBeforeRank0    | 1.994 ms                  | 72.830 ms                 |
| AfterBackward             | 45.091 ms                 | 463.138 ms                |
| BlockToStepN              | 1.506 ms                  | 53.648 ms                 |
| OneStep                   | 80.985 ms                 | 530.087 ms                |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:49.053009 28869 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=426, sample_step_cpp_seen_[rank]=425
W20240206 20:24:49.294764 29232 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
E20240206 20:24:49.891022 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=39629
W20240206 20:24:49.958715 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=435, pq.top=435
W20240206 20:24:50.367516 29232 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
E20240206 20:24:50.891010 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=6468
W20240206 20:24:51.386888 29232 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
E20240206 20:24:51.891010 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=6344
W20240206 20:24:52.316176 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=459, pq.top=459
W20240206 20:24:52.454633 29232 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
E20240206 20:24:52.891008 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=138561
W20240206 20:24:53.474182 29232 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 398.086 us                | 7.223 ms                  |
| ProcessBack:Shuffle       | 2.720 ms                  | 7.408 ms                  |
| ProcessBack:UpdateCache   | 2.869 ms                  | 4.732 ms                  |
| ProcessBack:UpsertPq      | 14.746 ms                 | 90.769 ms                 |
| ProcessOneStep            | 45.283 ms                 | 459.398 ms                |
| BlockToStepN              | 1.593 ms                  | 53.531 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240206 20:24:53.891026 29253 parallel_pq_v2.h:79] insert failed, size(hashtable)=55194
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.620 ms                  | 109.832 ms                |
| Forward                   | 5.340 ms                  | 10.683 ms                 |
| Backward                  | 5.231 ms                  | 10.971 ms                 |
| Optimize                  | 2.372 ms                  | 10.950 ms                 |
| BarrierTimeBeforeRank0    | 1.818 ms                  | 71.701 ms                 |
| AfterBackward             | 45.465 ms                 | 459.431 ms                |
| BlockToStepN              | 1.665 ms                  | 53.648 ms                 |
| OneStep                   | 80.162 ms                 | 515.225 ms                |
+---------------------------+---------------------------+---------------------------+
W20240206 20:24:53.903492 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=475, pq.top=475
W20240206 20:24:54.546363 29232 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
E20240206 20:24:54.891012 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=1117
W20240206 20:24:54.959745 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=487, pq.top=487
W20240206 20:24:55.597086 29232 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
E20240206 20:24:55.888111 29039 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=497, sample_step_cpp_seen_[rank]=496
E20240206 20:24:55.891013 29232 parallel_pq_v2.h:79] insert failed, size(hashtable)=716
W20240206 20:24:56.326992 28869 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=498, pq.top=498
[proc 0] 500 steps, total: 9.936, sample: 0.794, forward: 0.532, backward: 0.704, update: 0.258
[proc 3] 500 steps, total: 9.936, sample: 1.374, forward: 0.527, backward: 0.791, update: 0.233
[proc 2] 500 steps, total: 9.936, sample: 0.943, forward: 0.504, backward: 0.449, update: 0.205
[proc 1] 500 steps, total: 9.936, sample: 0.857, forward: 0.486, backward: 0.610, update: 0.198
Successfully xmh. training takes 51.6381311416626 seconds
before call kg_cache_controller.StopThreads()
W20240206 20:24:56.501392 28869 grad_async_v2.h:84] call StopThreads. PID = 27609
W20240206 20:24:56.501422 28869 grad_base.h:212] before processOneStepNegThread_.join();
W20240206 20:24:56.501639 28869 grad_base.h:214] after processOneStepNegThread_.join();
W20240206 20:24:56.501650 28869 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240206 20:24:56.559551 28869 grad_async_v2.h:105] StopThreads done.

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240206 01:42:30.730068 30092 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_129', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=3, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=3, gpu=[0, 1, 2], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [30092 sampler.py:454] Start PreSampling
WARNING [30092 sampler.py:532] Before construct renumbering_dict
WARNING [30092 sampler.py:555] PreSampling done
W20240206 02:00:48.412333 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240206 02:00:48.412534 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240206 02:00:48.412575 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240206 02:00:48.412611 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240206 02:00:48.412645 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240206 02:00:48.412678 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240206 02:00:48.412710 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240206 02:00:48.412752 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240206 02:00:48.412787 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240206 02:00:48.412823 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240206 02:00:48.412865 30092 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240206 02:00:48.412895 30092 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240206 02:00:48.412931 30092 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240206 02:00:48.413070 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240206 02:00:48.413111 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240206 02:00:48.413141 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240206 02:00:48.413184 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240206 02:00:48.413218 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240206 02:00:48.413247 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240206 02:00:48.413280 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240206 02:00:48.413309 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240206 02:00:48.413347 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240206 02:00:48.413386 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240206 02:00:48.413414 30092 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240206 02:00:48.413437 30092 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240206 02:00:48.413460 30092 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240206 02:00:48.413516 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240206 02:00:48.413549 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240206 02:00:48.413580 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240206 02:00:48.413611 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240206 02:00:48.413646 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240206 02:00:48.413676 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240206 02:00:48.413718 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240206 02:00:48.413753 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240206 02:00:48.413789 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240206 02:00:48.413818 30092 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240206 02:00:48.413851 30092 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240206 02:00:48.413874 30092 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240206 02:00:48.413897 30092 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240206 02:00:48.834600 30092 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10000e52e000 128.2 GB
W20240206 02:09:25.811587 30092 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10201d166000 328.3 MB
{0: Graph(num_nodes=32806815, num_edges=98289586,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=31756927, num_edges=120802495,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=32681333, num_edges=137186093,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 32806815 N 98289586 E
MertisPartition: part 1 has 31756927 N 120802495 E
MertisPartition: part 2 has 32681333 N 137186093 E
Rank0: cached key size 1434235
Rank1: cached key size 1434235
Rank2: cached key size 1434235
Before renumbering graph:  {'_ID': tensor([     196,      197,      239,  ..., 85907466, 77843586,   627118]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4307450,  4307479,  4308496,  ..., 85328270, 85114686, 19979745]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2120.232 seconds
[Rank1] pid = 32242
INFO [30092 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [32242 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [32339 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [32339 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [32242 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [30092 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
WARNING [30092 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [32339 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [32242 DistTensor.py:59] The tensor name already exists in the kvstore
I20240206 02:18:06.291719 32243 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 3
I20240206 02:18:06.292040 32403 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
I20240206 02:18:06.292248 32340 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
E20240206 02:18:07.665688 32340 recstore.cc:66] init folly done
E20240206 02:18:07.665776 32403 recstore.cc:66] init folly done
E20240206 02:18:07.665779 32243 recstore.cc:66] init folly done
I20240206 02:18:21.887285 32340 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 3
I20240206 02:18:25.115253 32243 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
I20240206 02:18:27.590795 32403 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 11.877 ms                 | 100.824 ms                |
| bucket keys               | 1.867 ms                  | 135.037 ms                |
| forward: a2a keys         | 1.597 ms                  | 743.232 ms                |
| forward: search cache     | 180.401 us                | 19.796 ms                 |
| forward: a2a values       | 1.767 ms                  | 14.339 ms                 |
| forward: join             | 1.316 ms                  | 2.875 ms                  |
| Forward                   | 28.626 ms                 | 1.453 s                   |
| back: aggr dram keys      | 42.666 ms                 | 351.399 ms                |
| back: set dram grad       | 4.534 ms                  | 7.965 ms                  |
| back: a2a grad            | 5.013 ms                  | 30.238 ms                 |
| back: grad sum & grad cache  | 1.709 ms                  | 26.030 ms                 |
| Backward                  | 102.698 ms                | 598.441 ms                |
| Optimize                  | 18.415 ms                 | 41.797 ms                 |
| BarrierTimeBeforeRank0    | 45.688 us                 | 75.185 us                 |
| BlockToStepN              | 18.978 us                 | 22.012 us                 |
| OneStep                   | 178.109 ms                | 2.091 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.215 ms                  | 100.824 ms                |
| bucket keys               | 2.323 ms                  | 3.562 ms                  |
| forward: a2a keys         | 1.442 ms                  | 27.412 ms                 |
| forward: search cache     | 175.202 us                | 235.178 us                |
| forward: a2a values       | 7.130 ms                  | 19.358 ms                 |
| forward: join             | 1.316 ms                  | 2.869 ms                  |
| Forward                   | 27.554 ms                 | 1.453 s                   |
| back: aggr dram keys      | 21.747 ms                 | 71.707 ms                 |
| back: set dram grad       | 4.429 ms                  | 7.922 ms                  |
| back: a2a grad            | 5.013 ms                  | 30.238 ms                 |
| back: grad sum & grad cache  | 1.772 ms                  | 26.030 ms                 |
| Backward                  | 102.459 ms                | 598.441 ms                |
| Optimize                  | 15.807 ms                 | 41.797 ms                 |
| BarrierTimeBeforeRank0    | 43.493 us                 | 75.185 us                 |
| BlockToStepN              | 20.169 us                 | 33.066 us                 |
| OneStep                   | 154.450 ms                | 2.091 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.827 ms                  | 94.312 ms                 |
| bucket keys               | 2.090 ms                  | 4.257 ms                  |
| forward: a2a keys         | 1.284 ms                  | 45.249 ms                 |
| forward: search cache     | 174.791 us                | 4.245 ms                  |
| forward: a2a values       | 1.915 ms                  | 19.358 ms                 |
| forward: join             | 1.316 ms                  | 2.875 ms                  |
| Forward                   | 27.554 ms                 | 84.744 ms                 |
| back: aggr dram keys      | 29.933 ms                 | 71.707 ms                 |
| back: set dram grad       | 4.241 ms                  | 7.922 ms                  |
| back: a2a grad            | 8.177 ms                  | 30.238 ms                 |
| back: grad sum & grad cache  | 1.795 ms                  | 26.030 ms                 |
| Backward                  | 102.140 ms                | 158.716 ms                |
| Optimize                  | 15.684 ms                 | 34.198 ms                 |
| BarrierTimeBeforeRank0    | 40.722 us                 | 73.995 us                 |
| BlockToStepN              | 20.484 us                 | 12.482 ms                 |
| OneStep                   | 154.210 ms                | 318.809 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.988 ms                  | 94.312 ms                 |
| bucket keys               | 2.090 ms                  | 4.195 ms                  |
| forward: a2a keys         | 1.428 ms                  | 46.375 ms                 |
| forward: search cache     | 175.871 us                | 254.930 us                |
| forward: a2a values       | 1.915 ms                  | 14.339 ms                 |
| forward: join             | 1.316 ms                  | 2.875 ms                  |
| Forward                   | 27.750 ms                 | 94.288 ms                 |
| back: aggr dram keys      | 29.933 ms                 | 69.974 ms                 |
| back: set dram grad       | 4.241 ms                  | 5.939 ms                  |
| back: a2a grad            | 8.177 ms                  | 28.758 ms                 |
| back: grad sum & grad cache  | 1.795 ms                  | 24.974 ms                 |
| Backward                  | 102.034 ms                | 158.716 ms                |
| Optimize                  | 15.558 ms                 | 34.198 ms                 |
| BarrierTimeBeforeRank0    | 39.771 us                 | 73.995 us                 |
| BlockToStepN              | 19.779 us                 | 13.010 ms                 |
| OneStep                   | 153.475 ms                | 318.809 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 21.188, sample: 1.355, forward: 5.435, backward: 8.732, update: 0.384
[Rank2] pid = 32339
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121)]
train_sampler.Prefill()
-------Step 0-------
tensor([  356938,    44658,   356966, 15276018,   356996,   357020,     2270,
         1248102,   948934,   357048]) tensor([ 6893273, 42780401, 23985938, 70794337, 25097658,   378009, 54252656,
        19633346, 57696851, 40716422])
-------Step 1-------
tensor([  356938,    44658,   356966, 15276018,   356996,   357020,     2270,
         1248102,   948934,   357048]) tensor([63028410, 19572058,  4598828, 63703951, 64261938, 40649433, 22134304,
        19730076,  1686550, 30197213])
-------Step 2-------
tensor([421353, 421379,   2483, 957729, 421401, 421426, 421454, 502179, 421478,
        421500]) tensor([23157392, 48634233, 82300176, 50665658, 20651668, 34480706, 28103936,
        35418993, 56987819, 78330009])
-------Step 3-------
tensor([421353, 421379,   2483, 957729, 421401, 421426, 421454, 502179, 421478,
        421500]) tensor([69052690,   876020, 54148439, 11905923, 66256695, 10354514, 12219412,
        84191509, 66586841, 72725780])
-------Step 4-------
tensor([  486510,   486525,   338637,   486547,  1257312,   486563, 17504267,
          486585,   486607,   486635]) tensor([37413825, 66379253,  9398412, 76023878, 61574375, 85767539, 13898946,
        30857783,  8268391, 22646451])
-------Step 5-------
tensor([  486510,   486525,   338637,   486547,  1257312,   486563, 17504267,
          486585,   486607,   486635]) tensor([47185720, 58376822, 34881421, 56161821, 11201140, 69613740, 42185080,
        25013487,  1217913, 40536991])
-------Step 6-------
tensor([  550054,   550073,   550097,  1261869, 17504267,   550125,   550140,
          550162,   550185,       53]) tensor([44112976, 12198930, 73657999, 20855460,   622306, 39089748, 18670407,
         8563172,   436545, 32865681])
-------Step 7-------
tensor([  550054,   550073,   550097,  1261869, 17504267,   550125,   550140,
          550162,   550185,       53]) tensor([47004552, 37201806, 42554285,   343572, 33023773, 57776996, 82651671,
        72262942, 45700163, 29424508])
-------Step 8-------
tensor([  612024,   612055,   612076,   612099,   982008,   612126, 12550541,
          612143,   612165, 12842889]) tensor([75220140, 27536826, 20528778, 18385223, 55628420,  9219546, 71820024,
         1398768, 69970944, 43239387])
-------Step 9-------
tensor([  612024,   612055,   612076,   612099,   982008,   612126, 12550541,
          612143,   612165, 12842889]) tensor([29838843, 39862409, 37694761, 51743508, 55408798, 63467206, 60285006,
        27737109, 72974809, 27213462])
before start barrier
start train
[proc 0] 100 steps, total: 24.416, sample: 1.423, forward: 4.627, backward: 10.903, update: 1.653
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 18.713, sample: 1.404, forward: 5.449, backward: 8.375, update: 0.306
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.810 ms                  | 94.312 ms                 |
| bucket keys               | 2.090 ms                  | 4.195 ms                  |
| forward: a2a keys         | 1.748 ms                  | 69.086 ms                 |
| forward: search cache     | 177.005 us                | 254.930 us                |
| forward: a2a values       | 1.915 ms                  | 13.510 ms                 |
| forward: join             | 1.316 ms                  | 2.875 ms                  |
| Forward                   | 28.138 ms                 | 119.670 ms                |
| back: aggr dram keys      | 29.933 ms                 | 64.631 ms                 |
| back: set dram grad       | 4.241 ms                  | 5.805 ms                  |
| back: a2a grad            | 8.215 ms                  | 28.587 ms                 |
| back: grad sum & grad cache  | 1.873 ms                  | 18.646 ms                 |
| Backward                  | 101.697 ms                | 158.716 ms                |
| Optimize                  | 15.746 ms                 | 40.947 ms                 |
| BarrierTimeBeforeRank0    | 39.466 us                 | 73.995 us                 |
| BlockToStepN              | 19.259 us                 | 13.010 ms                 |
| OneStep                   | 154.802 ms                | 318.809 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.309 ms                  | 89.000 ms                 |
| bucket keys               | 2.090 ms                  | 4.297 ms                  |
| forward: a2a keys         | 1.803 ms                  | 86.365 ms                 |
| forward: search cache     | 178.140 us                | 264.847 us                |
| forward: a2a values       | 2.043 ms                  | 13.510 ms                 |
| forward: join             | 1.316 ms                  | 2.877 ms                  |
| Forward                   | 28.449 ms                 | 117.658 ms                |
| back: aggr dram keys      | 29.933 ms                 | 67.721 ms                 |
| back: set dram grad       | 4.289 ms                  | 7.922 ms                  |
| back: a2a grad            | 8.193 ms                  | 30.238 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 22.393 ms                 |
| Backward                  | 101.299 ms                | 134.061 ms                |
| Optimize                  | 15.800 ms                 | 34.198 ms                 |
| BarrierTimeBeforeRank0    | 39.771 us                 | 73.911 us                 |
| BlockToStepN              | 19.264 us                 | 12.482 ms                 |
| OneStep                   | 154.210 ms                | 318.703 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.272 ms                  | 94.312 ms                 |
| bucket keys               | 2.311 ms                  | 4.297 ms                  |
| forward: a2a keys         | 1.807 ms                  | 78.519 ms                 |
| forward: search cache     | 178.533 us                | 258.955 us                |
| forward: a2a values       | 2.043 ms                  | 11.126 ms                 |
| forward: join             | 1.316 ms                  | 2.899 ms                  |
| Forward                   | 28.330 ms                 | 117.658 ms                |
| back: aggr dram keys      | 29.933 ms                 | 64.631 ms                 |
| back: set dram grad       | 4.293 ms                  | 7.922 ms                  |
| back: a2a grad            | 8.159 ms                  | 28.758 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 22.393 ms                 |
| Backward                  | 100.901 ms                | 134.061 ms                |
| Optimize                  | 15.861 ms                 | 35.283 ms                 |
| BarrierTimeBeforeRank0    | 39.401 us                 | 75.185 us                 |
| BlockToStepN              | 19.259 us                 | 13.010 ms                 |
| OneStep                   | 153.455 ms                | 318.703 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 200 steps, total: 16.879, sample: 1.282, forward: 4.366, backward: 7.810, update: 0.321
[proc 0] 200 steps, total: 16.879, sample: 1.273, forward: 3.680, backward: 10.150, update: 1.681
[proc 1] 200 steps, total: 16.879, sample: 2.056, forward: 3.535, backward: 8.179, update: 0.349
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.382 ms                  | 94.312 ms                 |
| bucket keys               | 2.311 ms                  | 4.297 ms                  |
| forward: a2a keys         | 1.839 ms                  | 92.922 ms                 |
| forward: search cache     | 179.090 us                | 258.955 us                |
| forward: a2a values       | 2.043 ms                  | 11.126 ms                 |
| forward: join             | 1.316 ms                  | 2.926 ms                  |
| Forward                   | 28.205 ms                 | 119.670 ms                |
| back: aggr dram keys      | 30.156 ms                 | 64.865 ms                 |
| back: set dram grad       | 4.293 ms                  | 7.922 ms                  |
| back: a2a grad            | 8.065 ms                  | 28.758 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 22.393 ms                 |
| Backward                  | 100.516 ms                | 134.061 ms                |
| Optimize                  | 15.923 ms                 | 35.283 ms                 |
| BarrierTimeBeforeRank0    | 40.701 us                 | 75.185 us                 |
| BlockToStepN              | 19.237 us                 | 13.010 ms                 |
| OneStep                   | 153.318 ms                | 323.685 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.382 ms                  | 94.312 ms                 |
| bucket keys               | 2.311 ms                  | 4.257 ms                  |
| forward: a2a keys         | 1.931 ms                  | 93.860 ms                 |
| forward: search cache     | 179.306 us                | 256.088 us                |
| forward: a2a values       | 2.043 ms                  | 10.943 ms                 |
| forward: join             | 1.316 ms                  | 2.936 ms                  |
| Forward                   | 28.551 ms                 | 147.998 ms                |
| back: aggr dram keys      | 30.156 ms                 | 64.631 ms                 |
| back: set dram grad       | 4.293 ms                  | 5.939 ms                  |
| back: a2a grad            | 8.097 ms                  | 28.587 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.647 ms                 |
| Backward                  | 100.249 ms                | 134.061 ms                |
| Optimize                  | 15.916 ms                 | 35.789 ms                 |
| BarrierTimeBeforeRank0    | 40.722 us                 | 75.185 us                 |
| BlockToStepN              | 19.208 us                 | 13.010 ms                 |
| OneStep                   | 153.455 ms                | 348.436 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.267 ms                  | 90.943 ms                 |
| bucket keys               | 2.318 ms                  | 4.297 ms                  |
| forward: a2a keys         | 1.939 ms                  | 92.922 ms                 |
| forward: search cache     | 179.620 us                | 256.088 us                |
| forward: a2a values       | 2.043 ms                  | 10.943 ms                 |
| forward: join             | 1.316 ms                  | 2.936 ms                  |
| Forward                   | 28.626 ms                 | 122.612 ms                |
| back: aggr dram keys      | 30.156 ms                 | 61.513 ms                 |
| back: set dram grad       | 4.351 ms                  | 5.805 ms                  |
| back: a2a grad            | 8.065 ms                  | 28.587 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.647 ms                 |
| Backward                  | 99.981 ms                 | 130.356 ms                |
| Optimize                  | 15.949 ms                 | 35.283 ms                 |
| BarrierTimeBeforeRank0    | 41.219 us                 | 75.185 us                 |
| BlockToStepN              | 19.193 us                 | 12.482 ms                 |
| OneStep                   | 152.793 ms                | 323.685 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 300 steps, total: 16.582, sample: 1.117, forward: 3.771, backward: 9.951, update: 1.649
[proc 2] 300 steps, total: 16.582, sample: 1.016, forward: 4.482, backward: 7.728, update: 0.324
[proc 1] 300 steps, total: 16.582, sample: 2.043, forward: 3.415, backward: 8.040, update: 0.381
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.218 ms                  | 90.943 ms                 |
| bucket keys               | 2.318 ms                  | 4.297 ms                  |
| forward: a2a keys         | 1.918 ms                  | 92.922 ms                 |
| forward: search cache     | 179.664 us                | 256.088 us                |
| forward: a2a values       | 2.043 ms                  | 10.943 ms                 |
| forward: join             | 2.626 ms                  | 2.977 ms                  |
| Forward                   | 28.528 ms                 | 122.612 ms                |
| back: aggr dram keys      | 30.156 ms                 | 64.865 ms                 |
| back: set dram grad       | 4.351 ms                  | 5.939 ms                  |
| back: a2a grad            | 8.084 ms                  | 28.587 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.647 ms                 |
| Backward                  | 99.587 ms                 | 134.061 ms                |
| Optimize                  | 15.980 ms                 | 35.283 ms                 |
| BarrierTimeBeforeRank0    | 41.238 us                 | 80.077 us                 |
| BlockToStepN              | 19.259 us                 | 12.482 ms                 |
| OneStep                   | 152.648 ms                | 323.685 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.272 ms                  | 92.458 ms                 |
| bucket keys               | 2.319 ms                  | 4.297 ms                  |
| forward: a2a keys         | 1.902 ms                  | 87.495 ms                 |
| forward: search cache     | 179.712 us                | 256.088 us                |
| forward: a2a values       | 2.043 ms                  | 10.943 ms                 |
| forward: join             | 2.626 ms                  | 2.977 ms                  |
| Forward                   | 28.164 ms                 | 122.612 ms                |
| back: aggr dram keys      | 33.232 ms                 | 64.631 ms                 |
| back: set dram grad       | 4.351 ms                  | 5.805 ms                  |
| back: a2a grad            | 8.097 ms                  | 26.384 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.540 ms                 |
| Backward                  | 99.302 ms                 | 134.061 ms                |
| Optimize                  | 15.970 ms                 | 35.283 ms                 |
| BarrierTimeBeforeRank0    | 41.238 us                 | 80.077 us                 |
| BlockToStepN              | 19.174 us                 | 12.526 ms                 |
| OneStep                   | 152.301 ms                | 323.685 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.272 ms                  | 90.943 ms                 |
| bucket keys               | 2.320 ms                  | 4.297 ms                  |
| forward: a2a keys         | 1.915 ms                  | 92.922 ms                 |
| forward: search cache     | 179.637 us                | 259.499 us                |
| forward: a2a values       | 2.043 ms                  | 10.943 ms                 |
| forward: join             | 2.626 ms                  | 2.981 ms                  |
| Forward                   | 28.291 ms                 | 122.612 ms                |
| back: aggr dram keys      | 30.156 ms                 | 64.865 ms                 |
| back: set dram grad       | 4.351 ms                  | 5.805 ms                  |
| back: a2a grad            | 8.097 ms                  | 26.384 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.540 ms                 |
| Backward                  | 99.240 ms                 | 130.356 ms                |
| Optimize                  | 15.971 ms                 | 34.198 ms                 |
| BarrierTimeBeforeRank0    | 41.166 us                 | 75.185 us                 |
| BlockToStepN              | 19.131 us                 | 12.482 ms                 |
| OneStep                   | 152.157 ms                | 323.685 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 16.411, sample: 1.103, forward: 4.119, backward: 7.824, update: 0.354
[proc 0] 400 steps, total: 16.411, sample: 1.145, forward: 3.534, backward: 9.983, update: 1.632
[proc 1] 400 steps, total: 16.411, sample: 1.811, forward: 3.371, backward: 8.123, update: 0.385
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.179 ms                  | 91.765 ms                 |
| bucket keys               | 2.320 ms                  | 4.292 ms                  |
| forward: a2a keys         | 1.919 ms                  | 93.691 ms                 |
| forward: search cache     | 179.569 us                | 258.955 us                |
| forward: a2a values       | 2.043 ms                  | 10.350 ms                 |
| forward: join             | 2.626 ms                  | 2.981 ms                  |
| Forward                   | 28.323 ms                 | 122.905 ms                |
| back: aggr dram keys      | 30.156 ms                 | 64.631 ms                 |
| back: set dram grad       | 4.363 ms                  | 5.622 ms                  |
| back: a2a grad            | 8.097 ms                  | 26.384 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.647 ms                 |
| Backward                  | 99.111 ms                 | 134.061 ms                |
| Optimize                  | 15.983 ms                 | 34.198 ms                 |
| BarrierTimeBeforeRank0    | 41.166 us                 | 75.185 us                 |
| BlockToStepN              | 19.193 us                 | 12.526 ms                 |
| OneStep                   | 151.942 ms                | 325.396 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.160 ms                  | 91.765 ms                 |
| bucket keys               | 2.320 ms                  | 4.257 ms                  |
| forward: a2a keys         | 1.913 ms                  | 92.922 ms                 |
| forward: search cache     | 179.620 us                | 256.088 us                |
| forward: a2a values       | 2.043 ms                  | 10.350 ms                 |
| forward: join             | 2.626 ms                  | 2.977 ms                  |
| Forward                   | 28.318 ms                 | 122.905 ms                |
| back: aggr dram keys      | 30.156 ms                 | 64.317 ms                 |
| back: set dram grad       | 4.363 ms                  | 5.604 ms                  |
| back: a2a grad            | 8.097 ms                  | 26.219 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.540 ms                 |
| Backward                  | 98.911 ms                 | 134.061 ms                |
| Optimize                  | 16.010 ms                 | 34.198 ms                 |
| BarrierTimeBeforeRank0    | 41.148 us                 | 75.185 us                 |
| BlockToStepN              | 19.193 us                 | 12.526 ms                 |
| OneStep                   | 151.931 ms                | 325.396 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.179 ms                  | 90.943 ms                 |
| bucket keys               | 2.320 ms                  | 4.257 ms                  |
| forward: a2a keys         | 1.902 ms                  | 92.922 ms                 |
| forward: search cache     | 179.523 us                | 256.088 us                |
| forward: a2a values       | 2.043 ms                  | 10.350 ms                 |
| forward: join             | 2.626 ms                  | 2.977 ms                  |
| Forward                   | 28.119 ms                 | 122.612 ms                |
| back: aggr dram keys      | 30.156 ms                 | 64.317 ms                 |
| back: set dram grad       | 4.363 ms                  | 5.604 ms                  |
| back: a2a grad            | 8.084 ms                  | 26.384 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.540 ms                 |
| Backward                  | 98.687 ms                 | 130.356 ms                |
| Optimize                  | 16.018 ms                 | 32.843 ms                 |
| BarrierTimeBeforeRank0    | 41.166 us                 | 80.077 us                 |
| BlockToStepN              | 19.194 us                 | 12.482 ms                 |
| OneStep                   | 151.662 ms                | 323.685 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.195 ms                  | 90.943 ms                 |
| bucket keys               | 2.320 ms                  | 4.246 ms                  |
| forward: a2a keys         | 1.908 ms                  | 87.495 ms                 |
| forward: search cache     | 179.418 us                | 256.088 us                |
| forward: a2a values       | 2.043 ms                  | 9.024 ms                  |
| forward: join             | 2.626 ms                  | 2.974 ms                  |
| Forward                   | 28.090 ms                 | 122.612 ms                |
| back: aggr dram keys      | 29.933 ms                 | 64.317 ms                 |
| back: set dram grad       | 4.341 ms                  | 5.517 ms                  |
| back: a2a grad            | 8.084 ms                  | 26.219 ms                 |
| back: grad sum & grad cache  | 4.779 ms                  | 19.540 ms                 |
| Backward                  | 98.592 ms                 | 130.356 ms                |
| Optimize                  | 16.001 ms                 | 32.843 ms                 |
| BarrierTimeBeforeRank0    | 41.166 us                 | 82.248 us                 |
| BlockToStepN              | 19.174 us                 | 12.482 ms                 |
| OneStep                   | 151.320 ms                | 323.685 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 16.034, sample: 0.900, forward: 4.035, backward: 7.710, update: 0.317
[proc 1] 500 steps, total: 16.034, sample: 1.612, forward: 3.284, backward: 8.044, update: 0.386
[proc 0] 500 steps, total: 16.034, sample: 1.156, forward: 3.300, backward: 9.830, update: 1.644
Successfully xmh. training takes 90.32310700416565 seconds
before call kg_cache_controller.StopThreads()
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads
INFO [30092 controller_process.py:421] call rank0 to StopThreads

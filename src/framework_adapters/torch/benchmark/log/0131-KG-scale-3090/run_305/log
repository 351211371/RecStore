WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240210 12:47:19.859918 13131 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_206', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [13131 sampler.py:454] Start PreSampling
WARNING [13131 sampler.py:532] Before construct renumbering_dict
WARNING [13131 sampler.py:555] PreSampling done
W20240210 12:47:24.774359 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240210 12:47:24.774605 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240210 12:47:24.774643 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240210 12:47:24.774668 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240210 12:47:24.774694 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240210 12:47:24.774729 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240210 12:47:24.774760 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240210 12:47:24.774798 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240210 12:47:24.774834 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240210 12:47:24.774875 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240210 12:47:24.774940 13131 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240210 12:47:24.774967 13131 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240210 12:47:24.774992 13131 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240210 12:47:24.775132 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240210 12:47:24.775180 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240210 12:47:24.775204 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240210 12:47:24.775251 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240210 12:47:24.775286 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240210 12:47:24.775313 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240210 12:47:24.775363 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240210 12:47:24.775401 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240210 12:47:24.775434 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240210 12:47:24.775467 13131 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240210 12:47:24.775516 13131 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240210 12:47:24.775538 13131 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240210 12:47:24.775566 13131 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240210 12:47:25.016908 13131 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000098ca000 22.81 MB
W20240210 12:47:25.109117 13131 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000af9c000 58.4 kB
{0: Graph(num_nodes=13804, num_edges=289155,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12626, num_edges=379866,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13804 N 289155 E
MertisPartition: part 1 has 12626 N 379866 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  757,   824,   908,  ..., 11996, 13003, 10269]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.349 seconds
INFO [13131 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [13131 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [14003 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [14003 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240210 12:47:25.815888 14005 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240210 12:47:25.817667 14004 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240210 12:47:25.843930 14004 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10000afae000 7.629 MB
W20240210 12:47:25.844099 14004 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x10000b751000 7.629 MB
W20240210 12:47:25.844151 14004 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10000bef4000 1.49 GB
W20240210 12:47:25.844210 14004 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10006b4d7000 1.49 GB
W20240210 12:47:25.844275 14004 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240210 12:47:25.846016 14004 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240210 12:47:25.852720 14005 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1000caac0000 7.629 MB
W20240210 12:47:25.852880 14005 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1000cb263000 7.629 MB
W20240210 12:47:25.852941 14005 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000cba06000 1.49 GB
W20240210 12:47:25.853009 14005 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10012afe9000 1.49 GB
W20240210 12:47:25.853076 14005 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240210 12:47:25.855804 14005 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x1000098ca000
1: KnownLocalCachedEmbedding init done
WARNING [14003 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank1] pid = 14003
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
cudaHostRegister 0x1000098ca000
0: KnownLocalCachedEmbedding init done
WARNING [13131 DistTensor.py:59] The tensor name already exists in the kvstore
I20240210 12:47:27.508715 14005 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240210 12:47:27.508899 14004 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240210 12:47:27.510154 14005 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240210 12:47:27.510376 14005 grad_base.h:184] Init GradProcessingBase done
I20240210 12:47:27.515250 14005 grad_async_v2.h:42] Use main thread to update emb.
W20240210 12:47:27.515281 14005 kg_controller.h:78] after init GradAsyncProcessingV2
I20240210 12:47:27.515290 14005 kg_controller.h:84] Construct KGCacheController done
E20240210 12:47:27.783915 14005 recstore.cc:66] init folly done
E20240210 12:47:27.783968 14004 recstore.cc:66] init folly done
I20240210 12:47:27.788537 14005 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240210 12:47:27.954034 14271 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240210 12:47:27.954375 14271 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240210 12:47:28.001637 14005 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240210 12:47:28.029826 14004 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
E20240210 12:47:28.973701 14005 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240210 12:47:28.989936 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240210 12:47:28.996291 14271 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240210 12:47:29.014387 14005 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=1, sample_step_cpp_seen_[rank]=0
E20240210 12:47:29.973058 14178 parallel_pq_v2.h:79] insert failed, size(hashtable)=27
W20240210 12:47:30.009814 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=34, pq.top=34
W20240210 12:47:30.011011 14271 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240210 12:47:30.973040 14272 parallel_pq_v2.h:79] insert failed, size(hashtable)=5169
W20240210 12:47:31.017853 14271 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240210 12:47:31.048646 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=71, pq.top=71
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 3.816, sample: 0.326, forward: 0.949, backward: 0.588, update: 0.161
train_sampler.Prefill()
-------Step 0-------
tensor([  192,  5047,  9007,  8520,  2540, 13677,  4250,  8418,  7845,  7290]) tensor([  933,  8628, 10841, 14149, 14922,  6067,  5649,   401,  5821,  8911])
-------Step 1-------
tensor([  192,  5047,  9007,  8520,  2540, 13677,  4250,  8418,  7845,  7290]) tensor([12526,  1593,  2248,  3956,  7298,  9956,  9446,  8692, 10197,  3777])
-------Step 2-------
tensor([13677,    10,    95,   162,  7191,  7648,  1448, 12962,  7717, 10019]) tensor([ 2140,  2273, 14768, 10477,  5565,  7142, 11902,  2132,  5992,  5068])
-------Step 3-------
tensor([13677,    10,    95,   162,  7191,  7648,  1448, 12962,  7717, 10019]) tensor([13352,  2177,   317,  4988,  6811, 11649,  3002,   848, 14832, 11355])
-------Step 4-------
tensor([ 2732,  2063,   107,  1580,  9407,  7308, 11884,  7779,    87,  5720]) tensor([ 5409, 14489,  8292,  9481, 10536,  5702,  6250,  8269,  5386,  9241])
-------Step 5-------
tensor([ 2732,  2063,   107,  1580,  9407,  7308, 11884,  7779,    87,  5720]) tensor([ 7170,  3360, 10162,  6085,  3817, 11231,    55,   781,  6662,  6974])
-------Step 6-------
tensor([ 7286,  3537,  8272,   350,  1203,   121, 13677,  6670,   330,   289]) tensor([14132, 12776,  7260,  7381,   868,  7136,  4061, 12567, 14872,  8494])
-------Step 7-------
tensor([ 7286,  3537,  8272,   350,  1203,   121, 13677,  6670,   330,   289]) tensor([ 8655,  1964, 14829, 11225, 14721,  9404,  1837,   576,    26,  8373])
-------Step 8-------
tensor([ 4345, 10807,  6525,  2190,  5047,  5273,  7191,  2732, 13997, 11248]) tensor([11960,  7898, 14783,  6062,  5804,  9641,  2269,  7001,  9998, 13898])
-------Step 9-------
tensor([ 4345, 10807,  6525,  2190,  5047,  5273,  7191,  2732, 13997, 11248]) tensor([ 4553,  8668, 12212, 13000, 14231,  3861,  2785,  8692, 13907,  3015])
before start barrier
start train
[proc 0] 100 steps, total: 3.844, sample: 0.383, forward: 1.008, backward: 0.610, update: 0.169
E20240210 12:47:31.973029 14005 parallel_pq_v2.h:79] insert failed, size(hashtable)=423
W20240210 12:47:32.051945 14271 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
W20240210 12:47:32.060662 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=107, pq.top=107
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.503 ms                  | 22.009 ms                 |
| Forward                   | 4.481 ms                  | 12.954 ms                 |
| Backward                  | 4.079 ms                  | 11.090 ms                 |
| Optimize                  | 1.689 ms                  | 3.354 ms                  |
| BarrierTimeBeforeRank0    | 25.507 us                 | 8.270 ms                  |
| AfterBackward             | 12.253 ms                 | 26.921 ms                 |
| BlockToStepN              | 1.209 ms                  | 4.609 ms                  |
| OneStep                   | 26.387 ms                 | 52.466 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 481.395 us                | 4.066 ms                  |
| ProcessBack:Shuffle       | 829.213 us                | 1.300 ms                  |
| ProcessBack:UpdateCache   | 494.096 us                | 930.158 us                |
| ProcessBack:UpsertPq      | 9.031 ms                  | 16.926 ms                 |
| ProcessOneStep            | 12.216 ms                 | 26.886 ms                 |
| BlockToStepN              | 1.288 ms                  | 4.556 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240210 12:47:32.973052 14273 parallel_pq_v2.h:79] insert failed, size(hashtable)=4533
W20240210 12:47:33.051059 14271 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240210 12:47:33.065647 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=142, pq.top=142
E20240210 12:47:33.973033 14302 parallel_pq_v2.h:79] insert failed, size(hashtable)=3486
W20240210 12:47:34.051206 14271 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
W20240210 12:47:34.076154 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=176, pq.top=176
[proc 1] 200 steps, total: 2.960, sample: 0.307, forward: 0.344, backward: 0.397, update: 0.145
[proc 0] 200 steps, total: 2.959, sample: 0.406, forward: 0.439, backward: 0.398, update: 0.162
E20240210 12:47:34.973047 14298 parallel_pq_v2.h:79] insert failed, size(hashtable)=7993
W20240210 12:47:35.058245 14271 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240210 12:47:35.088354 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=210, pq.top=210
E20240210 12:47:35.973158 14005 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240210 12:47:36.071075 14271 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240210 12:47:36.093669 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=244, pq.top=244
E20240210 12:47:36.973057 14278 parallel_pq_v2.h:79] insert failed, size(hashtable)=9466
W20240210 12:47:37.083348 14271 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
W20240210 12:47:37.106180 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=278, pq.top=278
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.597 ms                  | 21.190 ms                 |
| Forward                   | 4.390 ms                  | 9.605 ms                  |
| Backward                  | 4.007 ms                  | 8.896 ms                  |
| Optimize                  | 1.686 ms                  | 3.265 ms                  |
| BarrierTimeBeforeRank0    | 24.625 us                 | 2.744 ms                  |
| AfterBackward             | 12.493 ms                 | 19.323 ms                 |
| BlockToStepN              | 1.952 ms                  | 5.955 ms                  |
| OneStep                   | 27.697 ms                 | 46.619 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 622.215 us                | 5.446 ms                  |
| ProcessBack:Shuffle       | 839.126 us                | 1.414 ms                  |
| ProcessBack:UpdateCache   | 483.897 us                | 828.965 us                |
| ProcessBack:UpsertPq      | 8.793 ms                  | 16.926 ms                 |
| ProcessOneStep            | 12.415 ms                 | 19.292 ms                 |
| BlockToStepN              | 1.904 ms                  | 6.011 ms                  |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 3.036, sample: 0.287, forward: 0.381, backward: 0.430, update: 0.147
[proc 0] 300 steps, total: 3.036, sample: 0.375, forward: 0.424, backward: 0.441, update: 0.159
E20240210 12:47:37.973018 14005 parallel_pq_v2.h:79] insert failed, size(hashtable)=43
W20240210 12:47:38.083163 14271 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
W20240210 12:47:38.127787 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=310, pq.top=310
E20240210 12:47:38.973018 14279 parallel_pq_v2.h:79] insert failed, size(hashtable)=9333
W20240210 12:47:39.083653 14271 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240210 12:47:39.148908 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=343, pq.top=343
E20240210 12:47:39.973075 14271 parallel_pq_v2.h:79] insert failed, size(hashtable)=107
W20240210 12:47:40.099730 14271 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240210 12:47:40.164608 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=376, pq.top=376
[proc 0] 400 steps, total: 3.058, sample: 0.389, forward: 0.427, backward: 0.383, update: 0.153
[proc 1] 400 steps, total: 3.058, sample: 0.314, forward: 0.410, backward: 0.403, update: 0.151
E20240210 12:47:40.973035 14271 parallel_pq_v2.h:79] insert failed, size(hashtable)=109
W20240210 12:47:41.110170 14271 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
W20240210 12:47:41.181407 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=408, pq.top=408
E20240210 12:47:41.974069 14285 parallel_pq_v2.h:79] insert failed, size(hashtable)=8576
W20240210 12:47:42.132261 14271 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
W20240210 12:47:42.200333 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=440, pq.top=440
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.670 ms                  | 21.190 ms                 |
| Forward                   | 4.399 ms                  | 7.330 ms                  |
| Backward                  | 4.004 ms                  | 8.842 ms                  |
| Optimize                  | 1.673 ms                  | 3.138 ms                  |
| BarrierTimeBeforeRank0    | 24.316 us                 | 3.882 ms                  |
| AfterBackward             | 12.457 ms                 | 19.323 ms                 |
| BlockToStepN              | 2.503 ms                  | 7.154 ms                  |
| OneStep                   | 28.322 ms                 | 47.879 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 681.173 us                | 6.066 ms                  |
| ProcessBack:Shuffle       | 839.925 us                | 1.418 ms                  |
| ProcessBack:UpdateCache   | 479.666 us                | 786.045 us                |
| ProcessBack:UpsertPq      | 9.070 ms                  | 15.715 ms                 |
| ProcessOneStep            | 12.469 ms                 | 18.315 ms                 |
| BlockToStepN              | 2.484 ms                  | 7.086 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240210 12:47:42.974037 14286 parallel_pq_v2.h:79] insert failed, size(hashtable)=9009
W20240210 12:47:43.145915 14271 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240210 12:47:43.221521 14005 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=471, pq.top=471
E20240210 12:47:43.975001 14284 parallel_pq_v2.h:79] insert failed, size(hashtable)=9897
W20240210 12:47:44.154925 14271 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
[proc 1] 500 steps, total: 3.284, sample: 0.303, forward: 0.397, backward: 0.413, update: 0.149
[proc 0] 500 steps, total: 3.285, sample: 0.447, forward: 0.435, backward: 0.460, update: 0.155
Successfully xmh. training takes 16.18204164505005 seconds
before call kg_cache_controller.StopThreads()
W20240210 12:47:44.183758 14005 grad_async_v2.h:84] call StopThreads. PID = 13131
W20240210 12:47:44.183804 14005 grad_base.h:212] before processOneStepNegThread_.join();
W20240210 12:47:44.184123 14005 grad_base.h:214] after processOneStepNegThread_.join();
W20240210 12:47:44.184137 14005 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240210 12:47:44.185381 14005 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f50f9668890>
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 661.008 us                | 5.891 ms                  |
| ProcessBack:Shuffle       | 840.804 us                | 1.418 ms                  |
| ProcessBack:UpdateCache   | 480.194 us                | 785.311 us                |
| ProcessBack:UpsertPq      | 9.180 ms                  | 15.981 ms                 |
| ProcessOneStep            | 12.419 ms                 | 19.002 ms                 |
| BlockToStepN              | 2.657 ms                  | 7.239 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240210 12:47:54.644054 13131 HazptrDomain.h:148] Tagged objects remain. This may indicate a higher-level leak of object(s) that use hazptr_obj_cohort.

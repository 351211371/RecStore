WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240213 06:54:50.921720 17518 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_75', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [17518 sampler.py:454] Start PreSampling
WARNING [17518 sampler.py:532] Before construct renumbering_dict
WARNING [17518 sampler.py:555] PreSampling done
W20240213 07:14:04.116138 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240213 07:14:04.116345 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240213 07:14:04.116389 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240213 07:14:04.116418 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240213 07:14:04.116451 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240213 07:14:04.116478 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240213 07:14:04.116515 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240213 07:14:04.116549 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240213 07:14:04.116578 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240213 07:14:04.116612 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240213 07:14:04.116647 17518 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240213 07:14:04.116674 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240213 07:14:04.116699 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240213 07:14:04.116856 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240213 07:14:04.116894 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240213 07:14:04.116920 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240213 07:14:04.116968 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240213 07:14:04.116998 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240213 07:14:04.117038 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240213 07:14:04.117065 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240213 07:14:04.117097 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240213 07:14:04.117126 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240213 07:14:04.117159 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240213 07:14:04.117187 17518 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240213 07:14:04.117208 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240213 07:14:04.117231 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240213 07:14:04.117288 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240213 07:14:04.117329 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240213 07:14:04.117355 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240213 07:14:04.117388 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240213 07:14:04.117421 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240213 07:14:04.117456 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240213 07:14:04.117488 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240213 07:14:04.117523 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240213 07:14:04.117551 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240213 07:14:04.117578 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240213 07:14:04.117609 17518 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240213 07:14:04.117630 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240213 07:14:04.117653 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240213 07:14:04.117713 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240213 07:14:04.117741 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240213 07:14:04.117774 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240213 07:14:04.117806 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240213 07:14:04.117834 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240213 07:14:04.117867 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240213 07:14:04.117895 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240213 07:14:04.117923 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240213 07:14:04.117954 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240213 07:14:04.117982 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240213 07:14:04.118014 17518 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240213 07:14:04.118036 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240213 07:14:04.118062 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240213 07:14:04.118117 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240213 07:14:04.118153 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240213 07:14:04.118180 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240213 07:14:04.118211 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240213 07:14:04.118242 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240213 07:14:04.118281 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240213 07:14:04.118309 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240213 07:14:04.118338 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240213 07:14:04.118379 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240213 07:14:04.118417 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240213 07:14:04.118443 17518 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240213 07:14:04.118464 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240213 07:14:04.118489 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240213 07:14:04.118547 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240213 07:14:04.118577 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240213 07:14:04.118609 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240213 07:14:04.118639 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240213 07:14:04.118666 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240213 07:14:04.118702 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240213 07:14:04.118729 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240213 07:14:04.118760 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240213 07:14:04.118794 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240213 07:14:04.118824 17518 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240213 07:14:04.118857 17518 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240213 07:14:04.118880 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240213 07:14:04.118906 17518 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240213 07:14:04.563779 17518 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10001ca5a000 128.2 GB
W20240213 07:22:44.546547 17518 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10202b692000 328.3 MB
{0: Graph(num_nodes=16391033, num_edges=60554486,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22850318, num_edges=74912573,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16459669, num_edges=67428404,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17554345, num_edges=53272616,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=17824082, num_edges=71836124,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=18730250, num_edges=46391216,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16391033 N 60554486 E
MertisPartition: part 1 has 22850318 N 74912573 E
MertisPartition: part 2 has 16459669 N 67428404 E
MertisPartition: part 3 has 17554345 N 53272616 E
MertisPartition: part 4 has 17824082 N 71836124 E
MertisPartition: part 5 has 18730250 N 46391216 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,       14,  ..., 12367661, 70093925, 61280605]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 4302893,  4302951,   390775,  ..., 45271900, 10590819, 80131875]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2180.956 seconds
[Rank1] pid = 18698
[Rank2] pid = 18794
[Rank3] pid = 18862
[Rank4] pid = 18929
INFO [17518 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [18698 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [18794 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [18862 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [18929 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [18996 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [18862 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [18929 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [18996 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [17518 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [18794 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [18698 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
WARNING [18929 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [18996 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [17518 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [18862 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [18698 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [18794 DistTensor.py:59] The tensor name already exists in the kvstore
I20240213 07:31:31.200807 18795 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240213 07:31:31.201647 19060 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240213 07:31:31.201871 18863 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240213 07:31:31.202072 18930 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240213 07:31:31.202247 18997 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240213 07:31:31.202427 18699 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
E20240213 07:31:31.815649 18795 recstore.cc:66] init folly done
E20240213 07:31:31.815682 18863 recstore.cc:66] init folly done
E20240213 07:31:31.815694 19060 recstore.cc:66] init folly done
E20240213 07:31:31.816007 18930 recstore.cc:66] init folly done
E20240213 07:31:31.818660 18699 recstore.cc:66] init folly done
E20240213 07:31:31.818670 18997 recstore.cc:66] init folly done
I20240213 07:31:38.861423 19060 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240213 07:31:39.754599 18863 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240213 07:31:40.772161 18997 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240213 07:31:41.906263 18795 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240213 07:31:42.569752 18930 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240213 07:31:42.922096 18699 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.911 ms                  | 9.911 ms                  |
| bucket keys               | 116.057 ms                | 116.057 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 12.337 ms                 | 14.136 ms                 |
| bucket keys               | 2.613 ms                  | 116.057 ms                |
| forward: a2a keys         | 3.662 ms                  | 45.732 s                  |
| forward: search cache     | 357.389 us                | 36.344 ms                 |
| forward: a2a values       | 2.748 ms                  | 10.723 ms                 |
| forward: software         | 787.735 us                | 925.541 us                |
| forward: join             | 2.225 ms                  | 3.184 ms                  |
| Forward                   | 37.080 ms                 | 46.178 s                  |
| back: aggr dram keys      | 53.441 ms                 | 727.540 ms                |
| back: set dram grad       | 3.846 ms                  | 5.013 ms                  |
| back: a2a grad            | 5.621 ms                  | 14.765 ms                 |
| back: grad sum & grad cache  | 3.479 ms                  | 155.076 ms                |
| Backward                  | 177.483 ms                | 1.071 s                   |
| Optimize                  | 24.975 ms                 | 56.408 ms                 |
| BarrierTimeBeforeRank0    | 55.126 us                 | 83.159 us                 |
| BlockToStepN              | 25.466 us                 | 49.653 us                 |
| OneStep                   | 263.576 ms                | 47.317 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.962 ms                  | 98.729 ms                 |
| bucket keys               | 2.613 ms                  | 116.057 ms                |
| forward: a2a keys         | 3.450 ms                  | 45.732 s                  |
| forward: search cache     | 358.105 us                | 36.344 ms                 |
| forward: a2a values       | 2.797 ms                  | 12.723 ms                 |
| forward: software         | 787.735 us                | 925.541 us                |
| forward: join             | 2.225 ms                  | 43.574 ms                 |
| Forward                   | 35.211 ms                 | 46.178 s                  |
| back: aggr dram keys      | 20.305 ms                 | 727.540 ms                |
| back: set dram grad       | 1.956 ms                  | 5.067 ms                  |
| back: a2a grad            | 12.322 ms                 | 14.776 ms                 |
| back: grad sum & grad cache  | 4.947 ms                  | 155.076 ms                |
| Backward                  | 155.860 ms                | 1.071 s                   |
| Optimize                  | 26.225 ms                 | 56.408 ms                 |
| BarrierTimeBeforeRank0    | 55.126 us                 | 99.876 us                 |
| BlockToStepN              | 20.479 us                 | 49.653 us                 |
| OneStep                   | 231.757 ms                | 47.317 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.869 ms                  | 98.729 ms                 |
| bucket keys               | 2.615 ms                  | 4.221 ms                  |
| forward: a2a keys         | 3.371 ms                  | 30.039 ms                 |
| forward: search cache     | 356.197 us                | 469.923 us                |
| forward: a2a values       | 3.310 ms                  | 10.723 ms                 |
| forward: software         | 776.291 us                | 836.134 us                |
| forward: join             | 2.225 ms                  | 3.827 ms                  |
| Forward                   | 34.818 ms                 | 46.178 s                  |
| back: aggr dram keys      | 22.532 ms                 | 77.520 ms                 |
| back: set dram grad       | 3.811 ms                  | 5.338 ms                  |
| back: a2a grad            | 13.773 ms                 | 36.269 ms                 |
| back: grad sum & grad cache  | 4.947 ms                  | 91.807 ms                 |
| Backward                  | 156.497 ms                | 1.071 s                   |
| Optimize                  | 25.869 ms                 | 56.408 ms                 |
| BarrierTimeBeforeRank0    | 51.219 us                 | 99.876 us                 |
| BlockToStepN              | 22.078 us                 | 8.903 ms                  |
| OneStep                   | 232.503 ms                | 47.317 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.585 ms                  | 92.997 ms                 |
| bucket keys               | 2.624 ms                  | 4.231 ms                  |
| forward: a2a keys         | 3.320 ms                  | 37.508 ms                 |
| forward: search cache     | 355.482 us                | 469.923 us                |
| forward: a2a values       | 3.310 ms                  | 12.723 ms                 |
| forward: software         | 776.291 us                | 836.134 us                |
| forward: join             | 2.225 ms                  | 3.827 ms                  |
| Forward                   | 34.623 ms                 | 75.411 ms                 |
| back: aggr dram keys      | 26.758 ms                 | 82.938 ms                 |
| back: set dram grad       | 3.811 ms                  | 5.338 ms                  |
| back: a2a grad            | 13.825 ms                 | 36.269 ms                 |
| back: grad sum & grad cache  | 6.055 ms                  | 91.807 ms                 |
| Backward                  | 155.899 ms                | 265.511 ms                |
| Optimize                  | 25.633 ms                 | 47.514 ms                 |
| BarrierTimeBeforeRank0    | 48.941 us                 | 91.126 us                 |
| BlockToStepN              | 23.577 us                 | 8.903 ms                  |
| OneStep                   | 231.482 ms                | 341.708 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.715 ms                  | 94.521 ms                 |
| bucket keys               | 3.049 ms                  | 4.231 ms                  |
| forward: a2a keys         | 3.404 ms                  | 32.476 ms                 |
| forward: search cache     | 356.436 us                | 478.029 us                |
| forward: a2a values       | 8.980 ms                  | 12.723 ms                 |
| forward: software         | 776.291 us                | 836.134 us                |
| forward: join             | 2.248 ms                  | 3.707 ms                  |
| Forward                   | 34.848 ms                 | 75.411 ms                 |
| back: aggr dram keys      | 26.758 ms                 | 77.520 ms                 |
| back: set dram grad       | 3.237 ms                  | 5.067 ms                  |
| back: a2a grad            | 13.744 ms                 | 35.821 ms                 |
| back: grad sum & grad cache  | 6.055 ms                  | 89.213 ms                 |
| Backward                  | 155.860 ms                | 265.511 ms                |
| Optimize                  | 25.611 ms                 | 47.514 ms                 |
| BarrierTimeBeforeRank0    | 46.597 us                 | 91.126 us                 |
| BlockToStepN              | 26.641 us                 | 8.903 ms                  |
| OneStep                   | 230.529 ms                | 355.224 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 75.352, sample: 1.317, forward: 50.595, backward: 11.486, update: 0.492
[Rank5] pid = 18996
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242)]
train_sampler.Prefill()
-------Step 0-------
tensor([20832048,   556299,   439638,   556321,   556345,   556369,  5150569,
          556401,   556425,   372912]) tensor([  119119, 36419501, 36826266,  5228211, 55310239, 23942332, 57167331,
        14790335, 58910855,  3739758])
-------Step 1-------
tensor([20832048,   556299,   439638,   556321,   556345,   556369,  5150569,
          556401,   556425,   372912]) tensor([83476931, 77670293,  4578681,  1235095, 65691585, 58725165, 22559015,
        57758666, 71727241, 39809611])
-------Step 2-------
tensor([   15153,    15181,    15212,    29456, 28884923,    15238, 23387693,
           15263, 20832048, 71033365]) tensor([ 8557282, 44153659, 25490564, 52793260, 70972485, 58754869, 42678743,
        29147135,  7646494, 17053421])
-------Step 3-------
tensor([   15153,    15181,    15212,    29456, 28884923,    15238, 23387693,
           15263, 20832048, 71033365]) tensor([31800638, 26878304,  9344468, 62673826, 11771996, 15570404, 10446227,
        81598620, 64665235, 81390422])
-------Step 4-------
tensor([ 659511,   25205,   81283, 8991062,   81319,  377453,   81345, 4466031,
          81384,  659533]) tensor([71017758, 85830981, 17421227, 26291913, 35202639, 66644239, 62251697,
        23648713, 23708802, 84690653])
-------Step 5-------
tensor([ 659511,   25205,   81283, 8991062,   81319,  377453,   81345, 4466031,
          81384,  659533]) tensor([ 4191399,   144466,  8290728, 61093687, 65802629, 35893446, 64791323,
        62239980, 49855347, 27945085])
-------Step 6-------
tensor([  143931,   143954, 20832048,   143984,    35702,   144011,   446625,
          446663, 34584543,  4458279]) tensor([45337741, 38120413, 31541987, 67702833, 69684512,  1217572, 11636612,
         4761061, 62808323, 23430545])
-------Step 7-------
tensor([  143931,   143954, 20832048,   143984,    35702,   144011,   446625,
          446663, 34584543,  4458279]) tensor([21545460, 25145690, 58071905, 49013446, 82322662, 11795892,  2125303,
        45685887, 38984963, 28934747])
-------Step 8-------
tensor([  307034,   205667,   205702,  5359259,  4310810,    84333,    46162,
           46186,   205740, 31757777]) tensor([80314321, 22798445, 76653140, 75753206,  6928095, 14453035, 29454561,
        36523835, 82307061, 26813749])
-------Step 9-------
tensor([  307034,   205667,   205702,  5359259,  4310810,    84333,    46162,
           46186,   205740, 31757777]) tensor([  439733, 50338043, 85282789, 42190687, 83263685, 45118797, 55336154,
        37848189, 80607894, 13416494])
before start barrier
start train
[proc 0] 100 steps, total: 73.441, sample: 1.244, forward: 50.017, backward: 17.251, update: 2.653
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 74.459, sample: 1.332, forward: 50.577, backward: 11.422, update: 0.453
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 71.291, sample: 1.294, forward: 50.586, backward: 11.861, update: 0.356
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 71.644, sample: 1.333, forward: 50.561, backward: 11.243, update: 0.394
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 72.307, sample: 1.395, forward: 50.491, backward: 11.516, update: 0.467
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.284 ms                  | 94.521 ms                 |
| bucket keys               | 3.043 ms                  | 4.231 ms                  |
| forward: a2a keys         | 3.371 ms                  | 32.476 ms                 |
| forward: search cache     | 355.482 us                | 478.029 us                |
| forward: a2a values       | 6.222 ms                  | 12.723 ms                 |
| forward: software         | 776.291 us                | 836.134 us                |
| forward: join             | 2.248 ms                  | 3.797 ms                  |
| Forward                   | 34.920 ms                 | 75.411 ms                 |
| back: aggr dram keys      | 34.074 ms                 | 77.520 ms                 |
| back: set dram grad       | 3.237 ms                  | 5.341 ms                  |
| back: a2a grad            | 13.663 ms                 | 35.984 ms                 |
| back: grad sum & grad cache  | 6.055 ms                  | 89.213 ms                 |
| Backward                  | 155.945 ms                | 265.511 ms                |
| Optimize                  | 25.587 ms                 | 47.514 ms                 |
| BarrierTimeBeforeRank0    | 42.687 us                 | 91.126 us                 |
| BlockToStepN              | 25.689 us                 | 8.903 ms                  |
| OneStep                   | 230.529 ms                | 355.224 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.335 ms                  | 94.521 ms                 |
| bucket keys               | 3.043 ms                  | 4.231 ms                  |
| forward: a2a keys         | 3.304 ms                  | 30.522 ms                 |
| forward: search cache     | 355.482 us                | 478.745 us                |
| forward: a2a values       | 6.222 ms                  | 12.723 ms                 |
| forward: software         | 776.291 us                | 836.134 us                |
| forward: join             | 2.391 ms                  | 3.784 ms                  |
| Forward                   | 34.818 ms                 | 75.411 ms                 |
| back: aggr dram keys      | 34.074 ms                 | 71.688 ms                 |
| back: set dram grad       | 3.237 ms                  | 5.341 ms                  |
| back: a2a grad            | 13.621 ms                 | 35.821 ms                 |
| back: grad sum & grad cache  | 6.126 ms                  | 76.500 ms                 |
| Backward                  | 155.860 ms                | 265.511 ms                |
| Optimize                  | 25.614 ms                 | 47.514 ms                 |
| BarrierTimeBeforeRank0    | 42.687 us                 | 91.126 us                 |
| BlockToStepN              | 23.846 us                 | 8.903 ms                  |
| OneStep                   | 229.965 ms                | 355.224 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.557 ms                  | 92.997 ms                 |
| bucket keys               | 3.035 ms                  | 4.231 ms                  |
| forward: a2a keys         | 3.295 ms                  | 32.476 ms                 |
| forward: search cache     | 356.674 us                | 478.745 us                |
| forward: a2a values       | 8.980 ms                  | 14.548 ms                 |
| forward: software         | 776.291 us                | 850.677 us                |
| forward: join             | 2.391 ms                  | 3.784 ms                  |
| Forward                   | 34.818 ms                 | 75.411 ms                 |
| back: aggr dram keys      | 36.605 ms                 | 76.614 ms                 |
| back: set dram grad       | 3.378 ms                  | 5.341 ms                  |
| back: a2a grad            | 13.641 ms                 | 35.821 ms                 |
| back: grad sum & grad cache  | 6.126 ms                  | 76.500 ms                 |
| Backward                  | 155.860 ms                | 265.511 ms                |
| Optimize                  | 25.569 ms                 | 47.514 ms                 |
| BarrierTimeBeforeRank0    | 42.687 us                 | 91.126 us                 |
| BlockToStepN              | 26.641 us                 | 18.766 ms                 |
| OneStep                   | 229.826 ms                | 355.224 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.335 ms                  | 92.997 ms                 |
| bucket keys               | 3.035 ms                  | 4.306 ms                  |
| forward: a2a keys         | 3.320 ms                  | 37.508 ms                 |
| forward: search cache     | 357.389 us                | 487.804 us                |
| forward: a2a values       | 8.980 ms                  | 24.518 ms                 |
| forward: software         | 776.291 us                | 850.677 us                |
| forward: join             | 2.391 ms                  | 3.784 ms                  |
| Forward                   | 34.986 ms                 | 86.080 ms                 |
| back: aggr dram keys      | 36.484 ms                 | 76.614 ms                 |
| back: set dram grad       | 3.237 ms                  | 5.341 ms                  |
| back: a2a grad            | 13.705 ms                 | 35.984 ms                 |
| back: grad sum & grad cache  | 6.126 ms                  | 76.500 ms                 |
| Backward                  | 155.860 ms                | 217.037 ms                |
| Optimize                  | 25.507 ms                 | 44.403 ms                 |
| BarrierTimeBeforeRank0    | 42.276 us                 | 86.677 us                 |
| BlockToStepN              | 27.052 us                 | 18.766 ms                 |
| OneStep                   | 229.707 ms                | 355.224 ms                |
+---------------------------+---------------------------+---------------------------+
Successfully xmh. training takes 92.51673483848572 seconds
before call kg_cache_controller.StopThreads()
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads
INFO [17518 controller_process.py:421] call rank0 to StopThreads

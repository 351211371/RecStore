WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240205 22:29:00.977078  6038 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_124', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=3, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=3, gpu=[0, 1, 2], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Partitoning with metis
[22:47:53] /home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/src/graph/transform/metis_partition_hetero.cc:87: Partition a graph with 86054151 nodes and 421063214 edges into 3 parts and get 13179806 edge cuts
WARNING [6038 sampler.py:454] Start PreSampling
WARNING [6038 sampler.py:532] Before construct renumbering_dict
WARNING [6038 sampler.py:555] PreSampling done
W20240205 22:58:47.014976  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240205 22:58:47.015197  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240205 22:58:47.015235  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240205 22:58:47.015273  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240205 22:58:47.015316  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240205 22:58:47.015370  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240205 22:58:47.015403  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240205 22:58:47.015452  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240205 22:58:47.015494  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240205 22:58:47.015525  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240205 22:58:47.015581  6038 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240205 22:58:47.015625  6038 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240205 22:58:47.015653  6038 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240205 22:58:47.015815  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240205 22:58:47.015867  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240205 22:58:47.015895  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240205 22:58:47.015936  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240205 22:58:47.015965  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240205 22:58:47.015998  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240205 22:58:47.016027  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240205 22:58:47.016072  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240205 22:58:47.016100  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240205 22:58:47.016129  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240205 22:58:47.016165  6038 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240205 22:58:47.016187  6038 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240205 22:58:47.016217  6038 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240205 22:58:47.016279  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240205 22:58:47.016311  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240205 22:58:47.016337  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240205 22:58:47.016371  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240205 22:58:47.016402  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240205 22:58:47.016431  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240205 22:58:47.016465  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240205 22:58:47.016507  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240205 22:58:47.016544  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240205 22:58:47.016579  6038 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240205 22:58:47.016608  6038 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240205 22:58:47.016631  6038 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240205 22:58:47.016654  6038 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240205 22:58:47.747751  6038 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10000e52e000 128.2 GB
W20240205 23:07:20.570875  6038 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10201d166000 328.3 MB
Convert a graph into a bidirected graph: 50.897 seconds, peak memory: 265.175 GB
Construct multi-constraint weights: 0.001 seconds, peak memory: 265.175 GB
Metis partitioning: 445.414 seconds, peak memory: 276.259 GB
Split the graph: 169.560 seconds
Construct subgraphs: 19.545 seconds
MertisPartition: part 0 has 32806815 N 98289586 E
MertisPartition: part 1 has 31756927 N 120802495 E
MertisPartition: part 2 has 32681333 N 137186093 E
Rank0: cached key size 1434235
Rank1: cached key size 1434235
Rank2: cached key size 1434235
Before renumbering graph:  {'_ID': tensor([     196,      197,      239,  ..., 85907466, 77843586,   627118]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4308878,  4308930,  4310181,  ..., 65719016, 66990035, 30242817]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2801.739 seconds
[Rank1] pid = 7435
INFO [7435 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [7532 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [6038 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [6038 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [7435 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [7532 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
W20240205 23:15:47.613301  7533 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240205 23:15:47.613914  7436 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240205 23:15:47.613926  7596 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240205 23:15:47.667706  7533 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1020319b3000 7.629 MB
W20240205 23:15:47.667708  7436 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102032156000 7.629 MB
W20240205 23:15:47.667711  7596 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1020328f9000 7.629 MB
W20240205 23:15:47.667961  7533 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10203309c000 7.629 MB
W20240205 23:15:47.668008  7596 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10203383f000 7.629 MB
W20240205 23:15:47.668018  7436 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102033fe2000 7.629 MB
W20240205 23:15:47.668108  7436 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x102034785000 1.49 GB
W20240205 23:15:47.668112  7533 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x102093d68000 1.49 GB
W20240205 23:15:47.668151  7533 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10215292e000 1.49 GB
W20240205 23:15:47.668150  7596 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1020f334b000 1.49 GB
W20240205 23:15:47.668197  7436 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1021b1f11000 1.49 GB
W20240205 23:15:47.668244  7596 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1022114f4000 1.49 GB
W20240205 23:15:47.668304  7596 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240205 23:15:47.668337  7436 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240205 23:15:47.668337  7533 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240205 23:15:47.673101  7436 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240205 23:15:47.673103  7533 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240205 23:15:47.673134  7596 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
[Rank2] pid = 7532
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121)]
cudaHostRegister 0x10000e52e000
0: KnownLocalCachedEmbedding init done
WARNING [6038 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000e52e000
1: KnownLocalCachedEmbedding init done
WARNING [7435 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000e52e000
2: KnownLocalCachedEmbedding init done
WARNING [7532 DistTensor.py:59] The tensor name already exists in the kvstore
I20240205 23:16:15.296216  7596 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 3
I20240205 23:16:15.296366  7533 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
I20240205 23:16:15.296496  7436 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
W20240205 23:16:15.298672  7533 grad_base.h:55] KGCacheController, config={
        "num_gpus": 3,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240205 23:16:15.298987  7533 grad_base.h:184] Init GradProcessingBase done
I20240205 23:16:27.744588  7533 grad_async_v2.h:42] Use main thread to update emb.
W20240205 23:16:27.744695  7533 kg_controller.h:78] after init GradAsyncProcessingV2
I20240205 23:16:27.744704  7533 kg_controller.h:84] Construct KGCacheController done
E20240205 23:16:28.080780  7436 recstore.cc:66] init folly done
E20240205 23:16:28.080932  7533 recstore.cc:66] init folly done
E20240205 23:16:28.080962  7596 recstore.cc:66] init folly done
I20240205 23:16:28.081920  7533 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240205 23:16:39.183676  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240205 23:16:39.184224  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240205 23:16:40.958721  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240205 23:16:40.958832  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240205 23:16:42.355901  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240205 23:16:42.356019  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 134.106 us                | 349.947 us                |
+---------------------------+---------------------------+---------------------------+
W20240205 23:16:46.280659  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240205 23:16:46.298405  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240205 23:16:46.609805  7533 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 131.415 us                | 264.529 us                |
+---------------------------+---------------------------+---------------------------+
W20240205 23:16:49.618835  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240205 23:16:49.643381  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240205 23:16:49.722095  7436 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
W20240205 23:16:52.008900  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240205 23:16:52.031931  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
I20240205 23:16:52.131448  7596 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 122.641 us                | 231.515 us                |
+---------------------------+---------------------------+---------------------------+
E20240205 23:16:53.333153  7533 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240205 23:16:53.442488  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240205 23:16:53.449779  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240205 23:16:54.333014  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=116
W20240205 23:16:54.480968  7843 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end0
W20240205 23:16:54.538233  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=11, pq.top=11
E20240205 23:16:55.034420  7698 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=20, sample_step_cpp_seen_[rank]=19
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 16.752 ms                 | 155.939 ms                |
| Forward                   | 4.634 ms                  | 622.902 ms                |
| Backward                  | 4.425 ms                  | 182.161 ms                |
| Optimize                  | 1.850 ms                  | 4.871 ms                  |
| BarrierTimeBeforeRank0    | 28.364 us                 | 24.245 ms                 |
| AfterBackward             | 14.331 ms                 | 442.511 ms                |
| BlockToStepN              | 441.877 us                | 1.035 ms                  |
| OneStep                   | 74.479 ms                 | 1.311 s                   |
+---------------------------+---------------------------+---------------------------+
E20240205 23:16:55.333009  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=208
W20240205 23:16:55.698784  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=23, pq.top=23
W20240205 23:16:55.738848  7843 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end3
E20240205 23:16:56.333014  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=420
W20240205 23:16:56.781519  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240205 23:16:56.953857  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=33, pq.top=33
E20240205 23:16:57.333015  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=597
W20240205 23:16:57.800231  7843 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 227.456 us                | 1.261 ms                  |
| ProcessBack:Shuffle       | 1.346 ms                  | 79.593 ms                 |
| ProcessBack:UpdateCache   | 1.105 ms                  | 177.089 ms                |
| ProcessBack:UpsertPq      | 11.487 ms                 | 108.868 ms                |
| ProcessOneStep            | 33.301 ms                 | 504.364 ms                |
| BlockToStepN              | 391.421 us                | 1.503 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240205 23:16:58.333014  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=9
W20240205 23:16:59.020224  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
W20240205 23:16:59.127408  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=57, pq.top=57
E20240205 23:16:59.350204  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240205 23:17:00.076622  7843 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.991 ms                  | 148.653 ms                |
| Forward                   | 4.606 ms                  | 22.983 ms                 |
| Backward                  | 4.584 ms                  | 24.556 ms                 |
| Optimize                  | 1.842 ms                  | 4.252 ms                  |
| BarrierTimeBeforeRank0    | 25.868 us                 | 3.884 ms                  |
| AfterBackward             | 31.634 ms                 | 504.407 ms                |
| BlockToStepN              | 408.195 us                | 1.697 ms                  |
| OneStep                   | 65.231 ms                 | 612.324 ms                |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:00.350010  7533 parallel_pq_v2.h:79] insert failed, size(hashtable)=11575
W20240205 23:17:00.548620  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=77, pq.top=77
E20240205 23:17:00.568249  7698 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=77, sample_step_cpp_seen_[rank]=76
W20240205 23:17:01.213810  7843 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240205 23:17:01.350008  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=15
W20240205 23:17:02.074941  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=97, pq.top=97
W20240205 23:17:02.326346  7843 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240205 23:17:02.350003  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=8
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 10.244, sample: 1.439, forward: 1.087, backward: 0.627, update: 0.212
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 12.653, sample: 1.443, forward: 1.082, backward: 0.644, update: 0.192
train_sampler.Prefill()
-------Step 0-------
tensor([  360467,    51255,   360500, 22751100,   360525,   360544,     2526,
         1220240,  1091247,   360568]) tensor([ 8594850, 58596230, 21177406, 75634074, 26034858,   599242, 48872392,
        14682085, 41831550, 62623762])
-------Step 1-------
tensor([  360467,    51255,   360500, 22751100,   360525,   360544,     2526,
         1220240,  1091247,   360568]) tensor([71287107, 17958198,  4565756, 79587638, 77912874, 55138263, 25422857,
        18113244,  1671777, 36734981])
-------Step 2-------
tensor([ 424944,  424969,    2752, 1101330,  424998,  425021,  425044,  577447,
         425074,  425096]) tensor([22930466, 34470420, 83628177, 54762991, 18308945, 30460969, 21064957,
        44583155, 74063574, 55318958])
-------Step 3-------
tensor([ 424944,  424969,    2752, 1101330,  424998,  425021,  425044,  577447,
         425074,  425096]) tensor([72789750,   964982, 44511773, 15886034, 63594553,  9250772, 16475359,
        82244754, 67821170, 69307876])
-------Step 4-------
tensor([  489481,   489500,   388944,   489523,  1229693,   489543, 26515963,
          489564,   489592,   489628]) tensor([43493812, 63716498, 11968849, 52713599, 44558502, 85990391, 10855254,
        22478467,  7611695, 34271028])
-------Step 5-------
tensor([  489481,   489500,   388944,   489523,  1229693,   489543, 26515963,
          489564,   489592,   489628]) tensor([41933338, 76284107, 26069781, 40334844, 12178637, 79073629, 50754196,
        37857635,  1160035, 34364644])
-------Step 6-------
tensor([  552989,   553009,   553044,  1234482, 26515963,   553068,   553102,
          553123,   553148,       31]) tensor([60082066, 10892855, 51954172, 19716616,   707455, 28977766, 14244352,
        10243945,   275735, 23917531])
-------Step 7-------
tensor([  552989,   553009,   553044,  1234482, 26515963,   553068,   553102,
          553123,   553148,       31]) tensor([68326651, 52380998, 59575788,   370971, 41151454, 65313212, 84087732,
        62826080, 32580912, 41452890])
-------Step 8-------
tensor([  614530,   614558,   614584,   614606,  1129328,   614634, 18164110,
          614659,   614690, 18610277]) tensor([63475718, 20208842, 19185299, 22118432, 48381825,  8376299, 76179213,
          909918, 49440929, 38757796])
-------Step 9-------
tensor([  614530,   614558,   614584,   614606,  1129328,   614634, 18164110,
          614659,   614690, 18610277]) tensor([26534789, 35224726, 53071530, 74406925, 62650015, 78848561, 41891060,
        34535813, 60169658, 20084029])
before start barrier
start train
[proc 0] 100 steps, total: 15.766, sample: 2.055, forward: 1.111, backward: 0.654, update: 0.226
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 313.149 us                | 7.088 ms                  |
| ProcessBack:Shuffle       | 1.443 ms                  | 5.299 ms                  |
| ProcessBack:UpdateCache   | 1.272 ms                  | 1.793 ms                  |
| ProcessBack:UpsertPq      | 12.211 ms                 | 89.133 ms                 |
| ProcessOneStep            | 31.172 ms                 | 504.364 ms                |
| BlockToStepN              | 426.504 us                | 2.118 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240205 23:17:03.246798  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=111, pq.top=111
E20240205 23:17:03.350040  7857 parallel_pq_v2.h:79] insert failed, size(hashtable)=12236
W20240205 23:17:03.594223  7843 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
E20240205 23:17:04.350009  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=22084
W20240205 23:17:04.595561  7843 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end8
W20240205 23:17:04.672919  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=129, pq.top=129
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.674 ms                  | 148.653 ms                |
| Forward                   | 4.703 ms                  | 22.983 ms                 |
| Backward                  | 4.685 ms                  | 40.129 ms                 |
| Optimize                  | 1.961 ms                  | 6.180 ms                  |
| BarrierTimeBeforeRank0    | 26.641 us                 | 24.245 ms                 |
| AfterBackward             | 31.199 ms                 | 504.407 ms                |
| BlockToStepN              | 559.218 us                | 2.872 ms                  |
| OneStep                   | 61.310 ms                 | 612.324 ms                |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:05.350013  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=37
W20240205 23:17:05.837289  7843 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
W20240205 23:17:05.899976  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=145, pq.top=145
E20240205 23:17:06.208770  7698 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=149, sample_step_cpp_seen_[rank]=148
E20240205 23:17:06.350014  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=3361
W20240205 23:17:06.873920  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end2
E20240205 23:17:07.350031  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=5349
W20240205 23:17:07.540980  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=161, pq.top=161
W20240205 23:17:07.914188  7843 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 288.931 us                | 5.315 ms                  |
| ProcessBack:Shuffle       | 1.482 ms                  | 7.203 ms                  |
| ProcessBack:UpdateCache   | 1.308 ms                  | 35.812 ms                 |
| ProcessBack:UpsertPq      | 13.717 ms                 | 86.360 ms                 |
| ProcessOneStep            | 36.152 ms                 | 442.167 ms                |
| BlockToStepN              | 572.149 us                | 3.215 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:08.350023  7533 parallel_pq_v2.h:79] insert failed, size(hashtable)=6934
W20240205 23:17:08.595714  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=167, pq.top=167
W20240205 23:17:09.003190  7843 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end3
E20240205 23:17:09.350039  7859 parallel_pq_v2.h:79] insert failed, size(hashtable)=16082
W20240205 23:17:10.047281  7843 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240205 23:17:10.185927  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=185, pq.top=185
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.616 ms                  | 126.120 ms                |
| Forward                   | 4.723 ms                  | 23.779 ms                 |
| Backward                  | 4.757 ms                  | 24.592 ms                 |
| Optimize                  | 1.961 ms                  | 5.267 ms                  |
| BarrierTimeBeforeRank0    | 26.641 us                 | 24.245 ms                 |
| AfterBackward             | 37.135 ms                 | 504.407 ms                |
| BlockToStepN              | 694.505 us                | 3.631 ms                  |
| OneStep                   | 64.306 ms                 | 612.324 ms                |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:10.350013  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=3065
W20240205 23:17:11.070194  7843 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
[proc 2] 200 steps, total: 8.711, sample: 1.268, forward: 0.459, backward: 0.527, update: 0.229
[proc 1] 200 steps, total: 8.711, sample: 1.418, forward: 0.470, backward: 0.501, update: 0.193
[proc 0] 200 steps, total: 8.711, sample: 1.474, forward: 0.540, backward: 0.594, update: 0.222
W20240205 23:17:11.247819  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=203, pq.top=203
E20240205 23:17:11.350015  7862 parallel_pq_v2.h:79] insert failed, size(hashtable)=12705
E20240205 23:17:11.620287  7698 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=210, sample_step_cpp_seen_[rank]=209
W20240205 23:17:12.185149  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
E20240205 23:17:12.350013  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=1124
W20240205 23:17:12.399591  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=221, pq.top=221
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 331.301 us                | 7.568 ms                  |
| ProcessBack:Shuffle       | 1.520 ms                  | 6.548 ms                  |
| ProcessBack:UpdateCache   | 1.382 ms                  | 2.457 ms                  |
| ProcessBack:UpsertPq      | 13.964 ms                 | 76.551 ms                 |
| ProcessOneStep            | 35.708 ms                 | 504.364 ms                |
| BlockToStepN              | 704.104 us                | 10.918 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240205 23:17:13.257889  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240205 23:17:13.350009  7533 parallel_pq_v2.h:79] insert failed, size(hashtable)=15389
W20240205 23:17:13.540169  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=237, pq.top=237
W20240205 23:17:14.280580  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
E20240205 23:17:14.350014  7864 parallel_pq_v2.h:79] insert failed, size(hashtable)=28540
W20240205 23:17:14.553150  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=254, pq.top=254
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.640 ms                  | 122.523 ms                |
| Forward                   | 4.825 ms                  | 22.983 ms                 |
| Backward                  | 5.028 ms                  | 24.556 ms                 |
| Optimize                  | 2.045 ms                  | 5.407 ms                  |
| BarrierTimeBeforeRank0    | 26.358 us                 | 19.023 ms                 |
| AfterBackward             | 33.327 ms                 | 442.511 ms                |
| BlockToStepN              | 769.380 us                | 11.770 ms                 |
| OneStep                   | 60.868 ms                 | 521.896 ms                |
+---------------------------+---------------------------+---------------------------+
W20240205 23:17:15.326992  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
E20240205 23:17:15.350009  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=9359
W20240205 23:17:15.579521  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=271, pq.top=271
E20240205 23:17:16.350008  7533 parallel_pq_v2.h:79] insert failed, size(hashtable)=11695
W20240205 23:17:16.476994  7843 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
E20240205 23:17:16.620008  7533 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=287, sample_step_cpp_seen_[rank]=286
W20240205 23:17:16.899940  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=289, pq.top=289
E20240205 23:17:17.350509  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240205 23:17:17.481215  7843 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
[proc 2] 300 steps, total: 6.501, sample: 0.872, forward: 0.464, backward: 0.442, update: 0.208
[proc 1] 300 steps, total: 6.501, sample: 0.980, forward: 0.493, backward: 0.492, update: 0.213
[proc 0] 300 steps, total: 6.501, sample: 0.989, forward: 0.501, backward: 0.675, update: 0.248
W20240205 23:17:18.034718  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=309, pq.top=309
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 316.061 us                | 7.674 ms                  |
| ProcessBack:Shuffle       | 1.544 ms                  | 6.320 ms                  |
| ProcessBack:UpdateCache   | 1.416 ms                  | 2.446 ms                  |
| ProcessBack:UpsertPq      | 13.969 ms                 | 74.042 ms                 |
| ProcessOneStep            | 31.542 ms                 | 442.167 ms                |
| BlockToStepN              | 710.032 us                | 19.765 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:18.350474  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=19009
W20240205 23:17:18.727681  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end9
E20240205 23:17:19.350275  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240205 23:17:19.413601  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=325, pq.top=325
W20240205 23:17:19.970752  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.745 ms                  | 122.523 ms                |
| Forward                   | 4.896 ms                  | 22.983 ms                 |
| Backward                  | 5.198 ms                  | 24.556 ms                 |
| Optimize                  | 2.164 ms                  | 6.137 ms                  |
| BarrierTimeBeforeRank0    | 26.787 us                 | 24.245 ms                 |
| AfterBackward             | 31.568 ms                 | 442.511 ms                |
| BlockToStepN              | 797.204 us                | 19.822 ms                 |
| OneStep                   | 58.725 ms                 | 521.896 ms                |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:20.350010  7698 parallel_pq_v2.h:79] insert failed, size(hashtable)=2731
W20240205 23:17:20.903017  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=343, pq.top=343
W20240205 23:17:21.064817  7843 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end5
E20240205 23:17:21.350008  7864 parallel_pq_v2.h:79] insert failed, size(hashtable)=61776
E20240205 23:17:21.620011  7533 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=355, sample_step_cpp_seen_[rank]=354
W20240205 23:17:22.314869  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=363, pq.top=363
W20240205 23:17:22.345019  7843 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
E20240205 23:17:22.350004  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=21310
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 310.363 us                | 10.779 ms                 |
| ProcessBack:Shuffle       | 1.564 ms                  | 6.548 ms                  |
| ProcessBack:UpdateCache   | 1.467 ms                  | 2.401 ms                  |
| ProcessBack:UpsertPq      | 13.426 ms                 | 74.042 ms                 |
| ProcessOneStep            | 31.542 ms                 | 423.210 ms                |
| BlockToStepN              | 750.400 us                | 17.952 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:23.350011  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=5641
W20240205 23:17:23.351092  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=376, pq.top=376
W20240205 23:17:23.377453  7843 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
E20240205 23:17:24.350013  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=7433
W20240205 23:17:24.351677  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=390, pq.top=390
W20240205 23:17:24.586408  7843 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
[proc 1] 400 steps, total: 7.569, sample: 0.971, forward: 0.492, backward: 0.552, update: 0.207
[proc 2] 400 steps, total: 7.569, sample: 1.190, forward: 0.648, backward: 0.491, update: 0.268
[proc 0] 400 steps, total: 7.569, sample: 1.014, forward: 0.554, backward: 0.506, update: 0.255
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.330 ms                  | 122.523 ms                |
| Forward                   | 4.893 ms                  | 22.662 ms                 |
| Backward                  | 5.186 ms                  | 12.962 ms                 |
| Optimize                  | 2.092 ms                  | 6.137 ms                  |
| BarrierTimeBeforeRank0    | 28.057 us                 | 49.380 ms                 |
| AfterBackward             | 31.255 ms                 | 423.242 ms                |
| BlockToStepN              | 840.698 us                | 23.836 ms                 |
| OneStep                   | 58.725 ms                 | 441.881 ms                |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:25.350009  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=7227
W20240205 23:17:25.660833  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=403, pq.top=403
W20240205 23:17:25.662475  7843 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240205 23:17:26.350009  7533 parallel_pq_v2.h:79] insert failed, size(hashtable)=1784
E20240205 23:17:26.645828  7698 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=418, sample_step_cpp_seen_[rank]=417
W20240205 23:17:26.682618  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end9
W20240205 23:17:26.723116  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=419, pq.top=419
E20240205 23:17:27.350011  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=6165
W20240205 23:17:27.766878  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=436, pq.top=436
W20240205 23:17:27.769131  7843 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 360.938 us                | 17.573 ms                 |
| ProcessBack:Shuffle       | 1.577 ms                  | 6.320 ms                  |
| ProcessBack:UpdateCache   | 1.529 ms                  | 2.401 ms                  |
| ProcessBack:UpsertPq      | 13.219 ms                 | 72.749 ms                 |
| ProcessOneStep            | 30.811 ms                 | 423.210 ms                |
| BlockToStepN              | 815.073 us                | 29.301 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:28.350011  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=11512
W20240205 23:17:28.908138  7843 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end1
W20240205 23:17:28.938505  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=451, pq.top=451
E20240205 23:17:29.350335  7859 parallel_pq_v2.h:79] insert failed, size(hashtable)=3711
W20240205 23:17:29.946867  7843 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
W20240205 23:17:30.030925  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=463, pq.top=463
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.203 ms                  | 117.315 ms                |
| Forward                   | 4.943 ms                  | 19.337 ms                 |
| Backward                  | 5.252 ms                  | 11.173 ms                 |
| Optimize                  | 2.135 ms                  | 5.772 ms                  |
| BarrierTimeBeforeRank0    | 28.537 us                 | 48.095 ms                 |
| AfterBackward             | 30.836 ms                 | 410.710 ms                |
| BlockToStepN              | 914.324 us                | 29.374 ms                 |
| OneStep                   | 58.619 ms                 | 439.135 ms                |
+---------------------------+---------------------------+---------------------------+
E20240205 23:17:30.350097  7872 parallel_pq_v2.h:79] insert failed, size(hashtable)=36624
W20240205 23:17:30.959484  7843 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
W20240205 23:17:31.038862  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=475, pq.top=475
E20240205 23:17:31.350020  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=664
W20240205 23:17:31.974097  7843 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end6
W20240205 23:17:32.070353  7533 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=487, pq.top=487
E20240205 23:17:32.350029  7843 parallel_pq_v2.h:79] insert failed, size(hashtable)=3
E20240205 23:17:32.462754  7533 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=494, sample_step_cpp_seen_[rank]=493
[proc 1] 500 steps, total: 7.854, sample: 1.195, forward: 0.507, backward: 0.499, update: 0.229
[proc 0] 500 steps, total: 7.854, sample: 1.245, forward: 0.501, backward: 0.548, update: 0.228
[proc 2] 500 steps, total: 7.854, sample: 1.199, forward: 0.534, backward: 0.441, update: 0.218
Successfully xmh. training takes 46.40159034729004 seconds
before call kg_cache_controller.StopThreads()
W20240205 23:17:33.011341  7533 grad_async_v2.h:84] call StopThreads. PID = 6038
W20240205 23:17:33.011369  7533 grad_base.h:212] before processOneStepNegThread_.join();
W20240205 23:17:33.011637  7533 grad_base.h:214] after processOneStepNegThread_.join();
W20240205 23:17:33.011646  7533 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 318.402 us                | 12.806 ms                 |
| ProcessBack:Shuffle       | 1.602 ms                  | 6.181 ms                  |
| ProcessBack:UpdateCache   | 1.582 ms                  | 2.701 ms                  |
| ProcessBack:UpsertPq      | 13.146 ms                 | 69.825 ms                 |
| ProcessOneStep            | 30.724 ms                 | 410.670 ms                |
| BlockToStepN              | 882.635 us                | 32.592 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240205 23:17:33.099754  7843 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end0
W20240205 23:17:33.284571  7533 grad_async_v2.h:105] StopThreads done.

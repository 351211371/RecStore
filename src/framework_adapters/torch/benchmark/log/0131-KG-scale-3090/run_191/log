WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240206 05:39:28.854671  2894 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_135', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=5, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=5, gpu=[0, 1, 2, 3, 4], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [2894 sampler.py:454] Start PreSampling
WARNING [2894 sampler.py:532] Before construct renumbering_dict
WARNING [2894 sampler.py:555] PreSampling done
W20240206 05:58:29.857136  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240206 05:58:29.857335  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240206 05:58:29.857367  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240206 05:58:29.857398  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240206 05:58:29.857432  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240206 05:58:29.857461  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240206 05:58:29.857491  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240206 05:58:29.857527  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240206 05:58:29.857563  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240206 05:58:29.857591  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240206 05:58:29.857632  2894 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240206 05:58:29.857659  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240206 05:58:29.857692  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240206 05:58:29.857872  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240206 05:58:29.857909  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240206 05:58:29.857942  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240206 05:58:29.857987  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240206 05:58:29.858017  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240206 05:58:29.858052  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240206 05:58:29.858088  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240206 05:58:29.858126  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240206 05:58:29.858156  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240206 05:58:29.858183  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240206 05:58:29.858209  2894 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240206 05:58:29.858232  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240206 05:58:29.858263  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240206 05:58:29.858327  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240206 05:58:29.858366  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240206 05:58:29.858390  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240206 05:58:29.858422  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240206 05:58:29.858455  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240206 05:58:29.858485  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240206 05:58:29.858521  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240206 05:58:29.858554  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240206 05:58:29.858592  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240206 05:58:29.858623  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240206 05:58:29.858647  2894 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240206 05:58:29.858671  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240206 05:58:29.858697  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240206 05:58:29.858762  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240206 05:58:29.858799  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240206 05:58:29.858834  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240206 05:58:29.858861  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240206 05:58:29.858891  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240206 05:58:29.858922  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240206 05:58:29.858953  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240206 05:58:29.858983  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240206 05:58:29.859014  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240206 05:58:29.859050  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240206 05:58:29.859076  2894 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240206 05:58:29.859102  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240206 05:58:29.859125  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240206 05:58:29.859181  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240206 05:58:29.859216  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240206 05:58:29.859244  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240206 05:58:29.859272  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240206 05:58:29.859305  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240206 05:58:29.859339  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240206 05:58:29.859365  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240206 05:58:29.859405  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240206 05:58:29.859441  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240206 05:58:29.859467  2894 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240206 05:58:29.859501  2894 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240206 05:58:29.859930  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240206 05:58:29.859967  2894 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240206 05:58:30.247126  2894 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100017df6000 128.2 GB
W20240206 06:05:46.794848  2894 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102026a2e000 328.3 MB
{0: Graph(num_nodes=20747160, num_edges=52627628,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22453096, num_edges=82686155,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=19237572, num_edges=68187033,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=19123946, num_edges=82521325,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=24344931, num_edges=85060575,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 20747160 N 52627628 E
MertisPartition: part 1 has 22453096 N 82686155 E
MertisPartition: part 2 has 19237572 N 68187033 E
MertisPartition: part 3 has 19123946 N 82521325 E
MertisPartition: part 4 has 24344931 N 85060575 E
Rank0: cached key size 860541
Rank1: cached key size 860541
Rank2: cached key size 860541
Rank3: cached key size 860541
Rank4: cached key size 860541
Before renumbering graph:  {'_ID': tensor([     239,      240,      265,  ..., 86036354,  5226631, 86047326]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 4311367,  4311408,   590315,  ...,  2033881, 83734556, 75152992]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 1, 2])}
part_g: DGLGraph(num_nodes=20747160, num_edges=52627628,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=20747160, num_edges=52627628,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2081.499 seconds
[Rank1] pid = 3943
[Rank2] pid = 4040
[Rank3] pid = 4107
INFO [2894 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [3943 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [4040 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [4174 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [4040 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
INFO [3943 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
INFO [4174 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
INFO [2894 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
INFO [4107 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [4107 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
WARNING [4174 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [3943 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [4040 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [2894 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [4107 DistTensor.py:59] The tensor name already exists in the kvstore
I20240206 06:14:26.054246  4108 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 5
I20240206 06:14:26.054872  4175 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
I20240206 06:14:26.055079  4238 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
I20240206 06:14:26.055243  4041 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
I20240206 06:14:26.055406  3944 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
E20240206 06:14:27.609602  4238 recstore.cc:66] init folly done
E20240206 06:14:27.609617  3944 recstore.cc:66] init folly done
E20240206 06:14:27.609620  4175 recstore.cc:66] init folly done
E20240206 06:14:27.609704  4108 recstore.cc:66] init folly done
E20240206 06:14:27.609704  4041 recstore.cc:66] init folly done
I20240206 06:14:35.296264  4175 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 5
I20240206 06:14:37.517064  4041 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
I20240206 06:14:40.397779  4108 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
I20240206 06:14:40.807009  3944 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
I20240206 06:14:41.107765  4238 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 15.960 ms                 | 154.196 ms                |
| bucket keys               | 2.282 ms                  | 114.963 ms                |
| forward: a2a keys         | 4.089 ms                  | 932.072 ms                |
| forward: search cache     | 273.902 us                | 20.995 ms                 |
| forward: a2a values       | 3.854 ms                  | 28.857 ms                 |
| forward: join             | 1.647 ms                  | 2.849 ms                  |
| Forward                   | 46.466 ms                 | 1.553 s                   |
| back: aggr dram keys      | 30.021 ms                 | 616.894 ms                |
| back: set dram grad       | 1.943 ms                  | 5.527 ms                  |
| back: a2a grad            | 6.200 ms                  | 33.376 ms                 |
| back: grad sum & grad cache  | 2.848 ms                  | 94.305 ms                 |
| Backward                  | 166.234 ms                | 917.545 ms                |
| Optimize                  | 23.988 ms                 | 54.913 ms                 |
| BarrierTimeBeforeRank0    | 60.934 us                 | 84.509 us                 |
| BlockToStepN              | 37.329 us                 | 2.322 ms                  |
| OneStep                   | 252.449 ms                | 2.550 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.132 ms                  | 154.196 ms                |
| bucket keys               | 2.693 ms                  | 27.291 ms                 |
| forward: a2a keys         | 3.695 ms                  | 58.774 ms                 |
| forward: search cache     | 271.753 us                | 756.241 us                |
| forward: a2a values       | 6.497 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.110 ms                  |
| Forward                   | 42.856 ms                 | 1.553 s                   |
| back: aggr dram keys      | 40.477 ms                 | 66.892 ms                 |
| back: set dram grad       | 1.943 ms                  | 4.646 ms                  |
| back: a2a grad            | 16.168 ms                 | 31.606 ms                 |
| back: grad sum & grad cache  | 3.369 ms                  | 61.053 ms                 |
| Backward                  | 150.763 ms                | 917.545 ms                |
| Optimize                  | 22.908 ms                 | 54.913 ms                 |
| BarrierTimeBeforeRank0    | 52.312 us                 | 84.509 us                 |
| BlockToStepN              | 20.590 us                 | 5.769 ms                  |
| OneStep                   | 232.254 ms                | 2.550 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.872 ms                  | 124.975 ms                |
| bucket keys               | 2.693 ms                  | 27.291 ms                 |
| forward: a2a keys         | 3.604 ms                  | 58.774 ms                 |
| forward: search cache     | 270.420 us                | 756.241 us                |
| forward: a2a values       | 6.497 ms                  | 30.512 ms                 |
| forward: join             | 2.615 ms                  | 3.110 ms                  |
| Forward                   | 40.046 ms                 | 94.813 ms                 |
| back: aggr dram keys      | 43.941 ms                 | 73.775 ms                 |
| back: set dram grad       | 3.110 ms                  | 6.630 ms                  |
| back: a2a grad            | 16.168 ms                 | 33.376 ms                 |
| back: grad sum & grad cache  | 3.868 ms                  | 61.115 ms                 |
| Backward                  | 147.161 ms                | 209.801 ms                |
| Optimize                  | 23.166 ms                 | 36.883 ms                 |
| BarrierTimeBeforeRank0    | 47.912 us                 | 83.481 us                 |
| BlockToStepN              | 23.126 us                 | 2.322 ms                  |
| OneStep                   | 223.333 ms                | 454.962 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.941 ms                  | 145.418 ms                |
| bucket keys               | 2.696 ms                  | 5.381 ms                  |
| forward: a2a keys         | 3.454 ms                  | 43.373 ms                 |
| forward: search cache     | 272.663 us                | 756.241 us                |
| forward: a2a values       | 6.497 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.110 ms                  |
| Forward                   | 39.433 ms                 | 94.813 ms                 |
| back: aggr dram keys      | 43.941 ms                 | 66.892 ms                 |
| back: set dram grad       | 3.110 ms                  | 5.527 ms                  |
| back: a2a grad            | 14.207 ms                 | 31.606 ms                 |
| back: grad sum & grad cache  | 3.868 ms                  | 61.053 ms                 |
| Backward                  | 143.253 ms                | 209.801 ms                |
| Optimize                  | 22.908 ms                 | 36.883 ms                 |
| BarrierTimeBeforeRank0    | 47.685 us                 | 84.509 us                 |
| BlockToStepN              | 33.860 us                 | 2.322 ms                  |
| OneStep                   | 218.471 ms                | 454.962 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.109 ms                  | 145.418 ms                |
| bucket keys               | 2.696 ms                  | 5.381 ms                  |
| forward: a2a keys         | 3.079 ms                  | 43.373 ms                 |
| forward: search cache     | 279.685 us                | 756.241 us                |
| forward: a2a values       | 6.497 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.110 ms                  |
| Forward                   | 38.576 ms                 | 94.813 ms                 |
| back: aggr dram keys      | 43.941 ms                 | 66.892 ms                 |
| back: set dram grad       | 3.110 ms                  | 5.527 ms                  |
| back: a2a grad            | 14.172 ms                 | 31.606 ms                 |
| back: grad sum & grad cache  | 3.868 ms                  | 61.053 ms                 |
| Backward                  | 140.684 ms                | 209.801 ms                |
| Optimize                  | 22.753 ms                 | 39.503 ms                 |
| BarrierTimeBeforeRank0    | 46.912 us                 | 84.509 us                 |
| BlockToStepN              | 38.088 us                 | 2.322 ms                  |
| OneStep                   | 213.344 ms                | 454.962 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 25.749, sample: 1.258, forward: 6.796, backward: 10.794, update: 0.388
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 25.039, sample: 1.389, forward: 6.682, backward: 10.853, update: 0.388
[Rank4] pid = 4174
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 4314794,   187273,   769619,   187297,   187317,   187356,   769638,
          187377, 36971816,   769655]) tensor([ 8264235, 22662374,   731878, 85909928,   762811, 40202828, 67379175,
        32183582, 62353883, 68546295])
-------Step 1-------
tensor([ 4314794,   187273,   769619,   187297,   187317,   187356,   769638,
          187377, 36971816,   769655]) tensor([74122033, 53195784, 17347272, 37905329, 47890022,   118972, 35144881,
        84505113,  5735615, 35659512])
-------Step 2-------
tensor([  245104,   245126,   245149,   245168, 20767273, 73583084,   245198,
          245214,   245239,   245271]) tensor([48528078, 22136287, 10402116,  4327008, 46516464, 48915971, 72499347,
        51248111, 15918178, 74526047])
-------Step 3-------
tensor([  245104,   245126,   245149,   245168, 20767273, 73583084,   245198,
          245214,   245239,   245271]) tensor([10290169, 10252006, 58003555, 75839581, 27323315, 59759641, 21394625,
           18578, 60169773, 42847809])
-------Step 4-------
tensor([26673149,   302408,   302430,   302452,   302474,   302496,   302519,
          362527,   302534,   302556]) tensor([50263997, 44432225, 79660340, 16956243, 66075621, 53721301, 80110958,
        52416673, 59388909, 75632129])
-------Step 5-------
tensor([26673149,   302408,   302430,   302452,   302474,   302496,   302519,
          362527,   302534,   302556]) tensor([76112695, 56435643, 11528271, 67503795, 17675531, 34444007, 58877015,
        80185748, 82609003, 12643662])
-------Step 6-------
tensor([  359818, 16427500,   359842,   359867,   359889,   782736,   359913,
          782752,   359935,   359958]) tensor([ 9920833, 21528151, 80987082,    93600,  8156371, 31469330, 74082636,
        71034361, 74696816, 57826848])
-------Step 7-------
tensor([  359818, 16427500,   359842,   359867,   359889,   782736,   359913,
          782752,   359935,   359958]) tensor([ 3984417, 24536782, 69594206, 46802050, 19981371, 61655748, 25609588,
        39554468, 12109021,  6990674])
-------Step 8-------
tensor([ 5063072,   414947,  4314794,   414968,   414994,   415019,   415046,
          415066,   415088, 49570260]) tensor([20137451, 53262568, 71286604, 41501497, 42023981,  1615338, 60278838,
          400195, 44402012, 63433548])
-------Step 9-------
tensor([ 5063072,   414947,  4314794,   414968,   414994,   415019,   415046,
          415066,   415088, 49570260]) tensor([73890012, 80388908, 41238684, 81845588, 16910308, 52378023, 30254398,
        84386913, 81086778,   106027])
before start barrier
start train
[proc 0] 100 steps, total: 30.850, sample: 1.594, forward: 5.807, backward: 15.243, update: 2.301
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 25.340, sample: 1.436, forward: 6.614, backward: 11.247, update: 0.356
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 28.630, sample: 1.250, forward: 6.807, backward: 10.775, update: 0.375
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.798 ms                  | 145.418 ms                |
| bucket keys               | 2.696 ms                  | 5.381 ms                  |
| forward: a2a keys         | 3.075 ms                  | 43.373 ms                 |
| forward: search cache     | 282.799 us                | 756.241 us                |
| forward: a2a values       | 6.497 ms                  | 35.807 ms                 |
| forward: join             | 2.615 ms                  | 4.201 ms                  |
| Forward                   | 38.439 ms                 | 97.040 ms                 |
| back: aggr dram keys      | 39.780 ms                 | 73.775 ms                 |
| back: set dram grad       | 3.110 ms                  | 5.527 ms                  |
| back: a2a grad            | 14.082 ms                 | 32.144 ms                 |
| back: grad sum & grad cache  | 3.868 ms                  | 66.975 ms                 |
| Backward                  | 141.337 ms                | 209.801 ms                |
| Optimize                  | 22.753 ms                 | 39.503 ms                 |
| BarrierTimeBeforeRank0    | 46.453 us                 | 84.509 us                 |
| BlockToStepN              | 37.329 us                 | 2.322 ms                  |
| OneStep                   | 214.014 ms                | 454.962 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.559 ms                  | 145.418 ms                |
| bucket keys               | 2.687 ms                  | 4.718 ms                  |
| forward: a2a keys         | 2.973 ms                  | 37.865 ms                 |
| forward: search cache     | 283.417 us                | 406.866 us                |
| forward: a2a values       | 6.497 ms                  | 30.512 ms                 |
| forward: join             | 2.615 ms                  | 3.601 ms                  |
| Forward                   | 37.952 ms                 | 97.040 ms                 |
| back: aggr dram keys      | 39.780 ms                 | 73.775 ms                 |
| back: set dram grad       | 3.110 ms                  | 4.701 ms                  |
| back: a2a grad            | 14.082 ms                 | 32.144 ms                 |
| back: grad sum & grad cache  | 3.868 ms                  | 64.585 ms                 |
| Backward                  | 143.582 ms                | 209.801 ms                |
| Optimize                  | 22.791 ms                 | 44.105 ms                 |
| BarrierTimeBeforeRank0    | 46.567 us                 | 84.800 us                 |
| BlockToStepN              | 37.759 us                 | 14.592 ms                 |
| OneStep                   | 216.064 ms                | 454.962 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.559 ms                  | 124.975 ms                |
| bucket keys               | 2.683 ms                  | 4.718 ms                  |
| forward: a2a keys         | 3.079 ms                  | 37.865 ms                 |
| forward: search cache     | 283.567 us                | 406.866 us                |
| forward: a2a values       | 6.497 ms                  | 30.512 ms                 |
| forward: join             | 2.615 ms                  | 3.601 ms                  |
| Forward                   | 38.088 ms                 | 94.813 ms                 |
| back: aggr dram keys      | 40.390 ms                 | 73.775 ms                 |
| back: set dram grad       | 3.110 ms                  | 5.527 ms                  |
| back: a2a grad            | 14.082 ms                 | 32.144 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.585 ms                 |
| Backward                  | 145.209 ms                | 194.643 ms                |
| Optimize                  | 22.791 ms                 | 39.503 ms                 |
| BarrierTimeBeforeRank0    | 46.912 us                 | 84.800 us                 |
| BlockToStepN              | 39.371 us                 | 14.098 ms                 |
| OneStep                   | 218.691 ms                | 355.869 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.559 ms                  | 124.975 ms                |
| bucket keys               | 2.683 ms                  | 3.913 ms                  |
| forward: a2a keys         | 3.089 ms                  | 36.951 ms                 |
| forward: search cache     | 283.389 us                | 374.234 us                |
| forward: a2a values       | 9.884 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.570 ms                  |
| Forward                   | 38.202 ms                 | 94.813 ms                 |
| back: aggr dram keys      | 40.390 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.110 ms                  | 4.701 ms                  |
| back: a2a grad            | 14.082 ms                 | 31.606 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 61.115 ms                 |
| Backward                  | 146.331 ms                | 194.643 ms                |
| Optimize                  | 22.908 ms                 | 44.105 ms                 |
| BarrierTimeBeforeRank0    | 46.987 us                 | 84.800 us                 |
| BlockToStepN              | 44.853 us                 | 14.098 ms                 |
| OneStep                   | 219.604 ms                | 355.869 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 200 steps, total: 23.220, sample: 1.067, forward: 5.032, backward: 9.991, update: 0.404
[proc 0] 200 steps, total: 23.220, sample: 1.308, forward: 4.247, backward: 15.204, update: 2.312
[proc 4] 200 steps, total: 23.220, sample: 1.324, forward: 4.754, backward: 10.033, update: 0.416
[proc 1] 200 steps, total: 23.220, sample: 1.221, forward: 4.940, backward: 10.357, update: 0.389
[proc 3] 200 steps, total: 23.220, sample: 1.164, forward: 4.989, backward: 9.940, update: 0.332
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.258 ms                  | 124.975 ms                |
| bucket keys               | 2.683 ms                  | 3.913 ms                  |
| forward: a2a keys         | 3.075 ms                  | 36.951 ms                 |
| forward: search cache     | 283.231 us                | 374.234 us                |
| forward: a2a values       | 9.884 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.570 ms                  |
| Forward                   | 38.189 ms                 | 94.813 ms                 |
| back: aggr dram keys      | 40.390 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.110 ms                  | 4.701 ms                  |
| back: a2a grad            | 14.082 ms                 | 31.606 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.585 ms                 |
| Backward                  | 145.672 ms                | 194.643 ms                |
| Optimize                  | 22.908 ms                 | 44.146 ms                 |
| BarrierTimeBeforeRank0    | 46.912 us                 | 84.800 us                 |
| BlockToStepN              | 45.540 us                 | 14.098 ms                 |
| OneStep                   | 218.540 ms                | 355.869 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.949 ms                  | 124.975 ms                |
| bucket keys               | 2.687 ms                  | 3.886 ms                  |
| forward: a2a keys         | 3.053 ms                  | 35.398 ms                 |
| forward: search cache     | 283.037 us                | 368.105 us                |
| forward: a2a values       | 9.884 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.570 ms                  |
| Forward                   | 38.196 ms                 | 94.813 ms                 |
| back: aggr dram keys      | 41.282 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.048 ms                  | 4.682 ms                  |
| back: a2a grad            | 14.172 ms                 | 32.144 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 63.562 ms                 |
| Backward                  | 146.331 ms                | 196.147 ms                |
| Optimize                  | 22.985 ms                 | 44.146 ms                 |
| BarrierTimeBeforeRank0    | 46.906 us                 | 84.800 us                 |
| BlockToStepN              | 46.479 us                 | 14.098 ms                 |
| OneStep                   | 218.553 ms                | 355.869 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.027 ms                  | 105.497 ms                |
| bucket keys               | 2.683 ms                  | 3.886 ms                  |
| forward: a2a keys         | 3.003 ms                  | 35.398 ms                 |
| forward: search cache     | 281.972 us                | 368.105 us                |
| forward: a2a values       | 9.884 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.570 ms                  |
| Forward                   | 38.088 ms                 | 94.235 ms                 |
| back: aggr dram keys      | 43.357 ms                 | 72.487 ms                 |
| back: set dram grad       | 3.048 ms                  | 4.682 ms                  |
| back: a2a grad            | 14.172 ms                 | 32.392 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.396 ms                 |
| Backward                  | 146.123 ms                | 194.643 ms                |
| Optimize                  | 22.929 ms                 | 44.105 ms                 |
| BarrierTimeBeforeRank0    | 46.816 us                 | 84.800 us                 |
| BlockToStepN              | 46.911 us                 | 11.729 ms                 |
| OneStep                   | 218.553 ms                | 354.820 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.993 ms                  | 105.497 ms                |
| bucket keys               | 2.683 ms                  | 3.886 ms                  |
| forward: a2a keys         | 3.046 ms                  | 35.398 ms                 |
| forward: search cache     | 281.724 us                | 368.466 us                |
| forward: a2a values       | 9.884 ms                  | 28.857 ms                 |
| forward: join             | 2.615 ms                  | 3.570 ms                  |
| Forward                   | 38.092 ms                 | 94.235 ms                 |
| back: aggr dram keys      | 42.818 ms                 | 72.487 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.682 ms                  |
| back: a2a grad            | 14.172 ms                 | 33.376 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.396 ms                 |
| Backward                  | 145.672 ms                | 194.643 ms                |
| Optimize                  | 22.897 ms                 | 44.105 ms                 |
| BarrierTimeBeforeRank0    | 46.771 us                 | 84.800 us                 |
| BlockToStepN              | 47.251 us                 | 11.729 ms                 |
| OneStep                   | 218.520 ms                | 354.820 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.839 ms                  | 105.497 ms                |
| bucket keys               | 2.683 ms                  | 3.902 ms                  |
| forward: a2a keys         | 3.094 ms                  | 32.519 ms                 |
| forward: search cache     | 281.835 us                | 368.105 us                |
| forward: a2a values       | 9.884 ms                  | 26.365 ms                 |
| forward: join             | 2.615 ms                  | 3.479 ms                  |
| Forward                   | 38.376 ms                 | 94.235 ms                 |
| back: aggr dram keys      | 42.818 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.646 ms                  |
| back: a2a grad            | 14.184 ms                 | 33.376 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.129 ms                 |
| Backward                  | 146.755 ms                | 194.643 ms                |
| Optimize                  | 22.897 ms                 | 44.105 ms                 |
| BarrierTimeBeforeRank0    | 46.771 us                 | 84.800 us                 |
| BlockToStepN              | 47.154 us                 | 11.729 ms                 |
| OneStep                   | 218.471 ms                | 354.820 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 22.596, sample: 1.040, forward: 4.630, backward: 10.367, update: 0.408
[proc 4] 300 steps, total: 22.596, sample: 1.055, forward: 4.612, backward: 9.981, update: 0.414
[proc 0] 300 steps, total: 22.596, sample: 1.125, forward: 4.051, backward: 14.998, update: 2.314
[proc 2] 300 steps, total: 22.596, sample: 0.903, forward: 4.747, backward: 9.970, update: 0.393
[proc 3] 300 steps, total: 22.596, sample: 1.019, forward: 4.716, backward: 9.885, update: 0.381
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.612 ms                  | 105.497 ms                |
| bucket keys               | 2.687 ms                  | 3.902 ms                  |
| forward: a2a keys         | 3.081 ms                  | 32.519 ms                 |
| forward: search cache     | 281.183 us                | 368.105 us                |
| forward: a2a values       | 9.962 ms                  | 26.365 ms                 |
| forward: join             | 2.615 ms                  | 3.490 ms                  |
| Forward                   | 38.402 ms                 | 94.235 ms                 |
| back: aggr dram keys      | 41.282 ms                 | 70.724 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.646 ms                  |
| back: a2a grad            | 14.184 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.585 ms                 |
| Backward                  | 146.568 ms                | 194.643 ms                |
| Optimize                  | 22.904 ms                 | 44.105 ms                 |
| BarrierTimeBeforeRank0    | 46.682 us                 | 84.800 us                 |
| BlockToStepN              | 45.938 us                 | 11.729 ms                 |
| OneStep                   | 218.444 ms                | 354.820 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.736 ms                  | 105.497 ms                |
| bucket keys               | 2.693 ms                  | 3.902 ms                  |
| forward: a2a keys         | 3.066 ms                  | 32.330 ms                 |
| forward: search cache     | 281.591 us                | 368.466 us                |
| forward: a2a values       | 9.962 ms                  | 26.365 ms                 |
| forward: join             | 2.615 ms                  | 3.490 ms                  |
| Forward                   | 38.202 ms                 | 94.235 ms                 |
| back: aggr dram keys      | 41.282 ms                 | 70.724 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.491 ms                  |
| back: a2a grad            | 14.189 ms                 | 33.376 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.585 ms                 |
| Backward                  | 146.815 ms                | 194.643 ms                |
| Optimize                  | 22.937 ms                 | 44.105 ms                 |
| BarrierTimeBeforeRank0    | 46.906 us                 | 84.800 us                 |
| BlockToStepN              | 44.129 us                 | 13.299 ms                 |
| OneStep                   | 218.444 ms                | 354.820 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.775 ms                  | 101.525 ms                |
| bucket keys               | 2.692 ms                  | 3.913 ms                  |
| forward: a2a keys         | 3.066 ms                  | 32.330 ms                 |
| forward: search cache     | 281.055 us                | 374.234 us                |
| forward: a2a values       | 9.884 ms                  | 26.365 ms                 |
| forward: join             | 2.615 ms                  | 3.490 ms                  |
| Forward                   | 38.239 ms                 | 89.146 ms                 |
| back: aggr dram keys      | 41.282 ms                 | 70.724 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.512 ms                  |
| back: a2a grad            | 14.207 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.585 ms                 |
| Backward                  | 146.815 ms                | 192.073 ms                |
| Optimize                  | 22.929 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 46.912 us                 | 84.509 us                 |
| BlockToStepN              | 43.053 us                 | 13.069 ms                 |
| OneStep                   | 218.471 ms                | 344.306 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.612 ms                  | 101.525 ms                |
| bucket keys               | 2.692 ms                  | 3.902 ms                  |
| forward: a2a keys         | 3.104 ms                  | 32.330 ms                 |
| forward: search cache     | 280.760 us                | 374.234 us                |
| forward: a2a values       | 9.884 ms                  | 24.589 ms                 |
| forward: join             | 2.616 ms                  | 3.490 ms                  |
| Forward                   | 38.502 ms                 | 89.146 ms                 |
| back: aggr dram keys      | 41.548 ms                 | 70.724 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.682 ms                  |
| back: a2a grad            | 14.207 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 4.939 ms                  | 64.585 ms                 |
| Backward                  | 147.189 ms                | 192.073 ms                |
| Optimize                  | 22.909 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 46.912 us                 | 84.509 us                 |
| BlockToStepN              | 42.905 us                 | 13.069 ms                 |
| OneStep                   | 218.540 ms                | 344.306 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 23.109, sample: 0.831, forward: 4.991, backward: 10.069, update: 0.448
[proc 1] 400 steps, total: 23.109, sample: 0.939, forward: 4.878, backward: 10.473, update: 0.368
[proc 4] 400 steps, total: 23.109, sample: 0.994, forward: 4.846, backward: 10.077, update: 0.425
[proc 3] 400 steps, total: 23.109, sample: 1.009, forward: 4.826, backward: 10.084, update: 0.457
[proc 0] 400 steps, total: 23.109, sample: 1.084, forward: 4.303, backward: 15.317, update: 2.282
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.476 ms                  | 101.525 ms                |
| bucket keys               | 2.692 ms                  | 3.902 ms                  |
| forward: a2a keys         | 3.134 ms                  | 32.330 ms                 |
| forward: search cache     | 280.760 us                | 374.234 us                |
| forward: a2a values       | 9.884 ms                  | 24.589 ms                 |
| forward: join             | 2.616 ms                  | 3.601 ms                  |
| Forward                   | 38.576 ms                 | 89.146 ms                 |
| back: aggr dram keys      | 41.282 ms                 | 70.724 ms                 |
| back: set dram grad       | 3.011 ms                  | 4.701 ms                  |
| back: a2a grad            | 14.247 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 5.267 ms                  | 64.820 ms                 |
| Backward                  | 147.321 ms                | 192.073 ms                |
| Optimize                  | 22.904 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 46.816 us                 | 84.509 us                 |
| BlockToStepN              | 41.590 us                 | 13.069 ms                 |
| OneStep                   | 218.540 ms                | 344.306 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.545 ms                  | 101.525 ms                |
| bucket keys               | 2.687 ms                  | 3.886 ms                  |
| forward: a2a keys         | 3.109 ms                  | 27.511 ms                 |
| forward: search cache     | 281.183 us                | 368.466 us                |
| forward: a2a values       | 9.884 ms                  | 22.266 ms                 |
| forward: join             | 2.616 ms                  | 3.601 ms                  |
| Forward                   | 38.502 ms                 | 89.146 ms                 |
| back: aggr dram keys      | 41.548 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.701 ms                  |
| back: a2a grad            | 14.247 ms                 | 33.376 ms                 |
| back: grad sum & grad cache  | 5.267 ms                  | 64.585 ms                 |
| Backward                  | 147.116 ms                | 192.073 ms                |
| Optimize                  | 22.905 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 46.912 us                 | 84.509 us                 |
| BlockToStepN              | 41.417 us                 | 13.069 ms                 |
| OneStep                   | 218.540 ms                | 344.306 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.522 ms                  | 101.525 ms                |
| bucket keys               | 2.687 ms                  | 3.902 ms                  |
| forward: a2a keys         | 3.070 ms                  | 31.825 ms                 |
| forward: search cache     | 280.760 us                | 368.466 us                |
| forward: a2a values       | 9.884 ms                  | 22.266 ms                 |
| forward: join             | 2.616 ms                  | 3.601 ms                  |
| Forward                   | 38.357 ms                 | 89.146 ms                 |
| back: aggr dram keys      | 41.282 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.011 ms                  | 4.701 ms                  |
| back: a2a grad            | 14.273 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 5.267 ms                  | 64.820 ms                 |
| Backward                  | 147.116 ms                | 192.073 ms                |
| Optimize                  | 22.905 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 47.030 us                 | 84.509 us                 |
| BlockToStepN              | 42.760 us                 | 13.299 ms                 |
| OneStep                   | 218.512 ms                | 344.306 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.455 ms                  | 100.409 ms                |
| bucket keys               | 2.691 ms                  | 4.096 ms                  |
| forward: a2a keys         | 3.075 ms                  | 32.330 ms                 |
| forward: search cache     | 279.796 us                | 374.234 us                |
| forward: a2a values       | 9.884 ms                  | 27.959 ms                 |
| forward: join             | 2.616 ms                  | 3.601 ms                  |
| Forward                   | 38.392 ms                 | 81.766 ms                 |
| back: aggr dram keys      | 41.548 ms                 | 70.724 ms                 |
| back: set dram grad       | 3.047 ms                  | 4.733 ms                  |
| back: a2a grad            | 14.273 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 5.267 ms                  | 64.820 ms                 |
| Backward                  | 146.937 ms                | 191.399 ms                |
| Optimize                  | 22.894 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 46.912 us                 | 84.207 us                 |
| BlockToStepN              | 42.090 us                 | 13.093 ms                 |
| OneStep                   | 218.890 ms                | 338.182 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.408 ms                  | 100.409 ms                |
| bucket keys               | 2.687 ms                  | 3.913 ms                  |
| forward: a2a keys         | 3.120 ms                  | 32.330 ms                 |
| forward: search cache     | 279.796 us                | 368.466 us                |
| forward: a2a values       | 8.392 ms                  | 26.365 ms                 |
| forward: join             | 2.616 ms                  | 3.570 ms                  |
| Forward                   | 38.493 ms                 | 81.766 ms                 |
| back: aggr dram keys      | 41.282 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.045 ms                  | 4.707 ms                  |
| back: a2a grad            | 14.200 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 5.267 ms                  | 64.585 ms                 |
| Backward                  | 146.937 ms                | 191.399 ms                |
| Optimize                  | 22.910 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 46.773 us                 | 84.207 us                 |
| BlockToStepN              | 41.146 us                 | 13.093 ms                 |
| OneStep                   | 218.902 ms                | 338.182 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 500 steps, total: 22.684, sample: 1.025, forward: 4.719, backward: 10.003, update: 0.432
[proc 1] 500 steps, total: 22.684, sample: 0.972, forward: 4.737, backward: 10.382, update: 0.397
[proc 2] 500 steps, total: 22.684, sample: 0.896, forward: 4.842, backward: 9.977, update: 0.423
[proc 3] 500 steps, total: 22.684, sample: 0.985, forward: 4.813, backward: 9.927, update: 0.412
[proc 0] 500 steps, total: 22.684, sample: 1.051, forward: 4.286, backward: 14.883, update: 2.339
Successfully xmh. training takes 122.45939803123474 seconds
before call kg_cache_controller.StopThreads()
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
INFO [2894 controller_process.py:421] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.408 ms                  | 100.409 ms                |
| bucket keys               | 2.691 ms                  | 3.913 ms                  |
| forward: a2a keys         | 3.120 ms                  | 32.330 ms                 |
| forward: search cache     | 280.455 us                | 368.466 us                |
| forward: a2a values       | 7.417 ms                  | 26.365 ms                 |
| forward: join             | 2.616 ms                  | 3.570 ms                  |
| Forward                   | 38.488 ms                 | 81.766 ms                 |
| back: aggr dram keys      | 41.548 ms                 | 70.642 ms                 |
| back: set dram grad       | 3.073 ms                  | 4.707 ms                  |
| back: a2a grad            | 14.121 ms                 | 34.392 ms                 |
| back: grad sum & grad cache  | 5.267 ms                  | 64.585 ms                 |
| Backward                  | 146.815 ms                | 191.399 ms                |
| Optimize                  | 22.937 ms                 | 40.738 ms                 |
| BarrierTimeBeforeRank0    | 46.682 us                 | 84.207 us                 |
| BlockToStepN              | 40.517 us                 | 13.093 ms                 |
| OneStep                   | 218.890 ms                | 338.182 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 05:49:07.767824  4005 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_29', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [4005 sampler.py:454] Start PreSampling
WARNING [4005 sampler.py:532] Before construct renumbering_dict
WARNING [4005 sampler.py:555] PreSampling done
W20240207 06:07:53.442806  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 06:07:53.443006  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 06:07:53.443046  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 06:07:53.443081  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 06:07:53.443114  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 06:07:53.443147  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 06:07:53.443177  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 06:07:53.443222  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 06:07:53.443259  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 06:07:53.443295  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 06:07:53.443348  4005 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 06:07:53.443375  4005 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 06:07:53.443404  4005 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 06:07:53.443590  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 06:07:53.443625  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 06:07:53.443656  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 06:07:53.443706  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 06:07:53.443738  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 06:07:53.443768  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 06:07:53.443805  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 06:07:53.443836  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 06:07:53.443869  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 06:07:53.443903  4005 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 06:07:53.443934  4005 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 06:07:53.443957  4005 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 06:07:53.443987  4005 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 06:07:53.970408  4005 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x1000098ca000 128.2 GB
W20240207 06:16:28.379287  4005 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102018502000 328.3 MB
{0: Graph(num_nodes=43196088, num_edges=182879791,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=47371617, num_edges=163853044,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 43196088 N 182879791 E
MertisPartition: part 1 has 47371617 N 163853044 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 24862891, 27748820, 20932263]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4302714,  4302743,   630130,  ..., 23514032, 28284356, 71631739]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2156.091 seconds
INFO [5188 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [4005 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [5188 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [4005 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
WARNING [5188 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [4005 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 06:25:13.300240  5189 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240207 06:25:13.300612  5232 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
E20240207 06:25:13.525921  5232 recstore.cc:66] init folly done
E20240207 06:25:13.525925  5189 recstore.cc:66] init folly done
I20240207 06:25:38.227413  5232 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240207 06:25:40.661862  5189 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 13.646 ms                 | 105.445 ms                |
| bucket keys               | 1.619 ms                  | 103.860 ms                |
| forward: a2a keys         | 955.451 us                | 632.358 ms                |
| forward: search cache     | 137.721 us                | 19.951 ms                 |
| forward: a2a values       | 780.471 us                | 7.802 ms                  |
| forward: join             | 1.493 ms                  | 2.844 ms                  |
| Forward                   | 30.071 ms                 | 1.055 s                   |
| back: aggr dram keys      | 16.840 ms                 | 160.945 ms                |
| back: set dram grad       | 2.843 ms                  | 5.939 ms                  |
| back: a2a grad            | 2.071 ms                  | 8.545 ms                  |
| back: grad sum & grad cache  | 938.690 us                | 18.455 ms                 |
| Backward                  | 74.188 ms                 | 373.683 ms                |
| Optimize                  | 14.918 ms                 | 50.494 ms                 |
| BarrierTimeBeforeRank0    | 51.464 us                 | 92.592 us                 |
| BlockToStepN              | 18.143 us                 | 56.301 us                 |
| OneStep                   | 129.049 ms                | 1.529 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.516 ms                  | 108.816 ms                |
| bucket keys               | 2.432 ms                  | 4.999 ms                  |
| forward: a2a keys         | 909.465 us                | 203.414 ms                |
| forward: search cache     | 151.073 us                | 439.525 us                |
| forward: a2a values       | 1.368 ms                  | 7.494 ms                  |
| forward: join             | 1.493 ms                  | 3.384 ms                  |
| Forward                   | 25.294 ms                 | 1.055 s                   |
| back: aggr dram keys      | 16.840 ms                 | 52.531 ms                 |
| back: set dram grad       | 2.721 ms                  | 3.402 ms                  |
| back: a2a grad            | 2.167 ms                  | 5.125 ms                  |
| back: grad sum & grad cache  | 1.174 ms                  | 12.127 ms                 |
| Backward                  | 75.288 ms                 | 373.683 ms                |
| Optimize                  | 14.114 ms                 | 50.494 ms                 |
| BarrierTimeBeforeRank0    | 57.373 us                 | 96.880 us                 |
| BlockToStepN              | 21.598 us                 | 156.770 us                |
| OneStep                   | 124.206 ms                | 1.529 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.672 ms                  | 105.445 ms                |
| bucket keys               | 2.392 ms                  | 4.999 ms                  |
| forward: a2a keys         | 823.705 us                | 130.711 ms                |
| forward: search cache     | 151.073 us                | 395.046 us                |
| forward: a2a values       | 1.368 ms                  | 4.478 ms                  |
| forward: join             | 1.493 ms                  | 3.384 ms                  |
| Forward                   | 24.324 ms                 | 225.882 ms                |
| back: aggr dram keys      | 16.840 ms                 | 48.985 ms                 |
| back: set dram grad       | 2.781 ms                  | 5.498 ms                  |
| back: a2a grad            | 4.362 ms                  | 5.156 ms                  |
| back: grad sum & grad cache  | 1.849 ms                  | 12.127 ms                 |
| Backward                  | 76.388 ms                 | 104.662 ms                |
| Optimize                  | 14.198 ms                 | 39.476 ms                 |
| BarrierTimeBeforeRank0    | 51.464 us                 | 92.592 us                 |
| BlockToStepN              | 21.480 us                 | 135.219 us                |
| OneStep                   | 122.542 ms                | 428.569 ms                |
+---------------------------+---------------------------+---------------------------+
[Rank1] pid = 5188
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414)]
train_sampler.Prefill()
-------Step 0-------
tensor([1716345, 1716386, 1716436, 1764591, 1716472, 1716510, 1716551,   19440,
        1716597, 1716627]) tensor([  241937,  4657066, 16606689, 51632473, 32667648, 15756727, 64062883,
         8721008, 48994303, 69742571])
-------Step 1-------
tensor([1716345, 1716386, 1716436, 1764591, 1716472, 1716510, 1716551,   19440,
        1716597, 1716627]) tensor([65458236, 59419842, 58869947, 41560352, 39043003,   221644, 27546629,
        49255582, 67215181, 82656936])
-------Step 2-------
tensor([1813869, 1813891, 1813920, 1813947, 1813985, 1814017, 1814046, 1814072,
        1773114, 1814100]) tensor([18091632, 15127145, 43532139, 67320881, 36878031,  2048302, 40605008,
        46065814, 60886230, 13528264])
-------Step 3-------
tensor([1813869, 1813891, 1813920, 1813947, 1813985, 1814017, 1814046, 1814072,
        1773114, 1814100]) tensor([43964167, 84371987,  2354307, 29255652, 48594184, 38967480, 32901972,
        44740037, 60314182, 24280891])
-------Step 4-------
tensor([ 1891392,  1891409,   332464,  1891433,   332483, 48752270,   976877,
         1891449,  1891475,  1891503]) tensor([  680735, 69744584, 27612042, 37206812, 85298979, 59014041, 56741733,
        32432855, 25404284, 41195189])
-------Step 5-------
tensor([ 1891392,  1891409,   332464,  1891433,   332483, 48752270,   976877,
         1891449,  1891475,  1891503]) tensor([56065086, 40357439, 50866544, 16235266, 24949578, 63459199, 46804273,
        11159842, 66514694, 83050742])
-------Step 6-------
tensor([ 1949213,  1949231,  1949247,   479455,  1949262,  1949281,  1949299,
        14907164,  1949312,  4331691]) tensor([16033409, 32175907,  6265493,  1531137, 18070398, 17233120,  2756684,
         1506873, 83568898, 23032050])
-------Step 7-------
tensor([ 1949213,  1949231,  1949247,   479455,  1949262,  1949281,  1949299,
        14907164,  1949312,  4331691]) tensor([74953661, 76798461, 71791408,  2039869,  9030779, 39697870, 74503332,
        72595913, 58429354,  9215277])
-------Step 8-------
tensor([1992469, 1992486, 1992504,  481723, 1992517, 1992530, 1992545,  334431,
        1992559, 1992575]) tensor([82529507, 83780459,   548132,  4357193, 39577510, 31523869, 64254174,
        81327231, 35137301, 23534937])
-------Step 9-------
tensor([1992469, 1992486, 1992504,  481723, 1992517, 1992530, 1992545,  334431,
        1992559, 1992575]) tensor([  713131, 39619602, 18896591, 73191953, 32045649,  1480363, 20983631,
        35037599, 25450298, 64075103])
before start barrier
start train
[proc 0] 100 steps, total: 15.421, sample: 1.420, forward: 4.331, backward: 8.081, update: 1.471
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 17.856, sample: 2.391, forward: 4.169, backward: 6.475, update: 0.403
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.729 ms                  | 105.445 ms                |
| bucket keys               | 2.392 ms                  | 4.999 ms                  |
| forward: a2a keys         | 805.235 us                | 130.711 ms                |
| forward: search cache     | 150.480 us                | 395.046 us                |
| forward: a2a values       | 1.727 ms                  | 4.478 ms                  |
| forward: join             | 1.493 ms                  | 3.384 ms                  |
| Forward                   | 24.064 ms                 | 225.882 ms                |
| back: aggr dram keys      | 16.840 ms                 | 62.535 ms                 |
| back: set dram grad       | 2.797 ms                  | 5.939 ms                  |
| back: a2a grad            | 4.362 ms                  | 6.374 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 12.329 ms                 |
| Backward                  | 78.269 ms                 | 108.366 ms                |
| Optimize                  | 14.177 ms                 | 39.476 ms                 |
| BarrierTimeBeforeRank0    | 50.896 us                 | 96.880 us                 |
| BlockToStepN              | 21.266 us                 | 156.770 us                |
| OneStep                   | 123.933 ms                | 428.569 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.865 ms                  | 105.445 ms                |
| bucket keys               | 2.352 ms                  | 4.972 ms                  |
| forward: a2a keys         | 735.716 us                | 118.073 ms                |
| forward: search cache     | 146.331 us                | 371.294 us                |
| forward: a2a values       | 1.727 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.384 ms                  |
| Forward                   | 23.641 ms                 | 152.075 ms                |
| back: aggr dram keys      | 22.053 ms                 | 62.535 ms                 |
| back: set dram grad       | 2.811 ms                  | 6.632 ms                  |
| back: a2a grad            | 4.297 ms                  | 6.374 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 14.223 ms                 |
| Backward                  | 77.715 ms                 | 108.366 ms                |
| Optimize                  | 14.020 ms                 | 38.469 ms                 |
| BarrierTimeBeforeRank0    | 46.840 us                 | 92.592 us                 |
| BlockToStepN              | 20.403 us                 | 156.770 us                |
| OneStep                   | 123.131 ms                | 333.255 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.059 ms                  | 108.816 ms                |
| bucket keys               | 2.351 ms                  | 4.972 ms                  |
| forward: a2a keys         | 727.199 us                | 117.546 ms                |
| forward: search cache     | 149.512 us                | 354.713 us                |
| forward: a2a values       | 1.727 ms                  | 4.435 ms                  |
| forward: join             | 1.493 ms                  | 3.273 ms                  |
| Forward                   | 23.661 ms                 | 152.075 ms                |
| back: aggr dram keys      | 21.941 ms                 | 52.531 ms                 |
| back: set dram grad       | 2.797 ms                  | 5.939 ms                  |
| back: a2a grad            | 4.355 ms                  | 6.374 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 14.223 ms                 |
| Backward                  | 76.533 ms                 | 108.366 ms                |
| Optimize                  | 13.844 ms                 | 38.469 ms                 |
| BarrierTimeBeforeRank0    | 48.459 us                 | 96.880 us                 |
| BlockToStepN              | 21.234 us                 | 3.880 ms                  |
| OneStep                   | 122.071 ms                | 333.255 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 13.435, sample: 1.743, forward: 2.845, backward: 7.561, update: 1.202
[proc 1] 200 steps, total: 13.435, sample: 2.122, forward: 3.122, backward: 6.049, update: 0.328
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.863 ms                  | 108.816 ms                |
| bucket keys               | 2.347 ms                  | 4.972 ms                  |
| forward: a2a keys         | 727.199 us                | 116.546 ms                |
| forward: search cache     | 149.512 us                | 253.134 us                |
| forward: a2a values       | 1.727 ms                  | 4.435 ms                  |
| forward: join             | 1.493 ms                  | 3.254 ms                  |
| Forward                   | 23.923 ms                 | 152.075 ms                |
| back: aggr dram keys      | 21.941 ms                 | 48.985 ms                 |
| back: set dram grad       | 2.812 ms                  | 5.899 ms                  |
| back: a2a grad            | 4.355 ms                  | 5.957 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 14.072 ms                 |
| Backward                  | 75.371 ms                 | 108.366 ms                |
| Optimize                  | 13.782 ms                 | 38.469 ms                 |
| BarrierTimeBeforeRank0    | 48.240 us                 | 96.880 us                 |
| BlockToStepN              | 21.303 us                 | 3.880 ms                  |
| OneStep                   | 121.195 ms                | 333.255 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.614 ms                  | 105.445 ms                |
| bucket keys               | 2.338 ms                  | 4.976 ms                  |
| forward: a2a keys         | 720.079 us                | 116.546 ms                |
| forward: search cache     | 147.621 us                | 253.134 us                |
| forward: a2a values       | 1.727 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.254 ms                  |
| Forward                   | 23.959 ms                 | 139.509 ms                |
| back: aggr dram keys      | 23.374 ms                 | 48.985 ms                 |
| back: set dram grad       | 2.802 ms                  | 5.899 ms                  |
| back: a2a grad            | 4.355 ms                  | 6.374 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 14.223 ms                 |
| Backward                  | 76.016 ms                 | 105.212 ms                |
| Optimize                  | 13.567 ms                 | 37.541 ms                 |
| BarrierTimeBeforeRank0    | 46.326 us                 | 92.592 us                 |
| BlockToStepN              | 21.266 us                 | 3.880 ms                  |
| OneStep                   | 121.195 ms                | 331.257 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 300 steps, total: 13.160, sample: 1.287, forward: 2.844, backward: 7.674, update: 1.266
[proc 1] 300 steps, total: 13.160, sample: 1.650, forward: 3.039, backward: 6.293, update: 0.391
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.600 ms                  | 105.445 ms                |
| bucket keys               | 2.337 ms                  | 4.972 ms                  |
| forward: a2a keys         | 714.595 us                | 109.584 ms                |
| forward: search cache     | 146.331 us                | 247.581 us                |
| forward: a2a values       | 1.727 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.273 ms                  |
| Forward                   | 23.970 ms                 | 139.509 ms                |
| back: aggr dram keys      | 23.374 ms                 | 45.564 ms                 |
| back: set dram grad       | 2.802 ms                  | 5.939 ms                  |
| back: a2a grad            | 4.362 ms                  | 6.406 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 14.072 ms                 |
| Backward                  | 76.520 ms                 | 105.212 ms                |
| Optimize                  | 13.343 ms                 | 37.541 ms                 |
| BarrierTimeBeforeRank0    | 45.380 us                 | 92.592 us                 |
| BlockToStepN              | 21.405 us                 | 4.198 ms                  |
| OneStep                   | 121.427 ms                | 331.257 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.819 ms                  | 123.881 ms                |
| bucket keys               | 2.329 ms                  | 4.966 ms                  |
| forward: a2a keys         | 703.024 us                | 108.712 ms                |
| forward: search cache     | 142.821 us                | 247.581 us                |
| forward: a2a values       | 3.439 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.384 ms                  |
| Forward                   | 23.844 ms                 | 139.509 ms                |
| back: aggr dram keys      | 23.374 ms                 | 44.836 ms                 |
| back: set dram grad       | 2.797 ms                  | 5.939 ms                  |
| back: a2a grad            | 4.362 ms                  | 6.374 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 14.072 ms                 |
| Backward                  | 75.607 ms                 | 105.212 ms                |
| Optimize                  | 13.291 ms                 | 37.541 ms                 |
| BarrierTimeBeforeRank0    | 45.559 us                 | 96.880 us                 |
| BlockToStepN              | 21.650 us                 | 4.198 ms                  |
| OneStep                   | 121.011 ms                | 331.257 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.863 ms                  | 118.998 ms                |
| bucket keys               | 2.329 ms                  | 4.960 ms                  |
| forward: a2a keys         | 703.210 us                | 107.562 ms                |
| forward: search cache     | 141.049 us                | 246.852 us                |
| forward: a2a values       | 3.439 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.303 ms                  |
| Forward                   | 23.959 ms                 | 137.709 ms                |
| back: aggr dram keys      | 23.374 ms                 | 44.836 ms                 |
| back: set dram grad       | 2.797 ms                  | 5.899 ms                  |
| back: a2a grad            | 4.362 ms                  | 5.957 ms                  |
| back: grad sum & grad cache  | 2.080 ms                  | 13.929 ms                 |
| Backward                  | 74.786 ms                 | 104.662 ms                |
| Optimize                  | 12.975 ms                 | 19.485 ms                 |
| BarrierTimeBeforeRank0    | 45.380 us                 | 96.880 us                 |
| BlockToStepN              | 21.771 us                 | 3.880 ms                  |
| OneStep                   | 120.626 ms                | 322.904 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 400 steps, total: 12.883, sample: 1.803, forward: 2.976, backward: 5.964, update: 0.402
[proc 0] 400 steps, total: 12.883, sample: 1.744, forward: 2.541, backward: 7.263, update: 1.256
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.819 ms                  | 118.998 ms                |
| bucket keys               | 2.298 ms                  | 4.966 ms                  |
| forward: a2a keys         | 701.929 us                | 107.562 ms                |
| forward: search cache     | 140.213 us                | 246.852 us                |
| forward: a2a values       | 3.397 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.303 ms                  |
| Forward                   | 23.923 ms                 | 137.709 ms                |
| back: aggr dram keys      | 23.374 ms                 | 44.836 ms                 |
| back: set dram grad       | 2.797 ms                  | 5.899 ms                  |
| back: a2a grad            | 4.362 ms                  | 6.374 ms                  |
| back: grad sum & grad cache  | 8.309 ms                  | 15.237 ms                 |
| Backward                  | 74.568 ms                 | 104.662 ms                |
| Optimize                  | 12.750 ms                 | 37.541 ms                 |
| BarrierTimeBeforeRank0    | 44.919 us                 | 96.880 us                 |
| BlockToStepN              | 21.759 us                 | 3.880 ms                  |
| OneStep                   | 120.123 ms                | 322.904 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.729 ms                  | 118.998 ms                |
| bucket keys               | 2.283 ms                  | 4.966 ms                  |
| forward: a2a keys         | 699.214 us                | 106.871 ms                |
| forward: search cache     | 138.976 us                | 245.795 us                |
| forward: a2a values       | 3.397 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.273 ms                  |
| Forward                   | 23.848 ms                 | 137.116 ms                |
| back: aggr dram keys      | 23.522 ms                 | 45.564 ms                 |
| back: set dram grad       | 2.798 ms                  | 5.498 ms                  |
| back: a2a grad            | 4.362 ms                  | 5.957 ms                  |
| back: grad sum & grad cache  | 8.309 ms                  | 15.404 ms                 |
| Backward                  | 74.422 ms                 | 102.334 ms                |
| Optimize                  | 12.719 ms                 | 35.307 ms                 |
| BarrierTimeBeforeRank0    | 44.271 us                 | 94.181 us                 |
| BlockToStepN              | 21.880 us                 | 4.198 ms                  |
| OneStep                   | 120.052 ms                | 322.781 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.938 ms                  | 128.709 ms                |
| bucket keys               | 2.283 ms                  | 4.960 ms                  |
| forward: a2a keys         | 689.516 us                | 78.888 ms                 |
| forward: search cache     | 138.068 us                | 246.852 us                |
| forward: a2a values       | 3.397 ms                  | 4.470 ms                  |
| forward: join             | 1.493 ms                  | 3.273 ms                  |
| Forward                   | 23.660 ms                 | 137.116 ms                |
| back: aggr dram keys      | 23.374 ms                 | 45.564 ms                 |
| back: set dram grad       | 2.798 ms                  | 5.480 ms                  |
| back: a2a grad            | 4.362 ms                  | 5.947 ms                  |
| back: grad sum & grad cache  | 8.309 ms                  | 15.404 ms                 |
| Backward                  | 74.188 ms                 | 102.334 ms                |
| Optimize                  | 12.767 ms                 | 35.307 ms                 |
| BarrierTimeBeforeRank0    | 44.202 us                 | 96.880 us                 |
| BlockToStepN              | 21.790 us                 | 4.198 ms                  |
| OneStep                   | 120.123 ms                | 322.781 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 12.955, sample: 1.509, forward: 3.134, backward: 6.039, update: 0.420
[proc 0] 500 steps, total: 12.955, sample: 1.768, forward: 2.404, backward: 7.346, update: 1.334
Successfully xmh. training takes 67.85429692268372 seconds
before call kg_cache_controller.StopThreads()
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads
INFO [4005 controller_process.py:421] call rank0 to StopThreads

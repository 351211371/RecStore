WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240203 05:52:10.202977 53283 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_54', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [53283 sampler.py:454] Start PreSampling
WARNING [53283 sampler.py:532] Before construct renumbering_dict
WARNING [53283 sampler.py:555] PreSampling done
W20240203 06:11:52.859370 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240203 06:11:52.859548 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240203 06:11:52.859580 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240203 06:11:52.859618 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240203 06:11:52.859652 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240203 06:11:52.859688 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240203 06:11:52.859720 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240203 06:11:52.859761 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240203 06:11:52.859792 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240203 06:11:52.859833 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240203 06:11:52.859874 53283 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240203 06:11:52.859901 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240203 06:11:52.859927 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240203 06:11:52.860101 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240203 06:11:52.860142 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240203 06:11:52.860172 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240203 06:11:52.860220 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240203 06:11:52.860256 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240203 06:11:52.860285 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240203 06:11:52.860316 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240203 06:11:52.860342 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240203 06:11:52.860381 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240203 06:11:52.860419 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240203 06:11:52.860455 53283 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240203 06:11:52.860481 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240203 06:11:52.860505 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240203 06:11:52.860563 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240203 06:11:52.860599 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240203 06:11:52.860625 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240203 06:11:52.860649 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240203 06:11:52.860678 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240203 06:11:52.860707 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240203 06:11:52.860734 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240203 06:11:52.860772 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240203 06:11:52.860800 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240203 06:11:52.860833 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240203 06:11:52.860859 53283 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240203 06:11:52.860881 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240203 06:11:52.860911 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240203 06:11:52.860970 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240203 06:11:52.861008 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240203 06:11:52.861037 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240203 06:11:52.861063 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240203 06:11:52.861091 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240203 06:11:52.861124 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240203 06:11:52.861160 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240203 06:11:52.861192 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240203 06:11:52.861232 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240203 06:11:52.861261 53283 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240203 06:11:52.861289 53283 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240203 06:11:52.861311 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240203 06:11:52.861335 53283 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240203 06:11:53.313766 53283 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240203 06:20:34.381619 53283 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Rank2: cached key size 2151353
Rank3: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 8605436,  8605460,   105185,  ..., 72686089, 19929726,  4713797]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2214.910 seconds
[Rank1] pid = 22822
[Rank2] pid = 22918
INFO [22822 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [53283 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [22985 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [22918 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [22822 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [22918 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [22985 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [53283 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240203 06:29:11.176223 22823 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [8605415, 400]; dev=1; size=12.82 GB
W20240203 06:29:11.177819 23049 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [8605415, 400]; dev=0; size=12.82 GB
W20240203 06:29:11.178232 22986 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [8605415, 400]; dev=3; size=12.82 GB
W20240203 06:29:11.178285 22919 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [8605415, 400]; dev=2; size=12.82 GB
W20240203 06:29:11.249904 22986 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036619000 7.629 MB
W20240203 06:29:11.249996 22919 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x102036dbc000 7.629 MB
W20240203 06:29:11.250010 22823 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10203755f000 7.629 MB
W20240203 06:29:11.250011 23049 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102037d02000 7.629 MB
W20240203 06:29:11.250170 22986 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1020384a5000 7.629 MB
W20240203 06:29:11.250213 23049 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x102038c48000 7.629 MB
W20240203 06:29:11.250219 22919 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020393eb000 7.629 MB
W20240203 06:29:11.250236 22823 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102039b8e000 7.629 MB
W20240203 06:29:11.250278 22986 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x10203a331000 1.49 GB
W20240203 06:29:11.250283 23049 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x102099914000 1.49 GB
W20240203 06:29:11.250310 22823 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240203 06:29:11.250326 22986 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1021584da000 1.49 GB
W20240203 06:29:11.250332 22919 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1021b7abd000 1.49 GB
W20240203 06:29:11.250335 23049 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1022170a0000 1.49 GB
W20240203 06:29:11.250365 22823 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x102276683000 1.49 GB
W20240203 06:29:11.250386 22919 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1022d5c66000 1.49 GB
W20240203 06:29:11.250404 22986 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240203 06:29:11.250423 23049 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240203 06:29:11.250427 22823 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240203 06:29:11.250435 22919 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240203 06:29:11.257133 23049 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240203 06:29:11.257144 22823 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240203 06:29:11.257202 22986 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240203 06:29:11.257213 22919 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [22822 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [22918 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 22985
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 8605415), (8605415, 17210830), (17210830, 25816245), (25816245, 34421660)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [53283 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [22985 DistTensor.py:59] The tensor name already exists in the kvstore
I20240203 06:29:46.197664 22986 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240203 06:29:46.197948 22919 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240203 06:29:46.198030 23049 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240203 06:29:46.198117 22823 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240203 06:29:46.199970 23049 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.1,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240203 06:29:46.200109 23049 grad_base.h:184] Init GradProcessingBase done
I20240203 06:29:58.865475 23049 grad_async_v2.h:42] Use main thread to update emb.
W20240203 06:29:58.865597 23049 kg_controller.h:78] after init GradAsyncProcessingV2
I20240203 06:29:58.865607 23049 kg_controller.h:84] Construct KGCacheController done
E20240203 06:29:59.321033 23049 recstore.cc:66] init folly done
E20240203 06:29:59.321041 22986 recstore.cc:66] init folly done
E20240203 06:29:59.321056 22919 recstore.cc:66] init folly done
E20240203 06:29:59.321065 22823 recstore.cc:66] init folly done
I20240203 06:29:59.321892 23049 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240203 06:30:11.524456 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240203 06:30:11.524848 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240203 06:30:12.810153 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240203 06:30:12.810281 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 150.649 us                | 455.550 us                |
+---------------------------+---------------------------+---------------------------+
W20240203 06:30:16.909992 26596 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240203 06:30:16.962352 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240203 06:30:17.032974 22986 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 143.867 us                | 270.210 us                |
+---------------------------+---------------------------+---------------------------+
W20240203 06:30:19.802403 26596 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240203 06:30:19.821554 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240203 06:30:19.915989 22919 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240203 06:30:20.493487 22823 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240203 06:30:21.062719 26596 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240203 06:30:21.086793 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240203 06:30:21.215720 23049 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240203 06:30:22.620607 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240203 06:30:22.831377 23049 grad_async_v2.h:257] pq is empty
W20240203 06:30:22.835273 26596 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240203 06:30:22.881173 23049 grad_async_v2.h:257] pq is empty
W20240203 06:30:22.969308 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=3, pq.top=3
E20240203 06:30:23.620018 27185 parallel_pq_v2.h:79] insert failed, size(hashtable)=11797
W20240203 06:30:24.014417 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=15, pq.top=15
W20240203 06:30:24.073179 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240203 06:30:24.079030 24797 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=16, sample_step_cpp_seen_[rank]=15
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 231.207 us                | 3.720 ms                  |
| ProcessBack:Shuffle       | 2.716 ms                  | 166.626 ms                |
| ProcessBack:UpdateCache   | 3.006 ms                  | 264.805 ms                |
| ProcessBack:UpsertPq      | 22.083 ms                 | 208.761 ms                |
| ProcessOneStep            | 53.874 ms                 | 712.963 ms                |
| BlockToStepN              | 756.699 us                | 2.694 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:24.620061 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240203 06:30:25.129701 26596 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end2
E20240203 06:30:25.620014 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=39
W20240203 06:30:25.882922 23049 grad_async_v2.h:257] pq is empty
W20240203 06:30:26.080425 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=29, pq.top=29
W20240203 06:30:26.175719 26596 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.356 ms                  | 127.317 ms                |
| Forward                   | 5.400 ms                  | 657.492 ms                |
| Backward                  | 4.929 ms                  | 184.482 ms                |
| Optimize                  | 2.335 ms                  | 5.516 ms                  |
| BarrierTimeBeforeRank0    | 936.813 us                | 59.037 ms                 |
| AfterBackward             | 60.201 ms                 | 713.525 ms                |
| BlockToStepN              | 347.740 us                | 2.768 ms                  |
| OneStep                   | 89.837 ms                 | 1.616 s                   |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:26.620008 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1342
W20240203 06:30:27.214547 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=41, pq.top=41
W20240203 06:30:27.526132 26596 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
E20240203 06:30:27.628854 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=19557
W20240203 06:30:28.620529 26596 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
E20240203 06:30:28.628036 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=5
W20240203 06:30:29.236704 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=59, pq.top=59
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 335.804 us                | 3.950 ms                  |
| ProcessBack:Shuffle       | 2.880 ms                  | 126.746 ms                |
| ProcessBack:UpdateCache   | 3.138 ms                  | 263.943 ms                |
| ProcessBack:UpsertPq      | 39.169 ms                 | 103.872 ms                |
| ProcessOneStep            | 60.357 ms                 | 535.555 ms                |
| BlockToStepN              | 257.231 us                | 2.694 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:29.429818 23049 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=62, sample_step_cpp_seen_[rank]=61
E20240203 06:30:29.628011 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=81
W20240203 06:30:29.646507 23049 grad_async_v2.h:257] pq is empty
W20240203 06:30:29.816251 26596 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240203 06:30:30.628010 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=547
W20240203 06:30:30.869735 26596 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end4
W20240203 06:30:30.995182 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=76, pq.top=76
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.005 ms                  | 110.509 ms                |
| Forward                   | 5.298 ms                  | 6.398 ms                  |
| Backward                  | 4.929 ms                  | 7.509 ms                  |
| Optimize                  | 2.318 ms                  | 14.539 ms                 |
| BarrierTimeBeforeRank0    | 416.017 us                | 55.806 ms                 |
| AfterBackward             | 60.392 ms                 | 535.608 ms                |
| BlockToStepN              | 285.770 us                | 6.285 ms                  |
| OneStep                   | 89.837 ms                 | 597.329 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:31.628010 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=35
W20240203 06:30:31.878652 26596 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240203 06:30:32.628007 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=2084
W20240203 06:30:32.923497 26596 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end1
W20240203 06:30:33.132030 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=93, pq.top=93
E20240203 06:30:33.628023 27187 parallel_pq_v2.h:79] insert failed, size(hashtable)=17790
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 13.750, sample: 1.480, forward: 1.181, backward: 0.646, update: 0.228
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 16.633, sample: 1.425, forward: 1.170, backward: 0.779, update: 0.247
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 13.173, sample: 1.199, forward: 1.222, backward: 0.699, update: 0.245
train_sampler.Prefill()
-------Step 0-------
tensor([ 1501014,   787168, 55088461,  2027016,   504199,   787205,   787247,
          215649,  1501048,  1501086]) tensor([ 9084130, 34666870,  1060090, 61166624, 46005759,  2089767, 66917793,
        75180246, 48277548, 84519951])
-------Step 1-------
tensor([ 1501014,   787168, 55088461,  2027016,   504199,   787205,   787247,
          215649,  1501048,  1501086]) tensor([36707920, 81295193, 82759288, 13417856, 51486450, 12036195, 84678193,
        65320679, 19551769, 30671092])
-------Step 2-------
tensor([  896161,  1517128, 58990457,  1517180,   896209,   896255,   896296,
        37692119,   896335,   896369]) tensor([43420793,  9098263, 70174388, 13250544, 21388583, 17865891, 70643087,
        14583815, 48199767, 31534658])
-------Step 3-------
tensor([  896161,  1517128, 58990457,  1517180,   896209,   896255,   896296,
        37692119,   896335,   896369]) tensor([  353925, 50270530,  1803637, 36115881, 16728817, 77170481, 59684440,
        65159847, 30281938, 75357856])
-------Step 4-------
tensor([1004336, 1533098, 1004389, 1004431, 1533129, 1004466, 1533177, 1004501,
        1533230, 1004545]) tensor([ 3839641, 48677070, 18409697,  1974299, 65765784, 54279768, 77200109,
        46054162, 68190613, 14206150])
-------Step 5-------
tensor([1004336, 1533098, 1004389, 1004431, 1533129, 1004466, 1533177, 1004501,
        1533230, 1004545]) tensor([30715659, 55065915, 84146822, 12675290, 44322640,   645513, 45098940,
        78576677, 86040422,  1263782])
-------Step 6-------
tensor([61698256,  1110894,  1110924,  1110957,  8609919,  1110987,  1111019,
         1111056,  1111089,   221177]) tensor([33984703, 37702207, 25608104, 20672275, 61161378, 68160221, 48038087,
        16980271, 71249827, 13091084])
-------Step 7-------
tensor([61698256,  1110894,  1110924,  1110957,  8609919,  1110987,  1111019,
         1111056,  1111089,   221177]) tensor([37498766, 85784478, 46637460, 78573203, 56320555,  2677178, 18598499,
        43333050, 21334309, 21365768])
-------Step 8-------
tensor([ 1218946,  1566762,  1218990, 32887818,  2050313,  1219033,  1219080,
         1219107,   222871,  2050330]) tensor([24660051, 67100971, 55589566, 85258878, 67954843, 53015394, 72039740,
        83129800, 13567282,  7558479])
-------Step 9-------
tensor([ 1218946,  1566762,  1218990, 32887818,  2050313,  1219033,  1219080,
         1219107,   222871,  2050330]) tensor([80395716, 75504965, 24443698, 38758571, 17202795,  2132539, 21022641,
        16327410, 77274378, 40916708])
before start barrier
start train
[proc 0] 100 steps, total: 12.450, sample: 1.445, forward: 1.163, backward: 0.680, update: 0.276
W20240203 06:30:34.054395 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 226.634 us                | 1.519 ms                  |
| ProcessBack:Shuffle       | 2.711 ms                  | 35.254 ms                 |
| ProcessBack:UpdateCache   | 3.225 ms                  | 9.616 ms                  |
| ProcessBack:UpsertPq      | 42.122 ms                 | 103.267 ms                |
| ProcessOneStep            | 64.905 ms                 | 535.555 ms                |
| BlockToStepN              | 213.402 us                | 28.873 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 06:30:34.449437 23049 grad_async_v2.h:257] pq is empty
E20240203 06:30:34.628010 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=14232
W20240203 06:30:34.904525 23049 grad_async_v2.h:257] pq is empty
W20240203 06:30:35.083541 26596 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end6
W20240203 06:30:35.311906 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=107, pq.top=107
E20240203 06:30:35.628012 24797 parallel_pq_v2.h:79] insert failed, size(hashtable)=212
W20240203 06:30:36.163403 26596 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.314 ms                  | 111.888 ms                |
| Forward                   | 5.104 ms                  | 12.110 ms                 |
| Backward                  | 4.804 ms                  | 7.509 ms                  |
| Optimize                  | 2.221 ms                  | 14.539 ms                 |
| BarrierTimeBeforeRank0    | 485.259 us                | 55.806 ms                 |
| AfterBackward             | 65.878 ms                 | 655.082 ms                |
| BlockToStepN              | 305.739 us                | 28.939 ms                 |
| OneStep                   | 94.501 ms                 | 672.383 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 06:30:36.425398 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=119, pq.top=119
E20240203 06:30:36.563191 23049 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=120, sample_step_cpp_seen_[rank]=119
E20240203 06:30:36.628012 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=387
W20240203 06:30:37.179766 26596 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240203 06:30:37.474874 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=125, pq.top=125
E20240203 06:30:37.628038 27189 parallel_pq_v2.h:79] insert failed, size(hashtable)=21456
W20240203 06:30:38.192142 26596 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
E20240203 06:30:38.628007 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=186
W20240203 06:30:38.641993 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=139, pq.top=139
W20240203 06:30:39.266064 26596 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 295.416 us                | 3.199 ms                  |
| ProcessBack:Shuffle       | 2.687 ms                  | 31.496 ms                 |
| ProcessBack:UpdateCache   | 3.247 ms                  | 4.324 ms                  |
| ProcessBack:UpsertPq      | 35.119 ms                 | 103.267 ms                |
| ProcessOneStep            | 59.486 ms                 | 655.037 ms                |
| BlockToStepN              | 274.371 us                | 28.873 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:39.628021 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=8377
W20240203 06:30:40.344031 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
W20240203 06:30:40.450968 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=153, pq.top=153
E20240203 06:30:40.628008 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=3745
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.613 ms                  | 142.989 ms                |
| Forward                   | 5.104 ms                  | 8.678 ms                  |
| Backward                  | 4.710 ms                  | 7.509 ms                  |
| Optimize                  | 2.221 ms                  | 5.516 ms                  |
| BarrierTimeBeforeRank0    | 61.583 us                 | 51.604 ms                 |
| AfterBackward             | 57.560 ms                 | 615.925 ms                |
| BlockToStepN              | 363.073 us                | 20.974 ms                 |
| OneStep                   | 84.862 ms                 | 641.956 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:41.628012 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=883
W20240203 06:30:41.635658 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
W20240203 06:30:42.027606 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=171, pq.top=171
E20240203 06:30:42.175025 24797 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=173, sample_step_cpp_seen_[rank]=172
E20240203 06:30:42.628011 24797 parallel_pq_v2.h:79] insert failed, size(hashtable)=165
W20240203 06:30:42.724314 26596 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end9
W20240203 06:30:43.206002 23049 grad_async_v2.h:257] pq is empty
E20240203 06:30:43.628006 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=118
W20240203 06:30:43.761291 26596 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240203 06:30:43.891749 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=185, pq.top=185
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 364.628 us                | 6.103 ms                  |
| ProcessBack:Shuffle       | 2.681 ms                  | 23.980 ms                 |
| ProcessBack:UpdateCache   | 3.250 ms                  | 4.279 ms                  |
| ProcessBack:UpsertPq      | 32.392 ms                 | 101.473 ms                |
| ProcessOneStep            | 56.109 ms                 | 615.842 ms                |
| BlockToStepN              | 346.696 us                | 20.906 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:44.630694 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240203 06:30:44.855132 26596 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
[proc 2] 200 steps, total: 11.908, sample: 1.147, forward: 0.492, backward: 0.481, update: 0.216
[proc 0] 200 steps, total: 11.908, sample: 1.836, forward: 0.498, backward: 0.475, update: 0.236
[proc 3] 200 steps, total: 11.908, sample: 1.235, forward: 0.478, backward: 0.558, update: 0.209
[proc 1] 200 steps, total: 11.908, sample: 1.490, forward: 0.518, backward: 0.561, update: 0.201
E20240203 06:30:45.630007 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=13475
W20240203 06:30:45.876791 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end4
W20240203 06:30:46.105940 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=207, pq.top=207
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.824 ms                  | 142.989 ms                |
| Forward                   | 5.076 ms                  | 8.678 ms                  |
| Backward                  | 4.717 ms                  | 7.650 ms                  |
| Optimize                  | 2.210 ms                  | 5.516 ms                  |
| BarrierTimeBeforeRank0    | 32.008 us                 | 51.604 ms                 |
| AfterBackward             | 55.205 ms                 | 615.925 ms                |
| BlockToStepN              | 440.731 us                | 20.974 ms                 |
| OneStep                   | 83.662 ms                 | 641.956 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:46.630007 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=4627
W20240203 06:30:46.884090 26596 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240203 06:30:47.630013 24797 parallel_pq_v2.h:79] insert failed, size(hashtable)=22333
W20240203 06:30:47.646189 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=223, pq.top=223
W20240203 06:30:47.929771 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240203 06:30:48.505831 24797 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=233, sample_step_cpp_seen_[rank]=232
E20240203 06:30:48.636046 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240203 06:30:48.974120 26596 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240203 06:30:49.105165 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=235, pq.top=235
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 300.463 us                | 4.029 ms                  |
| ProcessBack:Shuffle       | 2.683 ms                  | 21.499 ms                 |
| ProcessBack:UpdateCache   | 3.249 ms                  | 4.224 ms                  |
| ProcessBack:UpsertPq      | 32.332 ms                 | 99.344 ms                 |
| ProcessOneStep            | 54.191 ms                 | 615.842 ms                |
| BlockToStepN              | 421.347 us                | 23.672 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:49.636013 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=61
W20240203 06:30:50.137223 26596 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
W20240203 06:30:50.227815 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=249, pq.top=249
E20240203 06:30:50.636008 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=466
W20240203 06:30:51.199796 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.356 ms                  | 136.709 ms                |
| Forward                   | 5.141 ms                  | 7.026 ms                  |
| Backward                  | 4.841 ms                  | 8.485 ms                  |
| Optimize                  | 2.251 ms                  | 5.557 ms                  |
| BarrierTimeBeforeRank0    | 30.209 us                 | 51.011 ms                 |
| AfterBackward             | 53.371 ms                 | 613.762 ms                |
| BlockToStepN              | 521.736 us                | 22.404 ms                 |
| OneStep                   | 81.606 ms                 | 639.780 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 06:30:51.282763 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=257, pq.top=257
E20240203 06:30:51.636015 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=8
W20240203 06:30:52.284072 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=269, pq.top=269
W20240203 06:30:52.295755 26596 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
E20240203 06:30:52.636008 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=1423
W20240203 06:30:53.376493 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=282, pq.top=282
W20240203 06:30:53.389503 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
E20240203 06:30:53.636016 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=6160
E20240203 06:30:53.829991 23049 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=289, sample_step_cpp_seen_[rank]=288
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 314.404 us                | 15.541 ms                 |
| ProcessBack:Shuffle       | 2.701 ms                  | 18.725 ms                 |
| ProcessBack:UpdateCache   | 3.224 ms                  | 4.117 ms                  |
| ProcessBack:UpsertPq      | 28.110 ms                 | 96.039 ms                 |
| ProcessOneStep            | 52.269 ms                 | 613.716 ms                |
| BlockToStepN              | 535.763 us                | 23.672 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 06:30:54.547979 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=295, pq.top=295
W20240203 06:30:54.572155 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end5
E20240203 06:30:54.636009 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1524
[proc 1] 300 steps, total: 9.343, sample: 1.058, forward: 0.510, backward: 0.465, update: 0.210
[proc 0] 300 steps, total: 9.343, sample: 1.370, forward: 0.536, backward: 0.528, update: 0.276
[proc 2] 300 steps, total: 9.343, sample: 0.976, forward: 0.510, backward: 0.542, update: 0.205
[proc 3] 300 steps, total: 9.343, sample: 0.819, forward: 0.539, backward: 0.530, update: 0.207
W20240203 06:30:55.566562 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=308, pq.top=308
E20240203 06:30:55.636018 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=4
W20240203 06:30:55.723817 26596 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.469 ms                  | 136.709 ms                |
| Forward                   | 5.172 ms                  | 7.283 ms                  |
| Backward                  | 4.802 ms                  | 9.797 ms                  |
| Optimize                  | 2.267 ms                  | 5.861 ms                  |
| BarrierTimeBeforeRank0    | 29.524 us                 | 51.604 ms                 |
| AfterBackward             | 51.942 ms                 | 613.762 ms                |
| BlockToStepN              | 639.103 us                | 28.939 ms                 |
| OneStep                   | 80.552 ms                 | 639.780 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:56.636006 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=34380
W20240203 06:30:56.704632 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=317, pq.top=317
W20240203 06:30:56.735198 26596 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end8
E20240203 06:30:57.636013 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1487
W20240203 06:30:57.737581 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
W20240203 06:30:57.808156 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=327, pq.top=327
E20240203 06:30:58.636008 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=41348
W20240203 06:30:58.881218 26596 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
W20240203 06:30:59.129086 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=343, pq.top=343
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 432.449 us                | 15.498 ms                 |
| ProcessBack:Shuffle       | 2.711 ms                  | 14.426 ms                 |
| ProcessBack:UpdateCache   | 3.234 ms                  | 4.105 ms                  |
| ProcessBack:UpsertPq      | 24.625 ms                 | 95.282 ms                 |
| ProcessOneStep            | 51.327 ms                 | 613.716 ms                |
| BlockToStepN              | 625.576 us                | 30.348 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 06:30:59.563409 24797 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=349, sample_step_cpp_seen_[rank]=348
E20240203 06:30:59.636011 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240203 06:31:00.019011 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
W20240203 06:31:00.459851 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=361, pq.top=361
E20240203 06:31:00.636011 27180 parallel_pq_v2.h:79] insert failed, size(hashtable)=62255
W20240203 06:31:01.176107 26596 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.613 ms                  | 127.317 ms                |
| Forward                   | 5.163 ms                  | 8.470 ms                  |
| Backward                  | 4.870 ms                  | 9.797 ms                  |
| Optimize                  | 2.269 ms                  | 5.557 ms                  |
| BarrierTimeBeforeRank0    | 31.093 us                 | 51.011 ms                 |
| AfterBackward             | 50.758 ms                 | 563.758 ms                |
| BlockToStepN              | 745.022 us                | 30.878 ms                 |
| OneStep                   | 80.039 ms                 | 614.437 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 06:31:01.636018 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240203 06:31:01.779306 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=375, pq.top=375
W20240203 06:31:02.360338 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240203 06:31:02.636015 27181 parallel_pq_v2.h:79] insert failed, size(hashtable)=19094
W20240203 06:31:02.789213 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=385, pq.top=385
W20240203 06:31:03.364609 26596 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
E20240203 06:31:03.636013 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=65924
[proc 0] 400 steps, total: 9.059, sample: 0.974, forward: 0.532, backward: 0.563, update: 0.247
[proc 3] 400 steps, total: 9.059, sample: 1.099, forward: 0.498, backward: 0.537, update: 0.205
[proc 2] 400 steps, total: 9.059, sample: 1.150, forward: 0.495, backward: 0.549, update: 0.211
[proc 1] 400 steps, total: 9.059, sample: 1.277, forward: 0.492, backward: 0.469, update: 0.207
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 435.637 us                | 27.330 ms                 |
| ProcessBack:Shuffle       | 2.708 ms                  | 14.426 ms                 |
| ProcessBack:UpdateCache   | 3.206 ms                  | 4.106 ms                  |
| ProcessBack:UpsertPq      | 23.396 ms                 | 94.011 ms                 |
| ProcessOneStep            | 50.547 ms                 | 563.715 ms                |
| BlockToStepN              | 767.890 us                | 33.757 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 06:31:04.452484 26596 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
W20240203 06:31:04.526764 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=401, pq.top=401
E20240203 06:31:04.636008 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=23228
W20240203 06:31:05.550348 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=416, pq.top=416
W20240203 06:31:05.572903 26596 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
E20240203 06:31:05.636008 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=2464
E20240203 06:31:05.742492 23049 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=418, sample_step_cpp_seen_[rank]=417
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.155 ms                  | 127.317 ms                |
| Forward                   | 5.173 ms                  | 8.523 ms                  |
| Backward                  | 4.977 ms                  | 9.797 ms                  |
| Optimize                  | 2.279 ms                  | 5.557 ms                  |
| BarrierTimeBeforeRank0    | 31.205 us                 | 51.011 ms                 |
| AfterBackward             | 50.550 ms                 | 563.758 ms                |
| BlockToStepN              | 880.144 us                | 39.537 ms                 |
| OneStep                   | 78.960 ms                 | 614.437 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 06:31:06.583221 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=429, pq.top=429
W20240203 06:31:06.592945 26596 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end9
E20240203 06:31:06.641002 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
E20240203 06:31:07.640007 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=614
W20240203 06:31:07.725943 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=440, pq.top=440
W20240203 06:31:07.743758 26596 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
E20240203 06:31:08.640017 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=6182
W20240203 06:31:08.747884 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 415.150 us                | 13.251 ms                 |
| ProcessBack:Shuffle       | 2.716 ms                  | 17.600 ms                 |
| ProcessBack:UpdateCache   | 3.225 ms                  | 4.279 ms                  |
| ProcessBack:UpsertPq      | 22.810 ms                 | 93.587 ms                 |
| ProcessOneStep            | 50.436 ms                 | 540.148 ms                |
| BlockToStepN              | 901.763 us                | 48.136 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 06:31:09.410310 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=455, pq.top=455
E20240203 06:31:09.640008 23049 parallel_pq_v2.h:79] insert failed, size(hashtable)=6569
W20240203 06:31:09.829028 26596 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
W20240203 06:31:10.465502 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=467, pq.top=467
E20240203 06:31:10.640012 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=70366
E20240203 06:31:10.742007 23049 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=470, sample_step_cpp_seen_[rank]=469
W20240203 06:31:10.913828 26596 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.709 ms                  | 124.731 ms                |
| Forward                   | 5.182 ms                  | 8.523 ms                  |
| Backward                  | 4.995 ms                  | 9.797 ms                  |
| Optimize                  | 2.285 ms                  | 5.557 ms                  |
| BarrierTimeBeforeRank0    | 30.936 us                 | 50.027 ms                 |
| AfterBackward             | 50.342 ms                 | 540.203 ms                |
| BlockToStepN              | 1.029 ms                  | 55.793 ms                 |
| OneStep                   | 78.058 ms                 | 597.329 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 06:31:11.640018 27174 parallel_pq_v2.h:79] insert failed, size(hashtable)=38538
W20240203 06:31:11.812019 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=477, pq.top=476
W20240203 06:31:12.025346 26596 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end1
E20240203 06:31:12.640008 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=34713
W20240203 06:31:13.033843 26596 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
W20240203 06:31:13.132964 23049 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=488, pq.top=487
E20240203 06:31:13.640012 24797 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240203 06:31:14.049389 26596 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
[proc 1] 500 steps, total: 10.123, sample: 0.839, forward: 0.529, backward: 0.570, update: 0.214
[proc 0] 500 steps, total: 10.124, sample: 0.820, forward: 0.516, backward: 0.508, update: 0.248
[proc 2] 500 steps, total: 10.124, sample: 0.786, forward: 0.537, backward: 0.513, update: 0.245
[proc 3] 500 steps, total: 10.124, sample: 0.854, forward: 0.519, backward: 0.479, update: 0.215
Successfully xmh. training takes 52.884227991104126 seconds
before call kg_cache_controller.StopThreads()
W20240203 06:31:14.099933 23049 grad_async_v2.h:84] call StopThreads. PID = 53283
W20240203 06:31:14.099959 23049 grad_base.h:212] before processOneStepNegThread_.join();
W20240203 06:31:14.100164 23049 grad_base.h:214] after processOneStepNegThread_.join();
W20240203 06:31:14.100175 23049 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 521.351 us                | 25.724 ms                 |
| ProcessBack:Shuffle       | 2.718 ms                  | 14.560 ms                 |
| ProcessBack:UpdateCache   | 3.219 ms                  | 4.279 ms                  |
| ProcessBack:UpsertPq      | 22.260 ms                 | 92.466 ms                 |
| ProcessOneStep            | 50.134 ms                 | 563.715 ms                |
| BlockToStepN              | 1.299 ms                  | 59.745 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 06:31:14.640012 26596 parallel_pq_v2.h:79] insert failed, size(hashtable)=6151
W20240203 06:31:14.893402 23049 grad_async_v2.h:105] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.524 ms                  | 124.731 ms                |
| Forward                   | 5.172 ms                  | 8.523 ms                  |
| Backward                  | 4.977 ms                  | 9.797 ms                  |
| Optimize                  | 2.287 ms                  | 5.557 ms                  |
| BarrierTimeBeforeRank0    | 30.742 us                 | 50.027 ms                 |
| AfterBackward             | 50.174 ms                 | 563.758 ms                |
| BlockToStepN              | 1.369 ms                  | 59.880 ms                 |
| OneStep                   | 77.840 ms                 | 614.437 ms                |
+---------------------------+---------------------------+---------------------------+

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240202 15:19:49.116024 10436 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_100', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=8, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=8, gpu=[0, 1, 2, 3, 4, 5, 6, 7], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [10436 sampler.py:454] Start PreSampling
WARNING [10436 sampler.py:532] Before construct renumbering_dict
WARNING [10436 sampler.py:555] PreSampling done
W20240202 15:19:53.962571 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240202 15:19:53.962873 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240202 15:19:53.962917 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240202 15:19:53.962960 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240202 15:19:53.963019 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240202 15:19:53.963059 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240202 15:19:53.963099 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240202 15:19:53.963227 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240202 15:19:53.963294 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240202 15:19:53.963341 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240202 15:19:53.963387 10436 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240202 15:19:53.963423 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240202 15:19:53.963474 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240202 15:19:53.963629 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240202 15:19:53.963680 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240202 15:19:53.963724 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240202 15:19:53.963794 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240202 15:19:53.963835 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240202 15:19:53.963871 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240202 15:19:53.963914 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240202 15:19:53.963970 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240202 15:19:53.964025 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240202 15:19:53.964079 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240202 15:19:53.964129 10436 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240202 15:19:53.964161 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240202 15:19:53.964195 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240202 15:19:53.964277 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240202 15:19:53.964344 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240202 15:19:53.964385 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240202 15:19:53.964426 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240202 15:19:53.964469 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240202 15:19:53.964505 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240202 15:19:53.964553 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240202 15:19:53.964589 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240202 15:19:53.964651 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240202 15:19:53.964699 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240202 15:19:53.964733 10436 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240202 15:19:53.964764 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240202 15:19:53.964795 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240202 15:19:53.964869 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240202 15:19:53.964915 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240202 15:19:53.964951 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240202 15:19:53.964995 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240202 15:19:53.965031 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240202 15:19:53.965067 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240202 15:19:53.965103 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240202 15:19:53.965147 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240202 15:19:53.965191 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240202 15:19:53.965229 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240202 15:19:53.965270 10436 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240202 15:19:53.965301 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240202 15:19:53.965332 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240202 15:19:53.965406 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240202 15:19:53.965445 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240202 15:19:53.965487 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240202 15:19:53.965538 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240202 15:19:53.965587 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240202 15:19:53.965629 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240202 15:19:53.965672 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240202 15:19:53.965708 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240202 15:19:53.965749 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240202 15:19:53.965797 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240202 15:19:53.965833 10436 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240202 15:19:53.965865 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240202 15:19:53.965906 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240202 15:19:53.965992 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240202 15:19:53.966042 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240202 15:19:53.966078 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240202 15:19:53.966136 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240202 15:19:53.966178 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240202 15:19:53.966224 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240202 15:19:53.966261 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240202 15:19:53.966321 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240202 15:19:53.966367 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240202 15:19:53.966404 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240202 15:19:53.966440 10436 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240202 15:19:53.966471 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240202 15:19:53.966511 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240202 15:19:53.966576 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x10001ca5a000 7.629 MB
W20240202 15:19:53.966621 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x10001d1fd000 7.629 MB
W20240202 15:19:53.966670 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_2 [1000000]0x10001d9a0000 7.629 MB
W20240202 15:19:53.966713 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_3 [1000000]0x10001e143000 7.629 MB
W20240202 15:19:53.966769 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_4 [1000000]0x10001e8e6000 7.629 MB
W20240202 15:19:53.966807 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_5 [1000000]0x10001f089000 7.629 MB
W20240202 15:19:53.966843 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_6 [1000000]0x10001f82c000 7.629 MB
W20240202 15:19:53.966900 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_7 [1000000]0x10001ffcf000 7.629 MB
W20240202 15:19:53.966946 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_8 [1000000]0x100020772000 7.629 MB
W20240202 15:19:53.966991 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_9 [1000000]0x100020f15000 7.629 MB
W20240202 15:19:53.967054 10436 IPCTensor.h:369] NewIPCTensor: step_r6 [10]0x1000216b8000 80 B 
W20240202 15:19:53.967087 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x1000216ba000 8 B 
W20240202 15:19:53.967119 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x1000216bc000 8 B 
W20240202 15:19:53.967197 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_0 [1000000]0x1000216be000 7.629 MB
W20240202 15:19:53.967263 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_1 [1000000]0x100021e61000 7.629 MB
W20240202 15:19:53.967310 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_2 [1000000]0x100022604000 7.629 MB
W20240202 15:19:53.967351 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_3 [1000000]0x100022da7000 7.629 MB
W20240202 15:19:53.967399 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_4 [1000000]0x10002354a000 7.629 MB
W20240202 15:19:53.967455 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_5 [1000000]0x100023ced000 7.629 MB
W20240202 15:19:53.967499 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_6 [1000000]0x100024490000 7.629 MB
W20240202 15:19:53.967543 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_7 [1000000]0x100024c33000 7.629 MB
W20240202 15:19:53.967584 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_8 [1000000]0x1000253d6000 7.629 MB
W20240202 15:19:53.967630 10436 IPCTensor.h:369] NewIPCTensor: cached_sampler_r7_9 [1000000]0x100025b79000 7.629 MB
W20240202 15:19:53.967692 10436 IPCTensor.h:369] NewIPCTensor: step_r7 [10]0x10002631c000 80 B 
W20240202 15:19:53.967725 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r7 [1]0x10002631e000 8 B 
W20240202 15:19:53.967765 10436 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r7 [1]0x100026320000 8 B 
W20240202 15:19:54.223322 10436 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100026322000 22.81 MB
W20240202 15:19:54.318293 10436 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000279f4000 58.4 kB
{0: Graph(num_nodes=8499, num_edges=86694,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=6140, num_edges=88951,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=8646, num_edges=109741,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=8503, num_edges=86907,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10597, num_edges=122217,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8255, num_edges=102550,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=7422, num_edges=104094,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 7: Graph(num_nodes=7815, num_edges=137832,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8499 N 86694 E
MertisPartition: part 1 has 6140 N 88951 E
MertisPartition: part 2 has 8646 N 109741 E
MertisPartition: part 3 has 8503 N 86907 E
MertisPartition: part 4 has 10597 N 122217 E
MertisPartition: part 5 has 8255 N 102550 E
MertisPartition: part 6 has 7422 N 104094 E
MertisPartition: part 7 has 7815 N 137832 E
Rank0: cached key size 93
Rank1: cached key size 93
Rank2: cached key size 93
Rank3: cached key size 93
Rank4: cached key size 93
Rank5: cached key size 93
Rank6: cached key size 93
Rank7: cached key size 93
Before renumbering graph:  {'_ID': tensor([    0,    15,    36,  ..., 11946,  9147, 13282]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
After renumbering graph:  {'_ID': tensor([ 755, 1148, 1863,  ..., 9538, 9843, 7810]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 6, 3, 7])}
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8499, num_edges=86694,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.307 seconds
[Rank1] pid = 10861
[Rank2] pid = 10892
[Rank3] pid = 10989
[Rank4] pid = 10991
[Rank5] pid = 11117
[Rank6] pid = 11118
INFO [10436 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [10861 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [10892 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [10989 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [10991 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [11118 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [11117 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [11120 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 7
INFO [10991 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11118 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11117 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [11120 distributed_c10d.py:476] Rank 7: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [10892 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [10989 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [10436 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
INFO [10861 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 8 nodes.
WARNING [11120 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [10991 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [11118 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [11117 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [10892 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [10436 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [10861 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [10989 DistTensor.py:59] The tensor name already exists in the kvstore
I20240202 15:19:57.003652 10990 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 8
I20240202 15:19:57.003727 11210 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240202 15:19:57.003796 11119 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240202 15:19:57.003857 11054 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240202 15:19:57.003926 11222 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240202 15:19:57.003998 10926 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240202 15:19:57.004063 11167 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
I20240202 15:19:57.004107 10862 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 8
E20240202 15:19:57.781052 11222 recstore.cc:66] init folly done
E20240202 15:19:57.781052 10990 recstore.cc:66] init folly done
E20240202 15:19:57.781114 11119 recstore.cc:66] init folly done
E20240202 15:19:57.781795 11054 recstore.cc:66] init folly done
E20240202 15:19:57.781800 11210 recstore.cc:66] init folly done
E20240202 15:19:57.781966 10862 recstore.cc:66] init folly done
E20240202 15:19:57.782218 10926 recstore.cc:66] init folly done
E20240202 15:19:57.782305 11167 recstore.cc:66] init folly done
I20240202 15:19:57.863476 10862 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 8
I20240202 15:19:57.863878 11119 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240202 15:19:57.864620 10990 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240202 15:19:57.865787 10926 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240202 15:19:57.866508 11222 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240202 15:19:57.867347 11167 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240202 15:19:57.869573 11210 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
I20240202 15:19:57.872193 11054 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.515 ms                  | 3.111 ms                  |
| bucket keys               | 2.855 ms                  | 132.662 ms                |
| forward: a2a keys         | 4.610 ms                  | 1.347 s                   |
| forward: search cache     | 461.161 us                | 24.506 ms                 |
| forward: a2a values       | 5.968 ms                  | 13.504 ms                 |
| forward: join             | 2.964 ms                  | 5.144 ms                  |
| Forward                   | 43.004 ms                 | 2.073 s                   |
| back: aggr dram keys      | 44.903 ms                 | 933.115 ms                |
| back: set dram grad       | 3.320 ms                  | 4.829 ms                  |
| back: a2a grad            | 8.279 ms                  | 11.094 ms                 |
| back: grad sum & grad cache  | 5.139 ms                  | 7.083 ms                  |
| Backward                  | 150.706 ms                | 1.227 s                   |
| Optimize                  | 39.403 ms                 | 41.200 ms                 |
| BarrierTimeBeforeRank0    | 53.886 us                 | 108.540 us                |
| BlockToStepN              | 22.038 us                 | 95.755 us                 |
| OneStep                   | 236.682 ms                | 3.342 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.607 ms                  | 26.418 ms                 |
| bucket keys               | 2.897 ms                  | 8.128 ms                  |
| forward: a2a keys         | 3.569 ms                  | 13.609 ms                 |
| forward: search cache     | 469.729 us                | 573.442 us                |
| forward: a2a values       | 4.336 ms                  | 9.901 ms                  |
| forward: join             | 2.973 ms                  | 5.144 ms                  |
| Forward                   | 39.501 ms                 | 2.073 s                   |
| back: aggr dram keys      | 49.770 ms                 | 75.434 ms                 |
| back: set dram grad       | 3.323 ms                  | 4.829 ms                  |
| back: a2a grad            | 8.148 ms                  | 12.257 ms                 |
| back: grad sum & grad cache  | 6.354 ms                  | 9.590 ms                  |
| Backward                  | 135.968 ms                | 1.227 s                   |
| Optimize                  | 25.880 ms                 | 41.200 ms                 |
| BarrierTimeBeforeRank0    | 53.951 us                 | 108.540 us                |
| BlockToStepN              | 22.333 us                 | 193.159 us                |
| OneStep                   | 205.317 ms                | 3.342 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.615 ms                  | 26.418 ms                 |
| bucket keys               | 2.979 ms                  | 8.128 ms                  |
| forward: a2a keys         | 3.008 ms                  | 13.609 ms                 |
| forward: search cache     | 470.603 us                | 1.224 ms                  |
| forward: a2a values       | 4.296 ms                  | 9.901 ms                  |
| forward: join             | 2.964 ms                  | 5.144 ms                  |
| Forward                   | 36.767 ms                 | 56.292 ms                 |
| back: aggr dram keys      | 48.479 ms                 | 75.434 ms                 |
| back: set dram grad       | 3.315 ms                  | 4.829 ms                  |
| back: a2a grad            | 7.987 ms                  | 13.976 ms                 |
| back: grad sum & grad cache  | 6.279 ms                  | 9.590 ms                  |
| Backward                  | 133.452 ms                | 158.084 ms                |
| Optimize                  | 26.773 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 53.089 us                 | 97.173 us                 |
| BlockToStepN              | 21.459 us                 | 95.755 us                 |
| OneStep                   | 203.263 ms                | 242.038 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.653 ms                  | 28.183 ms                 |
| bucket keys               | 2.951 ms                  | 6.137 ms                  |
| forward: a2a keys         | 2.904 ms                  | 15.496 ms                 |
| forward: search cache     | 470.339 us                | 1.224 ms                  |
| forward: a2a values       | 4.245 ms                  | 9.901 ms                  |
| forward: join             | 2.991 ms                  | 5.047 ms                  |
| Forward                   | 36.659 ms                 | 60.463 ms                 |
| back: aggr dram keys      | 47.801 ms                 | 69.085 ms                 |
| back: set dram grad       | 3.271 ms                  | 4.172 ms                  |
| back: a2a grad            | 7.998 ms                  | 13.997 ms                 |
| back: grad sum & grad cache  | 6.196 ms                  | 9.962 ms                  |
| Backward                  | 133.257 ms                | 162.117 ms                |
| Optimize                  | 27.984 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 50.099 us                 | 97.173 us                 |
| BlockToStepN              | 16.935 us                 | 193.159 us                |
| OneStep                   | 203.925 ms                | 257.423 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 24.064, sample: 0.467, forward: 6.046, backward: 14.299, update: 0.436
[Rank7] pid = 11120
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229), (5229, 5976)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 2063,    29,  4537,    85, 11603, 12284,  1222,  9777, 12134, 12083]) tensor([ 1863,  5672,  6444,  6664, 12960,  1096,  3225,  5979,   537,  7554])
-------Step 1-------
tensor([ 2063,    29,  4537,    85, 11603, 12284,  1222,  9777, 12134, 12083]) tensor([ 5387, 11636,  6616,  6699,  2097,  5692,  6062,  5101, 12097, 11400])
-------Step 2-------
tensor([ 1898, 13180,  8332, 13278, 13121,  4255, 13808, 10248,  7556, 12414]) tensor([ 9531,  5051,  1265,  8457, 13527,  4343,   125,  4185,   136, 14144])
-------Step 3-------
tensor([ 1898, 13180,  8332, 13278, 13121,  4255, 13808, 10248,  7556, 12414]) tensor([11123, 11696,  9220, 10905,  7472, 12401,  9788,  7112, 10034, 13129])
-------Step 4-------
tensor([ 3050,    58, 13900, 12100,  6144, 13853, 13939,  4866,    17, 10367]) tensor([ 8601,  8534,   525,  6807, 13036, 12663, 12679,  2488,  7416,   455])
-------Step 5-------
tensor([ 3050,    58, 13900, 12100,  6144, 13853, 13939,  4866,    17, 10367]) tensor([ 3348,  2806, 12404,  1354,  5700, 14742, 11277, 13105,  5440,  7752])
-------Step 6-------
tensor([ 7509, 11767,  7887,  4438,  9902,   973,  9058,  9779, 14438,  9570]) tensor([10170,  7183, 14077,  2715,  2667,  4866,  8463,  3716,  4431,  2646])
-------Step 7-------
tensor([ 7509, 11767,  7887,  4438,  9902,   973,  9058,  9779, 14438,  9570]) tensor([ 5867, 12485,  7982,  7766, 13986,  2052,  6478,   272, 13149, 14875])
-------Step 8-------
tensor([12606,  4009,  7491, 12017,  3682, 10030, 12100,  3794,  2610,   803]) tensor([ 3698, 10438,  2112,  5581, 11320, 12719, 11113,  8377, 13345,  5354])
-------Step 9-------
tensor([12606,  4009,  7491, 12017,  3682, 10030, 12100,  3794,  2610,   803]) tensor([ 5306, 11367, 10744,   230,  5556,  7290,  3218,  4249,  3605, 13554])
before start barrier
start train
[proc 0] 100 steps, total: 24.063, sample: 0.479, forward: 6.092, backward: 14.507, update: 2.860
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 24.065, sample: 0.450, forward: 6.054, backward: 14.251, update: 0.492
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 24.058, sample: 0.436, forward: 6.062, backward: 14.293, update: 0.507
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 24.066, sample: 0.462, forward: 6.049, backward: 14.291, update: 0.444
train_sampler.Prefill()
before start barrier
start train
[proc 7] 100 steps, total: 24.064, sample: 0.423, forward: 6.091, backward: 14.255, update: 0.448
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 24.061, sample: 0.461, forward: 6.052, backward: 14.266, update: 0.493
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 24.067, sample: 0.437, forward: 6.083, backward: 14.261, update: 0.394
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.667 ms                  | 28.183 ms                 |
| bucket keys               | 2.949 ms                  | 6.137 ms                  |
| forward: a2a keys         | 2.868 ms                  | 29.948 ms                 |
| forward: search cache     | 469.729 us                | 1.238 ms                  |
| forward: a2a values       | 4.240 ms                  | 9.901 ms                  |
| forward: join             | 2.976 ms                  | 5.144 ms                  |
| Forward                   | 37.250 ms                 | 65.612 ms                 |
| back: aggr dram keys      | 47.801 ms                 | 69.085 ms                 |
| back: set dram grad       | 3.265 ms                  | 4.172 ms                  |
| back: a2a grad            | 8.023 ms                  | 13.997 ms                 |
| back: grad sum & grad cache  | 6.191 ms                  | 9.993 ms                  |
| Backward                  | 133.735 ms                | 166.853 ms                |
| Optimize                  | 28.437 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 48.847 us                 | 97.173 us                 |
| BlockToStepN              | 16.652 us                 | 193.159 us                |
| OneStep                   | 205.937 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.666 ms                  | 28.916 ms                 |
| bucket keys               | 2.935 ms                  | 6.137 ms                  |
| forward: a2a keys         | 2.836 ms                  | 33.698 ms                 |
| forward: search cache     | 469.464 us                | 1.238 ms                  |
| forward: a2a values       | 4.194 ms                  | 9.901 ms                  |
| forward: join             | 2.991 ms                  | 5.144 ms                  |
| Forward                   | 37.410 ms                 | 69.403 ms                 |
| back: aggr dram keys      | 47.801 ms                 | 69.085 ms                 |
| back: set dram grad       | 3.276 ms                  | 5.333 ms                  |
| back: a2a grad            | 7.987 ms                  | 13.997 ms                 |
| back: grad sum & grad cache  | 6.211 ms                  | 9.993 ms                  |
| Backward                  | 133.872 ms                | 166.853 ms                |
| Optimize                  | 27.305 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 47.820 us                 | 97.173 us                 |
| BlockToStepN              | 19.725 us                 | 193.159 us                |
| OneStep                   | 207.765 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.653 ms                  | 28.916 ms                 |
| bucket keys               | 2.933 ms                  | 6.137 ms                  |
| forward: a2a keys         | 2.891 ms                  | 33.698 ms                 |
| forward: search cache     | 468.883 us                | 1.238 ms                  |
| forward: a2a values       | 4.187 ms                  | 9.465 ms                  |
| forward: join             | 2.991 ms                  | 5.433 ms                  |
| Forward                   | 37.611 ms                 | 77.116 ms                 |
| back: aggr dram keys      | 47.740 ms                 | 67.191 ms                 |
| back: set dram grad       | 3.277 ms                  | 6.379 ms                  |
| back: a2a grad            | 7.996 ms                  | 13.976 ms                 |
| back: grad sum & grad cache  | 6.205 ms                  | 10.395 ms                 |
| Backward                  | 134.421 ms                | 166.853 ms                |
| Optimize                  | 26.870 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 47.673 us                 | 97.173 us                 |
| BlockToStepN              | 19.725 us                 | 193.159 us                |
| OneStep                   | 208.583 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.653 ms                  | 28.916 ms                 |
| bucket keys               | 2.934 ms                  | 6.207 ms                  |
| forward: a2a keys         | 2.891 ms                  | 33.698 ms                 |
| forward: search cache     | 468.477 us                | 1.238 ms                  |
| forward: a2a values       | 4.185 ms                  | 9.465 ms                  |
| forward: join             | 2.991 ms                  | 5.433 ms                  |
| Forward                   | 37.955 ms                 | 74.759 ms                 |
| back: aggr dram keys      | 47.853 ms                 | 69.085 ms                 |
| back: set dram grad       | 3.280 ms                  | 6.379 ms                  |
| back: a2a grad            | 8.016 ms                  | 13.976 ms                 |
| back: grad sum & grad cache  | 6.239 ms                  | 10.475 ms                 |
| Backward                  | 134.587 ms                | 165.052 ms                |
| Optimize                  | 26.611 ms                 | 39.403 ms                 |
| BarrierTimeBeforeRank0    | 47.569 us                 | 79.891 us                 |
| BlockToStepN              | 18.814 us                 | 148.989 us                |
| OneStep                   | 209.528 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.653 ms                  | 28.916 ms                 |
| bucket keys               | 2.946 ms                  | 6.207 ms                  |
| forward: a2a keys         | 2.933 ms                  | 33.193 ms                 |
| forward: search cache     | 468.954 us                | 1.224 ms                  |
| forward: a2a values       | 4.202 ms                  | 9.337 ms                  |
| forward: join             | 2.982 ms                  | 5.144 ms                  |
| Forward                   | 38.913 ms                 | 74.759 ms                 |
| back: aggr dram keys      | 47.966 ms                 | 67.191 ms                 |
| back: set dram grad       | 3.305 ms                  | 6.379 ms                  |
| back: a2a grad            | 8.040 ms                  | 13.202 ms                 |
| back: grad sum & grad cache  | 6.249 ms                  | 10.893 ms                 |
| Backward                  | 134.956 ms                | 165.052 ms                |
| Optimize                  | 26.680 ms                 | 39.403 ms                 |
| BarrierTimeBeforeRank0    | 47.569 us                 | 79.891 us                 |
| BlockToStepN              | 19.725 us                 | 148.989 us                |
| OneStep                   | 211.992 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 7] 200 steps, total: 21.676, sample: 0.479, forward: 4.767, backward: 13.389, update: 0.486
[proc 0] 200 steps, total: 21.676, sample: 0.487, forward: 4.818, backward: 13.714, update: 2.544
[proc 3] 200 steps, total: 21.676, sample: 0.458, forward: 4.778, backward: 13.451, update: 0.456
[proc 2] 200 steps, total: 21.676, sample: 0.416, forward: 4.835, backward: 13.453, update: 0.461
[proc 5] 200 steps, total: 21.676, sample: 0.431, forward: 4.811, backward: 13.449, update: 0.449
[proc 4] 200 steps, total: 21.676, sample: 0.479, forward: 4.759, backward: 13.446, update: 0.430
[proc 6] 200 steps, total: 21.676, sample: 0.474, forward: 4.767, backward: 13.442, update: 0.465
[proc 1] 200 steps, total: 21.676, sample: 0.431, forward: 4.807, backward: 13.446, update: 0.427
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.653 ms                  | 28.916 ms                 |
| bucket keys               | 2.951 ms                  | 6.207 ms                  |
| forward: a2a keys         | 2.945 ms                  | 33.698 ms                 |
| forward: search cache     | 469.675 us                | 1.238 ms                  |
| forward: a2a values       | 4.194 ms                  | 9.465 ms                  |
| forward: join             | 2.986 ms                  | 5.433 ms                  |
| Forward                   | 38.986 ms                 | 74.759 ms                 |
| back: aggr dram keys      | 48.070 ms                 | 67.191 ms                 |
| back: set dram grad       | 3.319 ms                  | 6.569 ms                  |
| back: a2a grad            | 8.067 ms                  | 13.202 ms                 |
| back: grad sum & grad cache  | 6.260 ms                  | 10.893 ms                 |
| Backward                  | 134.976 ms                | 165.052 ms                |
| Optimize                  | 26.421 ms                 | 39.403 ms                 |
| BarrierTimeBeforeRank0    | 47.143 us                 | 79.891 us                 |
| BlockToStepN              | 20.403 us                 | 148.989 us                |
| OneStep                   | 212.034 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.636 ms                  | 29.696 ms                 |
| bucket keys               | 2.956 ms                  | 6.194 ms                  |
| forward: a2a keys         | 2.909 ms                  | 33.591 ms                 |
| forward: search cache     | 469.729 us                | 1.224 ms                  |
| forward: a2a values       | 4.202 ms                  | 9.337 ms                  |
| forward: join             | 2.979 ms                  | 5.433 ms                  |
| Forward                   | 39.100 ms                 | 74.759 ms                 |
| back: aggr dram keys      | 48.179 ms                 | 67.118 ms                 |
| back: set dram grad       | 3.319 ms                  | 6.528 ms                  |
| back: a2a grad            | 8.042 ms                  | 13.059 ms                 |
| back: grad sum & grad cache  | 6.279 ms                  | 10.893 ms                 |
| Backward                  | 134.872 ms                | 165.052 ms                |
| Optimize                  | 26.696 ms                 | 39.808 ms                 |
| BarrierTimeBeforeRank0    | 46.904 us                 | 79.891 us                 |
| BlockToStepN              | 20.668 us                 | 148.989 us                |
| OneStep                   | 212.608 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.659 ms                  | 29.527 ms                 |
| bucket keys               | 2.947 ms                  | 6.194 ms                  |
| forward: a2a keys         | 2.945 ms                  | 34.937 ms                 |
| forward: search cache     | 469.797 us                | 1.224 ms                  |
| forward: a2a values       | 4.219 ms                  | 9.337 ms                  |
| forward: join             | 2.976 ms                  | 5.595 ms                  |
| Forward                   | 39.501 ms                 | 76.786 ms                 |
| back: aggr dram keys      | 48.312 ms                 | 67.118 ms                 |
| back: set dram grad       | 3.333 ms                  | 6.569 ms                  |
| back: a2a grad            | 8.072 ms                  | 13.059 ms                 |
| back: grad sum & grad cache  | 6.306 ms                  | 10.940 ms                 |
| Backward                  | 135.592 ms                | 164.943 ms                |
| Optimize                  | 26.987 ms                 | 40.642 ms                 |
| BarrierTimeBeforeRank0    | 47.120 us                 | 74.380 us                 |
| BlockToStepN              | 20.632 us                 | 133.247 us                |
| OneStep                   | 212.972 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.666 ms                  | 29.527 ms                 |
| bucket keys               | 2.958 ms                  | 6.137 ms                  |
| forward: a2a keys         | 2.964 ms                  | 34.008 ms                 |
| forward: search cache     | 470.339 us                | 1.221 ms                  |
| forward: a2a values       | 4.229 ms                  | 9.337 ms                  |
| forward: join             | 2.989 ms                  | 5.433 ms                  |
| Forward                   | 39.889 ms                 | 76.786 ms                 |
| back: aggr dram keys      | 48.223 ms                 | 70.111 ms                 |
| back: set dram grad       | 3.341 ms                  | 6.528 ms                  |
| back: a2a grad            | 8.090 ms                  | 13.059 ms                 |
| back: grad sum & grad cache  | 6.331 ms                  | 11.186 ms                 |
| Backward                  | 136.150 ms                | 164.943 ms                |
| Optimize                  | 27.108 ms                 | 40.642 ms                 |
| BarrierTimeBeforeRank0    | 47.148 us                 | 75.671 us                 |
| BlockToStepN              | 20.510 us                 | 148.989 us                |
| OneStep                   | 213.279 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 300 steps, total: 22.339, sample: 0.440, forward: 4.929, backward: 13.652, update: 0.438
[proc 1] 300 steps, total: 22.339, sample: 0.407, forward: 4.975, backward: 13.615, update: 0.457
[proc 0] 300 steps, total: 22.339, sample: 0.499, forward: 4.939, backward: 13.926, update: 2.851
[proc 2] 300 steps, total: 22.339, sample: 0.430, forward: 4.947, backward: 13.649, update: 0.424
[proc 4] 300 steps, total: 22.339, sample: 0.470, forward: 4.902, backward: 13.638, update: 0.440
[proc 7] 300 steps, total: 22.339, sample: 0.464, forward: 4.913, backward: 13.566, update: 0.386
[proc 5] 300 steps, total: 22.339, sample: 0.445, forward: 4.935, backward: 13.627, update: 0.363
[proc 6] 300 steps, total: 22.339, sample: 0.427, forward: 4.961, backward: 13.610, update: 0.443
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.666 ms                  | 29.527 ms                 |
| bucket keys               | 2.956 ms                  | 6.137 ms                  |
| forward: a2a keys         | 3.006 ms                  | 34.008 ms                 |
| forward: search cache     | 470.107 us                | 1.221 ms                  |
| forward: a2a values       | 4.224 ms                  | 9.465 ms                  |
| forward: join             | 2.982 ms                  | 5.433 ms                  |
| Forward                   | 40.857 ms                 | 76.786 ms                 |
| back: aggr dram keys      | 48.341 ms                 | 70.408 ms                 |
| back: set dram grad       | 3.344 ms                  | 6.569 ms                  |
| back: a2a grad            | 8.102 ms                  | 13.059 ms                 |
| back: grad sum & grad cache  | 6.332 ms                  | 11.186 ms                 |
| Backward                  | 136.727 ms                | 164.943 ms                |
| Optimize                  | 27.108 ms                 | 40.642 ms                 |
| BarrierTimeBeforeRank0    | 47.208 us                 | 75.671 us                 |
| BlockToStepN              | 19.725 us                 | 148.989 us                |
| OneStep                   | 214.741 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.652 ms                  | 29.527 ms                 |
| bucket keys               | 2.958 ms                  | 5.627 ms                  |
| forward: a2a keys         | 3.031 ms                  | 34.008 ms                 |
| forward: search cache     | 469.944 us                | 1.125 ms                  |
| forward: a2a values       | 4.246 ms                  | 9.337 ms                  |
| forward: join             | 2.970 ms                  | 5.144 ms                  |
| Forward                   | 40.857 ms                 | 76.786 ms                 |
| back: aggr dram keys      | 48.412 ms                 | 70.111 ms                 |
| back: set dram grad       | 3.346 ms                  | 6.528 ms                  |
| back: a2a grad            | 8.100 ms                  | 12.717 ms                 |
| back: grad sum & grad cache  | 6.333 ms                  | 11.186 ms                 |
| Backward                  | 136.790 ms                | 165.052 ms                |
| Optimize                  | 27.259 ms                 | 40.642 ms                 |
| BarrierTimeBeforeRank0    | 47.148 us                 | 75.671 us                 |
| BlockToStepN              | 20.348 us                 | 193.159 us                |
| OneStep                   | 215.203 ms                | 263.864 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.652 ms                  | 29.527 ms                 |
| bucket keys               | 2.967 ms                  | 5.627 ms                  |
| forward: a2a keys         | 3.025 ms                  | 34.008 ms                 |
| forward: search cache     | 469.659 us                | 1.125 ms                  |
| forward: a2a values       | 4.253 ms                  | 9.337 ms                  |
| forward: join             | 2.966 ms                  | 5.144 ms                  |
| Forward                   | 40.857 ms                 | 76.786 ms                 |
| back: aggr dram keys      | 48.512 ms                 | 70.111 ms                 |
| back: set dram grad       | 3.345 ms                  | 6.528 ms                  |
| back: a2a grad            | 8.107 ms                  | 13.059 ms                 |
| back: grad sum & grad cache  | 6.329 ms                  | 11.186 ms                 |
| Backward                  | 137.063 ms                | 165.052 ms                |
| Optimize                  | 27.259 ms                 | 40.642 ms                 |
| BarrierTimeBeforeRank0    | 46.809 us                 | 75.671 us                 |
| BlockToStepN              | 20.402 us                 | 193.159 us                |
| OneStep                   | 215.760 ms                | 263.864 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.660 ms                  | 28.930 ms                 |
| bucket keys               | 2.976 ms                  | 5.627 ms                  |
| forward: a2a keys         | 3.025 ms                  | 34.008 ms                 |
| forward: search cache     | 469.827 us                | 1.221 ms                  |
| forward: a2a values       | 4.259 ms                  | 9.337 ms                  |
| forward: join             | 2.968 ms                  | 5.510 ms                  |
| Forward                   | 41.127 ms                 | 76.308 ms                 |
| back: aggr dram keys      | 48.601 ms                 | 70.408 ms                 |
| back: set dram grad       | 3.343 ms                  | 6.528 ms                  |
| back: a2a grad            | 8.120 ms                  | 13.059 ms                 |
| back: grad sum & grad cache  | 6.345 ms                  | 11.558 ms                 |
| Backward                  | 137.109 ms                | 166.853 ms                |
| Optimize                  | 27.259 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 46.904 us                 | 74.380 us                 |
| BlockToStepN              | 20.348 us                 | 180.794 us                |
| OneStep                   | 216.360 ms                | 260.965 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.660 ms                  | 28.930 ms                 |
| bucket keys               | 2.981 ms                  | 5.509 ms                  |
| forward: a2a keys         | 3.056 ms                  | 33.718 ms                 |
| forward: search cache     | 470.090 us                | 1.125 ms                  |
| forward: a2a values       | 4.273 ms                  | 9.337 ms                  |
| forward: join             | 2.966 ms                  | 5.433 ms                  |
| Forward                   | 42.122 ms                 | 76.308 ms                 |
| back: aggr dram keys      | 48.611 ms                 | 70.408 ms                 |
| back: set dram grad       | 3.348 ms                  | 6.398 ms                  |
| back: a2a grad            | 8.113 ms                  | 12.717 ms                 |
| back: grad sum & grad cache  | 6.349 ms                  | 11.558 ms                 |
| Backward                  | 137.120 ms                | 167.707 ms                |
| Optimize                  | 27.278 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 46.904 us                 | 74.380 us                 |
| BlockToStepN              | 20.348 us                 | 180.794 us                |
| OneStep                   | 216.559 ms                | 263.864 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 400 steps, total: 22.269, sample: 0.437, forward: 4.791, backward: 13.778, update: 0.464
[proc 3] 400 steps, total: 22.269, sample: 0.449, forward: 4.765, backward: 13.814, update: 0.406
[proc 6] 400 steps, total: 22.269, sample: 0.459, forward: 4.772, backward: 13.773, update: 0.386
[proc 7] 400 steps, total: 22.269, sample: 0.458, forward: 4.782, backward: 13.703, update: 0.423
[proc 5] 400 steps, total: 22.269, sample: 0.445, forward: 4.781, backward: 13.783, update: 0.394
[proc 2] 400 steps, total: 22.269, sample: 0.448, forward: 4.774, backward: 13.802, update: 0.429
[proc 0] 400 steps, total: 22.269, sample: 0.475, forward: 4.811, backward: 14.046, update: 2.816
[proc 4] 400 steps, total: 22.269, sample: 0.411, forward: 4.804, backward: 13.789, update: 0.421
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.659 ms                  | 28.930 ms                 |
| bucket keys               | 2.981 ms                  | 5.627 ms                  |
| forward: a2a keys         | 3.022 ms                  | 33.718 ms                 |
| forward: search cache     | 470.291 us                | 1.125 ms                  |
| forward: a2a values       | 4.273 ms                  | 9.337 ms                  |
| forward: join             | 2.968 ms                  | 5.433 ms                  |
| Forward                   | 41.920 ms                 | 76.308 ms                 |
| back: aggr dram keys      | 48.634 ms                 | 70.408 ms                 |
| back: set dram grad       | 3.347 ms                  | 6.398 ms                  |
| back: a2a grad            | 8.125 ms                  | 12.717 ms                 |
| back: grad sum & grad cache  | 6.360 ms                  | 11.558 ms                 |
| Backward                  | 137.396 ms                | 169.110 ms                |
| Optimize                  | 27.305 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 46.904 us                 | 74.380 us                 |
| BlockToStepN              | 20.402 us                 | 180.794 us                |
| OneStep                   | 216.948 ms                | 263.864 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.666 ms                  | 29.706 ms                 |
| bucket keys               | 2.981 ms                  | 5.509 ms                  |
| forward: a2a keys         | 3.005 ms                  | 33.718 ms                 |
| forward: search cache     | 470.339 us                | 928.080 us                |
| forward: a2a values       | 4.277 ms                  | 9.155 ms                  |
| forward: join             | 2.971 ms                  | 5.144 ms                  |
| Forward                   | 41.487 ms                 | 76.786 ms                 |
| back: aggr dram keys      | 48.634 ms                 | 71.460 ms                 |
| back: set dram grad       | 3.348 ms                  | 6.569 ms                  |
| back: a2a grad            | 8.126 ms                  | 12.717 ms                 |
| back: grad sum & grad cache  | 6.365 ms                  | 11.290 ms                 |
| Backward                  | 137.633 ms                | 173.515 ms                |
| Optimize                  | 27.393 ms                 | 40.131 ms                 |
| BarrierTimeBeforeRank0    | 47.086 us                 | 79.891 us                 |
| BlockToStepN              | 20.510 us                 | 193.159 us                |
| OneStep                   | 217.181 ms                | 274.997 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.667 ms                  | 29.696 ms                 |
| bucket keys               | 2.981 ms                  | 5.627 ms                  |
| forward: a2a keys         | 3.006 ms                  | 33.718 ms                 |
| forward: search cache     | 470.291 us                | 928.080 us                |
| forward: a2a values       | 4.289 ms                  | 9.155 ms                  |
| forward: join             | 2.970 ms                  | 5.144 ms                  |
| Forward                   | 41.127 ms                 | 76.308 ms                 |
| back: aggr dram keys      | 48.766 ms                 | 71.460 ms                 |
| back: set dram grad       | 3.349 ms                  | 6.592 ms                  |
| back: a2a grad            | 8.138 ms                  | 12.717 ms                 |
| back: grad sum & grad cache  | 6.389 ms                  | 11.290 ms                 |
| Backward                  | 137.523 ms                | 170.372 ms                |
| Optimize                  | 27.405 ms                 | 39.975 ms                 |
| BarrierTimeBeforeRank0    | 47.085 us                 | 75.671 us                 |
| BlockToStepN              | 20.743 us                 | 193.159 us                |
| OneStep                   | 217.023 ms                | 269.544 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.667 ms                  | 29.696 ms                 |
| bucket keys               | 2.981 ms                  | 5.627 ms                  |
| forward: a2a keys         | 2.983 ms                  | 33.698 ms                 |
| forward: search cache     | 470.035 us                | 928.080 us                |
| forward: a2a values       | 4.296 ms                  | 8.381 ms                  |
| forward: join             | 2.966 ms                  | 5.433 ms                  |
| Forward                   | 41.122 ms                 | 76.308 ms                 |
| back: aggr dram keys      | 48.836 ms                 | 70.418 ms                 |
| back: set dram grad       | 3.349 ms                  | 6.569 ms                  |
| back: a2a grad            | 8.136 ms                  | 12.440 ms                 |
| back: grad sum & grad cache  | 6.393 ms                  | 11.186 ms                 |
| Backward                  | 137.478 ms                | 170.372 ms                |
| Optimize                  | 27.400 ms                 | 39.975 ms                 |
| BarrierTimeBeforeRank0    | 46.848 us                 | 75.671 us                 |
| BlockToStepN              | 21.057 us                 | 193.159 us                |
| OneStep                   | 216.832 ms                | 269.544 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 500 steps, total: 21.962, sample: 0.476, forward: 4.388, backward: 13.805, update: 0.404
[proc 1] 500 steps, total: 21.962, sample: 0.431, forward: 4.426, backward: 13.823, update: 0.387
[proc 2] 500 steps, total: 21.962, sample: 0.423, forward: 4.452, backward: 13.829, update: 0.403
[proc 3] 500 steps, total: 21.962, sample: 0.401, forward: 4.467, backward: 13.820, update: 0.430
[proc 7] 500 steps, total: 21.962, sample: 0.424, forward: 4.450, backward: 13.729, update: 0.460
[proc 5] 500 steps, total: 21.962, sample: 0.404, forward: 4.470, backward: 13.816, update: 0.456
[proc 6] 500 steps, total: 21.962, sample: 0.425, forward: 4.451, backward: 13.798, update: 0.390
[proc 0] 500 steps, total: 21.962, sample: 0.452, forward: 4.484, backward: 14.068, update: 2.834
Successfully xmh. training takes 112.31011509895325 seconds
before call kg_cache_controller.StopThreads()
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
INFO [10436 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker7: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.662 ms                  | 29.696 ms                 |
| bucket keys               | 2.981 ms                  | 5.627 ms                  |
| forward: a2a keys         | 2.972 ms                  | 33.698 ms                 |
| forward: search cache     | 470.065 us                | 1.125 ms                  |
| forward: a2a values       | 4.291 ms                  | 8.381 ms                  |
| forward: join             | 2.970 ms                  | 5.433 ms                  |
| Forward                   | 40.857 ms                 | 76.308 ms                 |
| back: aggr dram keys      | 48.866 ms                 | 70.418 ms                 |
| back: set dram grad       | 3.349 ms                  | 6.569 ms                  |
| back: a2a grad            | 8.130 ms                  | 12.717 ms                 |
| back: grad sum & grad cache  | 6.393 ms                  | 11.186 ms                 |
| Backward                  | 137.411 ms                | 170.372 ms                |
| Optimize                  | 27.378 ms                 | 39.975 ms                 |
| BarrierTimeBeforeRank0    | 46.809 us                 | 75.671 us                 |
| BlockToStepN              | 21.183 us                 | 193.159 us                |
| OneStep                   | 216.360 ms                | 269.544 ms                |
+---------------------------+---------------------------+---------------------------+

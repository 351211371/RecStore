WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240204 00:06:20.660086 29628 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_81', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='None', use_my_emb=False, cache_ratio=0.05, shuffle=False, backwardMode='CppSync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [29628 sampler.py:454] Start PreSampling
WARNING [29628 sampler.py:532] Before construct renumbering_dict
WARNING [29628 sampler.py:555] PreSampling done
W20240204 00:25:36.266351 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240204 00:25:36.266538 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240204 00:25:36.266574 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240204 00:25:36.266603 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240204 00:25:36.266640 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240204 00:25:36.266677 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240204 00:25:36.266716 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240204 00:25:36.266767 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240204 00:25:36.266800 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240204 00:25:36.266834 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240204 00:25:36.266868 29628 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240204 00:25:36.266899 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240204 00:25:36.266925 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240204 00:25:36.267089 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240204 00:25:36.267134 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240204 00:25:36.267160 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240204 00:25:36.267212 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240204 00:25:36.267247 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240204 00:25:36.267278 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240204 00:25:36.267308 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240204 00:25:36.267340 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240204 00:25:36.267372 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240204 00:25:36.267402 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240204 00:25:36.267431 29628 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240204 00:25:36.267453 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240204 00:25:36.267481 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240204 00:25:36.267541 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240204 00:25:36.267571 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240204 00:25:36.267597 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240204 00:25:36.267629 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240204 00:25:36.267665 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240204 00:25:36.267696 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240204 00:25:36.267730 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240204 00:25:36.267757 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240204 00:25:36.267783 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240204 00:25:36.267815 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240204 00:25:36.267840 29628 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240204 00:25:36.267863 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240204 00:25:36.267894 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240204 00:25:36.267959 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240204 00:25:36.267988 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240204 00:25:36.268014 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240204 00:25:36.268043 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240204 00:25:36.268085 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240204 00:25:36.268119 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240204 00:25:36.268147 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240204 00:25:36.268177 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240204 00:25:36.268205 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240204 00:25:36.268244 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240204 00:25:36.268272 29628 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240204 00:25:36.268297 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240204 00:25:36.268325 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240204 00:25:36.268383 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240204 00:25:36.268416 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240204 00:25:36.268446 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240204 00:25:36.268476 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240204 00:25:36.268507 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240204 00:25:36.268541 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240204 00:25:36.268572 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240204 00:25:36.268606 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240204 00:25:36.268638 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240204 00:25:36.268675 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240204 00:25:36.268702 29628 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240204 00:25:36.268728 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240204 00:25:36.268752 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240204 00:25:36.268803 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240204 00:25:36.268843 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240204 00:25:36.268872 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240204 00:25:36.268899 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240204 00:25:36.268932 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240204 00:25:36.268963 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240204 00:25:36.268996 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240204 00:25:36.269024 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240204 00:25:36.269053 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240204 00:25:36.269080 29628 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240204 00:25:36.269107 29628 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240204 00:25:36.269132 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240204 00:25:36.269156 29628 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
{0: Graph(num_nodes=16391033, num_edges=60554486,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22850318, num_edges=74912573,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16459669, num_edges=67428404,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17554345, num_edges=53272616,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=17824082, num_edges=71836124,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=18730250, num_edges=46391216,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16391033 N 60554486 E
MertisPartition: part 1 has 22850318 N 74912573 E
MertisPartition: part 2 has 16459669 N 67428404 E
MertisPartition: part 3 has 17554345 N 53272616 E
MertisPartition: part 4 has 17824082 N 71836124 E
MertisPartition: part 5 has 18730250 N 46391216 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,       14,  ..., 12367661, 70093925, 61280605]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 4302831,  4302876,   569570,  ..., 44773380,  8721729, 79185301]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1768.527 seconds
[Rank1] pid = 50274
[Rank2] pid = 50368
[Rank3] pid = 50501
[Rank4] pid = 50678
INFO [29628 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [50274 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [50854 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [50368 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [50854 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [50368 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [50501 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [50501 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [50678 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [50678 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [29628 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [50274 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
E20240204 00:35:58.514055 50275 recstore.cc:66] init folly done
E20240204 00:35:58.514565 50855 recstore.cc:66] init folly done
E20240204 00:35:58.514585 50502 recstore.cc:66] init folly done
E20240204 00:35:58.514600 50369 recstore.cc:66] init folly done
E20240204 00:35:58.515606 50929 recstore.cc:66] init folly done
E20240204 00:35:58.515741 50679 recstore.cc:66] init folly done
I20240204 00:36:05.356101 50855 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240204 00:36:06.428990 50502 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240204 00:36:08.153402 50929 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240204 00:36:09.072829 50369 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240204 00:36:09.116837 50679 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240204 00:36:10.331595 50275 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.732 ms                  | 179.558 ms                |
| Forward                   | 10.459 ms                 | 584.875 ms                |
| Backward                  | 6.207 ms                  | 182.759 ms                |
| Optimize                  | 10.594 ms                 | 16.496 ms                 |
| OneStep                   | 56.582 ms                 | 933.543 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 8.772, sample: 2.003, forward: 2.764, backward: 0.771, update: 1.215
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 12.488, sample: 1.328, forward: 2.645, backward: 0.768, update: 1.130
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 7.513, sample: 1.687, forward: 2.648, backward: 0.785, update: 1.099
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 11.415, sample: 1.771, forward: 2.744, backward: 0.774, update: 1.157
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 8.728, sample: 1.891, forward: 2.666, backward: 0.774, update: 1.073
[Rank5] pid = 50854
train_sampler.Prefill()
-------Step 0-------
tensor([24376229,   685128,   280588,   685146,   685159,   685175,  5089589,
          685193,   685213,   334208]) tensor([  105648, 36380700, 35811561,  5667305, 62600367, 28133753, 44984636,
        15184529, 75262877,  3793349])
-------Step 1-------
tensor([24376229,   685128,   280588,   685146,   685159,   685175,  5089589,
          685193,   685213,   334208]) tensor([79955000, 80235591,  4708901,  1257321, 62529922, 58159280, 22859204,
        54407048, 67937816, 38760831])
-------Step 2-------
tensor([   13589,    13611,    13639,    26109, 34439912,    13659, 26868752,
           13680, 24376229, 80186487]) tensor([ 8619280, 32077853, 24806262, 65844722, 68307857, 39465625, 43190519,
        33590308,  6554487, 18992292])
-------Step 3-------
tensor([   13589,    13611,    13639,    26109, 34439912,    13659, 26868752,
           13680, 24376229, 80186487]) tensor([31115669, 26102902,  9057871, 76014760, 11949135, 12006153, 12777807,
        81608264, 75653544, 83664836])
-------Step 4-------
tensor([ 616986,   37273,   71187, 9863803,   71205,  338645,   71230, 4443650,
          71250,  617010]) tensor([47880466, 81205816, 17363273, 35404051, 36224175, 66930834, 63377190,
        24146140, 24042990, 81754799])
-------Step 5-------
tensor([ 616986,   37273,   71187, 9863803,   71205,  338645,   71230, 4443650,
          71250,  617010]) tensor([ 4232574,   108019,  8674477, 70013277, 67463792, 35143890, 58739946,
        49585590, 49851809, 27373666])
-------Step 6-------
tensor([  118897,   118917, 24376229,   118939,    31783,   118956,   285299,
          285325, 34026336,  4435978]) tensor([36618113, 43865037, 42745120, 77647204, 46669903,  1133988, 10709775,
         4752303, 59374545, 23269106])
-------Step 7-------
tensor([  118897,   118917, 24376229,   118939,    31783,   118956,   285299,
          285325, 34026336,  4435978]) tensor([25351700, 24992720, 52878029, 66145322, 63935719, 15220607,  2121384,
        44490571, 39927108, 28251487])
-------Step 8-------
tensor([  203900,   166516,   166541,  5018675,  4309111,    75300,    68665,
           68694,   166563, 38054102]) tensor([83831736, 22163899, 79198871, 53497155,  7620657, 16541269, 28399267,
        35565014, 68039814, 26672464])
-------Step 9-------
tensor([  203900,   166516,   166541,  5018675,  4309111,    75300,    68665,
           68694,   166563, 38054102]) tensor([  619255, 39860356, 79513476, 40382568, 85440253, 47133115, 55951927,
        36791617, 60690417, 13551159])
before start barrier
start train
[proc 0] 100 steps, total: 9.691, sample: 1.659, forward: 1.679, backward: 0.781, update: 1.095
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.515 ms                  | 118.885 ms                |
| Forward                   | 10.750 ms                 | 33.346 ms                 |
| Backward                  | 6.219 ms                  | 6.467 ms                  |
| Optimize                  | 10.778 ms                 | 17.038 ms                 |
| OneStep                   | 49.203 ms                 | 328.162 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.271 ms                  | 105.221 ms                |
| Forward                   | 10.818 ms                 | 32.073 ms                 |
| Backward                  | 6.217 ms                  | 6.467 ms                  |
| Optimize                  | 10.724 ms                 | 17.038 ms                 |
| OneStep                   | 47.456 ms                 | 278.385 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 5.805, sample: 1.093, forward: 1.126, backward: 0.608, update: 1.093
[proc 1] 200 steps, total: 5.805, sample: 1.011, forward: 1.876, backward: 0.642, update: 1.071
[proc 4] 200 steps, total: 5.805, sample: 1.480, forward: 1.718, backward: 0.572, update: 0.989
[proc 3] 200 steps, total: 5.805, sample: 1.123, forward: 1.800, backward: 0.606, update: 1.109
[proc 2] 200 steps, total: 5.805, sample: 1.384, forward: 1.897, backward: 0.632, update: 1.145
[proc 5] 200 steps, total: 5.805, sample: 0.909, forward: 1.831, backward: 0.593, update: 1.053
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.087 ms                  | 105.221 ms                |
| Forward                   | 10.888 ms                 | 29.534 ms                 |
| Backward                  | 6.211 ms                  | 11.570 ms                 |
| Optimize                  | 10.884 ms                 | 17.507 ms                 |
| OneStep                   | 47.608 ms                 | 261.582 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 5.529, sample: 1.079, forward: 1.829, backward: 0.609, update: 1.026
[proc 2] 300 steps, total: 5.529, sample: 1.454, forward: 1.682, backward: 0.601, update: 1.159
[proc 0] 300 steps, total: 5.529, sample: 1.251, forward: 1.109, backward: 0.637, update: 1.139
[proc 5] 300 steps, total: 5.529, sample: 0.807, forward: 1.820, backward: 0.612, update: 1.022
[proc 4] 300 steps, total: 5.529, sample: 1.147, forward: 1.646, backward: 0.617, update: 1.009
[proc 3] 300 steps, total: 5.529, sample: 1.123, forward: 1.672, backward: 0.634, update: 1.072
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.941 ms                  | 102.487 ms                |
| Forward                   | 10.906 ms                 | 29.517 ms                 |
| Backward                  | 6.212 ms                  | 6.551 ms                  |
| Optimize                  | 10.974 ms                 | 17.507 ms                 |
| OneStep                   | 47.483 ms                 | 243.981 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 5.321, sample: 0.912, forward: 1.120, backward: 0.628, update: 1.148
[proc 3] 400 steps, total: 5.321, sample: 0.904, forward: 1.716, backward: 0.435, update: 1.048
[proc 5] 400 steps, total: 5.321, sample: 0.705, forward: 1.750, backward: 0.610, update: 1.074
[proc 4] 400 steps, total: 5.321, sample: 0.913, forward: 1.614, backward: 0.627, update: 1.009
[proc 1] 400 steps, total: 5.321, sample: 0.939, forward: 1.775, backward: 0.638, update: 1.073
[proc 2] 400 steps, total: 5.321, sample: 1.008, forward: 1.814, backward: 0.624, update: 1.154
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.382 ms                  | 102.446 ms                |
| Forward                   | 10.936 ms                 | 29.485 ms                 |
| Backward                  | 6.207 ms                  | 6.710 ms                  |
| Optimize                  | 11.149 ms                 | 17.762 ms                 |
| OneStep                   | 47.262 ms                 | 196.543 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 5.104, sample: 0.800, forward: 1.815, backward: 0.619, update: 1.165
[proc 4] 500 steps, total: 5.104, sample: 0.771, forward: 1.723, backward: 0.602, update: 1.040
[proc 3] 500 steps, total: 5.104, sample: 0.710, forward: 1.810, backward: 0.546, update: 1.117
[proc 1] 500 steps, total: 5.104, sample: 0.711, forward: 1.959, backward: 0.669, update: 1.107
[proc 5] 500 steps, total: 5.104, sample: 0.628, forward: 1.753, backward: 0.598, update: 1.038
[proc 0] 500 steps, total: 5.104, sample: 0.794, forward: 1.074, backward: 0.538, update: 1.183
Successfully xmh. training takes 31.449970245361328 seconds
before call kg_cache_controller.StopThreads()

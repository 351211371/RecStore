WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 12:33:55.949556 62874 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_40', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [62874 sampler.py:454] Start PreSampling
WARNING [62874 sampler.py:532] Before construct renumbering_dict
WARNING [62874 sampler.py:555] PreSampling done
W20240207 12:52:25.949787 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 12:52:25.949985 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 12:52:25.950034 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 12:52:25.950066 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 12:52:25.950101 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 12:52:25.950135 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 12:52:25.950170 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 12:52:25.950209 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 12:52:25.950241 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 12:52:25.950270 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 12:52:25.950304 62874 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 12:52:25.950331 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 12:52:25.950361 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 12:52:25.950534 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 12:52:25.950580 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 12:52:25.950608 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 12:52:25.950649 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 12:52:25.950680 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 12:52:25.950721 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 12:52:25.950753 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 12:52:25.950781 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 12:52:25.950811 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 12:52:25.950841 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 12:52:25.950877 62874 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 12:52:25.950901 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 12:52:25.950923 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 12:52:25.950984 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240207 12:52:25.951020 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240207 12:52:25.951049 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240207 12:52:25.951084 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240207 12:52:25.951117 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240207 12:52:25.951148 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240207 12:52:25.951176 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240207 12:52:25.951210 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240207 12:52:25.951242 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240207 12:52:25.951268 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240207 12:52:25.951298 62874 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240207 12:52:25.951320 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240207 12:52:25.951349 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240207 12:52:25.951403 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240207 12:52:25.951438 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240207 12:52:25.951467 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240207 12:52:25.951494 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240207 12:52:25.951525 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240207 12:52:25.951565 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240207 12:52:25.951604 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240207 12:52:25.951632 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240207 12:52:25.951663 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240207 12:52:25.951689 62874 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240207 12:52:25.951722 62874 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240207 12:52:25.951745 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240207 12:52:25.951769 62874 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240207 12:52:26.365868 62874 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240207 13:01:00.972370 62874 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302730,  4302779,   111084,  ..., 70455351, 12255801,  2454301]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2126.219 seconds
[Rank1] pid = 63941
[Rank2] pid = 64040
INFO [62874 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [63941 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [64040 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [64108 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [64108 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [64040 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [62874 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [63941 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [64108 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [64040 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [63941 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [62874 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 13:09:27.549896 64041 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240207 13:09:27.550685 64172 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 13:09:27.550871 63942 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240207 13:09:27.550990 64109 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240207 13:09:28.025451 64109 recstore.cc:66] init folly done
E20240207 13:09:28.025647 63942 recstore.cc:66] init folly done
E20240207 13:09:28.025660 64041 recstore.cc:66] init folly done
E20240207 13:09:28.025756 64172 recstore.cc:66] init folly done
I20240207 13:09:39.022065 64172 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240207 13:09:41.818123 63942 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240207 13:09:43.887812 64109 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240207 13:09:44.191608 64041 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 12.275 ms                 | 314.233 ms                |
| Forward                   | 9.913 ms                  | 493.150 ms                |
| Backward                  | 209.672 ms                | 408.786 ms                |
| Optimize                  | 4.102 ms                  | 44.128 ms                 |
| BarrierTimeBeforeRank0    | 12.225 ms                 | 37.083 ms                 |
| BlockToStepN              | 30.404 us                 | 17.400 ms                 |
| OneStep                   | 275.978 ms                | 970.484 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.867 ms                  | 314.233 ms                |
| Forward                   | 9.792 ms                  | 493.150 ms                |
| Backward                  | 208.477 ms                | 408.786 ms                |
| Optimize                  | 4.186 ms                  | 44.128 ms                 |
| BarrierTimeBeforeRank0    | 18.746 ms                 | 47.189 ms                 |
| BlockToStepN              | 30.857 us                 | 17.400 ms                 |
| OneStep                   | 257.863 ms                | 970.484 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.501 ms                  | 314.233 ms                |
| Forward                   | 9.796 ms                  | 493.150 ms                |
| Backward                  | 205.231 ms                | 408.786 ms                |
| Optimize                  | 4.186 ms                  | 44.128 ms                 |
| BarrierTimeBeforeRank0    | 16.364 ms                 | 47.189 ms                 |
| BlockToStepN              | 30.857 us                 | 24.435 ms                 |
| OneStep                   | 251.927 ms                | 970.484 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.751 ms                  | 260.775 ms                |
| Forward                   | 9.913 ms                  | 23.228 ms                 |
| Backward                  | 206.904 ms                | 408.786 ms                |
| Optimize                  | 4.315 ms                  | 35.868 ms                 |
| BarrierTimeBeforeRank0    | 12.120 ms                 | 47.189 ms                 |
| BlockToStepN              | 32.624 us                 | 18.031 ms                 |
| OneStep                   | 248.775 ms                | 537.215 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.588 ms                  | 260.775 ms                |
| Forward                   | 10.082 ms                 | 23.228 ms                 |
| Backward                  | 206.493 ms                | 408.786 ms                |
| Optimize                  | 4.313 ms                  | 35.868 ms                 |
| BarrierTimeBeforeRank0    | 9.355 ms                  | 171.755 ms                |
| BlockToStepN              | 31.654 us                 | 18.031 ms                 |
| OneStep                   | 247.182 ms                | 537.215 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 32.662, sample: 1.622, forward: 2.377, backward: 19.937, update: 0.466
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 27.493, sample: 1.504, forward: 2.546, backward: 20.675, update: 0.359
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 29.867, sample: 1.435, forward: 2.467, backward: 20.601, update: 0.406
[Rank3] pid = 64108
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
train_sampler.Prefill()
-------Step 0-------
tensor([   57834,   711229, 37717174,   991288,   425207,   711271,   711313,
          224516,    57879,    57905]) tensor([ 5034858, 23242570, 26194961, 56788091, 65089447, 32050400, 84992999,
        81861521, 63595534, 70275818])
-------Step 1-------
tensor([   57834,   711229, 37717174,   991288,   425207,   711271,   711313,
          224516,    57879,    57905]) tensor([34854048, 80554876, 64883588,  9307643, 48699571,  9266843, 84742090,
        64180425, 19299459, 37689447])
-------Step 2-------
tensor([  816267,    71081, 80151068,    71123,   816311,   816351,   816386,
        49234671,   816423,   816455]) tensor([39916285,  4989213, 68415334, 11296256, 13524194, 11039221, 71976262,
         8618109, 47422137, 27875284])
-------Step 3-------
tensor([  816267,    71081, 80151068,    71123,   816311,   816351,   816386,
        49234671,   816423,   816455]) tensor([15987333, 50073930, 78571687, 47266191, 12864824, 77419919, 75825531,
        74555458, 19441633, 77505770])
-------Step 4-------
tensor([895934,  85202, 895948, 895964,  85240, 895977,  85284, 895999,  85328,
        896019]) tensor([55307626, 46378498, 19695271, 15251926, 46410160, 38393493, 79327997,
        54220564, 46660033,  8498868])
-------Step 5-------
tensor([895934,  85202, 895948, 895964,  85240, 895977,  85284, 895999,  85328,
        896019]) tensor([40950554, 38987927, 84146443,  8488889, 41216203, 35208227, 30149944,
        76778744, 72824524,   393543])
-------Step 6-------
tensor([59962987,   942806,   942823,   942842,  4310305,   942859,   942874,
          942890,   942909,   229997]) tensor([31213925, 36149248, 28333831, 17267029, 81861313, 46638942, 46787299,
        13230275, 54602460,  9095840])
-------Step 7-------
tensor([59962987,   942806,   942823,   942842,  4310305,   942859,   942874,
          942890,   942909,   229997]) tensor([42796678, 76457075, 43722691, 77662823, 56060462,  1489237, 20008134,
        57791998, 22488443, 18518276])
-------Step 8-------
tensor([  988390,   114107,   988402, 41974272,  1013704,   988417,   988432,
          988451,   231631,  1013718]) tensor([27729744, 65696535, 39370144, 73113213, 67095471, 50536512, 70881019,
        65831657,  9467764,  3240753])
-------Step 9-------
tensor([  988390,   114107,   988402, 41974272,  1013704,   988417,   988432,
          988451,   231631,  1013718]) tensor([79574880, 53118240, 28292187, 33715761, 13910510,  1075657, 22438489,
        12360553, 79405861, 53751246])
before start barrier
start train
[proc 0] 100 steps, total: 27.797, sample: 2.261, forward: 1.521, backward: 21.447, update: 0.455
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.751 ms                  | 260.775 ms                |
| Forward                   | 10.029 ms                 | 23.228 ms                 |
| Backward                  | 208.528 ms                | 408.786 ms                |
| Optimize                  | 4.267 ms                  | 35.868 ms                 |
| BarrierTimeBeforeRank0    | 8.755 ms                  | 171.755 ms                |
| BlockToStepN              | 31.284 us                 | 18.031 ms                 |
| OneStep                   | 248.775 ms                | 537.215 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.980 ms                  | 260.775 ms                |
| Forward                   | 10.008 ms                 | 23.228 ms                 |
| Backward                  | 209.793 ms                | 408.786 ms                |
| Optimize                  | 4.267 ms                  | 35.868 ms                 |
| BarrierTimeBeforeRank0    | 5.902 ms                  | 171.755 ms                |
| BlockToStepN              | 31.022 us                 | 18.031 ms                 |
| OneStep                   | 249.350 ms                | 537.215 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.129 ms                  | 260.775 ms                |
| Forward                   | 9.913 ms                  | 23.228 ms                 |
| Backward                  | 208.477 ms                | 408.786 ms                |
| Optimize                  | 4.206 ms                  | 35.868 ms                 |
| BarrierTimeBeforeRank0    | 6.560 ms                  | 171.755 ms                |
| BlockToStepN              | 30.859 us                 | 18.031 ms                 |
| OneStep                   | 247.767 ms                | 537.215 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.895 ms                  | 246.571 ms                |
| Forward                   | 9.927 ms                  | 23.228 ms                 |
| Backward                  | 208.450 ms                | 374.795 ms                |
| Optimize                  | 4.223 ms                  | 7.358 ms                  |
| BarrierTimeBeforeRank0    | 4.900 ms                  | 111.557 ms                |
| BlockToStepN              | 31.329 us                 | 17.400 ms                 |
| OneStep                   | 246.399 ms                | 474.471 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.129 ms                  | 246.571 ms                |
| Forward                   | 10.003 ms                 | 34.174 ms                 |
| Backward                  | 208.136 ms                | 374.795 ms                |
| Optimize                  | 4.223 ms                  | 7.358 ms                  |
| BarrierTimeBeforeRank0    | 4.655 ms                  | 128.040 ms                |
| BlockToStepN              | 31.720 us                 | 17.400 ms                 |
| OneStep                   | 245.614 ms                | 474.471 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.895 ms                  | 246.571 ms                |
| Forward                   | 9.914 ms                  | 34.174 ms                 |
| Backward                  | 208.477 ms                | 374.795 ms                |
| Optimize                  | 4.223 ms                  | 7.649 ms                  |
| BarrierTimeBeforeRank0    | 3.827 ms                  | 128.040 ms                |
| BlockToStepN              | 31.750 us                 | 18.031 ms                 |
| OneStep                   | 246.399 ms                | 474.471 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 26.155, sample: 1.325, forward: 1.755, backward: 21.053, update: 0.378
[proc 2] 200 steps, total: 26.155, sample: 1.467, forward: 1.812, backward: 20.755, update: 0.335
[proc 0] 200 steps, total: 26.155, sample: 2.337, forward: 1.065, backward: 21.382, update: 0.376
[proc 3] 200 steps, total: 26.155, sample: 1.423, forward: 1.683, backward: 19.898, update: 0.376
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.177 ms                  | 246.571 ms                |
| Forward                   | 9.817 ms                  | 34.174 ms                 |
| Backward                  | 208.136 ms                | 374.795 ms                |
| Optimize                  | 4.216 ms                  | 7.649 ms                  |
| BarrierTimeBeforeRank0    | 4.290 ms                  | 165.892 ms                |
| BlockToStepN              | 32.315 us                 | 18.916 ms                 |
| OneStep                   | 245.856 ms                | 474.471 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.895 ms                  | 246.571 ms                |
| Forward                   | 9.752 ms                  | 34.174 ms                 |
| Backward                  | 208.528 ms                | 374.795 ms                |
| Optimize                  | 4.194 ms                  | 7.649 ms                  |
| BarrierTimeBeforeRank0    | 4.900 ms                  | 165.892 ms                |
| BlockToStepN              | 32.315 us                 | 18.916 ms                 |
| OneStep                   | 246.792 ms                | 474.471 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.895 ms                  | 166.726 ms                |
| Forward                   | 9.623 ms                  | 23.228 ms                 |
| Backward                  | 208.622 ms                | 351.140 ms                |
| Optimize                  | 4.194 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 5.282 ms                  | 128.040 ms                |
| BlockToStepN              | 32.338 us                 | 18.031 ms                 |
| OneStep                   | 246.948 ms                | 471.205 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.177 ms                  | 166.726 ms                |
| Forward                   | 9.578 ms                  | 23.228 ms                 |
| Backward                  | 208.517 ms                | 351.140 ms                |
| Optimize                  | 4.186 ms                  | 7.573 ms                  |
| BarrierTimeBeforeRank0    | 5.373 ms                  | 128.040 ms                |
| BlockToStepN              | 32.206 us                 | 18.031 ms                 |
| OneStep                   | 246.399 ms                | 471.205 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.200 ms                  | 166.726 ms                |
| Forward                   | 9.517 ms                  | 23.228 ms                 |
| Backward                  | 208.100 ms                | 351.140 ms                |
| Optimize                  | 4.175 ms                  | 7.573 ms                  |
| BarrierTimeBeforeRank0    | 6.230 ms                  | 128.040 ms                |
| BlockToStepN              | 32.359 us                 | 18.031 ms                 |
| OneStep                   | 245.856 ms                | 471.205 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 25.950, sample: 1.329, forward: 1.830, backward: 21.342, update: 0.397
[proc 3] 300 steps, total: 25.950, sample: 1.294, forward: 1.618, backward: 20.313, update: 0.379
[proc 2] 300 steps, total: 25.950, sample: 1.186, forward: 1.742, backward: 20.292, update: 0.349
[proc 0] 300 steps, total: 25.950, sample: 1.925, forward: 0.927, backward: 21.224, update: 0.355
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.200 ms                  | 166.726 ms                |
| Forward                   | 9.505 ms                  | 23.228 ms                 |
| Backward                  | 207.618 ms                | 351.140 ms                |
| Optimize                  | 4.164 ms                  | 7.573 ms                  |
| BarrierTimeBeforeRank0    | 6.230 ms                  | 147.353 ms                |
| BlockToStepN              | 32.475 us                 | 18.031 ms                 |
| OneStep                   | 245.590 ms                | 471.205 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.177 ms                  | 166.726 ms                |
| Forward                   | 9.506 ms                  | 34.174 ms                 |
| Backward                  | 207.415 ms                | 351.140 ms                |
| Optimize                  | 4.153 ms                  | 7.573 ms                  |
| BarrierTimeBeforeRank0    | 6.230 ms                  | 147.353 ms                |
| BlockToStepN              | 32.475 us                 | 18.031 ms                 |
| OneStep                   | 245.567 ms                | 471.205 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.274 ms                  | 166.639 ms                |
| Forward                   | 9.506 ms                  | 23.228 ms                 |
| Backward                  | 207.160 ms                | 351.136 ms                |
| Optimize                  | 4.145 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 5.902 ms                  | 128.040 ms                |
| BlockToStepN              | 32.484 us                 | 17.400 ms                 |
| OneStep                   | 245.567 ms                | 462.562 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.031 ms                  | 166.639 ms                |
| Forward                   | 9.401 ms                  | 23.228 ms                 |
| Backward                  | 206.493 ms                | 351.136 ms                |
| Optimize                  | 4.116 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 6.560 ms                  | 128.040 ms                |
| BlockToStepN              | 32.624 us                 | 18.031 ms                 |
| OneStep                   | 245.415 ms                | 462.562 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.895 ms                  | 166.639 ms                |
| Forward                   | 9.340 ms                  | 23.228 ms                 |
| Backward                  | 206.481 ms                | 351.140 ms                |
| Optimize                  | 4.099 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 7.214 ms                  | 128.040 ms                |
| BlockToStepN              | 32.736 us                 | 18.031 ms                 |
| OneStep                   | 245.415 ms                | 462.562 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 25.701, sample: 1.763, forward: 0.958, backward: 20.971, update: 0.320
[proc 3] 400 steps, total: 25.701, sample: 1.160, forward: 1.508, backward: 19.947, update: 0.362
[proc 1] 400 steps, total: 25.701, sample: 1.347, forward: 1.792, backward: 21.111, update: 0.419
[proc 2] 400 steps, total: 25.701, sample: 1.221, forward: 1.674, backward: 20.299, update: 0.381
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.817 ms                  | 166.639 ms                |
| Forward                   | 9.316 ms                  | 23.228 ms                 |
| Backward                  | 206.655 ms                | 351.140 ms                |
| Optimize                  | 4.079 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 7.912 ms                  | 128.040 ms                |
| BlockToStepN              | 32.736 us                 | 18.031 ms                 |
| OneStep                   | 245.515 ms                | 462.562 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.839 ms                  | 166.639 ms                |
| Forward                   | 9.305 ms                  | 23.228 ms                 |
| Backward                  | 207.422 ms                | 351.140 ms                |
| Optimize                  | 4.058 ms                  | 7.573 ms                  |
| BarrierTimeBeforeRank0    | 7.996 ms                  | 128.040 ms                |
| BlockToStepN              | 32.736 us                 | 18.031 ms                 |
| OneStep                   | 245.587 ms                | 462.562 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.817 ms                  | 165.433 ms                |
| Forward                   | 9.280 ms                  | 23.228 ms                 |
| Backward                  | 207.415 ms                | 351.140 ms                |
| Optimize                  | 4.050 ms                  | 7.573 ms                  |
| BarrierTimeBeforeRank0    | 8.904 ms                  | 128.040 ms                |
| BlockToStepN              | 32.822 us                 | 18.031 ms                 |
| OneStep                   | 245.614 ms                | 462.562 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.614 ms                  | 165.433 ms                |
| Forward                   | 9.242 ms                  | 18.118 ms                 |
| Backward                  | 207.355 ms                | 351.136 ms                |
| Optimize                  | 3.987 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 8.935 ms                  | 124.805 ms                |
| BlockToStepN              | 32.848 us                 | 17.400 ms                 |
| OneStep                   | 245.579 ms                | 450.847 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.636 ms                  | 165.433 ms                |
| Forward                   | 9.205 ms                  | 18.118 ms                 |
| Backward                  | 207.160 ms                | 351.136 ms                |
| Optimize                  | 4.042 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 9.179 ms                  | 124.805 ms                |
| BlockToStepN              | 32.879 us                 | 17.400 ms                 |
| OneStep                   | 245.587 ms                | 450.847 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 500 steps, total: 26.219, sample: 1.855, forward: 0.925, backward: 21.481, update: 0.341
[proc 2] 500 steps, total: 26.219, sample: 1.232, forward: 1.667, backward: 20.728, update: 0.439
[proc 1] 500 steps, total: 26.219, sample: 1.377, forward: 1.740, backward: 21.792, update: 0.450
Successfully xmh. training takes 131.82133507728577 seconds
before call kg_cache_controller.StopThreads()
[proc 3] 500 steps, total: 26.219, sample: 1.117, forward: 1.416, backward: 20.317, update: 0.349
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
INFO [62874 controller_process.py:421] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.742 ms                  | 165.433 ms                |
| Forward                   | 9.216 ms                  | 18.118 ms                 |
| Backward                  | 207.473 ms                | 351.136 ms                |
| Optimize                  | 4.050 ms                  | 7.482 ms                  |
| BarrierTimeBeforeRank0    | 8.908 ms                  | 124.805 ms                |
| BlockToStepN              | 32.848 us                 | 17.400 ms                 |
| OneStep                   | 245.590 ms                | 450.847 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

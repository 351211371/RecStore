WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240205 21:30:47.205757  8845 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_37', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [8845 sampler.py:454] Start PreSampling
WARNING [8845 sampler.py:532] Before construct renumbering_dict
WARNING [8845 sampler.py:555] PreSampling done
W20240205 21:30:52.376516  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240205 21:30:52.376698  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240205 21:30:52.376739  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240205 21:30:52.376777  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240205 21:30:52.376817  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240205 21:30:52.376859  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240205 21:30:52.376900  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240205 21:30:52.376958  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240205 21:30:52.377000  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240205 21:30:52.377038  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240205 21:30:52.377082  8845 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240205 21:30:52.377120  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240205 21:30:52.377149  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240205 21:30:52.377257  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240205 21:30:52.377312  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240205 21:30:52.377349  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240205 21:30:52.377404  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240205 21:30:52.377441  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240205 21:30:52.377482  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240205 21:30:52.377535  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240205 21:30:52.377579  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240205 21:30:52.377617  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240205 21:30:52.377663  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240205 21:30:52.377696  8845 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240205 21:30:52.377727  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240205 21:30:52.377755  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240205 21:30:52.377825  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240205 21:30:52.377866  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240205 21:30:52.377900  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240205 21:30:52.377933  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240205 21:30:52.377967  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240205 21:30:52.378006  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240205 21:30:52.378052  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240205 21:30:52.378093  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240205 21:30:52.378134  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240205 21:30:52.378181  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240205 21:30:52.378216  8845 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240205 21:30:52.378244  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240205 21:30:52.378273  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240205 21:30:52.378336  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240205 21:30:52.378381  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240205 21:30:52.378422  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240205 21:30:52.378463  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240205 21:30:52.378501  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240205 21:30:52.378543  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240205 21:30:52.378582  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240205 21:30:52.378623  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240205 21:30:52.378660  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240205 21:30:52.378695  8845 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240205 21:30:52.378734  8845 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240205 21:30:52.378763  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240205 21:30:52.378793  8845 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240205 21:30:52.625816  8845 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240205 21:30:52.717072  8845 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=9703, num_edges=161860,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11374, num_edges=168961,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=10715, num_edges=190828,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=11184, num_edges=240046,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9703 N 161860 E
MertisPartition: part 1 has 11374 N 168961 E
MertisPartition: part 2 has 10715 N 190828 E
MertisPartition: part 3 has 11184 N 240046 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([   6,   10,   11,  ..., 5824, 6189, 2559]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 999, 1167, 1211,  ..., 8920, 3393, 5167]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.610 seconds
[Rank1] pid = 9048
[Rank2] pid = 9112
INFO [8845 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [9048 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [9112 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [9176 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [8845 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [9176 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [9112 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [9048 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240205 21:30:54.699856  9177 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240205 21:30:54.700809  9240 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240205 21:30:54.700922  9113 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240205 21:30:54.700927  9049 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240205 21:30:54.728240  9177 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x100014876000 7.629 MB
W20240205 21:30:54.728446  9177 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100015019000 7.629 MB
W20240205 21:30:54.728518  9177 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000157bc000 1.49 GB
W20240205 21:30:54.728567  9177 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100074d9f000 1.49 GB
W20240205 21:30:54.728628  9177 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240205 21:30:54.731688  9240 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x1000d4388000 7.629 MB
W20240205 21:30:54.731716  9049 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000d4b2b000 7.629 MB
W20240205 21:30:54.731722  9113 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1000d52ce000 7.629 MB
W20240205 21:30:54.731854  9113 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1000d5a71000 7.629 MB
W20240205 21:30:54.731860  9240 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1000d6214000 7.629 MB
W20240205 21:30:54.731874  9049 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1000d69b7000 7.629 MB
W20240205 21:30:54.731920  9113 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1000d715a000 1.49 GB
W20240205 21:30:54.731937  9049 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10013673d000 1.49 GB
W20240205 21:30:54.731961  9240 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x100195d20000 1.49 GB
W20240205 21:30:54.731997  9113 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1001f5303000 1.49 GB
W20240205 21:30:54.732013  9049 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1002548e6000 1.49 GB
W20240205 21:30:54.732033  9240 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1002b3ec9000 1.49 GB
W20240205 21:30:54.732072  9113 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240205 21:30:54.732080  9049 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240205 21:30:54.732088  9240 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240205 21:30:54.736652  9177 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240205 21:30:54.738538  9113 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240205 21:30:54.738544  9240 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240205 21:30:54.738550  9049 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [9176 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [9112 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [9048 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 9176
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [8845 DistTensor.py:59] The tensor name already exists in the kvstore
I20240205 21:30:56.378654  9177 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240205 21:30:56.378973  9049 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240205 21:30:56.379180  9240 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240205 21:30:56.379319  9113 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240205 21:30:56.809558  9049 recstore.cc:66] init folly done
E20240205 21:30:56.809954  9240 recstore.cc:66] init folly done
E20240205 21:30:56.811151  9113 recstore.cc:66] init folly done
E20240205 21:30:56.811158  9177 recstore.cc:66] init folly done
I20240205 21:30:56.903692  9177 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240205 21:30:56.903791  9113 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240205 21:30:56.903825  9049 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240205 21:30:56.906670  9240 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.755 ms                  | 37.733 ms                 |
| Forward                   | 7.373 ms                  | 386.267 ms                |
| back: bucket keys         | 512.276 us                | 19.527 ms                 |
| back: a2a                 | 6.365 ms                  | 833.294 ms                |
| back: cache               | 3.140 ms                  | 5.563 ms                  |
| back: aggr dram keys      | 33.012 ms                 | 447.917 ms                |
| back: set dram grad       | 2.338 ms                  | 8.696 ms                  |
| Backward                  | 96.255 ms                 | 1.554 s                   |
| Optimize                  | 34.300 ms                 | 83.820 ms                 |
| BarrierTimeBeforeRank0    | 64.811 us                 | 254.586 us                |
| BlockToStepN              | 14.991 us                 | 411.612 us                |
| OneStep                   | 145.739 ms                | 2.026 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.765 ms                  | 37.740 ms                 |
| Forward                   | 7.300 ms                  | 17.077 ms                 |
| back: bucket keys         | 472.392 us                | 930.407 us                |
| back: a2a                 | 6.236 ms                  | 13.490 ms                 |
| back: cache               | 3.140 ms                  | 5.368 ms                  |
| back: aggr dram keys      | 32.193 ms                 | 43.949 ms                 |
| back: set dram grad       | 2.329 ms                  | 8.356 ms                  |
| Backward                  | 95.909 ms                 | 113.077 ms                |
| Optimize                  | 33.299 ms                 | 54.120 ms                 |
| BarrierTimeBeforeRank0    | 57.717 us                 | 122.279 us                |
| BlockToStepN              | 14.525 us                 | 169.238 us                |
| OneStep                   | 145.283 ms                | 183.380 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.858 ms                  | 37.740 ms                 |
| Forward                   | 7.168 ms                  | 17.782 ms                 |
| back: bucket keys         | 463.080 us                | 927.553 us                |
| back: a2a                 | 6.158 ms                  | 11.596 ms                 |
| back: cache               | 3.100 ms                  | 5.238 ms                  |
| back: aggr dram keys      | 31.807 ms                 | 43.949 ms                 |
| back: set dram grad       | 2.340 ms                  | 7.437 ms                  |
| Backward                  | 95.127 ms                 | 122.442 ms                |
| Optimize                  | 32.953 ms                 | 54.120 ms                 |
| BarrierTimeBeforeRank0    | 57.717 us                 | 122.279 us                |
| BlockToStepN              | 14.974 us                 | 296.463 us                |
| OneStep                   | 142.855 ms                | 183.380 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 16.487, sample: 0.374, forward: 0.859, backward: 9.568, update: 0.439
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 16.487, sample: 0.382, forward: 0.873, backward: 9.546, update: 0.420
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 16.484, sample: 0.386, forward: 0.868, backward: 9.554, update: 0.420
train_sampler.Prefill()
-------Step 0-------
tensor([ 7235,  6028, 14726,  3995,    41,  4270,  7121,    58,  4202,  8646]) tensor([ 1211, 12146,  2083, 14182,  2173, 11853,  2970,  4803,  4992, 10865])
-------Step 1-------
tensor([ 7235,  6028, 14726,  3995,    41,  4270,  7121,    58,  4202,  8646]) tensor([ 2586, 13889,  5056,  6390, 10053,  6104,   905,  7817,   800,  6304])
-------Step 2-------
tensor([11175,   157,  2409,   125,  6037,  3257, 11650,   874, 13562,  2728]) tensor([ 4940,  6647,  4352,  4359,  9154,  4533, 13501, 14853,  6557,  8020])
-------Step 3-------
tensor([11175,   157,  2409,   125,  6037,  3257, 11650,   874, 13562,  2728]) tensor([12977,  7032, 11894,  8470,   697,  6217,  8194,  6121,  4899,  9692])
-------Step 4-------
tensor([   15,  6321,  9785,  9108, 10492, 11996, 12035,  1382, 14848,  4216]) tensor([ 7010,  1156,  2147,  1376,  5548, 14554,   846,  1687,  4522,  7422])
-------Step 5-------
tensor([   15,  6321,  9785,  9108, 10492, 11996, 12035,  1382, 14848,  4216]) tensor([ 1635, 10306,  1044,  2520,  6503,    63, 14800,  4473,  2814, 11811])
-------Step 6-------
tensor([ 8012, 13361, 12187,    70,   953, 13628,   167, 13624, 12033,   102]) tensor([10215, 11548,   756,  3123,  2658,  2133,  1097,  2382,  4503, 10466])
-------Step 7-------
tensor([ 8012, 13361, 12187,    70,   953, 13628,   167, 13624, 12033,   102]) tensor([12075, 10139, 14206, 10495,  6075,  1504, 12589,  5018,  2867,  6766])
-------Step 8-------
tensor([ 7309,  9544,  3732,  9725,  1981,  6077,  8440, 14382,    29, 11895]) tensor([ 1866,  6517, 11897,   484,  4710, 13592,  8790,  5834, 12129,  9575])
-------Step 9-------
tensor([ 7309,  9544,  3732,  9725,  1981,  6077,  8440, 14382,    29, 11895]) tensor([ 2946,   536,  5747,  5906,  2430,  1926, 13260,  4463,   454, 10347])
before start barrier
start train
[proc 0] 100 steps, total: 16.487, sample: 0.623, forward: 1.155, backward: 11.082, update: 3.530
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.788 ms                  | 37.917 ms                 |
| Forward                   | 7.024 ms                  | 18.911 ms                 |
| back: bucket keys         | 463.080 us                | 930.407 us                |
| back: a2a                 | 6.080 ms                  | 11.596 ms                 |
| back: cache               | 3.071 ms                  | 5.368 ms                  |
| back: aggr dram keys      | 32.016 ms                 | 47.396 ms                 |
| back: set dram grad       | 2.348 ms                  | 7.437 ms                  |
| Backward                  | 95.127 ms                 | 122.442 ms                |
| Optimize                  | 31.884 ms                 | 55.936 ms                 |
| BarrierTimeBeforeRank0    | 48.289 us                 | 122.279 us                |
| BlockToStepN              | 14.525 us                 | 296.463 us                |
| OneStep                   | 140.782 ms                | 187.104 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.771 ms                  | 37.740 ms                 |
| Forward                   | 6.826 ms                  | 17.782 ms                 |
| back: bucket keys         | 458.746 us                | 927.553 us                |
| back: a2a                 | 6.080 ms                  | 10.352 ms                 |
| back: cache               | 3.061 ms                  | 5.443 ms                  |
| back: aggr dram keys      | 32.315 ms                 | 44.632 ms                 |
| back: set dram grad       | 2.348 ms                  | 7.379 ms                  |
| Backward                  | 95.127 ms                 | 119.110 ms                |
| Optimize                  | 31.074 ms                 | 54.120 ms                 |
| BarrierTimeBeforeRank0    | 45.329 us                 | 224.556 us                |
| BlockToStepN              | 14.291 us                 | 296.463 us                |
| OneStep                   | 139.574 ms                | 185.192 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.755 ms                  | 37.740 ms                 |
| Forward                   | 6.692 ms                  | 17.782 ms                 |
| back: bucket keys         | 454.851 us                | 911.355 us                |
| back: a2a                 | 6.080 ms                  | 30.134 ms                 |
| back: cache               | 3.031 ms                  | 5.423 ms                  |
| back: aggr dram keys      | 32.365 ms                 | 43.949 ms                 |
| back: set dram grad       | 2.329 ms                  | 7.123 ms                  |
| Backward                  | 95.277 ms                 | 122.442 ms                |
| Optimize                  | 30.507 ms                 | 54.120 ms                 |
| BarrierTimeBeforeRank0    | 46.244 us                 | 224.556 us                |
| BlockToStepN              | 14.108 us                 | 296.463 us                |
| OneStep                   | 139.019 ms                | 185.192 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 200 steps, total: 13.998, sample: 0.423, forward: 0.486, backward: 8.046, update: 0.408
[proc 3] 200 steps, total: 13.998, sample: 0.409, forward: 0.476, backward: 8.066, update: 0.420
[proc 1] 200 steps, total: 13.998, sample: 0.397, forward: 0.471, backward: 8.087, update: 0.394
[proc 0] 200 steps, total: 13.998, sample: 0.537, forward: 0.566, backward: 9.864, update: 2.928
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.743 ms                  | 37.740 ms                 |
| Forward                   | 6.595 ms                  | 17.782 ms                 |
| back: bucket keys         | 454.851 us                | 891.935 us                |
| back: a2a                 | 5.840 ms                  | 30.134 ms                 |
| back: cache               | 2.995 ms                  | 5.423 ms                  |
| back: aggr dram keys      | 32.369 ms                 | 43.949 ms                 |
| back: set dram grad       | 2.301 ms                  | 6.784 ms                  |
| Backward                  | 95.564 ms                 | 128.485 ms                |
| Optimize                  | 30.394 ms                 | 54.120 ms                 |
| BarrierTimeBeforeRank0    | 45.329 us                 | 224.556 us                |
| BlockToStepN              | 13.939 us                 | 296.463 us                |
| OneStep                   | 139.019 ms                | 185.192 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.739 ms                  | 37.733 ms                 |
| Forward                   | 6.196 ms                  | 17.077 ms                 |
| back: bucket keys         | 388.866 us                | 891.935 us                |
| back: a2a                 | 5.719 ms                  | 30.134 ms                 |
| back: cache               | 2.983 ms                  | 5.423 ms                  |
| back: aggr dram keys      | 32.369 ms                 | 44.524 ms                 |
| back: set dram grad       | 2.300 ms                  | 7.379 ms                  |
| Backward                  | 96.170 ms                 | 129.680 ms                |
| Optimize                  | 30.388 ms                 | 53.037 ms                 |
| BarrierTimeBeforeRank0    | 46.244 us                 | 122.279 us                |
| BlockToStepN              | 13.855 us                 | 223.740 us                |
| OneStep                   | 139.657 ms                | 183.380 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.729 ms                  | 37.733 ms                 |
| Forward                   | 5.924 ms                  | 17.077 ms                 |
| back: bucket keys         | 388.866 us                | 890.561 us                |
| back: a2a                 | 5.690 ms                  | 29.257 ms                 |
| back: cache               | 2.983 ms                  | 5.423 ms                  |
| back: aggr dram keys      | 32.374 ms                 | 43.949 ms                 |
| back: set dram grad       | 2.290 ms                  | 7.379 ms                  |
| Backward                  | 96.221 ms                 | 129.680 ms                |
| Optimize                  | 30.183 ms                 | 53.037 ms                 |
| BarrierTimeBeforeRank0    | 46.835 us                 | 122.279 us                |
| BlockToStepN              | 13.598 us                 | 223.740 us                |
| OneStep                   | 139.889 ms                | 183.380 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 300 steps, total: 14.076, sample: 0.354, forward: 0.464, backward: 8.236, update: 0.394
[proc 3] 300 steps, total: 14.076, sample: 0.369, forward: 0.464, backward: 8.205, update: 0.418
[proc 1] 300 steps, total: 14.076, sample: 0.351, forward: 0.454, backward: 8.251, update: 0.397
[proc 0] 300 steps, total: 14.076, sample: 0.450, forward: 0.540, backward: 10.062, update: 2.916
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.719 ms                  | 37.733 ms                 |
| Forward                   | 5.767 ms                  | 17.077 ms                 |
| back: bucket keys         | 388.866 us                | 890.561 us                |
| back: a2a                 | 5.719 ms                  | 28.743 ms                 |
| back: cache               | 2.983 ms                  | 5.368 ms                  |
| back: aggr dram keys      | 32.453 ms                 | 43.658 ms                 |
| back: set dram grad       | 2.285 ms                  | 7.379 ms                  |
| Backward                  | 96.221 ms                 | 129.954 ms                |
| Optimize                  | 30.159 ms                 | 53.037 ms                 |
| BarrierTimeBeforeRank0    | 46.609 us                 | 122.279 us                |
| BlockToStepN              | 13.374 us                 | 223.740 us                |
| OneStep                   | 139.586 ms                | 183.380 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.712 ms                  | 37.459 ms                 |
| Forward                   | 5.702 ms                  | 14.338 ms                 |
| back: bucket keys         | 388.866 us                | 890.561 us                |
| back: a2a                 | 5.814 ms                  | 29.257 ms                 |
| back: cache               | 2.983 ms                  | 5.423 ms                  |
| back: aggr dram keys      | 32.459 ms                 | 43.949 ms                 |
| back: set dram grad       | 2.284 ms                  | 7.379 ms                  |
| Backward                  | 96.221 ms                 | 129.828 ms                |
| Optimize                  | 30.049 ms                 | 52.066 ms                 |
| BarrierTimeBeforeRank0    | 47.078 us                 | 120.518 us                |
| BlockToStepN              | 12.843 us                 | 181.296 us                |
| OneStep                   | 139.586 ms                | 181.626 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 14.035, sample: 0.358, forward: 0.470, backward: 8.100, update: 0.410
[proc 2] 400 steps, total: 14.035, sample: 0.369, forward: 0.470, backward: 8.092, update: 0.405
[proc 1] 400 steps, total: 14.035, sample: 0.392, forward: 0.460, backward: 8.111, update: 0.391
[proc 0] 400 steps, total: 14.035, sample: 0.464, forward: 0.527, backward: 9.963, update: 2.974
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.710 ms                  | 37.459 ms                 |
| Forward                   | 5.620 ms                  | 14.338 ms                 |
| back: bucket keys         | 451.560 us                | 890.561 us                |
| back: a2a                 | 5.840 ms                  | 29.501 ms                 |
| back: cache               | 2.982 ms                  | 5.368 ms                  |
| back: aggr dram keys      | 32.509 ms                 | 43.949 ms                 |
| back: set dram grad       | 2.282 ms                  | 7.276 ms                  |
| Backward                  | 96.275 ms                 | 129.954 ms                |
| Optimize                  | 30.046 ms                 | 52.066 ms                 |
| BarrierTimeBeforeRank0    | 46.609 us                 | 120.518 us                |
| BlockToStepN              | 12.589 us                 | 223.740 us                |
| OneStep                   | 139.462 ms                | 181.626 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.707 ms                  | 37.733 ms                 |
| Forward                   | 5.605 ms                  | 14.338 ms                 |
| back: bucket keys         | 388.866 us                | 887.199 us                |
| back: a2a                 | 5.840 ms                  | 29.257 ms                 |
| back: cache               | 2.982 ms                  | 5.254 ms                  |
| back: aggr dram keys      | 32.496 ms                 | 43.658 ms                 |
| back: set dram grad       | 2.277 ms                  | 7.123 ms                  |
| Backward                  | 96.221 ms                 | 129.954 ms                |
| Optimize                  | 29.807 ms                 | 52.066 ms                 |
| BarrierTimeBeforeRank0    | 46.609 us                 | 120.518 us                |
| BlockToStepN              | 12.497 us                 | 223.740 us                |
| OneStep                   | 139.423 ms                | 181.626 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.696 ms                  | 37.511 ms                 |
| Forward                   | 5.577 ms                  | 13.159 ms                 |
| back: bucket keys         | 451.560 us                | 890.561 us                |
| back: a2a                 | 5.859 ms                  | 28.940 ms                 |
| back: cache               | 2.980 ms                  | 5.252 ms                  |
| back: aggr dram keys      | 32.459 ms                 | 43.658 ms                 |
| back: set dram grad       | 2.270 ms                  | 6.784 ms                  |
| Backward                  | 96.170 ms                 | 129.828 ms                |
| Optimize                  | 29.443 ms                 | 51.803 ms                 |
| BarrierTimeBeforeRank0    | 46.421 us                 | 120.468 us                |
| BlockToStepN              | 12.357 us                 | 181.296 us                |
| OneStep                   | 138.733 ms                | 180.709 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 13.701, sample: 0.397, forward: 0.464, backward: 8.063, update: 0.405
[proc 3] 500 steps, total: 13.702, sample: 0.371, forward: 0.470, backward: 8.081, update: 0.413
[proc 0] 500 steps, total: 13.701, sample: 0.477, forward: 0.534, backward: 9.838, update: 2.754
[proc 1] 500 steps, total: 13.702, sample: 0.381, forward: 0.451, backward: 8.104, update: 0.378
Successfully xmh. training takes 72.29716324806213 seconds
before call kg_cache_controller.StopThreads()
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
INFO [8845 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.696 ms                  | 37.511 ms                 |
| Forward                   | 5.567 ms                  | 13.159 ms                 |
| back: bucket keys         | 451.560 us                | 890.561 us                |
| back: a2a                 | 5.859 ms                  | 29.501 ms                 |
| back: cache               | 2.979 ms                  | 5.252 ms                  |
| back: aggr dram keys      | 32.517 ms                 | 43.658 ms                 |
| back: set dram grad       | 2.270 ms                  | 7.120 ms                  |
| Backward                  | 96.255 ms                 | 129.828 ms                |
| Optimize                  | 29.384 ms                 | 51.803 ms                 |
| BarrierTimeBeforeRank0    | 46.421 us                 | 120.468 us                |
| BlockToStepN              | 12.339 us                 | 181.296 us                |
| OneStep                   | 138.870 ms                | 180.709 ms                |
+---------------------------+---------------------------+---------------------------+

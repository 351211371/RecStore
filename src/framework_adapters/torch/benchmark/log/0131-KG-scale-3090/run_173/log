WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240205 22:14:06.371215 55255 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_59', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=7, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=7, gpu=[0, 1, 2, 3, 4, 5, 6], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [55255 sampler.py:454] Start PreSampling
WARNING [55255 sampler.py:532] Before construct renumbering_dict
WARNING [55255 sampler.py:555] PreSampling done
W20240205 22:14:11.048723 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240205 22:14:11.048907 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240205 22:14:11.048962 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240205 22:14:11.049013 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240205 22:14:11.049054 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240205 22:14:11.049093 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240205 22:14:11.049126 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240205 22:14:11.049168 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240205 22:14:11.049222 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240205 22:14:11.049252 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240205 22:14:11.049289 55255 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240205 22:14:11.049319 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240205 22:14:11.049348 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240205 22:14:11.049472 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240205 22:14:11.049511 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240205 22:14:11.049542 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240205 22:14:11.049593 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240205 22:14:11.049626 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240205 22:14:11.049656 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240205 22:14:11.049696 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240205 22:14:11.049733 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240205 22:14:11.049765 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240205 22:14:11.049803 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240205 22:14:11.049832 55255 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240205 22:14:11.049860 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240205 22:14:11.049885 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240205 22:14:11.049952 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240205 22:14:11.049988 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240205 22:14:11.050019 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240205 22:14:11.050050 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240205 22:14:11.050084 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240205 22:14:11.050127 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240205 22:14:11.050160 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240205 22:14:11.050190 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240205 22:14:11.050226 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240205 22:14:11.050261 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240205 22:14:11.050294 55255 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240205 22:14:11.050320 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240205 22:14:11.050352 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240205 22:14:11.050412 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240205 22:14:11.050444 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240205 22:14:11.050480 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240205 22:14:11.050511 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240205 22:14:11.050541 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240205 22:14:11.050572 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240205 22:14:11.050617 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240205 22:14:11.050657 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240205 22:14:11.050694 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240205 22:14:11.050729 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240205 22:14:11.050762 55255 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240205 22:14:11.050788 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240205 22:14:11.050814 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240205 22:14:11.050880 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240205 22:14:11.050921 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240205 22:14:11.050953 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240205 22:14:11.050989 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240205 22:14:11.051028 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240205 22:14:11.051064 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240205 22:14:11.051102 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240205 22:14:11.051139 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240205 22:14:11.051170 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240205 22:14:11.051200 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240205 22:14:11.051236 55255 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240205 22:14:11.051263 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240205 22:14:11.051290 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240205 22:14:11.051347 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240205 22:14:11.051379 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240205 22:14:11.051411 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240205 22:14:11.051443 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240205 22:14:11.051479 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240205 22:14:11.051515 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240205 22:14:11.051550 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240205 22:14:11.051584 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240205 22:14:11.051618 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240205 22:14:11.051654 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240205 22:14:11.051689 55255 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240205 22:14:11.051715 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240205 22:14:11.051743 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240205 22:14:11.051797 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_0 [1000000]0x10001ca5a000 7.629 MB
W20240205 22:14:11.051831 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_1 [1000000]0x10001d1fd000 7.629 MB
W20240205 22:14:11.051872 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_2 [1000000]0x10001d9a0000 7.629 MB
W20240205 22:14:11.051903 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_3 [1000000]0x10001e143000 7.629 MB
W20240205 22:14:11.051939 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_4 [1000000]0x10001e8e6000 7.629 MB
W20240205 22:14:11.051971 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_5 [1000000]0x10001f089000 7.629 MB
W20240205 22:14:11.052003 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_6 [1000000]0x10001f82c000 7.629 MB
W20240205 22:14:11.052043 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_7 [1000000]0x10001ffcf000 7.629 MB
W20240205 22:14:11.052114 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_8 [1000000]0x100020772000 7.629 MB
W20240205 22:14:11.052161 55255 IPCTensor.h:369] NewIPCTensor: cached_sampler_r6_9 [1000000]0x100020f15000 7.629 MB
W20240205 22:14:11.052201 55255 IPCTensor.h:369] NewIPCTensor: step_r6 [10]0x1000216b8000 80 B 
W20240205 22:14:11.052232 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r6 [1]0x1000216ba000 8 B 
W20240205 22:14:11.052269 55255 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r6 [1]0x1000216bc000 8 B 
W20240205 22:14:11.303951 55255 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000216be000 22.81 MB
W20240205 22:14:11.392012 55255 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100022d90000 58.4 kB
{0: Graph(num_nodes=8708, num_edges=114062,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=8851, num_edges=101101,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=6696, num_edges=94778,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=10148, num_edges=151271,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=8972, num_edges=107004,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=8551, num_edges=124920,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 6: Graph(num_nodes=9450, num_edges=118501,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 8708 N 114062 E
MertisPartition: part 1 has 8851 N 101101 E
MertisPartition: part 2 has 6696 N 94778 E
MertisPartition: part 3 has 10148 N 151271 E
MertisPartition: part 4 has 8972 N 107004 E
MertisPartition: part 5 has 8551 N 124920 E
MertisPartition: part 6 has 9450 N 118501 E
Rank0: cached key size 106
Rank1: cached key size 106
Rank2: cached key size 106
Rank3: cached key size 106
Rank4: cached key size 106
Rank5: cached key size 106
Rank6: cached key size 106
Before renumbering graph:  {'_ID': tensor([    7,    16,    18,  ..., 13890,  3788,  5916]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 5, 1])}
After renumbering graph:  {'_ID': tensor([  901,  1113,  1159,  ..., 12903,  2467, 11866]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 5, 1])}
part_g: DGLGraph(num_nodes=8708, num_edges=114062,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=8708, num_edges=114062,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.119 seconds
[Rank1] pid = 55458
[Rank2] pid = 55481
[Rank3] pid = 55586
[Rank4] pid = 55649
[Rank5] pid = 55658
INFO [55255 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [55458 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [55481 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [55586 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [55649 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [55658 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [55715 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 6
INFO [55586 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 7 nodes.
INFO [55481 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 7 nodes.
INFO [55658 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 7 nodes.
INFO [55715 distributed_c10d.py:476] Rank 6: Completed store-based barrier for key:store_based_barrier_key:1 with 7 nodes.
INFO [55458 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 7 nodes.
INFO [55649 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 7 nodes.
INFO [55255 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 7 nodes.
WARNING [55658 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [55715 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [55586 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [55255 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [55481 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [55458 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [55649 DistTensor.py:59] The tensor name already exists in the kvstore
I20240205 22:14:13.901307 55718 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 7
I20240205 22:14:13.901391 55523 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 7
I20240205 22:14:13.901458 55587 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 7
I20240205 22:14:13.901530 55716 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 7
I20240205 22:14:13.901648 55717 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 7
I20240205 22:14:13.901713 55651 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 7
I20240205 22:14:13.901783 55459 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 7
E20240205 22:14:14.566689 55587 recstore.cc:66] init folly done
E20240205 22:14:14.566732 55459 recstore.cc:66] init folly done
E20240205 22:14:14.566763 55717 recstore.cc:66] init folly done
E20240205 22:14:14.566774 55651 recstore.cc:66] init folly done
E20240205 22:14:14.566779 55523 recstore.cc:66] init folly done
E20240205 22:14:14.566857 55716 recstore.cc:66] init folly done
E20240205 22:14:14.567204 55718 recstore.cc:66] init folly done
I20240205 22:14:14.650698 55523 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 7
I20240205 22:14:14.652875 55651 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 7
I20240205 22:14:14.653861 55718 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 7
I20240205 22:14:14.655236 55459 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 7
I20240205 22:14:14.657908 55717 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 7
I20240205 22:14:14.661985 55587 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 7
I20240205 22:14:14.662923 55716 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.647 ms                  | 26.133 ms                 |
| bucket keys               | 2.666 ms                  | 171.434 ms                |
| forward: a2a keys         | 2.110 ms                  | 1.135 s                   |
| forward: search cache     | 417.533 us                | 23.779 ms                 |
| forward: a2a values       | 3.411 ms                  | 13.770 ms                 |
| forward: join             | 2.949 ms                  | 3.174 ms                  |
| Forward                   | 33.766 ms                 | 1.662 s                   |
| back: aggr dram keys      | 42.857 ms                 | 852.408 ms                |
| back: set dram grad       | 3.492 ms                  | 6.737 ms                  |
| back: a2a grad            | 7.142 ms                  | 15.661 ms                 |
| back: grad sum & grad cache  | 5.229 ms                  | 13.122 ms                 |
| Backward                  | 125.384 ms                | 1.142 s                   |
| Optimize                  | 36.798 ms                 | 69.244 ms                 |
| BarrierTimeBeforeRank0    | 68.508 us                 | 102.789 us                |
| BlockToStepN              | 15.306 us                 | 128.951 us                |
| OneStep                   | 199.543 ms                | 2.875 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.588 ms                  | 26.133 ms                 |
| bucket keys               | 2.635 ms                  | 6.583 ms                  |
| forward: a2a keys         | 2.330 ms                  | 13.086 ms                 |
| forward: search cache     | 403.142 us                | 977.986 us                |
| forward: a2a values       | 3.347 ms                  | 9.251 ms                  |
| forward: join             | 2.949 ms                  | 3.796 ms                  |
| Forward                   | 34.036 ms                 | 1.662 s                   |
| back: aggr dram keys      | 43.917 ms                 | 59.919 ms                 |
| back: set dram grad       | 3.492 ms                  | 6.737 ms                  |
| back: a2a grad            | 6.736 ms                  | 11.839 ms                 |
| back: grad sum & grad cache  | 5.047 ms                  | 9.919 ms                  |
| Backward                  | 122.917 ms                | 1.142 s                   |
| Optimize                  | 25.773 ms                 | 69.244 ms                 |
| BarrierTimeBeforeRank0    | 53.809 us                 | 102.789 us                |
| BlockToStepN              | 19.708 us                 | 140.661 us                |
| OneStep                   | 186.010 ms                | 2.875 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.668 ms                  | 26.133 ms                 |
| bucket keys               | 2.671 ms                  | 6.583 ms                  |
| forward: a2a keys         | 2.181 ms                  | 13.086 ms                 |
| forward: search cache     | 408.934 us                | 977.986 us                |
| forward: a2a values       | 3.377 ms                  | 9.251 ms                  |
| forward: join             | 2.885 ms                  | 3.796 ms                  |
| Forward                   | 33.766 ms                 | 46.042 ms                 |
| back: aggr dram keys      | 43.715 ms                 | 59.988 ms                 |
| back: set dram grad       | 3.510 ms                  | 6.737 ms                  |
| back: a2a grad            | 6.620 ms                  | 11.839 ms                 |
| back: grad sum & grad cache  | 5.192 ms                  | 9.919 ms                  |
| Backward                  | 122.232 ms                | 145.390 ms                |
| Optimize                  | 27.129 ms                 | 41.045 ms                 |
| BarrierTimeBeforeRank0    | 53.809 us                 | 98.160 us                 |
| BlockToStepN              | 18.288 us                 | 128.951 us                |
| OneStep                   | 187.160 ms                | 236.216 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.683 ms                  | 26.133 ms                 |
| bucket keys               | 2.691 ms                  | 4.194 ms                  |
| forward: a2a keys         | 2.110 ms                  | 25.899 ms                 |
| forward: search cache     | 411.037 us                | 537.323 us                |
| forward: a2a values       | 3.379 ms                  | 6.494 ms                  |
| forward: join             | 2.894 ms                  | 3.796 ms                  |
| Forward                   | 33.030 ms                 | 58.477 ms                 |
| back: aggr dram keys      | 43.083 ms                 | 59.919 ms                 |
| back: set dram grad       | 3.515 ms                  | 6.737 ms                  |
| back: a2a grad            | 6.581 ms                  | 11.047 ms                 |
| back: grad sum & grad cache  | 5.193 ms                  | 8.558 ms                  |
| Backward                  | 121.213 ms                | 145.390 ms                |
| Optimize                  | 27.619 ms                 | 41.045 ms                 |
| BarrierTimeBeforeRank0    | 52.237 us                 | 98.160 us                 |
| BlockToStepN              | 17.575 us                 | 128.951 us                |
| OneStep                   | 187.125 ms                | 236.216 ms                |
+---------------------------+---------------------------+---------------------------+
[Rank6] pid = 55715
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482), (4482, 5229)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 3335,  4655, 12071, 12125,  5280, 10983,  3123,     1,    12,  8982]) tensor([ 1159,  9432,  1658, 11412,    45,  8811,   289,  3459, 12163, 12520])
-------Step 1-------
tensor([ 3335,  4655, 12071, 12125,  5280, 10983,  3123,     1,    12,  8982]) tensor([11135, 10649,  6288, 14342,  4451,  7971,  1206,  1547,   545,  7393])
-------Step 2-------
tensor([ 5153,  9106,  3673, 12592, 13740, 11212,  5229,  6950, 10405,    45]) tensor([ 3271,  7755, 11770,  7367,  7115, 12820,  8840,  7876,  8967, 10155])
-------Step 3-------
tensor([ 5153,  9106,  3673, 12592, 13740, 11212,  5229,  6950, 10405,    45]) tensor([ 5231, 13769,   587,  7813,  1941,   853,  9268, 12172,  3460, 10131])
-------Step 4-------
tensor([13303, 11020,  7632,  6190,  4213,  1048, 13719,  7611,  7070,  2138]) tensor([10795, 10008,  2709,  1136, 14171,  8952, 10107, 10252,  3335,  2869])
-------Step 5-------
tensor([13303, 11020,  7632,  6190,  4213,  1048, 13719,  7611,  7070,  2138]) tensor([ 5753,  8214, 12037,  5367,  2703, 11757,  8167,  8785,  1900,  3911])
-------Step 6-------
tensor([   97,   977, 10536,  1651,  5436,  2932,  7360, 13530, 10636,    87]) tensor([ 6374,  1185,  7355, 14029,   199,  2909,  4202, 13485,  5351,  5620])
-------Step 7-------
tensor([   97,   977, 10536,  1651,  5436,  2932,  7360, 13530, 10636,    87]) tensor([3586, 7927, 5726, 1678, 8801, 3452, 2562, 7097, 7823,  101])
-------Step 8-------
tensor([ 6311, 11507, 11498,   901,  1532,  4072,  3543, 12649,  9648,  2944]) tensor([ 1549,  1104,  9865, 10444,  8074, 11565,  6405, 13398,  8535,  1151])
-------Step 9-------
tensor([ 6311, 11507, 11498,   901,  1532,  4072,  3543, 12649,  9648,  2944]) tensor([ 5090,  6204, 10156, 10565,  1608,  7852, 11142,  3857, 11715,  6041])
before start barrier
start train
[proc 0] 100 steps, total: 21.735, sample: 0.442, forward: 5.120, backward: 13.188, update: 2.864
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 21.740, sample: 0.422, forward: 5.084, backward: 13.035, update: 0.385
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 21.736, sample: 0.421, forward: 5.071, backward: 13.018, update: 0.536
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 21.747, sample: 0.382, forward: 5.101, backward: 13.047, update: 0.519
train_sampler.Prefill()
before start barrier
start train
[proc 6] 100 steps, total: 21.744, sample: 0.403, forward: 5.094, backward: 13.038, update: 0.382
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 21.745, sample: 0.455, forward: 5.041, backward: 13.035, update: 0.433
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 21.743, sample: 0.439, forward: 5.068, backward: 13.025, update: 0.555
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.678 ms                  | 26.803 ms                 |
| bucket keys               | 2.714 ms                  | 4.194 ms                  |
| forward: a2a keys         | 2.151 ms                  | 27.846 ms                 |
| forward: search cache     | 412.160 us                | 718.497 us                |
| forward: a2a values       | 3.365 ms                  | 6.494 ms                  |
| forward: join             | 2.922 ms                  | 4.230 ms                  |
| Forward                   | 33.563 ms                 | 58.480 ms                 |
| back: aggr dram keys      | 43.525 ms                 | 59.919 ms                 |
| back: set dram grad       | 3.524 ms                  | 6.920 ms                  |
| back: a2a grad            | 6.572 ms                  | 11.047 ms                 |
| back: grad sum & grad cache  | 5.202 ms                  | 8.558 ms                  |
| Backward                  | 120.938 ms                | 145.390 ms                |
| Optimize                  | 27.988 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 52.237 us                 | 98.160 us                 |
| BlockToStepN              | 17.836 us                 | 135.503 us                |
| OneStep                   | 189.806 ms                | 236.216 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.711 ms                  | 27.794 ms                 |
| bucket keys               | 2.721 ms                  | 3.691 ms                  |
| forward: a2a keys         | 2.151 ms                  | 28.163 ms                 |
| forward: search cache     | 414.149 us                | 578.564 us                |
| forward: a2a values       | 3.336 ms                  | 6.185 ms                  |
| forward: join             | 2.958 ms                  | 3.796 ms                  |
| Forward                   | 34.117 ms                 | 59.032 ms                 |
| back: aggr dram keys      | 43.438 ms                 | 58.036 ms                 |
| back: set dram grad       | 3.526 ms                  | 6.774 ms                  |
| back: a2a grad            | 6.544 ms                  | 9.901 ms                  |
| back: grad sum & grad cache  | 5.209 ms                  | 8.295 ms                  |
| Backward                  | 120.672 ms                | 145.390 ms                |
| Optimize                  | 28.167 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 52.725 us                 | 98.160 us                 |
| BlockToStepN              | 17.506 us                 | 135.503 us                |
| OneStep                   | 194.199 ms                | 236.216 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.711 ms                  | 26.840 ms                 |
| bucket keys               | 2.730 ms                  | 4.264 ms                  |
| forward: a2a keys         | 2.163 ms                  | 29.059 ms                 |
| forward: search cache     | 415.556 us                | 578.564 us                |
| forward: a2a values       | 3.341 ms                  | 6.185 ms                  |
| forward: join             | 2.970 ms                  | 3.796 ms                  |
| Forward                   | 34.386 ms                 | 59.129 ms                 |
| back: aggr dram keys      | 43.434 ms                 | 58.036 ms                 |
| back: set dram grad       | 3.527 ms                  | 6.920 ms                  |
| back: a2a grad            | 6.531 ms                  | 10.035 ms                 |
| back: grad sum & grad cache  | 5.197 ms                  | 8.295 ms                  |
| Backward                  | 121.180 ms                | 143.191 ms                |
| Optimize                  | 28.743 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 53.059 us                 | 94.930 us                 |
| BlockToStepN              | 17.727 us                 | 128.951 us                |
| OneStep                   | 195.500 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.730 ms                  | 27.794 ms                 |
| bucket keys               | 2.730 ms                  | 4.194 ms                  |
| forward: a2a keys         | 2.142 ms                  | 28.299 ms                 |
| forward: search cache     | 414.597 us                | 556.074 us                |
| forward: a2a values       | 3.379 ms                  | 5.692 ms                  |
| forward: join             | 2.950 ms                  | 3.737 ms                  |
| Forward                   | 34.531 ms                 | 59.129 ms                 |
| back: aggr dram keys      | 43.514 ms                 | 57.950 ms                 |
| back: set dram grad       | 3.533 ms                  | 6.833 ms                  |
| back: a2a grad            | 6.572 ms                  | 10.035 ms                 |
| back: grad sum & grad cache  | 5.204 ms                  | 8.161 ms                  |
| Backward                  | 121.323 ms                | 143.191 ms                |
| Optimize                  | 28.706 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 53.059 us                 | 94.930 us                 |
| BlockToStepN              | 17.389 us                 | 128.951 us                |
| OneStep                   | 198.424 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 20.464, sample: 0.423, forward: 4.649, backward: 12.042, update: 0.502
[proc 6] 200 steps, total: 20.464, sample: 0.423, forward: 4.640, backward: 12.059, update: 0.304
[proc 2] 200 steps, total: 20.464, sample: 0.435, forward: 4.633, backward: 12.054, update: 0.456
[proc 5] 200 steps, total: 20.464, sample: 0.441, forward: 4.621, backward: 12.079, update: 0.318
[proc 3] 200 steps, total: 20.464, sample: 0.439, forward: 4.626, backward: 12.032, update: 0.445
[proc 0] 200 steps, total: 20.464, sample: 0.479, forward: 4.640, backward: 12.227, update: 2.994
[proc 4] 200 steps, total: 20.464, sample: 0.387, forward: 4.677, backward: 12.046, update: 0.474
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.683 ms                  | 27.794 ms                 |
| bucket keys               | 2.735 ms                  | 4.194 ms                  |
| forward: a2a keys         | 2.178 ms                  | 29.059 ms                 |
| forward: search cache     | 413.700 us                | 558.674 us                |
| forward: a2a values       | 3.375 ms                  | 5.692 ms                  |
| forward: join             | 2.941 ms                  | 3.796 ms                  |
| Forward                   | 34.697 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.095 ms                 | 57.950 ms                 |
| back: set dram grad       | 3.531 ms                  | 6.833 ms                  |
| back: a2a grad            | 6.599 ms                  | 10.035 ms                 |
| back: grad sum & grad cache  | 5.204 ms                  | 8.161 ms                  |
| Backward                  | 121.180 ms                | 143.191 ms                |
| Optimize                  | 28.589 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 52.370 us                 | 94.930 us                 |
| BlockToStepN              | 17.389 us                 | 138.443 us                |
| OneStep                   | 199.104 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.692 ms                  | 30.318 ms                 |
| bucket keys               | 2.738 ms                  | 3.691 ms                  |
| forward: a2a keys         | 2.163 ms                  | 28.939 ms                 |
| forward: search cache     | 413.680 us                | 556.074 us                |
| forward: a2a values       | 3.365 ms                  | 5.494 ms                  |
| forward: join             | 2.949 ms                  | 3.737 ms                  |
| Forward                   | 34.439 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.434 ms                 | 57.950 ms                 |
| back: set dram grad       | 3.526 ms                  | 6.774 ms                  |
| back: a2a grad            | 6.599 ms                  | 9.901 ms                  |
| back: grad sum & grad cache  | 5.206 ms                  | 8.161 ms                  |
| Backward                  | 121.130 ms                | 143.191 ms                |
| Optimize                  | 28.604 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 52.370 us                 | 94.930 us                 |
| BlockToStepN              | 17.231 us                 | 141.267 us                |
| OneStep                   | 198.707 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.692 ms                  | 28.384 ms                 |
| bucket keys               | 2.739 ms                  | 3.691 ms                  |
| forward: a2a keys         | 2.144 ms                  | 29.059 ms                 |
| forward: search cache     | 413.837 us                | 556.074 us                |
| forward: a2a values       | 3.357 ms                  | 5.494 ms                  |
| forward: join             | 2.958 ms                  | 3.796 ms                  |
| Forward                   | 34.439 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.438 ms                 | 59.117 ms                 |
| back: set dram grad       | 3.521 ms                  | 6.774 ms                  |
| back: a2a grad            | 6.598 ms                  | 10.035 ms                 |
| back: grad sum & grad cache  | 5.209 ms                  | 8.161 ms                  |
| Backward                  | 120.715 ms                | 145.390 ms                |
| Optimize                  | 28.706 ms                 | 41.288 ms                 |
| BarrierTimeBeforeRank0    | 51.371 us                 | 93.180 us                 |
| BlockToStepN              | 17.267 us                 | 140.661 us                |
| OneStep                   | 199.104 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.696 ms                  | 28.384 ms                 |
| bucket keys               | 2.747 ms                  | 4.194 ms                  |
| forward: a2a keys         | 2.134 ms                  | 28.939 ms                 |
| forward: search cache     | 414.266 us                | 556.074 us                |
| forward: a2a values       | 3.368 ms                  | 5.494 ms                  |
| forward: join             | 2.958 ms                  | 3.796 ms                  |
| Forward                   | 34.260 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.139 ms                 | 58.036 ms                 |
| back: set dram grad       | 3.516 ms                  | 6.774 ms                  |
| back: a2a grad            | 6.612 ms                  | 9.901 ms                  |
| back: grad sum & grad cache  | 5.197 ms                  | 8.161 ms                  |
| Backward                  | 120.656 ms                | 145.390 ms                |
| Optimize                  | 28.706 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 51.109 us                 | 93.180 us                 |
| BlockToStepN              | 17.173 us                 | 140.661 us                |
| OneStep                   | 198.707 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 19.837, sample: 0.414, forward: 4.212, backward: 11.908, update: 0.490
[proc 2] 300 steps, total: 19.837, sample: 0.377, forward: 4.249, backward: 11.915, update: 0.273
[proc 6] 300 steps, total: 19.837, sample: 0.424, forward: 4.197, backward: 11.918, update: 0.365
[proc 4] 300 steps, total: 19.837, sample: 0.433, forward: 4.184, backward: 11.906, update: 0.306
[proc 3] 300 steps, total: 19.837, sample: 0.421, forward: 4.200, backward: 11.895, update: 0.277
[proc 5] 300 steps, total: 19.837, sample: 0.404, forward: 4.214, backward: 11.973, update: 0.439
[proc 0] 300 steps, total: 19.837, sample: 0.514, forward: 4.151, backward: 12.110, update: 2.938
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.711 ms                  | 28.384 ms                 |
| bucket keys               | 2.741 ms                  | 4.194 ms                  |
| forward: a2a keys         | 2.110 ms                  | 28.939 ms                 |
| forward: search cache     | 414.386 us                | 556.074 us                |
| forward: a2a values       | 3.354 ms                  | 5.494 ms                  |
| forward: join             | 2.957 ms                  | 3.796 ms                  |
| Forward                   | 34.439 ms                 | 62.399 ms                 |
| back: aggr dram keys      | 43.434 ms                 | 58.435 ms                 |
| back: set dram grad       | 3.511 ms                  | 6.774 ms                  |
| back: a2a grad            | 6.621 ms                  | 9.901 ms                  |
| back: grad sum & grad cache  | 5.202 ms                  | 8.161 ms                  |
| Backward                  | 120.631 ms                | 145.390 ms                |
| Optimize                  | 28.701 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 51.469 us                 | 93.180 us                 |
| BlockToStepN              | 17.267 us                 | 140.661 us                |
| OneStep                   | 199.370 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.711 ms                  | 29.133 ms                 |
| bucket keys               | 2.736 ms                  | 4.264 ms                  |
| forward: a2a keys         | 2.089 ms                  | 28.761 ms                 |
| forward: search cache     | 414.489 us                | 558.674 us                |
| forward: a2a values       | 3.343 ms                  | 5.472 ms                  |
| forward: join             | 2.963 ms                  | 3.796 ms                  |
| Forward                   | 34.439 ms                 | 62.399 ms                 |
| back: aggr dram keys      | 43.450 ms                 | 58.435 ms                 |
| back: set dram grad       | 3.507 ms                  | 6.737 ms                  |
| back: a2a grad            | 6.621 ms                  | 9.901 ms                  |
| back: grad sum & grad cache  | 5.204 ms                  | 7.991 ms                  |
| Backward                  | 120.539 ms                | 145.390 ms                |
| Optimize                  | 28.583 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 51.469 us                 | 93.180 us                 |
| BlockToStepN              | 17.267 us                 | 141.267 us                |
| OneStep                   | 199.391 ms                | 235.121 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.696 ms                  | 28.384 ms                 |
| bucket keys               | 2.731 ms                  | 4.269 ms                  |
| forward: a2a keys         | 2.093 ms                  | 28.823 ms                 |
| forward: search cache     | 414.386 us                | 578.564 us                |
| forward: a2a values       | 3.343 ms                  | 5.692 ms                  |
| forward: join             | 2.960 ms                  | 3.895 ms                  |
| Forward                   | 34.697 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.438 ms                 | 59.409 ms                 |
| back: set dram grad       | 3.507 ms                  | 6.737 ms                  |
| back: a2a grad            | 6.634 ms                  | 9.901 ms                  |
| back: grad sum & grad cache  | 5.202 ms                  | 7.991 ms                  |
| Backward                  | 120.514 ms                | 143.191 ms                |
| Optimize                  | 28.030 ms                 | 41.302 ms                 |
| BarrierTimeBeforeRank0    | 51.371 us                 | 91.033 us                 |
| BlockToStepN              | 17.388 us                 | 140.661 us                |
| OneStep                   | 199.181 ms                | 231.985 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.696 ms                  | 28.384 ms                 |
| bucket keys               | 2.729 ms                  | 4.264 ms                  |
| forward: a2a keys         | 2.092 ms                  | 28.939 ms                 |
| forward: search cache     | 414.119 us                | 560.359 us                |
| forward: a2a values       | 3.342 ms                  | 5.494 ms                  |
| forward: join             | 2.953 ms                  | 3.818 ms                  |
| Forward                   | 34.811 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.434 ms                 | 59.117 ms                 |
| back: set dram grad       | 3.507 ms                  | 6.636 ms                  |
| back: a2a grad            | 6.648 ms                  | 9.696 ms                  |
| back: grad sum & grad cache  | 5.199 ms                  | 7.991 ms                  |
| Backward                  | 120.441 ms                | 143.191 ms                |
| Optimize                  | 28.146 ms                 | 41.302 ms                 |
| BarrierTimeBeforeRank0    | 51.057 us                 | 91.033 us                 |
| BlockToStepN              | 17.267 us                 | 141.267 us                |
| OneStep                   | 199.446 ms                | 231.985 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 20.080, sample: 0.390, forward: 4.581, backward: 11.921, update: 0.263
[proc 0] 400 steps, total: 20.080, sample: 0.460, forward: 4.569, backward: 12.137, update: 2.794
[proc 5] 400 steps, total: 20.080, sample: 0.463, forward: 4.512, backward: 11.985, update: 0.461
[proc 2] 400 steps, total: 20.080, sample: 0.420, forward: 4.558, backward: 11.940, update: 0.274
[proc 4] 400 steps, total: 20.080, sample: 0.417, forward: 4.554, backward: 11.935, update: 0.464
[proc 1] 400 steps, total: 20.080, sample: 0.429, forward: 4.553, backward: 11.939, update: 0.482
[proc 6] 400 steps, total: 20.080, sample: 0.402, forward: 4.568, backward: 11.941, update: 0.391
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.692 ms                  | 28.384 ms                 |
| bucket keys               | 2.729 ms                  | 4.264 ms                  |
| forward: a2a keys         | 2.098 ms                  | 28.939 ms                 |
| forward: search cache     | 413.936 us                | 560.359 us                |
| forward: a2a values       | 3.337 ms                  | 5.692 ms                  |
| forward: join             | 2.947 ms                  | 3.818 ms                  |
| Forward                   | 35.815 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.514 ms                 | 59.117 ms                 |
| back: set dram grad       | 3.507 ms                  | 6.701 ms                  |
| back: a2a grad            | 6.658 ms                  | 9.750 ms                  |
| back: grad sum & grad cache  | 5.199 ms                  | 7.991 ms                  |
| Backward                  | 120.441 ms                | 145.390 ms                |
| Optimize                  | 28.153 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 50.963 us                 | 91.033 us                 |
| BlockToStepN              | 17.166 us                 | 143.384 us                |
| OneStep                   | 200.324 ms                | 231.985 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.690 ms                  | 28.384 ms                 |
| bucket keys               | 2.728 ms                  | 4.264 ms                  |
| forward: a2a keys         | 2.093 ms                  | 28.823 ms                 |
| forward: search cache     | 413.636 us                | 558.674 us                |
| forward: a2a values       | 3.343 ms                  | 5.494 ms                  |
| forward: join             | 2.945 ms                  | 3.818 ms                  |
| Forward                   | 36.354 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.514 ms                 | 59.409 ms                 |
| back: set dram grad       | 3.508 ms                  | 6.701 ms                  |
| back: a2a grad            | 6.665 ms                  | 9.696 ms                  |
| back: grad sum & grad cache  | 5.204 ms                  | 7.991 ms                  |
| Backward                  | 120.539 ms                | 145.390 ms                |
| Optimize                  | 28.264 ms                 | 41.733 ms                 |
| BarrierTimeBeforeRank0    | 50.981 us                 | 91.033 us                 |
| BlockToStepN              | 17.161 us                 | 148.038 us                |
| OneStep                   | 200.608 ms                | 231.985 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.693 ms                  | 29.041 ms                 |
| bucket keys               | 2.726 ms                  | 4.269 ms                  |
| forward: a2a keys         | 2.092 ms                  | 28.939 ms                 |
| forward: search cache     | 413.447 us                | 558.674 us                |
| forward: a2a values       | 3.354 ms                  | 5.494 ms                  |
| forward: join             | 2.938 ms                  | 3.818 ms                  |
| Forward                   | 36.373 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.525 ms                 | 59.950 ms                 |
| back: set dram grad       | 3.511 ms                  | 6.701 ms                  |
| back: a2a grad            | 6.683 ms                  | 9.696 ms                  |
| back: grad sum & grad cache  | 5.206 ms                  | 7.991 ms                  |
| Backward                  | 120.441 ms                | 145.390 ms                |
| Optimize                  | 28.321 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 51.109 us                 | 86.297 us                 |
| BlockToStepN              | 17.121 us                 | 143.384 us                |
| OneStep                   | 200.521 ms                | 233.561 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.685 ms                  | 29.041 ms                 |
| bucket keys               | 2.725 ms                  | 4.269 ms                  |
| forward: a2a keys         | 2.089 ms                  | 28.939 ms                 |
| forward: search cache     | 413.407 us                | 556.074 us                |
| forward: a2a values       | 3.355 ms                  | 5.472 ms                  |
| forward: join             | 2.941 ms                  | 3.796 ms                  |
| Forward                   | 35.863 ms                 | 60.679 ms                 |
| back: aggr dram keys      | 43.574 ms                 | 59.950 ms                 |
| back: set dram grad       | 3.511 ms                  | 6.731 ms                  |
| back: a2a grad            | 6.687 ms                  | 9.696 ms                  |
| back: grad sum & grad cache  | 5.210 ms                  | 8.074 ms                  |
| Backward                  | 120.476 ms                | 145.390 ms                |
| Optimize                  | 28.002 ms                 | 41.615 ms                 |
| BarrierTimeBeforeRank0    | 51.109 us                 | 86.297 us                 |
| BlockToStepN              | 17.166 us                 | 148.038 us                |
| OneStep                   | 200.324 ms                | 233.561 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 500 steps, total: 20.162, sample: 0.471, forward: 4.428, backward: 12.293, update: 2.853
[proc 1] 500 steps, total: 20.162, sample: 0.432, forward: 4.423, backward: 12.066, update: 0.472
[proc 4] 500 steps, total: 20.162, sample: 0.435, forward: 4.396, backward: 12.072, update: 0.368
[proc 3] 500 steps, total: 20.162, sample: 0.422, forward: 4.409, backward: 12.063, update: 0.265
[proc 2] 500 steps, total: 20.162, sample: 0.395, forward: 4.447, backward: 12.074, update: 0.335
[proc 6] 500 steps, total: 20.162, sample: 0.441, forward: 4.392, backward: 12.085, update: 0.459
Successfully xmh. training takes 102.27799725532532 seconds
[proc 5] 500 steps, total: 20.162, sample: 0.393, forward: 4.444, backward: 12.117, update: 0.274
before call kg_cache_controller.StopThreads()
INFO [55255 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker6: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads
INFO [55255 controller_process.py:421] call rank0 to StopThreads

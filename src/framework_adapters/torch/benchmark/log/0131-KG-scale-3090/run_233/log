WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 09:29:41.983074 31020 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_35', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=3, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=3, gpu=[0, 1, 2], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [31020 sampler.py:454] Start PreSampling
WARNING [31020 sampler.py:532] Before construct renumbering_dict
WARNING [31020 sampler.py:555] PreSampling done
W20240207 09:47:55.500478 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 09:47:55.500687 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 09:47:55.500734 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 09:47:55.500769 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 09:47:55.500805 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 09:47:55.500851 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 09:47:55.500888 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 09:47:55.500939 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 09:47:55.500984 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 09:47:55.501025 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 09:47:55.501070 31020 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 09:47:55.501098 31020 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 09:47:55.501134 31020 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 09:47:55.501302 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 09:47:55.501350 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 09:47:55.501389 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 09:47:55.501430 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 09:47:55.501462 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 09:47:55.501495 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 09:47:55.501535 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 09:47:55.501576 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 09:47:55.501612 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 09:47:55.501650 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 09:47:55.501683 31020 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 09:47:55.501708 31020 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 09:47:55.501736 31020 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 09:47:55.501806 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240207 09:47:55.501847 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240207 09:47:55.501878 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240207 09:47:55.501909 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240207 09:47:55.501943 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240207 09:47:55.501977 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240207 09:47:55.502018 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240207 09:47:55.502054 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240207 09:47:55.502085 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240207 09:47:55.502128 31020 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240207 09:47:55.502166 31020 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240207 09:47:55.502192 31020 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240207 09:47:55.502221 31020 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240207 09:47:55.970726 31020 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10000e52e000 128.2 GB
W20240207 09:56:28.898501 31020 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10201d166000 328.3 MB
{0: Graph(num_nodes=32806815, num_edges=98289586,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=31756927, num_edges=120802495,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=32681333, num_edges=137186093,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 32806815 N 98289586 E
MertisPartition: part 1 has 31756927 N 120802495 E
MertisPartition: part 2 has 32681333 N 137186093 E
Rank0: cached key size 1434235
Rank1: cached key size 1434235
Rank2: cached key size 1434235
Before renumbering graph:  {'_ID': tensor([     196,      197,      239,  ..., 85907466, 77843586,   627118]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4308841,  4308882,  4310203,  ..., 70932450, 85380081, 23621822]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2107.990 seconds
[Rank1] pid = 32074
INFO [31020 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [32074 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [32169 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [31020 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [32074 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [32169 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
WARNING [32074 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [31020 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [32169 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 10:05:02.264164 32170 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 3
I20240207 10:05:02.264621 32233 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
I20240207 10:05:02.264823 32075 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
E20240207 10:05:03.579525 32233 recstore.cc:66] init folly done
E20240207 10:05:03.579604 32075 recstore.cc:66] init folly done
E20240207 10:05:03.579602 32170 recstore.cc:66] init folly done
I20240207 10:05:18.357301 32233 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 3
I20240207 10:05:20.852567 32075 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
I20240207 10:05:23.952280 32170 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 12.609 ms                 | 102.926 ms                |
| bucket keys               | 1.907 ms                  | 146.066 ms                |
| forward: a2a keys         | 2.260 ms                  | 759.337 ms                |
| forward: search cache     | 189.259 us                | 20.848 ms                 |
| forward: a2a values       | 1.355 ms                  | 14.796 ms                 |
| forward: join             | 1.397 ms                  | 2.842 ms                  |
| Forward                   | 32.393 ms                 | 1.269 s                   |
| back: aggr dram keys      | 44.659 ms                 | 303.868 ms                |
| back: set dram grad       | 4.818 ms                  | 7.609 ms                  |
| back: a2a grad            | 2.964 ms                  | 15.920 ms                 |
| back: grad sum & grad cache  | 1.763 ms                  | 31.501 ms                 |
| Backward                  | 101.714 ms                | 551.744 ms                |
| Optimize                  | 17.999 ms                 | 52.277 ms                 |
| BarrierTimeBeforeRank0    | 56.766 us                 | 70.645 us                 |
| BlockToStepN              | 17.686 us                 | 31.545 us                 |
| OneStep                   | 161.827 ms                | 1.887 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.328 ms                  | 102.926 ms                |
| bucket keys               | 1.920 ms                  | 3.434 ms                  |
| forward: a2a keys         | 1.460 ms                  | 52.151 ms                 |
| forward: search cache     | 186.695 us                | 308.685 us                |
| forward: a2a values       | 1.615 ms                  | 11.322 ms                 |
| forward: join             | 2.579 ms                  | 3.054 ms                  |
| Forward                   | 27.567 ms                 | 1.269 s                   |
| back: aggr dram keys      | 17.682 ms                 | 48.571 ms                 |
| back: set dram grad       | 4.682 ms                  | 7.609 ms                  |
| back: a2a grad            | 2.964 ms                  | 15.920 ms                 |
| back: grad sum & grad cache  | 1.763 ms                  | 33.168 ms                 |
| Backward                  | 100.806 ms                | 551.744 ms                |
| Optimize                  | 17.683 ms                 | 52.277 ms                 |
| BarrierTimeBeforeRank0    | 55.970 us                 | 81.680 us                 |
| BlockToStepN              | 17.686 us                 | 21.919 ms                 |
| OneStep                   | 154.184 ms                | 1.887 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.581 ms                  | 93.282 ms                 |
| bucket keys               | 2.321 ms                  | 3.923 ms                  |
| forward: a2a keys         | 1.382 ms                  | 52.151 ms                 |
| forward: search cache     | 186.218 us                | 331.815 us                |
| forward: a2a values       | 1.727 ms                  | 23.679 ms                 |
| forward: join             | 2.527 ms                  | 3.054 ms                  |
| Forward                   | 27.340 ms                 | 77.065 ms                 |
| back: aggr dram keys      | 39.526 ms                 | 52.514 ms                 |
| back: set dram grad       | 4.624 ms                  | 7.609 ms                  |
| back: a2a grad            | 3.054 ms                  | 15.920 ms                 |
| back: grad sum & grad cache  | 1.776 ms                  | 33.168 ms                 |
| Backward                  | 100.478 ms                | 133.401 ms                |
| Optimize                  | 17.812 ms                 | 49.093 ms                 |
| BarrierTimeBeforeRank0    | 49.248 us                 | 81.548 us                 |
| BlockToStepN              | 17.531 us                 | 14.193 ms                 |
| OneStep                   | 153.409 ms                | 300.514 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.581 ms                  | 147.291 ms                |
| bucket keys               | 2.321 ms                  | 3.923 ms                  |
| forward: a2a keys         | 1.312 ms                  | 39.776 ms                 |
| forward: search cache     | 186.133 us                | 308.685 us                |
| forward: a2a values       | 1.727 ms                  | 14.796 ms                 |
| forward: join             | 2.527 ms                  | 3.276 ms                  |
| Forward                   | 27.146 ms                 | 77.065 ms                 |
| back: aggr dram keys      | 39.526 ms                 | 56.692 ms                 |
| back: set dram grad       | 4.669 ms                  | 7.037 ms                  |
| back: a2a grad            | 8.019 ms                  | 30.642 ms                 |
| back: grad sum & grad cache  | 1.776 ms                  | 31.501 ms                 |
| Backward                  | 100.463 ms                | 133.401 ms                |
| Optimize                  | 17.861 ms                 | 50.182 ms                 |
| BarrierTimeBeforeRank0    | 48.419 us                 | 96.506 us                 |
| BlockToStepN              | 17.365 us                 | 14.193 ms                 |
| OneStep                   | 154.496 ms                | 324.041 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 22.023, sample: 1.160, forward: 5.669, backward: 8.588, update: 0.389
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 18.923, sample: 1.561, forward: 5.317, backward: 8.313, update: 0.406
[Rank2] pid = 32169
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121)]
train_sampler.Prefill()
-------Step 0-------
tensor([  643477,    50059,   643550, 18526362,   643603,   643665,     2546,
          768344,  1050031,   643707]) tensor([ 8380238, 40388013, 23860964, 57570877, 32963583,   358299, 55039810,
        18301276, 59520183, 43458964])
-------Step 1-------
tensor([  643477,    50059,   643550, 18526362,   643603,   643665,     2546,
          768344,  1050031,   643707]) tensor([46175342, 25001447,  4702352, 62679882, 80263387, 51878449, 18442668,
        25250423,  1679710, 35973747])
-------Step 2-------
tensor([ 767325,  767373,    2784, 1058916,  767431,  767493,  767538,  568874,
         767582,  767633]) tensor([30308988, 36461523, 72126751, 63050539, 21118562, 35323486, 28135269,
        42312217, 55067668, 59381980])
-------Step 3-------
tensor([ 767325,  767373,    2784, 1058916,  767431,  767493,  767538,  568874,
         767582,  767633]) tensor([56290644,   840665, 67888693, 13721757, 65757047, 11458654, 14179146,
        83277176, 78180412, 72630277])
-------Step 4-------
tensor([  881990,   882031,   387279,   882073,   781726,   882123, 21074421,
          882172,   882201,   882248]) tensor([46473772, 65894758, 11037297, 64097176, 63698101, 76311549, 12312793,
        24011478,  9484738, 26392449])
-------Step 5-------
tensor([  881990,   882031,   387279,   882073,   781726,   882123, 21074421,
          882172,   882201,   882248]) tensor([46337379, 58071975, 34060701, 59165473, 11167580, 82037161, 31669398,
        28861482,   739668, 39781844])
-------Step 6-------
tensor([  996372,   996403,   996449,   788520, 21074421,   996481,   996515,
          996552,   996603,       56]) tensor([56459082, 13247355, 74414110, 27040552,   597157, 38651490, 17367559,
         8844701,   435863, 28033419])
-------Step 7-------
tensor([  996372,   996403,   996449,   788520, 21074421,   996481,   996515,
          996552,   996603,       56]) tensor([62393513, 37171320, 42005152,   224076, 38665638, 46169881, 72710685,
        83791531, 38759917, 29713802])
-------Step 8-------
tensor([ 1101187,  1101215,  1101245,  1101281,  1084008,  1101307, 15339264,
         1101338,  1101372, 15650548]) tensor([69602421, 21462217, 26521143, 19047982, 70087461,  8461265, 58520461,
          983216, 71228118, 44735247])
-------Step 9-------
tensor([ 1101187,  1101215,  1101245,  1101281,  1084008,  1101307, 15339264,
         1101338,  1101372, 15650548]) tensor([33971399, 48823685, 37641762, 54343453, 44331613, 57329357, 51137619,
        31817418, 83476482, 23913611])
before start barrier
start train
[proc 0] 100 steps, total: 24.518, sample: 1.757, forward: 4.329, backward: 10.737, update: 1.982
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.328 ms                  | 180.771 ms                |
| bucket keys               | 2.321 ms                  | 3.923 ms                  |
| forward: a2a keys         | 1.285 ms                  | 39.776 ms                 |
| forward: search cache     | 184.435 us                | 308.685 us                |
| forward: a2a values       | 1.844 ms                  | 14.796 ms                 |
| forward: join             | 2.527 ms                  | 3.276 ms                  |
| Forward                   | 26.918 ms                 | 77.065 ms                 |
| back: aggr dram keys      | 39.029 ms                 | 56.692 ms                 |
| back: set dram grad       | 4.667 ms                  | 7.037 ms                  |
| back: a2a grad            | 8.019 ms                  | 30.642 ms                 |
| back: grad sum & grad cache  | 1.776 ms                  | 31.501 ms                 |
| Backward                  | 100.260 ms                | 133.401 ms                |
| Optimize                  | 17.988 ms                 | 50.182 ms                 |
| BarrierTimeBeforeRank0    | 47.866 us                 | 96.506 us                 |
| BlockToStepN              | 17.421 us                 | 14.193 ms                 |
| OneStep                   | 159.140 ms                | 361.479 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.898 ms                  | 174.061 ms                |
| bucket keys               | 2.321 ms                  | 4.034 ms                  |
| forward: a2a keys         | 1.274 ms                  | 39.476 ms                 |
| forward: search cache     | 183.803 us                | 301.427 us                |
| forward: a2a values       | 1.844 ms                  | 11.934 ms                 |
| forward: join             | 2.527 ms                  | 3.054 ms                  |
| Forward                   | 26.803 ms                 | 64.868 ms                 |
| back: aggr dram keys      | 39.029 ms                 | 56.692 ms                 |
| back: set dram grad       | 4.624 ms                  | 5.974 ms                  |
| back: a2a grad            | 8.019 ms                  | 15.920 ms                 |
| back: grad sum & grad cache  | 1.776 ms                  | 28.293 ms                 |
| Backward                  | 99.969 ms                 | 131.888 ms                |
| Optimize                  | 17.950 ms                 | 49.093 ms                 |
| BarrierTimeBeforeRank0    | 47.791 us                 | 85.627 us                 |
| BlockToStepN              | 17.460 us                 | 5.177 ms                  |
| OneStep                   | 157.506 ms                | 324.041 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.105 ms                  | 176.544 ms                |
| bucket keys               | 2.329 ms                  | 3.932 ms                  |
| forward: a2a keys         | 1.255 ms                  | 36.930 ms                 |
| forward: search cache     | 184.037 us                | 289.094 us                |
| forward: a2a values       | 1.844 ms                  | 11.322 ms                 |
| forward: join             | 2.511 ms                  | 3.054 ms                  |
| Forward                   | 26.785 ms                 | 64.868 ms                 |
| back: aggr dram keys      | 37.885 ms                 | 55.748 ms                 |
| back: set dram grad       | 4.667 ms                  | 5.825 ms                  |
| back: a2a grad            | 8.042 ms                  | 15.920 ms                 |
| back: grad sum & grad cache  | 13.847 ms                 | 30.409 ms                 |
| Backward                  | 99.871 ms                 | 133.401 ms                |
| Optimize                  | 17.937 ms                 | 49.093 ms                 |
| BarrierTimeBeforeRank0    | 47.290 us                 | 85.627 us                 |
| BlockToStepN              | 17.447 us                 | 5.177 ms                  |
| OneStep                   | 156.234 ms                | 361.479 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 17.129, sample: 2.292, forward: 2.755, backward: 10.155, update: 1.838
[proc 2] 200 steps, total: 17.129, sample: 1.385, forward: 4.375, backward: 7.856, update: 0.382
[proc 1] 200 steps, total: 17.129, sample: 1.352, forward: 4.340, backward: 8.158, update: 0.334
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.026 ms                  | 176.544 ms                |
| bucket keys               | 2.321 ms                  | 4.162 ms                  |
| forward: a2a keys         | 1.149 ms                  | 36.930 ms                 |
| forward: search cache     | 183.677 us                | 289.094 us                |
| forward: a2a values       | 1.844 ms                  | 11.934 ms                 |
| forward: join             | 2.511 ms                  | 3.161 ms                  |
| Forward                   | 26.811 ms                 | 64.868 ms                 |
| back: aggr dram keys      | 36.572 ms                 | 68.412 ms                 |
| back: set dram grad       | 4.667 ms                  | 5.974 ms                  |
| back: a2a grad            | 8.019 ms                  | 15.920 ms                 |
| back: grad sum & grad cache  | 13.435 ms                 | 30.409 ms                 |
| Backward                  | 99.630 ms                 | 133.401 ms                |
| Optimize                  | 17.928 ms                 | 49.093 ms                 |
| BarrierTimeBeforeRank0    | 46.985 us                 | 85.627 us                 |
| BlockToStepN              | 17.421 us                 | 5.177 ms                  |
| OneStep                   | 155.992 ms                | 361.479 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.806 ms                  | 180.771 ms                |
| bucket keys               | 2.110 ms                  | 4.176 ms                  |
| forward: a2a keys         | 1.128 ms                  | 36.930 ms                 |
| forward: search cache     | 182.594 us                | 289.094 us                |
| forward: a2a values       | 6.224 ms                  | 11.934 ms                 |
| forward: join             | 2.511 ms                  | 3.276 ms                  |
| Forward                   | 26.862 ms                 | 77.065 ms                 |
| back: aggr dram keys      | 35.087 ms                 | 56.692 ms                 |
| back: set dram grad       | 4.624 ms                  | 5.825 ms                  |
| back: a2a grad            | 8.042 ms                  | 18.203 ms                 |
| back: grad sum & grad cache  | 13.435 ms                 | 28.293 ms                 |
| Backward                  | 99.546 ms                 | 133.401 ms                |
| Optimize                  | 17.830 ms                 | 49.093 ms                 |
| BarrierTimeBeforeRank0    | 46.756 us                 | 85.627 us                 |
| BlockToStepN              | 17.497 us                 | 5.177 ms                  |
| OneStep                   | 154.496 ms                | 363.813 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.600 ms                  | 176.544 ms                |
| bucket keys               | 2.110 ms                  | 4.176 ms                  |
| forward: a2a keys         | 1.113 ms                  | 36.930 ms                 |
| forward: search cache     | 182.786 us                | 283.547 us                |
| forward: a2a values       | 6.224 ms                  | 11.322 ms                 |
| forward: join             | 2.511 ms                  | 3.190 ms                  |
| Forward                   | 27.015 ms                 | 77.065 ms                 |
| back: aggr dram keys      | 35.087 ms                 | 55.748 ms                 |
| back: set dram grad       | 4.618 ms                  | 5.694 ms                  |
| back: a2a grad            | 8.042 ms                  | 21.780 ms                 |
| back: grad sum & grad cache  | 13.435 ms                 | 28.293 ms                 |
| Backward                  | 99.546 ms                 | 134.680 ms                |
| Optimize                  | 17.744 ms                 | 46.792 ms                 |
| BarrierTimeBeforeRank0    | 46.151 us                 | 81.680 us                 |
| BlockToStepN              | 17.502 us                 | 3.073 ms                  |
| OneStep                   | 154.011 ms                | 361.479 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 16.052, sample: 1.101, forward: 3.845, backward: 8.003, update: 0.367
[proc 2] 300 steps, total: 16.052, sample: 1.261, forward: 3.732, backward: 7.653, update: 0.367
[proc 0] 300 steps, total: 16.052, sample: 1.409, forward: 2.975, backward: 9.911, update: 1.645
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.225 ms                  | 176.544 ms                |
| bucket keys               | 2.130 ms                  | 4.261 ms                  |
| forward: a2a keys         | 1.087 ms                  | 36.930 ms                 |
| forward: search cache     | 182.892 us                | 289.094 us                |
| forward: a2a values       | 6.224 ms                  | 11.322 ms                 |
| forward: join             | 2.511 ms                  | 3.374 ms                  |
| Forward                   | 27.056 ms                 | 77.065 ms                 |
| back: aggr dram keys      | 34.421 ms                 | 55.748 ms                 |
| back: set dram grad       | 4.617 ms                  | 5.694 ms                  |
| back: a2a grad            | 8.022 ms                  | 24.971 ms                 |
| back: grad sum & grad cache  | 13.435 ms                 | 30.409 ms                 |
| Backward                  | 99.262 ms                 | 134.680 ms                |
| Optimize                  | 17.683 ms                 | 46.792 ms                 |
| BarrierTimeBeforeRank0    | 45.920 us                 | 81.680 us                 |
| BlockToStepN              | 17.415 us                 | 5.177 ms                  |
| OneStep                   | 153.611 ms                | 361.479 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.457 ms                  | 176.544 ms                |
| bucket keys               | 2.130 ms                  | 4.239 ms                  |
| forward: a2a keys         | 1.065 ms                  | 34.573 ms                 |
| forward: search cache     | 182.973 us                | 283.547 us                |
| forward: a2a values       | 6.247 ms                  | 11.322 ms                 |
| forward: join             | 2.511 ms                  | 3.374 ms                  |
| Forward                   | 27.065 ms                 | 77.065 ms                 |
| back: aggr dram keys      | 33.338 ms                 | 55.748 ms                 |
| back: set dram grad       | 4.618 ms                  | 5.694 ms                  |
| back: a2a grad            | 8.022 ms                  | 21.780 ms                 |
| back: grad sum & grad cache  | 13.435 ms                 | 28.293 ms                 |
| Backward                  | 99.027 ms                 | 134.680 ms                |
| Optimize                  | 17.579 ms                 | 46.792 ms                 |
| BarrierTimeBeforeRank0    | 45.744 us                 | 85.627 us                 |
| BlockToStepN              | 17.340 us                 | 5.177 ms                  |
| OneStep                   | 153.409 ms                | 361.479 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.672 ms                  | 174.061 ms                |
| bucket keys               | 2.148 ms                  | 4.239 ms                  |
| forward: a2a keys         | 1.045 ms                  | 34.573 ms                 |
| forward: search cache     | 182.973 us                | 283.547 us                |
| forward: a2a values       | 6.293 ms                  | 11.934 ms                 |
| forward: join             | 2.511 ms                  | 3.374 ms                  |
| Forward                   | 27.083 ms                 | 64.868 ms                 |
| back: aggr dram keys      | 33.326 ms                 | 55.748 ms                 |
| back: set dram grad       | 4.618 ms                  | 5.694 ms                  |
| back: a2a grad            | 8.022 ms                  | 21.780 ms                 |
| back: grad sum & grad cache  | 13.435 ms                 | 28.293 ms                 |
| Backward                  | 98.770 ms                 | 133.401 ms                |
| Optimize                  | 17.496 ms                 | 40.900 ms                 |
| BarrierTimeBeforeRank0    | 45.539 us                 | 83.108 us                 |
| BlockToStepN              | 17.312 us                 | 3.073 ms                  |
| OneStep                   | 153.334 ms                | 324.041 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 16.176, sample: 0.955, forward: 4.315, backward: 7.605, update: 0.314
[proc 1] 400 steps, total: 16.176, sample: 1.273, forward: 4.024, backward: 7.795, update: 0.363
[proc 0] 400 steps, total: 16.176, sample: 1.895, forward: 2.901, backward: 9.621, update: 1.681
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.714 ms                  | 174.061 ms                |
| bucket keys               | 2.148 ms                  | 4.176 ms                  |
| forward: a2a keys         | 1.029 ms                  | 33.613 ms                 |
| forward: search cache     | 183.077 us                | 280.047 us                |
| forward: a2a values       | 6.293 ms                  | 11.322 ms                 |
| forward: join             | 2.511 ms                  | 3.276 ms                  |
| Forward                   | 27.146 ms                 | 64.868 ms                 |
| back: aggr dram keys      | 33.021 ms                 | 55.748 ms                 |
| back: set dram grad       | 4.618 ms                  | 5.669 ms                  |
| back: a2a grad            | 8.042 ms                  | 21.111 ms                 |
| back: grad sum & grad cache  | 13.435 ms                 | 26.287 ms                 |
| Backward                  | 98.473 ms                 | 133.401 ms                |
| Optimize                  | 17.463 ms                 | 41.307 ms                 |
| BarrierTimeBeforeRank0    | 44.622 us                 | 83.108 us                 |
| BlockToStepN              | 17.299 us                 | 3.073 ms                  |
| OneStep                   | 152.870 ms                | 324.041 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.461 ms                  | 174.061 ms                |
| bucket keys               | 2.148 ms                  | 4.176 ms                  |
| forward: a2a keys         | 1.019 ms                  | 31.407 ms                 |
| forward: search cache     | 183.253 us                | 280.047 us                |
| forward: a2a values       | 6.293 ms                  | 11.203 ms                 |
| forward: join             | 2.511 ms                  | 3.374 ms                  |
| Forward                   | 27.213 ms                 | 64.868 ms                 |
| back: aggr dram keys      | 33.060 ms                 | 55.748 ms                 |
| back: set dram grad       | 4.618 ms                  | 5.669 ms                  |
| back: a2a grad            | 8.018 ms                  | 21.111 ms                 |
| back: grad sum & grad cache  | 13.356 ms                 | 26.287 ms                 |
| Backward                  | 98.365 ms                 | 133.401 ms                |
| Optimize                  | 17.427 ms                 | 42.983 ms                 |
| BarrierTimeBeforeRank0    | 43.149 us                 | 83.108 us                 |
| BlockToStepN              | 17.284 us                 | 3.073 ms                  |
| OneStep                   | 152.665 ms                | 324.041 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.524 ms                  | 166.704 ms                |
| bucket keys               | 2.299 ms                  | 4.239 ms                  |
| forward: a2a keys         | 1.011 ms                  | 31.407 ms                 |
| forward: search cache     | 183.326 us                | 281.278 us                |
| forward: a2a values       | 6.293 ms                  | 11.212 ms                 |
| forward: join             | 2.511 ms                  | 3.374 ms                  |
| Forward                   | 27.186 ms                 | 64.767 ms                 |
| back: aggr dram keys      | 33.021 ms                 | 56.692 ms                 |
| back: set dram grad       | 4.618 ms                  | 5.694 ms                  |
| back: a2a grad            | 8.018 ms                  | 21.780 ms                 |
| back: grad sum & grad cache  | 13.356 ms                 | 26.287 ms                 |
| Backward                  | 98.103 ms                 | 131.888 ms                |
| Optimize                  | 17.444 ms                 | 41.307 ms                 |
| BarrierTimeBeforeRank0    | 42.641 us                 | 84.380 us                 |
| BlockToStepN              | 17.276 us                 | 2.427 ms                  |
| OneStep                   | 152.870 ms                | 322.953 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.666 ms                  | 166.704 ms                |
| bucket keys               | 2.299 ms                  | 4.176 ms                  |
| forward: a2a keys         | 1.009 ms                  | 26.071 ms                 |
| forward: search cache     | 183.444 us                | 280.047 us                |
| forward: a2a values       | 6.293 ms                  | 11.203 ms                 |
| forward: join             | 2.511 ms                  | 3.276 ms                  |
| Forward                   | 27.184 ms                 | 64.767 ms                 |
| back: aggr dram keys      | 33.021 ms                 | 56.692 ms                 |
| back: set dram grad       | 4.618 ms                  | 5.694 ms                  |
| back: a2a grad            | 8.018 ms                  | 21.111 ms                 |
| back: grad sum & grad cache  | 13.356 ms                 | 24.666 ms                 |
| Backward                  | 97.820 ms                 | 131.888 ms                |
| Optimize                  | 17.475 ms                 | 41.307 ms                 |
| BarrierTimeBeforeRank0    | 41.987 us                 | 92.708 us                 |
| BlockToStepN              | 17.264 us                 | 4.512 ms                  |
| OneStep                   | 152.488 ms                | 322.953 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 16.050, sample: 1.041, forward: 3.929, backward: 7.905, update: 0.321
[proc 2] 500 steps, total: 16.050, sample: 1.013, forward: 3.947, backward: 7.660, update: 0.323
[proc 0] 500 steps, total: 16.049, sample: 1.674, forward: 2.846, backward: 9.670, update: 1.747
Successfully xmh. training takes 89.92508435249329 seconds
before call kg_cache_controller.StopThreads()
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads
INFO [31020 controller_process.py:421] call rank0 to StopThreads

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240202 18:49:03.316769 24907 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_46', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [24907 sampler.py:454] Start PreSampling
WARNING [24907 sampler.py:532] Before construct renumbering_dict
WARNING [24907 sampler.py:555] PreSampling done
W20240202 19:09:12.843042 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240202 19:09:12.843233 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240202 19:09:12.843272 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240202 19:09:12.843302 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240202 19:09:12.843335 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240202 19:09:12.843367 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240202 19:09:12.843394 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240202 19:09:12.843438 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240202 19:09:12.843467 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240202 19:09:12.843509 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240202 19:09:12.843551 24907 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240202 19:09:12.843578 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240202 19:09:12.843605 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240202 19:09:12.843762 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240202 19:09:12.843807 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240202 19:09:12.843834 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240202 19:09:12.843873 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240202 19:09:12.843907 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240202 19:09:12.843945 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240202 19:09:12.843976 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240202 19:09:12.844012 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240202 19:09:12.844041 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240202 19:09:12.844097 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240202 19:09:12.844125 24907 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240202 19:09:12.844148 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240202 19:09:12.844173 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240202 19:09:12.844238 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240202 19:09:12.844269 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240202 19:09:12.844301 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240202 19:09:12.844329 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240202 19:09:12.844362 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240202 19:09:12.844393 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240202 19:09:12.844419 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240202 19:09:12.844448 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240202 19:09:12.844476 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240202 19:09:12.844506 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240202 19:09:12.844539 24907 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240202 19:09:12.844561 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240202 19:09:12.844585 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240202 19:09:12.844640 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240202 19:09:12.844674 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240202 19:09:12.844702 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240202 19:09:12.844729 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240202 19:09:12.844758 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240202 19:09:12.844785 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240202 19:09:12.844815 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240202 19:09:12.844844 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240202 19:09:12.844877 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240202 19:09:12.844905 24907 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240202 19:09:12.844935 24907 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240202 19:09:12.844957 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240202 19:09:12.844983 24907 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240202 19:09:13.276259 24907 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240202 19:17:54.518261 24907 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302706,  4302736,   102476,  ..., 53321660, 15293337,  2541306]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2242.513 seconds
[Rank1] pid = 53389
[Rank2] pid = 53548
INFO [24907 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [53548 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [53662 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [53389 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [53548 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [53389 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [24907 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [53662 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [24907 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [53548 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [53662 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [53389 DistTensor.py:59] The tensor name already exists in the kvstore
I20240202 19:26:31.708659 53390 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240202 19:26:31.708820 53726 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 19:26:31.708957 53663 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 19:26:31.709075 53549 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240202 19:26:32.160969 53549 recstore.cc:66] init folly done
E20240202 19:26:32.163585 53726 recstore.cc:66] init folly done
E20240202 19:26:32.163625 53390 recstore.cc:66] init folly done
E20240202 19:26:32.163625 53663 recstore.cc:66] init folly done
I20240202 19:26:43.597527 53726 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240202 19:26:46.972312 53390 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240202 19:26:46.972671 53549 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240202 19:26:47.897536 53663 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.196 ms                  | 166.864 ms                |
| Forward                   | 10.445 ms                 | 607.548 ms                |
| Backward                  | 208.488 ms                | 422.759 ms                |
| Optimize                  | 2.997 ms                  | 4.582 ms                  |
| BarrierTimeBeforeRank0    | 34.227 ms                 | 63.263 ms                 |
| BlockToStepN              | 32.655 us                 | 21.381 ms                 |
| OneStep                   | 276.346 ms                | 1.111 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.519 ms                  | 166.864 ms                |
| Forward                   | 10.221 ms                 | 607.548 ms                |
| Backward                  | 204.005 ms                | 422.759 ms                |
| Optimize                  | 4.185 ms                  | 4.582 ms                  |
| BarrierTimeBeforeRank0    | 26.330 ms                 | 123.955 ms                |
| BlockToStepN              | 31.194 us                 | 21.381 ms                 |
| OneStep                   | 250.517 ms                | 1.111 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.519 ms                  | 166.864 ms                |
| Forward                   | 10.631 ms                 | 607.548 ms                |
| Backward                  | 204.537 ms                | 436.405 ms                |
| Optimize                  | 4.222 ms                  | 4.695 ms                  |
| BarrierTimeBeforeRank0    | 20.329 ms                 | 123.955 ms                |
| BlockToStepN              | 31.194 us                 | 21.381 ms                 |
| OneStep                   | 248.454 ms                | 1.111 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.489 ms                  | 108.289 ms                |
| Forward                   | 10.407 ms                 | 14.752 ms                 |
| Backward                  | 206.132 ms                | 422.759 ms                |
| Optimize                  | 4.200 ms                  | 4.657 ms                  |
| BarrierTimeBeforeRank0    | 20.679 ms                 | 123.955 ms                |
| BlockToStepN              | 32.048 us                 | 1.019 ms                  |
| OneStep                   | 252.842 ms                | 589.936 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.022 ms                  | 136.328 ms                |
| Forward                   | 10.433 ms                 | 14.752 ms                 |
| Backward                  | 208.692 ms                | 422.759 ms                |
| Optimize                  | 4.180 ms                  | 4.695 ms                  |
| BarrierTimeBeforeRank0    | 16.852 ms                 | 151.365 ms                |
| BlockToStepN              | 31.792 us                 | 4.607 ms                  |
| OneStep                   | 250.517 ms                | 589.936 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 32.181, sample: 1.373, forward: 2.817, backward: 20.616, update: 0.389
[Rank3] pid = 53662
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
train_sampler.Prefill()
-------Step 0-------
tensor([   53641,   541928, 52374985,   765905,   447560,   541951,   541982,
          210986,    53680,    53715]) tensor([ 4929764, 25093903, 24068530, 44148784, 46510676, 25282667, 84661747,
        63295244, 47532264, 68395585])
-------Step 1-------
tensor([   53641,   541928, 52374985,   765905,   447560,   541951,   541982,
          210986,    53680,    53715]) tensor([25347049, 78293949, 69572517, 11151551, 63242953,  8214123, 71993438,
        81673024, 18783489, 29212132])
-------Step 2-------
tensor([  619564,    66193, 60455424,    66228,   619584,   619615,   619637,
        36812984,   619665,   619692]) tensor([40837295,  4942933, 67289998,  9652537, 13901609, 12252946, 50740552,
        10148040, 65749091, 36829924])
-------Step 3-------
tensor([  619564,    66193, 60455424,    66228,   619584,   619615,   619637,
        36812984,   619665,   619692]) tensor([20400966, 51795908, 64795686, 43748953, 13774959, 57724000, 77776514,
        53075334, 25406549, 79096023])
-------Step 4-------
tensor([696070,  79566, 696099, 696136,  79594, 696169,  79635, 696197,  79669,
        696226]) tensor([60627787, 43878604, 15668637, 12928891, 47633172, 38535252, 80733151,
        53872225, 64406763,  8899399])
-------Step 5-------
tensor([696070,  79566, 696099, 696136,  79594, 696169,  79635, 696197,  79669,
        696226]) tensor([30297777, 39122343, 70140971, 10034194, 42215539, 33402362, 41364253,
        77033147, 86040603,   423638])
-------Step 6-------
tensor([79617961,   769651,   769678,   769705,  4309495,   769739,   769764,
          769791,   769810,   216359]) tensor([30004311, 49458126, 28163831, 21990042, 62807424, 64385455, 48293992,
        14073202, 55913166,  7824591])
-------Step 7-------
tensor([79617961,   769651,   769678,   769705,  4309495,   769739,   769764,
          769791,   769810,   216359]) tensor([42607006, 73939451, 56413941, 76277746, 76476295,  1775446, 15885107,
        42445627, 22149118, 14193299])
-------Step 8-------
tensor([  845446,   106728,   845469, 38679935,   811753,   845498,   845522,
          845553,   217962,   811778]) tensor([22542327, 46971536, 40585048, 75768245, 67966556, 72826109, 50542307,
        70424169, 11388748,  3242921])
-------Step 9-------
tensor([  845446,   106728,   845469, 38679935,   811753,   845498,   845522,
          845553,   217962,   811778]) tensor([77610748, 73129112, 27752365, 47359275, 11003721,  1070552, 18761458,
        15507865, 80804021, 39489830])
before start barrier
start train
[proc 0] 100 steps, total: 27.881, sample: 1.607, forward: 1.654, backward: 21.474, update: 0.369
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 28.806, sample: 1.523, forward: 2.794, backward: 21.477, update: 0.355
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 28.806, sample: 1.512, forward: 2.763, backward: 21.069, update: 0.378
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.046 ms                  | 154.598 ms                |
| Forward                   | 10.407 ms                 | 16.050 ms                 |
| Backward                  | 208.692 ms                | 422.759 ms                |
| Optimize                  | 4.169 ms                  | 4.695 ms                  |
| BarrierTimeBeforeRank0    | 17.439 ms                 | 151.365 ms                |
| BlockToStepN              | 31.854 us                 | 4.607 ms                  |
| OneStep                   | 253.453 ms                | 589.936 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.018 ms                  | 154.598 ms                |
| Forward                   | 10.398 ms                 | 16.050 ms                 |
| Backward                  | 209.264 ms                | 422.759 ms                |
| Optimize                  | 4.173 ms                  | 7.721 ms                  |
| BarrierTimeBeforeRank0    | 16.852 ms                 | 151.365 ms                |
| BlockToStepN              | 31.574 us                 | 4.607 ms                  |
| OneStep                   | 252.842 ms                | 589.936 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.022 ms                  | 154.598 ms                |
| Forward                   | 10.433 ms                 | 16.050 ms                 |
| Backward                  | 209.491 ms                | 422.759 ms                |
| Optimize                  | 4.149 ms                  | 7.721 ms                  |
| BarrierTimeBeforeRank0    | 15.554 ms                 | 219.449 ms                |
| BlockToStepN              | 31.228 us                 | 4.607 ms                  |
| OneStep                   | 250.517 ms                | 589.936 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.046 ms                  | 154.598 ms                |
| Forward                   | 10.418 ms                 | 14.752 ms                 |
| Backward                  | 209.754 ms                | 379.544 ms                |
| Optimize                  | 4.093 ms                  | 5.432 ms                  |
| BarrierTimeBeforeRank0    | 13.877 ms                 | 151.365 ms                |
| BlockToStepN              | 31.117 us                 | 4.607 ms                  |
| OneStep                   | 250.000 ms                | 538.445 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.248 ms                  | 160.236 ms                |
| Forward                   | 10.418 ms                 | 14.752 ms                 |
| Backward                  | 209.264 ms                | 379.544 ms                |
| Optimize                  | 4.149 ms                  | 5.480 ms                  |
| BarrierTimeBeforeRank0    | 13.877 ms                 | 151.365 ms                |
| BlockToStepN              | 31.117 us                 | 4.607 ms                  |
| OneStep                   | 250.000 ms                | 538.445 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.046 ms                  | 160.236 ms                |
| Forward                   | 10.445 ms                 | 14.752 ms                 |
| Backward                  | 209.264 ms                | 422.759 ms                |
| Optimize                  | 4.156 ms                  | 5.480 ms                  |
| BarrierTimeBeforeRank0    | 13.573 ms                 | 151.365 ms                |
| BlockToStepN              | 31.049 us                 | 8.336 ms                  |
| OneStep                   | 249.696 ms                | 538.445 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 200 steps, total: 26.461, sample: 1.100, forward: 1.746, backward: 19.978, update: 0.334
[proc 1] 200 steps, total: 26.461, sample: 1.584, forward: 1.904, backward: 21.425, update: 0.378
[proc 0] 200 steps, total: 26.461, sample: 1.761, forward: 1.070, backward: 21.565, update: 0.367
[proc 2] 200 steps, total: 26.461, sample: 1.398, forward: 1.799, backward: 20.531, update: 0.355
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.046 ms                  | 160.236 ms                |
| Forward                   | 10.492 ms                 | 14.752 ms                 |
| Backward                  | 209.498 ms                | 422.759 ms                |
| Optimize                  | 4.156 ms                  | 5.480 ms                  |
| BarrierTimeBeforeRank0    | 13.339 ms                 | 151.365 ms                |
| BlockToStepN              | 31.049 us                 | 11.364 ms                 |
| OneStep                   | 250.000 ms                | 538.445 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.338 ms                  | 160.236 ms                |
| Forward                   | 10.492 ms                 | 14.752 ms                 |
| Backward                  | 209.392 ms                | 422.759 ms                |
| Optimize                  | 4.130 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 13.193 ms                 | 151.365 ms                |
| BlockToStepN              | 31.048 us                 | 11.364 ms                 |
| OneStep                   | 249.997 ms                | 538.445 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.338 ms                  | 154.598 ms                |
| Forward                   | 10.433 ms                 | 14.432 ms                 |
| Backward                  | 209.177 ms                | 379.544 ms                |
| Optimize                  | 4.114 ms                  | 5.480 ms                  |
| BarrierTimeBeforeRank0    | 13.430 ms                 | 145.832 ms                |
| BlockToStepN              | 31.117 us                 | 8.336 ms                  |
| OneStep                   | 249.997 ms                | 465.265 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.380 ms                  | 154.598 ms                |
| Forward                   | 10.349 ms                 | 14.432 ms                 |
| Backward                  | 209.177 ms                | 379.544 ms                |
| Optimize                  | 4.147 ms                  | 5.480 ms                  |
| BarrierTimeBeforeRank0    | 14.019 ms                 | 145.832 ms                |
| BlockToStepN              | 31.194 us                 | 8.336 ms                  |
| OneStep                   | 251.774 ms                | 465.265 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.248 ms                  | 154.598 ms                |
| Forward                   | 10.307 ms                 | 14.432 ms                 |
| Backward                  | 209.115 ms                | 379.544 ms                |
| Optimize                  | 4.134 ms                  | 5.480 ms                  |
| BarrierTimeBeforeRank0    | 14.228 ms                 | 145.832 ms                |
| BlockToStepN              | 31.239 us                 | 8.336 ms                  |
| OneStep                   | 252.078 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 300 steps, total: 26.960, sample: 0.963, forward: 1.656, backward: 20.076, update: 0.354
[proc 0] 300 steps, total: 26.960, sample: 1.684, forward: 1.031, backward: 21.352, update: 0.357
[proc 2] 300 steps, total: 26.960, sample: 1.140, forward: 1.681, backward: 20.819, update: 0.359
[proc 1] 300 steps, total: 26.960, sample: 1.447, forward: 1.881, backward: 22.378, update: 0.406
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.315 ms                  | 154.598 ms                |
| Forward                   | 10.302 ms                 | 14.432 ms                 |
| Backward                  | 209.032 ms                | 379.544 ms                |
| Optimize                  | 4.147 ms                  | 7.196 ms                  |
| BarrierTimeBeforeRank0    | 14.666 ms                 | 145.832 ms                |
| BlockToStepN              | 31.265 us                 | 9.325 ms                  |
| OneStep                   | 252.184 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.384 ms                  | 154.598 ms                |
| Forward                   | 10.302 ms                 | 14.432 ms                 |
| Backward                  | 208.955 ms                | 379.544 ms                |
| Optimize                  | 4.156 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 14.481 ms                 | 145.832 ms                |
| BlockToStepN              | 31.239 us                 | 9.325 ms                  |
| OneStep                   | 251.774 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.248 ms                  | 154.598 ms                |
| Forward                   | 10.270 ms                 | 14.432 ms                 |
| Backward                  | 208.883 ms                | 379.544 ms                |
| Optimize                  | 4.169 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 14.977 ms                 | 145.832 ms                |
| BlockToStepN              | 31.265 us                 | 9.325 ms                  |
| OneStep                   | 251.914 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.193 ms                  | 151.790 ms                |
| Forward                   | 10.298 ms                 | 14.005 ms                 |
| Backward                  | 208.827 ms                | 361.495 ms                |
| Optimize                  | 4.166 ms                  | 7.196 ms                  |
| BarrierTimeBeforeRank0    | 14.750 ms                 | 142.597 ms                |
| BlockToStepN              | 31.291 us                 | 8.336 ms                  |
| OneStep                   | 250.959 ms                | 465.265 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.193 ms                  | 151.790 ms                |
| Forward                   | 10.288 ms                 | 14.432 ms                 |
| Backward                  | 208.511 ms                | 361.495 ms                |
| Optimize                  | 4.169 ms                  | 7.196 ms                  |
| BarrierTimeBeforeRank0    | 14.666 ms                 | 145.832 ms                |
| BlockToStepN              | 31.291 us                 | 8.336 ms                  |
| OneStep                   | 250.725 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 26.409, sample: 1.075, forward: 1.627, backward: 20.236, update: 0.357
[proc 2] 400 steps, total: 26.409, sample: 1.207, forward: 1.684, backward: 20.758, update: 0.361
[proc 1] 400 steps, total: 26.409, sample: 1.429, forward: 1.791, backward: 21.670, update: 0.415
[proc 0] 400 steps, total: 26.409, sample: 1.514, forward: 1.069, backward: 21.088, update: 0.378
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.182 ms                  | 151.790 ms                |
| Forward                   | 10.291 ms                 | 14.432 ms                 |
| Backward                  | 208.353 ms                | 361.495 ms                |
| Optimize                  | 4.169 ms                  | 7.196 ms                  |
| BarrierTimeBeforeRank0    | 14.666 ms                 | 145.832 ms                |
| BlockToStepN              | 31.291 us                 | 8.336 ms                  |
| OneStep                   | 250.303 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.193 ms                  | 151.790 ms                |
| Forward                   | 10.299 ms                 | 14.432 ms                 |
| Backward                  | 208.692 ms                | 361.495 ms                |
| Optimize                  | 4.185 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 13.877 ms                 | 145.832 ms                |
| BlockToStepN              | 31.232 us                 | 9.325 ms                  |
| OneStep                   | 250.640 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.112 ms                  | 151.790 ms                |
| Forward                   | 10.298 ms                 | 14.432 ms                 |
| Backward                  | 208.488 ms                | 369.077 ms                |
| Optimize                  | 4.193 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 14.019 ms                 | 153.511 ms                |
| BlockToStepN              | 31.125 us                 | 9.325 ms                  |
| OneStep                   | 251.774 ms                | 513.362 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.182 ms                  | 151.271 ms                |
| Forward                   | 10.338 ms                 | 14.432 ms                 |
| Backward                  | 208.152 ms                | 361.495 ms                |
| Optimize                  | 4.195 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 13.430 ms                 | 151.365 ms                |
| BlockToStepN              | 30.987 us                 | 8.873 ms                  |
| OneStep                   | 250.640 ms                | 506.319 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.208 ms                  | 151.271 ms                |
| Forward                   | 10.381 ms                 | 14.458 ms                 |
| Backward                  | 208.001 ms                | 361.495 ms                |
| Optimize                  | 4.200 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 13.270 ms                 | 151.365 ms                |
| BlockToStepN              | 31.048 us                 | 8.873 ms                  |
| OneStep                   | 250.324 ms                | 506.319 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 500 steps, total: 25.992, sample: 1.051, forward: 1.558, backward: 19.327, update: 0.377
[proc 0] 500 steps, total: 25.992, sample: 1.686, forward: 1.143, backward: 21.327, update: 0.421
[proc 1] 500 steps, total: 25.992, sample: 1.127, forward: 1.546, backward: 21.440, update: 0.289
[proc 2] 500 steps, total: 25.992, sample: 1.185, forward: 1.620, backward: 20.521, update: 0.372
Successfully xmh. training takes 133.70364475250244 seconds
before call kg_cache_controller.StopThreads()
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
INFO [24907 controller_process.py:421] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.208 ms                  | 151.271 ms                |
| Forward                   | 10.398 ms                 | 14.752 ms                 |
| Backward                  | 207.682 ms                | 361.495 ms                |
| Optimize                  | 4.213 ms                  | 7.643 ms                  |
| BarrierTimeBeforeRank0    | 12.929 ms                 | 151.365 ms                |
| BlockToStepN              | 31.106 us                 | 11.364 ms                 |
| OneStep                   | 250.165 ms                | 506.319 ms                |
+---------------------------+---------------------------+---------------------------+
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

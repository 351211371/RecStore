WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240213 05:40:14.042137 64653 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_73', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=1, update_pq_use_omp=2, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [64653 sampler.py:454] Start PreSampling
WARNING [64653 sampler.py:532] Before construct renumbering_dict
WARNING [64653 sampler.py:555] PreSampling done
W20240213 05:56:36.321580 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240213 05:56:36.321794 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240213 05:56:36.321839 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240213 05:56:36.321882 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240213 05:56:36.321915 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240213 05:56:36.321944 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240213 05:56:36.321983 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240213 05:56:36.322022 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240213 05:56:36.322057 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240213 05:56:36.322099 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240213 05:56:36.322137 64653 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240213 05:56:36.322167 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240213 05:56:36.322196 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240213 05:56:36.322361 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240213 05:56:36.322409 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240213 05:56:36.322441 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240213 05:56:36.322485 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240213 05:56:36.322522 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240213 05:56:36.322557 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240213 05:56:36.322592 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240213 05:56:36.322633 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240213 05:56:36.322669 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240213 05:56:36.322701 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240213 05:56:36.322736 64653 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240213 05:56:36.322760 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240213 05:56:36.322788 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240213 05:56:36.322850 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240213 05:56:36.322887 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240213 05:56:36.322916 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240213 05:56:36.322947 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240213 05:56:36.322986 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240213 05:56:36.323021 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240213 05:56:36.323051 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240213 05:56:36.323087 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240213 05:56:36.323124 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240213 05:56:36.323163 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240213 05:56:36.323199 64653 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240213 05:56:36.323223 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240213 05:56:36.323256 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240213 05:56:36.323316 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240213 05:56:36.323351 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240213 05:56:36.323383 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240213 05:56:36.323413 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240213 05:56:36.323450 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240213 05:56:36.323493 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240213 05:56:36.323526 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240213 05:56:36.323555 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240213 05:56:36.323588 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240213 05:56:36.323623 64653 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240213 05:56:36.323657 64653 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240213 05:56:36.323683 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240213 05:56:36.323714 64653 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240213 05:56:36.783051 64653 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240213 06:05:11.632652 64653 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302704,  4302709,   112519,  ..., 51432419, 12415704,  2455295]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2003.831 seconds
[Rank1] pid = 573
[Rank2] pid = 669
INFO [64653 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [573 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [669 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [760 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [669 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [760 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [64653 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [573 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [573 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [760 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [64653 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [669 DistTensor.py:59] The tensor name already exists in the kvstore
I20240213 06:13:54.334123   670 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240213 06:13:54.334337   761 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240213 06:13:54.334477   574 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240213 06:13:54.334676   825 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240213 06:13:55.772697   825 recstore.cc:66] init folly done
E20240213 06:13:55.773094   670 recstore.cc:66] init folly done
E20240213 06:13:55.773195   574 recstore.cc:66] init folly done
E20240213 06:13:55.773386   761 recstore.cc:66] init folly done
I20240213 06:14:06.752182   825 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240213 06:14:09.681717   574 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240213 06:14:09.807402   670 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240213 06:14:11.228468   761 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.860 ms                 | 25.860 ms                 |
| bucket keys               | 146.096 ms                | 146.096 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 15.915 ms                 | 25.860 ms                 |
| bucket keys               | 2.244 ms                  | 146.096 ms                |
| forward: a2a keys         | 8.119 ms                  | 41.396 s                  |
| forward: search cache     | 255.108 us                | 34.727 ms                 |
| forward: a2a values       | 1.677 ms                  | 7.927 ms                  |
| forward: software         | 609.875 us                | 711.441 us                |
| forward: join             | 1.778 ms                  | 2.884 ms                  |
| Forward                   | 39.341 ms                 | 41.956 s                  |
| back: aggr dram keys      | 31.981 ms                 | 454.735 ms                |
| back: set dram grad       | 1.868 ms                  | 8.923 ms                  |
| back: a2a grad            | 5.615 ms                  | 10.449 ms                 |
| back: grad sum & grad cache  | 2.461 ms                  | 55.926 ms                 |
| Backward                  | 124.529 ms                | 736.342 ms                |
| Optimize                  | 21.690 ms                 | 59.473 ms                 |
| BarrierTimeBeforeRank0    | 68.776 us                 | 81.083 us                 |
| BlockToStepN              | 18.950 us                 | 30.882 us                 |
| OneStep                   | 191.601 ms                | 42.779 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.289 ms                  | 120.925 ms                |
| bucket keys               | 2.846 ms                  | 4.610 ms                  |
| forward: a2a keys         | 2.998 ms                  | 73.482 ms                 |
| forward: search cache     | 264.168 us                | 356.913 us                |
| forward: a2a values       | 1.991 ms                  | 7.927 ms                  |
| forward: software         | 596.762 us                | 634.193 us                |
| forward: join             | 1.778 ms                  | 2.963 ms                  |
| Forward                   | 32.892 ms                 | 41.956 s                  |
| back: aggr dram keys      | 40.681 ms                 | 77.434 ms                 |
| back: set dram grad       | 3.671 ms                  | 8.923 ms                  |
| back: a2a grad            | 9.382 ms                  | 14.531 ms                 |
| back: grad sum & grad cache  | 2.461 ms                  | 46.776 ms                 |
| Backward                  | 118.917 ms                | 736.342 ms                |
| Optimize                  | 20.737 ms                 | 59.473 ms                 |
| BarrierTimeBeforeRank0    | 56.188 us                 | 149.503 us                |
| BlockToStepN              | 17.390 us                 | 30.882 us                 |
| OneStep                   | 193.095 ms                | 42.779 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.079 ms                  | 115.369 ms                |
| bucket keys               | 2.771 ms                  | 4.610 ms                  |
| forward: a2a keys         | 2.868 ms                  | 73.482 ms                 |
| forward: search cache     | 261.307 us                | 391.245 us                |
| forward: a2a values       | 2.421 ms                  | 30.297 ms                 |
| forward: software         | 596.762 us                | 859.976 us                |
| forward: join             | 1.986 ms                  | 3.622 ms                  |
| Forward                   | 31.337 ms                 | 98.591 ms                 |
| back: aggr dram keys      | 43.508 ms                 | 77.434 ms                 |
| back: set dram grad       | 4.284 ms                  | 8.923 ms                  |
| back: a2a grad            | 9.386 ms                  | 17.987 ms                 |
| back: grad sum & grad cache  | 2.461 ms                  | 46.776 ms                 |
| Backward                  | 132.338 ms                | 166.946 ms                |
| Optimize                  | 20.202 ms                 | 31.885 ms                 |
| BarrierTimeBeforeRank0    | 50.030 us                 | 86.925 us                 |
| BlockToStepN              | 19.255 us                 | 42.710 us                 |
| OneStep                   | 193.095 ms                | 294.969 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.653 ms                  | 115.369 ms                |
| bucket keys               | 2.757 ms                  | 4.610 ms                  |
| forward: a2a keys         | 2.842 ms                  | 59.454 ms                 |
| forward: search cache     | 259.399 us                | 391.245 us                |
| forward: a2a values       | 6.368 ms                  | 11.321 ms                 |
| forward: software         | 596.762 us                | 855.446 us                |
| forward: join             | 1.986 ms                  | 3.160 ms                  |
| Forward                   | 31.113 ms                 | 98.591 ms                 |
| back: aggr dram keys      | 44.195 ms                 | 77.434 ms                 |
| back: set dram grad       | 4.369 ms                  | 10.025 ms                 |
| back: a2a grad            | 9.394 ms                  | 34.447 ms                 |
| back: grad sum & grad cache  | 3.624 ms                  | 48.837 ms                 |
| Backward                  | 134.495 ms                | 176.394 ms                |
| Optimize                  | 20.366 ms                 | 47.423 ms                 |
| BarrierTimeBeforeRank0    | 48.076 us                 | 86.925 us                 |
| BlockToStepN              | 20.352 us                 | 229.637 us                |
| OneStep                   | 194.131 ms                | 333.408 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.320 ms                  | 115.369 ms                |
| bucket keys               | 2.740 ms                  | 4.692 ms                  |
| forward: a2a keys         | 2.595 ms                  | 59.454 ms                 |
| forward: search cache     | 251.532 us                | 455.141 us                |
| forward: a2a values       | 3.291 ms                  | 13.144 ms                 |
| forward: software         | 596.762 us                | 859.976 us                |
| forward: join             | 1.986 ms                  | 3.622 ms                  |
| Forward                   | 30.333 ms                 | 98.591 ms                 |
| back: aggr dram keys      | 43.879 ms                 | 77.434 ms                 |
| back: set dram grad       | 4.398 ms                  | 9.140 ms                  |
| back: a2a grad            | 9.394 ms                  | 32.762 ms                 |
| back: grad sum & grad cache  | 3.624 ms                  | 49.518 ms                 |
| Backward                  | 135.310 ms                | 176.394 ms                |
| Optimize                  | 20.151 ms                 | 47.423 ms                 |
| BarrierTimeBeforeRank0    | 47.421 us                 | 86.925 us                 |
| BlockToStepN              | 20.847 us                 | 229.637 us                |
| OneStep                   | 195.211 ms                | 333.408 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 64.730, sample: 1.611, forward: 45.837, backward: 10.258, update: 0.397
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 64.604, sample: 1.296, forward: 46.206, backward: 9.905, update: 0.411
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 67.660, sample: 1.436, forward: 46.070, backward: 9.890, update: 0.420
[Rank3] pid = 760
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
train_sampler.Prefill()
-------Step 0-------
tensor([   58145,   752745, 53176200,   709213,   476511,   752787,   752820,
          229418,    58174,    58208]) tensor([ 4854537, 23416511, 26253432, 53865964, 54786218, 32720308, 70701020,
        80074997, 64483741, 80513277])
-------Step 1-------
tensor([   58145,   752745, 53176200,   709213,   476511,   752787,   752820,
          229418,    58174,    58208]) tensor([25288651, 81105959, 66221066, 11266661, 48773098,  8649551, 72210418,
        68168813, 18396740, 38292297])
-------Step 2-------
tensor([  861020,    71379, 73803843,    71421,   861056,   861101,   861146,
        49901475,   861177,   861211]) tensor([31088409,  4808062, 49003288,  9226384, 18058742, 10839784, 49995423,
        10771795, 47800645, 27863692])
-------Step 3-------
tensor([  861020,    71379, 73803843,    71421,   861056,   861101,   861146,
        49901475,   861177,   861211]) tensor([21941037, 38620274, 73921965, 43681484, 12784600, 57335905, 76927035,
        70684113, 27111418, 69046710])
-------Step 4-------
tensor([931695,  84913, 931712, 931732,  84947, 931754,  84992, 931773,  85031,
        931793]) tensor([56372423, 46665564, 15210368, 15468355, 46114674, 48589102, 72371961,
        44973985, 46526743,  8308410])
-------Step 5-------
tensor([931695,  84913, 931712, 931732,  84947, 931754,  84992, 931773,  85031,
        931793]) tensor([31661088, 49255600, 70274968, 10379097, 32019185, 35549288, 30809657,
        58543794, 74366378,   406237])
-------Step 6-------
tensor([63779711,   978513,   978529,   978543,  4309246,   978557,   978574,
          978589,   978604,   235031]) tensor([22988107, 36501013, 26423539, 17664722, 75677059, 46505023, 36144275,
        13052582, 75718520,  7955621])
-------Step 7-------
tensor([63779711,   978513,   978529,   978543,  4309246,   978557,   978574,
          978589,   978604,   235031]) tensor([37005844, 69516877, 43766678, 78381848, 57197636,  1501594, 15474301,
        56964164, 23455315, 17615848])
-------Step 8-------
tensor([ 1019061,   111103,  1019075, 38563636,   750182,  1019090,  1019105,
         1019120,   236738,   750244]) tensor([28513915, 64909645, 38992653, 74372338, 82639042, 53502861, 69906760,
        67154716, 11508653,  3237153])
-------Step 9-------
tensor([ 1019061,   111103,  1019075, 38563636,   750182,  1019090,  1019105,
         1019120,   236738,   750244]) tensor([80198423, 53479009, 29009073, 48053203, 13144223,   877756, 23475770,
        15896160, 72512923, 53246527])
before start barrier
start train
[proc 0] 100 steps, total: 63.183, sample: 1.317, forward: 45.423, backward: 14.263, update: 2.078
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.653 ms                  | 116.238 ms                |
| bucket keys               | 2.754 ms                  | 4.692 ms                  |
| forward: a2a keys         | 2.525 ms                  | 59.454 ms                 |
| forward: search cache     | 246.048 us                | 455.141 us                |
| forward: a2a values       | 3.291 ms                  | 30.297 ms                 |
| forward: software         | 596.762 us                | 869.513 us                |
| forward: join             | 1.986 ms                  | 3.622 ms                  |
| Forward                   | 30.126 ms                 | 98.591 ms                 |
| back: aggr dram keys      | 43.508 ms                 | 77.434 ms                 |
| back: set dram grad       | 4.401 ms                  | 9.140 ms                  |
| back: a2a grad            | 9.394 ms                  | 32.762 ms                 |
| back: grad sum & grad cache  | 3.624 ms                  | 55.281 ms                 |
| Backward                  | 135.516 ms                | 176.394 ms                |
| Optimize                  | 20.018 ms                 | 47.423 ms                 |
| BarrierTimeBeforeRank0    | 47.421 us                 | 89.009 us                 |
| BlockToStepN              | 20.714 us                 | 229.637 us                |
| OneStep                   | 197.139 ms                | 333.408 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.653 ms                  | 116.238 ms                |
| bucket keys               | 2.754 ms                  | 4.692 ms                  |
| forward: a2a keys         | 2.352 ms                  | 35.591 ms                 |
| forward: search cache     | 244.617 us                | 391.245 us                |
| forward: a2a values       | 6.368 ms                  | 13.144 ms                 |
| forward: software         | 596.762 us                | 859.976 us                |
| forward: join             | 1.986 ms                  | 3.490 ms                  |
| Forward                   | 29.710 ms                 | 98.591 ms                 |
| back: aggr dram keys      | 43.508 ms                 | 72.165 ms                 |
| back: set dram grad       | 4.397 ms                  | 8.939 ms                  |
| back: a2a grad            | 9.382 ms                  | 32.762 ms                 |
| back: grad sum & grad cache  | 3.624 ms                  | 50.939 ms                 |
| Backward                  | 134.984 ms                | 176.394 ms                |
| Optimize                  | 19.971 ms                 | 47.423 ms                 |
| BarrierTimeBeforeRank0    | 46.710 us                 | 105.388 us                |
| BlockToStepN              | 20.331 us                 | 8.645 ms                  |
| OneStep                   | 194.884 ms                | 333.408 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.712 ms                  | 115.369 ms                |
| bucket keys               | 2.740 ms                  | 4.703 ms                  |
| forward: a2a keys         | 2.386 ms                  | 36.307 ms                 |
| forward: search cache     | 242.949 us                | 391.245 us                |
| forward: a2a values       | 6.368 ms                  | 27.481 ms                 |
| forward: software         | 596.762 us                | 869.513 us                |
| forward: join             | 1.986 ms                  | 3.490 ms                  |
| Forward                   | 29.710 ms                 | 86.514 ms                 |
| back: aggr dram keys      | 43.330 ms                 | 72.165 ms                 |
| back: set dram grad       | 4.389 ms                  | 8.939 ms                  |
| back: a2a grad            | 9.386 ms                  | 32.762 ms                 |
| back: grad sum & grad cache  | 4.663 ms                  | 51.230 ms                 |
| Backward                  | 133.702 ms                | 174.814 ms                |
| Optimize                  | 19.898 ms                 | 38.232 ms                 |
| BarrierTimeBeforeRank0    | 45.806 us                 | 90.417 us                 |
| BlockToStepN              | 19.781 us                 | 976.489 us                |
| OneStep                   | 195.003 ms                | 299.687 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.652 ms                  | 115.369 ms                |
| bucket keys               | 2.740 ms                  | 4.703 ms                  |
| forward: a2a keys         | 2.476 ms                  | 35.591 ms                 |
| forward: search cache     | 241.995 us                | 372.410 us                |
| forward: a2a values       | 6.170 ms                  | 22.181 ms                 |
| forward: software         | 596.762 us                | 859.976 us                |
| forward: join             | 1.986 ms                  | 3.490 ms                  |
| Forward                   | 29.710 ms                 | 86.514 ms                 |
| back: aggr dram keys      | 42.093 ms                 | 70.636 ms                 |
| back: set dram grad       | 4.385 ms                  | 8.939 ms                  |
| back: a2a grad            | 9.394 ms                  | 32.762 ms                 |
| back: grad sum & grad cache  | 4.663 ms                  | 55.281 ms                 |
| Backward                  | 133.657 ms                | 174.814 ms                |
| Optimize                  | 19.872 ms                 | 47.423 ms                 |
| BarrierTimeBeforeRank0    | 44.673 us                 | 90.417 us                 |
| BlockToStepN              | 19.661 us                 | 8.645 ms                  |
| OneStep                   | 194.884 ms                | 309.951 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 20.390, sample: 1.254, forward: 4.192, backward: 9.365, update: 0.331
[proc 3] 200 steps, total: 20.390, sample: 1.109, forward: 4.377, backward: 9.051, update: 0.386
[proc 2] 200 steps, total: 20.390, sample: 1.077, forward: 4.396, backward: 9.083, update: 0.384
[proc 0] 200 steps, total: 20.390, sample: 1.618, forward: 3.240, backward: 13.444, update: 1.987
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.840 ms                  | 120.925 ms                |
| bucket keys               | 2.732 ms                  | 4.859 ms                  |
| forward: a2a keys         | 2.211 ms                  | 35.591 ms                 |
| forward: search cache     | 241.756 us                | 372.410 us                |
| forward: a2a values       | 5.960 ms                  | 22.181 ms                 |
| forward: software         | 596.762 us                | 859.976 us                |
| forward: join             | 1.986 ms                  | 3.622 ms                  |
| Forward                   | 29.518 ms                 | 86.514 ms                 |
| back: aggr dram keys      | 41.839 ms                 | 70.636 ms                 |
| back: set dram grad       | 4.384 ms                  | 8.939 ms                  |
| back: a2a grad            | 9.394 ms                  | 32.762 ms                 |
| back: grad sum & grad cache  | 4.663 ms                  | 55.281 ms                 |
| Backward                  | 133.332 ms                | 174.814 ms                |
| Optimize                  | 19.872 ms                 | 47.423 ms                 |
| BarrierTimeBeforeRank0    | 43.114 us                 | 103.238 us                |
| BlockToStepN              | 19.255 us                 | 8.645 ms                  |
| OneStep                   | 193.276 ms                | 309.951 ms                |
+---------------------------+---------------------------+---------------------------+
Successfully xmh. training takes 91.41595768928528 seconds
before call kg_cache_controller.StopThreads()
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
INFO [64653 controller_process.py:421] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.894 ms                  | 122.075 ms                |
| bucket keys               | 2.732 ms                  | 4.703 ms                  |
| forward: a2a keys         | 2.105 ms                  | 33.893 ms                 |
| forward: search cache     | 242.233 us                | 371.695 us                |
| forward: a2a values       | 5.960 ms                  | 13.144 ms                 |
| forward: software         | 596.762 us                | 858.784 us                |
| forward: join             | 1.986 ms                  | 3.495 ms                  |
| Forward                   | 29.246 ms                 | 86.514 ms                 |
| back: aggr dram keys      | 41.839 ms                 | 69.473 ms                 |
| back: set dram grad       | 4.381 ms                  | 8.923 ms                  |
| back: a2a grad            | 9.419 ms                  | 31.092 ms                 |
| back: grad sum & grad cache  | 4.663 ms                  | 51.230 ms                 |
| Backward                  | 133.270 ms                | 174.814 ms                |
| Optimize                  | 19.871 ms                 | 47.423 ms                 |
| BarrierTimeBeforeRank0    | 42.774 us                 | 103.238 us                |
| BlockToStepN              | 18.163 us                 | 8.645 ms                  |
| OneStep                   | 192.724 ms                | 309.951 ms                |
+---------------------------+---------------------------+---------------------------+

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240210 04:27:18.903566 63920 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_156', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [63920 sampler.py:454] Start PreSampling
WARNING [63920 sampler.py:532] Before construct renumbering_dict
WARNING [63920 sampler.py:555] PreSampling done
W20240210 04:45:26.564064 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240210 04:45:26.564273 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240210 04:45:26.564324 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240210 04:45:26.564368 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240210 04:45:26.564401 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240210 04:45:26.564438 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240210 04:45:26.564466 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240210 04:45:26.564502 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240210 04:45:26.564538 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240210 04:45:26.564566 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240210 04:45:26.564602 63920 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240210 04:45:26.564630 63920 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240210 04:45:26.564657 63920 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240210 04:45:26.564814 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240210 04:45:26.564850 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240210 04:45:26.564883 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240210 04:45:26.564926 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240210 04:45:26.564962 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240210 04:45:26.564996 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240210 04:45:26.565026 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240210 04:45:26.565061 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240210 04:45:26.565093 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240210 04:45:26.565129 63920 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240210 04:45:26.565156 63920 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240210 04:45:26.565179 63920 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240210 04:45:26.565207 63920 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240210 04:45:26.999159 63920 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x1000098ca000 128.2 GB
W20240210 04:54:02.696118 63920 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102018502000 328.3 MB
{0: Graph(num_nodes=43196088, num_edges=182879791,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=47371617, num_edges=163853044,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 43196088 N 182879791 E
MertisPartition: part 1 has 47371617 N 163853044 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 24862891, 27748820, 20932263]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4302732,  4302776,   395833,  ..., 22893847, 32346765, 70272733]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2111.831 seconds
INFO [64973 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [63920 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [63920 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [64973 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
WARNING [64973 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [63920 DistTensor.py:59] The tensor name already exists in the kvstore
I20240210 05:02:41.426216 64974 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240210 05:02:41.426594 65038 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
E20240210 05:02:41.650916 65038 recstore.cc:66] init folly done
E20240210 05:02:41.650930 64974 recstore.cc:66] init folly done
I20240210 05:03:05.719429 65038 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240210 05:03:07.776887 64974 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.738 ms                 | 22.738 ms                 |
| bucket keys               | 92.535 ms                 | 92.535 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.738 ms                 | 22.738 ms                 |
| bucket keys               | 92.535 ms                 | 92.535 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.738 ms                 | 22.738 ms                 |
| bucket keys               | 92.535 ms                 | 92.535 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.738 ms                 | 22.738 ms                 |
| bucket keys               | 92.535 ms                 | 92.535 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.738 ms                 | 22.738 ms                 |
| bucket keys               | 92.535 ms                 | 92.535 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.738 ms                 | 22.738 ms                 |
| bucket keys               | 92.535 ms                 | 92.535 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.738 ms                 | 22.738 ms                 |
| bucket keys               | 92.535 ms                 | 92.535 ms                 |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 25.282 ms                 | 111.624 ms                |
| bucket keys               | 1.779 ms                  | 92.535 ms                 |
| forward: a2a keys         | 680.923 us                | 36.688 s                  |
| forward: search cache     | 145.674 us                | 20.246 ms                 |
| forward: a2a values       | 720.501 us                | 6.624 ms                  |
| forward: join             | 1.280 ms                  | 4.457 ms                  |
| Forward                   | 17.639 ms                 | 37.288 s                  |
| back: aggr dram keys      | 14.808 ms                 | 181.528 ms                |
| back: set dram grad       | 2.723 ms                  | 5.920 ms                  |
| back: a2a grad            | 2.033 ms                  | 4.334 ms                  |
| back: grad sum & grad cache  | 1.333 ms                  | 16.511 ms                 |
| Backward                  | 74.345 ms                 | 384.240 ms                |
| Optimize                  | 10.339 ms                 | 24.285 ms                 |
| BarrierTimeBeforeRank0    | 45.821 us                 | 141.955 us                |
| BlockToStepN              | 16.092 us                 | 38.035 us                 |
| OneStep                   | 134.020 ms                | 37.711 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 12.112 ms                 | 111.624 ms                |
| bucket keys               | 2.283 ms                  | 4.023 ms                  |
| forward: a2a keys         | 706.434 us                | 21.762 ms                 |
| forward: search cache     | 145.912 us                | 428.677 us                |
| forward: a2a values       | 1.719 ms                  | 3.326 ms                  |
| forward: join             | 1.280 ms                  | 3.759 ms                  |
| Forward                   | 18.262 ms                 | 37.288 s                  |
| back: aggr dram keys      | 21.147 ms                 | 45.784 ms                 |
| back: set dram grad       | 2.653 ms                  | 4.065 ms                  |
| back: a2a grad            | 2.615 ms                  | 24.667 ms                 |
| back: grad sum & grad cache  | 1.477 ms                  | 16.511 ms                 |
| Backward                  | 77.830 ms                 | 384.240 ms                |
| Optimize                  | 13.004 ms                 | 32.605 ms                 |
| BarrierTimeBeforeRank0    | 40.886 us                 | 141.955 us                |
| BlockToStepN              | 16.303 us                 | 38.035 us                 |
| OneStep                   | 127.418 ms                | 37.711 s                  |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 11.085 ms                 | 106.024 ms                |
| bucket keys               | 2.354 ms                  | 4.263 ms                  |
| forward: a2a keys         | 728.369 us                | 12.615 ms                 |
| forward: search cache     | 146.866 us                | 428.677 us                |
| forward: a2a values       | 2.633 ms                  | 3.326 ms                  |
| forward: join             | 1.280 ms                  | 3.759 ms                  |
| Forward                   | 18.444 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 28.089 ms                 | 45.784 ms                 |
| back: set dram grad       | 2.653 ms                  | 4.065 ms                  |
| back: a2a grad            | 3.307 ms                  | 22.914 ms                 |
| back: grad sum & grad cache  | 4.658 ms                  | 14.646 ms                 |
| Backward                  | 77.981 ms                 | 119.181 ms                |
| Optimize                  | 12.434 ms                 | 24.626 ms                 |
| BarrierTimeBeforeRank0    | 40.886 us                 | 96.739 us                 |
| BlockToStepN              | 17.099 us                 | 38.035 us                 |
| OneStep                   | 123.418 ms                | 223.495 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 52.848, sample: 1.618, forward: 40.481, backward: 6.384, update: 0.337
[Rank1] pid = 64973
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414)]
train_sampler.Prefill()
-------Step 0-------
tensor([1499242, 1499258, 1499270, 1639852, 1499284, 1499302, 1499315,    7539,
        1499331, 1499341]) tensor([  241967,  4661213, 15985771, 54448021, 36964452, 17205569, 64097533,
         7985693, 40657214, 57489194])
-------Step 1-------
tensor([1499242, 1499258, 1499270, 1639852, 1499284, 1499302, 1499315,    7539,
        1499331, 1499341]) tensor([67946953, 63429624, 58699024, 37973203, 46699628,   226910, 30918572,
        57487038, 80230851, 84283752])
-------Step 2-------
tensor([1535391, 1535402, 1535417, 1535428, 1535437, 1535449, 1535461, 1535468,
        1645140, 1535479]) tensor([18549873, 14535781, 44651501, 76098752, 31402858,  1900887, 40871833,
        46282697, 62702765, 12010671])
-------Step 3-------
tensor([1535391, 1535402, 1535417, 1535428, 1535437, 1535449, 1535461, 1535468,
        1645140, 1535479]) tensor([46794298, 85685374,  2345202, 25090165, 52747007, 45097448, 30204414,
        50887919, 50347864, 25224143])
-------Step 4-------
tensor([ 1568727,  1568738,   152752,  1568750,   152776, 57587254,   686511,
         1568757,  1568767,  1568779]) tensor([ 1250040, 81859758, 28760159, 39683967, 75046884, 61204545, 55815703,
        34217012, 24101509, 34743532])
-------Step 5-------
tensor([ 1568727,  1568738,   152752,  1568750,   152776, 57587254,   686511,
         1568757,  1568767,  1568779]) tensor([55308085, 41695681, 60214580, 18586192, 21707497, 62299646, 57884908,
        12082809, 55076725, 72496374])
-------Step 6-------
tensor([ 1599464,  1599478,  1599486,   272657,  1599496,  1599505,  1599515,
        14107415,  1599525,  4339827]) tensor([16796279, 29537389,  6360411,  1655603, 15836067, 17372846,  3057900,
         1069532, 82136692, 24679033])
-------Step 7-------
tensor([ 1599464,  1599478,  1599486,   272657,  1599496,  1599505,  1599515,
        14107415,  1599525,  4339827]) tensor([75674562, 61865561, 59234627,  1332743,  8636114, 36086204, 61011785,
        81511119, 57059795, 10344554])
-------Step 8-------
tensor([1626285, 1626294, 1626302,  274509, 1626313, 1626322, 1626331,  154300,
        1626342, 1626350]) tensor([80843745, 73010309,   265101,  4355516, 47378139, 27115518, 70140161,
        68346925, 39938412, 22919124])
-------Step 9-------
tensor([1626285, 1626294, 1626302,  274509, 1626313, 1626322, 1626331,  154300,
        1626342, 1626350]) tensor([  731259, 36008130, 21258791, 60404817, 36040957,  2000314, 21423090,
        39843510, 31474550, 78147731])
before start barrier
start train
[proc 0] 100 steps, total: 50.790, sample: 1.977, forward: 39.362, backward: 8.059, update: 1.317
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 9.691 ms                  | 106.024 ms                |
| bucket keys               | 2.340 ms                  | 4.611 ms                  |
| forward: a2a keys         | 820.875 us                | 16.430 ms                 |
| forward: search cache     | 148.773 us                | 431.538 us                |
| forward: a2a values       | 1.719 ms                  | 3.326 ms                  |
| forward: join             | 1.280 ms                  | 4.119 ms                  |
| Forward                   | 19.509 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 25.665 ms                 | 45.784 ms                 |
| back: set dram grad       | 2.655 ms                  | 4.065 ms                  |
| back: a2a grad            | 3.307 ms                  | 22.914 ms                 |
| back: grad sum & grad cache  | 4.658 ms                  | 14.646 ms                 |
| Backward                  | 77.803 ms                 | 119.181 ms                |
| Optimize                  | 12.271 ms                 | 24.626 ms                 |
| BarrierTimeBeforeRank0    | 39.810 us                 | 96.739 us                 |
| BlockToStepN              | 17.269 us                 | 7.329 ms                  |
| OneStep                   | 121.834 ms                | 223.495 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.692 ms                  | 104.165 ms                |
| bucket keys               | 2.354 ms                  | 4.611 ms                  |
| forward: a2a keys         | 842.333 us                | 16.430 ms                 |
| forward: search cache     | 149.250 us                | 431.538 us                |
| forward: a2a values       | 1.719 ms                  | 3.304 ms                  |
| forward: join             | 1.280 ms                  | 4.119 ms                  |
| Forward                   | 20.957 ms                 | 44.995 ms                 |
| back: aggr dram keys      | 26.256 ms                 | 45.058 ms                 |
| back: set dram grad       | 2.670 ms                  | 4.065 ms                  |
| back: a2a grad            | 3.307 ms                  | 9.840 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 14.646 ms                 |
| Backward                  | 76.233 ms                 | 110.721 ms                |
| Optimize                  | 12.180 ms                 | 24.626 ms                 |
| BarrierTimeBeforeRank0    | 39.154 us                 | 91.778 us                 |
| BlockToStepN              | 17.293 us                 | 38.035 us                 |
| OneStep                   | 121.157 ms                | 223.119 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 12.603, sample: 1.807, forward: 2.595, backward: 5.949, update: 0.334
[proc 0] 200 steps, total: 12.603, sample: 1.328, forward: 2.412, backward: 7.524, update: 1.269
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.952 ms                  | 104.165 ms                |
| bucket keys               | 2.357 ms                  | 4.843 ms                  |
| forward: a2a keys         | 845.671 us                | 19.535 ms                 |
| forward: search cache     | 149.965 us                | 431.538 us                |
| forward: a2a values       | 1.719 ms                  | 3.332 ms                  |
| forward: join             | 1.342 ms                  | 4.119 ms                  |
| Forward                   | 21.138 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 26.256 ms                 | 44.668 ms                 |
| back: set dram grad       | 2.691 ms                  | 4.065 ms                  |
| back: a2a grad            | 3.307 ms                  | 9.840 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 13.757 ms                 |
| Backward                  | 75.921 ms                 | 110.721 ms                |
| Optimize                  | 12.205 ms                 | 24.626 ms                 |
| BarrierTimeBeforeRank0    | 38.668 us                 | 91.778 us                 |
| BlockToStepN              | 17.293 us                 | 7.329 ms                  |
| OneStep                   | 120.937 ms                | 223.119 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.276 ms                  | 104.165 ms                |
| bucket keys               | 2.357 ms                  | 4.833 ms                  |
| forward: a2a keys         | 823.021 us                | 19.535 ms                 |
| forward: search cache     | 149.965 us                | 429.630 us                |
| forward: a2a values       | 1.719 ms                  | 3.326 ms                  |
| forward: join             | 1.342 ms                  | 4.003 ms                  |
| Forward                   | 20.404 ms                 | 53.215 ms                 |
| back: aggr dram keys      | 25.831 ms                 | 51.316 ms                 |
| back: set dram grad       | 2.697 ms                  | 4.011 ms                  |
| back: a2a grad            | 3.307 ms                  | 4.528 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 13.536 ms                 |
| Backward                  | 75.921 ms                 | 110.721 ms                |
| Optimize                  | 12.116 ms                 | 24.626 ms                 |
| BarrierTimeBeforeRank0    | 38.668 us                 | 91.778 us                 |
| BlockToStepN              | 17.533 us                 | 7.329 ms                  |
| OneStep                   | 119.766 ms                | 223.119 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.230 ms                  | 99.144 ms                 |
| bucket keys               | 2.357 ms                  | 4.843 ms                  |
| forward: a2a keys         | 830.889 us                | 17.166 ms                 |
| forward: search cache     | 150.919 us                | 429.392 us                |
| forward: a2a values       | 1.719 ms                  | 3.326 ms                  |
| forward: join             | 1.342 ms                  | 3.795 ms                  |
| Forward                   | 20.908 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 25.976 ms                 | 51.316 ms                 |
| back: set dram grad       | 2.694 ms                  | 3.820 ms                  |
| back: a2a grad            | 3.307 ms                  | 4.514 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 12.924 ms                 |
| Backward                  | 75.073 ms                 | 101.712 ms                |
| Optimize                  | 12.096 ms                 | 24.285 ms                 |
| BarrierTimeBeforeRank0    | 39.211 us                 | 88.622 us                 |
| BlockToStepN              | 17.967 us                 | 38.035 us                 |
| OneStep                   | 117.922 ms                | 217.386 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 12.196, sample: 1.619, forward: 2.512, backward: 5.940, update: 0.341
[proc 0] 300 steps, total: 12.196, sample: 1.329, forward: 2.144, backward: 7.488, update: 1.173
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.822 ms                  | 99.144 ms                 |
| bucket keys               | 2.354 ms                  | 4.843 ms                  |
| forward: a2a keys         | 822.306 us                | 16.986 ms                 |
| forward: search cache     | 151.873 us                | 428.677 us                |
| forward: a2a values       | 1.719 ms                  | 3.304 ms                  |
| forward: join             | 1.342 ms                  | 3.771 ms                  |
| Forward                   | 20.543 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 25.831 ms                 | 51.316 ms                 |
| back: set dram grad       | 2.690 ms                  | 3.484 ms                  |
| back: a2a grad            | 3.374 ms                  | 4.528 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 12.543 ms                 |
| Backward                  | 75.059 ms                 | 109.005 ms                |
| Optimize                  | 12.055 ms                 | 24.626 ms                 |
| BarrierTimeBeforeRank0    | 39.154 us                 | 88.622 us                 |
| BlockToStepN              | 17.865 us                 | 38.035 us                 |
| OneStep                   | 117.304 ms                | 217.386 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.707 ms                  | 96.948 ms                 |
| bucket keys               | 2.354 ms                  | 4.998 ms                  |
| forward: a2a keys         | 812.054 us                | 17.166 ms                 |
| forward: search cache     | 152.349 us                | 428.677 us                |
| forward: a2a values       | 1.719 ms                  | 3.304 ms                  |
| forward: join             | 1.342 ms                  | 3.790 ms                  |
| Forward                   | 20.397 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 25.976 ms                 | 52.910 ms                 |
| back: set dram grad       | 2.687 ms                  | 4.011 ms                  |
| back: a2a grad            | 3.352 ms                  | 9.840 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 13.536 ms                 |
| Backward                  | 75.209 ms                 | 109.005 ms                |
| Optimize                  | 12.061 ms                 | 25.847 ms                 |
| BarrierTimeBeforeRank0    | 39.332 us                 | 84.923 us                 |
| BlockToStepN              | 17.865 us                 | 38.035 us                 |
| OneStep                   | 117.001 ms                | 217.067 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 400 steps, total: 12.219, sample: 1.291, forward: 2.438, backward: 6.174, update: 0.327
[proc 0] 400 steps, total: 12.219, sample: 1.198, forward: 2.003, backward: 7.635, update: 1.295
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.707 ms                  | 96.948 ms                 |
| bucket keys               | 2.340 ms                  | 5.057 ms                  |
| forward: a2a keys         | 783.920 us                | 17.166 ms                 |
| forward: search cache     | 152.349 us                | 423.908 us                |
| forward: a2a values       | 1.719 ms                  | 3.301 ms                  |
| forward: join             | 1.342 ms                  | 3.771 ms                  |
| Forward                   | 20.033 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 25.976 ms                 | 52.910 ms                 |
| back: set dram grad       | 2.690 ms                  | 3.820 ms                  |
| back: a2a grad            | 3.350 ms                  | 6.998 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 13.536 ms                 |
| Backward                  | 75.020 ms                 | 109.005 ms                |
| Optimize                  | 12.088 ms                 | 25.847 ms                 |
| BarrierTimeBeforeRank0    | 39.600 us                 | 84.923 us                 |
| BlockToStepN              | 18.181 us                 | 3.372 ms                  |
| OneStep                   | 116.719 ms                | 217.067 ms                |
+---------------------------+---------------------------+---------------------------+
Successfully xmh. training takes 90.16774582862854 seconds
before call kg_cache_controller.StopThreads()
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
INFO [63920 controller_process.py:421] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.707 ms                  | 96.948 ms                 |
| bucket keys               | 2.340 ms                  | 5.057 ms                  |
| forward: a2a keys         | 783.920 us                | 17.166 ms                 |
| forward: search cache     | 152.826 us                | 423.908 us                |
| forward: a2a values       | 1.719 ms                  | 3.301 ms                  |
| forward: join             | 1.342 ms                  | 3.771 ms                  |
| Forward                   | 19.991 ms                 | 45.299 ms                 |
| back: aggr dram keys      | 25.976 ms                 | 52.910 ms                 |
| back: set dram grad       | 2.691 ms                  | 3.820 ms                  |
| back: a2a grad            | 3.350 ms                  | 9.840 ms                  |
| back: grad sum & grad cache  | 4.658 ms                  | 13.536 ms                 |
| Backward                  | 74.879 ms                 | 109.005 ms                |
| Optimize                  | 12.089 ms                 | 25.847 ms                 |
| BarrierTimeBeforeRank0    | 39.903 us                 | 88.622 us                 |
| BlockToStepN              | 18.228 us                 | 3.372 ms                  |
| OneStep                   | 116.449 ms                | 217.067 ms                |
+---------------------------+---------------------------+---------------------------+

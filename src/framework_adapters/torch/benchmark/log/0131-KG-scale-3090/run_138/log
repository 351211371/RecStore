WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240205 21:10:02.126855 51483 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_24', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [51483 sampler.py:454] Start PreSampling
WARNING [51483 sampler.py:532] Before construct renumbering_dict
WARNING [51483 sampler.py:555] PreSampling done
W20240205 21:10:06.315399 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240205 21:10:06.315610 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240205 21:10:06.315665 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240205 21:10:06.315721 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240205 21:10:06.315764 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240205 21:10:06.315805 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240205 21:10:06.315852 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240205 21:10:06.315899 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240205 21:10:06.315944 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240205 21:10:06.315991 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240205 21:10:06.316045 51483 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240205 21:10:06.316093 51483 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240205 21:10:06.316138 51483 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240205 21:10:06.316284 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240205 21:10:06.316334 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240205 21:10:06.316376 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240205 21:10:06.316432 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240205 21:10:06.316480 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240205 21:10:06.316542 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240205 21:10:06.316596 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240205 21:10:06.316641 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240205 21:10:06.316694 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240205 21:10:06.316751 51483 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240205 21:10:06.316793 51483 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240205 21:10:06.316828 51483 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240205 21:10:06.316864 51483 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240205 21:10:06.573833 51483 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x1000098ca000 22.81 MB
W20240205 21:10:06.662426 51483 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000af9c000 58.4 kB
{0: Graph(num_nodes=13804, num_edges=289155,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12626, num_edges=379866,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 13804 N 289155 E
MertisPartition: part 1 has 12626 N 379866 E
Rank0: cached key size 373
Rank1: cached key size 373
Before renumbering graph:  {'_ID': tensor([    0,     2,     6,  ..., 11079,  2237, 14365]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([  755,   819,   960,  ...,  9596, 10332, 10477]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=13804, num_edges=289155,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 4.634 seconds
INFO [51483 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [51689 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [51483 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [51689 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240205 21:10:08.379998 51690 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240205 21:10:08.380806 51753 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240205 21:10:08.409760 51690 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10000afb0000 7.629 MB
W20240205 21:10:08.409801 51753 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10000b753000 7.629 MB
W20240205 21:10:08.409950 51690 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10000bef6000 7.629 MB
W20240205 21:10:08.409963 51753 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x10000c699000 7.629 MB
W20240205 21:10:08.410005 51690 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10000ce3c000 1.49 GB
W20240205 21:10:08.410045 51753 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10006c41f000 1.49 GB
W20240205 21:10:08.410056 51690 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1000cba02000 1.49 GB
W20240205 21:10:08.410094 51690 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240205 21:10:08.410097 51753 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10012afe5000 1.49 GB
W20240205 21:10:08.410162 51753 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240205 21:10:08.413298 51690 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240205 21:10:08.413348 51753 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x1000098ca000
1: KnownLocalCachedEmbedding init done
WARNING [51689 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank1] pid = 51689
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494)]
cudaHostRegister 0x1000098ca000
0: KnownLocalCachedEmbedding init done
WARNING [51483 DistTensor.py:59] The tensor name already exists in the kvstore
I20240205 21:10:09.767058 51690 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240205 21:10:09.767278 51753 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240205 21:10:09.769238 51690 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240205 21:10:09.769372 51690 grad_base.h:184] Init GradProcessingBase done
I20240205 21:10:09.773715 51690 grad_async_v2.h:42] Use main thread to update emb.
W20240205 21:10:09.773743 51690 kg_controller.h:78] after init GradAsyncProcessingV2
I20240205 21:10:09.773751 51690 kg_controller.h:84] Construct KGCacheController done
E20240205 21:10:10.018890 51690 recstore.cc:66] init folly done
E20240205 21:10:10.018924 51753 recstore.cc:66] init folly done
I20240205 21:10:10.019570 51690 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240205 21:10:10.172904 51958 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240205 21:10:10.173452 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240205 21:10:10.229820 51690 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240205 21:10:10.248435 51753 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
W20240205 21:10:11.131256 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
E20240205 21:10:11.169325 51690 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=1, sample_step_cpp_seen_[rank]=0
E20240205 21:10:11.173065 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240205 21:10:11.173748 51958 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240205 21:10:12.131609 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=26, pq.top=26
E20240205 21:10:12.173010 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=236
W20240205 21:10:12.297850 51958 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
W20240205 21:10:13.131033 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=53, pq.top=53
E20240205 21:10:13.173014 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=10
W20240205 21:10:13.441943 51958 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240205 21:10:14.173035 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=81
W20240205 21:10:14.357913 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=82, pq.top=82
W20240205 21:10:14.513545 51958 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.510 ms                  | 32.823 ms                 |
| Forward                   | 5.179 ms                  | 11.751 ms                 |
| Backward                  | 5.224 ms                  | 10.339 ms                 |
| Optimize                  | 2.398 ms                  | 6.799 ms                  |
| BarrierTimeBeforeRank0    | 28.580 us                 | 2.047 ms                  |
| AfterBackward             | 12.857 ms                 | 192.904 ms                |
| BlockToStepN              | 688.816 us                | 9.203 ms                  |
| OneStep                   | 29.602 ms                 | 211.071 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 4.694, sample: 0.388, forward: 0.811, backward: 0.734, update: 0.233
train_sampler.Prefill()
-------Step 0-------
tensor([  259,  6223,  8588,  6759,  3114, 12506,  3544,  8179,  6365,  7780]) tensor([  994, 10852, 10310, 11651, 14613,  7784,  5769,   538,  7201, 10531])
-------Step 1-------
tensor([  259,  6223,  8588,  6759,  3114, 12506,  3544,  8179,  6365,  7780]) tensor([10500,  3001,   508,   380,  8315,  7933, 11542, 12388,  1811,  4318])
-------Step 2-------
tensor([ 4595,  8376,    19,  2908, 12492,  3201,  9230,   634,  1615,  9628]) tensor([ 3017,   472,  1477,  1743,  5148,  8293, 12958, 14635, 10716,  5887])
-------Step 3-------
tensor([ 4595,  8376,    19,  2908, 12492,  3201,  9230,   634,  1615,  9628]) tensor([ 2672,   456,  8343, 10381,  3366,   589, 11912, 11699,  2898,  6190])
-------Step 4-------
tensor([12096, 12301,   151,   106,  2426, 12679,  7358,  4257,  6969, 11647]) tensor([11551,  5036,  3586,  8466,  8951,  3655,  6661, 10206,   783,  9308])
-------Step 5-------
tensor([12096, 12301,   151,   106,  2426, 12679,  7358,  4257,  6969, 11647]) tensor([ 9031, 13630, 11609, 11199,  2288,  7706,  9642, 13474,  6603,  8789])
-------Step 6-------
tensor([  305,  9558,   244,   302,   791,  6485,  7144,  5964,    41, 14207]) tensor([ 7982,  3740,  3164,  3592,  8627,  8943, 10681, 11937, 13414,  3698])
-------Step 7-------
tensor([  305,  9558,   244,   302,   791,  6485,  7144,  5964,    41, 14207]) tensor([ 9534,     7,  3797, 13685,   953,  6767,  1018, 11462,  9057, 10609])
-------Step 8-------
tensor([12147,  7934,   340,    53,  4310,  3458,  7044,  7057,  1455, 13655]) tensor([  320,  4211,   206,  1905, 11070,  6446,  5101,  2701, 12538, 14772])
-------Step 9-------
tensor([12147,  7934,   340,    53,  4310,  3458,  7044,  7057,  1455, 13655]) tensor([ 9210, 10678,  4645,  5296,  2966, 12631,  7906,  6810,  5981, 14174])
before start barrier
start train
[proc 0] 100 steps, total: 4.713, sample: 0.516, forward: 0.937, backward: 0.777, update: 0.299
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 354.742 us                | 5.012 ms                  |
| ProcessBack:Shuffle       | 924.163 us                | 1.507 ms                  |
| ProcessBack:UpdateCache   | 584.001 us                | 917.073 us                |
| ProcessBack:UpsertPq      | 9.915 ms                  | 17.629 ms                 |
| ProcessOneStep            | 12.643 ms                 | 192.861 ms                |
| BlockToStepN              | 645.657 us                | 9.084 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240205 21:10:15.173066 51975 parallel_pq_v2.h:79] insert failed, size(hashtable)=4528
W20240205 21:10:15.363179 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=111, pq.top=111
W20240205 21:10:15.526021 51958 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
E20240205 21:10:16.173023 51690 parallel_pq_v2.h:79] insert failed, size(hashtable)=611
W20240205 21:10:16.392493 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=139, pq.top=139
W20240205 21:10:16.547878 51958 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end4
E20240205 21:10:17.170013 51690 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=160, sample_step_cpp_seen_[rank]=159
E20240205 21:10:17.173022 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=26
W20240205 21:10:17.455955 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=166, pq.top=166
W20240205 21:10:17.628011 51958 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
E20240205 21:10:18.173043 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=16
W20240205 21:10:18.473107 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=194, pq.top=194
[proc 1] 200 steps, total: 3.798, sample: 0.442, forward: 0.423, backward: 0.502, update: 0.197
[proc 0] 200 steps, total: 3.797, sample: 0.531, forward: 0.484, backward: 0.510, update: 0.245
W20240205 21:10:18.789314 51958 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
E20240205 21:10:19.173043 51971 parallel_pq_v2.h:79] insert failed, size(hashtable)=10917
W20240205 21:10:19.474512 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=223, pq.top=223
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.537 ms                  | 32.145 ms                 |
| Forward                   | 4.938 ms                  | 10.796 ms                 |
| Backward                  | 5.164 ms                  | 10.339 ms                 |
| Optimize                  | 2.434 ms                  | 5.338 ms                  |
| BarrierTimeBeforeRank0    | 25.683 us                 | 4.193 ms                  |
| AfterBackward             | 13.185 ms                 | 155.812 ms                |
| BlockToStepN              | 1.029 ms                  | 9.875 ms                  |
| OneStep                   | 30.399 ms                 | 184.162 ms                |
+---------------------------+---------------------------+---------------------------+
W20240205 21:10:19.817013 51958 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 515.782 us                | 5.713 ms                  |
| ProcessBack:Shuffle       | 924.163 us                | 1.700 ms                  |
| ProcessBack:UpdateCache   | 537.496 us                | 840.105 us                |
| ProcessBack:UpsertPq      | 10.506 ms                 | 17.297 ms                 |
| ProcessOneStep            | 13.132 ms                 | 155.757 ms                |
| BlockToStepN              | 943.130 us                | 9.821 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240205 21:10:20.173012 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=766
W20240205 21:10:20.479655 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=248, pq.top=248
W20240205 21:10:20.823499 51958 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240205 21:10:21.173025 51962 parallel_pq_v2.h:79] insert failed, size(hashtable)=7303
W20240205 21:10:21.504868 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=277, pq.top=277
W20240205 21:10:21.845288 51958 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240205 21:10:22.174224 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
[proc 1] 300 steps, total: 3.654, sample: 0.391, forward: 0.421, backward: 0.521, update: 0.200
[proc 0] 300 steps, total: 3.654, sample: 0.504, forward: 0.489, backward: 0.511, update: 0.245
W20240205 21:10:22.572502 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=305, pq.top=305
W20240205 21:10:22.849886 51958 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240205 21:10:23.174037 51969 parallel_pq_v2.h:79] insert failed, size(hashtable)=8715
W20240205 21:10:23.599972 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=332, pq.top=332
W20240205 21:10:23.860220 51958 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240205 21:10:24.174084 51864 parallel_pq_v2.h:79] insert failed, size(hashtable)=83
W20240205 21:10:24.613423 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=359, pq.top=359
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.644 ms                  | 32.145 ms                 |
| Forward                   | 4.983 ms                  | 9.177 ms                  |
| Backward                  | 5.160 ms                  | 8.560 ms                  |
| Optimize                  | 2.520 ms                  | 4.829 ms                  |
| BarrierTimeBeforeRank0    | 25.135 us                 | 5.076 ms                  |
| AfterBackward             | 14.554 ms                 | 140.565 ms                |
| BlockToStepN              | 1.182 ms                  | 9.875 ms                  |
| OneStep                   | 32.857 ms                 | 156.378 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 489.328 us                | 4.027 ms                  |
| ProcessBack:Shuffle       | 960.306 us                | 1.700 ms                  |
| ProcessBack:UpdateCache   | 515.672 us                | 842.338 us                |
| ProcessBack:UpsertPq      | 11.222 ms                 | 18.694 ms                 |
| ProcessOneStep            | 14.536 ms                 | 140.537 ms                |
| BlockToStepN              | 1.145 ms                  | 9.821 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240205 21:10:25.063732 51958 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240205 21:10:25.068801 51690 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=369, sample_step_cpp_seen_[rank]=368
E20240205 21:10:25.174008 51958 parallel_pq_v2.h:79] insert failed, size(hashtable)=1024
W20240205 21:10:25.655230 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=385, pq.top=385
W20240205 21:10:26.080561 51958 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240205 21:10:26.174006 51864 parallel_pq_v2.h:79] insert failed, size(hashtable)=448
[proc 1] 400 steps, total: 3.897, sample: 0.400, forward: 0.416, backward: 0.468, update: 0.190
[proc 0] 400 steps, total: 3.897, sample: 0.513, forward: 0.499, backward: 0.500, update: 0.246
W20240205 21:10:26.685899 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=408, pq.top=408
W20240205 21:10:27.082396 51958 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end8
E20240205 21:10:27.174031 51984 parallel_pq_v2.h:79] insert failed, size(hashtable)=4884
W20240205 21:10:27.735479 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=433, pq.top=433
W20240205 21:10:28.119150 51958 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end2
E20240205 21:10:28.174168 51981 parallel_pq_v2.h:79] insert failed, size(hashtable)=8144
W20240205 21:10:28.779034 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=456, pq.top=456
W20240205 21:10:29.138900 51958 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240205 21:10:29.174018 51960 parallel_pq_v2.h:79] insert failed, size(hashtable)=4421
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.751 ms                  | 32.079 ms                 |
| Forward                   | 5.003 ms                  | 8.911 ms                  |
| Backward                  | 5.139 ms                  | 8.003 ms                  |
| Optimize                  | 2.479 ms                  | 4.821 ms                  |
| BarrierTimeBeforeRank0    | 24.618 us                 | 18.607 ms                 |
| AfterBackward             | 15.645 ms                 | 120.519 ms                |
| BlockToStepN              | 1.567 ms                  | 9.875 ms                  |
| OneStep                   | 33.905 ms                 | 144.214 ms                |
+---------------------------+---------------------------+---------------------------+
W20240205 21:10:29.780364 51690 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=479, pq.top=479
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 622.356 us                | 6.669 ms                  |
| ProcessBack:Shuffle       | 962.637 us                | 1.734 ms                  |
| ProcessBack:UpdateCache   | 509.304 us                | 838.429 us                |
| ProcessBack:UpsertPq      | 12.105 ms                 | 22.053 ms                 |
| ProcessOneStep            | 15.722 ms                 | 120.479 ms                |
| BlockToStepN              | 1.553 ms                  | 9.821 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240205 21:10:30.154944 51958 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240205 21:10:30.174006 51864 parallel_pq_v2.h:79] insert failed, size(hashtable)=100
[proc 0] 500 steps, total: 4.471, sample: 0.554, forward: 0.493, backward: 0.495, update: 0.230
[proc 1] 500 steps, total: 4.471, sample: 0.421, forward: 0.424, backward: 0.454, update: 0.184
Successfully xmh. training takes 20.532747745513916 seconds
before call kg_cache_controller.StopThreads()
W20240205 21:10:30.762605 51690 grad_async_v2.h:84] call StopThreads. PID = 51483
W20240205 21:10:30.762641 51690 grad_base.h:212] before processOneStepNegThread_.join();
W20240205 21:10:30.763000 51690 grad_base.h:214] after processOneStepNegThread_.join();
W20240205 21:10:30.763016 51690 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240205 21:10:30.765154 51690 grad_async_v2.h:105] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7f22f8a29b90>

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240202 15:22:21.432439 23256 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_42', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [23256 sampler.py:454] Start PreSampling
WARNING [23256 sampler.py:532] Before construct renumbering_dict
WARNING [23256 sampler.py:555] PreSampling done
W20240202 15:41:53.117448 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240202 15:41:53.117651 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240202 15:41:53.117686 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240202 15:41:53.117722 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240202 15:41:53.117750 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240202 15:41:53.117786 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240202 15:41:53.117818 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240202 15:41:53.117856 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240202 15:41:53.117885 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240202 15:41:53.117923 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240202 15:41:53.117956 23256 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240202 15:41:53.117985 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240202 15:41:53.118008 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240202 15:41:53.118175 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240202 15:41:53.118216 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240202 15:41:53.118244 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240202 15:41:53.118284 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240202 15:41:53.118311 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240202 15:41:53.118343 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240202 15:41:53.118378 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240202 15:41:53.118410 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240202 15:41:53.118448 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240202 15:41:53.118484 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240202 15:41:53.118515 23256 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240202 15:41:53.118541 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240202 15:41:53.118567 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240202 15:41:53.118628 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240202 15:41:53.118666 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240202 15:41:53.118695 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240202 15:41:53.118728 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240202 15:41:53.118758 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240202 15:41:53.118793 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240202 15:41:53.118827 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240202 15:41:53.118857 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240202 15:41:53.118896 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240202 15:41:53.118924 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240202 15:41:53.118957 23256 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240202 15:41:53.118979 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240202 15:41:53.119004 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240202 15:41:53.119058 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240202 15:41:53.119094 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240202 15:41:53.119122 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240202 15:41:53.119150 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240202 15:41:53.119179 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240202 15:41:53.119205 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240202 15:41:53.119241 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240202 15:41:53.119267 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240202 15:41:53.119302 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240202 15:41:53.119338 23256 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240202 15:41:53.119365 23256 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240202 15:41:53.119387 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240202 15:41:53.119427 23256 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240202 15:41:53.530630 23256 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240202 15:50:28.885893 23256 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302740,  4302765,   115636,  ..., 55340733, 15460905,  2469236]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2192.348 seconds
[Rank1] pid = 54270
[Rank2] pid = 54366
INFO [23256 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [54270 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [54497 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [54366 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [54366 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [54497 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240202 15:58:58.923470 54561 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240202 15:58:58.923477 54367 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
INFO [23256 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240202 15:58:58.926398 54498 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
INFO [54270 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240202 15:58:58.931406 54271 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240202 15:58:58.974926 54561 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036613000 7.629 MB
W20240202 15:58:58.975071 54561 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x102036dbc000 7.629 MB
W20240202 15:58:58.975131 54561 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x10203755f000 1.49 GB
W20240202 15:58:58.975163 54498 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102096b42000 7.629 MB
W20240202 15:58:58.975180 54561 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1020972e5000 1.49 GB
W20240202 15:58:58.975189 54367 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1020f68c8000 7.629 MB
W20240202 15:58:58.975216 54271 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1020f706b000 7.629 MB
W20240202 15:58:58.975241 54561 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240202 15:58:58.975323 54498 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1020f780e000 7.629 MB
W20240202 15:58:58.975328 54271 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1020f7fb1000 7.629 MB
W20240202 15:58:58.975338 54367 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020f8754000 7.629 MB
W20240202 15:58:58.975382 54498 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1020f8ef7000 1.49 GB
W20240202 15:58:58.975404 54271 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1021584da000 1.49 GB
W20240202 15:58:58.975419 54367 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1021b7abd000 1.49 GB
W20240202 15:58:58.975421 54498 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1022170a0000 1.49 GB
W20240202 15:58:58.975466 54367 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x102276683000 1.49 GB
W20240202 15:58:58.975474 54271 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1022d5c66000 1.49 GB
W20240202 15:58:58.975476 54498 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240202 15:58:58.975522 54367 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240202 15:58:58.975536 54271 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240202 15:58:58.981806 54498 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240202 15:58:58.981810 54367 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240202 15:58:58.981819 54271 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240202 15:58:58.981833 54561 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
[Rank3] pid = 54497
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [23256 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [54270 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [54366 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [54497 DistTensor.py:59] The tensor name already exists in the kvstore
I20240202 15:59:31.814368 54561 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240202 15:59:31.814450 54367 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 15:59:31.814587 54498 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 15:59:31.814677 54271 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240202 15:59:31.817119 54498 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240202 15:59:31.817430 54498 grad_base.h:184] Init GradProcessingBase done
I20240202 15:59:44.666541 54498 grad_async_v2.h:42] Use main thread to update emb.
W20240202 15:59:44.666692 54498 kg_controller.h:78] after init GradAsyncProcessingV2
I20240202 15:59:44.666703 54498 kg_controller.h:84] Construct KGCacheController done
E20240202 15:59:45.110447 54271 recstore.cc:66] init folly done
E20240202 15:59:45.110455 54561 recstore.cc:66] init folly done
E20240202 15:59:45.110450 54367 recstore.cc:66] init folly done
E20240202 15:59:45.110455 54498 recstore.cc:66] init folly done
I20240202 15:59:45.111231 54498 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240202 15:59:57.416272 58579 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240202 15:59:57.416752 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240202 15:59:58.930866 58579 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240202 15:59:58.931005 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 117.051 us                | 266.612 us                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:02.715238 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240202 16:00:02.733716 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240202 16:00:02.910531 54561 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 123.142 us                | 235.187 us                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:05.826581 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240202 16:00:05.881634 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240202 16:00:06.015281 54271 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240202 16:00:06.040817 54367 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240202 16:00:06.980571 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240202 16:00:07.005231 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240202 16:00:07.266817 54498 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240202 16:00:08.691184 54498 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240202 16:00:08.748912 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240202 16:00:08.761901 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240202 16:00:09.550240 54498 grad_async_v2.h:257] pq is empty
E20240202 16:00:09.691015 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=41
W20240202 16:00:09.774477 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=13, pq.top=13
E20240202 16:00:09.957959 54498 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=16, sample_step_cpp_seen_[rank]=15
W20240202 16:00:10.098315 58579 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 273.160 us                | 2.175 ms                  |
| ProcessBack:Shuffle       | 2.369 ms                  | 191.700 ms                |
| ProcessBack:UpdateCache   | 2.359 ms                  | 262.926 ms                |
| ProcessBack:UpsertPq      | 11.706 ms                 | 55.891 ms                 |
| ProcessOneStep            | 23.667 ms                 | 573.969 ms                |
| BlockToStepN              | 488.055 us                | 9.067 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240202 16:00:10.691011 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=19
W20240202 16:00:11.184643 58579 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end3
W20240202 16:00:11.605027 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=27, pq.top=27
E20240202 16:00:11.698629 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1443
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.637 ms                  | 102.093 ms                |
| Forward                   | 5.148 ms                  | 625.976 ms                |
| Backward                  | 4.903 ms                  | 195.907 ms                |
| Optimize                  | 2.076 ms                  | 5.862 ms                  |
| BarrierTimeBeforeRank0    | 6.199 ms                  | 127.260 ms                |
| AfterBackward             | 34.105 ms                 | 574.545 ms                |
| BlockToStepN              | 366.673 us                | 16.716 ms                 |
| OneStep                   | 79.116 ms                 | 1.484 s                   |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:12.403941 58579 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240202 16:00:12.698134 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240202 16:00:13.117934 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=37, pq.top=37
W20240202 16:00:13.422029 58579 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end9
E20240202 16:00:13.698019 59032 parallel_pq_v2.h:79] insert failed, size(hashtable)=15216
W20240202 16:00:14.506119 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end0
E20240202 16:00:14.698015 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=2568
W20240202 16:00:14.729781 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=50, pq.top=50
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 300.964 us                | 3.431 ms                  |
| ProcessBack:Shuffle       | 2.427 ms                  | 138.137 ms                |
| ProcessBack:UpdateCache   | 2.405 ms                  | 262.216 ms                |
| ProcessBack:UpsertPq      | 13.962 ms                 | 66.299 ms                 |
| ProcessOneStep            | 45.376 ms                 | 573.969 ms                |
| BlockToStepN              | 488.055 us                | 9.067 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:15.523649 58579 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
E20240202 16:00:15.698007 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=3977
W20240202 16:00:15.764109 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=63, pq.top=63
E20240202 16:00:15.939499 56694 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=65, sample_step_cpp_seen_[rank]=64
W20240202 16:00:16.524886 58579 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end0
E20240202 16:00:16.706243 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.283 ms                  | 182.418 ms                |
| Forward                   | 5.331 ms                  | 7.417 ms                  |
| Backward                  | 4.922 ms                  | 6.599 ms                  |
| Optimize                  | 2.219 ms                  | 5.120 ms                  |
| BarrierTimeBeforeRank0    | 2.870 ms                  | 70.459 ms                 |
| AfterBackward             | 46.037 ms                 | 574.545 ms                |
| BlockToStepN              | 562.032 us                | 24.627 ms                 |
| OneStep                   | 74.110 ms                 | 669.317 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:17.542903 58579 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240202 16:00:17.706010 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=3381
W20240202 16:00:17.893561 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=77, pq.top=77
E20240202 16:00:18.718447 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240202 16:00:18.831518 58579 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
W20240202 16:00:19.564215 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=89, pq.top=89
E20240202 16:00:19.718014 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=129
W20240202 16:00:19.969458 58579 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 332.822 us                | 6.252 ms                  |
| ProcessBack:Shuffle       | 2.632 ms                  | 14.993 ms                 |
| ProcessBack:UpdateCache   | 2.578 ms                  | 24.199 ms                 |
| ProcessBack:UpsertPq      | 15.642 ms                 | 66.299 ms                 |
| ProcessOneStep            | 46.004 ms                 | 644.893 ms                |
| BlockToStepN              | 492.363 us                | 9.067 ms                  |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 14.229, sample: 1.711, forward: 1.197, backward: 0.716, update: 0.233
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 17.359, sample: 1.443, forward: 1.146, backward: 0.782, update: 0.213
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 14.255, sample: 1.548, forward: 1.169, backward: 0.766, update: 0.252
train_sampler.Prefill()
-------Step 0-------
tensor([   60685,   766464, 38710499,   707572,   485216,   766497,   766550,
          234189,    60726,    60757]) tensor([ 4812722, 24782321, 25346509, 43273629, 60446372, 30389208, 82627074,
        64730911, 47065016, 69991575])
-------Step 1-------
tensor([   60685,   766464, 38710499,   707572,   485216,   766497,   766550,
          234189,    60726,    60757]) tensor([25835411, 79651077, 67602697,  9551367, 65591921,  8825005, 84489427,
        82688073, 19549527, 35393860])
-------Step 2-------
tensor([  872222,    74591, 77886336,    74628,   872250,   872268,   872290,
        46016982,   872318,   872349]) tensor([30733810,  5020544, 66066349, 11180130, 16955280, 10903538, 65677493,
         8746048, 49079498, 28757381])
-------Step 3-------
tensor([  872222,    74591, 77886336,    74628,   872250,   872268,   872290,
        46016982,   872318,   872349]) tensor([16231863, 38336556, 65540316, 43794087, 16302467, 75215956, 77486352,
        54283523, 19807864, 80022201])
-------Step 4-------
tensor([935233,  89310, 935256, 935274,  89350, 935295,  89391, 935308,  89440,
        935335]) tensor([57259462, 45325033, 19040680, 12400399, 48436136, 37841787, 81721600,
        54330484, 47910512,  8304795])
-------Step 5-------
tensor([935233,  89310, 935256, 935274,  89350, 935295,  89391, 935308,  89440,
        935335]) tensor([38658586, 38423119, 83540401,  8706568, 31688666, 34727479, 40612985,
        77482639, 84937429,   390346])
-------Step 6-------
tensor([80022388,   982202,   982217,   982232,  4309164,   982246,   982259,
          982273,   982291,   240028]) tensor([30635149, 37252762, 28896988, 17877991, 79253441, 47887724, 35874406,
        16676250, 72420385,  7588923])
-------Step 7-------
tensor([80022388,   982202,   982217,   982232,  4309164,   982246,   982259,
          982273,   982291,   240028]) tensor([43870302, 75932027, 58805971, 77400377, 58409285,  1705535, 19334186,
        53375381, 23027841, 17473697])
-------Step 8-------
tensor([ 1024067,   118754,  1024081, 38843158,   744586,  1024096,  1024111,
         1024124,   241760,   744606]) tensor([26456993, 62083643, 40978808, 76132498, 82186515, 70387412, 66890532,
        68589240,  9720208,  3237089])
-------Step 9-------
tensor([ 1024067,   118754,  1024081, 38843158,   744586,  1024096,  1024111,
         1024124,   241760,   744606]) tensor([78908894, 54695395, 28304040, 45503584, 13094682,   858866, 17929053,
        12731671, 81792256, 38754917])
before start barrier
start train
[proc 0] 100 steps, total: 13.003, sample: 2.020, forward: 1.144, backward: 0.693, update: 0.250
E20240202 16:00:20.718051 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1000
W20240202 16:00:21.089262 58579 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
E20240202 16:00:21.463987 54498 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=112, sample_step_cpp_seen_[rank]=111
W20240202 16:00:21.698294 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=113, pq.top=113
E20240202 16:00:21.718009 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=77
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.943 ms                  | 187.335 ms                |
| Forward                   | 5.167 ms                  | 7.446 ms                  |
| Backward                  | 4.903 ms                  | 10.172 ms                 |
| Optimize                  | 2.178 ms                  | 5.862 ms                  |
| BarrierTimeBeforeRank0    | 995.521 us                | 70.459 ms                 |
| AfterBackward             | 46.590 ms                 | 644.936 ms                |
| BlockToStepN              | 664.326 us                | 24.627 ms                 |
| OneStep                   | 76.258 ms                 | 839.439 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:22.107486 58579 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end6
E20240202 16:00:22.718015 56694 parallel_pq_v2.h:79] insert failed, size(hashtable)=5619
W20240202 16:00:22.802758 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=121, pq.top=120
W20240202 16:00:23.113456 58579 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240202 16:00:23.718014 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=83
W20240202 16:00:24.135269 58579 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240202 16:00:24.167156 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=133, pq.top=133
E20240202 16:00:24.718012 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 400.644 us                | 6.924 ms                  |
| ProcessBack:Shuffle       | 2.653 ms                  | 11.551 ms                 |
| ProcessBack:UpdateCache   | 2.789 ms                  | 23.376 ms                 |
| ProcessBack:UpsertPq      | 18.541 ms                 | 62.567 ms                 |
| ProcessOneStep            | 46.561 ms                 | 650.471 ms                |
| BlockToStepN              | 630.314 us                | 13.582 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:25.172307 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=146, pq.top=146
W20240202 16:00:25.390283 58579 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240202 16:00:25.718017 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=104
W20240202 16:00:26.177999 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=151, pq.top=151
W20240202 16:00:26.445972 58579 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end5
E20240202 16:00:26.718009 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=3475
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.020 ms                  | 187.335 ms                |
| Forward                   | 5.145 ms                  | 7.446 ms                  |
| Backward                  | 5.041 ms                  | 8.593 ms                  |
| Optimize                  | 2.219 ms                  | 5.862 ms                  |
| BarrierTimeBeforeRank0    | 342.684 us                | 39.717 ms                 |
| AfterBackward             | 46.590 ms                 | 644.936 ms                |
| BlockToStepN              | 867.524 us                | 21.803 ms                 |
| OneStep                   | 76.258 ms                 | 695.367 ms                |
+---------------------------+---------------------------+---------------------------+
E20240202 16:00:27.129843 54498 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=165, sample_step_cpp_seen_[rank]=164
E20240202 16:00:27.732266 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240202 16:00:27.755175 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
W20240202 16:00:28.217808 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=167, pq.top=167
E20240202 16:00:28.732015 54498 parallel_pq_v2.h:79] insert failed, size(hashtable)=230
W20240202 16:00:28.809446 58579 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
W20240202 16:00:29.279788 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=181, pq.top=181
E20240202 16:00:29.732013 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=492
W20240202 16:00:29.858500 58579 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 324.894 us                | 4.006 ms                  |
| ProcessBack:Shuffle       | 2.634 ms                  | 10.742 ms                 |
| ProcessBack:UpdateCache   | 2.859 ms                  | 3.930 ms                  |
| ProcessBack:UpsertPq      | 18.798 ms                 | 59.763 ms                 |
| ProcessOneStep            | 46.561 ms                 | 650.471 ms                |
| BlockToStepN              | 914.191 us                | 13.582 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:30.606928 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=193, pq.top=193
E20240202 16:00:30.732010 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=14648
W20240202 16:00:31.048370 58579 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end6
E20240202 16:00:31.732034 59044 parallel_pq_v2.h:79] insert failed, size(hashtable)=14585
W20240202 16:00:31.780017 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=197, pq.top=197
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.457 ms                  | 187.335 ms                |
| Forward                   | 5.104 ms                  | 7.446 ms                  |
| Backward                  | 5.065 ms                  | 9.832 ms                  |
| Optimize                  | 2.232 ms                  | 5.862 ms                  |
| BarrierTimeBeforeRank0    | 342.684 us                | 39.717 ms                 |
| AfterBackward             | 45.659 ms                 | 652.876 ms                |
| BlockToStepN              | 969.245 us                | 24.627 ms                 |
| OneStep                   | 76.258 ms                 | 912.712 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:32.076762 58579 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
[proc 2] 200 steps, total: 11.897, sample: 1.282, forward: 0.481, backward: 0.513, update: 0.212
[proc 0] 200 steps, total: 11.897, sample: 1.973, forward: 0.503, backward: 0.544, update: 0.249
[proc 3] 200 steps, total: 11.897, sample: 1.178, forward: 0.491, backward: 0.551, update: 0.211
[proc 1] 200 steps, total: 11.897, sample: 1.208, forward: 0.523, backward: 0.516, update: 0.208
E20240202 16:00:32.732020 59054 parallel_pq_v2.h:79] insert failed, size(hashtable)=22039
W20240202 16:00:32.880769 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=211, pq.top=211
E20240202 16:00:32.907336 56694 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=211, sample_step_cpp_seen_[rank]=210
W20240202 16:00:33.078861 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240202 16:00:33.732028 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1277
W20240202 16:00:34.068023 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=215, pq.top=215
W20240202 16:00:34.098646 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240202 16:00:34.732010 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=97
W20240202 16:00:35.071482 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=228, pq.top=228
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 374.627 us                | 6.384 ms                  |
| ProcessBack:Shuffle       | 2.634 ms                  | 8.957 ms                  |
| ProcessBack:UpdateCache   | 2.834 ms                  | 4.024 ms                  |
| ProcessBack:UpsertPq      | 19.708 ms                 | 66.299 ms                 |
| ProcessOneStep            | 45.627 ms                 | 652.827 ms                |
| BlockToStepN              | 920.608 us                | 16.640 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:35.178803 58579 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240202 16:00:35.732017 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=32730
W20240202 16:00:36.237246 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
W20240202 16:00:36.296330 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=236, pq.top=236
E20240202 16:00:36.732021 59036 parallel_pq_v2.h:79] insert failed, size(hashtable)=38851
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.255 ms                  | 204.584 ms                |
| Forward                   | 5.174 ms                  | 8.902 ms                  |
| Backward                  | 5.154 ms                  | 9.832 ms                  |
| Optimize                  | 2.329 ms                  | 7.180 ms                  |
| BarrierTimeBeforeRank0    | 57.460 us                 | 39.717 ms                 |
| AfterBackward             | 45.726 ms                 | 652.876 ms                |
| BlockToStepN              | 1.047 ms                  | 24.627 ms                 |
| OneStep                   | 76.258 ms                 | 912.712 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:37.300380 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=248, pq.top=248
W20240202 16:00:37.318918 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
E20240202 16:00:37.732010 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=2321
E20240202 16:00:37.907009 54498 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=253, sample_step_cpp_seen_[rank]=252
W20240202 16:00:38.346977 58579 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
W20240202 16:00:38.375433 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=255, pq.top=255
E20240202 16:00:38.732007 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=34560
W20240202 16:00:39.428932 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=267, pq.top=267
W20240202 16:00:39.545485 58579 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240202 16:00:39.732009 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=54320
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 388.628 us                | 14.067 ms                 |
| ProcessBack:Shuffle       | 2.623 ms                  | 8.957 ms                  |
| ProcessBack:UpdateCache   | 2.834 ms                  | 4.086 ms                  |
| ProcessBack:UpsertPq      | 19.697 ms                 | 70.651 ms                 |
| ProcessOneStep            | 45.686 ms                 | 652.827 ms                |
| BlockToStepN              | 1.084 ms                  | 23.778 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:40.612761 58579 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end9
W20240202 16:00:40.678762 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=280, pq.top=280
E20240202 16:00:40.732008 54498 parallel_pq_v2.h:79] insert failed, size(hashtable)=3314
W20240202 16:00:41.684893 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=291, pq.top=291
E20240202 16:00:41.732010 56694 parallel_pq_v2.h:79] insert failed, size(hashtable)=60911
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.078 ms                  | 196.479 ms                |
| Forward                   | 5.181 ms                  | 8.902 ms                  |
| Backward                  | 5.126 ms                  | 10.089 ms                 |
| Optimize                  | 2.329 ms                  | 7.180 ms                  |
| BarrierTimeBeforeRank0    | 59.634 us                 | 43.188 ms                 |
| AfterBackward             | 45.726 ms                 | 652.876 ms                |
| BlockToStepN              | 1.247 ms                  | 33.878 ms                 |
| OneStep                   | 76.258 ms                 | 839.439 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:41.825064 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end3
W20240202 16:00:42.713817 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=296, pq.top=296
E20240202 16:00:42.732008 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=13214
W20240202 16:00:42.886691 58579 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end9
[proc 0] 300 steps, total: 10.820, sample: 1.603, forward: 0.603, backward: 0.588, update: 0.302
[proc 2] 300 steps, total: 10.820, sample: 1.131, forward: 0.490, backward: 0.547, update: 0.206
[proc 3] 300 steps, total: 10.820, sample: 1.114, forward: 0.480, backward: 0.546, update: 0.203
[proc 1] 300 steps, total: 10.820, sample: 1.027, forward: 0.606, backward: 0.496, update: 0.208
E20240202 16:00:43.732010 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=49802
W20240202 16:00:43.750865 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=310, pq.top=310
E20240202 16:00:44.071491 54498 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=312, sample_step_cpp_seen_[rank]=311
W20240202 16:00:44.081923 58579 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240202 16:00:44.732489 59044 parallel_pq_v2.h:79] insert failed, size(hashtable)=8
W20240202 16:00:44.839316 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=321, pq.top=321
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 379.559 us                | 17.431 ms                 |
| ProcessBack:Shuffle       | 2.634 ms                  | 8.015 ms                  |
| ProcessBack:UpdateCache   | 2.834 ms                  | 4.462 ms                  |
| ProcessBack:UpsertPq      | 19.697 ms                 | 73.846 ms                 |
| ProcessOneStep            | 45.627 ms                 | 652.827 ms                |
| BlockToStepN              | 1.222 ms                  | 33.789 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:45.269929 58579 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240202 16:00:45.732008 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=8759
W20240202 16:00:45.924681 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=331, pq.top=331
W20240202 16:00:46.290868 58579 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end5
E20240202 16:00:46.732009 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=30369
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.745 ms                  | 196.479 ms                |
| Forward                   | 5.213 ms                  | 9.603 ms                  |
| Backward                  | 5.212 ms                  | 10.172 ms                 |
| Optimize                  | 2.382 ms                  | 7.791 ms                  |
| BarrierTimeBeforeRank0    | 57.460 us                 | 49.651 ms                 |
| AfterBackward             | 45.659 ms                 | 652.876 ms                |
| BlockToStepN              | 1.278 ms                  | 34.125 ms                 |
| OneStep                   | 76.287 ms                 | 839.439 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:47.339962 58579 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240202 16:00:47.741416 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240202 16:00:47.972783 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=345, pq.top=345
W20240202 16:00:48.356374 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
E20240202 16:00:48.741015 54498 parallel_pq_v2.h:79] insert failed, size(hashtable)=128
W20240202 16:00:49.219041 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=359, pq.top=359
W20240202 16:00:49.462608 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
E20240202 16:00:49.741009 56694 parallel_pq_v2.h:79] insert failed, size(hashtable)=63730
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 446.068 us                | 4.381 ms                  |
| ProcessBack:Shuffle       | 2.657 ms                  | 8.015 ms                  |
| ProcessBack:UpdateCache   | 2.849 ms                  | 4.372 ms                  |
| ProcessBack:UpsertPq      | 19.697 ms                 | 76.035 ms                 |
| ProcessOneStep            | 45.627 ms                 | 652.827 ms                |
| BlockToStepN              | 1.318 ms                  | 33.789 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240202 16:00:50.409639 56694 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=371, sample_step_cpp_seen_[rank]=370
W20240202 16:00:50.633093 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240202 16:00:50.741035 58578 parallel_pq_v2.h:79] insert failed, size(hashtable)=10696
W20240202 16:00:51.492460 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=376, pq.top=375
W20240202 16:00:51.663084 58579 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end9
E20240202 16:00:51.741016 59046 parallel_pq_v2.h:79] insert failed, size(hashtable)=33329
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.634 ms                  | 196.479 ms                |
| Forward                   | 5.356 ms                  | 8.902 ms                  |
| Backward                  | 5.209 ms                  | 10.089 ms                 |
| Optimize                  | 2.422 ms                  | 7.180 ms                  |
| BarrierTimeBeforeRank0    | 50.126 us                 | 49.651 ms                 |
| AfterBackward             | 45.726 ms                 | 652.876 ms                |
| BlockToStepN              | 1.395 ms                  | 34.125 ms                 |
| OneStep                   | 77.011 ms                 | 713.392 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:52.492167 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=390, pq.top=390
E20240202 16:00:52.741014 56694 parallel_pq_v2.h:79] insert failed, size(hashtable)=5186
W20240202 16:00:53.008636 58579 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
W20240202 16:00:53.532948 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=399, pq.top=399
[proc 3] 400 steps, total: 10.601, sample: 0.947, forward: 0.478, backward: 0.547, update: 0.201
[proc 2] 400 steps, total: 10.601, sample: 0.954, forward: 0.496, backward: 0.511, update: 0.207
[proc 1] 400 steps, total: 10.601, sample: 1.329, forward: 0.510, backward: 0.586, update: 0.208
[proc 0] 400 steps, total: 10.601, sample: 1.672, forward: 0.597, backward: 0.600, update: 0.280
E20240202 16:00:53.745054 59051 parallel_pq_v2.h:79] insert failed, size(hashtable)=15972
W20240202 16:00:54.128192 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240202 16:00:54.720423 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=407, pq.top=407
E20240202 16:00:54.745018 59053 parallel_pq_v2.h:79] insert failed, size(hashtable)=17089
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 357.658 us                | 13.834 ms                 |
| ProcessBack:Shuffle       | 2.673 ms                  | 8.053 ms                  |
| ProcessBack:UpdateCache   | 2.885 ms                  | 4.327 ms                  |
| ProcessBack:UpsertPq      | 19.568 ms                 | 78.070 ms                 |
| ProcessOneStep            | 45.733 ms                 | 652.827 ms                |
| BlockToStepN              | 1.435 ms                  | 55.656 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:55.233916 58579 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end3
E20240202 16:00:55.683813 56694 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=418, sample_step_cpp_seen_[rank]=417
E20240202 16:00:55.745010 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=4550
W20240202 16:00:56.308943 58579 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end3
E20240202 16:00:56.758131 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.685 ms                  | 196.479 ms                |
| Forward                   | 5.331 ms                  | 9.603 ms                  |
| Backward                  | 5.234 ms                  | 10.845 ms                 |
| Optimize                  | 2.408 ms                  | 7.515 ms                  |
| BarrierTimeBeforeRank0    | 46.097 us                 | 49.651 ms                 |
| AfterBackward             | 45.769 ms                 | 652.876 ms                |
| BlockToStepN              | 1.565 ms                  | 55.764 ms                 |
| OneStep                   | 77.367 ms                 | 713.392 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 16:00:57.275136 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=427, pq.top=427
W20240202 16:00:57.380409 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
E20240202 16:00:57.758009 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=31102
W20240202 16:00:58.385685 58579 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end1
W20240202 16:00:58.444700 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=441, pq.top=441
E20240202 16:00:58.758008 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=4158
W20240202 16:00:59.466032 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=451, pq.top=451
W20240202 16:00:59.500217 58579 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
E20240202 16:00:59.758009 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=10854
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 432.038 us                | 19.535 ms                 |
| ProcessBack:Shuffle       | 2.674 ms                  | 8.053 ms                  |
| ProcessBack:UpdateCache   | 2.897 ms                  | 4.312 ms                  |
| ProcessBack:UpsertPq      | 19.456 ms                 | 80.845 ms                 |
| ProcessOneStep            | 45.686 ms                 | 652.827 ms                |
| BlockToStepN              | 1.510 ms                  | 52.121 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240202 16:01:00.520475 58579 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240202 16:01:00.697973 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=463, pq.top=463
E20240202 16:01:00.758011 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=3428
E20240202 16:01:00.892850 56694 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=465, sample_step_cpp_seen_[rank]=464
E20240202 16:01:01.758008 54498 parallel_pq_v2.h:79] insert failed, size(hashtable)=2905
W20240202 16:01:01.784510 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=475, pq.top=475
W20240202 16:01:01.817059 58579 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.499 ms                  | 187.335 ms                |
| Forward                   | 5.373 ms                  | 9.397 ms                  |
| Backward                  | 5.208 ms                  | 10.772 ms                 |
| Optimize                  | 2.412 ms                  | 7.180 ms                  |
| BarrierTimeBeforeRank0    | 46.793 us                 | 49.651 ms                 |
| AfterBackward             | 46.037 ms                 | 652.876 ms                |
| BlockToStepN              | 1.651 ms                  | 52.228 ms                 |
| OneStep                   | 77.412 ms                 | 713.392 ms                |
+---------------------------+---------------------------+---------------------------+
E20240202 16:01:02.758016 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=80292
W20240202 16:01:03.126277 58579 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
W20240202 16:01:03.348085 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=487, pq.top=487
E20240202 16:01:03.758010 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=52811
W20240202 16:01:04.236941 58579 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end7
E20240202 16:01:04.758033 58579 parallel_pq_v2.h:79] insert failed, size(hashtable)=3703
W20240202 16:01:04.930537 54498 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=499, pq.top=499
[proc 1] 500 steps, total: 11.390, sample: 0.953, forward: 0.568, backward: 0.664, update: 0.257
[proc 2] 500 steps, total: 11.390, sample: 1.043, forward: 0.571, backward: 0.557, update: 0.222
[proc 3] 500 steps, total: 11.390, sample: 0.979, forward: 0.554, backward: 0.508, update: 0.206
[proc 0] 500 steps, total: 11.390, sample: 1.683, forward: 0.554, backward: 0.591, update: 0.256
Successfully xmh. training takes 57.71146512031555 seconds
before call kg_cache_controller.StopThreads()
W20240202 16:01:04.978327 54498 grad_async_v2.h:84] call StopThreads. PID = 23256
W20240202 16:01:04.978370 54498 grad_base.h:212] before processOneStepNegThread_.join();
W20240202 16:01:04.978725 54498 grad_base.h:214] after processOneStepNegThread_.join();
W20240202 16:01:04.978754 54498 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240202 16:01:05.099381 54498 grad_async_v2.h:105] StopThreads done.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 450.619 us                | 17.332 ms                 |
| ProcessBack:Shuffle       | 2.680 ms                  | 8.310 ms                  |
| ProcessBack:UpdateCache   | 2.915 ms                  | 4.312 ms                  |
| ProcessBack:UpsertPq      | 19.256 ms                 | 84.594 ms                 |
| ProcessOneStep            | 46.004 ms                 | 652.827 ms                |
| BlockToStepN              | 1.515 ms                  | 52.121 ms                 |
+---------------------------+---------------------------+---------------------------+

WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240202 16:01:58.033651  6123 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_43', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [6123 sampler.py:454] Start PreSampling
WARNING [6123 sampler.py:532] Before construct renumbering_dict
WARNING [6123 sampler.py:555] PreSampling done
W20240202 16:21:24.494114  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240202 16:21:24.494292  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240202 16:21:24.494328  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240202 16:21:24.494366  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240202 16:21:24.494401  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240202 16:21:24.494444  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240202 16:21:24.494477  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240202 16:21:24.494524  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240202 16:21:24.494558  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240202 16:21:24.494597  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240202 16:21:24.494637  6123 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240202 16:21:24.494666  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240202 16:21:24.494697  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240202 16:21:24.494835  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240202 16:21:24.494872  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240202 16:21:24.494911  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240202 16:21:24.494953  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240202 16:21:24.494982  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240202 16:21:24.495014  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240202 16:21:24.495059  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240202 16:21:24.495098  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240202 16:21:24.495134  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240202 16:21:24.495163  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240202 16:21:24.495198  6123 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240202 16:21:24.495222  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240202 16:21:24.495249  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240202 16:21:24.495312  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240202 16:21:24.495348  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240202 16:21:24.495379  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240202 16:21:24.495414  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240202 16:21:24.495445  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240202 16:21:24.495481  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240202 16:21:24.495520  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240202 16:21:24.495554  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240202 16:21:24.495590  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240202 16:21:24.495620  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240202 16:21:24.495651  6123 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240202 16:21:24.495676  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240202 16:21:24.495703  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240202 16:21:24.495764  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240202 16:21:24.495802  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240202 16:21:24.495834  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240202 16:21:24.495867  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240202 16:21:24.495898  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240202 16:21:24.495929  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240202 16:21:24.495963  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240202 16:21:24.496001  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240202 16:21:24.496037  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240202 16:21:24.496086  6123 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240202 16:21:24.496121  6123 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240202 16:21:24.496146  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240202 16:21:24.496176  6123 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240202 16:21:24.916618  6123 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240202 16:30:01.707749  6123 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302705,  4302733,   107113,  ..., 57870879, 13802153,  2471184]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2196.715 seconds
[Rank1] pid = 34803
[Rank2] pid = 34963
INFO [6123 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [34803 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [35127 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [34963 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [34963 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [35127 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [34803 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [6123 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240202 16:38:39.847939 34964 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240202 16:38:39.847996 34804 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240202 16:38:39.847996 35191 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240202 16:38:39.848192 35128 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240202 16:38:39.901722 35128 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102036619000 7.629 MB
W20240202 16:38:39.901734 34964 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x10203755f000 7.629 MB
W20240202 16:38:39.901731 34804 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x102036dbc000 7.629 MB
W20240202 16:38:39.901892 35128 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x1020384a5000 7.629 MB
W20240202 16:38:39.901887 35191 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102037d02000 7.629 MB
W20240202 16:38:39.901929 34804 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102038c48000 7.629 MB
W20240202 16:38:39.901942 34964 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020393eb000 7.629 MB
W20240202 16:38:39.901944 35128 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x102039b8e000 1.49 GB
W20240202 16:38:39.901991 35128 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x102099171000 1.49 GB
W20240202 16:38:39.902007 34804 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1020f8754000 1.49 GB
W20240202 16:38:39.902037 34964 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x102157d37000 1.49 GB
W20240202 16:38:39.902043 35191 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1021b731a000 7.629 MB
W20240202 16:38:39.902065 34804 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1021b7abd000 1.49 GB
W20240202 16:38:39.902066 35128 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240202 16:38:39.902091 34964 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1022170a0000 1.49 GB
W20240202 16:38:39.902122 34804 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240202 16:38:39.902129 35191 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102276683000 1.49 GB
W20240202 16:38:39.902148 34964 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240202 16:38:39.902169 35191 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1022d5c66000 1.49 GB
W20240202 16:38:39.902215 35191 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240202 16:38:39.908481 34964 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240202 16:38:39.908485 34804 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240202 16:38:39.908529 35191 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240202 16:38:39.908660 35128 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [34803 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [34963 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [35127 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 35127
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [6123 DistTensor.py:59] The tensor name already exists in the kvstore
I20240202 16:39:12.785233 35128 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240202 16:39:12.785451 34804 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 16:39:12.785530 35191 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 16:39:12.785620 34964 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240202 16:39:13.188773 35128 recstore.cc:66] init folly done
E20240202 16:39:13.188813 35191 recstore.cc:66] init folly done
E20240202 16:39:13.188813 34804 recstore.cc:66] init folly done
E20240202 16:39:13.188813 34964 recstore.cc:66] init folly done
I20240202 16:39:23.961462 35191 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240202 16:39:27.003587 34964 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240202 16:39:27.178361 34804 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240202 16:39:28.098476 35128 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.907 ms                  | 85.155 ms                 |
| Forward                   | 4.597 ms                  | 565.723 ms                |
| Backward                  | 146.298 ms                | 1.638 s                   |
| Optimize                  | 39.862 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 28.859 us                 | 56.877 us                 |
| BlockToStepN              | 15.908 us                 | 51.441 us                 |
| OneStep                   | 201.268 ms                | 2.278 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.712 ms                  | 85.155 ms                 |
| Forward                   | 4.724 ms                  | 565.723 ms                |
| Backward                  | 146.781 ms                | 1.638 s                   |
| Optimize                  | 38.720 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 39.176 us                 | 66.842 us                 |
| BlockToStepN              | 22.107 us                 | 60.862 us                 |
| OneStep                   | 204.456 ms                | 2.278 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.646 ms                  | 81.803 ms                 |
| Forward                   | 4.897 ms                  | 23.386 ms                 |
| Backward                  | 150.638 ms                | 233.196 ms                |
| Optimize                  | 38.925 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 36.156 us                 | 56.877 us                 |
| BlockToStepN              | 22.736 us                 | 60.862 us                 |
| OneStep                   | 212.604 ms                | 344.131 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.808 ms                  | 81.803 ms                 |
| Forward                   | 4.752 ms                  | 23.386 ms                 |
| Backward                  | 145.341 ms                | 233.196 ms                |
| Optimize                  | 38.508 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 35.940 us                 | 56.877 us                 |
| BlockToStepN              | 23.720 us                 | 1.279 ms                  |
| OneStep                   | 204.456 ms                | 344.131 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 23.276, sample: 1.127, forward: 1.057, backward: 11.233, update: 0.353
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 23.451, sample: 1.093, forward: 1.084, backward: 10.834, update: 0.365
train_sampler.Prefill()
-------Step 0-------
tensor([   57058,   714873, 46855410,   973729,   456757,   714911,   714941,
          213853,    57100,    57143]) tensor([ 4954838, 26029740, 21300601, 52800488, 49613321, 26648580, 84186338,
        75991098, 51110202, 82573255])
-------Step 1-------
tensor([   57058,   714873, 46855410,   973729,   456757,   714911,   714941,
          213853,    57100,    57143]) tensor([27295735, 69644396, 80414724, 10361372, 54113584,  8463807, 84293732,
        74200636, 16810321, 30849893])
-------Step 2-------
tensor([  789921,    70337, 65848539,    70371,   789939,   789967,   789988,
        39515340,   790016,   790048]) tensor([35813049,  4968620, 54962745, 10292771, 14914304, 12266297, 60684131,
         9531266, 59581774, 33939973])
-------Step 3-------
tensor([  789921,    70337, 65848539,    70371,   789939,   789967,   789988,
        39515340,   790016,   790048]) tensor([19059034, 44831645, 78923142, 36212976, 14141380, 69519863, 72409914,
        63640822, 23507804, 70584080])
-------Step 4-------
tensor([864903,  84032, 864933, 864960,  84063, 864988,  84100, 865017,  84140,
        865043]) tensor([68934137, 37036371, 16404986, 14012593, 51952167, 45536877, 74145627,
        44949241, 52988080,  9154269])
-------Step 5-------
tensor([864903,  84032, 864933, 864960,  84063, 864988,  84100, 865017,  84140,
        865043]) tensor([31373193, 46179614, 83327538,  9332328, 37017582, 28516799, 36891341,
        65233408, 85687909,   396965])
-------Step 6-------
tensor([69726431,   914809,   914820,   914828,  4308882,   914837,   914846,
          914854,   914864,   219225]) tensor([26409733, 45185875, 24232515, 20987342, 68465795, 52963366, 41999323,
        14444250, 62103046,  8191936])
-------Step 7-------
tensor([69726431,   914809,   914820,   914828,  4308882,   914837,   914846,
          914854,   914864,   219225]) tensor([36222180, 79681363, 48302396, 65351140, 70725279,  1531013, 16606641,
        45883113, 20702817, 16082794])
-------Step 8-------
tensor([  939181,   112080,   939191, 32459557,   998937,   939198,   939210,
          939216,   220787,   998958]) tensor([23429175, 57156682, 43890740, 85370941, 75966242, 59123155, 61742841,
        81419897, 10560783,  3240894])
-------Step 9-------
tensor([  939181,   112080,   939191, 32459557,   998937,   939198,   939210,
          939216,   220787,   998958]) tensor([68187996, 60283108, 25471914, 42757659, 12301349,  1069906, 20733595,
        14203157, 74299316, 42164258])
before start barrier
start train
[proc 0] 100 steps, total: 22.356, sample: 1.182, forward: 1.043, backward: 16.086, update: 3.965
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 26.493, sample: 1.101, forward: 1.145, backward: 10.723, update: 0.363
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.932 ms                  | 85.155 ms                 |
| Forward                   | 4.773 ms                  | 23.386 ms                 |
| Backward                  | 135.631 ms                | 233.196 ms                |
| Optimize                  | 38.371 ms                 | 72.249 ms                 |
| BarrierTimeBeforeRank0    | 35.940 us                 | 66.842 us                 |
| BlockToStepN              | 22.476 us                 | 1.279 ms                  |
| OneStep                   | 191.009 ms                | 344.131 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.673 ms                  | 85.155 ms                 |
| Forward                   | 4.734 ms                  | 23.386 ms                 |
| Backward                  | 133.679 ms                | 233.196 ms                |
| Optimize                  | 38.225 ms                 | 72.249 ms                 |
| BarrierTimeBeforeRank0    | 35.635 us                 | 71.411 us                 |
| BlockToStepN              | 22.109 us                 | 1.279 ms                  |
| OneStep                   | 187.095 ms                | 344.131 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.504 ms                  | 81.803 ms                 |
| Forward                   | 4.773 ms                  | 23.386 ms                 |
| Backward                  | 131.789 ms                | 224.065 ms                |
| Optimize                  | 37.925 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 35.537 us                 | 66.842 us                 |
| BlockToStepN              | 22.154 us                 | 1.348 ms                  |
| OneStep                   | 183.570 ms                | 297.703 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.504 ms                  | 84.712 ms                 |
| Forward                   | 4.710 ms                  | 23.386 ms                 |
| Backward                  | 131.789 ms                | 224.065 ms                |
| Optimize                  | 37.925 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 35.537 us                 | 66.842 us                 |
| BlockToStepN              | 22.736 us                 | 1.789 ms                  |
| OneStep                   | 183.391 ms                | 321.565 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 18.728, sample: 1.134, forward: 0.488, backward: 13.294, update: 3.713
[proc 3] 200 steps, total: 18.728, sample: 1.111, forward: 0.513, backward: 9.180, update: 0.414
[proc 1] 200 steps, total: 18.728, sample: 1.246, forward: 0.501, backward: 9.396, update: 0.403
[proc 2] 200 steps, total: 18.728, sample: 1.130, forward: 0.532, backward: 9.097, update: 0.400
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.561 ms                  | 85.155 ms                 |
| Forward                   | 4.697 ms                  | 23.386 ms                 |
| Backward                  | 132.363 ms                | 224.065 ms                |
| Optimize                  | 37.996 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 35.785 us                 | 71.411 us                 |
| BlockToStepN              | 22.109 us                 | 1.789 ms                  |
| OneStep                   | 183.391 ms                | 321.565 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.600 ms                  | 85.155 ms                 |
| Forward                   | 4.734 ms                  | 23.386 ms                 |
| Backward                  | 131.744 ms                | 224.065 ms                |
| Optimize                  | 37.885 ms                 | 64.149 ms                 |
| BarrierTimeBeforeRank0    | 36.078 us                 | 80.231 us                 |
| BlockToStepN              | 21.876 us                 | 6.282 ms                  |
| OneStep                   | 182.502 ms                | 321.565 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.595 ms                  | 84.712 ms                 |
| Forward                   | 4.767 ms                  | 9.143 ms                  |
| Backward                  | 131.597 ms                | 212.507 ms                |
| Optimize                  | 37.925 ms                 | 63.745 ms                 |
| BarrierTimeBeforeRank0    | 36.747 us                 | 71.411 us                 |
| BlockToStepN              | 22.107 us                 | 6.282 ms                  |
| OneStep                   | 182.758 ms                | 297.703 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.634 ms                  | 84.712 ms                 |
| Forward                   | 4.768 ms                  | 9.143 ms                  |
| Backward                  | 131.561 ms                | 212.507 ms                |
| Optimize                  | 38.113 ms                 | 63.745 ms                 |
| BarrierTimeBeforeRank0    | 37.808 us                 | 73.955 us                 |
| BlockToStepN              | 22.109 us                 | 10.227 ms                 |
| OneStep                   | 183.063 ms                | 297.703 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 300 steps, total: 18.770, sample: 0.973, forward: 0.471, backward: 8.899, update: 0.411
[proc 0] 300 steps, total: 18.770, sample: 1.054, forward: 0.492, backward: 13.224, update: 3.860
[proc 2] 300 steps, total: 18.770, sample: 1.001, forward: 0.485, backward: 8.857, update: 0.375
[proc 1] 300 steps, total: 18.770, sample: 1.139, forward: 0.464, backward: 9.124, update: 0.396
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.646 ms                  | 85.155 ms                 |
| Forward                   | 4.784 ms                  | 9.143 ms                  |
| Backward                  | 130.608 ms                | 212.507 ms                |
| Optimize                  | 38.265 ms                 | 63.745 ms                 |
| BarrierTimeBeforeRank0    | 39.176 us                 | 74.365 us                 |
| BlockToStepN              | 21.334 us                 | 10.227 ms                 |
| OneStep                   | 182.011 ms                | 297.703 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.673 ms                  | 84.712 ms                 |
| Forward                   | 4.789 ms                  | 7.707 ms                  |
| Backward                  | 130.706 ms                | 209.184 ms                |
| Optimize                  | 38.385 ms                 | 61.964 ms                 |
| BarrierTimeBeforeRank0    | 39.752 us                 | 73.955 us                 |
| BlockToStepN              | 21.023 us                 | 10.227 ms                 |
| OneStep                   | 182.680 ms                | 289.172 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.697 ms                  | 84.712 ms                 |
| Forward                   | 4.789 ms                  | 7.707 ms                  |
| Backward                  | 130.771 ms                | 209.184 ms                |
| Optimize                  | 38.371 ms                 | 61.964 ms                 |
| BarrierTimeBeforeRank0    | 40.176 us                 | 73.955 us                 |
| BlockToStepN              | 21.023 us                 | 11.674 ms                 |
| OneStep                   | 182.751 ms                | 289.172 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 19.047, sample: 1.126, forward: 0.496, backward: 13.364, update: 3.904
[proc 3] 400 steps, total: 19.047, sample: 1.040, forward: 0.475, backward: 8.953, update: 0.374
[proc 1] 400 steps, total: 19.047, sample: 0.998, forward: 0.481, backward: 9.251, update: 0.423
[proc 2] 400 steps, total: 19.047, sample: 1.019, forward: 0.496, backward: 8.933, update: 0.414
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.697 ms                  | 85.155 ms                 |
| Forward                   | 4.808 ms                  | 7.707 ms                  |
| Backward                  | 131.227 ms                | 209.184 ms                |
| Optimize                  | 38.385 ms                 | 61.964 ms                 |
| BarrierTimeBeforeRank0    | 40.557 us                 | 74.365 us                 |
| BlockToStepN              | 21.023 us                 | 13.522 ms                 |
| OneStep                   | 182.680 ms                | 289.172 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.716 ms                  | 89.039 ms                 |
| Forward                   | 4.808 ms                  | 7.707 ms                  |
| Backward                  | 130.720 ms                | 209.184 ms                |
| Optimize                  | 38.371 ms                 | 61.964 ms                 |
| BarrierTimeBeforeRank0    | 40.750 us                 | 74.365 us                 |
| BlockToStepN              | 20.780 us                 | 13.522 ms                 |
| OneStep                   | 181.926 ms                | 289.172 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.733 ms                  | 85.155 ms                 |
| Forward                   | 4.834 ms                  | 7.694 ms                  |
| Backward                  | 130.720 ms                | 193.658 ms                |
| Optimize                  | 38.380 ms                 | 60.411 ms                 |
| BarrierTimeBeforeRank0    | 40.711 us                 | 74.365 us                 |
| BlockToStepN              | 20.770 us                 | 11.674 ms                 |
| OneStep                   | 181.540 ms                | 283.038 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.657 ms                  | 85.155 ms                 |
| Forward                   | 4.845 ms                  | 7.694 ms                  |
| Backward                  | 130.756 ms                | 193.658 ms                |
| Optimize                  | 38.429 ms                 | 61.964 ms                 |
| BarrierTimeBeforeRank0    | 40.810 us                 | 74.365 us                 |
| BlockToStepN              | 20.784 us                 | 13.522 ms                 |
| OneStep                   | 181.470 ms                | 285.465 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 18.689, sample: 0.975, forward: 0.492, backward: 9.117, update: 0.413
[proc 0] 500 steps, total: 18.689, sample: 1.031, forward: 0.528, backward: 13.150, update: 3.862
[proc 2] 500 steps, total: 18.689, sample: 0.948, forward: 0.502, backward: 8.822, update: 0.407
[proc 3] 500 steps, total: 18.689, sample: 0.907, forward: 0.490, backward: 8.940, update: 0.398
Successfully xmh. training takes 97.59008979797363 seconds
before call kg_cache_controller.StopThreads()
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads
INFO [6123 controller_process.py:421] call rank0 to StopThreads

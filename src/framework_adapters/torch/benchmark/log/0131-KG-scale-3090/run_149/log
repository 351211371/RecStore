WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240205 21:27:45.997140  4960 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_35', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=3, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=3, gpu=[0, 1, 2], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownShardedCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [4960 sampler.py:454] Start PreSampling
WARNING [4960 sampler.py:532] Before construct renumbering_dict
WARNING [4960 sampler.py:555] PreSampling done
W20240205 21:27:49.703398  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240205 21:27:49.703652  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240205 21:27:49.703687  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240205 21:27:49.703711  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240205 21:27:49.703740  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240205 21:27:49.703784  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240205 21:27:49.703809  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240205 21:27:49.703850  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240205 21:27:49.703881  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240205 21:27:49.703922  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240205 21:27:49.703956  4960 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240205 21:27:49.703981  4960 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240205 21:27:49.704001  4960 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240205 21:27:49.704155  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240205 21:27:49.704192  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240205 21:27:49.704216  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240205 21:27:49.704248  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240205 21:27:49.704278  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240205 21:27:49.704313  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240205 21:27:49.704339  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240205 21:27:49.704372  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240205 21:27:49.704396  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240205 21:27:49.704424  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240205 21:27:49.704453  4960 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240205 21:27:49.704473  4960 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240205 21:27:49.704497  4960 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240205 21:27:49.704541  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240205 21:27:49.704581  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240205 21:27:49.704607  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240205 21:27:49.704627  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240205 21:27:49.704648  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240205 21:27:49.704668  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240205 21:27:49.704695  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240205 21:27:49.704716  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240205 21:27:49.704736  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240205 21:27:49.704759  4960 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240205 21:27:49.704787  4960 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240205 21:27:49.704805  4960 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240205 21:27:49.704826  4960 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240205 21:27:49.944180  4960 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x10000e52e000 22.81 MB
W20240205 21:27:49.974566  4960 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10000fc00000 58.4 kB
{0: Graph(num_nodes=11088, num_edges=209563,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=12469, num_edges=203028,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=11122, num_edges=307147,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 11088 N 209563 E
MertisPartition: part 1 has 12469 N 203028 E
MertisPartition: part 2 has 11122 N 307147 E
Rank0: cached key size 249
Rank1: cached key size 249
Rank2: cached key size 249
Before renumbering graph:  {'_ID': tensor([   7,   10,   16,  ..., 9100, 2559, 8058]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([1006, 1103, 1326,  ..., 6748, 8584, 4666]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=11088, num_edges=209563,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=11088, num_edges=209563,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 4.013 seconds
[Rank1] pid = 5165
INFO [4960 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [5229 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [5165 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [4960 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [5229 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [5165 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
WARNING [4960 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [5229 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [5165 DistTensor.py:59] The tensor name already exists in the kvstore
I20240205 21:27:51.733412  5230 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 3
I20240205 21:27:51.733486  5166 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
I20240205 21:27:51.733556  5231 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
E20240205 21:27:52.059937  5231 recstore.cc:66] init folly done
E20240205 21:27:52.059937  5166 recstore.cc:66] init folly done
E20240205 21:27:52.060017  5230 recstore.cc:66] init folly done
I20240205 21:27:52.159237  5230 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 3
I20240205 21:27:52.186729  5166 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
I20240205 21:27:52.213629  5231 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.881 ms                  | 25.006 ms                 |
| bucket keys               | 1.899 ms                  | 123.199 ms                |
| forward: a2a keys         | 917.399 us                | 765.266 ms                |
| forward: search cache     | 182.038 us                | 25.270 ms                 |
| forward: a2a values       | 1.352 ms                  | 2.847 ms                  |
| forward: join             | 3.030 ms                  | 6.420 ms                  |
| Forward                   | 23.726 ms                 | 1.210 s                   |
| back: aggr dram keys      | 32.648 ms                 | 265.960 ms                |
| back: set dram grad       | 2.989 ms                  | 7.369 ms                  |
| back: a2a grad            | 2.813 ms                  | 4.731 ms                  |
| back: grad sum & grad cache  | 2.252 ms                  | 5.040 ms                  |
| Backward                  | 82.243 ms                 | 485.407 ms                |
| Optimize                  | 24.743 ms                 | 56.806 ms                 |
| BarrierTimeBeforeRank0    | 58.612 us                 | 102.986 us                |
| BlockToStepN              | 18.015 us                 | 27.116 us                 |
| OneStep                   | 137.346 ms                | 1.754 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.881 ms                  | 26.684 ms                 |
| bucket keys               | 1.847 ms                  | 4.659 ms                  |
| forward: a2a keys         | 878.394 us                | 18.998 ms                 |
| forward: search cache     | 184.481 us                | 621.514 us                |
| forward: a2a values       | 1.352 ms                  | 2.847 ms                  |
| forward: join             | 3.022 ms                  | 6.420 ms                  |
| Forward                   | 23.726 ms                 | 37.685 ms                 |
| back: aggr dram keys      | 32.491 ms                 | 43.533 ms                 |
| back: set dram grad       | 3.053 ms                  | 6.666 ms                  |
| back: a2a grad            | 2.797 ms                  | 4.526 ms                  |
| back: grad sum & grad cache  | 2.192 ms                  | 5.040 ms                  |
| Backward                  | 82.752 ms                 | 92.300 ms                 |
| Optimize                  | 25.113 ms                 | 46.585 ms                 |
| BarrierTimeBeforeRank0    | 56.602 us                 | 113.179 us                |
| BlockToStepN              | 17.742 us                 | 141.093 us                |
| OneStep                   | 137.346 ms                | 179.122 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.881 ms                  | 26.684 ms                 |
| bucket keys               | 1.847 ms                  | 3.515 ms                  |
| forward: a2a keys         | 885.414 us                | 8.052 ms                  |
| forward: search cache     | 183.845 us                | 300.250 us                |
| forward: a2a values       | 1.352 ms                  | 2.847 ms                  |
| forward: join             | 3.034 ms                  | 6.307 ms                  |
| Forward                   | 23.659 ms                 | 37.685 ms                 |
| back: aggr dram keys      | 32.491 ms                 | 42.948 ms                 |
| back: set dram grad       | 3.013 ms                  | 6.666 ms                  |
| back: a2a grad            | 2.803 ms                  | 4.429 ms                  |
| back: grad sum & grad cache  | 2.192 ms                  | 5.033 ms                  |
| Backward                  | 80.940 ms                 | 93.565 ms                 |
| Optimize                  | 25.471 ms                 | 46.585 ms                 |
| BarrierTimeBeforeRank0    | 54.165 us                 | 113.179 us                |
| BlockToStepN              | 17.479 us                 | 150.006 us                |
| OneStep                   | 135.583 ms                | 179.122 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 15.351, sample: 0.426, forward: 3.614, backward: 8.432, update: 0.404
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 15.324, sample: 0.450, forward: 3.582, backward: 8.470, update: 0.510
[Rank2] pid = 5229
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownShardedCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241)]
train_sampler.Prefill()
-------Step 0-------
tensor([   26,  9048,  9603,   150,    95,  9924,  5383,  6339,  6962, 12253]) tensor([ 1326,  3202, 13110,  6493,  8781,  8601,   461,  5634,  4326, 13151])
-------Step 1-------
tensor([   26,  9048,  9603,   150,    95,  9924,  5383,  6339,  6962, 12253]) tensor([ 6690,  7600,  6621, 13970,  5396,  5320,  1431, 11433,  4109,  2711])
-------Step 2-------
tensor([  223,  1616,  9559,   210,  6531,  2992,    36,  2904, 12601,  9764]) tensor([ 4453,  6898, 12792,  6514,  6436, 12063,  8822,   988,  1790,  7376])
-------Step 3-------
tensor([  223,  1616,  9559,   210,  6531,  2992,    36,  2904, 12601,  9764]) tensor([ 7227, 13172,  8260,  2183,  8922,  1929,  3446,  4684,  1004, 14868])
-------Step 4-------
tensor([14615, 14397,    41,  7388,  9085,  2038,   189,   124,   151,  5978]) tensor([ 2202,  4984, 10040,  6579, 12567,  6823, 12582,   719,   369,  3542])
-------Step 5-------
tensor([14615, 14397,    41,  7388,  9085,  2038,   189,   124,   151,  5978]) tensor([ 3906, 14347,  8538,  5650, 13041, 13996,   107, 14119, 11513,  2059])
-------Step 6-------
tensor([12402,  4708, 10942,   168, 14244,  2614, 14586, 12777,  9250,   757]) tensor([ 2653,  8667, 14107,  6250, 13206,  5459,  4835,  6070,  2492, 12653])
-------Step 7-------
tensor([12402,  4708, 10942,   168, 14244,  2614, 14586, 12777,  9250,   757]) tensor([13654,  7532,  9466,   669, 10706,  8447,  1646,  2684,  7954,   980])
-------Step 8-------
tensor([ 4500,   203,  6452,  1395, 13521,   888,    46,  7830,  2118,  9404]) tensor([ 4853,  8757,   215, 11195,  8588,  3702,  5978,  6767,  7893, 13949])
-------Step 9-------
tensor([ 4500,   203,  6452,  1395, 13521,   888,    46,  7830,  2118,  9404]) tensor([11687,  4557,  8515,   321,  3350,  9509,  1583,  3969,  5993,  5518])
before start barrier
start train
[proc 0] 100 steps, total: 15.378, sample: 0.473, forward: 3.613, backward: 8.540, update: 2.596
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 27.512 ms                 |
| bucket keys               | 1.855 ms                  | 3.362 ms                  |
| forward: a2a keys         | 875.973 us                | 7.892 ms                  |
| forward: search cache     | 185.172 us                | 278.728 us                |
| forward: a2a values       | 1.347 ms                  | 2.600 ms                  |
| forward: join             | 3.041 ms                  | 4.181 ms                  |
| Forward                   | 23.582 ms                 | 37.685 ms                 |
| back: aggr dram keys      | 31.747 ms                 | 42.577 ms                 |
| back: set dram grad       | 3.015 ms                  | 6.666 ms                  |
| back: a2a grad            | 2.759 ms                  | 3.714 ms                  |
| back: grad sum & grad cache  | 2.192 ms                  | 3.930 ms                  |
| Backward                  | 81.212 ms                 | 93.565 ms                 |
| Optimize                  | 25.113 ms                 | 46.585 ms                 |
| BarrierTimeBeforeRank0    | 51.188 us                 | 113.179 us                |
| BlockToStepN              | 16.863 us                 | 150.006 us                |
| OneStep                   | 135.467 ms                | 179.122 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.927 ms                  | 26.684 ms                 |
| bucket keys               | 1.859 ms                  | 3.362 ms                  |
| forward: a2a keys         | 875.973 us                | 7.892 ms                  |
| forward: search cache     | 185.738 us                | 278.728 us                |
| forward: a2a values       | 1.346 ms                  | 2.600 ms                  |
| forward: join             | 3.037 ms                  | 5.768 ms                  |
| Forward                   | 23.532 ms                 | 35.101 ms                 |
| back: aggr dram keys      | 29.699 ms                 | 42.577 ms                 |
| back: set dram grad       | 3.032 ms                  | 6.666 ms                  |
| back: a2a grad            | 2.767 ms                  | 3.714 ms                  |
| back: grad sum & grad cache  | 2.182 ms                  | 3.930 ms                  |
| Backward                  | 81.205 ms                 | 92.300 ms                 |
| Optimize                  | 25.483 ms                 | 37.157 ms                 |
| BarrierTimeBeforeRank0    | 51.188 us                 | 102.986 us                |
| BlockToStepN              | 16.605 us                 | 141.093 us                |
| OneStep                   | 135.583 ms                | 178.527 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 200 steps, total: 13.776, sample: 0.475, forward: 2.415, backward: 8.083, update: 0.459
[proc 1] 200 steps, total: 13.776, sample: 0.456, forward: 2.438, backward: 8.086, update: 0.357
[proc 0] 200 steps, total: 13.776, sample: 0.540, forward: 2.386, backward: 8.169, update: 2.573
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.905 ms                  | 29.114 ms                 |
| bucket keys               | 1.856 ms                  | 3.268 ms                  |
| forward: a2a keys         | 871.742 us                | 8.052 ms                  |
| forward: search cache     | 185.172 us                | 254.508 us                |
| forward: a2a values       | 1.314 ms                  | 1.762 ms                  |
| forward: join             | 3.041 ms                  | 4.292 ms                  |
| Forward                   | 23.517 ms                 | 50.550 ms                 |
| back: aggr dram keys      | 29.670 ms                 | 41.683 ms                 |
| back: set dram grad       | 3.039 ms                  | 6.485 ms                  |
| back: a2a grad            | 2.767 ms                  | 3.714 ms                  |
| back: grad sum & grad cache  | 2.182 ms                  | 3.930 ms                  |
| Backward                  | 81.205 ms                 | 92.300 ms                 |
| Optimize                  | 25.471 ms                 | 37.375 ms                 |
| BarrierTimeBeforeRank0    | 50.161 us                 | 113.179 us                |
| BlockToStepN              | 16.604 us                 | 150.006 us                |
| OneStep                   | 135.833 ms                | 178.527 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 31.166 ms                 |
| bucket keys               | 1.863 ms                  | 3.200 ms                  |
| forward: a2a keys         | 870.386 us                | 22.103 ms                 |
| forward: search cache     | 184.744 us                | 254.508 us                |
| forward: a2a values       | 1.312 ms                  | 1.700 ms                  |
| forward: join             | 3.037 ms                  | 4.292 ms                  |
| Forward                   | 23.499 ms                 | 50.550 ms                 |
| back: aggr dram keys      | 28.790 ms                 | 41.683 ms                 |
| back: set dram grad       | 3.033 ms                  | 6.122 ms                  |
| back: a2a grad            | 2.774 ms                  | 3.618 ms                  |
| back: grad sum & grad cache  | 2.182 ms                  | 3.743 ms                  |
| Backward                  | 80.940 ms                 | 92.300 ms                 |
| Optimize                  | 25.366 ms                 | 37.375 ms                 |
| BarrierTimeBeforeRank0    | 49.747 us                 | 131.321 us                |
| BlockToStepN              | 16.630 us                 | 150.006 us                |
| OneStep                   | 135.833 ms                | 178.527 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 29.114 ms                 |
| bucket keys               | 1.863 ms                  | 3.128 ms                  |
| forward: a2a keys         | 870.026 us                | 22.824 ms                 |
| forward: search cache     | 183.798 us                | 254.508 us                |
| forward: a2a values       | 1.310 ms                  | 1.700 ms                  |
| forward: join             | 3.036 ms                  | 5.768 ms                  |
| Forward                   | 23.517 ms                 | 47.683 ms                 |
| back: aggr dram keys      | 28.790 ms                 | 41.883 ms                 |
| back: set dram grad       | 3.029 ms                  | 6.122 ms                  |
| back: a2a grad            | 2.762 ms                  | 3.618 ms                  |
| back: grad sum & grad cache  | 2.182 ms                  | 3.743 ms                  |
| Backward                  | 80.779 ms                 | 92.300 ms                 |
| Optimize                  | 25.320 ms                 | 37.157 ms                 |
| BarrierTimeBeforeRank0    | 49.424 us                 | 122.238 us                |
| BlockToStepN              | 16.669 us                 | 141.093 us                |
| OneStep                   | 135.833 ms                | 173.699 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 300 steps, total: 13.931, sample: 0.397, forward: 2.737, backward: 8.020, update: 0.298
[proc 0] 300 steps, total: 13.931, sample: 0.494, forward: 2.675, backward: 8.107, update: 2.558
[proc 2] 300 steps, total: 13.931, sample: 0.471, forward: 2.662, backward: 8.019, update: 0.462
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.881 ms                  | 29.252 ms                 |
| bucket keys               | 1.864 ms                  | 3.200 ms                  |
| forward: a2a keys         | 863.147 us                | 24.145 ms                 |
| forward: search cache     | 182.482 us                | 263.061 us                |
| forward: a2a values       | 1.300 ms                  | 2.289 ms                  |
| forward: join             | 3.034 ms                  | 5.768 ms                  |
| Forward                   | 23.557 ms                 | 52.003 ms                 |
| back: aggr dram keys      | 28.854 ms                 | 41.883 ms                 |
| back: set dram grad       | 3.029 ms                  | 6.122 ms                  |
| back: a2a grad            | 2.758 ms                  | 3.581 ms                  |
| back: grad sum & grad cache  | 2.162 ms                  | 3.743 ms                  |
| Backward                  | 80.706 ms                 | 92.794 ms                 |
| Optimize                  | 25.320 ms                 | 37.157 ms                 |
| BarrierTimeBeforeRank0    | 49.033 us                 | 131.321 us                |
| BlockToStepN              | 16.669 us                 | 141.093 us                |
| OneStep                   | 136.237 ms                | 173.699 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 29.252 ms                 |
| bucket keys               | 1.864 ms                  | 3.268 ms                  |
| forward: a2a keys         | 862.326 us                | 24.776 ms                 |
| forward: search cache     | 182.038 us                | 255.590 us                |
| forward: a2a values       | 1.307 ms                  | 1.860 ms                  |
| forward: join             | 3.030 ms                  | 4.524 ms                  |
| Forward                   | 23.517 ms                 | 52.003 ms                 |
| back: aggr dram keys      | 28.854 ms                 | 42.274 ms                 |
| back: set dram grad       | 3.029 ms                  | 6.122 ms                  |
| back: a2a grad            | 2.758 ms                  | 3.581 ms                  |
| back: grad sum & grad cache  | 2.162 ms                  | 3.702 ms                  |
| Backward                  | 80.706 ms                 | 92.794 ms                 |
| Optimize                  | 25.320 ms                 | 37.157 ms                 |
| BarrierTimeBeforeRank0    | 49.456 us                 | 131.321 us                |
| BlockToStepN              | 16.703 us                 | 141.093 us                |
| OneStep                   | 136.398 ms                | 173.699 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 29.114 ms                 |
| bucket keys               | 1.863 ms                  | 3.268 ms                  |
| forward: a2a keys         | 856.237 us                | 24.724 ms                 |
| forward: search cache     | 180.784 us                | 255.590 us                |
| forward: a2a values       | 1.298 ms                  | 1.762 ms                  |
| forward: join             | 3.029 ms                  | 4.513 ms                  |
| Forward                   | 23.499 ms                 | 50.550 ms                 |
| back: aggr dram keys      | 28.854 ms                 | 42.577 ms                 |
| back: set dram grad       | 3.029 ms                  | 6.034 ms                  |
| back: a2a grad            | 2.752 ms                  | 3.581 ms                  |
| back: grad sum & grad cache  | 2.162 ms                  | 3.667 ms                  |
| Backward                  | 80.779 ms                 | 92.794 ms                 |
| Optimize                  | 25.203 ms                 | 37.118 ms                 |
| BarrierTimeBeforeRank0    | 49.954 us                 | 122.238 us                |
| BlockToStepN              | 16.669 us                 | 134.331 us                |
| OneStep                   | 136.828 ms                | 172.372 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 14.138, sample: 0.430, forward: 2.885, backward: 8.072, update: 0.445
[proc 0] 400 steps, total: 14.138, sample: 0.474, forward: 2.872, backward: 8.153, update: 2.542
[proc 1] 400 steps, total: 14.138, sample: 0.421, forward: 2.901, backward: 8.065, update: 0.221
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.881 ms                  | 31.166 ms                 |
| bucket keys               | 1.858 ms                  | 3.268 ms                  |
| forward: a2a keys         | 851.361 us                | 25.722 ms                 |
| forward: search cache     | 180.341 us                | 262.004 us                |
| forward: a2a values       | 1.286 ms                  | 2.571 ms                  |
| forward: join             | 3.027 ms                  | 4.513 ms                  |
| Forward                   | 23.517 ms                 | 50.550 ms                 |
| back: aggr dram keys      | 29.342 ms                 | 42.577 ms                 |
| back: set dram grad       | 3.027 ms                  | 6.034 ms                  |
| back: a2a grad            | 2.750 ms                  | 3.618 ms                  |
| back: grad sum & grad cache  | 2.162 ms                  | 3.702 ms                  |
| Backward                  | 80.911 ms                 | 93.359 ms                 |
| Optimize                  | 24.963 ms                 | 37.118 ms                 |
| BarrierTimeBeforeRank0    | 49.456 us                 | 122.238 us                |
| BlockToStepN              | 16.669 us                 | 134.331 us                |
| OneStep                   | 136.840 ms                | 173.699 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 29.252 ms                 |
| bucket keys               | 1.855 ms                  | 3.260 ms                  |
| forward: a2a keys         | 848.225 us                | 25.722 ms                 |
| forward: search cache     | 179.613 us                | 262.004 us                |
| forward: a2a values       | 1.285 ms                  | 2.473 ms                  |
| forward: join             | 3.030 ms                  | 4.394 ms                  |
| Forward                   | 23.532 ms                 | 49.892 ms                 |
| back: aggr dram keys      | 29.562 ms                 | 42.274 ms                 |
| back: set dram grad       | 3.026 ms                  | 6.034 ms                  |
| back: a2a grad            | 2.735 ms                  | 3.581 ms                  |
| back: grad sum & grad cache  | 2.159 ms                  | 3.667 ms                  |
| Backward                  | 80.940 ms                 | 92.794 ms                 |
| Optimize                  | 25.018 ms                 | 36.990 ms                 |
| BarrierTimeBeforeRank0    | 49.425 us                 | 113.179 us                |
| BlockToStepN              | 16.805 us                 | 131.667 us                |
| OneStep                   | 136.761 ms                | 172.372 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 29.252 ms                 |
| bucket keys               | 1.855 ms                  | 3.260 ms                  |
| forward: a2a keys         | 847.252 us                | 25.919 ms                 |
| forward: search cache     | 179.327 us                | 259.978 us                |
| forward: a2a values       | 1.281 ms                  | 2.289 ms                  |
| forward: join             | 3.024 ms                  | 4.335 ms                  |
| Forward                   | 23.517 ms                 | 50.550 ms                 |
| back: aggr dram keys      | 29.342 ms                 | 42.274 ms                 |
| back: set dram grad       | 3.024 ms                  | 6.034 ms                  |
| back: a2a grad            | 2.729 ms                  | 3.618 ms                  |
| back: grad sum & grad cache  | 2.159 ms                  | 3.652 ms                  |
| Backward                  | 80.809 ms                 | 92.794 ms                 |
| Optimize                  | 25.065 ms                 | 37.018 ms                 |
| BarrierTimeBeforeRank0    | 49.627 us                 | 113.179 us                |
| BlockToStepN              | 16.872 us                 | 134.331 us                |
| OneStep                   | 136.840 ms                | 172.372 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 14.040, sample: 0.442, forward: 2.866, backward: 8.066, update: 0.439
[proc 2] 500 steps, total: 14.040, sample: 0.432, forward: 2.876, backward: 8.053, update: 0.467
[proc 0] 500 steps, total: 14.040, sample: 0.487, forward: 2.858, backward: 8.121, update: 2.476
Successfully xmh. training takes 71.26423454284668 seconds
before call kg_cache_controller.StopThreads()
INFO [4960 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
INFO [4960 controller_process.py:421] call rank0 to StopThreads
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.884 ms                  | 29.252 ms                 |
| bucket keys               | 1.854 ms                  | 3.268 ms                  |
| forward: a2a keys         | 847.252 us                | 26.319 ms                 |
| forward: search cache     | 179.231 us                | 259.978 us                |
| forward: a2a values       | 1.283 ms                  | 2.289 ms                  |
| forward: join             | 3.024 ms                  | 4.335 ms                  |
| Forward                   | 23.532 ms                 | 50.550 ms                 |
| back: aggr dram keys      | 29.562 ms                 | 42.274 ms                 |
| back: set dram grad       | 3.025 ms                  | 6.034 ms                  |
| back: a2a grad            | 2.730 ms                  | 3.618 ms                  |
| back: grad sum & grad cache  | 2.159 ms                  | 3.652 ms                  |
| Backward                  | 80.809 ms                 | 92.794 ms                 |
| Optimize                  | 24.963 ms                 | 37.018 ms                 |
| BarrierTimeBeforeRank0    | 49.627 us                 | 113.179 us                |
| BlockToStepN              | 16.939 us                 | 134.331 us                |
| OneStep                   | 136.840 ms                | 172.372 ms                |
+---------------------------+---------------------------+---------------------------+

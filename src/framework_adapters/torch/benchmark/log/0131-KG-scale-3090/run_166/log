WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240205 22:00:00.217100 38853 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_FB15k_52', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [38853 sampler.py:454] Start PreSampling
WARNING [38853 sampler.py:532] Before construct renumbering_dict
WARNING [38853 sampler.py:555] PreSampling done
W20240205 22:00:04.910496 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240205 22:00:04.910714 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240205 22:00:04.910774 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240205 22:00:04.910830 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240205 22:00:04.910877 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240205 22:00:04.910930 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240205 22:00:04.910974 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240205 22:00:04.911039 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240205 22:00:04.911095 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240205 22:00:04.911152 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240205 22:00:04.911212 38853 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240205 22:00:04.911259 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240205 22:00:04.911309 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240205 22:00:04.911520 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240205 22:00:04.911579 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240205 22:00:04.911624 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240205 22:00:04.911680 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240205 22:00:04.911723 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240205 22:00:04.911774 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240205 22:00:04.911825 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240205 22:00:04.911881 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240205 22:00:04.911932 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240205 22:00:04.911984 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240205 22:00:04.912040 38853 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240205 22:00:04.912087 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240205 22:00:04.912125 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240205 22:00:04.912215 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240205 22:00:04.912276 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240205 22:00:04.912321 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240205 22:00:04.912364 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240205 22:00:04.912408 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240205 22:00:04.912452 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240205 22:00:04.912504 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240205 22:00:04.912559 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240205 22:00:04.912616 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240205 22:00:04.912667 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240205 22:00:04.912712 38853 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240205 22:00:04.912750 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240205 22:00:04.912792 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240205 22:00:04.912873 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240205 22:00:04.912918 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240205 22:00:04.912963 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240205 22:00:04.913014 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240205 22:00:04.913059 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240205 22:00:04.913110 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240205 22:00:04.913164 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240205 22:00:04.913218 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240205 22:00:04.913273 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240205 22:00:04.913328 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240205 22:00:04.913372 38853 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240205 22:00:04.913411 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240205 22:00:04.913450 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240205 22:00:04.913542 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240205 22:00:04.913601 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240205 22:00:04.913648 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240205 22:00:04.913699 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240205 22:00:04.913756 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240205 22:00:04.913815 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240205 22:00:04.913875 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240205 22:00:04.913937 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240205 22:00:04.913995 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240205 22:00:04.914041 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240205 22:00:04.914095 38853 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240205 22:00:04.914134 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240205 22:00:04.914173 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240205 22:00:04.914255 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240205 22:00:04.914321 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240205 22:00:04.914371 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240205 22:00:04.914419 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240205 22:00:04.914474 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240205 22:00:04.914520 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240205 22:00:04.914569 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240205 22:00:04.914629 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240205 22:00:04.914675 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240205 22:00:04.914732 38853 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240205 22:00:04.914778 38853 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240205 22:00:04.914817 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240205 22:00:04.914862 38853 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240205 22:00:05.176226 38853 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x10001ca5a000 22.81 MB
W20240205 22:00:05.269443 38853 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x10001e12c000 58.4 kB
{0: Graph(num_nodes=9651, num_edges=125221,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=10501, num_edges=116771,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=7364, num_edges=103565,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=9587, num_edges=131823,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=8718, num_edges=169929,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=9639, num_edges=154972,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9651 N 125221 E
MertisPartition: part 1 has 10501 N 116771 E
MertisPartition: part 2 has 7364 N 103565 E
MertisPartition: part 3 has 9587 N 131823 E
MertisPartition: part 4 has 8718 N 169929 E
MertisPartition: part 5 has 9639 N 154972 E
Rank0: cached key size 124
Rank1: cached key size 124
Rank2: cached key size 124
Rank3: cached key size 124
Rank4: cached key size 124
Rank5: cached key size 124
Before renumbering graph:  {'_ID': tensor([    7,    16,    24,  ..., 10345,  3788,  5916]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
After renumbering graph:  {'_ID': tensor([ 932, 1212, 1406,  ..., 2679, 1970, 9762]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9651, num_edges=125221,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.149 seconds
[Rank1] pid = 39059
[Rank2] pid = 39123
[Rank3] pid = 39187
[Rank4] pid = 39218
INFO [38853 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [39059 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [39123 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [39187 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [38853 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [39258 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [39218 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [39123 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [39059 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [39187 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [39218 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [39258 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
WARNING [38853 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [39123 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [39258 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [39187 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [39218 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [39059 DistTensor.py:59] The tensor name already exists in the kvstore
I20240205 22:00:07.531630 39379 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240205 22:00:07.531764 39188 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240205 22:00:07.531898 39060 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240205 22:00:07.532004 39316 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240205 22:00:07.532151 39124 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240205 22:00:07.532289 39252 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
E20240205 22:00:08.154489 39316 recstore.cc:66] init folly done
E20240205 22:00:08.154489 39188 recstore.cc:66] init folly done
E20240205 22:00:08.154490 39060 recstore.cc:66] init folly done
E20240205 22:00:08.154492 39252 recstore.cc:66] init folly done
E20240205 22:00:08.154503 39379 recstore.cc:66] init folly done
E20240205 22:00:08.154567 39124 recstore.cc:66] init folly done
I20240205 22:00:08.239892 39124 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
I20240205 22:00:08.242452 39060 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240205 22:00:08.244880 39379 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240205 22:00:08.247339 39188 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240205 22:00:08.247442 39316 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240205 22:00:08.251840 39252 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.278 ms                  | 36.716 ms                 |
| Forward                   | 13.537 ms                 | 448.286 ms                |
| Backward                  | 152.527 ms                | 405.125 ms                |
| Optimize                  | 7.490 ms                  | 46.949 ms                 |
| BarrierTimeBeforeRank0    | 4.723 ms                  | 24.337 ms                 |
| BlockToStepN              | 34.153 us                 | 315.358 us                |
| OneStep                   | 182.389 ms                | 927.217 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.932 ms                  | 36.716 ms                 |
| Forward                   | 11.901 ms                 | 448.286 ms                |
| Backward                  | 150.972 ms                | 405.125 ms                |
| Optimize                  | 5.462 ms                  | 46.949 ms                 |
| BarrierTimeBeforeRank0    | 5.804 ms                  | 24.337 ms                 |
| BlockToStepN              | 32.948 us                 | 315.358 us                |
| OneStep                   | 181.419 ms                | 927.217 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.938 ms                  | 35.821 ms                 |
| Forward                   | 12.036 ms                 | 20.246 ms                 |
| Backward                  | 155.873 ms                | 193.426 ms                |
| Optimize                  | 5.246 ms                  | 9.398 ms                  |
| BarrierTimeBeforeRank0    | 4.400 ms                  | 23.388 ms                 |
| BlockToStepN              | 30.499 us                 | 284.938 us                |
| OneStep                   | 184.055 ms                | 234.735 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.655 ms                  | 35.821 ms                 |
| Forward                   | 11.623 ms                 | 20.246 ms                 |
| Backward                  | 156.724 ms                | 193.426 ms                |
| Optimize                  | 5.013 ms                  | 9.398 ms                  |
| BarrierTimeBeforeRank0    | 6.030 ms                  | 43.528 ms                 |
| BlockToStepN              | 31.426 us                 | 284.938 us                |
| OneStep                   | 187.863 ms                | 437.583 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 19.992, sample: 0.494, forward: 1.326, backward: 15.987, update: 0.389
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 20.004, sample: 0.411, forward: 1.220, backward: 14.927, update: 0.404
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 19.996, sample: 0.536, forward: 1.411, backward: 17.226, update: 0.383
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 20.001, sample: 0.411, forward: 1.215, backward: 15.375, update: 0.320
[Rank5] pid = 39258
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735), (3735, 4482)]
train_sampler.Prefill()
-------Step 0-------
tensor([   11,  6297,  9550,   888, 13438,  6430,   119,  7065,  9566,  2897]) tensor([ 1406,   111,  4969,  7120,    70, 10315, 10699, 14317,  1425, 10785])
-------Step 1-------
tensor([   11,  6297,  9550,   888, 13438,  6430,   119,  7065,  9566,  2897]) tensor([ 7340,  4412,   378,  7649,  5517, 12707,  2231, 11662, 13074,  8427])
-------Step 2-------
tensor([ 1409,  3324, 13438,  5311,  9799, 14198,    14, 10451, 10253,  5268]) tensor([ 5310, 12763,  6436, 14377,  9149,  7026,  5356,  5031,  2029, 14301])
-------Step 3-------
tensor([ 1409,  3324, 13438,  5311,  9799, 14198,    14, 10451, 10253,  5268]) tensor([ 6489,  3550,  3358, 10118,  7869,   438,  8254,  4034,   203,  2980])
-------Step 4-------
tensor([   76,  3901,  7388,  9190,  9696,  2561, 13438,  8567,  6902, 10019]) tensor([ 2873,  3282,  2519,  1494, 12049, 13772,  8190, 10113, 14165,  3396])
-------Step 5-------
tensor([   76,  3901,  7388,  9190,  9696,  2561, 13438,  8567,  6902, 10019]) tensor([ 6292,  8939,   560, 10466,  7473,  7652, 12465,   520,  9637,  1641])
-------Step 6-------
tensor([ 6204, 12649, 13823,  2626,  4682,   131,    31, 10530,    76,   106]) tensor([10422,  6469,  2385,  8203,  1223,   457,  3786, 13513,  1801,  4150])
-------Step 7-------
tensor([ 6204, 12649, 13823,  2626,  4682,   131,    31, 10530,    76,   106]) tensor([11805,   264,  8493,  5882, 14322, 10133, 10038,  6984,  6461,  5098])
-------Step 8-------
tensor([3634, 3209, 1152,  725, 3971, 1993, 5691,  109, 8734,   31]) tensor([12433,  3047,  1713,  8506, 11331,  9218,  8116,  6725,  3690, 13729])
-------Step 9-------
tensor([3634, 3209, 1152,  725, 3971, 1993, 5691,  109, 8734,   31]) tensor([11992, 13505,  9949,  7244,  1994,  7386,   456,  6633,  4190,  2259])
before start barrier
start train
[proc 0] 100 steps, total: 19.996, sample: 0.602, forward: 1.620, backward: 15.963, update: 0.561
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 19.999, sample: 0.549, forward: 1.407, backward: 16.177, update: 0.453
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.574 ms                  | 36.716 ms                 |
| Forward                   | 11.602 ms                 | 21.439 ms                 |
| Backward                  | 158.423 ms                | 193.426 ms                |
| Optimize                  | 5.021 ms                  | 11.226 ms                 |
| BarrierTimeBeforeRank0    | 7.707 ms                  | 124.689 ms                |
| BlockToStepN              | 31.014 us                 | 284.938 us                |
| OneStep                   | 189.835 ms                | 437.583 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.406 ms                  | 36.716 ms                 |
| Forward                   | 11.476 ms                 | 21.439 ms                 |
| Backward                  | 155.119 ms                | 193.426 ms                |
| Optimize                  | 4.858 ms                  | 11.226 ms                 |
| BarrierTimeBeforeRank0    | 10.708 ms                 | 143.962 ms                |
| BlockToStepN              | 32.166 us                 | 284.938 us                |
| OneStep                   | 191.965 ms                | 437.583 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.406 ms                  | 36.716 ms                 |
| Forward                   | 11.475 ms                 | 21.273 ms                 |
| Backward                  | 156.411 ms                | 193.426 ms                |
| Optimize                  | 4.870 ms                  | 9.702 ms                  |
| BarrierTimeBeforeRank0    | 10.822 ms                 | 161.379 ms                |
| BlockToStepN              | 31.373 us                 | 192.579 us                |
| OneStep                   | 193.786 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.406 ms                  | 36.716 ms                 |
| Forward                   | 11.362 ms                 | 21.273 ms                 |
| Backward                  | 158.333 ms                | 193.426 ms                |
| Optimize                  | 5.012 ms                  | 9.702 ms                  |
| BarrierTimeBeforeRank0    | 11.011 ms                 | 177.690 ms                |
| BlockToStepN              | 31.373 us                 | 192.579 us                |
| OneStep                   | 195.604 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 200 steps, total: 21.399, sample: 0.528, forward: 0.851, backward: 17.194, update: 0.354
[proc 3] 200 steps, total: 21.399, sample: 0.630, forward: 0.910, backward: 17.080, update: 0.419
[proc 2] 200 steps, total: 21.399, sample: 0.474, forward: 0.750, backward: 15.113, update: 0.453
[proc 5] 200 steps, total: 21.399, sample: 0.595, forward: 0.947, backward: 17.475, update: 0.378
[proc 1] 200 steps, total: 21.399, sample: 0.528, forward: 0.865, backward: 16.558, update: 0.425
[proc 0] 200 steps, total: 21.399, sample: 0.603, forward: 1.143, backward: 14.672, update: 0.545
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.406 ms                  | 36.716 ms                 |
| Forward                   | 11.321 ms                 | 21.273 ms                 |
| Backward                  | 159.239 ms                | 193.426 ms                |
| Optimize                  | 5.071 ms                  | 9.702 ms                  |
| BarrierTimeBeforeRank0    | 11.087 ms                 | 177.690 ms                |
| BlockToStepN              | 31.196 us                 | 192.579 us                |
| OneStep                   | 197.846 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.494 ms                  | 40.134 ms                 |
| Forward                   | 11.321 ms                 | 21.273 ms                 |
| Backward                  | 158.721 ms                | 193.426 ms                |
| Optimize                  | 5.134 ms                  | 9.702 ms                  |
| BarrierTimeBeforeRank0    | 11.208 ms                 | 177.690 ms                |
| BlockToStepN              | 31.235 us                 | 192.579 us                |
| OneStep                   | 197.066 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.529 ms                  | 38.335 ms                 |
| Forward                   | 11.337 ms                 | 20.300 ms                 |
| Backward                  | 158.547 ms                | 193.426 ms                |
| Optimize                  | 5.170 ms                  | 9.702 ms                  |
| BarrierTimeBeforeRank0    | 11.023 ms                 | 177.690 ms                |
| BlockToStepN              | 31.184 us                 | 127.584 us                |
| OneStep                   | 196.604 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.406 ms                  | 38.335 ms                 |
| Forward                   | 11.321 ms                 | 20.300 ms                 |
| Backward                  | 158.721 ms                | 193.426 ms                |
| Optimize                  | 5.170 ms                  | 10.329 ms                 |
| BarrierTimeBeforeRank0    | 11.897 ms                 | 177.690 ms                |
| BlockToStepN              | 31.184 us                 | 127.584 us                |
| OneStep                   | 197.237 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 300 steps, total: 20.797, sample: 0.475, forward: 0.715, backward: 15.347, update: 0.402
[proc 4] 300 steps, total: 20.797, sample: 0.469, forward: 0.831, backward: 16.530, update: 0.357
[proc 5] 300 steps, total: 20.797, sample: 0.568, forward: 0.906, backward: 16.510, update: 0.392
[proc 3] 300 steps, total: 20.797, sample: 0.609, forward: 0.870, backward: 16.143, update: 0.369
[proc 0] 300 steps, total: 20.797, sample: 0.577, forward: 1.131, backward: 15.164, update: 0.618
[proc 1] 300 steps, total: 20.797, sample: 0.587, forward: 0.879, backward: 16.828, update: 0.426
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.248 ms                  | 38.335 ms                 |
| Forward                   | 11.238 ms                 | 20.300 ms                 |
| Backward                  | 158.786 ms                | 193.426 ms                |
| Optimize                  | 5.246 ms                  | 10.329 ms                 |
| BarrierTimeBeforeRank0    | 13.764 ms                 | 177.690 ms                |
| BlockToStepN              | 31.196 us                 | 192.579 us                |
| OneStep                   | 198.786 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.285 ms                  | 38.335 ms                 |
| Forward                   | 11.298 ms                 | 20.300 ms                 |
| Backward                  | 159.097 ms                | 193.426 ms                |
| Optimize                  | 5.342 ms                  | 10.329 ms                 |
| BarrierTimeBeforeRank0    | 13.540 ms                 | 177.690 ms                |
| BlockToStepN              | 31.014 us                 | 192.579 us                |
| OneStep                   | 198.590 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.313 ms                  | 37.805 ms                 |
| Forward                   | 11.293 ms                 | 20.246 ms                 |
| Backward                  | 159.710 ms                | 188.861 ms                |
| Optimize                  | 5.365 ms                  | 10.330 ms                 |
| BarrierTimeBeforeRank0    | 13.764 ms                 | 177.690 ms                |
| BlockToStepN              | 30.677 us                 | 177.628 us                |
| OneStep                   | 199.263 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.399 ms                  | 39.992 ms                 |
| Forward                   | 11.321 ms                 | 20.300 ms                 |
| Backward                  | 159.998 ms                | 188.861 ms                |
| Optimize                  | 5.411 ms                  | 10.658 ms                 |
| BarrierTimeBeforeRank0    | 12.723 ms                 | 177.690 ms                |
| BlockToStepN              | 30.642 us                 | 177.628 us                |
| OneStep                   | 199.102 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 5] 400 steps, total: 21.031, sample: 0.527, forward: 0.921, backward: 17.081, update: 0.376
[proc 1] 400 steps, total: 21.031, sample: 0.557, forward: 0.825, backward: 16.558, update: 0.418
[proc 3] 400 steps, total: 21.031, sample: 0.523, forward: 0.860, backward: 16.222, update: 0.417
[proc 0] 400 steps, total: 21.031, sample: 0.682, forward: 1.187, backward: 16.457, update: 0.635
[proc 4] 400 steps, total: 21.031, sample: 0.469, forward: 0.768, backward: 16.258, update: 0.311
[proc 2] 400 steps, total: 21.031, sample: 0.536, forward: 0.826, backward: 15.799, update: 0.442
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.330 ms                  | 39.992 ms                 |
| Forward                   | 11.298 ms                 | 20.300 ms                 |
| Backward                  | 160.184 ms                | 188.861 ms                |
| Optimize                  | 5.386 ms                  | 11.226 ms                 |
| BarrierTimeBeforeRank0    | 13.459 ms                 | 177.690 ms                |
| BlockToStepN              | 30.582 us                 | 177.650 us                |
| OneStep                   | 199.966 ms                | 389.499 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.248 ms                  | 39.992 ms                 |
| Forward                   | 11.233 ms                 | 20.300 ms                 |
| Backward                  | 160.631 ms                | 193.426 ms                |
| Optimize                  | 5.386 ms                  | 11.226 ms                 |
| BarrierTimeBeforeRank0    | 13.917 ms                 | 206.381 ms                |
| BlockToStepN              | 30.480 us                 | 177.650 us                |
| OneStep                   | 200.862 ms                | 409.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.313 ms                  | 39.992 ms                 |
| Forward                   | 11.220 ms                 | 20.300 ms                 |
| Backward                  | 160.665 ms                | 193.426 ms                |
| Optimize                  | 5.462 ms                  | 11.226 ms                 |
| BarrierTimeBeforeRank0    | 13.937 ms                 | 219.347 ms                |
| BlockToStepN              | 30.480 us                 | 177.650 us                |
| OneStep                   | 201.120 ms                | 409.835 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.316 ms                  | 39.361 ms                 |
| Forward                   | 11.220 ms                 | 20.246 ms                 |
| Backward                  | 160.631 ms                | 188.861 ms                |
| Optimize                  | 5.487 ms                  | 10.941 ms                 |
| BarrierTimeBeforeRank0    | 13.917 ms                 | 206.381 ms                |
| BlockToStepN              | 30.546 us                 | 177.628 us                |
| OneStep                   | 201.441 ms                | 393.416 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.285 ms                  | 39.361 ms                 |
| Forward                   | 11.215 ms                 | 20.246 ms                 |
| Backward                  | 160.850 ms                | 188.861 ms                |
| Optimize                  | 5.530 ms                  | 11.226 ms                 |
| BarrierTimeBeforeRank0    | 14.233 ms                 | 206.381 ms                |
| BlockToStepN              | 30.506 us                 | 177.628 us                |
| OneStep                   | 202.016 ms                | 393.416 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 500 steps, total: 21.675, sample: 0.521, forward: 0.845, backward: 16.949, update: 0.422
[proc 2] 500 steps, total: 21.674, sample: 0.440, forward: 0.765, backward: 15.659, update: 0.388
[proc 4] 500 steps, total: 21.674, sample: 0.493, forward: 0.833, backward: 17.007, update: 0.324
[proc 5] 500 steps, total: 21.675, sample: 0.553, forward: 0.929, backward: 17.427, update: 0.425
[proc 3] 500 steps, total: 21.675, sample: 0.504, forward: 0.887, backward: 16.773, update: 0.413
[proc 0] 500 steps, total: 21.675, sample: 0.571, forward: 1.070, backward: 16.439, update: 0.664
Successfully xmh. training takes 104.89790105819702 seconds
before call kg_cache_controller.StopThreads()
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
INFO [38853 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker5: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)

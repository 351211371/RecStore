WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240203 15:49:24.218225 34770 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_68', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=2, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=2, gpu=[0, 1], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [34770 sampler.py:454] Start PreSampling
WARNING [34770 sampler.py:532] Before construct renumbering_dict
WARNING [34770 sampler.py:555] PreSampling done
W20240203 16:08:31.461171 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240203 16:08:31.461401 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240203 16:08:31.461443 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240203 16:08:31.461477 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240203 16:08:31.461524 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240203 16:08:31.461561 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240203 16:08:31.461592 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240203 16:08:31.461635 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240203 16:08:31.461671 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240203 16:08:31.461702 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240203 16:08:31.461745 34770 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240203 16:08:31.461776 34770 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240203 16:08:31.461804 34770 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240203 16:08:31.461953 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240203 16:08:31.461995 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240203 16:08:31.462023 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240203 16:08:31.462069 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240203 16:08:31.462097 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240203 16:08:31.462124 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240203 16:08:31.462157 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240203 16:08:31.462188 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240203 16:08:31.462216 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240203 16:08:31.462250 34770 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240203 16:08:31.462277 34770 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240203 16:08:31.462301 34770 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240203 16:08:31.462327 34770 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240203 16:08:31.881175 34770 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x1000098ca000 128.2 GB
W20240203 16:17:13.559206 34770 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102018502000 328.3 MB
{0: Graph(num_nodes=43196088, num_edges=182879791,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=47371617, num_edges=163853044,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 43196088 N 182879791 E
MertisPartition: part 1 has 47371617 N 163853044 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 24862891, 27748820, 20932263]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4302709,  4302725,   792013,  ..., 26499755, 27233102, 77732597]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=43196088, num_edges=182879791,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2182.956 seconds
INFO [34770 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [60040 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [34770 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO [60040 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
W20240203 16:25:50.266592 60041 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240203 16:25:50.268587 60105 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240203 16:25:50.305819 60105 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10202cd4d000 7.629 MB
W20240203 16:25:50.305892 60041 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x10202d4f0000 7.629 MB
W20240203 16:25:50.306027 60041 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10202dc93000 7.629 MB
W20240203 16:25:50.306041 60105 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x10202e436000 7.629 MB
W20240203 16:25:50.306092 60041 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10202ebd9000 1.49 GB
W20240203 16:25:50.306125 60105 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10208e1bc000 1.49 GB
W20240203 16:25:50.306152 60041 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1020ed79f000 1.49 GB
W20240203 16:25:50.306186 60105 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10214cd82000 1.49 GB
W20240203 16:25:50.306195 60041 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240203 16:25:50.306262 60105 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240203 16:25:50.309326 60041 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240203 16:25:50.309376 60105 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x1000098ca000
1: KnownLocalCachedEmbedding init done
WARNING [60040 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank1] pid = 60040
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414)]
cudaHostRegister 0x1000098ca000
0: KnownLocalCachedEmbedding init done
WARNING [34770 DistTensor.py:59] The tensor name already exists in the kvstore
I20240203 16:26:13.718501 60041 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 2
I20240203 16:26:13.718662 60105 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 2
W20240203 16:26:13.719648 60041 grad_base.h:55] KGCacheController, config={
        "num_gpus": 2,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240203 16:26:13.719957 60041 grad_base.h:184] Init GradProcessingBase done
I20240203 16:26:26.186010 60041 grad_async_v1.h:203] Use main thread to update emb.
W20240203 16:26:26.186123 60041 kg_controller.h:75] after init GradAsyncProcessing
I20240203 16:26:26.186132 60041 kg_controller.h:84] Construct KGCacheController done
E20240203 16:26:26.429625 60041 recstore.cc:66] init folly done
E20240203 16:26:26.429713 60105 recstore.cc:66] init folly done
I20240203 16:26:26.430452 60041 grad_base.h:60] GraphEnv RegTensorsPerProcess
I20240203 16:26:51.688733 60105 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 2
I20240203 16:26:55.558020 60041 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 2
W20240203 16:26:56.768561 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240203 16:26:57.768008 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=7, pq.top=7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.399 ms                  | 123.876 ms                |
| Forward                   | 5.875 ms                  | 730.313 ms                |
| Backward                  | 10.068 ms                 | 248.093 ms                |
| Optimize                  | 2.701 ms                  | 13.313 ms                 |
| BarrierTimeBeforeRank0    | 52.631 us                 | 5.149 ms                  |
| AfterBackward             | 16.303 ms                 | 194.444 ms                |
| BlockToStepN              | 1.243 ms                  | 208.737 ms                |
| OneStep                   | 82.765 ms                 | 1.409 s                   |
+---------------------------+---------------------------+---------------------------+
W20240203 16:26:58.768007 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=13, pq.top=13
W20240203 16:26:59.806479 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=21, pq.top=21
W20240203 16:27:00.806005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=27, pq.top=27
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 889.728 us                | 48.736 ms                 |
| ProcessBack:UpdateCache   | 804.687 us                | 86.834 ms                 |
| ProcessBack:UpsertPq      | 12.192 ms                 | 21.507 ms                 |
| ProcessOneStep            | 16.869 ms                 | 194.292 ms                |
| BlockToStepN              | 1.175 ms                  | 217.342 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:01.852161 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=35, pq.top=35
W20240203 16:27:02.852003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=41, pq.top=41
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.330 ms                  | 123.876 ms                |
| Forward                   | 5.102 ms                  | 730.313 ms                |
| Backward                  | 12.279 ms                 | 248.093 ms                |
| Optimize                  | 2.821 ms                  | 13.313 ms                 |
| BarrierTimeBeforeRank0    | 35.136 us                 | 5.149 ms                  |
| AfterBackward             | 18.221 ms                 | 194.444 ms                |
| BlockToStepN              | 1.243 ms                  | 217.453 ms                |
| OneStep                   | 110.831 ms                | 1.409 s                   |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:03.879320 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=49, pq.top=49
W20240203 16:27:04.879005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=55, pq.top=55
W20240203 16:27:05.879027 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=63, pq.top=63
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 864.570 us                | 48.736 ms                 |
| ProcessBack:UpdateCache   | 790.230 us                | 86.834 ms                 |
| ProcessBack:UpsertPq      | 12.773 ms                 | 26.643 ms                 |
| ProcessOneStep            | 17.339 ms                 | 30.905 ms                 |
| BlockToStepN              | 4.565 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:06.921237 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=71, pq.top=71
W20240203 16:27:07.943615 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=78, pq.top=78
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.263 ms                  | 112.790 ms                |
| Forward                   | 4.793 ms                  | 15.851 ms                 |
| Backward                  | 10.607 ms                 | 16.607 ms                 |
| Optimize                  | 2.493 ms                  | 7.078 ms                  |
| BarrierTimeBeforeRank0    | 32.132 us                 | 5.149 ms                  |
| AfterBackward             | 16.550 ms                 | 30.935 ms                 |
| BlockToStepN              | 4.598 ms                  | 208.737 ms                |
| OneStep                   | 110.831 ms                | 325.318 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:09.002818 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=87, pq.top=87
W20240203 16:27:10.002003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=95, pq.top=95
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 18.890, sample: 1.132, forward: 0.991, backward: 1.131, update: 0.211
train_sampler.Prefill()
-------Step 0-------
tensor([1787243, 1787287, 1787316, 1861339, 1787348, 1787382, 1787413,   21532,
        1787458, 1787493]) tensor([  259041,  4595139, 18858853, 43364026, 31658176, 15314003, 79879118,
         8219916, 42323492, 56669831])
-------Step 1-------
tensor([1787243, 1787287, 1787316, 1861339, 1787348, 1787382, 1787413,   21532,
        1787458, 1787493]) tensor([78486113, 73607412, 75565413, 45619587, 48392553,   253273, 26751520,
        48256380, 81790468, 81299446])
-------Step 2-------
tensor([1866980, 1867000, 1867017, 1867037, 1867054, 1867079, 1867103, 1867130,
        1865828, 1867161]) tensor([16018162, 16923469, 44808984, 63871022, 32963034,  1981986, 43143924,
        55724071, 73939857, 12292331])
-------Step 3-------
tensor([1866980, 1867000, 1867017, 1867037, 1867054, 1867079, 1867103, 1867130,
        1865828, 1867161]) tensor([45613621, 82782938,  2299711, 25392994, 50107397, 37207411, 36817201,
        43289825, 63341568, 25655520])
-------Step 4-------
tensor([ 1930039,  1930065,   328189,  1930091,   328226, 46779135,  1153613,
         1930113,  1930140,  1930163]) tensor([  655972, 83028457, 29193060, 31842682, 73707628, 49460630, 47045760,
        33354130, 29293809, 34748654])
-------Step 5-------
tensor([ 1930039,  1930065,   328189,  1930091,   328226, 46779135,  1153613,
         1930113,  1930140,  1930163]) tensor([46528659, 34423155, 48873588, 18414501, 26581442, 78501537, 58175967,
        10901575, 69690267, 70930176])
-------Step 6-------
tensor([ 1987714,  1987733,  1987752,   555804,  1987770,  1987789,  1987808,
        16330897,  1987826,  4337768]) tensor([16859924, 35933592,  6060814,  1758187, 16016349, 15644344,  2736955,
         1595875, 73751711, 20311884])
-------Step 7-------
tensor([ 1987714,  1987733,  1987752,   555804,  1987770,  1987789,  1987808,
        16330897,  1987826,  4337768]) tensor([60658286, 65491560, 75099777,  1411150,  9481522, 43792732, 59914272,
        73518295, 72948825,  9354247])
-------Step 8-------
tensor([2029729, 2029741, 2029754,  559468, 2029765, 2029778, 2029794,  330992,
        2029807, 2029821]) tensor([82093860, 84269628,   305637,  4346843, 49185114, 27480391, 63598514,
        73115741, 41894887, 26518732])
-------Step 9-------
tensor([2029729, 2029741, 2029754,  559468, 2029765, 2029778, 2029794,  330992,
        2029807, 2029821]) tensor([  785524, 43730100, 21584890, 69973099, 29885691,  1774519, 18934061,
        34086634, 31036744, 62608714])
before start barrier
start train
[proc 0] 100 steps, total: 15.020, sample: 1.437, forward: 1.207, backward: 1.307, update: 0.280
W20240203 16:27:11.002003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=103, pq.top=103
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 814.092 us                | 21.792 ms                 |
| ProcessBack:UpdateCache   | 761.557 us                | 1.536 ms                  |
| ProcessBack:UpsertPq      | 11.697 ms                 | 25.975 ms                 |
| ProcessOneStep            | 15.296 ms                 | 30.905 ms                 |
| BlockToStepN              | 4.565 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:12.025624 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=112, pq.top=112
W20240203 16:27:13.047246 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=120, pq.top=120
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.980 ms                  | 112.790 ms                |
| Forward                   | 4.381 ms                  | 15.851 ms                 |
| Backward                  | 9.325 ms                  | 16.607 ms                 |
| Optimize                  | 2.299 ms                  | 7.078 ms                  |
| BarrierTimeBeforeRank0    | 29.767 us                 | 5.149 ms                  |
| AfterBackward             | 14.673 ms                 | 30.935 ms                 |
| BlockToStepN              | 4.598 ms                  | 208.737 ms                |
| OneStep                   | 110.831 ms                | 325.318 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:14.047003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=129, pq.top=129
W20240203 16:27:15.080895 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=137, pq.top=137
W20240203 16:27:16.080257 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=145, pq.top=145
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 788.557 us                | 7.173 ms                  |
| ProcessBack:UpdateCache   | 740.113 us                | 1.285 ms                  |
| ProcessBack:UpsertPq      | 11.201 ms                 | 26.643 ms                 |
| ProcessOneStep            | 14.419 ms                 | 33.098 ms                 |
| BlockToStepN              | 4.565 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:17.090425 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=153, pq.top=153
W20240203 16:27:18.090008 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=161, pq.top=161
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.559 ms                  | 109.266 ms                |
| Forward                   | 4.349 ms                  | 8.672 ms                  |
| Backward                  | 9.286 ms                  | 16.607 ms                 |
| Optimize                  | 2.265 ms                  | 6.044 ms                  |
| BarrierTimeBeforeRank0    | 32.184 us                 | 11.915 ms                 |
| AfterBackward             | 14.334 ms                 | 31.388 ms                 |
| BlockToStepN              | 4.598 ms                  | 207.351 ms                |
| OneStep                   | 110.831 ms                | 317.521 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:19.090003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=169, pq.top=169
W20240203 16:27:20.090004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=177, pq.top=177
W20240203 16:27:21.136579 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=185, pq.top=185
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 783.343 us                | 7.173 ms                  |
| ProcessBack:UpdateCache   | 737.639 us                | 1.283 ms                  |
| ProcessBack:UpsertPq      | 11.438 ms                 | 27.028 ms                 |
| ProcessOneStep            | 14.465 ms                 | 31.359 ms                 |
| BlockToStepN              | 4.565 ms                  | 207.305 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:22.136004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=193, pq.top=193
[proc 0] 200 steps, total: 12.508, sample: 1.125, forward: 0.429, backward: 0.974, update: 0.228
[proc 1] 200 steps, total: 12.508, sample: 1.256, forward: 0.415, backward: 0.908, update: 0.206
W20240203 16:27:23.136003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=201, pq.top=201
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.538 ms                  | 109.266 ms                |
| Forward                   | 4.331 ms                  | 8.672 ms                  |
| Backward                  | 9.322 ms                  | 30.649 ms                 |
| Optimize                  | 2.256 ms                  | 6.044 ms                  |
| BarrierTimeBeforeRank0    | 29.881 us                 | 11.915 ms                 |
| AfterBackward             | 14.390 ms                 | 31.388 ms                 |
| BlockToStepN              | 4.598 ms                  | 207.351 ms                |
| OneStep                   | 110.831 ms                | 317.521 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:24.136015 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=209, pq.top=209
W20240203 16:27:25.152137 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=216, pq.top=216
W20240203 16:27:26.152005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=223, pq.top=223
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 777.169 us                | 6.159 ms                  |
| ProcessBack:UpdateCache   | 734.711 us                | 1.216 ms                  |
| ProcessBack:UpsertPq      | 11.221 ms                 | 27.028 ms                 |
| ProcessOneStep            | 14.266 ms                 | 31.359 ms                 |
| BlockToStepN              | 148.006 ms                | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:27.152004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=231, pq.top=231
W20240203 16:27:28.152004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=239, pq.top=239
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.585 ms                  | 109.266 ms                |
| Forward                   | 4.322 ms                  | 8.672 ms                  |
| Backward                  | 9.343 ms                  | 30.649 ms                 |
| Optimize                  | 2.253 ms                  | 6.044 ms                  |
| BarrierTimeBeforeRank0    | 29.645 us                 | 11.915 ms                 |
| AfterBackward             | 14.118 ms                 | 31.388 ms                 |
| BlockToStepN              | 5.676 ms                  | 208.737 ms                |
| OneStep                   | 110.831 ms                | 317.521 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:29.152004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=247, pq.top=247
W20240203 16:27:30.161134 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=254, pq.top=254
W20240203 16:27:31.229879 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=263, pq.top=263
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 773.854 us                | 6.159 ms                  |
| ProcessBack:UpdateCache   | 723.448 us                | 1.216 ms                  |
| ProcessBack:UpsertPq      | 10.692 ms                 | 26.643 ms                 |
| ProcessOneStep            | 13.874 ms                 | 30.905 ms                 |
| BlockToStepN              | 148.006 ms                | 207.305 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:32.229004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=271, pq.top=271
W20240203 16:27:33.232884 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=279, pq.top=279
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.582 ms                  | 105.585 ms                |
| Forward                   | 4.294 ms                  | 7.111 ms                  |
| Backward                  | 9.325 ms                  | 16.607 ms                 |
| Optimize                  | 2.240 ms                  | 5.886 ms                  |
| BarrierTimeBeforeRank0    | 28.987 us                 | 13.317 ms                 |
| AfterBackward             | 13.737 ms                 | 30.935 ms                 |
| BlockToStepN              | 5.676 ms                  | 207.351 ms                |
| OneStep                   | 110.831 ms                | 317.401 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:34.235913 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=287, pq.top=287
W20240203 16:27:35.319816 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=295, pq.top=295
[proc 1] 300 steps, total: 12.933, sample: 1.085, forward: 0.404, backward: 0.959, update: 0.209
[proc 0] 300 steps, total: 12.933, sample: 1.065, forward: 0.424, backward: 0.946, update: 0.241
W20240203 16:27:36.319003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=303, pq.top=303
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 767.184 us                | 6.151 ms                  |
| ProcessBack:UpdateCache   | 707.750 us                | 1.216 ms                  |
| ProcessBack:UpsertPq      | 10.282 ms                 | 25.975 ms                 |
| ProcessOneStep            | 13.492 ms                 | 30.905 ms                 |
| BlockToStepN              | 5.644 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:37.319005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=311, pq.top=311
W20240203 16:27:38.319005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=319, pq.top=319
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.402 ms                  | 105.585 ms                |
| Forward                   | 4.290 ms                  | 7.111 ms                  |
| Backward                  | 9.316 ms                  | 30.649 ms                 |
| Optimize                  | 2.240 ms                  | 5.886 ms                  |
| BarrierTimeBeforeRank0    | 29.867 us                 | 13.317 ms                 |
| AfterBackward             | 13.241 ms                 | 30.935 ms                 |
| BlockToStepN              | 5.676 ms                  | 208.737 ms                |
| OneStep                   | 110.831 ms                | 317.401 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:39.319005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=327, pq.top=327
W20240203 16:27:40.319007 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=335, pq.top=335
W20240203 16:27:41.319003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=343, pq.top=343
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 763.121 us                | 3.736 ms                  |
| ProcessBack:UpdateCache   | 699.012 us                | 1.282 ms                  |
| ProcessBack:UpsertPq      | 10.088 ms                 | 26.643 ms                 |
| ProcessOneStep            | 13.089 ms                 | 31.359 ms                 |
| BlockToStepN              | 5.644 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:42.319003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=351, pq.top=351
W20240203 16:27:43.319008 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=359, pq.top=359
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.300 ms                  | 91.878 ms                 |
| Forward                   | 4.290 ms                  | 7.111 ms                  |
| Backward                  | 9.313 ms                  | 30.649 ms                 |
| Optimize                  | 2.248 ms                  | 5.885 ms                  |
| BarrierTimeBeforeRank0    | 29.409 us                 | 11.915 ms                 |
| AfterBackward             | 13.147 ms                 | 30.935 ms                 |
| BlockToStepN              | 5.676 ms                  | 207.351 ms                |
| OneStep                   | 110.831 ms                | 315.219 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:44.320447 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=367, pq.top=367
W20240203 16:27:45.320005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=373, pq.top=373
W20240203 16:27:46.320004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=381, pq.top=381
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 761.872 us                | 3.517 ms                  |
| ProcessBack:UpdateCache   | 694.476 us                | 1.216 ms                  |
| ProcessBack:UpsertPq      | 10.114 ms                 | 25.975 ms                 |
| ProcessOneStep            | 13.136 ms                 | 30.905 ms                 |
| BlockToStepN              | 5.644 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:47.320004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=389, pq.top=389
W20240203 16:27:48.320004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=397, pq.top=397
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.323 ms                  | 91.878 ms                 |
| Forward                   | 4.299 ms                  | 7.500 ms                  |
| Backward                  | 9.299 ms                  | 30.649 ms                 |
| Optimize                  | 2.255 ms                  | 5.885 ms                  |
| BarrierTimeBeforeRank0    | 27.948 us                 | 13.317 ms                 |
| AfterBackward             | 13.097 ms                 | 30.935 ms                 |
| BlockToStepN              | 5.676 ms                  | 208.737 ms                |
| OneStep                   | 110.831 ms                | 315.219 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 400 steps, total: 12.786, sample: 1.072, forward: 0.442, backward: 0.955, update: 0.245
[proc 1] 400 steps, total: 12.786, sample: 0.986, forward: 0.422, backward: 0.941, update: 0.224
W20240203 16:27:49.320003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=405, pq.top=405
W20240203 16:27:50.349864 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=412, pq.top=412
W20240203 16:27:51.349005 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=419, pq.top=419
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 762.788 us                | 3.517 ms                  |
| ProcessBack:UpdateCache   | 692.954 us                | 1.216 ms                  |
| ProcessBack:UpsertPq      | 9.999 ms                  | 25.975 ms                 |
| ProcessOneStep            | 13.070 ms                 | 30.905 ms                 |
| BlockToStepN              | 5.644 ms                  | 212.344 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:52.349004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=427, pq.top=427
W20240203 16:27:53.349004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=435, pq.top=435
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.331 ms                  | 91.878 ms                 |
| Forward                   | 4.287 ms                  | 7.500 ms                  |
| Backward                  | 9.299 ms                  | 30.649 ms                 |
| Optimize                  | 2.250 ms                  | 5.885 ms                  |
| BarrierTimeBeforeRank0    | 27.369 us                 | 13.317 ms                 |
| AfterBackward             | 13.020 ms                 | 30.935 ms                 |
| BlockToStepN              | 8.390 ms                  | 212.406 ms                |
| OneStep                   | 110.831 ms                | 315.219 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:54.374008 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=443, pq.top=443
W20240203 16:27:55.374006 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=451, pq.top=451
W20240203 16:27:56.374003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=459, pq.top=459
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 762.286 us                | 2.944 ms                  |
| ProcessBack:UpdateCache   | 696.136 us                | 1.203 ms                  |
| ProcessBack:UpsertPq      | 9.937 ms                  | 24.886 ms                 |
| ProcessOneStep            | 12.935 ms                 | 29.825 ms                 |
| BlockToStepN              | 8.355 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:57.374003 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=467, pq.top=467
W20240203 16:27:58.374004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=475, pq.top=475
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.331 ms                  | 87.308 ms                 |
| Forward                   | 4.285 ms                  | 7.111 ms                  |
| Backward                  | 9.290 ms                  | 16.607 ms                 |
| Optimize                  | 2.240 ms                  | 5.857 ms                  |
| BarrierTimeBeforeRank0    | 28.908 us                 | 13.317 ms                 |
| AfterBackward             | 12.803 ms                 | 29.851 ms                 |
| BlockToStepN              | 8.390 ms                  | 208.737 ms                |
| OneStep                   | 110.831 ms                | 312.422 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 16:27:59.389240 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=483, pq.top=483
W20240203 16:28:00.389004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=489, pq.top=489
W20240203 16:28:01.389004 60041 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=497, pq.top=497
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 761.643 us                | 2.011 ms                  |
| ProcessBack:UpdateCache   | 692.849 us                | 1.102 ms                  |
| ProcessBack:UpsertPq      | 9.827 ms                  | 24.102 ms                 |
| ProcessOneStep            | 12.642 ms                 | 29.825 ms                 |
| BlockToStepN              | 8.355 ms                  | 208.676 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 500 steps, total: 12.949, sample: 1.007, forward: 0.427, backward: 0.922, update: 0.233
[proc 1] 500 steps, total: 12.949, sample: 1.067, forward: 0.415, backward: 0.920, update: 0.219
Successfully xmh. training takes 66.1964156627655 seconds
before call kg_cache_controller.StopThreads()
W20240203 16:28:01.754432 60041 grad_async_v1.h:243] call StopThreads. PID = 34770
W20240203 16:28:01.754462 60041 grad_base.h:212] before processOneStepNegThread_.join();
W20240203 16:28:01.757727 60041 grad_base.h:214] after processOneStepNegThread_.join();
W20240203 16:28:01.757742 60041 grad_async_v1.h:245] call GradProcessingBase::StopThreads.
W20240203 16:28:01.798372 60041 grad_async_v1.h:264] StopThreads done.

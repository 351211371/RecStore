WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240206 22:15:28.015034 48422 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_16', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.1, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [48422 sampler.py:454] Start PreSampling
WARNING [48422 sampler.py:532] Before construct renumbering_dict
WARNING [48422 sampler.py:555] PreSampling done
W20240206 22:34:19.976145 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240206 22:34:19.976351 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240206 22:34:19.976390 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240206 22:34:19.976423 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240206 22:34:19.976464 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240206 22:34:19.976493 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240206 22:34:19.976527 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240206 22:34:19.976572 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240206 22:34:19.976605 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240206 22:34:19.976637 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240206 22:34:19.976677 48422 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240206 22:34:19.976706 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240206 22:34:19.976740 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240206 22:34:19.976902 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240206 22:34:19.976946 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240206 22:34:19.976979 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240206 22:34:19.977033 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240206 22:34:19.977069 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240206 22:34:19.977097 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240206 22:34:19.977126 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240206 22:34:19.977174 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240206 22:34:19.977211 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240206 22:34:19.977237 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240206 22:34:19.977269 48422 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240206 22:34:19.977291 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240206 22:34:19.977316 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240206 22:34:19.977378 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240206 22:34:19.977416 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240206 22:34:19.977442 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240206 22:34:19.977469 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240206 22:34:19.977496 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240206 22:34:19.977530 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240206 22:34:19.977562 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240206 22:34:19.977595 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240206 22:34:19.977631 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240206 22:34:19.977663 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240206 22:34:19.977690 48422 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240206 22:34:19.977712 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240206 22:34:19.977741 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240206 22:34:19.977797 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240206 22:34:19.977833 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240206 22:34:19.977864 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240206 22:34:19.977891 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240206 22:34:19.977931 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240206 22:34:19.977960 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240206 22:34:19.977995 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240206 22:34:19.978034 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240206 22:34:19.978067 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240206 22:34:19.978102 48422 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240206 22:34:19.978129 48422 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240206 22:34:19.978152 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240206 22:34:19.978178 48422 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240206 22:34:20.372478 48422 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240206 22:42:55.332098 48422 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 2151353
Rank1: cached key size 2151353
Rank2: cached key size 2151353
Rank3: cached key size 2151353
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 8605433,  8605455,   111897,  ..., 64515216, 19043216,  4616788]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2148.843 seconds
[Rank1] pid = 49499
[Rank2] pid = 49594
INFO [48422 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [49499 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [49663 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [49594 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [49663 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [49594 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [49499 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [48422 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
WARNING [48422 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [49663 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [49594 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [49499 DistTensor.py:59] The tensor name already exists in the kvstore
I20240206 22:51:22.795425 49729 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240206 22:51:22.795606 49595 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240206 22:51:22.795743 49664 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240206 22:51:22.795866 49500 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
E20240206 22:51:23.280877 49729 recstore.cc:66] init folly done
E20240206 22:51:23.280998 49664 recstore.cc:66] init folly done
E20240206 22:51:23.281008 49500 recstore.cc:66] init folly done
E20240206 22:51:23.281033 49595 recstore.cc:66] init folly done
I20240206 22:51:34.253048 49729 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240206 22:51:37.272017 49500 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240206 22:51:37.880749 49595 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240206 22:51:38.258026 49664 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 22.157 ms                 | 201.970 ms                |
| Forward                   | 9.165 ms                  | 437.737 ms                |
| Backward                  | 225.135 ms                | 421.056 ms                |
| Optimize                  | 4.081 ms                  | 44.675 ms                 |
| BarrierTimeBeforeRank0    | 24.115 ms                 | 46.778 ms                 |
| BlockToStepN              | 31.403 us                 | 135.548 us                |
| OneStep                   | 283.596 ms                | 941.212 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 10.112 ms                 | 201.970 ms                |
| Forward                   | 9.177 ms                  | 437.737 ms                |
| Backward                  | 218.409 ms                | 421.056 ms                |
| Optimize                  | 3.747 ms                  | 44.675 ms                 |
| BarrierTimeBeforeRank0    | 21.407 ms                 | 46.778 ms                 |
| BlockToStepN              | 33.172 us                 | 135.548 us                |
| OneStep                   | 273.273 ms                | 941.212 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.172 ms                  | 269.023 ms                |
| Forward                   | 10.473 ms                 | 437.737 ms                |
| Backward                  | 215.881 ms                | 443.286 ms                |
| Optimize                  | 4.009 ms                  | 44.675 ms                 |
| BarrierTimeBeforeRank0    | 19.904 ms                 | 47.885 ms                 |
| BlockToStepN              | 32.919 us                 | 3.179 ms                  |
| OneStep                   | 259.356 ms                | 941.212 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.577 ms                  | 212.357 ms                |
| Forward                   | 10.595 ms                 | 27.749 ms                 |
| Backward                  | 212.817 ms                | 421.056 ms                |
| Optimize                  | 4.009 ms                  | 4.783 ms                  |
| BarrierTimeBeforeRank0    | 19.428 ms                 | 85.167 ms                 |
| BlockToStepN              | 32.679 us                 | 135.548 us                |
| OneStep                   | 257.311 ms                | 503.283 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.490 ms                  | 212.357 ms                |
| Forward                   | 10.665 ms                 | 27.749 ms                 |
| Backward                  | 209.764 ms                | 421.056 ms                |
| Optimize                  | 4.053 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 19.088 ms                 | 153.749 ms                |
| BlockToStepN              | 31.880 us                 | 135.548 us                |
| OneStep                   | 254.232 ms                | 503.283 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 29.247, sample: 2.580, forward: 2.635, backward: 21.455, update: 0.434
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 32.266, sample: 2.436, forward: 2.547, backward: 20.568, update: 0.465
[Rank3] pid = 49663
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 8605415), (8605415, 17210830), (17210830, 25816245), (25816245, 34421660)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 1371044,   755839, 52077601,  2094156,   479382,   755873,   755914,
          227278,  1371088,  1371129]) tensor([ 9183920, 33156532,  1218809, 57937736, 59335544,  1999031, 74153698,
        65978476, 59866359, 72899621])
-------Step 1-------
tensor([ 1371044,   755839, 52077601,  2094156,   479382,   755873,   755914,
          227278,  1371088,  1371129]) tensor([29351683, 71340102, 67446130, 13439919, 66215074, 12816699, 85226398,
        83041596, 22054853, 37203033])
-------Step 2-------
tensor([  858179,  1384634, 76572004,  1384669,   858203,   858232,   858272,
        46304313,   858303,   858356]) tensor([43012253,  9297460, 64014692, 15239522, 17555245, 15117257, 64670747,
        14152713, 52795696, 32365728])
-------Step 3-------
tensor([  858179,  1384634, 76572004,  1384669,   858203,   858232,   858272,
        46304313,   858303,   858356]) tensor([  338794, 53242827,  1512460, 42859548, 19980756, 73524663, 75481744,
        56033774, 27922780, 69846988])
-------Step 4-------
tensor([ 960805, 1399075,  960847,  960882, 1399121,  960915, 1399161,  960945,
        1399208,  960983]) tensor([ 4277611, 37231700, 22547362,  1869051, 56628667, 41957464, 73147001,
        46944965, 52801351, 12595206])
-------Step 5-------
tensor([ 960805, 1399075,  960847,  960882, 1399121,  960915, 1399161,  960945,
        1399208,  960983]) tensor([39797848, 42541802, 84432351, 12669411, 44300737,   640783, 41563330,
        75571381, 86041703,  1557811])
-------Step 6-------
tensor([80712946,  1062040,  1062073,  1062099,  8611501,  1062131,  1062172,
         1062236,  1062273,   233072]) tensor([32071245, 41172051, 29968400, 21639716, 78968306, 52775339, 49965808,
        20343471, 57952376, 12011598])
-------Step 7-------
tensor([80712946,  1062040,  1062073,  1062099,  8611501,  1062131,  1062172,
         1062236,  1062273,   233072]) tensor([39620142, 81368545, 60334734, 66407870, 61742815,  2555465, 22801906,
        51235411, 26610040, 17559101])
-------Step 8-------
tensor([ 1164201,  1428196,  1164236, 38642352,  2107752,  1164268,  1164310,
         1164361,   234817,  2107760]) tensor([28860465, 50372483, 49332307, 75410778, 79485720, 71215040, 54133548,
        68350657, 13597246,  7689970])
-------Step 9-------
tensor([ 1164201,  1428196,  1164236, 38642352,  2107752,  1164268,  1164310,
         1164361,   234817,  2107760]) tensor([69676648, 60504887, 31343497, 42062370, 14687241,  1741253, 25826467,
        16581310, 73284811, 51602914])
before start barrier
start train
[proc 0] 100 steps, total: 28.261, sample: 2.344, forward: 1.514, backward: 21.665, update: 0.401
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 28.638, sample: 1.877, forward: 2.380, backward: 21.531, update: 0.412
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.809 ms                  | 238.560 ms                |
| Forward                   | 10.724 ms                 | 27.749 ms                 |
| Backward                  | 208.256 ms                | 421.056 ms                |
| Optimize                  | 4.080 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 16.944 ms                 | 153.749 ms                |
| BlockToStepN              | 31.803 us                 | 135.548 us                |
| OneStep                   | 252.198 ms                | 503.283 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.490 ms                  | 238.560 ms                |
| Forward                   | 10.768 ms                 | 27.749 ms                 |
| Backward                  | 206.794 ms                | 421.056 ms                |
| Optimize                  | 4.074 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 15.511 ms                 | 153.749 ms                |
| BlockToStepN              | 31.799 us                 | 135.548 us                |
| OneStep                   | 251.046 ms                | 503.283 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.989 ms                  | 238.560 ms                |
| Forward                   | 10.793 ms                 | 27.749 ms                 |
| Backward                  | 206.794 ms                | 421.056 ms                |
| Optimize                  | 4.057 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 14.240 ms                 | 153.749 ms                |
| BlockToStepN              | 31.669 us                 | 3.179 ms                  |
| OneStep                   | 249.920 ms                | 503.283 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.172 ms                  | 238.560 ms                |
| Forward                   | 10.789 ms                 | 21.187 ms                 |
| Backward                  | 205.829 ms                | 345.220 ms                |
| Optimize                  | 4.048 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 12.683 ms                 | 129.091 ms                |
| BlockToStepN              | 31.289 us                 | 135.548 us                |
| OneStep                   | 248.348 ms                | 480.849 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.240 ms                  | 238.560 ms                |
| Forward                   | 10.665 ms                 | 21.187 ms                 |
| Backward                  | 205.620 ms                | 345.220 ms                |
| Optimize                  | 4.053 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 13.502 ms                 | 129.091 ms                |
| BlockToStepN              | 31.625 us                 | 135.548 us                |
| OneStep                   | 248.283 ms                | 480.849 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.549 ms                  | 238.560 ms                |
| Forward                   | 10.618 ms                 | 27.749 ms                 |
| Backward                  | 205.737 ms                | 351.747 ms                |
| Optimize                  | 4.017 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 11.819 ms                 | 129.091 ms                |
| BlockToStepN              | 31.560 us                 | 135.548 us                |
| OneStep                   | 247.743 ms                | 480.849 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 26.319, sample: 2.161, forward: 1.830, backward: 18.728, update: 0.370
[proc 0] 200 steps, total: 26.319, sample: 2.884, forward: 1.111, backward: 20.751, update: 0.351
[proc 2] 200 steps, total: 26.319, sample: 1.720, forward: 1.636, backward: 20.110, update: 0.326
[proc 3] 200 steps, total: 26.319, sample: 1.461, forward: 1.752, backward: 19.388, update: 0.421
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.240 ms                  | 238.560 ms                |
| Forward                   | 10.602 ms                 | 27.749 ms                 |
| Backward                  | 205.534 ms                | 351.747 ms                |
| Optimize                  | 3.960 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 10.391 ms                 | 134.370 ms                |
| BlockToStepN              | 31.560 us                 | 3.724 ms                  |
| OneStep                   | 246.878 ms                | 480.849 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.745 ms                  | 238.560 ms                |
| Forward                   | 10.595 ms                 | 27.749 ms                 |
| Backward                  | 205.534 ms                | 351.747 ms                |
| Optimize                  | 3.898 ms                  | 9.475 ms                  |
| BarrierTimeBeforeRank0    | 10.037 ms                 | 134.370 ms                |
| BlockToStepN              | 31.394 us                 | 7.024 ms                  |
| OneStep                   | 246.534 ms                | 480.849 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.791 ms                  | 230.654 ms                |
| Forward                   | 10.576 ms                 | 25.548 ms                 |
| Backward                  | 205.411 ms                | 345.220 ms                |
| Optimize                  | 4.048 ms                  | 7.443 ms                  |
| BarrierTimeBeforeRank0    | 9.194 ms                  | 129.091 ms                |
| BlockToStepN              | 31.278 us                 | 7.024 ms                  |
| OneStep                   | 245.168 ms                | 467.125 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.549 ms                  | 230.654 ms                |
| Forward                   | 10.558 ms                 | 27.749 ms                 |
| Backward                  | 205.411 ms                | 345.220 ms                |
| Optimize                  | 4.075 ms                  | 7.443 ms                  |
| BarrierTimeBeforeRank0    | 8.781 ms                  | 129.091 ms                |
| BlockToStepN              | 31.394 us                 | 7.024 ms                  |
| OneStep                   | 245.145 ms                | 467.125 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.745 ms                  | 230.654 ms                |
| Forward                   | 10.595 ms                 | 28.219 ms                 |
| Backward                  | 205.620 ms                | 351.747 ms                |
| Optimize                  | 4.086 ms                  | 7.443 ms                  |
| BarrierTimeBeforeRank0    | 8.514 ms                  | 129.091 ms                |
| BlockToStepN              | 31.403 us                 | 7.024 ms                  |
| OneStep                   | 245.062 ms                | 467.125 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 300 steps, total: 25.833, sample: 2.011, forward: 1.148, backward: 20.411, update: 0.379
[proc 1] 300 steps, total: 25.833, sample: 1.762, forward: 1.775, backward: 20.719, update: 0.383
[proc 3] 300 steps, total: 25.833, sample: 1.333, forward: 1.700, backward: 19.705, update: 0.426
[proc 2] 300 steps, total: 25.834, sample: 1.583, forward: 1.520, backward: 20.075, update: 0.330
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.745 ms                  | 230.654 ms                |
| Forward                   | 10.558 ms                 | 28.219 ms                 |
| Backward                  | 204.962 ms                | 351.747 ms                |
| Optimize                  | 4.084 ms                  | 7.443 ms                  |
| BarrierTimeBeforeRank0    | 10.087 ms                 | 141.962 ms                |
| BlockToStepN              | 31.394 us                 | 7.024 ms                  |
| OneStep                   | 245.168 ms                | 467.125 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.240 ms                  | 230.654 ms                |
| Forward                   | 10.473 ms                 | 28.219 ms                 |
| Backward                  | 204.305 ms                | 351.747 ms                |
| Optimize                  | 4.080 ms                  | 7.443 ms                  |
| BarrierTimeBeforeRank0    | 11.129 ms                 | 141.962 ms                |
| BlockToStepN              | 31.576 us                 | 11.837 ms                 |
| OneStep                   | 244.849 ms                | 467.125 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.809 ms                  | 212.357 ms                |
| Forward                   | 10.436 ms                 | 27.749 ms                 |
| Backward                  | 203.710 ms                | 345.220 ms                |
| Optimize                  | 4.074 ms                  | 7.303 ms                  |
| BarrierTimeBeforeRank0    | 12.683 ms                 | 141.962 ms                |
| BlockToStepN              | 31.637 us                 | 11.837 ms                 |
| OneStep                   | 244.614 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.638 ms                  | 212.357 ms                |
| Forward                   | 10.376 ms                 | 27.749 ms                 |
| Backward                  | 203.263 ms                | 345.220 ms                |
| Optimize                  | 4.048 ms                  | 7.443 ms                  |
| BarrierTimeBeforeRank0    | 14.117 ms                 | 153.749 ms                |
| BlockToStepN              | 31.764 us                 | 11.837 ms                 |
| OneStep                   | 244.152 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.797 ms                  | 212.357 ms                |
| Forward                   | 10.396 ms                 | 27.749 ms                 |
| Backward                  | 203.710 ms                | 345.220 ms                |
| Optimize                  | 4.074 ms                  | 7.636 ms                  |
| BarrierTimeBeforeRank0    | 12.978 ms                 | 153.749 ms                |
| BlockToStepN              | 31.626 us                 | 11.837 ms                 |
| OneStep                   | 244.567 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 400 steps, total: 25.636, sample: 1.380, forward: 1.607, backward: 19.879, update: 0.416
[proc 1] 400 steps, total: 25.637, sample: 1.727, forward: 1.724, backward: 20.829, update: 0.377
[proc 2] 400 steps, total: 25.636, sample: 1.507, forward: 1.526, backward: 20.260, update: 0.367
[proc 0] 400 steps, total: 25.637, sample: 1.745, forward: 1.026, backward: 13.878, update: 0.359
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.809 ms                  | 212.357 ms                |
| Forward                   | 10.450 ms                 | 27.749 ms                 |
| Backward                  | 204.204 ms                | 345.220 ms                |
| Optimize                  | 4.087 ms                  | 7.636 ms                  |
| BarrierTimeBeforeRank0    | 11.910 ms                 | 153.749 ms                |
| BlockToStepN              | 31.625 us                 | 11.837 ms                 |
| OneStep                   | 244.152 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.809 ms                  | 212.357 ms                |
| Forward                   | 10.466 ms                 | 27.749 ms                 |
| Backward                  | 204.498 ms                | 345.220 ms                |
| Optimize                  | 4.114 ms                  | 7.636 ms                  |
| BarrierTimeBeforeRank0    | 10.939 ms                 | 153.749 ms                |
| BlockToStepN              | 31.560 us                 | 12.931 ms                 |
| OneStep                   | 244.114 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.809 ms                  | 207.507 ms                |
| Forward                   | 10.505 ms                 | 27.749 ms                 |
| Backward                  | 204.932 ms                | 345.220 ms                |
| Optimize                  | 4.127 ms                  | 7.443 ms                  |
| BarrierTimeBeforeRank0    | 10.391 ms                 | 144.784 ms                |
| BlockToStepN              | 31.420 us                 | 11.837 ms                 |
| OneStep                   | 243.883 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.172 ms                  | 207.507 ms                |
| Forward                   | 10.529 ms                 | 27.749 ms                 |
| Backward                  | 205.402 ms                | 345.220 ms                |
| Optimize                  | 4.141 ms                  | 7.526 ms                  |
| BarrierTimeBeforeRank0    | 9.886 ms                  | 144.784 ms                |
| BlockToStepN              | 31.419 us                 | 11.837 ms                 |
| OneStep                   | 243.889 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 8.057 ms                  | 207.507 ms                |
| Forward                   | 10.529 ms                 | 27.749 ms                 |
| Backward                  | 204.758 ms                | 351.457 ms                |
| Optimize                  | 4.145 ms                  | 7.526 ms                  |
| BarrierTimeBeforeRank0    | 10.087 ms                 | 144.784 ms                |
| BlockToStepN              | 31.419 us                 | 11.837 ms                 |
| OneStep                   | 243.641 ms                | 464.635 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 25.643, sample: 1.418, forward: 1.431, backward: 20.206, update: 0.340
[proc 0] 500 steps, total: 25.643, sample: 1.691, forward: 1.152, backward: 21.050, update: 0.407
[proc 3] 500 steps, total: 25.643, sample: 1.184, forward: 1.564, backward: 19.514, update: 0.419
[proc 1] 500 steps, total: 25.643, sample: 1.645, forward: 1.668, backward: 20.857, update: 0.388
Successfully xmh. training takes 131.6938967704773 seconds
before call kg_cache_controller.StopThreads()
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads
INFO [48422 controller_process.py:421] call rank0 to StopThreads

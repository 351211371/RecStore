WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240202 13:55:52.249301 18627 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_55', no_save_emb=True, max_step=500, batch_size=1200, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsync', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [18627 sampler.py:454] Start PreSampling
WARNING [18627 sampler.py:532] Before construct renumbering_dict
WARNING [18627 sampler.py:555] PreSampling done
W20240202 13:55:57.669924 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240202 13:55:57.670182 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240202 13:55:57.670218 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240202 13:55:57.670255 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240202 13:55:57.670282 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240202 13:55:57.670318 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240202 13:55:57.670346 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240202 13:55:57.670378 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240202 13:55:57.670418 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240202 13:55:57.670459 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240202 13:55:57.670498 18627 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240202 13:55:57.670527 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240202 13:55:57.670559 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240202 13:55:57.670706 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240202 13:55:57.670742 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240202 13:55:57.670769 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240202 13:55:57.670841 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240202 13:55:57.670879 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240202 13:55:57.670917 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240202 13:55:57.670960 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240202 13:55:57.670987 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240202 13:55:57.671016 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240202 13:55:57.671048 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240202 13:55:57.671079 18627 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240202 13:55:57.671103 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240202 13:55:57.671136 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240202 13:55:57.671197 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240202 13:55:57.671240 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240202 13:55:57.671269 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240202 13:55:57.671303 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240202 13:55:57.671337 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240202 13:55:57.671373 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240202 13:55:57.671409 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240202 13:55:57.671440 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240202 13:55:57.671483 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240202 13:55:57.671519 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240202 13:55:57.671547 18627 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240202 13:55:57.671571 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240202 13:55:57.671598 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240202 13:55:57.671674 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240202 13:55:57.671715 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240202 13:55:57.671744 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240202 13:55:57.671777 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240202 13:55:57.671806 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240202 13:55:57.671836 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240202 13:55:57.671864 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240202 13:55:57.671895 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240202 13:55:57.671933 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240202 13:55:57.671965 18627 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240202 13:55:57.671998 18627 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240202 13:55:57.672021 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240202 13:55:57.672044 18627 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240202 13:55:57.916551 18627 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100013192000 22.81 MB
W20240202 13:55:57.947237 18627 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x100014864000 58.4 kB
{0: Graph(num_nodes=9703, num_edges=161860,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=11374, num_edges=168961,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=10715, num_edges=190828,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=11184, num_edges=240046,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 9703 N 161860 E
MertisPartition: part 1 has 11374 N 168961 E
MertisPartition: part 2 has 10715 N 190828 E
MertisPartition: part 3 has 11184 N 240046 E
Rank0: cached key size 186
Rank1: cached key size 186
Rank2: cached key size 186
Rank3: cached key size 186
Before renumbering graph:  {'_ID': tensor([   6,   10,   11,  ..., 5824, 6189, 2559]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 983, 1145, 1187,  ..., 4082, 2706, 9088]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=9703, num_edges=161860,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.733 seconds
[Rank1] pid = 19056
[Rank2] pid = 19093
INFO [18627 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [19056 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [19184 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [19093 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [18627 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [19184 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [19093 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [19056 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240202 13:55:59.857761 19185 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [747, 400]; dev=0; size=1.14 MB
W20240202 13:55:59.858922 19239 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [747, 400]; dev=3; size=1.14 MB
W20240202 13:55:59.858986 19057 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [747, 400]; dev=1; size=1.14 MB
W20240202 13:55:59.858994 19121 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [747, 400]; dev=2; size=1.14 MB
W20240202 13:55:59.887379 19185 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x100014876000 7.629 MB
W20240202 13:55:59.887547 19185 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x100015019000 7.629 MB
W20240202 13:55:59.887616 19185 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1000157bc000 1.49 GB
W20240202 13:55:59.887688 19185 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x100074d9f000 1.49 GB
W20240202 13:55:59.887732 19185 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240202 13:55:59.890269 19121 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1000d4388000 7.629 MB
W20240202 13:55:59.890326 19239 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x1000d4b2d000 7.629 MB
W20240202 13:55:59.890375 19185 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240202 13:55:59.890388 19057 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1000d52d0000 7.629 MB
W20240202 13:55:59.890447 19121 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1000d5a73000 7.629 MB
W20240202 13:55:59.890481 19239 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1000d6216000 7.629 MB
W20240202 13:55:59.890538 19121 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1000d69b9000 1.49 GB
W20240202 13:55:59.890555 19057 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x100135f9c000 7.629 MB
W20240202 13:55:59.890580 19239 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x10013673f000 1.49 GB
W20240202 13:55:59.890599 19121 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x100195d22000 1.49 GB
W20240202 13:55:59.890633 19121 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240202 13:55:59.890643 19239 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1001f5305000 1.49 GB
W20240202 13:55:59.890650 19057 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1002548e8000 1.49 GB
W20240202 13:55:59.890686 19239 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240202 13:55:59.890710 19057 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1002b3ecb000 1.49 GB
W20240202 13:55:59.890763 19057 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240202 13:55:59.896836 19121 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240202 13:55:59.896838 19239 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240202 13:55:59.896855 19057 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [19056 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [19184 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [19093 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 19184
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [18627 DistTensor.py:59] The tensor name already exists in the kvstore
I20240202 13:56:01.546350 19185 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240202 13:56:01.546744 19121 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 13:56:01.546861 19057 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240202 13:56:01.546967 19239 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240202 13:56:01.548669 19185 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsync",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240202 13:56:01.548796 19185 grad_base.h:184] Init GradProcessingBase done
I20240202 13:56:01.551064 19185 grad_async_v1.h:203] Use main thread to update emb.
W20240202 13:56:01.551095 19185 kg_controller.h:75] after init GradAsyncProcessing
I20240202 13:56:01.551101 19185 kg_controller.h:84] Construct KGCacheController done
E20240202 13:56:01.981453 19239 recstore.cc:66] init folly done
E20240202 13:56:01.981477 19185 recstore.cc:66] init folly done
E20240202 13:56:01.981480 19057 recstore.cc:66] init folly done
E20240202 13:56:01.981477 19121 recstore.cc:66] init folly done
I20240202 13:56:01.982616 19185 grad_base.h:60] GraphEnv RegTensorsPerProcess
I20240202 13:56:02.380088 19185 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
I20240202 13:56:02.390043 19057 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240202 13:56:02.390125 19121 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240202 13:56:02.393059 19239 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
W20240202 13:56:03.845968 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=1, pq.top=1
E20240202 13:56:03.930370 19594 grad_async_v1.h:533] Stalled in ProcessBackward: rank=3, step_no=1, sample_step_cpp_seen_[rank]=0
W20240202 13:56:04.845021 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=20, pq.top=20
W20240202 13:56:05.845016 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=29, pq.top=29
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.260 ms                  | 18.368 ms                 |
| Forward                   | 4.506 ms                  | 576.077 ms                |
| Backward                  | 8.644 ms                  | 214.317 ms                |
| Optimize                  | 1.653 ms                  | 6.096 ms                  |
| BarrierTimeBeforeRank0    | 164.966 us                | 8.898 ms                  |
| AfterBackward             | 10.902 ms                 | 653.776 ms                |
| BlockToStepN              | 55.095 ms                 | 100.823 ms                |
| OneStep                   | 89.833 ms                 | 1.508 s                   |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:06.872437 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=38, pq.top=38
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.346 ms                  | 205.700 ms                |
| ProcessBack:UpdateCache   | 2.757 ms                  | 302.521 ms                |
| ProcessBack:UpsertPq      | 4.823 ms                  | 9.170 ms                  |
| ProcessOneStep            | 10.879 ms                 | 652.957 ms                |
| BlockToStepN              | 65.857 ms                 | 100.742 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:07.872017 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=45, pq.top=45
W20240202 13:56:08.872018 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=52, pq.top=52
W20240202 13:56:09.872011 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=58, pq.top=58
W20240202 13:56:10.872016 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=64, pq.top=64
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.260 ms                  | 18.994 ms                 |
| Forward                   | 4.368 ms                  | 9.884 ms                  |
| Backward                  | 8.611 ms                  | 11.491 ms                 |
| Optimize                  | 1.673 ms                  | 4.019 ms                  |
| BarrierTimeBeforeRank0    | 295.201 us                | 8.898 ms                  |
| AfterBackward             | 11.188 ms                 | 20.094 ms                 |
| BlockToStepN              | 89.201 ms                 | 147.391 ms                |
| OneStep                   | 122.245 ms                | 187.086 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:11.872005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=70, pq.top=70
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.332 ms                  | 205.700 ms                |
| ProcessBack:UpdateCache   | 2.708 ms                  | 302.521 ms                |
| ProcessBack:UpsertPq      | 5.165 ms                  | 11.380 ms                 |
| ProcessOneStep            | 11.162 ms                 | 20.050 ms                 |
| BlockToStepN              | 89.298 ms                 | 147.288 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:12.872015 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=75, pq.top=75
W20240202 13:56:13.872010 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=81, pq.top=81
W20240202 13:56:14.872005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=86, pq.top=86
W20240202 13:56:15.872021 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=91, pq.top=91
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.315 ms                  | 19.153 ms                 |
| Forward                   | 4.385 ms                  | 9.884 ms                  |
| Backward                  | 8.598 ms                  | 11.491 ms                 |
| Optimize                  | 1.653 ms                  | 4.019 ms                  |
| BarrierTimeBeforeRank0    | 320.566 us                | 16.556 ms                 |
| AfterBackward             | 11.251 ms                 | 20.498 ms                 |
| BlockToStepN              | 100.823 ms                | 188.916 ms                |
| OneStep                   | 135.977 ms                | 226.174 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 14.460, sample: 0.294, forward: 0.977, backward: 0.830, update: 0.163
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 14.460, sample: 0.367, forward: 1.005, backward: 1.064, update: 0.189
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 14.457, sample: 0.297, forward: 0.969, backward: 1.034, update: 0.172
train_sampler.Prefill()
-------Step 0-------
tensor([ 3563,  4674, 13098,  5866,   158,  6365,  9929,    72,    99, 11621]) tensor([ 1187,  8482,  2182, 13796,  3189, 11390,  4107,  7395,  4795, 14089])
-------Step 1-------
tensor([ 3563,  4674, 13098,  5866,   158,  6365,  9929,    72,    99, 11621]) tensor([ 2111,  9476, 12447,  9085,  7809, 11695, 11143,  2927,  4560,  5218])
-------Step 2-------
tensor([14674, 11075,  9402,  6576,    37,  3016,    32,  9363,  3315,  3415]) tensor([11721,  2165,  7486,  8899, 10142,   151,  8598,  6072,  5391,  6699])
-------Step 3-------
tensor([14674, 11075,  9402,  6576,    37,  3016,    32,  9363,  3315,  3415]) tensor([10540,  1718,  8060,  2683,  9174,  3946, 13394,  2229,  3997, 12162])
-------Step 4-------
tensor([13128,  9125,  7702,  2551,  6733, 12165,  5197, 14688,    95, 10984]) tensor([  561,  3326, 11907, 10682,  4536,    43,  2934,  4603, 11542,  9073])
-------Step 5-------
tensor([13128,  9125,  7702,  2551,  6733, 12165,  5197, 14688,    95, 10984]) tensor([ 7965,  3592,  4413, 14039, 12224, 11622,  6467,  6451,  4765,  8855])
-------Step 6-------
tensor([ 1398,  3093,  3554, 11036,   116,  6237, 12543,  5327,    74,  1953]) tensor([ 3270,  7931, 13217,  2456, 11514, 14889,  2551,  9466, 14648,  9786])
-------Step 7-------
tensor([ 1398,  3093,  3554, 11036,   116,  6237, 12543,  5327,    74,  1953]) tensor([11185,  6046,  8535,  3814,  2093,   828,  2079,  6233,  5243,  3984])
-------Step 8-------
tensor([  156, 10595,    85,  9635,  5985,  7381, 12937,  6187,    49,  2784]) tensor([ 6629,  3636,  1574,  4435,  9899, 13841,  1411,  8306,  7109, 14580])
-------Step 9-------
tensor([  156, 10595,    85,  9635,  5985,  7381, 12937,  6187,    49,  2784]) tensor([ 6367,  8441, 10163,  3706,  6605,  2413, 14589,  2927,  5377,  5103])
before start barrier
start train
[proc 0] 100 steps, total: 14.470, sample: 0.344, forward: 1.010, backward: 1.046, update: 0.178
W20240202 13:56:16.881726 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=101, pq.top=101
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.316 ms                  | 9.198 ms                  |
| ProcessBack:UpdateCache   | 2.654 ms                  | 5.555 ms                  |
| ProcessBack:UpsertPq      | 5.388 ms                  | 11.380 ms                 |
| ProcessOneStep            | 11.205 ms                 | 20.454 ms                 |
| BlockToStepN              | 97.609 ms                 | 188.858 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:17.881016 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=110, pq.top=110
W20240202 13:56:18.904492 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=120, pq.top=120
W20240202 13:56:19.904006 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=126, pq.top=126
W20240202 13:56:20.904014 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=131, pq.top=131
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.315 ms                  | 19.153 ms                 |
| Forward                   | 4.385 ms                  | 9.884 ms                  |
| Backward                  | 8.551 ms                  | 11.491 ms                 |
| Optimize                  | 1.653 ms                  | 4.019 ms                  |
| BarrierTimeBeforeRank0    | 263.384 us                | 16.556 ms                 |
| AfterBackward             | 11.257 ms                 | 20.498 ms                 |
| BlockToStepN              | 89.357 ms                 | 200.871 ms                |
| OneStep                   | 125.834 ms                | 238.687 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:21.904006 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=136, pq.top=136
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.322 ms                  | 4.527 ms                  |
| ProcessBack:UpdateCache   | 2.631 ms                  | 5.064 ms                  |
| ProcessBack:UpsertPq      | 5.537 ms                  | 10.707 ms                 |
| ProcessOneStep            | 11.230 ms                 | 20.454 ms                 |
| BlockToStepN              | 90.124 ms                 | 200.817 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:22.904006 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=140, pq.top=140
W20240202 13:56:23.904004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=145, pq.top=145
W20240202 13:56:24.928861 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=150, pq.top=150
W20240202 13:56:25.928015 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=154, pq.top=154
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.325 ms                  | 19.153 ms                 |
| Forward                   | 4.417 ms                  | 6.533 ms                  |
| Backward                  | 8.545 ms                  | 11.022 ms                 |
| Optimize                  | 1.650 ms                  | 3.442 ms                  |
| BarrierTimeBeforeRank0    | 263.384 us                | 11.383 ms                 |
| AfterBackward             | 11.289 ms                 | 20.094 ms                 |
| BlockToStepN              | 109.065 ms                | 205.353 ms                |
| OneStep                   | 141.039 ms                | 249.627 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:26.928005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=158, pq.top=158
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.316 ms                  | 4.527 ms                  |
| ProcessBack:UpdateCache   | 2.600 ms                  | 5.064 ms                  |
| ProcessBack:UpsertPq      | 5.626 ms                  | 10.707 ms                 |
| ProcessOneStep            | 11.265 ms                 | 20.050 ms                 |
| BlockToStepN              | 108.980 ms                | 205.290 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:27.928025 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=163, pq.top=163
W20240202 13:56:28.928005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=167, pq.top=167
W20240202 13:56:29.928061 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=172, pq.top=172
W20240202 13:56:30.928012 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=176, pq.top=176
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.383 ms                  | 19.153 ms                 |
| Forward                   | 4.423 ms                  | 6.533 ms                  |
| Backward                  | 8.537 ms                  | 11.022 ms                 |
| Optimize                  | 1.644 ms                  | 3.442 ms                  |
| BarrierTimeBeforeRank0    | 361.514 us                | 12.665 ms                 |
| AfterBackward             | 11.301 ms                 | 20.094 ms                 |
| BlockToStepN              | 124.093 ms                | 215.954 ms                |
| OneStep                   | 158.129 ms                | 256.344 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:31.940060 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=181, pq.top=181
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.303 ms                  | 4.131 ms                  |
| ProcessBack:UpdateCache   | 2.599 ms                  | 3.948 ms                  |
| ProcessBack:UpsertPq      | 5.666 ms                  | 10.707 ms                 |
| ProcessOneStep            | 11.287 ms                 | 20.050 ms                 |
| BlockToStepN              | 125.206 ms                | 215.838 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:32.940021 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=185, pq.top=185
W20240202 13:56:33.940013 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=189, pq.top=189
W20240202 13:56:34.954682 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=194, pq.top=194
W20240202 13:56:35.954017 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=198, pq.top=198
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.421 ms                  | 19.416 ms                 |
| Forward                   | 4.475 ms                  | 6.533 ms                  |
| Backward                  | 8.542 ms                  | 11.022 ms                 |
| Optimize                  | 1.636 ms                  | 3.442 ms                  |
| BarrierTimeBeforeRank0    | 242.376 us                | 12.665 ms                 |
| AfterBackward             | 11.407 ms                 | 20.094 ms                 |
| BlockToStepN              | 143.165 ms                | 228.104 ms                |
| OneStep                   | 173.509 ms                | 258.627 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 1] 200 steps, total: 19.795, sample: 0.304, forward: 0.402, backward: 0.538, update: 0.148
[proc 2] 200 steps, total: 19.795, sample: 0.378, forward: 0.450, backward: 0.879, update: 0.179
[proc 3] 200 steps, total: 19.794, sample: 0.324, forward: 0.406, backward: 0.875, update: 0.161
[proc 0] 200 steps, total: 19.793, sample: 0.393, forward: 0.442, backward: 0.759, update: 0.162
W20240202 13:56:36.954007 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=202, pq.top=202
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.314 ms                  | 4.527 ms                  |
| ProcessBack:UpdateCache   | 2.600 ms                  | 5.064 ms                  |
| ProcessBack:UpsertPq      | 5.746 ms                  | 10.864 ms                 |
| ProcessOneStep            | 11.373 ms                 | 20.050 ms                 |
| BlockToStepN              | 143.691 ms                | 227.890 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:37.954020 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=206, pq.top=206
W20240202 13:56:38.970191 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=211, pq.top=211
W20240202 13:56:39.970014 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=215, pq.top=215
W20240202 13:56:40.970010 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=219, pq.top=219
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.430 ms                  | 19.416 ms                 |
| Forward                   | 4.456 ms                  | 8.751 ms                  |
| Backward                  | 8.543 ms                  | 11.022 ms                 |
| Optimize                  | 1.653 ms                  | 3.442 ms                  |
| BarrierTimeBeforeRank0    | 214.710 us                | 12.665 ms                 |
| AfterBackward             | 11.433 ms                 | 20.094 ms                 |
| BlockToStepN              | 152.665 ms                | 228.419 ms                |
| OneStep                   | 186.092 ms                | 275.904 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:41.970005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=223, pq.top=223
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.316 ms                  | 4.527 ms                  |
| ProcessBack:UpdateCache   | 2.593 ms                  | 5.064 ms                  |
| ProcessBack:UpsertPq      | 5.745 ms                  | 10.918 ms                 |
| ProcessOneStep            | 11.422 ms                 | 20.050 ms                 |
| BlockToStepN              | 152.620 ms                | 228.265 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:42.973809 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=228, pq.top=228
W20240202 13:56:43.973004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=232, pq.top=232
W20240202 13:56:44.973016 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=236, pq.top=236
W20240202 13:56:45.973011 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=240, pq.top=240
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.444 ms                  | 19.416 ms                 |
| Forward                   | 4.452 ms                  | 8.751 ms                  |
| Backward                  | 8.545 ms                  | 11.022 ms                 |
| Optimize                  | 1.650 ms                  | 3.442 ms                  |
| BarrierTimeBeforeRank0    | 179.527 us                | 12.665 ms                 |
| AfterBackward             | 11.470 ms                 | 20.094 ms                 |
| BlockToStepN              | 163.994 ms                | 247.147 ms                |
| OneStep                   | 197.200 ms                | 276.442 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:46.973006 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=244, pq.top=244
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.316 ms                  | 4.264 ms                  |
| ProcessBack:UpdateCache   | 2.591 ms                  | 4.514 ms                  |
| ProcessBack:UpsertPq      | 5.739 ms                  | 10.864 ms                 |
| ProcessOneStep            | 11.452 ms                 | 20.050 ms                 |
| BlockToStepN              | 165.584 ms                | 247.084 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:47.973019 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=248, pq.top=248
W20240202 13:56:48.973006 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=252, pq.top=252
W20240202 13:56:49.988876 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=257, pq.top=257
W20240202 13:56:51.003005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=261, pq.top=261
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.453 ms                  | 19.583 ms                 |
| Forward                   | 4.450 ms                  | 6.533 ms                  |
| Backward                  | 8.560 ms                  | 11.022 ms                 |
| Optimize                  | 1.656 ms                  | 3.174 ms                  |
| BarrierTimeBeforeRank0    | 147.038 us                | 12.665 ms                 |
| AfterBackward             | 11.624 ms                 | 18.784 ms                 |
| BlockToStepN              | 174.692 ms                | 247.147 ms                |
| OneStep                   | 206.191 ms                | 280.973 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.318 ms                  | 4.264 ms                  |
| ProcessBack:UpdateCache   | 2.593 ms                  | 4.514 ms                  |
| ProcessBack:UpsertPq      | 5.781 ms                  | 10.864 ms                 |
| ProcessOneStep            | 11.585 ms                 | 18.737 ms                 |
| BlockToStepN              | 174.728 ms                | 247.084 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:52.002013 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=265, pq.top=265
W20240202 13:56:53.002010 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=269, pq.top=269
W20240202 13:56:54.002012 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=274, pq.top=274
W20240202 13:56:55.002010 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=278, pq.top=278
W20240202 13:56:56.002004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=282, pq.top=282
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.456 ms                  | 19.583 ms                 |
| Forward                   | 4.413 ms                  | 6.533 ms                  |
| Backward                  | 8.558 ms                  | 11.022 ms                 |
| Optimize                  | 1.653 ms                  | 3.174 ms                  |
| BarrierTimeBeforeRank0    | 164.966 us                | 21.483 ms                 |
| AfterBackward             | 11.624 ms                 | 18.784 ms                 |
| BlockToStepN              | 176.517 ms                | 247.147 ms                |
| OneStep                   | 209.135 ms                | 280.973 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.313 ms                  | 4.131 ms                  |
| ProcessBack:UpdateCache   | 2.578 ms                  | 3.948 ms                  |
| ProcessBack:UpsertPq      | 5.781 ms                  | 11.380 ms                 |
| ProcessOneStep            | 11.535 ms                 | 18.737 ms                 |
| BlockToStepN              | 176.540 ms                | 247.084 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:56:57.002012 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=287, pq.top=287
W20240202 13:56:58.002010 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=291, pq.top=291
W20240202 13:56:59.002005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=295, pq.top=295
W20240202 13:57:00.002020 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=300, pq.top=300
[proc 3] 300 steps, total: 23.572, sample: 0.288, forward: 0.400, backward: 0.893, update: 0.171
[proc 1] 300 steps, total: 23.572, sample: 0.262, forward: 0.393, backward: 0.813, update: 0.151
[proc 2] 300 steps, total: 23.572, sample: 0.302, forward: 0.415, backward: 0.879, update: 0.178
[proc 0] 300 steps, total: 23.572, sample: 0.377, forward: 0.421, backward: 0.828, update: 0.166
W20240202 13:57:01.002004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=304, pq.top=304
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.510 ms                  | 19.583 ms                 |
| Forward                   | 4.385 ms                  | 6.533 ms                  |
| Backward                  | 8.554 ms                  | 11.022 ms                 |
| Optimize                  | 1.650 ms                  | 3.174 ms                  |
| BarrierTimeBeforeRank0    | 155.839 us                | 21.483 ms                 |
| AfterBackward             | 11.520 ms                 | 18.784 ms                 |
| BlockToStepN              | 179.576 ms                | 247.147 ms                |
| OneStep                   | 214.226 ms                | 280.973 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.308 ms                  | 4.131 ms                  |
| ProcessBack:UpdateCache   | 2.569 ms                  | 5.064 ms                  |
| ProcessBack:UpsertPq      | 5.774 ms                  | 11.582 ms                 |
| ProcessOneStep            | 11.495 ms                 | 18.737 ms                 |
| BlockToStepN              | 179.803 ms                | 247.084 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:02.002013 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=308, pq.top=308
W20240202 13:57:03.002009 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=312, pq.top=312
W20240202 13:57:04.002004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=316, pq.top=316
W20240202 13:57:05.002020 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=320, pq.top=320
W20240202 13:57:06.002005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=324, pq.top=324
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.527 ms                  | 19.583 ms                 |
| Forward                   | 4.362 ms                  | 6.533 ms                  |
| Backward                  | 8.553 ms                  | 11.022 ms                 |
| Optimize                  | 1.641 ms                  | 3.174 ms                  |
| BarrierTimeBeforeRank0    | 171.924 us                | 22.440 ms                 |
| AfterBackward             | 11.497 ms                 | 20.026 ms                 |
| BlockToStepN              | 184.234 ms                | 247.151 ms                |
| OneStep                   | 218.053 ms                | 281.642 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.308 ms                  | 4.131 ms                  |
| ProcessBack:UpdateCache   | 2.547 ms                  | 4.820 ms                  |
| ProcessBack:UpsertPq      | 5.754 ms                  | 11.380 ms                 |
| ProcessOneStep            | 11.465 ms                 | 20.002 ms                 |
| BlockToStepN              | 184.254 ms                | 247.090 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:07.002013 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=328, pq.top=328
W20240202 13:57:08.002009 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=332, pq.top=332
W20240202 13:57:09.002005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=338, pq.top=338
W20240202 13:57:10.002018 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=343, pq.top=343
W20240202 13:57:11.002005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=347, pq.top=347
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.559 ms                  | 19.676 ms                 |
| Forward                   | 4.359 ms                  | 6.533 ms                  |
| Backward                  | 8.551 ms                  | 11.022 ms                 |
| Optimize                  | 1.634 ms                  | 3.174 ms                  |
| BarrierTimeBeforeRank0    | 186.036 us                | 22.594 ms                 |
| AfterBackward             | 11.558 ms                 | 20.026 ms                 |
| BlockToStepN              | 183.769 ms                | 255.589 ms                |
| OneStep                   | 217.499 ms                | 298.880 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.311 ms                  | 4.131 ms                  |
| ProcessBack:UpdateCache   | 2.530 ms                  | 4.820 ms                  |
| ProcessBack:UpsertPq      | 5.815 ms                  | 11.708 ms                 |
| ProcessOneStep            | 11.535 ms                 | 18.737 ms                 |
| BlockToStepN              | 184.177 ms                | 255.498 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:12.002004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=351, pq.top=351
W20240202 13:57:13.030102 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=356, pq.top=356
W20240202 13:57:14.052533 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=362, pq.top=362
W20240202 13:57:15.052013 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=367, pq.top=367
W20240202 13:57:16.052011 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=373, pq.top=373
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.554 ms                  | 19.583 ms                 |
| Forward                   | 4.331 ms                  | 5.923 ms                  |
| Backward                  | 8.550 ms                  | 10.820 ms                 |
| Optimize                  | 1.639 ms                  | 3.143 ms                  |
| BarrierTimeBeforeRank0    | 220.395 us                | 22.440 ms                 |
| AfterBackward             | 11.520 ms                 | 18.784 ms                 |
| BlockToStepN              | 179.313 ms                | 255.589 ms                |
| OneStep                   | 214.185 ms                | 298.880 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.302 ms                  | 3.879 ms                  |
| ProcessBack:UpdateCache   | 2.512 ms                  | 4.514 ms                  |
| ProcessBack:UpsertPq      | 5.778 ms                  | 11.582 ms                 |
| ProcessOneStep            | 11.495 ms                 | 18.737 ms                 |
| BlockToStepN              | 178.376 ms                | 255.498 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:17.052004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=379, pq.top=379
W20240202 13:57:18.052014 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=385, pq.top=385
W20240202 13:57:19.052011 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=391, pq.top=391
W20240202 13:57:20.066726 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=398, pq.top=398
[proc 1] 400 steps, total: 20.324, sample: 0.286, forward: 0.381, backward: 0.878, update: 0.153
[proc 0] 400 steps, total: 20.324, sample: 0.368, forward: 0.403, backward: 0.846, update: 0.161
[proc 3] 400 steps, total: 20.324, sample: 0.307, forward: 0.388, backward: 0.898, update: 0.161
[proc 2] 400 steps, total: 20.324, sample: 0.345, forward: 0.409, backward: 0.862, update: 0.173
W20240202 13:57:21.067761 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=404, pq.top=404
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.559 ms                  | 19.583 ms                 |
| Forward                   | 4.312 ms                  | 5.923 ms                  |
| Backward                  | 8.558 ms                  | 10.820 ms                 |
| Optimize                  | 1.648 ms                  | 3.143 ms                  |
| BarrierTimeBeforeRank0    | 229.230 us                | 22.594 ms                 |
| AfterBackward             | 11.473 ms                 | 18.784 ms                 |
| BlockToStepN              | 174.763 ms                | 255.589 ms                |
| OneStep                   | 207.628 ms                | 298.880 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.296 ms                  | 3.879 ms                  |
| ProcessBack:UpdateCache   | 2.493 ms                  | 4.514 ms                  |
| ProcessBack:UpsertPq      | 5.727 ms                  | 11.582 ms                 |
| ProcessOneStep            | 11.452 ms                 | 18.737 ms                 |
| BlockToStepN              | 174.654 ms                | 255.498 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:22.090974 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=410, pq.top=410
W20240202 13:57:23.090015 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=416, pq.top=416
W20240202 13:57:24.122290 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=422, pq.top=422
W20240202 13:57:25.122006 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=427, pq.top=427
W20240202 13:57:26.122014 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=431, pq.top=431
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.581 ms                  | 19.583 ms                 |
| Forward                   | 4.299 ms                  | 5.923 ms                  |
| Backward                  | 8.559 ms                  | 10.820 ms                 |
| Optimize                  | 1.653 ms                  | 3.143 ms                  |
| BarrierTimeBeforeRank0    | 242.376 us                | 22.594 ms                 |
| AfterBackward             | 11.448 ms                 | 18.784 ms                 |
| BlockToStepN              | 169.189 ms                | 268.455 ms                |
| OneStep                   | 204.739 ms                | 307.977 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.296 ms                  | 3.564 ms                  |
| ProcessBack:UpdateCache   | 2.493 ms                  | 3.948 ms                  |
| ProcessBack:UpsertPq      | 5.723 ms                  | 11.380 ms                 |
| ProcessOneStep            | 11.422 ms                 | 18.737 ms                 |
| BlockToStepN              | 170.354 ms                | 268.341 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:27.122004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=435, pq.top=435
W20240202 13:57:28.122004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=439, pq.top=439
W20240202 13:57:29.131026 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=445, pq.top=445
W20240202 13:57:30.131011 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=448, pq.top=448
W20240202 13:57:31.143018 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=452, pq.top=452
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.583 ms                  | 19.676 ms                 |
| Forward                   | 4.287 ms                  | 5.602 ms                  |
| Backward                  | 8.566 ms                  | 10.746 ms                 |
| Optimize                  | 1.655 ms                  | 3.004 ms                  |
| BarrierTimeBeforeRank0    | 256.943 us                | 22.440 ms                 |
| AfterBackward             | 11.447 ms                 | 18.605 ms                 |
| BlockToStepN              | 171.109 ms                | 269.376 ms                |
| OneStep                   | 205.485 ms                | 312.111 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.298 ms                  | 3.564 ms                  |
| ProcessBack:UpdateCache   | 2.483 ms                  | 3.948 ms                  |
| ProcessBack:UpsertPq      | 5.734 ms                  | 11.582 ms                 |
| ProcessOneStep            | 11.422 ms                 | 18.570 ms                 |
| BlockToStepN              | 171.211 ms                | 269.325 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:32.143014 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=455, pq.top=455
W20240202 13:57:33.143004 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=459, pq.top=459
W20240202 13:57:34.143013 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=463, pq.top=463
W20240202 13:57:35.143011 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=466, pq.top=466
W20240202 13:57:36.148085 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=471, pq.top=471
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.583 ms                  | 19.786 ms                 |
| Forward                   | 4.283 ms                  | 5.602 ms                  |
| Backward                  | 8.567 ms                  | 10.746 ms                 |
| Optimize                  | 1.659 ms                  | 3.004 ms                  |
| BarrierTimeBeforeRank0    | 262.534 us                | 22.440 ms                 |
| AfterBackward             | 11.448 ms                 | 18.784 ms                 |
| BlockToStepN              | 174.868 ms                | 269.376 ms                |
| OneStep                   | 207.628 ms                | 312.111 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.300 ms                  | 3.073 ms                  |
| ProcessBack:UpdateCache   | 2.479 ms                  | 3.581 ms                  |
| ProcessBack:UpsertPq      | 5.739 ms                  | 11.708 ms                 |
| ProcessOneStep            | 11.422 ms                 | 18.737 ms                 |
| BlockToStepN              | 174.728 ms                | 269.325 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:37.171574 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=477, pq.top=477
W20240202 13:57:38.171010 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=482, pq.top=482
W20240202 13:57:39.171005 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=488, pq.top=488
W20240202 13:57:40.171015 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=494, pq.top=494
W20240202 13:57:41.171008 19185 grad_async_v1.h:429] Sleep in <BlockToStepN>, step_no=499, pq.top=499
[proc 2] 500 steps, total: 21.025, sample: 0.300, forward: 0.417, backward: 0.893, update: 0.166
[proc 0] 500 steps, total: 21.025, sample: 0.409, forward: 0.401, backward: 0.847, update: 0.173
[proc 1] 500 steps, total: 21.025, sample: 0.293, forward: 0.401, backward: 0.842, update: 0.165
[proc 3] 500 steps, total: 21.025, sample: 0.311, forward: 0.400, backward: 0.857, update: 0.169
Successfully xmh. training takes 99.18586325645447 seconds
before call kg_cache_controller.StopThreads()
W20240202 13:57:41.565979 19185 grad_async_v1.h:243] call StopThreads. PID = 18627
W20240202 13:57:41.566001 19185 grad_base.h:212] before processOneStepNegThread_.join();
W20240202 13:57:41.569813 19185 grad_base.h:214] after processOneStepNegThread_.join();
W20240202 13:57:41.569828 19185 grad_async_v1.h:245] call GradProcessingBase::StopThreads.
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 1.583 ms                  | 19.786 ms                 |
| Forward                   | 4.269 ms                  | 5.602 ms                  |
| Backward                  | 8.566 ms                  | 10.746 ms                 |
| Optimize                  | 1.661 ms                  | 3.004 ms                  |
| BarrierTimeBeforeRank0    | 262.534 us                | 22.440 ms                 |
| AfterBackward             | 11.457 ms                 | 18.784 ms                 |
| BlockToStepN              | 167.524 ms                | 269.376 ms                |
| OneStep                   | 203.469 ms                | 312.111 ms                |
+---------------------------+---------------------------+---------------------------+
W20240202 13:57:41.601356 19185 grad_async_v1.h:264] StopThreads done.
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
On rank0, prepare to call self.controller.StopThreads(), self=<python.controller_process.KGCacheControllerWrapper object at 0x7faa8207fe50>
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| ProcessBack:Shuffle       | 2.300 ms                  | 3.564 ms                  |
| ProcessBack:UpdateCache   | 2.467 ms                  | 3.948 ms                  |
| ProcessBack:UpsertPq      | 5.739 ms                  | 11.708 ms                 |
| ProcessOneStep            | 11.434 ms                 | 18.737 ms                 |
| BlockToStepN              | 167.439 ms                | 269.325 ms                |
+---------------------------+---------------------------+---------------------------+

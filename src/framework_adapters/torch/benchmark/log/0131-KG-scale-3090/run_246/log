WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 17:29:37.801502 35985 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_48', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=6, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=6, gpu=[0, 1, 2, 3, 4, 5], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [35985 sampler.py:454] Start PreSampling
WARNING [35985 sampler.py:532] Before construct renumbering_dict
WARNING [35985 sampler.py:555] PreSampling done
W20240207 17:49:48.918646 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 17:49:48.918841 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 17:49:48.918885 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 17:49:48.918920 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 17:49:48.918948 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 17:49:48.918978 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 17:49:48.919005 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 17:49:48.919049 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 17:49:48.919078 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 17:49:48.919114 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 17:49:48.919152 35985 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 17:49:48.919178 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 17:49:48.919209 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 17:49:48.919371 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 17:49:48.919411 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 17:49:48.919440 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 17:49:48.919492 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 17:49:48.919528 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 17:49:48.919556 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 17:49:48.919584 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 17:49:48.919610 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 17:49:48.919637 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 17:49:48.919665 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 17:49:48.919698 35985 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 17:49:48.919721 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 17:49:48.919751 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 17:49:48.919809 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240207 17:49:48.919844 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240207 17:49:48.919872 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240207 17:49:48.919899 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240207 17:49:48.919927 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240207 17:49:48.919965 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240207 17:49:48.919991 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240207 17:49:48.920022 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240207 17:49:48.920063 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240207 17:49:48.920097 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240207 17:49:48.920122 35985 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240207 17:49:48.920147 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240207 17:49:48.920172 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240207 17:49:48.920233 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240207 17:49:48.920261 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240207 17:49:48.920289 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240207 17:49:48.920318 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240207 17:49:48.920344 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240207 17:49:48.920374 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240207 17:49:48.920406 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240207 17:49:48.920441 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240207 17:49:48.920471 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240207 17:49:48.920497 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240207 17:49:48.920532 35985 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240207 17:49:48.920555 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240207 17:49:48.920581 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240207 17:49:48.920636 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240207 17:49:48.920670 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240207 17:49:48.920701 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240207 17:49:48.920732 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240207 17:49:48.920768 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240207 17:49:48.920795 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240207 17:49:48.920821 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240207 17:49:48.920854 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240207 17:49:48.920883 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240207 17:49:48.920919 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240207 17:49:48.920949 35985 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240207 17:49:48.920972 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240207 17:49:48.921003 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240207 17:49:48.921056 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_0 [1000000]0x100017df6000 7.629 MB
W20240207 17:49:48.921088 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_1 [1000000]0x100018599000 7.629 MB
W20240207 17:49:48.921118 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_2 [1000000]0x100018d3c000 7.629 MB
W20240207 17:49:48.921149 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_3 [1000000]0x1000194df000 7.629 MB
W20240207 17:49:48.921183 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_4 [1000000]0x100019c82000 7.629 MB
W20240207 17:49:48.921213 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_5 [1000000]0x10001a425000 7.629 MB
W20240207 17:49:48.921244 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_6 [1000000]0x10001abc8000 7.629 MB
W20240207 17:49:48.921288 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_7 [1000000]0x10001b36b000 7.629 MB
W20240207 17:49:48.921316 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_8 [1000000]0x10001bb0e000 7.629 MB
W20240207 17:49:48.921350 35985 IPCTensor.h:369] NewIPCTensor: cached_sampler_r5_9 [1000000]0x10001c2b1000 7.629 MB
W20240207 17:49:48.921378 35985 IPCTensor.h:369] NewIPCTensor: step_r5 [10]0x10001ca54000 80 B 
W20240207 17:49:48.921402 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r5 [1]0x10001ca56000 8 B 
W20240207 17:49:48.921428 35985 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r5 [1]0x10001ca58000 8 B 
W20240207 17:49:49.357708 35985 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10001ca5a000 128.2 GB
W20240207 17:53:38.503408 35985 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10202b692000 328.3 MB
{0: Graph(num_nodes=16391033, num_edges=60554486,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=22850318, num_edges=74912573,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=16459669, num_edges=67428404,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=17554345, num_edges=53272616,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=17824082, num_edges=71836124,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 5: Graph(num_nodes=18730250, num_edges=46391216,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 16391033 N 60554486 E
MertisPartition: part 1 has 22850318 N 74912573 E
MertisPartition: part 2 has 16459669 N 67428404 E
MertisPartition: part 3 has 17554345 N 53272616 E
MertisPartition: part 4 has 17824082 N 71836124 E
MertisPartition: part 5 has 18730250 N 46391216 E
Rank0: cached key size 717117
Rank1: cached key size 717117
Rank2: cached key size 717117
Rank3: cached key size 717117
Rank4: cached key size 717117
Rank5: cached key size 717117
Before renumbering graph:  {'_ID': tensor([       4,        5,       14,  ..., 12367661, 70093925, 61280605]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
After renumbering graph:  {'_ID': tensor([ 4302852,  4302879,   366630,  ..., 64210417, 11117239, 57128709]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 2])}
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=16391033, num_edges=60554486,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 1941.216 seconds
[Rank1] pid = 36961
[Rank2] pid = 37058
[Rank3] pid = 37127
[Rank4] pid = 37195
INFO [35985 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [36961 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [37058 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [37127 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [37195 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [37262 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 5
INFO [37195 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [37262 distributed_c10d.py:476] Rank 5: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [37058 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [37127 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [35985 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
INFO [36961 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 6 nodes.
W20240207 18:02:06.758682 37196 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_4 [4302707, 400]; dev=4; size=6.412 GB
W20240207 18:02:06.760365 37263 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240207 18:02:06.760998 37128 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240207 18:02:06.761132 36962 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240207 18:02:06.761243 37326 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_5 [4302707, 400]; dev=5; size=6.412 GB
W20240207 18:02:06.761256 37059 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240207 18:02:06.842356 36962 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x10203fee3000 7.629 MB
W20240207 18:02:06.842393 37128 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102040686000 7.629 MB
W20240207 18:02:06.842455 37326 IPCTensor.h:369] NewIPCTensor: input_keys_5 [1000000]0x102040e29000 7.629 MB
W20240207 18:02:06.842460 37263 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x1020415cc000 7.629 MB
W20240207 18:02:06.842470 37196 IPCTensor.h:369] NewIPCTensor: input_keys_4 [1000000]0x102041d6f000 7.629 MB
W20240207 18:02:06.842624 36962 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x102042514000 7.629 MB
W20240207 18:02:06.842727 37263 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x10204345a000 7.629 MB
W20240207 18:02:06.842727 37059 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x102042cb7000 7.629 MB
W20240207 18:02:06.842753 36962 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x102043bfd000 1.49 GB
W20240207 18:02:06.842805 37196 IPCTensor.h:369] NewIPCTensor: input_keys_neg_4 [1000000]0x1020a31e0000 7.629 MB
W20240207 18:02:06.842816 37326 IPCTensor.h:369] NewIPCTensor: input_keys_neg_5 [1000000]0x1020a3983000 7.629 MB
W20240207 18:02:06.842824 37263 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x1020a48c9000 1.49 GB
W20240207 18:02:06.842823 37128 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x1020a4126000 7.629 MB
W20240207 18:02:06.842872 36962 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x102103eac000 1.49 GB
W20240207 18:02:06.842897 37263 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x10216348f000 1.49 GB
W20240207 18:02:06.842926 37196 IPCTensor.h:369] NewIPCTensor: backward_grads_4 [1000000, 400]0x1021c2a72000 1.49 GB
W20240207 18:02:06.842932 37128 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102222055000 1.49 GB
W20240207 18:02:06.842939 36962 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240207 18:02:06.842940 37326 IPCTensor.h:369] NewIPCTensor: backward_grads_5 [1000000, 400]0x102281638000 1.49 GB
W20240207 18:02:06.842990 37196 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_4 [1000000, 400]0x1022e0c1b000 1.49 GB
W20240207 18:02:06.842996 37128 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x1023401fe000 1.49 GB
W20240207 18:02:06.842999 37263 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 18:02:06.843006 37059 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10239f7e1000 7.629 MB
W20240207 18:02:06.843024 37326 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_5 [1000000, 400]0x10239ff84000 1.49 GB
W20240207 18:02:06.843055 37196 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240207 18:02:06.843080 37326 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240207 18:02:06.843086 37128 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 18:02:06.844681 37059 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1023ff567000 1.49 GB
W20240207 18:02:06.844780 37059 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x10245eb4a000 1.49 GB
W20240207 18:02:06.844837 37059 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 18:02:06.853336 36962 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240207 18:02:06.853356 37263 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 18:02:06.853366 37196 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_4_gpu [1000000, 400]; dev=4; size=1.49 GB
W20240207 18:02:06.853394 37128 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240207 18:02:06.853397 37326 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_5_gpu [1000000, 400]; dev=5; size=1.49 GB
W20240207 18:02:06.853425 37059 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
cudaHostRegister 0x10001ca5a000
4: KnownLocalCachedEmbedding init done
WARNING [37195 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001ca5a000
5: KnownLocalCachedEmbedding init done
WARNING [37262 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank5] pid = 37262
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828), (17210828, 21513535), (21513535, 25816242)]
cudaHostRegister 0x10001ca5a000
0: KnownLocalCachedEmbedding init done
WARNING [35985 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001ca5a000
3: KnownLocalCachedEmbedding init done
WARNING [37127 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001ca5a000
2: KnownLocalCachedEmbedding init done
WARNING [37058 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10001ca5a000
1: KnownLocalCachedEmbedding init done
WARNING [36961 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 18:02:47.268898 36962 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 6
I20240207 18:02:47.269235 37128 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240207 18:02:47.269336 37196 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240207 18:02:47.269527 37263 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240207 18:02:47.269598 37326 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
I20240207 18:02:47.269667 37059 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 6
W20240207 18:02:47.271711 37263 grad_base.h:55] KGCacheController, config={
        "num_gpus": 6,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240207 18:02:47.272009 37263 grad_base.h:184] Init GradProcessingBase done
I20240207 18:02:59.744364 37263 grad_async_v2.h:42] Use main thread to update emb.
W20240207 18:02:59.744527 37263 kg_controller.h:78] after init GradAsyncProcessingV2
I20240207 18:02:59.744537 37263 kg_controller.h:84] Construct KGCacheController done
E20240207 18:03:00.349462 37326 recstore.cc:66] init folly done
E20240207 18:03:00.349465 37128 recstore.cc:66] init folly done
E20240207 18:03:00.349510 36962 recstore.cc:66] init folly done
E20240207 18:03:00.349536 37196 recstore.cc:66] init folly done
E20240207 18:03:00.349536 37263 recstore.cc:66] init folly done
E20240207 18:03:00.349578 37059 recstore.cc:66] init folly done
I20240207 18:03:00.350507 37263 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240207 18:03:14.800763 37732 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 18:03:14.801137 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 127.057 us                | 296.487 us                |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:15.979513 37732 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 18:03:15.979676 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 18:03:17.469974 37732 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 18:03:17.470109 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
I20240207 18:03:18.307994 37326 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 6
E20240207 18:03:18.470029 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 18:03:19.128577 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
I20240207 18:03:19.260830 37128 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
E20240207 18:03:19.470013 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 131.179 us                | 265.017 us                |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:20.506014 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 18:03:20.525766 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 18:03:20.727427 37263 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240207 18:03:21.422089 37059 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
E20240207 18:03:21.525009 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=9
W20240207 18:03:22.973142 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 18:03:22.988662 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 18:03:23.092463 37196 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
I20240207 18:03:23.926771 36962 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 6
E20240207 18:03:23.988030 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=3
W20240207 18:03:24.133625 37732 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 131.326 us                | 262.261 us                |
| ProcessBack:Shuffle       | 234.561 ms                | 266.162 ms                |
+---------------------------+---------------------------+---------------------------+
E20240207 18:03:25.738137 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 18:03:25.824537 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240207 18:03:25.835922 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 18:03:26.738014 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=25
W20240207 18:03:26.845992 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=8, pq.top=8
W20240207 18:03:26.980604 37732 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 19.368 ms                 | 271.372 ms                |
| Forward                   | 5.359 ms                  | 511.320 ms                |
| Backward                  | 5.013 ms                  | 269.309 ms                |
| Optimize                  | 1.994 ms                  | 38.857 ms                 |
| BarrierTimeBeforeRank0    | 28.762 us                 | 69.092 ms                 |
| AfterBackward             | 29.596 ms                 | 980.085 ms                |
| BlockToStepN              | 693.920 us                | 24.201 ms                 |
| OneStep                   | 129.304 ms                | 1.901 s                   |
+---------------------------+---------------------------+---------------------------+
E20240207 18:03:27.452032 37447 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=13, sample_step_cpp_seen_[rank]=12
E20240207 18:03:27.740633 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=222
W20240207 18:03:28.161522 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
E20240207 18:03:28.740013 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1860
W20240207 18:03:28.949283 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=15, pq.top=15
W20240207 18:03:29.172833 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
E20240207 18:03:29.740461 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=3
W20240207 18:03:29.990023 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=23, pq.top=23
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 339.515 us                | 7.960 ms                  |
| ProcessBack:Shuffle       | 4.830 ms                  | 234.561 ms                |
| ProcessBack:UpdateCache   | 6.377 ms                  | 480.203 ms                |
| ProcessBack:UpsertPq      | 24.000 ms                 | 100.438 ms                |
| ProcessOneStep            | 79.352 ms                 | 1.371 s                   |
| BlockToStepN              | 1.066 ms                  | 24.129 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:30.423813 37732 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
E20240207 18:03:30.740012 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=195
W20240207 18:03:31.486035 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
W20240207 18:03:31.692945 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=31, pq.top=31
E20240207 18:03:31.740012 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=77
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.607 ms                  | 271.372 ms                |
| Forward                   | 5.359 ms                  | 511.320 ms                |
| Backward                  | 5.255 ms                  | 269.309 ms                |
| Optimize                  | 2.123 ms                  | 38.857 ms                 |
| BarrierTimeBeforeRank0    | 2.514 ms                  | 69.092 ms                 |
| AfterBackward             | 79.408 ms                 | 1.371 s                   |
| BlockToStepN              | 1.140 ms                  | 24.201 ms                 |
| OneStep                   | 118.574 ms                | 1.901 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:32.590229 37732 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end9
W20240207 18:03:32.710062 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=39, pq.top=39
E20240207 18:03:32.740011 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1943
E20240207 18:03:33.711230 37447 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=47, sample_step_cpp_seen_[rank]=46
E20240207 18:03:33.740010 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=150
W20240207 18:03:33.866191 37732 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
E20240207 18:03:34.740008 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=646
W20240207 18:03:34.827739 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=49, pq.top=49
W20240207 18:03:34.870052 37732 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 371.839 us                | 6.403 ms                  |
| ProcessBack:Shuffle       | 4.878 ms                  | 234.561 ms                |
| ProcessBack:UpdateCache   | 7.291 ms                  | 480.203 ms                |
| ProcessBack:UpsertPq      | 45.531 ms                 | 102.254 ms                |
| ProcessOneStep            | 83.894 ms                 | 1.011 s                   |
| BlockToStepN              | 824.227 us                | 6.326 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 18:03:35.740015 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=149
W20240207 18:03:35.835801 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=58, pq.top=57
W20240207 18:03:35.948547 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end9
E20240207 18:03:36.740021 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=153
W20240207 18:03:37.175055 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.292 ms                  | 172.864 ms                |
| Forward                   | 5.255 ms                  | 7.977 ms                  |
| Backward                  | 5.111 ms                  | 37.279 ms                 |
| Optimize                  | 2.146 ms                  | 15.369 ms                 |
| BarrierTimeBeforeRank0    | 182.146 us                | 69.080 ms                 |
| AfterBackward             | 81.343 ms                 | 1.012 s                   |
| BlockToStepN              | 811.785 us                | 24.201 ms                 |
| OneStep                   | 117.054 ms                | 1.401 s                   |
+---------------------------+---------------------------+---------------------------+
E20240207 18:03:37.740012 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2112
W20240207 18:03:37.953400 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=75, pq.top=75
W20240207 18:03:38.355020 37732 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240207 18:03:38.711009 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=5, step_no=81, sample_step_cpp_seen_[rank]=80
E20240207 18:03:38.740011 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=6576
W20240207 18:03:39.429061 37732 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240207 18:03:39.740018 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 435.405 us                | 5.647 ms                  |
| ProcessBack:Shuffle       | 4.964 ms                  | 16.410 ms                 |
| ProcessBack:UpdateCache   | 7.206 ms                  | 13.401 ms                 |
| ProcessBack:UpsertPq      | 48.664 ms                 | 100.438 ms                |
| ProcessOneStep            | 84.470 ms                 | 1.011 s                   |
| BlockToStepN              | 605.602 us                | 24.129 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:40.441355 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=91, pq.top=90
W20240207 18:03:40.535079 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end2
E20240207 18:03:40.740010 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=55
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 19.982, sample: 1.333, forward: 1.059, backward: 0.986, update: 0.263
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 18.311, sample: 1.470, forward: 1.035, backward: 0.917, update: 0.289
train_sampler.Prefill()
before start barrier
start train
[proc 5] 100 steps, total: 23.096, sample: 1.406, forward: 1.013, backward: 0.842, update: 0.287
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 22.143, sample: 1.253, forward: 1.026, backward: 0.893, update: 0.276
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 17.477, sample: 1.464, forward: 0.980, backward: 0.912, update: 0.273
train_sampler.Prefill()
-------Step 0-------
tensor([24491323,   694392,   466195,   694405,   694417,   694426,  5048484,
          694438,   694451,   370832]) tensor([  180786, 52276438, 50166237,  5520570, 76855190, 28461133, 56880537,
        19778506, 77177477,  3815149])
-------Step 1-------
tensor([24491323,   694392,   466195,   694405,   694417,   694426,  5048484,
          694438,   694451,   370832]) tensor([81601490, 84756205,  4719594,  1251627, 69429213, 67010478, 32539047,
        50886079, 47769047, 40523405])
-------Step 2-------
tensor([   13802,    13829,    13853,    29553, 35556728,    13878, 35886112,
           13896, 24491323, 85306196]) tensor([10271908, 32209346, 17847123, 51292919, 67157805, 37793545, 62561191,
        44912050,  6586655, 24797117])
-------Step 3-------
tensor([   13802,    13829,    13853,    29553, 35556728,    13878, 35886112,
           13896, 24491323, 85306196]) tensor([31392389, 20008008, 11556006, 61825560, 12113095, 11607324, 12312869,
        85010969, 83548116, 63435940])
-------Step 4-------
tensor([ 644341,   41020,   72785, 9663251,   72805,  375329,   72827, 4440977,
          72853,  644359]) tensor([45709761, 83918620, 17669832, 25498929, 52168689, 76036978, 79609078,
        32909078, 34313517, 83040699])
-------Step 5-------
tensor([ 644341,   41020,   72785, 9663251,   72805,  375329,   72827, 4440977,
          72853,  644359]) tensor([ 4084567,   148211,  8715984, 83362752, 82492616, 34502013, 75147444,
        61861549, 71161398, 27906726])
-------Step 6-------
tensor([  130971,   130989, 24491323,   131018,    35882,   131044,   473613,
          473648, 48161734,  4433681]) tensor([45393796, 43942393, 30822754, 69373758, 47119397,  1135505, 10579465,
         4995145, 42216482, 23030589])
-------Step 7-------
tensor([  130971,   130989, 24491323,   131018,    35882,   131044,   473613,
          473648, 48161734,  4433681]) tensor([25519818, 34912018, 53549425, 48427048, 62458393, 11743751,  2017181,
        43679934, 57558639, 20343684])
-------Step 8-------
tensor([  349192,   188774,   188800,  5396530,  4309110,    84364,    75684,
           75735,   188824, 39629398]) tensor([78157560, 22125863, 74220704, 54259463,  7888419, 16238411, 20311244,
        36042884, 69416863, 37430192])
-------Step 9-------
tensor([  349192,   188774,   188800,  5396530,  4309110,    84364,    75684,
           75735,   188824, 39629398]) tensor([  411891, 50236392, 82537163, 28686235, 67660074, 66433393, 60278561,
        37336649, 57011826, 10514226])
before start barrier
start train
[proc 0] 100 steps, total: 20.676, sample: 2.044, forward: 1.037, backward: 0.809, update: 0.287
E20240207 18:03:41.740016 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=121
W20240207 18:03:41.750805 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.880 ms                  | 172.864 ms                |
| Forward                   | 5.185 ms                  | 7.977 ms                  |
| Backward                  | 5.152 ms                  | 37.279 ms                 |
| Optimize                  | 2.169 ms                  | 15.369 ms                 |
| BarrierTimeBeforeRank0    | 1.249 ms                  | 69.080 ms                 |
| AfterBackward             | 83.932 ms                 | 1.012 s                   |
| BlockToStepN              | 701.539 us                | 31.835 ms                 |
| OneStep                   | 114.904 ms                | 1.401 s                   |
+---------------------------+---------------------------+---------------------------+
E20240207 18:03:42.740012 37447 parallel_pq_v2.h:79] insert failed, size(hashtable)=2483
W20240207 18:03:42.760893 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240207 18:03:43.082401 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=104, pq.top=103
E20240207 18:03:43.740015 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=27063
W20240207 18:03:43.860807 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end3
E20240207 18:03:44.081256 37447 grad_async_v2.h:404] Stalled in ProcessBackward: rank=5, step_no=115, sample_step_cpp_seen_[rank]=114
E20240207 18:03:44.740016 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=3396
W20240207 18:03:44.940233 37732 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 334.668 us                | 4.829 ms                  |
| ProcessBack:Shuffle       | 5.118 ms                  | 16.410 ms                 |
| ProcessBack:UpdateCache   | 7.195 ms                  | 13.401 ms                 |
| ProcessBack:UpsertPq      | 48.050 ms                 | 100.438 ms                |
| ProcessOneStep            | 82.818 ms                 | 1.277 s                   |
| BlockToStepN              | 620.675 us                | 31.753 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:45.555711 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=125, pq.top=125
E20240207 18:03:45.740013 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=19619
W20240207 18:03:45.975351 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240207 18:03:46.740013 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1222
W20240207 18:03:47.026690 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=131, pq.top=131
W20240207 18:03:47.029611 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.245 ms                  | 172.864 ms                |
| Forward                   | 5.166 ms                  | 7.977 ms                  |
| Backward                  | 5.233 ms                  | 37.279 ms                 |
| Optimize                  | 2.177 ms                  | 15.369 ms                 |
| BarrierTimeBeforeRank0    | 169.414 us                | 69.080 ms                 |
| AfterBackward             | 82.764 ms                 | 1.278 s                   |
| BlockToStepN              | 712.522 us                | 31.925 ms                 |
| OneStep                   | 111.924 ms                | 1.401 s                   |
+---------------------------+---------------------------+---------------------------+
E20240207 18:03:47.740016 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=46411
W20240207 18:03:48.130563 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=141, pq.top=141
W20240207 18:03:48.289250 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end3
E20240207 18:03:48.740015 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2294
E20240207 18:03:49.081008 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=5, step_no=146, sample_step_cpp_seen_[rank]=145
W20240207 18:03:49.289494 37732 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240207 18:03:49.749128 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 18:03:50.345423 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=155, pq.top=155
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 426.986 us                | 7.184 ms                  |
| ProcessBack:Shuffle       | 5.092 ms                  | 12.803 ms                 |
| ProcessBack:UpdateCache   | 7.154 ms                  | 9.517 ms                  |
| ProcessBack:UpsertPq      | 43.086 ms                 | 97.789 ms                 |
| ProcessOneStep            | 81.284 ms                 | 1.011 s                   |
| BlockToStepN              | 778.088 us                | 31.844 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:50.401777 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end6
E20240207 18:03:50.749009 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=35056
W20240207 18:03:51.594219 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end5
E20240207 18:03:51.755543 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.817 ms                  | 124.150 ms                |
| Forward                   | 5.157 ms                  | 7.977 ms                  |
| Backward                  | 5.294 ms                  | 13.418 ms                 |
| Optimize                  | 2.200 ms                  | 8.352 ms                  |
| BarrierTimeBeforeRank0    | 495.200 us                | 69.080 ms                 |
| AfterBackward             | 79.413 ms                 | 1.012 s                   |
| BlockToStepN              | 884.695 us                | 41.650 ms                 |
| OneStep                   | 110.660 ms                | 1.300 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:03:52.620334 37732 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
E20240207 18:03:52.755010 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=48473
W20240207 18:03:52.863025 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=171, pq.top=171
W20240207 18:03:53.737385 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end0
E20240207 18:03:53.755045 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=9
W20240207 18:03:53.868453 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=181, pq.top=181
E20240207 18:03:54.081008 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=182, sample_step_cpp_seen_[rank]=181
E20240207 18:03:54.755012 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1557
W20240207 18:03:54.827395 37732 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240207 18:03:54.944932 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=184, pq.top=184
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 333.641 us                | 5.716 ms                  |
| ProcessBack:Shuffle       | 5.118 ms                  | 11.942 ms                 |
| ProcessBack:UpdateCache   | 6.891 ms                  | 9.373 ms                  |
| ProcessBack:UpsertPq      | 36.922 ms                 | 97.789 ms                 |
| ProcessOneStep            | 78.512 ms                 | 1.011 s                   |
| BlockToStepN              | 871.159 us                | 41.704 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 18:03:55.755008 37447 parallel_pq_v2.h:79] insert failed, size(hashtable)=68970
W20240207 18:03:55.855193 37732 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
W20240207 18:03:56.003001 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=195, pq.top=194
E20240207 18:03:56.755023 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=6708
W20240207 18:03:56.970901 37732 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end9
W20240207 18:03:57.273738 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=199, pq.top=199
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.480 ms                  | 124.150 ms                |
| Forward                   | 5.180 ms                  | 8.346 ms                  |
| Backward                  | 5.321 ms                  | 13.418 ms                 |
| Optimize                  | 2.260 ms                  | 8.352 ms                  |
| BarrierTimeBeforeRank0    | 523.226 us                | 80.500 ms                 |
| AfterBackward             | 78.554 ms                 | 1.012 s                   |
| BlockToStepN              | 986.623 us                | 48.720 ms                 |
| OneStep                   | 109.728 ms                | 1.300 s                   |
+---------------------------+---------------------------+---------------------------+
[proc 3] 200 steps, total: 16.023, sample: 1.006, forward: 0.533, backward: 0.682, update: 0.221
[proc 5] 200 steps, total: 16.023, sample: 1.052, forward: 0.498, backward: 0.576, update: 0.269
[proc 1] 200 steps, total: 16.023, sample: 1.088, forward: 0.487, backward: 0.581, update: 0.224
[proc 2] 200 steps, total: 16.023, sample: 1.242, forward: 0.587, backward: 0.564, update: 0.255
[proc 0] 200 steps, total: 16.022, sample: 1.134, forward: 0.522, backward: 0.572, update: 0.268
[proc 4] 200 steps, total: 16.023, sample: 1.269, forward: 0.512, backward: 0.585, update: 0.237
E20240207 18:03:57.755100 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=33472
W20240207 18:03:58.045140 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
W20240207 18:03:58.296941 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=209, pq.top=208
E20240207 18:03:58.755012 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=3137
E20240207 18:03:59.133004 37447 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=214, sample_step_cpp_seen_[rank]=213
W20240207 18:03:59.297482 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end5
E20240207 18:03:59.755012 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=776
W20240207 18:04:00.020820 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=215, pq.top=215
W20240207 18:04:00.308795 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 297.925 us                | 4.694 ms                  |
| ProcessBack:Shuffle       | 5.089 ms                  | 11.942 ms                 |
| ProcessBack:UpdateCache   | 6.765 ms                  | 9.373 ms                  |
| ProcessBack:UpsertPq      | 35.319 ms                 | 97.789 ms                 |
| ProcessOneStep            | 78.112 ms                 | 1.011 s                   |
| BlockToStepN              | 963.403 us                | 53.115 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 18:04:00.755008 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=3744
W20240207 18:04:01.090206 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=225, pq.top=225
W20240207 18:04:01.308888 37732 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
E20240207 18:04:01.755012 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=6616
W20240207 18:04:02.269567 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=229, pq.top=229
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.069 ms                  | 124.150 ms                |
| Forward                   | 5.241 ms                  | 8.346 ms                  |
| Backward                  | 5.356 ms                  | 13.418 ms                 |
| Optimize                  | 2.280 ms                  | 8.352 ms                  |
| BarrierTimeBeforeRank0    | 1.259 ms                  | 80.500 ms                 |
| AfterBackward             | 77.205 ms                 | 1.012 s                   |
| BlockToStepN              | 1.077 ms                  | 53.207 ms                 |
| OneStep                   | 110.660 ms                | 1.300 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:02.327674 37732 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240207 18:04:02.755010 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=468
W20240207 18:04:03.375941 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=239, pq.top=239
W20240207 18:04:03.472308 37732 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
E20240207 18:04:03.755019 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=36456
E20240207 18:04:04.132009 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=5, step_no=245, sample_step_cpp_seen_[rank]=244
W20240207 18:04:04.560899 37732 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
E20240207 18:04:04.755026 37738 parallel_pq_v2.h:79] insert failed, size(hashtable)=7611
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 281.773 us                | 4.671 ms                  |
| ProcessBack:Shuffle       | 5.098 ms                  | 11.618 ms                 |
| ProcessBack:UpdateCache   | 6.631 ms                  | 9.208 ms                  |
| ProcessBack:UpsertPq      | 34.646 ms                 | 97.789 ms                 |
| ProcessOneStep            | 76.700 ms                 | 1.011 s                   |
| BlockToStepN              | 1.066 ms                  | 55.271 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:05.562561 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
E20240207 18:04:05.761355 37735 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 18:04:06.037029 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=253, pq.top=253
E20240207 18:04:06.761015 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=50156
W20240207 18:04:06.806641 37732 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.805 ms                  | 117.158 ms                |
| Forward                   | 5.255 ms                  | 8.346 ms                  |
| Backward                  | 5.317 ms                  | 12.710 ms                 |
| Optimize                  | 2.329 ms                  | 7.253 ms                  |
| BarrierTimeBeforeRank0    | 1.697 ms                  | 80.500 ms                 |
| AfterBackward             | 76.607 ms                 | 1.012 s                   |
| BlockToStepN              | 1.207 ms                  | 55.425 ms                 |
| OneStep                   | 109.728 ms                | 1.194 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:07.658318 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=262, pq.top=262
E20240207 18:04:07.761008 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=10136
W20240207 18:04:07.832603 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
W20240207 18:04:08.751420 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=273, pq.top=273
E20240207 18:04:08.761009 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=166469
W20240207 18:04:08.902242 37732 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end5
E20240207 18:04:09.377372 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=277, sample_step_cpp_seen_[rank]=276
E20240207 18:04:09.761010 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2486
W20240207 18:04:09.966600 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end8
W20240207 18:04:10.296305 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=279, pq.top=279
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 423.820 us                | 5.600 ms                  |
| ProcessBack:Shuffle       | 5.122 ms                  | 11.618 ms                 |
| ProcessBack:UpdateCache   | 6.632 ms                  | 9.208 ms                  |
| ProcessBack:UpsertPq      | 34.109 ms                 | 96.550 ms                 |
| ProcessOneStep            | 76.700 ms                 | 1.011 s                   |
| BlockToStepN              | 1.292 ms                  | 73.989 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 18:04:10.761018 37763 parallel_pq_v2.h:79] insert failed, size(hashtable)=30698
W20240207 18:04:10.980232 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end6
W20240207 18:04:11.300926 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=289, pq.top=289
E20240207 18:04:11.761011 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2782
W20240207 18:04:12.036942 37732 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.622 ms                  | 117.158 ms                |
| Forward                   | 5.260 ms                  | 9.278 ms                  |
| Backward                  | 5.317 ms                  | 12.710 ms                 |
| Optimize                  | 2.329 ms                  | 7.253 ms                  |
| BarrierTimeBeforeRank0    | 1.661 ms                  | 80.500 ms                 |
| AfterBackward             | 76.635 ms                 | 1.012 s                   |
| BlockToStepN              | 1.480 ms                  | 74.093 ms                 |
| OneStep                   | 109.479 ms                | 1.194 s                   |
+---------------------------+---------------------------+---------------------------+
[proc 0] 300 steps, total: 15.231, sample: 0.827, forward: 0.545, backward: 0.561, update: 0.272
[proc 1] 300 steps, total: 15.231, sample: 1.393, forward: 0.533, backward: 0.558, update: 0.233
[proc 5] 300 steps, total: 15.231, sample: 0.932, forward: 0.494, backward: 0.559, update: 0.231
[proc 3] 300 steps, total: 15.231, sample: 0.968, forward: 0.527, backward: 0.618, update: 0.234
[proc 4] 300 steps, total: 15.231, sample: 1.217, forward: 0.489, backward: 0.573, update: 0.227
[proc 2] 300 steps, total: 15.231, sample: 1.052, forward: 0.503, backward: 0.515, update: 0.215
E20240207 18:04:12.761009 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=39847
W20240207 18:04:13.100921 37732 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
E20240207 18:04:13.761011 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2252
W20240207 18:04:14.149286 37732 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
W20240207 18:04:14.384855 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=309, pq.top=309
E20240207 18:04:14.761015 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=31108
W20240207 18:04:15.313043 37732 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 401.868 us                | 14.449 ms                 |
| ProcessBack:Shuffle       | 5.190 ms                  | 12.803 ms                 |
| ProcessBack:UpdateCache   | 6.736 ms                  | 9.373 ms                  |
| ProcessBack:UpsertPq      | 33.172 ms                 | 97.789 ms                 |
| ProcessOneStep            | 76.700 ms                 | 1.011 s                   |
| BlockToStepN              | 1.506 ms                  | 73.989 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:15.530339 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=319, pq.top=319
E20240207 18:04:15.614742 37447 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=320, sample_step_cpp_seen_[rank]=319
E20240207 18:04:15.761008 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=12200
W20240207 18:04:16.443487 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end1
E20240207 18:04:16.761010 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=2633
W20240207 18:04:16.927091 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=321, pq.top=321
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.425 ms                  | 117.158 ms                |
| Forward                   | 5.289 ms                  | 9.278 ms                  |
| Backward                  | 5.294 ms                  | 12.710 ms                 |
| Optimize                  | 2.343 ms                  | 7.779 ms                  |
| BarrierTimeBeforeRank0    | 1.684 ms                  | 80.500 ms                 |
| AfterBackward             | 76.635 ms                 | 1.077 s                   |
| BlockToStepN              | 1.645 ms                  | 74.093 ms                 |
| OneStep                   | 108.900 ms                | 1.300 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:17.562435 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end7
E20240207 18:04:17.761011 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=21604
W20240207 18:04:18.044354 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=332, pq.top=332
W20240207 18:04:18.714735 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
E20240207 18:04:18.761011 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=12375
W20240207 18:04:19.594710 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=337, pq.top=337
E20240207 18:04:19.761018 37761 parallel_pq_v2.h:79] insert failed, size(hashtable)=23530
W20240207 18:04:19.802438 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 427.363 us                | 10.738 ms                 |
| ProcessBack:Shuffle       | 5.230 ms                  | 11.965 ms                 |
| ProcessBack:UpdateCache   | 6.766 ms                  | 9.345 ms                  |
| ProcessBack:UpsertPq      | 31.981 ms                 | 97.789 ms                 |
| ProcessOneStep            | 76.560 ms                 | 1.077 s                   |
| BlockToStepN              | 1.662 ms                  | 73.989 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:20.722777 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=347, pq.top=347
E20240207 18:04:20.761013 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=33467
W20240207 18:04:20.902706 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
E20240207 18:04:21.274451 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=352, sample_step_cpp_seen_[rank]=351
E20240207 18:04:21.761014 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=3808
W20240207 18:04:21.905010 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.248 ms                  | 117.158 ms                |
| Forward                   | 5.279 ms                  | 9.278 ms                  |
| Backward                  | 5.279 ms                  | 12.096 ms                 |
| Optimize                  | 2.354 ms                  | 7.644 ms                  |
| BarrierTimeBeforeRank0    | 1.743 ms                  | 80.500 ms                 |
| AfterBackward             | 76.607 ms                 | 1.012 s                   |
| BlockToStepN              | 1.805 ms                  | 60.714 ms                 |
| OneStep                   | 109.445 ms                | 1.194 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:22.364519 37263 grad_async_v2.h:257] pq is empty
W20240207 18:04:22.482319 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=355, pq.top=355
E20240207 18:04:22.761013 37447 parallel_pq_v2.h:79] insert failed, size(hashtable)=36180
W20240207 18:04:22.939754 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
W20240207 18:04:23.561107 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=363, pq.top=363
E20240207 18:04:23.761018 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=73824
W20240207 18:04:23.971526 37732 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
E20240207 18:04:24.761016 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=4695
W20240207 18:04:25.089464 37732 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end2
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 396.584 us                | 6.210 ms                  |
| ProcessBack:Shuffle       | 5.262 ms                  | 14.334 ms                 |
| ProcessBack:UpdateCache   | 6.818 ms                  | 9.482 ms                  |
| ProcessBack:UpsertPq      | 32.048 ms                 | 99.986 ms                 |
| ProcessOneStep            | 76.560 ms                 | 1.011 s                   |
| BlockToStepN              | 1.728 ms                  | 60.608 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:25.452672 37263 grad_async_v2.h:257] pq is empty
E20240207 18:04:25.761015 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1485
W20240207 18:04:26.162987 37732 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end6
W20240207 18:04:26.486335 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=379, pq.top=379
E20240207 18:04:26.761010 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=39646
E20240207 18:04:27.134311 37447 grad_async_v2.h:404] Stalled in ProcessBackward: rank=4, step_no=386, sample_step_cpp_seen_[rank]=385
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.207 ms                  | 117.158 ms                |
| Forward                   | 5.260 ms                  | 9.278 ms                  |
| Backward                  | 5.294 ms                  | 12.096 ms                 |
| Optimize                  | 2.343 ms                  | 7.644 ms                  |
| BarrierTimeBeforeRank0    | 1.920 ms                  | 80.500 ms                 |
| AfterBackward             | 76.635 ms                 | 1.012 s                   |
| BlockToStepN              | 1.847 ms                  | 60.714 ms                 |
| OneStep                   | 109.728 ms                | 1.194 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:27.300037 37732 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end7
E20240207 18:04:27.768086 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 18:04:28.125663 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=387, pq.top=387
W20240207 18:04:28.331686 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end0
E20240207 18:04:28.768698 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=17765
W20240207 18:04:29.132388 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=397, pq.top=397
W20240207 18:04:29.357609 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
[proc 0] 400 steps, total: 16.870, sample: 1.252, forward: 0.535, backward: 0.532, update: 0.271
[proc 5] 400 steps, total: 16.870, sample: 0.969, forward: 0.482, backward: 0.564, update: 0.222
[proc 4] 400 steps, total: 16.870, sample: 1.233, forward: 0.479, backward: 0.545, update: 0.217
[proc 3] 400 steps, total: 16.870, sample: 1.012, forward: 0.552, backward: 0.560, update: 0.225
[proc 2] 400 steps, total: 16.870, sample: 1.069, forward: 0.557, backward: 0.548, update: 0.225
[proc 1] 400 steps, total: 16.870, sample: 1.284, forward: 0.542, backward: 0.768, update: 0.234
E20240207 18:04:29.768011 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=5208
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 489.703 us                | 22.703 ms                 |
| ProcessBack:Shuffle       | 5.283 ms                  | 12.803 ms                 |
| ProcessBack:UpdateCache   | 6.801 ms                  | 9.373 ms                  |
| ProcessBack:UpsertPq      | 30.662 ms                 | 100.998 ms                |
| ProcessOneStep            | 76.589 ms                 | 1.011 s                   |
| BlockToStepN              | 1.813 ms                  | 67.350 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:30.428107 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end5
W20240207 18:04:30.652949 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=405, pq.top=405
E20240207 18:04:30.768011 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1810
W20240207 18:04:31.490590 37732 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end4
W20240207 18:04:31.659965 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=415, pq.top=415
E20240207 18:04:31.768010 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=673
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.367 ms                  | 117.158 ms                |
| Forward                   | 5.252 ms                  | 9.597 ms                  |
| Backward                  | 5.336 ms                  | 12.096 ms                 |
| Optimize                  | 2.336 ms                  | 7.779 ms                  |
| BarrierTimeBeforeRank0    | 1.885 ms                  | 80.500 ms                 |
| AfterBackward             | 76.041 ms                 | 1.012 s                   |
| BlockToStepN              | 1.958 ms                  | 74.093 ms                 |
| OneStep                   | 109.728 ms                | 1.194 s                   |
+---------------------------+---------------------------+---------------------------+
E20240207 18:04:32.351882 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=421, sample_step_cpp_seen_[rank]=420
W20240207 18:04:32.569682 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end3
E20240207 18:04:32.768898 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 18:04:33.142037 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=423, pq.top=423
W20240207 18:04:33.610697 37732 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end7
E20240207 18:04:33.768011 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=5146
W20240207 18:04:34.170066 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=433, pq.top=433
E20240207 18:04:34.768013 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=13105
W20240207 18:04:34.828819 37732 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 488.816 us                | 23.061 ms                 |
| ProcessBack:Shuffle       | 5.316 ms                  | 11.965 ms                 |
| ProcessBack:UpdateCache   | 6.763 ms                  | 10.227 ms                 |
| ProcessBack:UpsertPq      | 29.944 ms                 | 100.438 ms                |
| ProcessOneStep            | 75.585 ms                 | 1.011 s                   |
| BlockToStepN              | 2.026 ms                  | 73.989 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:35.719668 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=440, pq.top=440
E20240207 18:04:35.768018 37741 parallel_pq_v2.h:79] insert failed, size(hashtable)=13577
W20240207 18:04:35.850605 37732 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end2
E20240207 18:04:36.768011 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=32186
W20240207 18:04:36.873142 37732 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end1
W20240207 18:04:37.277405 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=453, pq.top=452
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.458 ms                  | 111.830 ms                |
| Forward                   | 5.255 ms                  | 9.597 ms                  |
| Backward                  | 5.325 ms                  | 11.616 ms                 |
| Optimize                  | 2.336 ms                  | 7.644 ms                  |
| BarrierTimeBeforeRank0    | 1.721 ms                  | 77.555 ms                 |
| AfterBackward             | 75.619 ms                 | 1.009 s                   |
| BlockToStepN              | 2.195 ms                  | 67.488 ms                 |
| OneStep                   | 110.660 ms                | 1.039 s                   |
+---------------------------+---------------------------+---------------------------+
E20240207 18:04:37.768023 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=39431
W20240207 18:04:38.101079 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
W20240207 18:04:38.368244 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=461, pq.top=461
E20240207 18:04:38.690045 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=463, sample_step_cpp_seen_[rank]=462
E20240207 18:04:38.768007 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=40954
W20240207 18:04:39.136672 37732 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
W20240207 18:04:39.659835 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=465, pq.top=465
E20240207 18:04:39.770351 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=57932
W20240207 18:04:40.237735 37732 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 592.162 us                | 24.189 ms                 |
| ProcessBack:Shuffle       | 5.317 ms                  | 14.423 ms                 |
| ProcessBack:UpdateCache   | 6.706 ms                  | 10.286 ms                 |
| ProcessBack:UpsertPq      | 28.533 ms                 | 104.549 ms                |
| ProcessOneStep            | 75.585 ms                 | 1.009 s                   |
| BlockToStepN              | 2.184 ms                  | 73.989 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 18:04:40.770010 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=2370
W20240207 18:04:40.827323 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=475, pq.top=475
W20240207 18:04:41.430423 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
E20240207 18:04:41.770010 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=4410
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.546 ms                  | 117.158 ms                |
| Forward                   | 5.246 ms                  | 10.462 ms                 |
| Backward                  | 5.325 ms                  | 11.616 ms                 |
| Optimize                  | 2.335 ms                  | 8.264 ms                  |
| BarrierTimeBeforeRank0    | 1.697 ms                  | 77.555 ms                 |
| AfterBackward             | 74.612 ms                 | 1.009 s                   |
| BlockToStepN              | 2.354 ms                  | 79.221 ms                 |
| OneStep                   | 110.820 ms                | 1.039 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 18:04:42.440254 37732 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240207 18:04:42.775959 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 18:04:43.250627 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=489, pq.top=489
W20240207 18:04:43.567921 37732 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end3
E20240207 18:04:43.775010 37263 parallel_pq_v2.h:79] insert failed, size(hashtable)=1029
E20240207 18:04:43.909749 37263 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=496, sample_step_cpp_seen_[rank]=495
E20240207 18:04:44.775291 37732 parallel_pq_v2.h:79] insert failed, size(hashtable)=4642
W20240207 18:04:44.789793 37732 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
W20240207 18:04:45.182796 37263 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=497, pq.top=497
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 501.675 us                | 10.010 ms                 |
| ProcessBack:Shuffle       | 5.330 ms                  | 14.334 ms                 |
| ProcessBack:UpdateCache   | 6.705 ms                  | 10.227 ms                 |
| ProcessBack:UpsertPq      | 27.419 ms                 | 104.549 ms                |
| ProcessOneStep            | 74.568 ms                 | 1.011 s                   |
| BlockToStepN              | 2.361 ms                  | 79.111 ms                 |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 15.970, sample: 1.075, forward: 0.560, backward: 0.549, update: 0.237
[proc 0] 500 steps, total: 15.970, sample: 1.422, forward: 0.549, backward: 0.570, update: 0.264
[proc 4] 500 steps, total: 15.970, sample: 1.149, forward: 0.491, backward: 0.581, update: 0.225
[proc 5] 500 steps, total: 15.970, sample: 1.088, forward: 0.561, backward: 0.583, update: 0.250
[proc 1] 500 steps, total: 15.970, sample: 1.002, forward: 0.506, backward: 0.661, update: 0.226
[proc 3] 500 steps, total: 15.970, sample: 1.006, forward: 0.511, backward: 0.784, update: 0.242
Successfully xmh. training takes 84.7709972858429 seconds
before call kg_cache_controller.StopThreads()
W20240207 18:04:45.498466 37263 grad_async_v2.h:84] call StopThreads. PID = 35985
W20240207 18:04:45.498502 37263 grad_base.h:212] before processOneStepNegThread_.join();
W20240207 18:04:45.498972 37263 grad_base.h:214] after processOneStepNegThread_.join();
W20240207 18:04:45.498981 37263 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240207 18:04:45.619203 37263 grad_async_v2.h:105] StopThreads done.

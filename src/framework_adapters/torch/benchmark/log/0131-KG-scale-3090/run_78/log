WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240203 18:14:57.059804 23933 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_Freebase_72', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=4, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=4, gpu=[0, 1, 2, 3], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [23933 sampler.py:454] Start PreSampling
WARNING [23933 sampler.py:532] Before construct renumbering_dict
WARNING [23933 sampler.py:555] PreSampling done
W20240203 18:34:13.838968 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240203 18:34:13.839167 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240203 18:34:13.839213 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240203 18:34:13.839252 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240203 18:34:13.839288 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240203 18:34:13.839323 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240203 18:34:13.839354 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240203 18:34:13.839390 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240203 18:34:13.839423 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240203 18:34:13.839464 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240203 18:34:13.839507 23933 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240203 18:34:13.839536 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240203 18:34:13.839560 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240203 18:34:13.839741 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240203 18:34:13.839781 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240203 18:34:13.839808 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240203 18:34:13.839849 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240203 18:34:13.839877 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240203 18:34:13.839908 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240203 18:34:13.839941 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240203 18:34:13.839972 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240203 18:34:13.840005 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240203 18:34:13.840040 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240203 18:34:13.840083 23933 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240203 18:34:13.840106 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240203 18:34:13.840130 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240203 18:34:13.840193 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240203 18:34:13.840229 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240203 18:34:13.840257 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240203 18:34:13.840288 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240203 18:34:13.840328 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240203 18:34:13.840368 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240203 18:34:13.840405 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240203 18:34:13.840435 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240203 18:34:13.840462 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240203 18:34:13.840495 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240203 18:34:13.840525 23933 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240203 18:34:13.840551 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240203 18:34:13.840580 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240203 18:34:13.840634 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240203 18:34:13.840667 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240203 18:34:13.840695 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240203 18:34:13.840725 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240203 18:34:13.840755 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240203 18:34:13.840788 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240203 18:34:13.840817 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240203 18:34:13.840845 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240203 18:34:13.840878 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240203 18:34:13.840919 23933 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240203 18:34:13.840947 23933 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240203 18:34:13.840971 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240203 18:34:13.840993 23933 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240203 18:34:14.276988 23933 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x100013192000 128.2 GB
W20240203 18:42:50.540692 23933 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x102021dca000 328.3 MB
{0: Graph(num_nodes=27225865, num_edges=100970380,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=23781260, num_edges=94780459,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=24473167, num_edges=94766529,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=27322260, num_edges=74213630,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 27225865 N 100970380 E
MertisPartition: part 1 has 23781260 N 94780459 E
MertisPartition: part 2 has 24473167 N 94766529 E
MertisPartition: part 3 has 27322260 N 74213630 E
Rank0: cached key size 1075676
Rank1: cached key size 1075676
Rank2: cached key size 1075676
Rank3: cached key size 1075676
Before renumbering graph:  {'_ID': tensor([       0,        1,        2,  ..., 82487883, 64859130, 64482679]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
After renumbering graph:  {'_ID': tensor([ 4302704,  4302705,   110131,  ..., 50206691, 12013042,  2649558]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 2, 2, 2])}
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=27225865, num_edges=100970380,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2175.955 seconds
[Rank1] pid = 51399
[Rank2] pid = 51493
INFO [23933 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [51399 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [51493 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [51560 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [51560 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [51493 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
INFO [51399 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240203 18:51:18.700943 51624 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_3 [4302707, 400]; dev=3; size=6.412 GB
W20240203 18:51:18.700975 51494 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
INFO [23933 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 4 nodes.
W20240203 18:51:18.703269 51400 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240203 18:51:18.705454 51561 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
W20240203 18:51:18.738253 51624 IPCTensor.h:369] NewIPCTensor: input_keys_3 [1000000]0x102036613000 7.629 MB
W20240203 18:51:18.738404 51624 IPCTensor.h:369] NewIPCTensor: input_keys_neg_3 [1000000]0x102036db6000 7.629 MB
W20240203 18:51:18.738464 51624 IPCTensor.h:369] NewIPCTensor: backward_grads_3 [1000000, 400]0x102037559000 1.49 GB
W20240203 18:51:18.738507 51624 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_3 [1000000, 400]0x102096b3c000 1.49 GB
W20240203 18:51:18.738556 51624 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240203 18:51:18.753144 51624 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_3_gpu [1000000, 400]; dev=3; size=1.49 GB
W20240203 18:51:18.753304 51494 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1020f6125000 7.629 MB
W20240203 18:51:18.753437 51400 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1020f68c8000 7.629 MB
W20240203 18:51:18.753470 51494 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x1020f706b000 7.629 MB
W20240203 18:51:18.753549 51494 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x1020f780e000 1.49 GB
W20240203 18:51:18.753595 51494 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x102156df1000 1.49 GB
W20240203 18:51:18.753647 51400 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x1021b63d4000 7.629 MB
W20240203 18:51:18.753670 51494 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240203 18:51:18.753726 51400 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x1021b6b77000 1.49 GB
W20240203 18:51:18.753796 51400 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x10221615a000 1.49 GB
W20240203 18:51:18.753849 51400 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240203 18:51:18.757973 51494 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240203 18:51:18.758014 51400 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240203 18:51:18.773902 51561 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102275749000 7.629 MB
W20240203 18:51:18.774173 51561 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x102275eec000 7.629 MB
W20240203 18:51:18.774250 51561 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x10227668f000 1.49 GB
W20240203 18:51:18.774288 51561 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1022d5c72000 1.49 GB
W20240203 18:51:18.774385 51561 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240203 18:51:18.776168 51561 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
cudaHostRegister 0x100013192000
1: KnownLocalCachedEmbedding init done
WARNING [51399 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank3] pid = 51560
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121), (12908121, 17210828)]
cudaHostRegister 0x100013192000
0: KnownLocalCachedEmbedding init done
WARNING [23933 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
3: KnownLocalCachedEmbedding init done
WARNING [51560 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x100013192000
2: KnownLocalCachedEmbedding init done
WARNING [51493 DistTensor.py:59] The tensor name already exists in the kvstore
I20240203 18:51:52.188602 51494 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 4
I20240203 18:51:52.188664 51561 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240203 18:51:52.188710 51624 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
I20240203 18:51:52.188848 51400 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 4
W20240203 18:51:52.190165 51561 grad_base.h:55] KGCacheController, config={
        "num_gpus": 4,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240203 18:51:52.190294 51561 grad_base.h:184] Init GradProcessingBase done
I20240203 18:52:04.752905 51561 grad_async_v2.h:42] Use main thread to update emb.
W20240203 18:52:04.753085 51561 kg_controller.h:78] after init GradAsyncProcessingV2
I20240203 18:52:04.753100 51561 kg_controller.h:84] Construct KGCacheController done
E20240203 18:52:05.224750 51624 recstore.cc:66] init folly done
E20240203 18:52:05.224959 51400 recstore.cc:66] init folly done
E20240203 18:52:05.227346 51494 recstore.cc:66] init folly done
E20240203 18:52:05.227355 51561 recstore.cc:66] init folly done
I20240203 18:52:05.228466 51561 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240203 18:52:17.439972 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240203 18:52:17.440451 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240203 18:52:18.702365 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240203 18:52:18.702500 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 117.065 us                | 261.878 us                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:22.812135 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240203 18:52:22.830013 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240203 18:52:23.025916 51624 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 4
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 114.195 us                | 216.277 us                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:25.675137 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240203 18:52:25.691524 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240203 18:52:25.730657 51400 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240203 18:52:26.300123 51561 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
I20240203 18:52:26.302564 51494 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 4
E20240203 18:52:26.691015 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=4
W20240203 18:52:26.910957 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 12.575 ms                 | 12.575 ms                 |
| Forward                   | 766.241 ms                | 766.241 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 18:52:27.915225 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240203 18:52:27.984508 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=1, pq.top=1
W20240203 18:52:27.988967 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240203 18:52:28.046515 51561 grad_async_v2.h:257] pq is empty
E20240203 18:52:28.915016 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=988
W20240203 18:52:29.039048 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=11, pq.top=11
W20240203 18:52:29.087214 51561 grad_async_v2.h:257] pq is empty
W20240203 18:52:29.179378 55888 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end4
E20240203 18:52:29.247073 53828 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=14, sample_step_cpp_seen_[rank]=13
E20240203 18:52:29.930186 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240203 18:52:30.214118 55888 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 187.380 us                | 585.045 us                |
| ProcessBack:Shuffle       | 2.630 ms                  | 222.283 ms                |
| ProcessBack:UpdateCache   | 3.524 ms                  | 264.460 ms                |
| ProcessBack:UpsertPq      | 25.955 ms                 | 70.915 ms                 |
| ProcessOneStep            | 35.599 ms                 | 625.521 ms                |
| BlockToStepN              | 156.400 us                | 2.749 ms                  |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:30.803128 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=21, pq.top=21
E20240203 18:52:30.930020 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=581
W20240203 18:52:31.409082 55888 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end6
W20240203 18:52:31.877113 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=31, pq.top=31
E20240203 18:52:31.930009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=147
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.083 ms                  | 142.411 ms                |
| Forward                   | 5.519 ms                  | 766.241 ms                |
| Backward                  | 4.652 ms                  | 234.362 ms                |
| Optimize                  | 2.348 ms                  | 5.959 ms                  |
| BarrierTimeBeforeRank0    | 4.686 ms                  | 68.464 ms                 |
| AfterBackward             | 54.414 ms                 | 1.033 s                   |
| BlockToStepN              | 261.588 us                | 10.131 ms                 |
| OneStep                   | 88.248 ms                 | 1.683 s                   |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:32.666134 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end9
E20240203 18:52:32.930009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=1431
W20240203 18:52:33.402503 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=45, pq.top=45
W20240203 18:52:33.849310 55888 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240203 18:52:33.930009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=21668
E20240203 18:52:34.265986 53828 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=55, sample_step_cpp_seen_[rank]=54
W20240203 18:52:34.747864 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=58, pq.top=58
W20240203 18:52:34.887805 55888 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
E20240203 18:52:34.930027 56314 parallel_pq_v2.h:79] insert failed, size(hashtable)=14390
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 386.810 us                | 8.708 ms                  |
| ProcessBack:Shuffle       | 2.693 ms                  | 180.402 ms                |
| ProcessBack:UpdateCache   | 2.913 ms                  | 263.682 ms                |
| ProcessBack:UpsertPq      | 21.848 ms                 | 70.915 ms                 |
| ProcessOneStep            | 47.249 ms                 | 625.521 ms                |
| BlockToStepN              | 271.715 us                | 10.041 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:35.838393 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=73, pq.top=73
E20240203 18:52:35.930009 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=142
W20240203 18:52:36.015914 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
W20240203 18:52:36.840023 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=82, pq.top=82
E20240203 18:52:36.930007 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=534
W20240203 18:52:37.023790 55888 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.804 ms                  | 138.898 ms                |
| Forward                   | 5.353 ms                  | 26.308 ms                 |
| Backward                  | 4.842 ms                  | 11.144 ms                 |
| Optimize                  | 2.413 ms                  | 5.959 ms                  |
| BarrierTimeBeforeRank0    | 1.251 ms                  | 49.152 ms                 |
| AfterBackward             | 44.876 ms                 | 625.944 ms                |
| BlockToStepN              | 438.895 us                | 14.678 ms                 |
| OneStep                   | 74.026 ms                 | 1.058 s                   |
+---------------------------+---------------------------+---------------------------+
E20240203 18:52:37.930009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=2366
W20240203 18:52:38.052901 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=97, pq.top=97
W20240203 18:52:38.172724 55888 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 15.277, sample: 1.842, forward: 1.172, backward: 0.934, update: 0.213
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 12.572, sample: 1.325, forward: 1.267, backward: 0.705, update: 0.225
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 12.000, sample: 1.342, forward: 1.245, backward: 0.752, update: 0.234
train_sampler.Prefill()
-------Step 0-------
tensor([   59396,   527562, 53523469,  1003265,   459475,   527586,   527612,
          216828,    59427,    59459]) tensor([ 5071817, 22955597, 19013211, 42331957, 63428050, 34226744, 66917390,
        74171009, 66494450, 83185474])
-------Step 1-------
tensor([   59396,   527562, 53523469,  1003265,   459475,   527586,   527612,
          216828,    59427,    59459]) tensor([24984169, 61230061, 63030015,  9829816, 48063342,  9672624, 84298793,
        82909210, 20352044, 39794207])
-------Step 2-------
tensor([  602343,    72728, 78025810,    72780,   602371,   602396,   602428,
        51057709,   602445,   602475]) tensor([42050294,  5040610, 48832608, 11223009, 17444309, 10557252, 71064939,
        10667688, 67719203, 38645426])
-------Step 3-------
tensor([  602343,    72728, 78025810,    72780,   602371,   602396,   602428,
        51057709,   602445,   602475]) tensor([20955031, 53076954, 62430813, 45590555, 12750579, 75812039, 59864555,
        65836148, 25870484, 79296775])
-------Step 4-------
tensor([674622,  86470, 674648, 674682,  86507, 674709,  86545, 674737,  86594,
        674766]) tensor([54211849, 32678558, 18698022, 15894793, 45423647, 52117549, 81155808,
        56952507, 46179366,  8027190])
-------Step 5-------
tensor([674622,  86470, 674648, 674682,  86507, 674709,  86545, 674737,  86594,
        674766]) tensor([39144651, 52970095, 83325659,  9044879, 43449623, 25284745, 29784265,
        57671240, 71129241,   475002])
-------Step 6-------
tensor([80136042,   748018,   748046,   748069,  4309353,   748099,   748130,
          748152,   748183,   222027]) tensor([22761355, 51730511, 30038648, 23930998, 79468649, 46158046, 49550445,
        13016443, 74560094,  8307544])
-------Step 7-------
tensor([80136042,   748018,   748046,   748069,  4309353,   748099,   748130,
          748152,   748183,   222027]) tensor([45531123, 70820729, 43107082, 57309184, 76310651,  1523969, 18978478,
        58762307, 17298309, 14083621])
-------Step 8-------
tensor([  820295,   114595,   820325, 40897877,  1026911,   820347,   820373,
          820393,   223567,  1026926]) tensor([29942038, 46487306, 38354973, 70696970, 83251666, 73655312, 50331158,
        63892230,  9991966,  3241341])
-------Step 9-------
tensor([  820295,   114595,   820325, 40897877,  1026911,   820347,   820373,
          820393,   223567,  1026926]) tensor([59955939, 52500766, 21310754, 34873157, 11134013,   886019, 23769267,
        12909500, 81230922, 54455607])
before start barrier
start train
[proc 0] 100 steps, total: 12.003, sample: 1.521, forward: 1.346, backward: 0.726, update: 0.294
E20240203 18:52:38.930008 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=426
W20240203 18:52:39.080127 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=109, pq.top=109
W20240203 18:52:39.236579 55888 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end2
E20240203 18:52:39.265005 53828 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=112, sample_step_cpp_seen_[rank]=111
E20240203 18:52:39.930006 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=4193
W20240203 18:52:40.128906 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=117, pq.top=117
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 354.146 us                | 4.083 ms                  |
| ProcessBack:Shuffle       | 2.575 ms                  | 6.058 ms                  |
| ProcessBack:UpdateCache   | 2.643 ms                  | 3.947 ms                  |
| ProcessBack:UpsertPq      | 18.759 ms                 | 68.681 ms                 |
| ProcessOneStep            | 42.623 ms                 | 626.052 ms                |
| BlockToStepN              | 667.088 us                | 16.420 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:40.266809 55888 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
E20240203 18:52:40.930008 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=2470
W20240203 18:52:41.374128 55888 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
W20240203 18:52:41.610759 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=131, pq.top=131
E20240203 18:52:41.930006 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=3044
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.216 ms                  | 138.898 ms                |
| Forward                   | 5.277 ms                  | 26.308 ms                 |
| Backward                  | 4.558 ms                  | 11.144 ms                 |
| Optimize                  | 2.372 ms                  | 14.452 ms                 |
| BarrierTimeBeforeRank0    | 1.259 ms                  | 68.464 ms                 |
| AfterBackward             | 42.680 ms                 | 626.097 ms                |
| BlockToStepN              | 835.907 us                | 24.242 ms                 |
| OneStep                   | 74.453 ms                 | 1.058 s                   |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:42.387725 55888 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
W20240203 18:52:42.650815 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=143, pq.top=143
E20240203 18:52:42.931205 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240203 18:52:43.483237 55888 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
W20240203 18:52:43.853147 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=153, pq.top=153
E20240203 18:52:43.931006 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=3001
W20240203 18:52:44.543408 55888 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end5
E20240203 18:52:44.899847 53828 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=167, sample_step_cpp_seen_[rank]=166
E20240203 18:52:44.931005 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=1718
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 326.120 us                | 7.266 ms                  |
| ProcessBack:Shuffle       | 2.496 ms                  | 5.671 ms                  |
| ProcessBack:UpdateCache   | 2.568 ms                  | 3.896 ms                  |
| ProcessBack:UpsertPq      | 15.023 ms                 | 66.718 ms                 |
| ProcessOneStep            | 42.392 ms                 | 625.521 ms                |
| BlockToStepN              | 881.315 us                | 26.225 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:45.347206 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=169, pq.top=169
W20240203 18:52:45.631307 55888 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end5
E20240203 18:52:45.931007 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=2074
W20240203 18:52:46.411234 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=184, pq.top=184
W20240203 18:52:46.775374 55888 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end0
E20240203 18:52:46.935734 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=6221
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.353 ms                  | 126.007 ms                |
| Forward                   | 5.241 ms                  | 12.119 ms                 |
| Backward                  | 4.640 ms                  | 10.936 ms                 |
| Optimize                  | 2.358 ms                  | 6.308 ms                  |
| BarrierTimeBeforeRank0    | 1.408 ms                  | 73.099 ms                 |
| AfterBackward             | 42.418 ms                 | 625.944 ms                |
| BlockToStepN              | 1.178 ms                  | 26.293 ms                 |
| OneStep                   | 74.070 ms                 | 647.835 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:47.689438 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=197, pq.top=197
W20240203 18:52:47.831074 55888 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
E20240203 18:52:47.935009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=30574
[proc 1] 200 steps, total: 9.697, sample: 1.689, forward: 0.554, backward: 0.511, update: 0.243
[proc 0] 200 steps, total: 9.697, sample: 1.286, forward: 0.510, backward: 0.504, update: 0.266
[proc 2] 200 steps, total: 9.697, sample: 1.616, forward: 0.542, backward: 0.573, update: 0.233
[proc 3] 200 steps, total: 9.697, sample: 1.496, forward: 0.499, backward: 0.548, update: 0.258
W20240203 18:52:48.746140 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=211, pq.top=211
W20240203 18:52:48.875380 55888 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240203 18:52:48.935006 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=31118
W20240203 18:52:49.762408 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=221, pq.top=221
E20240203 18:52:49.935024 56302 parallel_pq_v2.h:79] insert failed, size(hashtable)=83984
E20240203 18:52:50.022897 51561 grad_async_v2.h:404] Stalled in ProcessBackward: rank=3, step_no=225, sample_step_cpp_seen_[rank]=224
W20240203 18:52:50.126464 55888 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 454.246 us                | 16.055 ms                 |
| ProcessBack:Shuffle       | 2.454 ms                  | 6.143 ms                  |
| ProcessBack:UpdateCache   | 2.521 ms                  | 3.838 ms                  |
| ProcessBack:UpsertPq      | 14.972 ms                 | 63.623 ms                 |
| ProcessOneStep            | 42.392 ms                 | 625.521 ms                |
| BlockToStepN              | 1.252 ms                  | 37.401 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 18:52:50.935034 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=2
W20240203 18:52:51.083711 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=235, pq.top=235
W20240203 18:52:51.341555 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
E20240203 18:52:51.935007 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=4223
W20240203 18:52:52.189353 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=243, pq.top=243
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.726 ms                  | 126.007 ms                |
| Forward                   | 5.218 ms                  | 12.119 ms                 |
| Backward                  | 4.727 ms                  | 11.144 ms                 |
| Optimize                  | 2.358 ms                  | 11.003 ms                 |
| BarrierTimeBeforeRank0    | 1.711 ms                  | 86.149 ms                 |
| AfterBackward             | 41.422 ms                 | 626.097 ms                |
| BlockToStepN              | 1.390 ms                  | 37.534 ms                 |
| OneStep                   | 74.070 ms                 | 725.272 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:52:52.523330 55888 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
E20240203 18:52:52.935016 56317 parallel_pq_v2.h:79] insert failed, size(hashtable)=16375
W20240203 18:52:53.506935 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=259, pq.top=259
W20240203 18:52:53.644490 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240203 18:52:53.935024 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=2188
W20240203 18:52:54.820940 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=277, pq.top=277
W20240203 18:52:54.907768 55888 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end8
E20240203 18:52:54.935009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=11291
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 365.986 us                | 19.568 ms                 |
| ProcessBack:Shuffle       | 2.431 ms                  | 7.077 ms                  |
| ProcessBack:UpdateCache   | 2.507 ms                  | 3.838 ms                  |
| ProcessBack:UpsertPq      | 15.524 ms                 | 63.623 ms                 |
| ProcessOneStep            | 40.249 ms                 | 625.521 ms                |
| BlockToStepN              | 1.351 ms                  | 31.180 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 18:52:55.318519 53828 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=283, sample_step_cpp_seen_[rank]=282
W20240203 18:52:55.820677 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=287, pq.top=287
E20240203 18:52:55.935007 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=52721
W20240203 18:52:56.078121 55888 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end2
W20240203 18:52:56.863250 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=299, pq.top=299
[proc 0] 300 steps, total: 8.908, sample: 0.941, forward: 0.508, backward: 0.467, update: 0.266
[proc 3] 300 steps, total: 8.908, sample: 1.055, forward: 0.591, backward: 0.503, update: 0.231
[proc 1] 300 steps, total: 8.908, sample: 1.272, forward: 0.513, backward: 0.570, update: 0.216
[proc 2] 300 steps, total: 8.908, sample: 1.202, forward: 0.523, backward: 0.588, update: 0.221
E20240203 18:52:56.935009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=37722
W20240203 18:52:57.091111 55888 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.031 ms                  | 115.084 ms                |
| Forward                   | 5.212 ms                  | 12.025 ms                 |
| Backward                  | 4.640 ms                  | 10.936 ms                 |
| Optimize                  | 2.349 ms                  | 6.308 ms                  |
| BarrierTimeBeforeRank0    | 2.028 ms                  | 86.149 ms                 |
| AfterBackward             | 40.006 ms                 | 625.944 ms                |
| BlockToStepN              | 1.458 ms                  | 36.313 ms                 |
| OneStep                   | 73.601 ms                 | 647.835 ms                |
+---------------------------+---------------------------+---------------------------+
E20240203 18:52:57.935015 56306 parallel_pq_v2.h:79] insert failed, size(hashtable)=23035
W20240203 18:52:57.944032 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=313, pq.top=313
W20240203 18:52:58.110060 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end6
E20240203 18:52:58.935007 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=77696
W20240203 18:52:58.980477 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=323, pq.top=323
W20240203 18:52:59.122236 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end5
E20240203 18:52:59.935007 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=6631
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 390.349 us                | 13.550 ms                 |
| ProcessBack:Shuffle       | 2.440 ms                  | 7.077 ms                  |
| ProcessBack:UpdateCache   | 2.507 ms                  | 3.816 ms                  |
| ProcessBack:UpsertPq      | 15.384 ms                 | 63.623 ms                 |
| ProcessOneStep            | 39.871 ms                 | 625.521 ms                |
| BlockToStepN              | 1.547 ms                  | 46.892 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 18:53:00.318006 51561 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=336, sample_step_cpp_seen_[rank]=335
W20240203 18:53:00.341408 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
W20240203 18:53:00.773730 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=339, pq.top=339
E20240203 18:53:00.935016 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=209
W20240203 18:53:01.510797 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end9
E20240203 18:53:01.935009 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.183 ms                  | 111.428 ms                |
| Forward                   | 5.184 ms                  | 9.386 ms                  |
| Backward                  | 4.572 ms                  | 9.511 ms                  |
| Optimize                  | 2.345 ms                  | 5.959 ms                  |
| BarrierTimeBeforeRank0    | 1.735 ms                  | 73.099 ms                 |
| AfterBackward             | 39.690 ms                 | 580.934 ms                |
| BlockToStepN              | 1.688 ms                  | 43.251 ms                 |
| OneStep                   | 73.994 ms                 | 603.086 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:53:02.538069 55888 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end6
W20240203 18:53:02.882771 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=359, pq.top=359
E20240203 18:53:02.935024 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=28131
W20240203 18:53:03.731820 55888 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
E20240203 18:53:03.935005 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=987
W20240203 18:53:04.794903 55888 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end6
E20240203 18:53:04.939263 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=476
W20240203 18:53:05.038836 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=379, pq.top=379
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 365.459 us                | 24.857 ms                 |
| ProcessBack:Shuffle       | 2.473 ms                  | 7.835 ms                  |
| ProcessBack:UpdateCache   | 2.515 ms                  | 3.816 ms                  |
| ProcessBack:UpsertPq      | 15.749 ms                 | 61.827 ms                 |
| ProcessOneStep            | 39.939 ms                 | 580.885 ms                |
| BlockToStepN              | 1.736 ms                  | 46.892 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240203 18:53:05.502295 53828 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=385, sample_step_cpp_seen_[rank]=384
W20240203 18:53:05.907670 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
E20240203 18:53:05.939003 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=1392
W20240203 18:53:06.296540 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=387, pq.top=387
E20240203 18:53:06.939006 53828 parallel_pq_v2.h:79] insert failed, size(hashtable)=26418
W20240203 18:53:07.082816 55888 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end7
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.794 ms                  | 111.428 ms                |
| Forward                   | 5.201 ms                  | 9.386 ms                  |
| Backward                  | 4.572 ms                  | 9.511 ms                  |
| Optimize                  | 2.341 ms                  | 5.959 ms                  |
| BarrierTimeBeforeRank0    | 1.879 ms                  | 86.149 ms                 |
| AfterBackward             | 40.006 ms                 | 625.944 ms                |
| BlockToStepN              | 1.884 ms                  | 46.986 ms                 |
| OneStep                   | 74.070 ms                 | 647.835 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:53:07.297026 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=399, pq.top=399
[proc 0] 400 steps, total: 10.521, sample: 1.183, forward: 0.512, backward: 0.445, update: 0.238
[proc 1] 400 steps, total: 10.521, sample: 1.211, forward: 0.524, backward: 0.492, update: 0.223
[proc 2] 400 steps, total: 10.521, sample: 1.008, forward: 0.526, backward: 0.569, update: 0.227
[proc 3] 400 steps, total: 10.521, sample: 1.108, forward: 0.558, backward: 0.720, update: 0.253
E20240203 18:53:07.939007 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=44
W20240203 18:53:08.185495 55888 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
W20240203 18:53:08.312228 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=407, pq.top=407
E20240203 18:53:08.939007 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=13126
W20240203 18:53:09.249481 55888 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end7
W20240203 18:53:09.314906 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=417, pq.top=417
E20240203 18:53:09.939014 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=6418
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 364.413 us                | 13.541 ms                 |
| ProcessBack:Shuffle       | 2.466 ms                  | 8.068 ms                  |
| ProcessBack:UpdateCache   | 2.505 ms                  | 3.816 ms                  |
| ProcessBack:UpsertPq      | 16.157 ms                 | 64.492 ms                 |
| ProcessOneStep            | 39.978 ms                 | 625.521 ms                |
| BlockToStepN              | 1.924 ms                  | 46.892 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 18:53:10.267820 55888 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
W20240203 18:53:10.656536 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=427, pq.top=427
E20240203 18:53:10.939005 51561 parallel_pq_v2.h:79] insert failed, size(hashtable)=236
W20240203 18:53:11.347522 55888 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end5
W20240203 18:53:11.656737 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=438, pq.top=438
E20240203 18:53:11.793908 51561 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=438, sample_step_cpp_seen_[rank]=437
E20240203 18:53:11.939523 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.739 ms                  | 126.007 ms                |
| Forward                   | 5.185 ms                  | 9.386 ms                  |
| Backward                  | 4.535 ms                  | 9.511 ms                  |
| Optimize                  | 2.329 ms                  | 5.959 ms                  |
| BarrierTimeBeforeRank0    | 2.164 ms                  | 86.149 ms                 |
| AfterBackward             | 39.969 ms                 | 625.944 ms                |
| BlockToStepN              | 2.040 ms                  | 52.461 ms                 |
| OneStep                   | 74.667 ms                 | 647.835 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:53:12.460805 55888 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
W20240203 18:53:12.737354 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=441, pq.top=441
E20240203 18:53:12.939010 53828 parallel_pq_v2.h:79] insert failed, size(hashtable)=53792
W20240203 18:53:13.549190 55888 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end1
W20240203 18:53:13.776226 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=453, pq.top=453
E20240203 18:53:13.939016 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=9213
W20240203 18:53:14.666667 55888 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240203 18:53:14.843297 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=463, pq.top=463
E20240203 18:53:14.939013 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=47320
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 399.689 us                | 16.682 ms                 |
| ProcessBack:Shuffle       | 2.474 ms                  | 8.284 ms                  |
| ProcessBack:UpdateCache   | 2.514 ms                  | 3.838 ms                  |
| ProcessBack:UpsertPq      | 16.077 ms                 | 64.492 ms                 |
| ProcessOneStep            | 40.249 ms                 | 625.521 ms                |
| BlockToStepN              | 1.983 ms                  | 52.316 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240203 18:53:15.713976 55888 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240203 18:53:15.939010 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=5437
W20240203 18:53:16.731959 55888 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end6
E20240203 18:53:16.939028 56294 parallel_pq_v2.h:79] insert failed, size(hashtable)=65079
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.805 ms                  | 115.084 ms                |
| Forward                   | 5.218 ms                  | 9.386 ms                  |
| Backward                  | 4.570 ms                  | 9.511 ms                  |
| Optimize                  | 2.348 ms                  | 5.731 ms                  |
| BarrierTimeBeforeRank0    | 2.178 ms                  | 81.893 ms                 |
| AfterBackward             | 40.676 ms                 | 626.097 ms                |
| BlockToStepN              | 2.031 ms                  | 52.461 ms                 |
| OneStep                   | 74.921 ms                 | 702.133 ms                |
+---------------------------+---------------------------+---------------------------+
W20240203 18:53:17.866044 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=487, pq.top=487
E20240203 18:53:17.939015 55888 parallel_pq_v2.h:79] insert failed, size(hashtable)=27544
W20240203 18:53:18.114924 55888 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end0
E20240203 18:53:18.155850 51561 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=490, sample_step_cpp_seen_[rank]=489
W20240203 18:53:18.876014 51561 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=493, pq.top=493
E20240203 18:53:18.939584 56294 parallel_pq_v2.h:79] insert failed, size(hashtable)=66655
W20240203 18:53:19.223028 55888 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end7
[proc 3] 500 steps, total: 11.995, sample: 1.025, forward: 0.519, backward: 0.739, update: 0.225
[proc 1] 500 steps, total: 11.995, sample: 1.601, forward: 0.571, backward: 0.607, update: 0.232
[proc 0] 500 steps, total: 11.995, sample: 2.442, forward: 0.540, backward: 0.468, update: 0.245
[proc 2] 500 steps, total: 11.995, sample: 1.412, forward: 0.513, backward: 0.623, update: 0.225
Successfully xmh. training takes 53.123738527297974 seconds
before call kg_cache_controller.StopThreads()
W20240203 18:53:19.423837 51561 grad_async_v2.h:84] call StopThreads. PID = 23933
W20240203 18:53:19.423867 51561 grad_base.h:212] before processOneStepNegThread_.join();
W20240203 18:53:19.424288 51561 grad_base.h:214] after processOneStepNegThread_.join();
W20240203 18:53:19.424302 51561 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240203 18:53:19.693554 51561 grad_async_v2.h:105] StopThreads done.

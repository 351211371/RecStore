WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240205 20:09:50.787583 47539 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 483142 train triples.
Reading valid triples....
Finished. Read 50000 valid triples.
Reading test triples....
Finished. Read 59071 test triples.
ARGS:  Namespace(model_name='TransE', data_path='/home/xieminhui/dgl-data', dataset='FB15k', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/TransE_FB15k_148', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=14951, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=5, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=5, gpu=[0, 1, 2, 3, 4], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KGExternelEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='PySync', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 483142
original graph:  DGLGraph(num_nodes=14951, num_edges=592213,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [47539 sampler.py:454] Start PreSampling
WARNING [47539 sampler.py:532] Before construct renumbering_dict
WARNING [47539 sampler.py:555] PreSampling done
W20240205 20:09:55.521320 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240205 20:09:55.521548 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240205 20:09:55.521585 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240205 20:09:55.521616 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240205 20:09:55.521657 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240205 20:09:55.521693 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240205 20:09:55.521724 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240205 20:09:55.521772 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240205 20:09:55.521813 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240205 20:09:55.521848 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240205 20:09:55.521884 47539 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240205 20:09:55.521914 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240205 20:09:55.521947 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240205 20:09:55.522078 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240205 20:09:55.522116 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240205 20:09:55.522152 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240205 20:09:55.522202 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240205 20:09:55.522236 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240205 20:09:55.522264 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240205 20:09:55.522300 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240205 20:09:55.522333 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240205 20:09:55.522364 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240205 20:09:55.522393 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240205 20:09:55.522425 47539 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240205 20:09:55.522446 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240205 20:09:55.522467 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240205 20:09:55.522514 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240205 20:09:55.522552 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240205 20:09:55.522576 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240205 20:09:55.522610 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240205 20:09:55.522642 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240205 20:09:55.522675 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240205 20:09:55.522706 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240205 20:09:55.522737 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240205 20:09:55.522769 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240205 20:09:55.522801 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240205 20:09:55.522825 47539 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240205 20:09:55.522846 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240205 20:09:55.522866 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240205 20:09:55.522930 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_0 [1000000]0x10000e52e000 7.629 MB
W20240205 20:09:55.522969 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_1 [1000000]0x10000ecd1000 7.629 MB
W20240205 20:09:55.522994 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_2 [1000000]0x10000f474000 7.629 MB
W20240205 20:09:55.523032 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_3 [1000000]0x10000fc17000 7.629 MB
W20240205 20:09:55.523062 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_4 [1000000]0x1000103ba000 7.629 MB
W20240205 20:09:55.523095 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_5 [1000000]0x100010b5d000 7.629 MB
W20240205 20:09:55.523128 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_6 [1000000]0x100011300000 7.629 MB
W20240205 20:09:55.523172 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_7 [1000000]0x100011aa3000 7.629 MB
W20240205 20:09:55.523212 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_8 [1000000]0x100012246000 7.629 MB
W20240205 20:09:55.523249 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r3_9 [1000000]0x1000129e9000 7.629 MB
W20240205 20:09:55.523274 47539 IPCTensor.h:369] NewIPCTensor: step_r3 [10]0x10001318c000 80 B 
W20240205 20:09:55.523295 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r3 [1]0x10001318e000 8 B 
W20240205 20:09:55.523316 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r3 [1]0x100013190000 8 B 
W20240205 20:09:55.523367 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_0 [1000000]0x100013192000 7.629 MB
W20240205 20:09:55.523401 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_1 [1000000]0x100013935000 7.629 MB
W20240205 20:09:55.523427 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_2 [1000000]0x1000140d8000 7.629 MB
W20240205 20:09:55.523466 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_3 [1000000]0x10001487b000 7.629 MB
W20240205 20:09:55.523499 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_4 [1000000]0x10001501e000 7.629 MB
W20240205 20:09:55.523530 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_5 [1000000]0x1000157c1000 7.629 MB
W20240205 20:09:55.523555 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_6 [1000000]0x100015f64000 7.629 MB
W20240205 20:09:55.523588 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_7 [1000000]0x100016707000 7.629 MB
W20240205 20:09:55.523619 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_8 [1000000]0x100016eaa000 7.629 MB
W20240205 20:09:55.523644 47539 IPCTensor.h:369] NewIPCTensor: cached_sampler_r4_9 [1000000]0x10001764d000 7.629 MB
W20240205 20:09:55.523669 47539 IPCTensor.h:369] NewIPCTensor: step_r4 [10]0x100017df0000 80 B 
W20240205 20:09:55.523690 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r4 [1]0x100017df2000 8 B 
W20240205 20:09:55.523716 47539 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r4 [1]0x100017df4000 8 B 
W20240205 20:09:55.771170 47539 IPCTensor.h:369] NewIPCTensor: full_emb [14951, 400]0x100017df6000 22.81 MB
W20240205 20:09:55.859478 47539 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [14951]0x1000194c8000 58.4 kB
{0: Graph(num_nodes=10222, num_edges=137205,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=7861, num_edges=113516,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=10587, num_edges=145765,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 3: Graph(num_nodes=9264, num_edges=181068,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 4: Graph(num_nodes=10248, num_edges=191956,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 10222 N 137205 E
MertisPartition: part 1 has 7861 N 113516 E
MertisPartition: part 2 has 10587 N 145765 E
MertisPartition: part 3 has 9264 N 181068 E
MertisPartition: part 4 has 10248 N 191956 E
Rank0: cached key size 149
Rank1: cached key size 149
Rank2: cached key size 149
Rank3: cached key size 149
Rank4: cached key size 149
Before renumbering graph:  {'_ID': tensor([    7,    16,    18,  ..., 13890,  3788,  5916]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
After renumbering graph:  {'_ID': tensor([ 1053,  1376,  1462,  ..., 12711,  2554, 11818]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 4, 2])}
part_g: DGLGraph(num_nodes=10222, num_edges=137205,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=10222, num_edges=137205,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 5.168 seconds
[Rank1] pid = 47743
[Rank2] pid = 47774
[Rank3] pid = 47871
INFO [47539 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [47743 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [47774 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [47871 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 3
INFO [47935 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 4
INFO [47871 distributed_c10d.py:476] Rank 3: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
INFO [47935 distributed_c10d.py:476] Rank 4: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
INFO [47774 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
INFO [47743 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
WARNING [47871 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [47774 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [47743 DistTensor.py:59] The tensor name already exists in the kvstore
WARNING [47935 DistTensor.py:59] The tensor name already exists in the kvstore
INFO [47539 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 5 nodes.
WARNING [47539 DistTensor.py:59] The tensor name already exists in the kvstore
I20240205 20:09:57.973450 47936 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 5
I20240205 20:09:57.973647 47744 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
I20240205 20:09:57.973793 47808 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
I20240205 20:09:57.973950 47872 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
I20240205 20:09:57.974094 47999 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 5
E20240205 20:09:58.519809 47872 recstore.cc:66] init folly done
E20240205 20:09:58.519829 47808 recstore.cc:66] init folly done
E20240205 20:09:58.519865 47999 recstore.cc:66] init folly done
E20240205 20:09:58.519956 47936 recstore.cc:66] init folly done
E20240205 20:09:58.520315 47744 recstore.cc:66] init folly done
I20240205 20:09:58.612278 47744 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 5
I20240205 20:09:58.613873 47872 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
I20240205 20:09:58.616603 47936 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
I20240205 20:09:58.621176 47999 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
I20240205 20:09:58.631983 47808 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 5
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.382 ms                  | 27.546 ms                 |
| Forward                   | 11.439 ms                 | 684.795 ms                |
| Backward                  | 164.569 ms                | 333.196 ms                |
| Optimize                  | 7.856 ms                  | 12.909 ms                 |
| BarrierTimeBeforeRank0    | 4.005 ms                  | 40.246 ms                 |
| BlockToStepN              | 34.648 us                 | 439.992 us                |
| OneStep                   | 205.066 ms                | 1.031 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.625 ms                  | 37.163 ms                 |
| Forward                   | 11.769 ms                 | 684.795 ms                |
| Backward                  | 164.166 ms                | 333.196 ms                |
| Optimize                  | 6.832 ms                  | 12.909 ms                 |
| BarrierTimeBeforeRank0    | 3.256 ms                  | 40.246 ms                 |
| BlockToStepN              | 31.801 us                 | 439.992 us                |
| OneStep                   | 200.805 ms                | 1.031 s                   |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.170 ms                  | 35.700 ms                 |
| Forward                   | 11.769 ms                 | 17.326 ms                 |
| Backward                  | 158.953 ms                | 195.173 ms                |
| Optimize                  | 7.293 ms                  | 12.745 ms                 |
| BarrierTimeBeforeRank0    | 3.256 ms                  | 36.521 ms                 |
| BlockToStepN              | 30.692 us                 | 414.350 us                |
| OneStep                   | 193.836 ms                | 247.811 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.034 ms                  | 37.163 ms                 |
| Forward                   | 11.797 ms                 | 22.420 ms                 |
| Backward                  | 156.698 ms                | 195.173 ms                |
| Optimize                  | 7.029 ms                  | 12.745 ms                 |
| BarrierTimeBeforeRank0    | 4.005 ms                  | 40.246 ms                 |
| BlockToStepN              | 30.909 us                 | 414.350 us                |
| OneStep                   | 192.585 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
train_sampler.Prefill()
before start barrier
start train
[proc 4] 100 steps, total: 20.550, sample: 0.636, forward: 1.530, backward: 16.811, update: 0.429
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 20.559, sample: 0.456, forward: 1.476, backward: 15.496, update: 0.411
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 20.539, sample: 0.550, forward: 1.470, backward: 16.161, update: 0.424
train_sampler.Prefill()
before start barrier
start train
[proc 3] 100 steps, total: 20.557, sample: 0.666, forward: 1.598, backward: 16.970, update: 0.423
[Rank4] pid = 47935
New CachedEmbedding, name=full_emb, shape=(14951, 400), cache_type=KGExternelEmbedding
fixed cache_range is [(0, 747), (747, 1494), (1494, 2241), (2241, 2988), (2988, 3735)]
train_sampler.Prefill()
-------Step 0-------
tensor([ 8405,    20, 12767, 12491,    37,   106,  6535, 10715,  2884, 12794]) tensor([ 1462,  1387,    32,  4453,  4723, 12277,   470,  2702,  6506, 14641])
-------Step 1-------
tensor([ 8405,    20, 12767, 12491,    37,   106,  6535, 10715,  2884, 12794]) tensor([  192,  6998,  2511,  9574,  9380, 11047,  3232,  6041, 11237,  5244])
-------Step 2-------
tensor([  131, 12452,  8160, 14656,  6785,  9321,  9817,  8379,  6438,    57]) tensor([ 8024,  6934,  7743, 11929,  7935,  1193,  2636,   678, 12250,  1739])
-------Step 3-------
tensor([  131, 12452,  8160, 14656,  6785,  9321,  9817,  8379,  6438,    57]) tensor([14120,  2424,  8515,  5252, 14506,   433, 13248, 11580,   373,  1726])
-------Step 4-------
tensor([11572,  8723, 14323, 10969,  1523,  6010,  5583,  5935,  9766,  1767]) tensor([  472,  3297,  1027,  7998,  7087, 11031, 13711, 10574,  6058,   487])
-------Step 5-------
tensor([11572,  8723, 14323, 10969,  1523,  6010,  5583,  5935,  9766,  1767]) tensor([ 9947, 13483,  4975,  5563,  3001,   991,  4429,  5835,  5131,  9833])
-------Step 6-------
tensor([  964,   327,  6592,  3520,   145, 12997, 14656,    50,   785,  8007]) tensor([14599, 13236, 13468, 11451,  7611,  2887,  3783, 14118, 13130,  5126])
-------Step 7-------
tensor([  964,   327,  6592,  3520,   145, 12997, 14656,    50,   785,  8007]) tensor([ 6289, 10827,  4479, 11761,   259, 12987,  8268, 13478,  4158, 10909])
-------Step 8-------
tensor([10773, 12130,   798,  5062,  4572,    92, 14346,  4799,  3279,  4088]) tensor([ 1613,   879,  7064, 12144,  8698, 14072,  8076,  9133, 10709,   996])
-------Step 9-------
tensor([10773, 12130,   798,  5062,  4572,    92, 14346,  4799,  3279,  4088]) tensor([ 9333,  4306, 13293,  6749, 13806, 12270,  5941, 10561,  8335,   650])
before start barrier
start train
[proc 0] 100 steps, total: 20.555, sample: 0.703, forward: 1.893, backward: 16.025, update: 0.637
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.920 ms                  | 37.548 ms                 |
| Forward                   | 11.996 ms                 | 23.367 ms                 |
| Backward                  | 155.225 ms                | 195.173 ms                |
| Optimize                  | 6.529 ms                  | 12.745 ms                 |
| BarrierTimeBeforeRank0    | 3.256 ms                  | 199.637 ms                |
| BlockToStepN              | 30.692 us                 | 414.350 us                |
| OneStep                   | 187.881 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.760 ms                  | 37.564 ms                 |
| Forward                   | 11.910 ms                 | 23.367 ms                 |
| Backward                  | 152.518 ms                | 195.173 ms                |
| Optimize                  | 6.125 ms                  | 12.745 ms                 |
| BarrierTimeBeforeRank0    | 3.267 ms                  | 199.637 ms                |
| BlockToStepN              | 30.608 us                 | 414.350 us                |
| OneStep                   | 184.445 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.669 ms                  | 37.564 ms                 |
| Forward                   | 11.797 ms                 | 22.420 ms                 |
| Backward                  | 153.346 ms                | 195.173 ms                |
| Optimize                  | 5.890 ms                  | 11.631 ms                 |
| BarrierTimeBeforeRank0    | 3.043 ms                  | 139.148 ms                |
| BlockToStepN              | 30.474 us                 | 244.539 us                |
| OneStep                   | 185.924 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.590 ms                  | 37.998 ms                 |
| Forward                   | 11.711 ms                 | 22.420 ms                 |
| Backward                  | 155.225 ms                | 195.173 ms                |
| Optimize                  | 5.890 ms                  | 11.631 ms                 |
| BarrierTimeBeforeRank0    | 3.043 ms                  | 165.682 ms                |
| BlockToStepN              | 30.309 us                 | 244.539 us                |
| OneStep                   | 187.881 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 4] 200 steps, total: 19.520, sample: 0.599, forward: 0.811, backward: 13.971, update: 0.357
[proc 3] 200 steps, total: 19.520, sample: 0.655, forward: 0.941, backward: 16.214, update: 0.403
[proc 1] 200 steps, total: 19.520, sample: 0.469, forward: 0.807, backward: 14.930, update: 0.357
[proc 2] 200 steps, total: 19.520, sample: 0.635, forward: 0.816, backward: 15.775, update: 0.371
[proc 0] 200 steps, total: 19.520, sample: 0.720, forward: 1.166, backward: 15.739, update: 0.565
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.390 ms                  | 38.329 ms                 |
| Forward                   | 11.576 ms                 | 22.420 ms                 |
| Backward                  | 155.783 ms                | 195.173 ms                |
| Optimize                  | 5.599 ms                  | 11.631 ms                 |
| BarrierTimeBeforeRank0    | 3.528 ms                  | 165.682 ms                |
| BlockToStepN              | 30.285 us                 | 244.539 us                |
| OneStep                   | 188.471 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.340 ms                  | 38.776 ms                 |
| Forward                   | 11.572 ms                 | 22.420 ms                 |
| Backward                  | 156.438 ms                | 195.173 ms                |
| Optimize                  | 5.852 ms                  | 12.745 ms                 |
| BarrierTimeBeforeRank0    | 3.528 ms                  | 165.682 ms                |
| BlockToStepN              | 30.220 us                 | 244.539 us                |
| OneStep                   | 189.336 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.340 ms                  | 38.329 ms                 |
| Forward                   | 11.572 ms                 | 21.414 ms                 |
| Backward                  | 155.407 ms                | 195.173 ms                |
| Optimize                  | 5.599 ms                  | 11.631 ms                 |
| BarrierTimeBeforeRank0    | 3.894 ms                  | 159.722 ms                |
| BlockToStepN              | 30.138 us                 | 244.539 us                |
| OneStep                   | 189.218 ms                | 368.176 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.296 ms                  | 38.329 ms                 |
| Forward                   | 11.541 ms                 | 21.414 ms                 |
| Backward                  | 155.915 ms                | 195.173 ms                |
| Optimize                  | 5.473 ms                  | 11.631 ms                 |
| BarrierTimeBeforeRank0    | 4.016 ms                  | 165.682 ms                |
| BlockToStepN              | 30.167 us                 | 244.555 us                |
| OneStep                   | 190.862 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 3] 300 steps, total: 20.076, sample: 0.651, forward: 0.894, backward: 16.468, update: 0.393
[proc 2] 300 steps, total: 20.076, sample: 0.486, forward: 0.806, backward: 16.151, update: 0.359
[proc 0] 300 steps, total: 20.076, sample: 0.701, forward: 1.112, backward: 15.813, update: 0.569
[proc 1] 300 steps, total: 20.076, sample: 0.420, forward: 0.800, backward: 15.239, update: 0.326
[proc 4] 300 steps, total: 20.076, sample: 0.593, forward: 0.866, backward: 16.129, update: 0.380
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.153 ms                  | 38.329 ms                 |
| Forward                   | 11.412 ms                 | 21.414 ms                 |
| Backward                  | 154.664 ms                | 195.173 ms                |
| Optimize                  | 5.406 ms                  | 11.631 ms                 |
| BarrierTimeBeforeRank0    | 4.815 ms                  | 165.682 ms                |
| BlockToStepN              | 30.167 us                 | 244.555 us                |
| OneStep                   | 189.390 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.094 ms                  | 38.329 ms                 |
| Forward                   | 11.255 ms                 | 21.414 ms                 |
| Backward                  | 153.855 ms                | 195.173 ms                |
| Optimize                  | 5.309 ms                  | 11.631 ms                 |
| BarrierTimeBeforeRank0    | 5.162 ms                  | 165.682 ms                |
| BlockToStepN              | 30.138 us                 | 244.555 us                |
| OneStep                   | 189.336 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.056 ms                  | 38.313 ms                 |
| Forward                   | 11.194 ms                 | 21.233 ms                 |
| Backward                  | 153.010 ms                | 194.727 ms                |
| Optimize                  | 5.287 ms                  | 10.669 ms                 |
| BarrierTimeBeforeRank0    | 5.678 ms                  | 159.722 ms                |
| BlockToStepN              | 30.167 us                 | 244.539 us                |
| OneStep                   | 189.157 ms                | 368.176 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 400 steps, total: 19.129, sample: 0.491, forward: 0.834, backward: 15.843, update: 0.341
[proc 4] 400 steps, total: 19.129, sample: 0.577, forward: 0.854, backward: 15.849, update: 0.366
[proc 1] 400 steps, total: 19.129, sample: 0.427, forward: 0.800, backward: 14.431, update: 0.365
[proc 0] 400 steps, total: 19.129, sample: 0.599, forward: 1.014, backward: 14.989, update: 0.491
[proc 3] 400 steps, total: 19.130, sample: 0.662, forward: 0.930, backward: 16.256, update: 0.395
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 3.012 ms                  | 38.313 ms                 |
| Forward                   | 11.093 ms                 | 21.233 ms                 |
| Backward                  | 153.009 ms                | 194.727 ms                |
| Optimize                  | 5.291 ms                  | 10.669 ms                 |
| BarrierTimeBeforeRank0    | 5.995 ms                  | 159.722 ms                |
| BlockToStepN              | 30.127 us                 | 244.539 us                |
| OneStep                   | 188.961 ms                | 368.176 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.989 ms                  | 38.313 ms                 |
| Forward                   | 11.030 ms                 | 21.233 ms                 |
| Backward                  | 153.032 ms                | 195.173 ms                |
| Optimize                  | 5.287 ms                  | 10.669 ms                 |
| BarrierTimeBeforeRank0    | 6.515 ms                  | 159.722 ms                |
| BlockToStepN              | 30.127 us                 | 244.539 us                |
| OneStep                   | 189.218 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.972 ms                  | 38.329 ms                 |
| Forward                   | 11.029 ms                 | 21.233 ms                 |
| Backward                  | 152.912 ms                | 195.173 ms                |
| Optimize                  | 5.309 ms                  | 10.669 ms                 |
| BarrierTimeBeforeRank0    | 7.302 ms                  | 165.044 ms                |
| BlockToStepN              | 30.127 us                 | 244.539 us                |
| OneStep                   | 189.157 ms                | 393.619 ms                |
+---------------------------+---------------------------+---------------------------+
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.966 ms                  | 38.313 ms                 |
| Forward                   | 11.030 ms                 | 17.326 ms                 |
| Backward                  | 152.552 ms                | 194.727 ms                |
| Optimize                  | 5.282 ms                  | 10.280 ms                 |
| BarrierTimeBeforeRank0    | 7.510 ms                  | 159.722 ms                |
| BlockToStepN              | 30.167 us                 | 216.530 us                |
| OneStep                   | 188.606 ms                | 368.176 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 19.839, sample: 0.494, forward: 0.784, backward: 15.782, update: 0.321
[proc 0] 500 steps, total: 19.839, sample: 0.583, forward: 1.080, backward: 15.737, update: 0.554
[proc 3] 500 steps, total: 19.839, sample: 0.610, forward: 0.938, backward: 16.504, update: 0.399
Successfully xmh. training takes 99.11924529075623 seconds
[proc 1] 500 steps, total: 19.839, sample: 0.450, forward: 0.817, backward: 14.865, update: 0.408
before call kg_cache_controller.StopThreads()
[proc 4] 500 steps, total: 19.839, sample: 0.638, forward: 0.860, backward: 16.266, update: 0.385
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
INFO [47539 controller_process.py:421] call rank0 to StopThreads
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker3: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker1: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker2: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
[W tensorpipe_agent.cpp:725] RPC agent for worker0 encountered error when reading incoming request from worker4: eof (this error originated at tensorpipe/transport/shm/connection_impl.cc:259)
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 2.966 ms                  | 38.313 ms                 |
| Forward                   | 10.993 ms                 | 18.010 ms                 |
| Backward                  | 152.912 ms                | 194.727 ms                |
| Optimize                  | 5.234 ms                  | 10.280 ms                 |
| BarrierTimeBeforeRank0    | 7.510 ms                  | 159.722 ms                |
| BlockToStepN              | 30.127 us                 | 216.530 us                |
| OneStep                   | 188.606 ms                | 368.176 ms                |
+---------------------------+---------------------------+---------------------------+

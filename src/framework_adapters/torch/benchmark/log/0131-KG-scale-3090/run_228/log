WARNING: Logging before InitGoogleLogging() is written to STDERR
I20240207 06:27:12.247172  5730 IPC_barrier.h:128] MultiProcessBarrierFactory->ClearIPCMemory()
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/_deprecate/graph.py:1023: DGLWarning: multigraph will be deprecated.DGL will treat all graphs as multigraph in the future.
  dgl_warning("multigraph will be deprecated." \
/data/home/xieminhui/RecStore/src/framework_adapters/torch/kg/dgl-0.9.1/python/dgl/heterograph.py:72: DGLWarning: Recommend creating graphs by `dgl.graph(data)` instead of `dgl.DGLGraph(data)`.
  dgl_warning('Recommend creating graphs by `dgl.graph(data)`'
Reading train triples....
Finished. Read 304727650 train triples.
Reading valid triples....
Finished. Read 16929318 valid triples.
Reading test triples....
Finished. Read 16929308 test triples.
ARGS:  Namespace(model_name='SimplE', data_path='/home/xieminhui/dgl-data', dataset='Freebase', format='built_in', data_files=None, delimiter='\t', save_path='/tmp/ckpts/SimplE_Freebase_30', no_save_emb=True, max_step=500, batch_size=2000, batch_size_eval=16, neg_sample_size=200, neg_deg_sample=False, neg_deg_sample_eval=False, neg_sample_size_eval=86054151, eval_percent=1, no_eval_filter=False, log_interval=100, eval_interval=10000, test=False, num_proc=3, num_thread=1, force_sync_interval=1, hidden_dim=400, lr=0.01, gamma=16.0, double_ent=False, double_rel=False, neg_adversarial_sampling=False, adversarial_temperature=1.0, regularization_coef=0.0, regularization_norm=3, pairwise=False, loss_genre='Logsigmoid', margin=1.0, nr_gpus=3, gpu=[0, 1, 2], mix_cpu_gpu=True, valid=False, rel_part=False, async_update=None, has_edge_importance=False, cached_emb_type='KnownLocalCachedEmbedding', use_my_emb=True, cache_ratio=0.05, shuffle=False, backwardMode='CppAsyncV2', L=10, nr_background_threads=32, update_cache_use_omp=0, update_pq_use_omp=0, kForwardItersPerStep=2, backgrad_init='both', eval_filter=True, soft_rel_part=False)
|Train|: 304727650
original graph:  DGLGraph(num_nodes=86054151, num_edges=338586276,
         ndata_schemes={}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Loading cached metis
WARNING [5730 sampler.py:454] Start PreSampling
WARNING [5730 sampler.py:532] Before construct renumbering_dict
WARNING [5730 sampler.py:555] PreSampling done
W20240207 06:45:49.887614  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_0 [1000000]0x100000002000 7.629 MB
W20240207 06:45:49.887818  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_1 [1000000]0x1000007a5000 7.629 MB
W20240207 06:45:49.887856  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_2 [1000000]0x100000f48000 7.629 MB
W20240207 06:45:49.887887  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_3 [1000000]0x1000016eb000 7.629 MB
W20240207 06:45:49.887917  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_4 [1000000]0x100001e8e000 7.629 MB
W20240207 06:45:49.887945  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_5 [1000000]0x100002631000 7.629 MB
W20240207 06:45:49.887972  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_6 [1000000]0x100002dd4000 7.629 MB
W20240207 06:45:49.888018  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_7 [1000000]0x100003577000 7.629 MB
W20240207 06:45:49.888088  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_8 [1000000]0x100003d1a000 7.629 MB
W20240207 06:45:49.888121  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r0_9 [1000000]0x1000044bd000 7.629 MB
W20240207 06:45:49.888168  5730 IPCTensor.h:369] NewIPCTensor: step_r0 [10]0x100004c60000 80 B 
W20240207 06:45:49.888200  5730 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r0 [1]0x100004c62000 8 B 
W20240207 06:45:49.888235  5730 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r0 [1]0x100004c64000 8 B 
W20240207 06:45:49.888414  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_0 [1000000]0x100004c66000 7.629 MB
W20240207 06:45:49.888454  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_1 [1000000]0x100005409000 7.629 MB
W20240207 06:45:49.888484  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_2 [1000000]0x100005bac000 7.629 MB
W20240207 06:45:49.888535  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_3 [1000000]0x10000634f000 7.629 MB
W20240207 06:45:49.888573  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_4 [1000000]0x100006af2000 7.629 MB
W20240207 06:45:49.888610  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_5 [1000000]0x100007295000 7.629 MB
W20240207 06:45:49.888649  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_6 [1000000]0x100007a38000 7.629 MB
W20240207 06:45:49.888684  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_7 [1000000]0x1000081db000 7.629 MB
W20240207 06:45:49.888724  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_8 [1000000]0x10000897e000 7.629 MB
W20240207 06:45:49.888757  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r1_9 [1000000]0x100009121000 7.629 MB
W20240207 06:45:49.888787  5730 IPCTensor.h:369] NewIPCTensor: step_r1 [10]0x1000098c4000 80 B 
W20240207 06:45:49.888810  5730 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r1 [1]0x1000098c6000 8 B 
W20240207 06:45:49.888840  5730 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r1 [1]0x1000098c8000 8 B 
W20240207 06:45:49.888904  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_0 [1000000]0x1000098ca000 7.629 MB
W20240207 06:45:49.888944  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_1 [1000000]0x10000a06d000 7.629 MB
W20240207 06:45:49.888974  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_2 [1000000]0x10000a810000 7.629 MB
W20240207 06:45:49.889001  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_3 [1000000]0x10000afb3000 7.629 MB
W20240207 06:45:49.889035  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_4 [1000000]0x10000b756000 7.629 MB
W20240207 06:45:49.889067  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_5 [1000000]0x10000bef9000 7.629 MB
W20240207 06:45:49.889102  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_6 [1000000]0x10000c69c000 7.629 MB
W20240207 06:45:49.889132  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_7 [1000000]0x10000ce3f000 7.629 MB
W20240207 06:45:49.889165  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_8 [1000000]0x10000d5e2000 7.629 MB
W20240207 06:45:49.889199  5730 IPCTensor.h:369] NewIPCTensor: cached_sampler_r2_9 [1000000]0x10000dd85000 7.629 MB
W20240207 06:45:49.889235  5730 IPCTensor.h:369] NewIPCTensor: step_r2 [10]0x10000e528000 80 B 
W20240207 06:45:49.889257  5730 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_r2 [1]0x10000e52a000 8 B 
W20240207 06:45:49.889286  5730 IPCTensor.h:369] NewIPCTensor: circle_buffer_end_cppseen_r2 [1]0x10000e52c000 8 B 
W20240207 06:45:50.281634  5730 IPCTensor.h:369] NewIPCTensor: full_emb [86054151, 400]0x10000e52e000 128.2 GB
W20240207 06:54:22.662541  5730 IPCTensor.h:369] NewIPCTensor: full_emb_SparseRowWiseAdaGrad_sum [86054151]0x10201d166000 328.3 MB
{0: Graph(num_nodes=32806815, num_edges=98289586,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 1: Graph(num_nodes=31756927, num_edges=120802495,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)}), 2: Graph(num_nodes=32681333, num_edges=137186093,
      ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_node': Scheme(shape=(), dtype=torch.int32), 'part_id': Scheme(shape=(), dtype=torch.int64)}
      edata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64), 'inner_edge': Scheme(shape=(), dtype=torch.int8)})}
MertisPartition: part 0 has 32806815 N 98289586 E
MertisPartition: part 1 has 31756927 N 120802495 E
MertisPartition: part 2 has 32681333 N 137186093 E
Rank0: cached key size 1434235
Rank1: cached key size 1434235
Rank2: cached key size 1434235
Before renumbering graph:  {'_ID': tensor([     196,      197,      239,  ..., 85907466, 77843586,   627118]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
After renumbering graph:  {'_ID': tensor([ 4308726,  4308755,  4310167,  ..., 85120980, 85292252, 29093194]), 'inner_node': tensor([1, 1, 1,  ..., 0, 0, 0], dtype=torch.int32), 'part_id': tensor([0, 0, 0,  ..., 1, 1, 1])}
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
part_g: DGLGraph(num_nodes=32806815, num_edges=98289586,
         ndata_schemes={'_ID': Scheme(shape=(), dtype=torch.int64)}
         edata_schemes={'tid': Scheme(shape=(), dtype=torch.int64)})
Total initialize time 2134.182 seconds
[Rank1] pid = 6888
INFO [5730 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 0
INFO [5730 distributed_c10d.py:476] Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
W20240207 07:02:50.890421  7030 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_0 [4302707, 400]; dev=0; size=6.412 GB
INFO [6888 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 1
INFO [6984 distributed_c10d.py:442] Added key: store_based_barrier_key:1 to store for rank: 2
INFO [6888 distributed_c10d.py:476] Rank 1: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
INFO [6984 distributed_c10d.py:476] Rank 2: Completed store-based barrier for key:store_based_barrier_key:1 with 3 nodes.
W20240207 07:02:50.895622  6985 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_2 [4302707, 400]; dev=2; size=6.412 GB
W20240207 07:02:50.895619  6889 IPCTensor.h:409] NewIPCGPUTensor: embedding_cache_1 [4302707, 400]; dev=1; size=6.412 GB
W20240207 07:02:50.944077  6985 IPCTensor.h:369] NewIPCTensor: input_keys_2 [1000000]0x1020319b3000 7.629 MB
W20240207 07:02:50.944159  7030 IPCTensor.h:369] NewIPCTensor: input_keys_0 [1000000]0x102032156000 7.629 MB
W20240207 07:02:50.944175  6889 IPCTensor.h:369] NewIPCTensor: input_keys_1 [1000000]0x1020328f9000 7.629 MB
W20240207 07:02:50.944316  6985 IPCTensor.h:369] NewIPCTensor: input_keys_neg_2 [1000000]0x10203309c000 7.629 MB
W20240207 07:02:50.944399  6889 IPCTensor.h:369] NewIPCTensor: input_keys_neg_1 [1000000]0x10203383f000 7.629 MB
W20240207 07:02:50.944401  7030 IPCTensor.h:369] NewIPCTensor: input_keys_neg_0 [1000000]0x102033fe2000 7.629 MB
W20240207 07:02:50.944432  6985 IPCTensor.h:369] NewIPCTensor: backward_grads_2 [1000000, 400]0x102034785000 1.49 GB
W20240207 07:02:50.944474  7030 IPCTensor.h:369] NewIPCTensor: backward_grads_0 [1000000, 400]0x102093d68000 1.49 GB
W20240207 07:02:50.944501  6985 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_2 [1000000, 400]0x1020f334b000 1.49 GB
W20240207 07:02:50.944525  6889 IPCTensor.h:369] NewIPCTensor: backward_grads_1 [1000000, 400]0x10215292e000 1.49 GB
W20240207 07:02:50.944527  7030 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_0 [1000000, 400]0x1021b1f11000 1.49 GB
W20240207 07:02:50.944555  6985 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 07:02:50.944589  7030 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 07:02:50.944592  6889 IPCTensor.h:369] NewIPCTensor: backward_grads_neg_1 [1000000, 400]0x1022114f4000 1.49 GB
W20240207 07:02:50.944628  6889 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_1_gpu [1000000, 400]; dev=1; size=1.49 GB
W20240207 07:02:50.949450  7030 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_0_gpu [1000000, 400]; dev=0; size=1.49 GB
W20240207 07:02:50.949472  6985 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_2_gpu [1000000, 400]; dev=2; size=1.49 GB
W20240207 07:02:50.949486  6889 IPCTensor.h:409] NewIPCGPUTensor: backward_grads_neg_1_gpu [1000000, 400]; dev=1; size=1.49 GB
cudaHostRegister 0x10000e52e000
1: KnownLocalCachedEmbedding init done
WARNING [6888 DistTensor.py:59] The tensor name already exists in the kvstore
cudaHostRegister 0x10000e52e000
2: KnownLocalCachedEmbedding init done
WARNING [6984 DistTensor.py:59] The tensor name already exists in the kvstore
[Rank2] pid = 6984
New CachedEmbedding, name=full_emb, shape=(86054151, 400), cache_type=KnownLocalCachedEmbedding
fixed cache_range is [(0, 4302707), (4302707, 8605414), (8605414, 12908121)]
cudaHostRegister 0x10000e52e000
0: KnownLocalCachedEmbedding init done
WARNING [5730 DistTensor.py:59] The tensor name already exists in the kvstore
I20240207 07:03:20.285319  7030 IPC_barrier.h:118] CreateBarrier: new barrier, name: kgcachecontroller, count: 3
I20240207 07:03:20.285516  6889 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
I20240207 07:03:20.285629  6985 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: kgcachecontroller, count: 3
W20240207 07:03:20.286847  7030 grad_base.h:55] KGCacheController, config={
        "num_gpus": 3,
        "L": 10,
        "backgrad_init": "both", 
        "kForwardItersPerStep": 2,
        "clr": 0.01,
        "nr_background_threads": 32,
        "backwardMode": "CppAsyncV2",
        "cache_ratio": 0.05,
        "update_cache_use_omp":  0,
        "update_pq_use_omp":  0
        }
W20240207 07:03:20.286979  7030 grad_base.h:184] Init GradProcessingBase done
I20240207 07:03:33.340835  7030 grad_async_v2.h:42] Use main thread to update emb.
W20240207 07:03:33.341008  7030 kg_controller.h:78] after init GradAsyncProcessingV2
I20240207 07:03:33.341018  7030 kg_controller.h:84] Construct KGCacheController done
E20240207 07:03:33.685802  6889 recstore.cc:66] init folly done
E20240207 07:03:33.685811  6985 recstore.cc:66] init folly done
E20240207 07:03:33.685847  7030 recstore.cc:66] init folly done
I20240207 07:03:33.686864  7030 grad_base.h:60] GraphEnv RegTensorsPerProcess
W20240207 07:03:44.959730  7294 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 07:03:44.960242  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 07:03:47.141183  7294 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 07:03:47.141340  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 07:03:48.434032  7294 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
E20240207 07:03:48.434175  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 125.822 us                | 254.434 us                |
+---------------------------+---------------------------+---------------------------+
W20240207 07:03:52.077222  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 07:03:52.094399  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 07:03:52.508580  7030 IPC_barrier.h:118] CreateBarrier: new barrier, name: start_barrier, count: 3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 136.515 us                | 304.265 us                |
+---------------------------+---------------------------+---------------------------+
W20240207 07:03:55.923938  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 07:03:55.939232  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 07:03:55.977330  6889 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
W20240207 07:03:58.237584  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 07:03:58.258869  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
I20240207 07:03:58.291977  6985 IPC_barrier.h:112] CreateBarrier: find existing barrier, name: start_barrier, count: 3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 130.764 us                | 233.292 us                |
+---------------------------+---------------------------+---------------------------+
E20240207 07:03:59.727663  7030 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 07:03:59.837587  7030 grad_async_v2.h:257] pq is empty
W20240207 07:03:59.841693  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
W20240207 07:03:59.924492  7030 grad_async_v2.h:257] pq is empty
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 7.700 ms                  | 104.552 ms                |
| Forward                   | 5.997 ms                  | 801.823 ms                |
| Backward                  | 5.813 ms                  | 172.541 ms                |
| Optimize                  | 2.247 ms                  | 29.667 ms                 |
| BarrierTimeBeforeRank0    | 35.849 us                 | 92.488 us                 |
| AfterBackward             | 62.593 ms                 | 435.384 ms                |
| BlockToStepN              | 145.631 us                | 391.016 us                |
| OneStep                   | 86.248 ms                 | 1.546 s                   |
+---------------------------+---------------------------+---------------------------+
W20240207 07:04:00.500427  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=7, pq.top=7
E20240207 07:04:00.727018  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=39
W20240207 07:04:00.769927  7030 grad_async_v2.h:257] pq is empty
W20240207 07:04:00.960629  7294 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
E20240207 07:04:01.096704  7147 grad_async_v2.h:404] Stalled in ProcessBackward: rank=0, step_no=16, sample_step_cpp_seen_[rank]=15
W20240207 07:04:01.726338  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=19, pq.top=19
E20240207 07:04:01.727016  7300 parallel_pq_v2.h:79] insert failed, size(hashtable)=12993
W20240207 07:04:02.122483  7294 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end3
E20240207 07:04:02.727020  7147 parallel_pq_v2.h:79] insert failed, size(hashtable)=55
W20240207 07:04:03.050225  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=31, pq.top=30
W20240207 07:04:03.201107  7294 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 277.483 us                | 2.180 ms                  |
| ProcessBack:Shuffle       | 1.689 ms                  | 67.409 ms                 |
| ProcessBack:UpdateCache   | 2.051 ms                  | 193.105 ms                |
| ProcessBack:UpsertPq      | 37.919 ms                 | 69.274 ms                 |
| ProcessOneStep            | 52.304 ms                 | 503.016 ms                |
| BlockToStepN              | 206.907 us                | 2.278 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:03.727015  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=18
W20240207 07:04:04.066291  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=43, pq.top=43
W20240207 07:04:04.433777  7294 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240207 07:04:04.727010  7147 parallel_pq_v2.h:79] insert failed, size(hashtable)=2911
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 6.083 ms                  | 119.815 ms                |
| Forward                   | 5.337 ms                  | 7.993 ms                  |
| Backward                  | 5.791 ms                  | 12.046 ms                 |
| Optimize                  | 2.302 ms                  | 5.753 ms                  |
| BarrierTimeBeforeRank0    | 28.949 us                 | 3.463 ms                  |
| AfterBackward             | 49.626 ms                 | 435.384 ms                |
| BlockToStepN              | 334.272 us                | 1.610 ms                  |
| OneStep                   | 78.823 ms                 | 528.377 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 07:04:05.331286  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=57, pq.top=57
W20240207 07:04:05.572345  7294 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
E20240207 07:04:05.727032  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=224
E20240207 07:04:06.096009  7030 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=65, sample_step_cpp_seen_[rank]=64
E20240207 07:04:06.727017  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 07:04:06.732589  7294 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end6
E20240207 07:04:07.732980  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=0
W20240207 07:04:07.781368  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=77, pq.top=77
W20240207 07:04:07.820185  7294 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end8
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 243.948 us                | 2.809 ms                  |
| ProcessBack:Shuffle       | 1.695 ms                  | 18.681 ms                 |
| ProcessBack:UpdateCache   | 2.050 ms                  | 2.599 ms                  |
| ProcessBack:UpsertPq      | 32.432 ms                 | 70.345 ms                 |
| ProcessOneStep            | 48.694 ms                 | 503.016 ms                |
| BlockToStepN              | 340.901 us                | 6.072 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:08.732008  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=9
W20240207 07:04:09.186601  7294 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end3
E20240207 07:04:09.732020  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=25
train_sampler.Prefill()
before start barrier
start train
[proc 2] 100 steps, total: 11.568, sample: 1.209, forward: 0.902, backward: 0.751, update: 0.235
train_sampler.Prefill()
before start barrier
start train
[proc 1] 100 steps, total: 13.883, sample: 1.102, forward: 0.902, backward: 0.699, update: 0.260
train_sampler.Prefill()
-------Step 0-------
tensor([  303489,    58264,   303515, 21910464,   303535,   303560,     2772,
          719188,   769612,   303580]) tensor([ 8301948, 42574760, 22117714, 73647906, 25216164,   642092, 67838974,
        20941623, 60896575, 54224735])
-------Step 1-------
tensor([  303489,    58264,   303515, 21910464,   303535,   303560,     2772,
          719188,   769612,   303580]) tensor([50022962, 20006355,  4699337, 76330808, 62966147, 46439667, 17274506,
        20167680,  1789281, 28595836])
-------Step 2-------
tensor([361867, 361891,   3018, 775848, 361912, 361936, 361958, 453717, 361977,
        362003]) tensor([23472792, 50336388, 83493175, 47905166, 19107025, 41457435, 21830114,
        32218115, 70319308, 78226147])
-------Step 3-------
tensor([361867, 361891,   3018, 775848, 361912, 361936, 361958, 453717, 361977,
        362003]) tensor([52246369,  1192994, 68237969, 14936058, 71513444,  9562883, 15524000,
        71169707, 63163279, 77012869])
-------Step 4-------
tensor([  420673,   420697,   343351,   420718,   732483,   420735, 25523168,
          420758,   420771,   420798]) tensor([35608736, 71658942, 11084545, 57157387, 64810921, 74629551, 14532814,
        32179199,  9078653, 32943046])
-------Step 5-------
tensor([  420673,   420697,   343351,   420718,   732483,   420735, 25523168,
          420758,   420771,   420798]) tensor([44696931, 73269180, 38619874, 42492933, 11248340, 78913764, 33202115,
        36410528,   724952, 36947623])
-------Step 6-------
tensor([  478570,   478595,   478618,   739436, 25523168,   478660,   478682,
          478707,   478737,       76]) tensor([50533085, 13862008, 76147452, 21321778,   911271, 42883559, 19635993,
         8069732,   434584, 25003924])
-------Step 7-------
tensor([  478570,   478595,   478618,   739436, 25523168,   478660,   478682,
          478707,   478737,       76]) tensor([44601362, 47112107, 53391810,   196846, 29831490, 43830450, 83839707,
        67351610, 34052406, 37473597])
-------Step 8-------
tensor([  538826,   538842,   538864,   538884,   793615,   538910, 17496725,
          538930,   538950, 17928205]) tensor([71063521, 28599759, 20988055, 16731680, 50813640, 10815163, 74536049,
         1388576, 73364090, 53493835])
-------Step 9-------
tensor([  538826,   538842,   538864,   538884,   793615,   538910, 17496725,
          538930,   538950, 17928205]) tensor([37049627, 35611046, 47698714, 67653851, 41979738, 63210679, 44997040,
        25270072, 81913546, 20919338])
before start barrier
start train
[proc 0] 100 steps, total: 17.352, sample: 1.502, forward: 1.344, backward: 0.746, update: 0.303
W20240207 07:04:10.169721  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=103, pq.top=103
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 5.040 ms                  | 119.815 ms                |
| Forward                   | 5.164 ms                  | 24.730 ms                 |
| Backward                  | 5.569 ms                  | 12.046 ms                 |
| Optimize                  | 2.265 ms                  | 24.180 ms                 |
| BarrierTimeBeforeRank0    | 28.162 us                 | 21.190 ms                 |
| AfterBackward             | 49.660 ms                 | 503.049 ms                |
| BlockToStepN              | 438.814 us                | 6.133 ms                  |
| OneStep                   | 73.234 ms                 | 756.801 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 07:04:10.419324  7294 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end4
E20240207 07:04:10.732020  7316 parallel_pq_v2.h:79] insert failed, size(hashtable)=16726
W20240207 07:04:11.211620  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=113, pq.top=113
E20240207 07:04:11.490301  7030 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=117, sample_step_cpp_seen_[rank]=116
W20240207 07:04:11.621161  7294 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end8
E20240207 07:04:11.732012  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=61
E20240207 07:04:12.732024  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=43
W20240207 07:04:12.779206  7294 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 310.745 us                | 6.082 ms                  |
| ProcessBack:Shuffle       | 1.695 ms                  | 17.885 ms                 |
| ProcessBack:UpdateCache   | 2.040 ms                  | 2.390 ms                  |
| ProcessBack:UpsertPq      | 32.584 ms                 | 70.818 ms                 |
| ProcessOneStep            | 48.694 ms                 | 503.016 ms                |
| BlockToStepN              | 469.629 us                | 7.784 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:13.732028  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=18576
W20240207 07:04:13.883190  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=139, pq.top=139
W20240207 07:04:13.989401  7294 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
E20240207 07:04:14.732038  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=12
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.625 ms                  | 108.431 ms                |
| Forward                   | 5.104 ms                  | 7.993 ms                  |
| Backward                  | 5.340 ms                  | 11.334 ms                 |
| Optimize                  | 2.222 ms                  | 5.753 ms                  |
| BarrierTimeBeforeRank0    | 30.359 us                 | 39.500 ms                 |
| AfterBackward             | 47.927 ms                 | 435.384 ms                |
| BlockToStepN              | 580.226 us                | 6.316 ms                  |
| OneStep                   | 73.183 ms                 | 528.377 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 07:04:15.369861  7294 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end4
W20240207 07:04:15.475103  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=155, pq.top=155
E20240207 07:04:15.732023  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=99
W20240207 07:04:16.539284  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=165, pq.top=165
W20240207 07:04:16.691890  7294 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end7
E20240207 07:04:16.718786  7030 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=166, sample_step_cpp_seen_[rank]=165
E20240207 07:04:16.732007  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=153
W20240207 07:04:17.567306  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=177, pq.top=177
E20240207 07:04:17.732028  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=50
W20240207 07:04:17.752365  7294 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end8
W20240207 07:04:18.577137  7030 grad_async_v2.h:257] pq is empty
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 356.978 us                | 4.674 ms                  |
| ProcessBack:Shuffle       | 1.693 ms                  | 17.885 ms                 |
| ProcessBack:UpdateCache   | 2.032 ms                  | 2.400 ms                  |
| ProcessBack:UpsertPq      | 29.976 ms                 | 81.333 ms                 |
| ProcessOneStep            | 48.216 ms                 | 434.976 ms                |
| BlockToStepN              | 607.598 us                | 7.784 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:18.745769  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=7030
W20240207 07:04:19.040249  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=189, pq.top=189
W20240207 07:04:19.205895  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 07:04:19.745013  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=26
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.187 ms                  | 119.815 ms                |
| Forward                   | 5.064 ms                  | 7.993 ms                  |
| Backward                  | 5.307 ms                  | 11.334 ms                 |
| Optimize                  | 2.183 ms                  | 13.102 ms                 |
| BarrierTimeBeforeRank0    | 53.302 us                 | 40.712 ms                 |
| AfterBackward             | 48.799 ms                 | 435.384 ms                |
| BlockToStepN              | 709.476 us                | 7.836 ms                  |
| OneStep                   | 77.439 ms                 | 528.377 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 0] 200 steps, total: 10.617, sample: 1.335, forward: 0.501, backward: 0.517, update: 0.236
[proc 1] 200 steps, total: 10.617, sample: 1.915, forward: 0.434, backward: 0.534, update: 0.199
[proc 2] 200 steps, total: 10.617, sample: 2.024, forward: 0.441, backward: 0.518, update: 0.192
W20240207 07:04:20.531347  7294 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end1
E20240207 07:04:20.745011  7030 parallel_pq_v2.h:79] insert failed, size(hashtable)=3942
W20240207 07:04:20.778828  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=203, pq.top=203
W20240207 07:04:21.543643  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end2
E20240207 07:04:21.745040  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=9499
W20240207 07:04:22.089282  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=215, pq.top=215
W20240207 07:04:22.659487  7294 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end2
E20240207 07:04:22.699393  7030 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=222, sample_step_cpp_seen_[rank]=221
E20240207 07:04:22.757220  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 07:04:23.217283  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=223, pq.top=223
W20240207 07:04:23.682574  7294 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 315.090 us                | 5.713 ms                  |
| ProcessBack:Shuffle       | 1.698 ms                  | 14.375 ms                 |
| ProcessBack:UpdateCache   | 2.015 ms                  | 2.400 ms                  |
| ProcessBack:UpsertPq      | 29.559 ms                 | 83.629 ms                 |
| ProcessOneStep            | 47.900 ms                 | 503.016 ms                |
| BlockToStepN              | 726.242 us                | 7.784 ms                  |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:23.767002  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 07:04:24.237926  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=235, pq.top=235
W20240207 07:04:24.726926  7294 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end4
E20240207 07:04:24.766005  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=3682
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.754 ms                  | 169.239 ms                |
| Forward                   | 5.039 ms                  | 7.993 ms                  |
| Backward                  | 5.361 ms                  | 11.334 ms                 |
| Optimize                  | 2.179 ms                  | 14.837 ms                 |
| BarrierTimeBeforeRank0    | 31.595 us                 | 40.712 ms                 |
| AfterBackward             | 47.173 ms                 | 503.049 ms                |
| BlockToStepN              | 839.558 us                | 11.462 ms                 |
| OneStep                   | 77.430 ms                 | 556.996 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 07:04:25.450189  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=251, pq.top=251
E20240207 07:04:25.766036  7324 parallel_pq_v2.h:79] insert failed, size(hashtable)=5128
W20240207 07:04:25.940837  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end7
W20240207 07:04:26.740136  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=263, pq.top=263
E20240207 07:04:26.766013  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=19509
W20240207 07:04:27.012254  7294 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end7
E20240207 07:04:27.766016  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=950
W20240207 07:04:27.920490  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=279, pq.top=279
W20240207 07:04:28.036650  7294 grad_async_v2.h:137] Detect new sample comes, old_end3, new_end1
E20240207 07:04:28.437417  7147 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=288, sample_step_cpp_seen_[rank]=287
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 340.061 us                | 7.516 ms                  |
| ProcessBack:Shuffle       | 1.682 ms                  | 6.908 ms                  |
| ProcessBack:UpdateCache   | 1.956 ms                  | 2.400 ms                  |
| ProcessBack:UpsertPq      | 26.378 ms                 | 81.333 ms                 |
| ProcessOneStep            | 44.680 ms                 | 485.098 ms                |
| BlockToStepN              | 912.346 us                | 11.409 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:28.766005  7030 parallel_pq_v2.h:79] insert failed, size(hashtable)=8903
W20240207 07:04:29.087813  7294 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end4
W20240207 07:04:29.622658  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=299, pq.top=299
[proc 2] 300 steps, total: 9.233, sample: 1.243, forward: 0.478, backward: 0.777, update: 0.235
[proc 1] 300 steps, total: 9.233, sample: 1.070, forward: 0.468, backward: 0.550, update: 0.212
[proc 0] 300 steps, total: 9.233, sample: 2.832, forward: 0.515, backward: 0.675, update: 0.246
E20240207 07:04:29.766028  7030 parallel_pq_v2.h:79] insert failed, size(hashtable)=616
W20240207 07:04:30.234134  7294 grad_async_v2.h:137] Detect new sample comes, old_end8, new_end9
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.930 ms                  | 203.488 ms                |
| Forward                   | 5.041 ms                  | 8.432 ms                  |
| Backward                  | 5.429 ms                  | 11.432 ms                 |
| Optimize                  | 2.179 ms                  | 13.102 ms                 |
| BarrierTimeBeforeRank0    | 31.328 us                 | 40.712 ms                 |
| AfterBackward             | 43.425 ms                 | 485.150 ms                |
| BlockToStepN              | 997.896 us                | 11.462 ms                 |
| OneStep                   | 74.614 ms                 | 528.377 ms                |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:30.770859  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=1
W20240207 07:04:31.249617  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=317, pq.top=317
W20240207 07:04:31.370327  7294 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end9
E20240207 07:04:31.770161  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=16
W20240207 07:04:32.376794  7294 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
W20240207 07:04:32.721761  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=335, pq.top=335
E20240207 07:04:32.770009  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=52070
W20240207 07:04:33.387892  7294 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end3
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 339.293 us                | 11.011 ms                 |
| ProcessBack:Shuffle       | 1.676 ms                  | 5.371 ms                  |
| ProcessBack:UpdateCache   | 1.933 ms                  | 2.400 ms                  |
| ProcessBack:UpsertPq      | 23.699 ms                 | 75.597 ms                 |
| ProcessOneStep            | 40.024 ms                 | 485.098 ms                |
| BlockToStepN              | 1.044 ms                  | 19.131 ms                 |
+---------------------------+---------------------------+---------------------------+
W20240207 07:04:33.725610  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=349, pq.top=349
E20240207 07:04:33.770012  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=19325
E20240207 07:04:33.982973  7147 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=353, sample_step_cpp_seen_[rank]=352
W20240207 07:04:34.464279  7294 grad_async_v2.h:137] Detect new sample comes, old_end4, new_end9
E20240207 07:04:34.770009  7030 parallel_pq_v2.h:79] insert failed, size(hashtable)=425
W20240207 07:04:34.929724  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=365, pq.top=365
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.975 ms                  | 169.239 ms                |
| Forward                   | 5.032 ms                  | 8.432 ms                  |
| Backward                  | 5.424 ms                  | 11.334 ms                 |
| Optimize                  | 2.220 ms                  | 6.666 ms                  |
| BarrierTimeBeforeRank0    | 36.880 us                 | 39.500 ms                 |
| AfterBackward             | 39.848 ms                 | 435.384 ms                |
| BlockToStepN              | 1.200 ms                  | 20.585 ms                 |
| OneStep                   | 73.498 ms                 | 518.180 ms                |
+---------------------------+---------------------------+---------------------------+
W20240207 07:04:35.541929  7294 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end4
E20240207 07:04:35.770011  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=3382
W20240207 07:04:36.058930  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=377, pq.top=377
W20240207 07:04:36.716392  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end8
E20240207 07:04:36.770009  7030 parallel_pq_v2.h:79] insert failed, size(hashtable)=169
W20240207 07:04:37.080731  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=392, pq.top=392
[proc 0] 400 steps, total: 7.909, sample: 1.554, forward: 0.521, backward: 0.529, update: 0.243
[proc 2] 400 steps, total: 7.909, sample: 1.505, forward: 0.466, backward: 0.832, update: 0.220
[proc 1] 400 steps, total: 7.909, sample: 1.234, forward: 0.467, backward: 0.596, update: 0.209
W20240207 07:04:37.749161  7294 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end2
E20240207 07:04:37.770038  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=13461
W20240207 07:04:38.600441  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=411, pq.top=411
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 280.676 us                | 11.833 ms                 |
| ProcessBack:Shuffle       | 1.669 ms                  | 4.891 ms                  |
| ProcessBack:UpdateCache   | 1.862 ms                  | 2.460 ms                  |
| ProcessBack:UpsertPq      | 19.113 ms                 | 73.147 ms                 |
| ProcessOneStep            | 39.054 ms                 | 434.976 ms                |
| BlockToStepN              | 1.281 ms                  | 35.125 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:38.770011  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=2814
W20240207 07:04:38.805002  7294 grad_async_v2.h:137] Detect new sample comes, old_end1, new_end5
W20240207 07:04:39.730378  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=429, pq.top=429
E20240207 07:04:39.770009  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=19172
E20240207 07:04:39.815384  7147 grad_async_v2.h:404] Stalled in ProcessBackward: rank=1, step_no=430, sample_step_cpp_seen_[rank]=429
W20240207 07:04:39.835247  7294 grad_async_v2.h:137] Detect new sample comes, old_end0, new_end1
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.793 ms                  | 169.239 ms                |
| Forward                   | 5.063 ms                  | 8.432 ms                  |
| Backward                  | 5.347 ms                  | 11.334 ms                 |
| Optimize                  | 2.241 ms                  | 6.666 ms                  |
| BarrierTimeBeforeRank0    | 56.938 us                 | 40.712 ms                 |
| AfterBackward             | 38.961 ms                 | 435.384 ms                |
| BlockToStepN              | 1.434 ms                  | 35.234 ms                 |
| OneStep                   | 72.418 ms                 | 518.180 ms                |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:40.770009  7030 parallel_pq_v2.h:79] insert failed, size(hashtable)=93523
W20240207 07:04:41.004560  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=449, pq.top=449
W20240207 07:04:41.096001  7294 grad_async_v2.h:137] Detect new sample comes, old_end2, new_end9
E20240207 07:04:41.770010  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=1445
W20240207 07:04:42.004737  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=457, pq.top=457
W20240207 07:04:42.143877  7294 grad_async_v2.h:137] Detect new sample comes, old_end6, new_end0
E20240207 07:04:42.770007  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=4468
W20240207 07:04:43.060868  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=473, pq.top=473
W20240207 07:04:43.194152  7294 grad_async_v2.h:137] Detect new sample comes, old_end7, new_end6
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| clean                     | 406.248 us                | 20.896 ms                 |
| ProcessBack:Shuffle       | 1.663 ms                  | 4.891 ms                  |
| ProcessBack:UpdateCache   | 1.777 ms                  | 2.428 ms                  |
| ProcessBack:UpsertPq      | 15.984 ms                 | 71.265 ms                 |
| ProcessOneStep            | 37.932 ms                 | 429.453 ms                |
| BlockToStepN              | 1.417 ms                  | 36.077 ms                 |
+---------------------------+---------------------------+---------------------------+
E20240207 07:04:43.770010  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=72
W20240207 07:04:44.222754  7294 grad_async_v2.h:137] Detect new sample comes, old_end5, new_end8
W20240207 07:04:44.491236  7030 grad_async_v2.h:270] Sleep in <BlockToStepN>, step_no=493, pq.top=493
E20240207 07:04:44.770013  7294 parallel_pq_v2.h:79] insert failed, size(hashtable)=2354
E20240207 07:04:44.815008  7030 grad_async_v2.h:404] Stalled in ProcessBackward: rank=2, step_no=498, sample_step_cpp_seen_[rank]=497
W20240207 07:04:45.276996  7294 grad_async_v2.h:137] Detect new sample comes, old_end9, new_end0
+---------------------------+---------------------------+---------------------------+
| Name                      | P50                       | P99                       |
+---------------------------+---------------------------+---------------------------+
| GenInput                  | 4.573 ms                  | 160.917 ms                |
| Forward                   | 5.119 ms                  | 7.993 ms                  |
| Backward                  | 5.308 ms                  | 10.865 ms                 |
| Optimize                  | 2.279 ms                  | 6.582 ms                  |
| BarrierTimeBeforeRank0    | 169.659 us                | 39.500 ms                 |
| AfterBackward             | 37.773 ms                 | 435.384 ms                |
| BlockToStepN              | 1.467 ms                  | 36.164 ms                 |
| OneStep                   | 71.248 ms                 | 518.180 ms                |
+---------------------------+---------------------------+---------------------------+
[proc 2] 500 steps, total: 7.703, sample: 1.062, forward: 0.474, backward: 0.785, update: 0.228
[proc 0] 500 steps, total: 7.703, sample: 1.110, forward: 0.518, backward: 0.502, update: 0.246
[proc 1] 500 steps, total: 7.703, sample: 0.892, forward: 0.464, backward: 0.622, update: 0.206
Successfully xmh. training takes 52.813045501708984 seconds
before call kg_cache_controller.StopThreads()
W20240207 07:04:45.321679  7030 grad_async_v2.h:84] call StopThreads. PID = 5730
W20240207 07:04:45.321709  7030 grad_base.h:212] before processOneStepNegThread_.join();
W20240207 07:04:45.322016  7030 grad_base.h:214] after processOneStepNegThread_.join();
W20240207 07:04:45.322027  7030 grad_async_v2.h:86] call GradProcessingBase::StopThreads.
W20240207 07:04:45.336642  7030 grad_async_v2.h:105] StopThreads done.
